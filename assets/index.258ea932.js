const _q=function(){const he=document.createElement("link").relList;if(he&&he.supports&&he.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))m(o);new MutationObserver(o=>{for(const g of o)if(g.type==="childList")for(const z of g.addedNodes)z.tagName==="LINK"&&z.rel==="modulepreload"&&m(z)}).observe(document,{childList:!0,subtree:!0});function j(o){const g={};return o.integrity&&(g.integrity=o.integrity),o.referrerpolicy&&(g.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?g.credentials="include":o.crossorigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function m(o){if(o.ep)return;o.ep=!0;const g=j(o);fetch(o.href,g)}};_q();function bs(){}function NM(nt){return nt()}function dM(){return Object.create(null)}function qb(nt){nt.forEach(NM)}function Eq(nt){return typeof nt=="function"}function Bp(nt,he){return nt!=nt?he==he:nt!==he||nt&&typeof nt=="object"||typeof nt=="function"}let rE;function Mm(nt,he){return rE||(rE=document.createElement("a")),rE.href=he,nt===rE.href}function Cq(nt){return Object.keys(nt).length===0}function vr(nt,he){nt.appendChild(he)}function vi(nt,he,j){nt.insertBefore(he,j||null)}function gi(nt){nt.parentNode.removeChild(nt)}function oE(nt,he){for(let j=0;j<nt.length;j+=1)nt[j]&&nt[j].d(he)}function Er(nt){return document.createElement(nt)}function Du(nt){return document.createTextNode(nt)}function zi(){return Du(" ")}function vd(){return Du("")}function L2(nt,he,j,m){return nt.addEventListener(he,j,m),()=>nt.removeEventListener(he,j,m)}function Wn(nt,he,j){j==null?nt.removeAttribute(he):nt.getAttribute(he)!==j&&nt.setAttribute(he,j)}function Aq(nt){return Array.from(nt.childNodes)}function Xv(nt,he){he=""+he,nt.wholeText!==he&&(nt.data=he)}function Qn(nt,he,j,m){j===null?nt.style.removeProperty(he):nt.style.setProperty(he,j,m?"important":"")}function Oq(nt,he,{bubbles:j=!1,cancelable:m=!1}={}){const o=document.createEvent("CustomEvent");return o.initCustomEvent(nt,j,m,he),o}let V2;function W2(nt){V2=nt}function IM(){if(!V2)throw new Error("Function called outside component initialization");return V2}function rS(nt){IM().$$.on_mount.push(nt)}function iS(){const nt=IM();return(he,j,{cancelable:m=!1}={})=>{const o=nt.$$.callbacks[he];if(o){const g=Oq(he,j,{cancelable:m});return o.slice().forEach(z=>{z.call(nt,g)}),!g.defaultPrevented}return!0}}const U2=[],Rc=[],aE=[],pM=[],Sq=Promise.resolve();let tS=!1;function Dq(){tS||(tS=!0,Sq.then(FM))}function nS(nt){aE.push(nt)}const eS=new Set;let iE=0;function FM(){const nt=V2;do{for(;iE<U2.length;){const he=U2[iE];iE++,W2(he),Tq(he.$$)}for(W2(null),U2.length=0,iE=0;Rc.length;)Rc.pop()();for(let he=0;he<aE.length;he+=1){const j=aE[he];eS.has(j)||(eS.add(j),j())}aE.length=0}while(U2.length);for(;pM.length;)pM.pop()();tS=!1,eS.clear(),W2(nt)}function Tq(nt){if(nt.fragment!==null){nt.update(),qb(nt.before_update);const he=nt.dirty;nt.dirty=[-1],nt.fragment&&nt.fragment.p(nt.ctx,he),nt.after_update.forEach(nS)}}const sE=new Set;let Zy;function Sl(){Zy={r:0,c:[],p:Zy}}function Dl(){Zy.r||qb(Zy.c),Zy=Zy.p}function Ci(nt,he){nt&&nt.i&&(sE.delete(nt),nt.i(he))}function Ii(nt,he,j,m){if(nt&&nt.o){if(sE.has(nt))return;sE.add(nt),Zy.c.push(()=>{sE.delete(nt),m&&(j&&nt.d(1),m())}),nt.o(he)}}function xs(nt){nt&&nt.c()}function fs(nt,he,j,m){const{fragment:o,on_mount:g,on_destroy:z,after_update:I}=nt.$$;o&&o.m(he,j),m||nS(()=>{const A=g.map(NM).filter(Eq);z?z.push(...A):qb(A),nt.$$.on_mount=[]}),I.forEach(nS)}function hs(nt,he){const j=nt.$$;j.fragment!==null&&(qb(j.on_destroy),j.fragment&&j.fragment.d(he),j.on_destroy=j.fragment=null,j.ctx=[])}function Nq(nt,he){nt.$$.dirty[0]===-1&&(U2.push(nt),Dq(),nt.$$.dirty.fill(0)),nt.$$.dirty[he/31|0]|=1<<he%31}function Pp(nt,he,j,m,o,g,z,I=[-1]){const A=V2;W2(nt);const X=nt.$$={fragment:null,ctx:null,props:g,update:bs,not_equal:o,bound:dM(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(he.context||(A?A.$$.context:[])),callbacks:dM(),dirty:I,skip_bound:!1,root:he.target||A.$$.root};z&&z(X.root);let K=!1;if(X.ctx=j?j(nt,he.props||{},(M,V,...$)=>{const W=$.length?$[0]:V;return X.ctx&&o(X.ctx[M],X.ctx[M]=W)&&(!X.skip_bound&&X.bound[M]&&X.bound[M](W),K&&Nq(nt,M)),V}):[],X.update(),K=!0,qb(X.before_update),X.fragment=m?m(X.ctx):!1,he.target){if(he.hydrate){const M=Aq(he.target);X.fragment&&X.fragment.l(M),M.forEach(gi)}else X.fragment&&X.fragment.c();he.intro&&Ci(nt.$$.fragment),fs(nt,he.target,he.anchor,he.customElement),FM()}W2(A)}class Lp{$destroy(){hs(this,1),this.$destroy=bs}$on(he,j){const m=this.$$.callbacks[he]||(this.$$.callbacks[he]=[]);return m.push(j),()=>{const o=m.indexOf(j);o!==-1&&m.splice(o,1)}}$set(he){this.$$set&&!Cq(he)&&(this.$$.skip_bound=!0,this.$$set(he),this.$$.skip_bound=!1)}}function mM(nt,he,j){const m=nt.slice();return m[5]=he[j],m}function gM(nt){let he,j=nt[1][nt[5]*7]+"",m,o,g,z,I,A,X,K=nt[1][nt[5]*7+1]+"",M,V,$,W,te,F,ue,se=nt[1][nt[5]*7+2]+"",J,me,pe,Oe,Fe=nt[1][nt[5]*7+3]+"",Le,Ae,ft,Mt,Xt,tn,Ce,Wt=nt[1][nt[5]*7+4]+"",en,Ut,Qe,fn,on,Ct,Vt,En=nt[1][nt[5]*7+5]+"",Pt,Rt,Tn,Hn,tr,pn,$e,et=nt[1][nt[5]*7+6]+"",Ke,yt;return{c(){he=Er("li"),m=Du(j),g=zi(),z=Er("li"),A=zi(),X=Er("li"),M=Du(K),$=zi(),W=Er("li"),F=zi(),ue=Er("li"),J=Du(se),pe=zi(),Oe=Er("li"),Le=Du(Fe),ft=zi(),Mt=Er("li"),tn=zi(),Ce=Er("li"),en=Du(Wt),Qe=zi(),fn=Er("li"),Ct=zi(),Vt=Er("li"),Pt=Du(En),Tn=zi(),Hn=Er("li"),pn=zi(),$e=Er("li"),Ke=Du(et),Wn(he,"class","white c svelte-1m7nhtl"),Wn(he,"id",o="c"+(nt[5]+2)),Wn(z,"class","black cs svelte-1m7nhtl"),Wn(z,"id",I="cs"+(nt[5]+2)),Wn(X,"class","white d svelte-1m7nhtl"),Wn(X,"id",V="d"+(nt[5]+2)),Wn(W,"class","black ds svelte-1m7nhtl"),Wn(W,"id",te="ds"+(nt[5]+2)),Wn(ue,"class","white e svelte-1m7nhtl"),Wn(ue,"id",me="e"+(nt[5]+2)),Wn(Oe,"class","white f svelte-1m7nhtl"),Wn(Oe,"id",Ae="f"+(nt[5]+2)),Wn(Mt,"class","black fs svelte-1m7nhtl"),Wn(Mt,"id",Xt="fs"+(nt[5]+2)),Wn(Ce,"class","white g svelte-1m7nhtl"),Wn(Ce,"id",Ut="g"+(nt[5]+2)),Wn(fn,"class","black gs svelte-1m7nhtl"),Wn(fn,"id",on="gs"+(nt[5]+2)),Wn(Vt,"class","white a svelte-1m7nhtl"),Wn(Vt,"id",Rt="a"+(nt[5]+2)),Wn(Hn,"class","black as svelte-1m7nhtl"),Wn(Hn,"id",tr="as"+(nt[5]+2)),Wn($e,"class","white b svelte-1m7nhtl"),Wn($e,"id",yt="b"+(nt[5]+2))},m(Dt,Lt){vi(Dt,he,Lt),vr(he,m),vi(Dt,g,Lt),vi(Dt,z,Lt),vi(Dt,A,Lt),vi(Dt,X,Lt),vr(X,M),vi(Dt,$,Lt),vi(Dt,W,Lt),vi(Dt,F,Lt),vi(Dt,ue,Lt),vr(ue,J),vi(Dt,pe,Lt),vi(Dt,Oe,Lt),vr(Oe,Le),vi(Dt,ft,Lt),vi(Dt,Mt,Lt),vi(Dt,tn,Lt),vi(Dt,Ce,Lt),vr(Ce,en),vi(Dt,Qe,Lt),vi(Dt,fn,Lt),vi(Dt,Ct,Lt),vi(Dt,Vt,Lt),vr(Vt,Pt),vi(Dt,Tn,Lt),vi(Dt,Hn,Lt),vi(Dt,pn,Lt),vi(Dt,$e,Lt),vr($e,Ke)},p:bs,d(Dt){Dt&&gi(he),Dt&&gi(g),Dt&&gi(z),Dt&&gi(A),Dt&&gi(X),Dt&&gi($),Dt&&gi(W),Dt&&gi(F),Dt&&gi(ue),Dt&&gi(pe),Dt&&gi(Oe),Dt&&gi(ft),Dt&&gi(Mt),Dt&&gi(tn),Dt&&gi(Ce),Dt&&gi(Qe),Dt&&gi(fn),Dt&&gi(Ct),Dt&&gi(Vt),Dt&&gi(Tn),Dt&&gi(Hn),Dt&&gi(pn),Dt&&gi($e)}}}function Iq(nt){let he,j,m,o,g,z=[...Array(4).keys()],I=[];for(let A=0;A<z.length;A+=1)I[A]=gM(mM(nt,z,A));return{c(){he=Er("ul");for(let A=0;A<I.length;A+=1)I[A].c();j=zi(),m=Er("li"),m.textContent=`${nt[1][28]}`,o=zi(),g=Er("div"),Wn(m,"class","white c svelte-1m7nhtl"),Wn(m,"id","c6"),Wn(he,"class","set svelte-1m7nhtl"),Qn(g,"display","none"),Wn(g,"class","clicked white black keyClick svelte-1m7nhtl")},m(A,X){vi(A,he,X);for(let K=0;K<I.length;K+=1)I[K].m(he,null);vr(he,j),vr(he,m),nt[2](he),vi(A,o,X),vi(A,g,X)},p(A,[X]){if(X&2){z=[...Array(4).keys()];let K;for(K=0;K<z.length;K+=1){const M=mM(A,z,K);I[K]?I[K].p(M,X):(I[K]=gM(M),I[K].c(),I[K].m(he,j))}for(;K<I.length;K+=1)I[K].d(1);I.length=z.length}},i:bs,o:bs,d(A){A&&gi(he),oE(I,A),nt[2](null),A&&gi(o),A&&gi(g)}}}function Fq(nt,he,j){let m,o,g="zxcvbnm,./asdfghjkl;'qwertyui".split("");const z=iS();rS(()=>{m.addEventListener("mousedown",M=>{Array.from(m.children).forEach(V=>{const $=V;$.classList.contains("clicked")||$.classList.toggle("clicked")})}),m.addEventListener("mouseup",M=>{Array.from(m.children).forEach(V=>{const $=V;$.classList.contains("clicked")&&$.classList.toggle("clicked")})}),m.addEventListener("mouseleave",M=>{Array.from(m.children).forEach(V=>{const $=V;$.classList.contains("clicked")&&$.classList.toggle("clicked")})}),Array.from(m.children).forEach(M=>{M.addEventListener("mouseenter",V=>{M.classList.contains("clicked")&&K(M)}),M.addEventListener("mousedown",V=>K(M))});function A(M,V){const $=M.charCodeAt(0);let W=0;$<=98?W=$-91:W=$-98;const te=7*(Number(V)-4);return W+te}function X(){var M=new Date().getTime(),V="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function($){var W=(M+Math.random()*16)%16|0;return M=Math.floor(M/16),($=="x"?W:W&3|8).toString(16)});return V}function K(M){const V=M.id.split("");V.length<3?(o=[String(A(V[0],V[1])),X(),M.id],z("send",o)):(o=[String(A(V[0],V[2])),X(),"#",M.id],z("send",o))}window.addEventListener("keydown",M=>{if(!M.repeat){const V=document.querySelectorAll("li");g.forEach($=>{$.indexOf(M.key)>-1&&V.forEach(W=>{if(W.innerHTML===$){W.classList.add("keyClick");const te=W.id.split("");z("send",[String(A(te[0],te[1])),X(),W.id])}})})}}),window.addEventListener("keyup",M=>{const V=document.querySelectorAll("li");g.forEach($=>{$.indexOf(M.key)>-1&&V.forEach(W=>{W.innerHTML===$&&W.classList.remove("keyClick")})})})});function I(A){Rc[A?"unshift":"push"](()=>{m=A,j(0,m)})}return[m,g,I]}class Rq extends Lp{constructor(he){super(),Pp(this,he,Fq,Iq,Bp,{})}}function Mq(nt){let he;return{c(){he=Er("div"),he.textContent=".",Qn(he,"position","absolute"),Qn(he,"left","23px"),Qn(he,"bottom","17px"),Qn(he,"font-size","50px")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function jq(nt){let he;return{c(){he=Er("div"),he.textContent=".",Qn(he,"position","absolute"),Qn(he,"left","23px"),Qn(he,"bottom","11px"),Qn(he,"font-size","50px")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function Bq(nt){let he,j,m,o;function g(A,X){if(A[1]>=-12&&A[1]%2==0&&A[3].isPoint)return jq;if(A[1]>=-13&&A[1]%2==-1&&A[3].isPoint||A[1]>=-13&&A[1]%2==1&&A[3].isPoint)return Mq}let z=g(nt),I=z&&z(nt);return{c(){he=Er("div"),I&&I.c(),j=zi(),m=Er("img"),Mm(m.src,o="\uC628\uC74C\uD45C.svg")||Wn(m,"src",o),Wn(m,"alt",""),Qn(m,"height","17px"),Wn(m,"class","noteImage"),Qn(he,"display","inline-block"),Qn(he,"margin-right","0.15px"),Qn(he,"position","relative"),Qn(he,"bottom",nt[0]-17+"px"),Qn(he,"z-index","3"),Wn(he,"data-note",nt[1]),Wn(he,"data-beat",nt[2])},m(A,X){vi(A,he,X),I&&I.m(he,null),vr(he,j),vr(he,m)},p(A,[X]){z!==(z=g(A))&&(I&&I.d(1),I=z&&z(A),I&&(I.c(),I.m(he,j))),X&1&&Qn(he,"bottom",A[0]-17+"px"),X&2&&Wn(he,"data-note",A[1]),X&4&&Wn(he,"data-beat",A[2])},i:bs,o:bs,d(A){A&&gi(he),I&&I.d()}}}function Pq(nt,he,j){let{bottom:m}=he,{note:o}=he,{beat:g}=he,{point:z}=he;return nt.$$set=I=>{"bottom"in I&&j(0,m=I.bottom),"note"in I&&j(1,o=I.note),"beat"in I&&j(2,g=I.beat),"point"in I&&j(3,z=I.point)},[m,o,g,z]}class Hb extends Lp{constructor(he){super(),Pp(this,he,Pq,Bq,Bp,{bottom:0,note:1,beat:2,point:3})}}function Lq(nt){let he;return{c(){he=Er("div"),he.textContent=".",Qn(he,"position","absolute"),Qn(he,"left","23px"),Qn(he,"bottom","17px"),Qn(he,"font-size","50px")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function zq(nt){let he;return{c(){he=Er("div"),he.textContent=".",Qn(he,"position","absolute"),Qn(he,"left","23px"),Qn(he,"bottom","11px"),Qn(he,"font-size","50px")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function Uq(nt){let he,j,m,o;function g(A,X){if(A[1]>=-12&&A[1]%2==0&&A[3].isPoint)return zq;if(A[1]>=-13&&A[1]%2==-1&&A[3].isPoint||A[1]>=-13&&A[1]%2==1&&A[3].isPoint)return Lq}let z=g(nt),I=z&&z(nt);return{c(){he=Er("div"),I&&I.c(),j=zi(),m=Er("img"),Mm(m.src,o="2\uBD84\uC74C\uD45C(1).svg")||Wn(m,"src",o),Wn(m,"alt",""),Qn(m,"height","63px"),Wn(m,"class","noteImage"),Qn(he,"display","inline-block"),Qn(he,"margin-right","3.57px"),Qn(he,"position","relative"),Qn(he,"bottom",nt[0]-17+"px"),Qn(he,"z-index","3"),Wn(he,"data-note",nt[1]),Wn(he,"data-beat",nt[2])},m(A,X){vi(A,he,X),I&&I.m(he,null),vr(he,j),vr(he,m)},p(A,[X]){z!==(z=g(A))&&(I&&I.d(1),I=z&&z(A),I&&(I.c(),I.m(he,j))),X&1&&Qn(he,"bottom",A[0]-17+"px"),X&2&&Wn(he,"data-note",A[1]),X&4&&Wn(he,"data-beat",A[2])},i:bs,o:bs,d(A){A&&gi(he),I&&I.d()}}}function Wq(nt,he,j){let{bottom:m}=he,{note:o}=he,{beat:g}=he,{point:z}=he;return nt.$$set=I=>{"bottom"in I&&j(0,m=I.bottom),"note"in I&&j(1,o=I.note),"beat"in I&&j(2,g=I.beat),"point"in I&&j(3,z=I.point)},[m,o,g,z]}class oS extends Lp{constructor(he){super(),Pp(this,he,Wq,Uq,Bp,{bottom:0,note:1,beat:2,point:3})}}function Vq(nt){let he;return{c(){he=Er("div"),he.textContent=".",Qn(he,"position","absolute"),Qn(he,"left","23px"),Qn(he,"bottom","17px"),Qn(he,"font-size","50px")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function qq(nt){let he;return{c(){he=Er("div"),he.textContent=".",Qn(he,"position","absolute"),Qn(he,"left","23px"),Qn(he,"bottom","11px"),Qn(he,"font-size","50px")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function Hq(nt){let he,j,m,o;function g(A,X){if(A[1]>=-12&&A[1]%2==0&&A[3].isPoint)return qq;if(A[1]>=-13&&A[1]%2==-1&&A[3].isPoint||A[1]>=-13&&A[1]%2==1&&A[3].isPoint)return Vq}let z=g(nt),I=z&&z(nt);return{c(){he=Er("div"),I&&I.c(),j=zi(),m=Er("img"),Mm(m.src,o="4\uBD84\uC74C\uD45C(1).svg")||Wn(m,"src",o),Wn(m,"alt",""),Qn(m,"height","64px"),Wn(m,"class","noteImage"),Qn(he,"display","inline-block"),Qn(he,"margin-right","3.22px"),Qn(he,"position","relative"),Qn(he,"bottom",nt[0]-18+"px"),Qn(he,"z-index","3"),Wn(he,"data-note",nt[1]),Wn(he,"data-beat",nt[2])},m(A,X){vi(A,he,X),I&&I.m(he,null),vr(he,j),vr(he,m)},p(A,[X]){z!==(z=g(A))&&(I&&I.d(1),I=z&&z(A),I&&(I.c(),I.m(he,j))),X&1&&Qn(he,"bottom",A[0]-18+"px"),X&2&&Wn(he,"data-note",A[1]),X&4&&Wn(he,"data-beat",A[2])},i:bs,o:bs,d(A){A&&gi(he),I&&I.d()}}}function Gq(nt,he,j){let{bottom:m}=he,{note:o}=he,{beat:g}=he,{point:z}=he;return nt.$$set=I=>{"bottom"in I&&j(0,m=I.bottom),"note"in I&&j(1,o=I.note),"beat"in I&&j(2,g=I.beat),"point"in I&&j(3,z=I.point)},[m,o,g,z]}class aS extends Lp{constructor(he){super(),Pp(this,he,Gq,Hq,Bp,{bottom:0,note:1,beat:2,point:3})}}function $q(nt){let he;return{c(){he=Er("div"),he.textContent=".",Qn(he,"position","absolute"),Qn(he,"left","30px"),Qn(he,"bottom","17px"),Qn(he,"font-size","50px")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function Kq(nt){let he;return{c(){he=Er("div"),he.textContent=".",Qn(he,"position","absolute"),Qn(he,"left","23px"),Qn(he,"bottom","11px"),Qn(he,"font-size","50px")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function Xq(nt){let he,j,m,o;function g(A,X){if(A[1]>=-12&&A[1]%2==0&&A[3].isPoint)return Kq;if(A[1]>=-13&&A[1]%2==-1&&A[3].isPoint||A[1]>=-13&&A[1]%2==1&&A[3].isPoint)return $q}let z=g(nt),I=z&&z(nt);return{c(){he=Er("div"),I&&I.c(),j=zi(),m=Er("img"),Mm(m.src,o="8\uBD84\uC74C\uD45C(1).svg")||Wn(m,"src",o),Wn(m,"alt",""),Qn(m,"height","63px"),Wn(m,"class","noteImage"),Qn(he,"display","inline-block"),Qn(he,"margin-right","-8px"),Qn(he,"position","relative"),Qn(he,"bottom",nt[0]-17+"px"),Qn(he,"z-index","3"),Wn(he,"data-note",nt[1]),Wn(he,"data-beat",nt[2])},m(A,X){vi(A,he,X),I&&I.m(he,null),vr(he,j),vr(he,m)},p(A,[X]){z!==(z=g(A))&&(I&&I.d(1),I=z&&z(A),I&&(I.c(),I.m(he,j))),X&1&&Qn(he,"bottom",A[0]-17+"px"),X&2&&Wn(he,"data-note",A[1]),X&4&&Wn(he,"data-beat",A[2])},i:bs,o:bs,d(A){A&&gi(he),I&&I.d()}}}function Yq(nt,he,j){let{bottom:m}=he,{note:o}=he,{beat:g}=he,{point:z}=he;return nt.$$set=I=>{"bottom"in I&&j(0,m=I.bottom),"note"in I&&j(1,o=I.note),"beat"in I&&j(2,g=I.beat),"point"in I&&j(3,z=I.point)},[m,o,g,z]}class sS extends Lp{constructor(he){super(),Pp(this,he,Yq,Xq,Bp,{bottom:0,note:1,beat:2,point:3})}}function Jq(nt){let he;return{c(){he=Er("div"),he.textContent=".",Qn(he,"position","absolute"),Qn(he,"left","23px"),Qn(he,"bottom","3px"),Qn(he,"font-size","50px"),Qn(he,"z-index","1")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function Qq(nt){let he;return{c(){he=Er("div"),he.textContent=".",Qn(he,"position","absolute"),Qn(he,"left","30px"),Qn(he,"bottom","10px"),Qn(he,"font-size","50px"),Qn(he,"z-index","1")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function Zq(nt){let he,j,m,o;function g(A,X){if(A[1]>=-12&&A[1]%2==0&&A[3].isPoint)return Qq;if(A[1]>=-13&&A[1]%2==-1&&A[3].isPoint||A[1]>=-13&&A[1]%2==1&&A[3].isPoint)return Jq}let z=g(nt),I=z&&z(nt);return{c(){he=Er("div"),I&&I.c(),j=zi(),m=Er("img"),Mm(m.src,o="16\uBD84\uC74C\uD45C(1).png")||Wn(m,"src",o),Wn(m,"alt",""),Qn(m,"height","70px"),Qn(m,"position","relative"),Qn(m,"bottom","-13px"),Qn(m,"z-index","0"),Wn(m,"class","noteImage"),Qn(he,"display","inline-block"),Qn(he,"margin-right","-11.62px"),Qn(he,"position","relative"),Qn(he,"bottom",nt[0]-2+"px"),Qn(he,"z-index","4"),Wn(he,"data-note",nt[1]),Wn(he,"data-beat",nt[2])},m(A,X){vi(A,he,X),I&&I.m(he,null),vr(he,j),vr(he,m)},p(A,[X]){z!==(z=g(A))&&(I&&I.d(1),I=z&&z(A),I&&(I.c(),I.m(he,j))),X&1&&Qn(he,"bottom",A[0]-2+"px"),X&2&&Wn(he,"data-note",A[1]),X&4&&Wn(he,"data-beat",A[2])},i:bs,o:bs,d(A){A&&gi(he),I&&I.d()}}}function eH(nt,he,j){let{bottom:m}=he,{note:o}=he,{beat:g}=he,{point:z}=he;return nt.$$set=I=>{"bottom"in I&&j(0,m=I.bottom),"note"in I&&j(1,o=I.note),"beat"in I&&j(2,g=I.beat),"point"in I&&j(3,z=I.point)},[m,o,g,z]}class uS extends Lp{constructor(he){super(),Pp(this,he,eH,Zq,Bp,{bottom:0,note:1,beat:2,point:3})}}function tH(nt){let he;return{c(){he=Er("div"),he.textContent=".",Qn(he,"position","absolute"),Qn(he,"left","23px"),Qn(he,"bottom","17px"),Qn(he,"font-size","50px")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function nH(nt){let he;return{c(){he=Er("div"),he.textContent=".",Qn(he,"position","absolute"),Qn(he,"left","23px"),Qn(he,"bottom","11px"),Qn(he,"font-size","50px")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function rH(nt){let he,j,m,o;function g(A,X){if(A[1]>=-12&&A[1]%2==0&&A[3].isPoint)return nH;if(A[1]>=-13&&A[1]%2==-1&&A[3].isPoint||A[1]>=-13&&A[1]%2==1&&A[3].isPoint)return tH}let z=g(nt),I=z&&z(nt);return{c(){he=Er("div"),I&&I.c(),j=zi(),m=Er("img"),Mm(m.src,o="2\uBD84\uC74C\uD45C(2).svg")||Wn(m,"src",o),Wn(m,"alt",""),Qn(m,"height","63px"),Qn(m,"position","relative"),Qn(m,"bottom","-45px"),Wn(m,"class","noteImage"),Qn(he,"display","inline-block"),Qn(he,"margin-right","3.57px"),Qn(he,"position","relative"),Qn(he,"bottom",nt[0]-17+"px"),Qn(he,"z-index","3"),Wn(he,"data-note",nt[1]),Wn(he,"data-beat",nt[2])},m(A,X){vi(A,he,X),I&&I.m(he,null),vr(he,j),vr(he,m)},p(A,[X]){z!==(z=g(A))&&(I&&I.d(1),I=z&&z(A),I&&(I.c(),I.m(he,j))),X&1&&Qn(he,"bottom",A[0]-17+"px"),X&2&&Wn(he,"data-note",A[1]),X&4&&Wn(he,"data-beat",A[2])},i:bs,o:bs,d(A){A&&gi(he),I&&I.d()}}}function iH(nt,he,j){let{bottom:m}=he,{note:o}=he,{beat:g}=he,{point:z}=he;return nt.$$set=I=>{"bottom"in I&&j(0,m=I.bottom),"note"in I&&j(1,o=I.note),"beat"in I&&j(2,g=I.beat),"point"in I&&j(3,z=I.point)},[m,o,g,z]}class cS extends Lp{constructor(he){super(),Pp(this,he,iH,rH,Bp,{bottom:0,note:1,beat:2,point:3})}}function oH(nt){let he;return{c(){he=Er("div"),he.textContent=".",Qn(he,"position","absolute"),Qn(he,"left","23px"),Qn(he,"bottom","17px"),Qn(he,"font-size","50px")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function aH(nt){let he;return{c(){he=Er("div"),he.textContent=".",Qn(he,"position","absolute"),Qn(he,"left","23px"),Qn(he,"bottom","11px"),Qn(he,"font-size","50px")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function sH(nt){let he,j,m,o;function g(A,X){if(A[1]>=-12&&A[1]%2==0&&A[3].isPoint)return aH;if(A[1]>=-13&&A[1]%2==-1&&A[3].isPoint||A[1]>=-13&&A[1]%2==1&&A[3].isPoint)return oH}let z=g(nt),I=z&&z(nt);return{c(){he=Er("div"),I&&I.c(),j=zi(),m=Er("img"),Mm(m.src,o="4\uBD84\uC74C\uD45C(2).svg")||Wn(m,"src",o),Wn(m,"alt",""),Qn(m,"height","63px"),Qn(m,"position","relative"),Qn(m,"bottom","-45px"),Wn(m,"class","noteImage"),Qn(he,"display","inline-block"),Qn(he,"margin-right","3.57px"),Qn(he,"position","relative"),Qn(he,"bottom",nt[0]-17+"px"),Qn(he,"z-index","3"),Wn(he,"data-note",nt[1]),Wn(he,"data-beat",nt[2])},m(A,X){vi(A,he,X),I&&I.m(he,null),vr(he,j),vr(he,m)},p(A,[X]){z!==(z=g(A))&&(I&&I.d(1),I=z&&z(A),I&&(I.c(),I.m(he,j))),X&1&&Qn(he,"bottom",A[0]-17+"px"),X&2&&Wn(he,"data-note",A[1]),X&4&&Wn(he,"data-beat",A[2])},i:bs,o:bs,d(A){A&&gi(he),I&&I.d()}}}function uH(nt,he,j){let{bottom:m}=he,{note:o}=he,{beat:g}=he,{point:z}=he;return nt.$$set=I=>{"bottom"in I&&j(0,m=I.bottom),"note"in I&&j(1,o=I.note),"beat"in I&&j(2,g=I.beat),"point"in I&&j(3,z=I.point)},[m,o,g,z]}class lS extends Lp{constructor(he){super(),Pp(this,he,uH,sH,Bp,{bottom:0,note:1,beat:2,point:3})}}function cH(nt){let he;return{c(){he=Er("div"),he.textContent=".",Qn(he,"position","absolute"),Qn(he,"left","23px"),Qn(he,"bottom","17px"),Qn(he,"font-size","50px")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function lH(nt){let he;return{c(){he=Er("div"),he.textContent=".",Qn(he,"position","absolute"),Qn(he,"left","23px"),Qn(he,"bottom","11px"),Qn(he,"font-size","50px")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function fH(nt){let he,j,m,o;function g(A,X){if(A[1]>=-12&&A[1]%2==0&&A[3].isPoint)return lH;if(A[1]>=-13&&A[1]%2==-1&&A[3].isPoint||A[1]>=-13&&A[1]%2==1&&A[3].isPoint)return cH}let z=g(nt),I=z&&z(nt);return{c(){he=Er("div"),I&&I.c(),j=zi(),m=Er("img"),Mm(m.src,o="8\uBD84\uC74C\uD45C(2).svg")||Wn(m,"src",o),Wn(m,"alt",""),Qn(m,"height","67px"),Qn(m,"position","relative"),Qn(m,"bottom","-48px"),Wn(m,"class","noteImage"),Qn(he,"display","inline-block"),Qn(he,"margin-right","3.71px"),Qn(he,"position","relative"),Qn(he,"bottom",nt[0]-17+"px"),Qn(he,"z-index","3"),Wn(he,"data-note",nt[1]),Wn(he,"data-beat",nt[2])},m(A,X){vi(A,he,X),I&&I.m(he,null),vr(he,j),vr(he,m)},p(A,[X]){z!==(z=g(A))&&(I&&I.d(1),I=z&&z(A),I&&(I.c(),I.m(he,j))),X&1&&Qn(he,"bottom",A[0]-17+"px"),X&2&&Wn(he,"data-note",A[1]),X&4&&Wn(he,"data-beat",A[2])},i:bs,o:bs,d(A){A&&gi(he),I&&I.d()}}}function hH(nt,he,j){let{bottom:m}=he,{note:o}=he,{beat:g}=he,{point:z}=he;return nt.$$set=I=>{"bottom"in I&&j(0,m=I.bottom),"note"in I&&j(1,o=I.note),"beat"in I&&j(2,g=I.beat),"point"in I&&j(3,z=I.point)},[m,o,g,z]}class fS extends Lp{constructor(he){super(),Pp(this,he,hH,fH,Bp,{bottom:0,note:1,beat:2,point:3})}}function dH(nt){let he;return{c(){he=Er("div"),he.textContent=".",Qn(he,"position","absolute"),Qn(he,"left","23px"),Qn(he,"bottom","17px"),Qn(he,"font-size","50px")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function pH(nt){let he;return{c(){he=Er("div"),he.textContent=".",Qn(he,"position","absolute"),Qn(he,"left","23px"),Qn(he,"bottom","11px"),Qn(he,"font-size","50px")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function mH(nt){let he,j,m,o;function g(A,X){if(A[1]>=-12&&A[1]%2==0&&A[3].isPoint)return pH;if(A[1]>=-13&&A[1]%2==-1&&A[3].isPoint||A[1]>=-13&&A[1]%2==1&&A[3].isPoint)return dH}let z=g(nt),I=z&&z(nt);return{c(){he=Er("div"),I&&I.c(),j=zi(),m=Er("img"),Mm(m.src,o="16\uBD84\uC74C\uD45C(2).svg")||Wn(m,"src",o),Wn(m,"alt",""),Qn(m,"height","65px"),Qn(m,"position","relative"),Qn(m,"bottom","-46px"),Wn(m,"class","noteImage"),Qn(he,"display","inline-block"),Qn(he,"margin-right","4.35px"),Qn(he,"position","relative"),Qn(he,"bottom",nt[0]-2+"px"),Qn(he,"z-index","3"),Wn(he,"data-note",nt[1]),Wn(he,"data-beat",nt[2])},m(A,X){vi(A,he,X),I&&I.m(he,null),vr(he,j),vr(he,m)},p(A,[X]){z!==(z=g(A))&&(I&&I.d(1),I=z&&z(A),I&&(I.c(),I.m(he,j))),X&1&&Qn(he,"bottom",A[0]-2+"px"),X&2&&Wn(he,"data-note",A[1]),X&4&&Wn(he,"data-beat",A[2])},i:bs,o:bs,d(A){A&&gi(he),I&&I.d()}}}function gH(nt,he,j){let{bottom:m}=he,{note:o}=he,{beat:g}=he,{point:z}=he;return nt.$$set=I=>{"bottom"in I&&j(0,m=I.bottom),"note"in I&&j(1,o=I.note),"beat"in I&&j(2,g=I.beat),"point"in I&&j(3,z=I.point)},[m,o,g,z]}class hS extends Lp{constructor(he){super(),Pp(this,he,gH,mH,Bp,{bottom:0,note:1,beat:2,point:3})}}function vH(nt){let he;return{c(){he=Er("div"),he.innerHTML=`<div class="plusLine svelte-17frcqj" style="top: 254px;"></div> 
        <div class="plusLine svelte-17frcqj" style="top: 270px;"></div>`,Wn(he,"class","plContainer svelte-17frcqj")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function yH(nt){let he;return{c(){he=Er("div"),he.innerHTML='<div class="plusLine svelte-17frcqj" style="top: 254px;"></div>',Wn(he,"class","plContainer svelte-17frcqj")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function bH(nt){let he;return{c(){he=Er("div"),he.innerHTML=`<div class="plusLine svelte-17frcqj" style="top: 22px;"></div> 
        <div class="plusLine svelte-17frcqj" style="top: 6px;"></div>`,Wn(he,"class","plContainer svelte-17frcqj")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function xH(nt){let he;return{c(){he=Er("div"),he.innerHTML='<div class="plusLine svelte-17frcqj" style="top: 22px;"></div>',Wn(he,"class","plContainer svelte-17frcqj")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function wH(nt){let he;return{c(){he=Er("div"),he.innerHTML=`<div class="plusLine svelte-17frcqj" style="top: 120px;"></div> 
        <div class="plusLine svelte-17frcqj" style="top: 136px;"></div>`,Wn(he,"class","plContainer svelte-17frcqj")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function kH(nt){let he;return{c(){he=Er("div"),he.innerHTML='<div class="plusLine svelte-17frcqj" style="top: 120px;"></div>',Wn(he,"class","plContainer svelte-17frcqj")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function vM(nt){let he;function j(g,z){return g[0]>=9?AH:g[7][g[0]-1]>=27?CH:g[0]<1?EH:_H}let m=j(nt),o=m(nt);return{c(){o.c(),he=vd()},m(g,z){o.m(g,z),vi(g,he,z)},p(g,z){m===(m=j(g))&&o?o.p(g,z):(o.d(1),o=m(g),o&&(o.c(),o.m(he.parentNode,he)))},d(g){o.d(g),g&&gi(he)}}}function _H(nt){let he,j;return{c(){he=Er("div"),j=Du("\u266F"),Wn(he,"class","sharps svelte-17frcqj"),Qn(he,"left",nt[8]+"px"),Qn(he,"bottom",nt[7][nt[0]-1]+11-20+"px")},m(m,o){vi(m,he,o),vr(he,j)},p(m,o){o&1&&Qn(he,"bottom",m[7][m[0]-1]+11-20+"px")},d(m){m&&gi(he)}}}function EH(nt){let he;function j(g,z){return g[0]<-1?SH:OH}let m=j(nt),o=m(nt);return{c(){o.c(),he=vd()},m(g,z){o.m(g,z),vi(g,he,z)},p(g,z){m===(m=j(g))&&o?o.p(g,z):(o.d(1),o=m(g),o&&(o.c(),o.m(he.parentNode,he)))},d(g){o.d(g),g&&gi(he)}}}function CH(nt){let he,j;return{c(){he=Er("div"),j=Du("\u266F"),Wn(he,"class","sharps svelte-17frcqj"),Qn(he,"left",nt[8]+"px"),Qn(he,"bottom",nt[7][nt[0]-1]+12-20+"px")},m(m,o){vi(m,he,o),vr(he,j)},p(m,o){o&1&&Qn(he,"bottom",m[7][m[0]-1]+12-20+"px")},d(m){m&&gi(he)}}}function AH(nt){let he,j;return{c(){he=Er("div"),j=Du("\u266F"),Wn(he,"class","sharps svelte-17frcqj"),Qn(he,"left",nt[8]+"px"),Qn(he,"bottom",35+nt[0]%8*8+13-20+"px")},m(m,o){vi(m,he,o),vr(he,j)},p(m,o){o&1&&Qn(he,"bottom",35+m[0]%8*8+13-20+"px")},d(m){m&&gi(he)}}}function OH(nt){let he,j;return{c(){he=Er("div"),j=Du("\u266F"),Wn(he,"class","sharps svelte-17frcqj"),Qn(he,"left",nt[8]+"px"),Qn(he,"bottom",-21-8*(1-nt[0])+11-20+"px")},m(m,o){vi(m,he,o),vr(he,j)},p(m,o){o&1&&Qn(he,"bottom",-21-8*(1-m[0])+11-20+"px")},d(m){m&&gi(he)}}}function SH(nt){let he;function j(g,z){return g[0]>=-5?TH:DH}let m=j(nt),o=m(nt);return{c(){o.c(),he=vd()},m(g,z){o.m(g,z),vi(g,he,z)},p(g,z){m===(m=j(g))&&o?o.p(g,z):(o.d(1),o=m(g),o&&(o.c(),o.m(he.parentNode,he)))},d(g){o.d(g),g&&gi(he)}}}function DH(nt){let he,j;return{c(){he=Er("div"),j=Du("\u266F"),Wn(he,"class","sharps svelte-17frcqj"),Qn(he,"left",nt[8]+"px"),Qn(he,"bottom",-21-8*(1-nt[0])-27-20+"px")},m(m,o){vi(m,he,o),vr(he,j)},p(m,o){o&1&&Qn(he,"bottom",-21-8*(1-m[0])-27-20+"px")},d(m){m&&gi(he)}}}function TH(nt){let he,j;return{c(){he=Er("div"),j=Du("\u266F"),Wn(he,"class","sharps svelte-17frcqj"),Qn(he,"left",nt[8]+"px"),Qn(he,"bottom",-21-8*(1-nt[0])-25-20+"px")},m(m,o){vi(m,he,o),vr(he,j)},p(m,o){o&1&&Qn(he,"bottom",-21-8*(1-m[0])-25-20+"px")},d(m){m&&gi(he)}}}function yM(nt){let he,j,m,o;const g=[RH,FH,IH,NH],z=[];function I(A,X){return A[0]>=9?0:A[7][A[0]-1]>=27?1:A[0]<1?2:3}return he=I(nt),j=z[he]=g[he](nt),{c(){j.c(),m=vd()},m(A,X){z[he].m(A,X),vi(A,m,X),o=!0},p(A,X){let K=he;he=I(A),he===K?z[he].p(A,X):(Sl(),Ii(z[K],1,1,()=>{z[K]=null}),Dl(),j=z[he],j?j.p(A,X):(j=z[he]=g[he](A),j.c()),Ci(j,1),j.m(m.parentNode,m))},i(A){o||(Ci(j),o=!0)},o(A){Ii(j),o=!1},d(A){z[he].d(A),A&&gi(m)}}}function NH(nt){let he,j;return he=new Hb({props:{bottom:nt[7][nt[0]-1],note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=m[7][m[0]-1]),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function IH(nt){let he,j,m,o;const g=[jH,MH],z=[];function I(A,X){return A[0]<-1?0:1}return he=I(nt),j=z[he]=g[he](nt),{c(){j.c(),m=vd()},m(A,X){z[he].m(A,X),vi(A,m,X),o=!0},p(A,X){let K=he;he=I(A),he===K?z[he].p(A,X):(Sl(),Ii(z[K],1,1,()=>{z[K]=null}),Dl(),j=z[he],j?j.p(A,X):(j=z[he]=g[he](A),j.c()),Ci(j,1),j.m(m.parentNode,m))},i(A){o||(Ci(j),o=!0)},o(A){Ii(j),o=!1},d(A){z[he].d(A),A&&gi(m)}}}function FH(nt){let he,j;return he=new Hb({props:{bottom:nt[7][nt[0]-1]+1,note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=m[7][m[0]-1]+1),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function RH(nt){let he,j;return he=new Hb({props:{bottom:35+nt[0]%8*8+2,note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=35+m[0]%8*8+2),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function MH(nt){let he,j;return he=new Hb({props:{bottom:-21-8*(1-nt[0]),note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=-21-8*(1-m[0])),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function jH(nt){let he,j,m,o;const g=[PH,BH],z=[];function I(A,X){return A[0]>=-5?0:1}return he=I(nt),j=z[he]=g[he](nt),{c(){j.c(),m=vd()},m(A,X){z[he].m(A,X),vi(A,m,X),o=!0},p(A,X){let K=he;he=I(A),he===K?z[he].p(A,X):(Sl(),Ii(z[K],1,1,()=>{z[K]=null}),Dl(),j=z[he],j?j.p(A,X):(j=z[he]=g[he](A),j.c()),Ci(j,1),j.m(m.parentNode,m))},i(A){o||(Ci(j),o=!0)},o(A){Ii(j),o=!1},d(A){z[he].d(A),A&&gi(m)}}}function BH(nt){let he,j;return he=new Hb({props:{bottom:-21-8*(1-nt[0])-37,note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=-21-8*(1-m[0])-37),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function PH(nt){let he,j;return he=new Hb({props:{bottom:-21-8*(1-nt[0])-34,note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=-21-8*(1-m[0])-34),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function bM(nt){let he,j,m,o;const g=[WH,UH,zH,LH],z=[];function I(A,X){return A[0]>=9?0:A[7][A[0]-1]>=27?1:A[0]<1?2:3}return he=I(nt),j=z[he]=g[he](nt),{c(){j.c(),m=vd()},m(A,X){z[he].m(A,X),vi(A,m,X),o=!0},p(A,X){let K=he;he=I(A),he===K?z[he].p(A,X):(Sl(),Ii(z[K],1,1,()=>{z[K]=null}),Dl(),j=z[he],j?j.p(A,X):(j=z[he]=g[he](A),j.c()),Ci(j,1),j.m(m.parentNode,m))},i(A){o||(Ci(j),o=!0)},o(A){Ii(j),o=!1},d(A){z[he].d(A),A&&gi(m)}}}function LH(nt){let he,j;return he=new oS({props:{bottom:nt[7][nt[0]-1],note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=m[7][m[0]-1]),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function zH(nt){let he,j,m,o;const g=[qH,VH],z=[];function I(A,X){return A[0]<-1?0:1}return he=I(nt),j=z[he]=g[he](nt),{c(){j.c(),m=vd()},m(A,X){z[he].m(A,X),vi(A,m,X),o=!0},p(A,X){let K=he;he=I(A),he===K?z[he].p(A,X):(Sl(),Ii(z[K],1,1,()=>{z[K]=null}),Dl(),j=z[he],j?j.p(A,X):(j=z[he]=g[he](A),j.c()),Ci(j,1),j.m(m.parentNode,m))},i(A){o||(Ci(j),o=!0)},o(A){Ii(j),o=!1},d(A){z[he].d(A),A&&gi(m)}}}function UH(nt){let he,j;return he=new cS({props:{bottom:nt[7][nt[0]-1],note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=m[7][m[0]-1]),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function WH(nt){let he,j;return he=new cS({props:{bottom:35+nt[0]%8*8+1,note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=35+m[0]%8*8+1),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function VH(nt){let he,j;return he=new oS({props:{bottom:-21-8*(1-nt[0]),note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=-21-8*(1-m[0])),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function qH(nt){let he,j,m,o;const g=[GH,HH],z=[];function I(A,X){return A[0]>=-5?0:1}return he=I(nt),j=z[he]=g[he](nt),{c(){j.c(),m=vd()},m(A,X){z[he].m(A,X),vi(A,m,X),o=!0},p(A,X){let K=he;he=I(A),he===K?z[he].p(A,X):(Sl(),Ii(z[K],1,1,()=>{z[K]=null}),Dl(),j=z[he],j?j.p(A,X):(j=z[he]=g[he](A),j.c()),Ci(j,1),j.m(m.parentNode,m))},i(A){o||(Ci(j),o=!0)},o(A){Ii(j),o=!1},d(A){z[he].d(A),A&&gi(m)}}}function HH(nt){let he,j;return he=new oS({props:{bottom:-21-8*(1-nt[0])-37,note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=-21-8*(1-m[0])-37),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function GH(nt){let he,j;return he=new cS({props:{bottom:-21-8*(1-nt[0])-35,note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=-21-8*(1-m[0])-35),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function xM(nt){let he,j,m,o;const g=[YH,XH,KH,$H],z=[];function I(A,X){return A[0]>=9?0:A[7][A[0]-1]>=27?1:A[0]<1?2:3}return he=I(nt),j=z[he]=g[he](nt),{c(){j.c(),m=vd()},m(A,X){z[he].m(A,X),vi(A,m,X),o=!0},p(A,X){let K=he;he=I(A),he===K?z[he].p(A,X):(Sl(),Ii(z[K],1,1,()=>{z[K]=null}),Dl(),j=z[he],j?j.p(A,X):(j=z[he]=g[he](A),j.c()),Ci(j,1),j.m(m.parentNode,m))},i(A){o||(Ci(j),o=!0)},o(A){Ii(j),o=!1},d(A){z[he].d(A),A&&gi(m)}}}function $H(nt){let he,j;return he=new aS({props:{bottom:nt[7][nt[0]-1],note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=m[7][m[0]-1]),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function KH(nt){let he,j,m,o;const g=[QH,JH],z=[];function I(A,X){return A[0]<-1?0:1}return he=I(nt),j=z[he]=g[he](nt),{c(){j.c(),m=vd()},m(A,X){z[he].m(A,X),vi(A,m,X),o=!0},p(A,X){let K=he;he=I(A),he===K?z[he].p(A,X):(Sl(),Ii(z[K],1,1,()=>{z[K]=null}),Dl(),j=z[he],j?j.p(A,X):(j=z[he]=g[he](A),j.c()),Ci(j,1),j.m(m.parentNode,m))},i(A){o||(Ci(j),o=!0)},o(A){Ii(j),o=!1},d(A){z[he].d(A),A&&gi(m)}}}function XH(nt){let he,j;return he=new lS({props:{bottom:nt[7][nt[0]-1],note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=m[7][m[0]-1]),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function YH(nt){let he,j;return he=new lS({props:{bottom:35+nt[0]%8*8+1,note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=35+m[0]%8*8+1),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function JH(nt){let he,j;return he=new aS({props:{bottom:-21-8*(1-nt[0]),note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=-21-8*(1-m[0])),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function QH(nt){let he,j,m,o;const g=[eG,ZH],z=[];function I(A,X){return A[0]>=-5?0:1}return he=I(nt),j=z[he]=g[he](nt),{c(){j.c(),m=vd()},m(A,X){z[he].m(A,X),vi(A,m,X),o=!0},p(A,X){let K=he;he=I(A),he===K?z[he].p(A,X):(Sl(),Ii(z[K],1,1,()=>{z[K]=null}),Dl(),j=z[he],j?j.p(A,X):(j=z[he]=g[he](A),j.c()),Ci(j,1),j.m(m.parentNode,m))},i(A){o||(Ci(j),o=!0)},o(A){Ii(j),o=!1},d(A){z[he].d(A),A&&gi(m)}}}function ZH(nt){let he,j;return he=new aS({props:{bottom:-21-8*(1-nt[0])-36,note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=-21-8*(1-m[0])-36),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function eG(nt){let he,j;return he=new lS({props:{bottom:-21-8*(1-nt[0])-35,note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=-21-8*(1-m[0])-35),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function wM(nt){let he,j,m,o;const g=[iG,rG,nG,tG],z=[];function I(A,X){return A[0]>=9?0:A[7][A[0]-1]>=27?1:A[0]<1?2:3}return he=I(nt),j=z[he]=g[he](nt),{c(){j.c(),m=vd()},m(A,X){z[he].m(A,X),vi(A,m,X),o=!0},p(A,X){let K=he;he=I(A),he===K?z[he].p(A,X):(Sl(),Ii(z[K],1,1,()=>{z[K]=null}),Dl(),j=z[he],j?j.p(A,X):(j=z[he]=g[he](A),j.c()),Ci(j,1),j.m(m.parentNode,m))},i(A){o||(Ci(j),o=!0)},o(A){Ii(j),o=!1},d(A){z[he].d(A),A&&gi(m)}}}function tG(nt){let he,j;return he=new sS({props:{bottom:nt[7][nt[0]-1],note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=m[7][m[0]-1]),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function nG(nt){let he,j,m,o;const g=[aG,oG],z=[];function I(A,X){return A[0]<-1?0:1}return he=I(nt),j=z[he]=g[he](nt),{c(){j.c(),m=vd()},m(A,X){z[he].m(A,X),vi(A,m,X),o=!0},p(A,X){let K=he;he=I(A),he===K?z[he].p(A,X):(Sl(),Ii(z[K],1,1,()=>{z[K]=null}),Dl(),j=z[he],j?j.p(A,X):(j=z[he]=g[he](A),j.c()),Ci(j,1),j.m(m.parentNode,m))},i(A){o||(Ci(j),o=!0)},o(A){Ii(j),o=!1},d(A){z[he].d(A),A&&gi(m)}}}function rG(nt){let he,j;return he=new fS({props:{bottom:nt[7][nt[0]-1],note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=m[7][m[0]-1]),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function iG(nt){let he,j;return he=new fS({props:{bottom:35+nt[0]%8*8+1,note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=35+m[0]%8*8+1),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function oG(nt){let he,j;return he=new sS({props:{bottom:-21-8*(1-nt[0]),note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=-21-8*(1-m[0])),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function aG(nt){let he,j,m,o;const g=[uG,sG],z=[];function I(A,X){return A[0]>=-5?0:1}return he=I(nt),j=z[he]=g[he](nt),{c(){j.c(),m=vd()},m(A,X){z[he].m(A,X),vi(A,m,X),o=!0},p(A,X){let K=he;he=I(A),he===K?z[he].p(A,X):(Sl(),Ii(z[K],1,1,()=>{z[K]=null}),Dl(),j=z[he],j?j.p(A,X):(j=z[he]=g[he](A),j.c()),Ci(j,1),j.m(m.parentNode,m))},i(A){o||(Ci(j),o=!0)},o(A){Ii(j),o=!1},d(A){z[he].d(A),A&&gi(m)}}}function sG(nt){let he,j;return he=new sS({props:{bottom:-21-8*(1-nt[0])-37,note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=-21-8*(1-m[0])-37),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function uG(nt){let he,j;return he=new fS({props:{bottom:-21-8*(1-nt[0])-36,note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=-21-8*(1-m[0])-36),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function kM(nt){let he,j,m,o;const g=[hG,fG,lG,cG],z=[];function I(A,X){return A[0]>=9?0:A[7][A[0]-1]>=27?1:A[0]<1?2:3}return he=I(nt),j=z[he]=g[he](nt),{c(){j.c(),m=vd()},m(A,X){z[he].m(A,X),vi(A,m,X),o=!0},p(A,X){let K=he;he=I(A),he===K?z[he].p(A,X):(Sl(),Ii(z[K],1,1,()=>{z[K]=null}),Dl(),j=z[he],j?j.p(A,X):(j=z[he]=g[he](A),j.c()),Ci(j,1),j.m(m.parentNode,m))},i(A){o||(Ci(j),o=!0)},o(A){Ii(j),o=!1},d(A){z[he].d(A),A&&gi(m)}}}function cG(nt){let he,j;return he=new uS({props:{bottom:nt[7][nt[0]-1]-2,note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=m[7][m[0]-1]-2),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function lG(nt){let he,j,m,o;const g=[pG,dG],z=[];function I(A,X){return A[0]<-1?0:1}return he=I(nt),j=z[he]=g[he](nt),{c(){j.c(),m=vd()},m(A,X){z[he].m(A,X),vi(A,m,X),o=!0},p(A,X){let K=he;he=I(A),he===K?z[he].p(A,X):(Sl(),Ii(z[K],1,1,()=>{z[K]=null}),Dl(),j=z[he],j?j.p(A,X):(j=z[he]=g[he](A),j.c()),Ci(j,1),j.m(m.parentNode,m))},i(A){o||(Ci(j),o=!0)},o(A){Ii(j),o=!1},d(A){z[he].d(A),A&&gi(m)}}}function fG(nt){let he,j;return he=new hS({props:{bottom:nt[7][nt[0]-1]-15,note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=m[7][m[0]-1]-15),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function hG(nt){let he,j;return he=new hS({props:{bottom:35+nt[0]%8*8+1-16,note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=35+m[0]%8*8+1-16),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function dG(nt){let he,j;return he=new uS({props:{bottom:-21-8*(1-nt[0])-1,note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=-21-8*(1-m[0])-1),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function pG(nt){let he,j,m,o;const g=[gG,mG],z=[];function I(A,X){return A[0]>=-5?0:1}return he=I(nt),j=z[he]=g[he](nt),{c(){j.c(),m=vd()},m(A,X){z[he].m(A,X),vi(A,m,X),o=!0},p(A,X){let K=he;he=I(A),he===K?z[he].p(A,X):(Sl(),Ii(z[K],1,1,()=>{z[K]=null}),Dl(),j=z[he],j?j.p(A,X):(j=z[he]=g[he](A),j.c()),Ci(j,1),j.m(m.parentNode,m))},i(A){o||(Ci(j),o=!0)},o(A){Ii(j),o=!1},d(A){z[he].d(A),A&&gi(m)}}}function mG(nt){let he,j;return he=new uS({props:{bottom:-21-8*(1-nt[0])-39,note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=-21-8*(1-m[0])-39),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function gG(nt){let he,j;return he=new hS({props:{bottom:-21-8*(1-nt[0])-51,note:nt[0],beat:nt[1],point:nt[5]}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o&1&&(g.bottom=-21-8*(1-m[0])-51),o&1&&(g.note=m[0]),o&2&&(g.beat=m[1]),o&32&&(g.point=m[5]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function vG(nt){let he,j,m,o,g,z,I,A,X,K,M;function V(pe,Oe){if(pe[0]==1||pe[0]==0)return kH;if(pe[0]==-1)return wH;if(pe[0]==13||pe[0]==14)return xH;if(pe[0]==15)return bH;if(pe[0]==-11||pe[0]==-12)return yH;if(pe[0]==-13)return vH}let $=V(nt),W=$&&$(nt),te=nt[3]&&vM(nt),F=nt[1]===1&&yM(nt),ue=nt[1]===2&&bM(nt),se=nt[1]===4&&xM(nt),J=nt[1]===8&&wM(nt),me=nt[1]===16&&kM(nt);return{c(){he=Er("div"),W&&W.c(),j=zi(),te&&te.c(),m=zi(),F&&F.c(),o=zi(),ue&&ue.c(),g=zi(),se&&se.c(),z=zi(),J&&J.c(),I=zi(),me&&me.c(),A=zi(),X=Er("div"),Qn(X,"display","none"),Wn(he,"class","noteContainer svelte-17frcqj"),Wn(he,"data-id",nt[2]),Wn(he,"data-beat",K=nt[5].isPoint?nt[4]*3/2:nt[4])},m(pe,Oe){vi(pe,he,Oe),W&&W.m(he,null),vr(he,j),te&&te.m(he,null),vr(he,m),F&&F.m(he,null),vr(he,o),ue&&ue.m(he,null),vr(he,g),se&&se.m(he,null),vr(he,z),J&&J.m(he,null),vr(he,I),me&&me.m(he,null),vr(he,A),vr(he,X),nt[10](he),M=!0},p(pe,[Oe]){$!==($=V(pe))&&(W&&W.d(1),W=$&&$(pe),W&&(W.c(),W.m(he,j))),pe[3]?te?te.p(pe,Oe):(te=vM(pe),te.c(),te.m(he,m)):te&&(te.d(1),te=null),pe[1]===1?F?(F.p(pe,Oe),Oe&2&&Ci(F,1)):(F=yM(pe),F.c(),Ci(F,1),F.m(he,o)):F&&(Sl(),Ii(F,1,1,()=>{F=null}),Dl()),pe[1]===2?ue?(ue.p(pe,Oe),Oe&2&&Ci(ue,1)):(ue=bM(pe),ue.c(),Ci(ue,1),ue.m(he,g)):ue&&(Sl(),Ii(ue,1,1,()=>{ue=null}),Dl()),pe[1]===4?se?(se.p(pe,Oe),Oe&2&&Ci(se,1)):(se=xM(pe),se.c(),Ci(se,1),se.m(he,z)):se&&(Sl(),Ii(se,1,1,()=>{se=null}),Dl()),pe[1]===8?J?(J.p(pe,Oe),Oe&2&&Ci(J,1)):(J=wM(pe),J.c(),Ci(J,1),J.m(he,I)):J&&(Sl(),Ii(J,1,1,()=>{J=null}),Dl()),pe[1]===16?me?(me.p(pe,Oe),Oe&2&&Ci(me,1)):(me=kM(pe),me.c(),Ci(me,1),me.m(he,A)):me&&(Sl(),Ii(me,1,1,()=>{me=null}),Dl()),(!M||Oe&4)&&Wn(he,"data-id",pe[2]),(!M||Oe&48&&K!==(K=pe[5].isPoint?pe[4]*3/2:pe[4]))&&Wn(he,"data-beat",K)},i(pe){M||(Ci(F),Ci(ue),Ci(se),Ci(J),Ci(me),M=!0)},o(pe){Ii(F),Ii(ue),Ii(se),Ii(J),Ii(me),M=!1},d(pe){pe&&gi(he),W&&W.d(),te&&te.d(),F&&F.d(),ue&&ue.d(),se&&se.d(),J&&J.d(),me&&me.d(),nt[10](null)}}}function yG(nt,he,j){let m=[-21,-13,-5,3,11,19,27,35],{heightNum:o}=he,{noteNum:g}=he,{noteId:z}=he,{sharp:I}=he,{realBeat:A}=he,{notes:X}=he,{point:K}=he,M;X.forEach(F=>{F.indexOf(z)>-1&&(M=X.indexOf(F))});let V=(M+1)*59.61-74;const $=iS();let W;rS(()=>{j(6,W.oncontextmenu=F=>$("send",[W,{x:F.clientX,y:F.clientY}]),W),j(6,W.onwheel=F=>$("send",[W,F.wheelDeltaY,F.target]),W),j(6,W.ondragstart=F=>$("send",[W]),W),j(6,W.onclick=F=>$("send",W),W)});function te(F){Rc[F?"unshift":"push"](()=>{W=F,j(6,W)})}return nt.$$set=F=>{"heightNum"in F&&j(0,o=F.heightNum),"noteNum"in F&&j(1,g=F.noteNum),"noteId"in F&&j(2,z=F.noteId),"sharp"in F&&j(3,I=F.sharp),"realBeat"in F&&j(4,A=F.realBeat),"notes"in F&&j(9,X=F.notes),"point"in F&&j(5,K=F.point)},[o,g,z,I,A,K,W,m,V,X,te]}class bG extends Lp{constructor(he){super(),Pp(this,he,yG,vG,Bp,{heightNum:0,noteNum:1,noteId:2,sharp:3,realBeat:4,notes:9,point:5})}}function xG(nt){let he,j;return{c(){he=Er("img"),Mm(he.src,j="/44\uAE30\uD638.svg")||Wn(he,"src",j),Wn(he,"alt",""),Qn(he,"position","absolute"),Qn(he,"left","90px"),Qn(he,"top",nt[0]+"px"),Qn(he,"height","33px")},m(m,o){vi(m,he,o)},p(m,[o]){o&1&&Qn(he,"top",m[0]+"px")},i:bs,o:bs,d(m){m&&gi(he)}}}function wG(nt,he,j){let{top:m}=he;return nt.$$set=o=>{"top"in o&&j(0,m=o.top)},[m]}class RM extends Lp{constructor(he){super(),Pp(this,he,wG,xG,Bp,{top:0})}}function kG(nt){let he,j,m;return{c(){he=Er("div"),j=Er("img"),Mm(j.src,m="22\uAE30\uD638.svg")||Wn(j,"src",m),Wn(j,"alt",""),Qn(j,"height","44px"),Qn(he,"position","absolute"),Qn(he,"left","90px"),Qn(he,"bottom",nt[0]+"px")},m(o,g){vi(o,he,g),vr(he,j)},p(o,[g]){g&1&&Qn(he,"bottom",o[0]+"px")},i:bs,o:bs,d(o){o&&gi(he)}}}function _G(nt,he,j){let{btm:m}=he;return nt.$$set=o=>{"btm"in o&&j(0,m=o.btm)},[m]}class MM extends Lp{constructor(he){super(),Pp(this,he,_G,kG,Bp,{btm:0})}}var z2=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function EG(nt){return nt&&nt.__esModule&&Object.prototype.hasOwnProperty.call(nt,"default")?nt.default:nt}var jM={exports:{}};(function(nt,he){(function(j,m){nt.exports=m()})(window,function(){return function(j){var m={};function o(g){if(m[g])return m[g].exports;var z=m[g]={i:g,l:!1,exports:{}};return j[g].call(z.exports,z,z.exports,o),z.l=!0,z.exports}return o.m=j,o.c=m,o.d=function(g,z,I){o.o(g,z)||Object.defineProperty(g,z,{configurable:!1,enumerable:!0,get:I})},o.r=function(g){Object.defineProperty(g,"__esModule",{value:!0})},o.n=function(g){var z=g&&g.__esModule?function(){return g.default}:function(){return g};return o.d(z,"a",z),z},o.o=function(g,z){return Object.prototype.hasOwnProperty.call(g,z)},o.p="/",o(o.s=581)}([function(j,m,o){o.r(m),function(g,z,I,A){o.d(m,"AdadeltaOptimizer",function(){return it}),o.d(m,"AdagradOptimizer",function(){return ht}),o.d(m,"AdamOptimizer",function(){return Et}),o.d(m,"AdamaxOptimizer",function(){return At}),o.d(m,"Add",function(){return go}),o.d(m,"AddN",function(){return Ca}),o.d(m,"BroadcastTo",function(){return Df}),o.d(m,"DataStorage",function(){return qt}),o.d(m,"Div",function(){return Eo}),o.d(m,"ENV",function(){return te}),o.d(m,"Environment",function(){return $}),o.d(m,"FromPixels",function(){return Dg}),o.d(m,"FusedBatchNorm",function(){return za}),o.d(m,"Identity",function(){return Tf}),o.d(m,"KernelBackend",function(){return Jt}),o.d(m,"MaxPoolWithArgmax",function(){return eh}),o.d(m,"MomentumOptimizer",function(){return Gt}),o.d(m,"NonMaxSuppressionV5",function(){return Fl}),o.d(m,"OneHot",function(){return af}),o.d(m,"Optimizer",function(){return rt}),o.d(m,"PadV2",function(){return ma}),o.d(m,"RMSPropOptimizer",function(){return un}),o.d(m,"Rank",function(){return xe}),o.d(m,"Reduction",function(){return au}),o.d(m,"SGDOptimizer",function(){return St}),o.d(m,"Square",function(){return Zd}),o.d(m,"SquaredDifference",function(){return Sf}),o.d(m,"Tensor",function(){return $t}),o.d(m,"TensorBuffer",function(){return Gi}),o.d(m,"Tile",function(){return sf}),o.d(m,"Transpose",function(){return Ru}),o.d(m,"Variable",function(){return xt}),o.d(m,"abs",function(){return cu}),o.d(m,"acos",function(){return lc}),o.d(m,"acosh",function(){return Es}),o.d(m,"add",function(){return Ua}),o.d(m,"addN",function(){return Nd}),o.d(m,"addStrict",function(){return cf}),o.d(m,"all",function(){return cm}),o.d(m,"any",function(){return yh}),o.d(m,"argMax",function(){return A0}),o.d(m,"argMin",function(){return tg}),o.d(m,"asin",function(){return uf}),o.d(m,"asinh",function(){return Pc}),o.d(m,"atan",function(){return Bh}),o.d(m,"atan2",function(){return jl}),o.d(m,"atanh",function(){return Ph}),o.d(m,"avgPool",function(){return gp}),o.d(m,"avgPool3d",function(){return $g}),o.d(m,"backend",function(){return Sg}),o.d(m,"backend_util",function(){return bi}),o.d(m,"basicLSTMCell",function(){return S0}),o.d(m,"batchNorm",function(){return hh}),o.d(m,"batchNorm2d",function(){return dh}),o.d(m,"batchNorm3d",function(){return hf}),o.d(m,"batchNorm4d",function(){return to}),o.d(m,"batchNormalization",function(){return Ko}),o.d(m,"batchNormalization2d",function(){return $0}),o.d(m,"batchNormalization3d",function(){return Mf}),o.d(m,"batchNormalization4d",function(){return df}),o.d(m,"batchToSpaceND",function(){return Vp}),o.d(m,"booleanMaskAsync",function(){return m0}),o.d(m,"broadcastTo",function(){return pf}),o.d(m,"browser",function(){return ce}),o.d(m,"buffer",function(){return Ki}),o.d(m,"cast",function(){return qp}),o.d(m,"ceil",function(){return Rl}),o.d(m,"clipByValue",function(){return ep}),o.d(m,"clone",function(){return jf}),o.d(m,"complex",function(){return aa}),o.d(m,"concat",function(){return $a}),o.d(m,"concat1d",function(){return of}),o.d(m,"concat2d",function(){return Wp}),o.d(m,"concat3d",function(){return Mh}),o.d(m,"concat4d",function(){return jh}),o.d(m,"conv1d",function(){return y0}),o.d(m,"conv2d",function(){return rd}),o.d(m,"conv2dTranspose",function(){return Qm}),o.d(m,"conv3d",function(){return b0}),o.d(m,"conv3dTranspose",function(){return Hg}),o.d(m,"cos",function(){return Oc}),o.d(m,"cosh",function(){return th}),o.d(m,"cumsum",function(){return Hp}),o.d(m,"customGrad",function(){return R}),o.d(m,"deprecationWarn",function(){return Qc}),o.d(m,"depthToSpace",function(){return Qf}),o.d(m,"depthwiseConv2d",function(){return qg}),o.d(m,"diag",function(){return ad}),o.d(m,"disableDeprecationWarnings",function(){return No}),o.d(m,"dispose",function(){return Oa}),o.d(m,"disposeVariables",function(){return Yf}),o.d(m,"div",function(){return ts}),o.d(m,"divNoNan",function(){return Gm}),o.d(m,"divStrict",function(){return wr}),o.d(m,"dot",function(){return Gg}),o.d(m,"dropout",function(){return xv}),o.d(m,"elu",function(){return xh}),o.d(m,"enableDebugMode",function(){return Nh}),o.d(m,"enableProdMode",function(){return is}),o.d(m,"engine",function(){return zp}),o.d(m,"env",function(){return W}),o.d(m,"equal",function(){return td}),o.d(m,"equalStrict",function(){return om}),o.d(m,"erf",function(){return Lh}),o.d(m,"exp",function(){return zh}),o.d(m,"expandDims",function(){return nu}),o.d(m,"expm1",function(){return jm}),o.d(m,"eye",function(){return Pf}),o.d(m,"fft",function(){return zf}),o.d(m,"fill",function(){return Nu}),o.d(m,"findBackend",function(){return Yd}),o.d(m,"findBackendFactory",function(){return Up}),o.d(m,"floor",function(){return xd}),o.d(m,"floorDiv",function(){return fu}),o.d(m,"frame",function(){return cg}),o.d(m,"fused",function(){return Ln}),o.d(m,"gather",function(){return um}),o.d(m,"gatherND",function(){return sg}),o.d(m,"gather_util",function(){return bl}),o.d(m,"getBackend",function(){return Tu}),o.d(m,"getGradient",function(){return J}),o.d(m,"getKernel",function(){return se}),o.d(m,"getKernelsForBackend",function(){return me}),o.d(m,"grad",function(){return qh}),o.d(m,"grads",function(){return Cd}),o.d(m,"greater",function(){return Ym}),o.d(m,"greaterEqual",function(){return hp}),o.d(m,"greaterEqualStrict",function(){return dp}),o.d(m,"greaterStrict",function(){return am}),o.d(m,"hammingWindow",function(){return Pd}),o.d(m,"hannWindow",function(){return pm}),o.d(m,"ifft",function(){return pu}),o.d(m,"imag",function(){return Ks}),o.d(m,"image",function(){return tt}),o.d(m,"inTopKAsync",function(){return fg}),o.d(m,"io",function(){return x}),o.d(m,"irfft",function(){return dm}),o.d(m,"isFinite",function(){return rh}),o.d(m,"isInf",function(){return wd}),o.d(m,"isNaN",function(){return Gp}),o.d(m,"keep",function(){return Fh}),o.d(m,"leakyRelu",function(){return yp}),o.d(m,"less",function(){return gf}),o.d(m,"lessEqual",function(){return Uc}),o.d(m,"lessEqualStrict",function(){return K0}),o.d(m,"lessStrict",function(){return Ug}),o.d(m,"linalg",function(){return D}),o.d(m,"linspace",function(){return Jd}),o.d(m,"localResponseNormalization",function(){return hm}),o.d(m,"log",function(){return Ml}),o.d(m,"log1p",function(){return Uh}),o.d(m,"logSigmoid",function(){return Wh}),o.d(m,"logSoftmax",function(){return Je}),o.d(m,"logSumExp",function(){return ng}),o.d(m,"logicalAnd",function(){return zu}),o.d(m,"logicalNot",function(){return lp}),o.d(m,"logicalOr",function(){return ph}),o.d(m,"logicalXor",function(){return Bf}),o.d(m,"losses",function(){return ii}),o.d(m,"matMul",function(){return vf}),o.d(m,"math",function(){return H}),o.d(m,"max",function(){return Kg}),o.d(m,"maxPool",function(){return yf}),o.d(m,"maxPool3d",function(){return Zm}),o.d(m,"maxPoolWithArgmax",function(){return _0}),o.d(m,"maximum",function(){return Ds}),o.d(m,"maximumStrict",function(){return Ro}),o.d(m,"mean",function(){return Lf}),o.d(m,"memory",function(){return tu}),o.d(m,"min",function(){return rg}),o.d(m,"minimum",function(){return yl}),o.d(m,"minimumStrict",function(){return nl}),o.d(m,"mod",function(){return wu}),o.d(m,"modStrict",function(){return Bl}),o.d(m,"moments",function(){return O0}),o.d(m,"movingAverage",function(){return bf}),o.d(m,"mul",function(){return Kt}),o.d(m,"mulStrict",function(){return fc}),o.d(m,"multiRNNCell",function(){return Y0}),o.d(m,"multinomial",function(){return du}),o.d(m,"neg",function(){return Os}),o.d(m,"nextFrame",function(){return On}),o.d(m,"norm",function(){return Yg}),o.d(m,"notEqual",function(){return sm}),o.d(m,"notEqualStrict",function(){return d0}),o.d(m,"oneHot",function(){return mf}),o.d(m,"ones",function(){return Xu}),o.d(m,"onesLike",function(){return Iu}),o.d(m,"op",function(){return Tt}),o.d(m,"outerProduct",function(){return w0}),o.d(m,"pad",function(){return El}),o.d(m,"pad1d",function(){return sl}),o.d(m,"pad2d",function(){return ul}),o.d(m,"pad3d",function(){return rc}),o.d(m,"pad4d",function(){return tm}),o.d(m,"pool",function(){return jd}),o.d(m,"pow",function(){return Mu}),o.d(m,"powStrict",function(){return po}),o.d(m,"prelu",function(){return Cu}),o.d(m,"print",function(){return Ka}),o.d(m,"prod",function(){return lm}),o.d(m,"profile",function(){return Ih}),o.d(m,"rand",function(){return Lg}),o.d(m,"randomGamma",function(){return Xm}),o.d(m,"randomNormal",function(){return zg}),o.d(m,"randomUniform",function(){return im}),o.d(m,"range",function(){return rf}),o.d(m,"ready",function(){return Xd}),o.d(m,"real",function(){return ms}),o.d(m,"reciprocal",function(){return nh}),o.d(m,"registerBackend",function(){return Ec}),o.d(m,"registerGradient",function(){return Oe}),o.d(m,"registerKernel",function(){return pe}),o.d(m,"relu",function(){return ig}),o.d(m,"relu6",function(){return Xg}),o.d(m,"removeBackend",function(){return Tl}),o.d(m,"reshape",function(){return Fu}),o.d(m,"reverse",function(){return Uu}),o.d(m,"reverse1d",function(){return X0}),o.d(m,"reverse2d",function(){return pp}),o.d(m,"reverse3d",function(){return mp}),o.d(m,"reverse4d",function(){return vh}),o.d(m,"rfft",function(){return bp}),o.d(m,"round",function(){return Yu}),o.d(m,"rsqrt",function(){return Vh}),o.d(m,"scalar",function(){return Mr}),o.d(m,"scatterND",function(){return D0}),o.d(m,"scatter_util",function(){return tp}),o.d(m,"selu",function(){return fm}),o.d(m,"separableConv2d",function(){return gh}),o.d(m,"serialization",function(){return Pe}),o.d(m,"setBackend",function(){return Rh}),o.d(m,"setPlatform",function(){return el}),o.d(m,"setdiff1dAsync",function(){return wo}),o.d(m,"sigmoid",function(){return Ss}),o.d(m,"sign",function(){return lu}),o.d(m,"signal",function(){return lg}),o.d(m,"sin",function(){return $p}),o.d(m,"sinh",function(){return kd}),o.d(m,"slice",function(){return Eu}),o.d(m,"slice1d",function(){return E0}),o.d(m,"slice2d",function(){return vp}),o.d(m,"slice3d",function(){return C0}),o.d(m,"slice4d",function(){return eg}),o.d(m,"slice_util",function(){return Ed}),o.d(m,"softmax",function(){return Ue}),o.d(m,"softplus",function(){return ln}),o.d(m,"spaceToBatchND",function(){return Zf}),o.d(m,"sparseToDense",function(){return T0}),o.d(m,"spectral",function(){return ag}),o.d(m,"split",function(){return _o}),o.d(m,"sqrt",function(){return Ju}),o.d(m,"square",function(){return ed}),o.d(m,"squaredDifference",function(){return fp}),o.d(m,"squaredDifferenceStrict",function(){return uo}),o.d(m,"squeeze",function(){return cc}),o.d(m,"stack",function(){return Bc}),o.d(m,"step",function(){return er}),o.d(m,"stft",function(){return mm}),o.d(m,"stridedSlice",function(){return Bd}),o.d(m,"sub",function(){return js}),o.d(m,"subStrict",function(){return ju}),o.d(m,"sum",function(){return bh}),o.d(m,"sumOutType",function(){return dr}),o.d(m,"tan",function(){return ru}),o.d(m,"tanh",function(){return Fo}),o.d(m,"tensor",function(){return la}),o.d(m,"tensor1d",function(){return Cc}),o.d(m,"tensor2d",function(){return sc}),o.d(m,"tensor3d",function(){return nf}),o.d(m,"tensor4d",function(){return Ac}),o.d(m,"tensor5d",function(){return yd}),o.d(m,"tensor6d",function(){return uc}),o.d(m,"tensor_util",function(){return Ft}),o.d(m,"test_util",function(){return Zh}),o.d(m,"tidy",function(){return so}),o.d(m,"tile",function(){return Jh}),o.d(m,"time",function(){return Zc}),o.d(m,"topk",function(){return og}),o.d(m,"train",function(){return cn}),o.d(m,"transpose",function(){return vt}),o.d(m,"truncatedNormal",function(){return Rd}),o.d(m,"unregisterGradient",function(){return Le}),o.d(m,"unregisterKernel",function(){return Fe}),o.d(m,"unsortedSegmentSum",function(){return Jm}),o.d(m,"unstack",function(){return Qd}),o.d(m,"util",function(){return wi}),o.d(m,"valueAndGrad",function(){return re}),o.d(m,"valueAndGrads",function(){return Q}),o.d(m,"variable",function(){return bd}),o.d(m,"variableGrads",function(){return C}),o.d(m,"version_core",function(){return ze}),o.d(m,"webgl",function(){return Ge}),o.d(m,"where",function(){return Ts}),o.d(m,"whereAsync",function(){return Id}),o.d(m,"zeros",function(){return Io}),o.d(m,"zerosLike",function(){return Ri});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var X=function(p,c){return(X=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var y in l)l.hasOwnProperty(y)&&(a[y]=l[y])})(p,c)};function K(p,c){function a(){this.constructor=p}X(p,c),p.prototype=c===null?Object.create(c):(a.prototype=c.prototype,new a)}function M(p,c,a,l){return new(a||(a=Promise))(function(y,S){function U(le){try{ae(l.next(le))}catch(be){S(be)}}function G(le){try{ae(l.throw(le))}catch(be){S(be)}}function ae(le){le.done?y(le.value):new a(function(be){be(le.value)}).then(U,G)}ae((l=l.apply(p,c||[])).next())})}function V(p,c){var a,l,y,S,U={label:0,sent:function(){if(1&y[0])throw y[1];return y[1]},trys:[],ops:[]};return S={next:G(0),throw:G(1),return:G(2)},typeof Symbol=="function"&&(S[Symbol.iterator]=function(){return this}),S;function G(ae){return function(le){return function(be){if(a)throw new TypeError("Generator is already executing.");for(;U;)try{if(a=1,l&&(y=2&be[0]?l.return:be[0]?l.throw||((y=l.return)&&y.call(l),0):l.next)&&!(y=y.call(l,be[1])).done)return y;switch(l=0,y&&(be=[2&be[0],y.value]),be[0]){case 0:case 1:y=be;break;case 4:return U.label++,{value:be[1],done:!1};case 5:U.label++,l=be[1],be=[0];continue;case 7:be=U.ops.pop(),U.trys.pop();continue;default:if(!(y=(y=U.trys).length>0&&y[y.length-1])&&(be[0]===6||be[0]===2)){U=0;continue}if(be[0]===3&&(!y||be[1]>y[0]&&be[1]<y[3])){U.label=be[1];break}if(be[0]===6&&U.label<y[1]){U.label=y[1],y=be;break}if(y&&U.label<y[2]){U.label=y[2],U.ops.push(be);break}y[2]&&U.ops.pop(),U.trys.pop();continue}be=c.call(p,U)}catch(Se){be=[6,Se],l=0}finally{a=y=0}if(5&be[0])throw be[1];return{value:be[0]?be[1]:void 0,done:!0}}([ae,le])}}}var $=function(){function p(c){this.global=c,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return p.prototype.setPlatform=function(c,a){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+a+"."),this.platformName=c,this.platform=a},p.prototype.registerFlag=function(c,a,l){if(this.flagRegistry[c]={evaluationFn:a,setHook:l},this.urlFlags[c]!=null){var y=this.urlFlags[c];console.warn("Setting feature override from URL "+c+": "+y+"."),this.set(c,y)}},p.prototype.get=function(c){return c in this.flags?this.flags[c]:(this.flags[c]=this.evaluateFlag(c),this.flags[c])},p.prototype.getNumber=function(c){return this.get(c)},p.prototype.getBool=function(c){return this.get(c)},p.prototype.getFlags=function(){return this.flags},Object.defineProperty(p.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),p.prototype.set=function(c,a){if(this.flagRegistry[c]==null)throw new Error("Cannot set flag "+c+" as it has not been registered.");this.flags[c]=a,this.flagRegistry[c].setHook!=null&&this.flagRegistry[c].setHook(a)},p.prototype.evaluateFlag=function(c){if(this.flagRegistry[c]==null)throw new Error("Cannot evaluate flag '"+c+"': no evaluation function found.");return this.flagRegistry[c].evaluationFn()},p.prototype.setFlags=function(c){this.flags=Object.assign({},c)},p.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},p.prototype.populateURLFlags=function(){var c=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var a,l,y=(a=this.global.location.search,l={},a.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(S){for(var U=[],G=1;G<arguments.length;G++)U[G-1]=arguments[G];return function(ae,le,be){ae[decodeURIComponent(le)]=decodeURIComponent(be||"")}(l,U[0],U[1]),U.join("=")}),l);"tfjsflags"in y&&y.tfjsflags.split(",").forEach(function(S){var U=S.split(":"),G=U[0],ae=U[1];c.urlFlags[G]=function(le,be){if((be=be.toLowerCase())==="true"||be==="false")return be==="true";if(""+ +be===be)return+be;throw new Error("Could not parse value flag value "+be+" for flag "+le+".")}(G,ae)})}},p}();function W(){return te}var te=null,F=new Map,ue=new Map;function se(p,c){var a=Ae(p,c);return F.get(a)}function J(p){return ue.get(p)}function me(p){for(var c=F.entries(),a=[];;){var l=c.next(),y=l.done,S=l.value;if(y)break;var U=S[0],G=S[1];U.split("_")[0]===p&&a.push(G)}return a}function pe(p){var c=p.kernelName,a=p.backendName,l=Ae(c,a);if(F.has(l))throw new Error("The kernel '"+c+"' for backend '"+a+"' is already registered");F.set(l,p)}function Oe(p){var c=p.kernelName;ue.has(c)&&console.warn("Overriding the gradient for '"+c+"'"),ue.set(c,p)}function Fe(p,c){var a=Ae(p,c);if(!F.has(a))throw new Error("The kernel '"+p+"' for backend '"+c+"' is not registered");F.delete(a)}function Le(p){if(!ue.has(p))throw new Error("The gradient '"+p+"' for backend is not registered");ue.delete(p)}function Ae(p,c){return c+"_"+p}function ft(p){for(var c=p.length,a=0,l=0;c>0;)l=Math.random()*c|0,a=p[--c],p[c]=p[l],p[l]=a}function Mt(p,c,a){return Math.max(p,Math.min(c,a))}function Xt(p){return p%2==0?p:p+1}function tn(p){for(var c=0,a=0;a<p.length;a++)c+=p[a];return c}function Ce(p,c){if(!p)throw new Error(typeof c=="string"?c:c())}function Wt(p,c,a){a===void 0&&(a=""),Ce(fn(p,c),function(){return a+" Shapes "+p+" and "+c+" must match"})}function en(p){Ce(p!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Ut(p,c,a){if(c===void 0&&(c=[]),a===void 0&&(a=!1),c==null&&(c=[]),Array.isArray(p)||yt(p)&&!a)for(var l=0;l<p.length;++l)Ut(p[l],c,a);else c.push(p);return c}function Qe(p){if(p.length===0)return 1;for(var c=p[0],a=1;a<p.length;a++)c*=p[a];return c}function fn(p,c){if(p===c)return!0;if(p==null||c==null||p.length!==c.length)return!1;for(var a=0;a<p.length;a++)if(p[a]!==c[a])return!1;return!0}function on(p){return p%1==0}function Ct(p){if(Math.tanh!=null)return Math.tanh(p);if(p===1/0)return 1;if(p===-1/0)return-1;var c=Math.exp(2*p);return(c-1)/(c+1)}function Vt(p){var c=Math.ceil(Math.sqrt(p));return[c,Math.ceil(p/c)]}function En(p,c){return c<=p.length?p:p+" ".repeat(c-p.length)}function Pt(p,c,a){return c===void 0&&(c=function(l){return 0}),new Promise(function(l,y){var S=0,U=function(){if(p())l();else{var G=c(++S);a!=null&&S>=a?y():setTimeout(U,G)}};U()})}function Rt(p,c){for(var a=1,l=-1,y=0;y<p.length;++y)if(p[y]>=0)a*=p[y];else if(p[y]===-1){if(l!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+l+" and dim "+y);l=y}else if(p[y]<0)throw Error("Shapes can not be < 0. Found "+p[y]+" at dim "+y);if(l===-1){if(c>0&&c!==a)throw Error("Size("+c+") must match the product of shape "+p);return p}if(a===0)throw Error("Cannot infer the missing size in ["+p+"] when there are 0 elements");if(c%a!=0)throw Error("The implicit shape can't be a fractional number. Got "+c+" / "+a);var S=p.slice();return S[l]=c/a,S}function Tn(p,c){var a=c.length;return Ce((p=p==null?c.map(function(l,y){return y}):[].concat(p)).every(function(l){return l>=-a&&l<a}),function(){return"All values in axis param must be in range [-"+a+", "+a+") but got axis "+p}),Ce(p.every(function(l){return on(l)}),function(){return"All values in axis param must be integers but got axis "+p}),p.map(function(l){return l<0?a+l:l})}function Hn(p,c){for(var a=[],l=[],y=c!=null&&Array.isArray(c)&&c.length===0,S=c==null||y?null:Tn(c,p).sort(),U=0,G=0;G<p.length;++G){if(S!=null){if(S[U]===G&&p[G]!==1)throw new Error("Can't squeeze axis "+G+" since its dim '"+p[G]+"' is not 1");(S[U]==null||S[U]>G)&&p[G]===1&&(a.push(p[G]),l.push(G)),S[U]<=G&&U++}p[G]!==1&&(a.push(p[G]),l.push(G))}return{newShape:a,keptDims:l}}function tr(p,c){var a=null;if(p==null||p==="float32")a=new Float32Array(c);else if(p==="int32")a=new Int32Array(c);else{if(p!=="bool")throw new Error("Unknown data type "+p);a=new Uint8Array(c)}return a}function pn(p,c){var a=null;if(p==null||p==="float32")a=new Float32Array(c);else if(p==="int32")a=new Int32Array(c);else if(p==="bool")a=new Uint8Array(c);else{if(p!=="string")throw new Error("Unknown data type "+p);a=new Array(c)}return a}function $e(p,c){for(var a=0;a<p.length;a++){var l=p[a];if(isNaN(l)||!isFinite(l))throw Error("A tensor of type "+c+" being uploaded contains "+l+".")}}function et(p){return p==="bool"||p==="complex64"||p==="float32"||p==="int32"||p==="string"}function Ke(p,c){return!(c==="complex64"||c==="float32"&&p!=="complex64"||c==="int32"&&p!=="float32"&&p!=="complex64"||c==="bool"&&p==="bool")}function yt(p){return p instanceof Float32Array||p instanceof Int32Array||p instanceof Uint8Array}function Dt(p){if(p==="float32"||p==="int32")return 4;if(p==="complex64")return 8;if(p==="bool")return 1;throw new Error("Unknown dtype "+p)}function Lt(p){if(p==null)return 0;var c=0;return p.forEach(function(a){return c+=a.length}),c}function zn(p){return typeof p=="string"||p instanceof String}function Cn(p){return typeof p=="boolean"}function ar(p){return typeof p=="number"}function we(p){return Array.isArray(p)?we(p[0]):p instanceof Float32Array?"float32":p instanceof Int32Array||p instanceof Uint8Array?"int32":ar(p)?"float32":zn(p)?"string":Cn(p)?"bool":"float32"}function lr(p){return!!(p&&p.constructor&&p.call&&p.apply)}function Rr(p,c){for(var a=c;a<p;++a)if(p%a==0)return a;return p}function Tr(p){var c=p.length;if(c<2)return[];var a=new Array(c-1);a[c-2]=p[c-1];for(var l=c-3;l>=0;--l)a[l]=a[l+1]*p[l+1];return a}function qr(p,c,a){if(c==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(p)&&(p=Ut(p)),a&&$e(p,c),function(S,U){return S instanceof Float32Array&&U==="float32"||S instanceof Int32Array&&U==="int32"||S instanceof Uint8Array&&U==="bool"}(p,c))return p;if(c==null||c==="float32"||c==="complex64")return new Float32Array(p);if(c==="int32")return new Int32Array(p);if(c==="bool"){for(var l=new Uint8Array(p.length),y=0;y<l.length;++y)Math.round(p[y])!==0&&(l[y]=1);return l}throw new Error("Unknown data type "+c)}function Gr(p,c){if(p.length===0)return c[0];var a=p.reduce(function(l,y){return l*y});if(a===0)return[];if(a!==c.length)throw new Error("["+p+"] does not match the input size.");return function l(y,S,U){var G=new Array;if(S.length===1)for(var ae=S[0],le=0;le<ae;le++)G[le]=U[y+le];else{ae=S[0];var be=S.slice(1),Se=be.reduce(function(Ie,Me){return Ie*Me});for(le=0;le<ae;le++)G[le]=l(y+le*Se,be,U)}return G}(0,p,c)}function hn(p,c){for(var a=nn(p,c),l=0;l<a.length;l++)a[l]=1;return a}function nn(p,c){if(c==null||c==="float32"||c==="complex64")return new Float32Array(p);if(c==="int32")return new Int32Array(p);if(c==="bool")return new Uint8Array(p);throw new Error("Unknown data type "+c)}function an(){return W().platform.now()}function or(p){p.forEach(function(c){Ce(Number.isInteger(c)&&c>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+p+"]."})})}function jn(p,c){return c===void 0&&(c="utf-8"),c=c||"utf-8",W().platform.encode(p,c)}function Fr(p,c){return c===void 0&&(c="utf-8"),c=c||"utf-8",W().platform.decode(p,c)}function Pr(p,c,a){if(c===0)return 0;if(c===1)return p[0];for(var l=p[p.length-1],y=0;y<p.length-1;++y)l+=a[y]*p[y];return l}function Br(p,c,a){if(c===0)return[];if(c===1)return[p];for(var l=new Array(c),y=0;y<l.length-1;++y)l[y]=Math.floor(p/a[y]),p-=l[y]*a[y];return l[l.length-1]=p,l}var wi=Object.freeze({shuffle:ft,clamp:Mt,nearestLargerEven:Xt,sum:tn,randUniform:function(p,c){var a=Math.random();return c*a+(1-a)*p},distSquared:function(p,c){for(var a=0,l=0;l<p.length;l++){var y=Number(p[l])-Number(c[l]);a+=y*y}return a},assert:Ce,assertShapesMatch:Wt,assertNonNull:en,flatten:Ut,sizeFromShape:Qe,isScalarShape:function(p){return p.length===0},arraysEqual:fn,isInt:on,tanh:Ct,sizeToSquarishShape:Vt,createShuffledIndices:function(p){for(var c=new Uint32Array(p),a=0;a<p;++a)c[a]=a;return ft(c),c},rightPad:En,repeatedTry:Pt,inferFromImplicitShape:Rt,parseAxisParam:Tn,squeezeShape:Hn,getTypedArrayFromDType:tr,getArrayFromDType:pn,checkConversionForErrors:$e,isValidDtype:et,hasEncodingLoss:Ke,isTypedArray:yt,bytesPerElement:Dt,bytesFromStringArray:Lt,isString:zn,isBoolean:Cn,isNumber:ar,inferDtype:we,isFunction:lr,nearestDivisor:Rr,computeStrides:Tr,toTypedArray:qr,toNestedArray:Gr,makeOnesTypedArray:hn,makeZerosTypedArray:nn,now:an,assertNonNegativeIntegerDimensions:or,fetch:function(p,c){return W().platform.fetch(p,c)},encodeString:jn,decodeString:Fr,locToIndex:Pr,indexToLoc:Br}),Ai=function(){function p(c,a){this.backendTimer=c,this.logger=a,a==null&&(this.logger=new Jn)}return p.prototype.profileKernel=function(c,a,l){var y,S=this,U=this.backendTimer.time(function(){y=l()});return y.forEach(function(G){G.data().then(function(ae){(function(le,be,Se){if(be!=="float32")return!1;for(var Ie=0;Ie<le.length;Ie++){var Me=le[Ie];if(isNaN(Me)||!isFinite(Me))return console.warn("Found "+Me+" in the result of '"+Se+"'"),!0}})(ae,G.dtype,c),U.then(function(le){var be="";le.getExtraProfileInfo!=null&&(be=le.getExtraProfileInfo()),S.logger.logKernelProfile(c,G,ae,le.kernelMs,a,be)})})}),y},p}(),Jn=function(){function p(){}return p.prototype.logKernelProfile=function(c,a,l,y,S,U){var G=typeof y=="number"?En(y+"ms",9):y.error,ae=En(c,25),le=a.rank,be=a.size,Se=En(a.shape.toString(),14),Ie="";for(var Me in S){var qe=S[Me].shape||a.shape,Ye=qe.length;Ie+=Me+": "+Ye+"D "+(Ye>0?qe:"")+" "}console.log("%c"+ae+"	%c"+G+"	%c"+le+"D "+Se+"	%c"+be+"	%c"+Ie+"	%c"+U,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},p}(),di=20,ri=3,Dr=7;function ki(p,c,a){return En(Array.isArray(p)?parseFloat(p[0].toFixed(Dr))+" + "+parseFloat(p[1].toFixed(Dr))+"j":zn(p)?"'"+p+"'":a==="bool"?Ei(p):parseFloat(p.toFixed(Dr)).toString(),c)}function Ei(p){return p===0?"false":"true"}function mo(p){for(var c=[],a=0;a<p.length;a+=2)c.push([p[a],p[a+1]]);return c}var Gi=function(){function p(c,a,l){var y=this;if(this.dtype=a,this.shape=c.slice(),this.size=Qe(c),l!=null){var S=l.length;Ce(S===this.size,function(){return"Length of values '"+S+"' does not match the size inferred by the shape '"+y.size+"'."})}if(a==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=l||pn(a,this.size),this.strides=Tr(c)}return p.prototype.set=function(c){for(var a=this,l=[],y=1;y<arguments.length;y++)l[y-1]=arguments[y];l.length===0&&(l=[0]),Ce(l.length===this.rank,function(){return"The number of provided coordinates ("+l.length+") must match the rank ("+a.rank+")"});var S=this.locToIndex(l);this.values[S]=c},p.prototype.get=function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];c.length===0&&(c=[0]);for(var l=0,y=0,S=c;y<S.length;y++){var U=S[y];if(U<0||U>=this.shape[l]){var G="Requested out of range element at "+c+".   Buffer shape="+this.shape;throw new Error(G)}l++}for(var ae=c[c.length-1],le=0;le<c.length-1;++le)ae+=this.strides[le]*c[le];return this.values[ae]},p.prototype.locToIndex=function(c){if(this.rank===0)return 0;if(this.rank===1)return c[0];for(var a=c[c.length-1],l=0;l<c.length-1;++l)a+=this.strides[l]*c[l];return a},p.prototype.indexToLoc=function(c){if(this.rank===0)return[];if(this.rank===1)return[c];for(var a=new Array(this.shape.length),l=0;l<a.length-1;++l)a[l]=Math.floor(c/this.strides[l]),c-=a[l]*this.strides[l];return a[a.length-1]=c,a},Object.defineProperty(p.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),p.prototype.toTensor=function(){return Ui().makeTensor(this.values,this.shape,this.dtype)},p}(),Ui=null,Ot=null,$r=null,$t=function(){function p(c,a,l,y){this.kept=!1,this.isDisposedInternal=!1,this.shape=c.slice(),this.dtype=a||"float32",this.size=Qe(c),this.strides=Tr(c),this.dataId=l,this.id=y,this.rankType=this.rank<5?this.rank.toString():"higher"}return p.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},p.prototype.asScalar=function(){return this.throwIfDisposed(),Ce(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},p.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},p.prototype.as2D=function(c,a){return this.throwIfDisposed(),this.reshape([c,a])},p.prototype.as3D=function(c,a,l){return this.throwIfDisposed(),this.reshape([c,a,l])},p.prototype.as4D=function(c,a,l,y){return this.throwIfDisposed(),this.reshape([c,a,l,y])},p.prototype.as5D=function(c,a,l,y,S){return this.throwIfDisposed(),this.reshape([c,a,l,y,S])},p.prototype.asType=function(c){return this.throwIfDisposed(),Ot.cast(this,c)},Object.defineProperty(p.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),p.prototype.buffer=function(){return M(this,void 0,void 0,function(){var c;return V(this,function(a){switch(a.label){case 0:return[4,this.data()];case 1:return c=a.sent(),[2,Ot.buffer(this.shape,this.dtype,c)]}})})},p.prototype.bufferSync=function(){return Ot.buffer(this.shape,this.dtype,this.dataSync())},p.prototype.array=function(){return M(this,void 0,void 0,function(){var c;return V(this,function(a){switch(a.label){case 0:return[4,this.data()];case 1:return c=a.sent(),[2,Gr(this.shape,c)]}})})},p.prototype.arraySync=function(){return Gr(this.shape,this.dataSync())},p.prototype.data=function(){return M(this,void 0,void 0,function(){var c,a;return V(this,function(l){switch(l.label){case 0:return this.throwIfDisposed(),c=Ui().read(this.dataId),this.dtype!=="string"?[3,2]:[4,c];case 1:a=l.sent();try{return[2,a.map(function(y){return Fr(y)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}l.label=2;case 2:return[2,c]}})})},p.prototype.dataSync=function(){this.throwIfDisposed();var c=Ui().readSync(this.dataId);if(this.dtype==="string")try{return c.map(function(a){return Fr(a)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return c},p.prototype.bytes=function(){return M(this,void 0,void 0,function(){var c;return V(this,function(a){switch(a.label){case 0:return this.throwIfDisposed(),[4,Ui().read(this.dataId)];case 1:return c=a.sent(),this.dtype==="string"?[2,c]:[2,new Uint8Array(c.buffer)]}})})},p.prototype.dispose=function(){this.isDisposed||(Ui().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(p.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),p.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},p.prototype.toFloat=function(){return this.asType("float32")},p.prototype.toInt=function(){return this.asType("int32")},p.prototype.toBool=function(){return this.asType("bool")},p.prototype.print=function(c){return c===void 0&&(c=!1),Ot.print(this,c)},p.prototype.reshape=function(c){return this.throwIfDisposed(),Ot.reshape(this,c)},p.prototype.reshapeAs=function(c){return this.throwIfDisposed(),this.reshape(c.shape)},p.prototype.expandDims=function(c){return c===void 0&&(c=0),Ot.expandDims(this,c)},p.prototype.cumsum=function(c,a,l){return c===void 0&&(c=0),a===void 0&&(a=!1),l===void 0&&(l=!1),Ot.cumsum(this,c,a,l)},p.prototype.squeeze=function(c){return this.throwIfDisposed(),Ot.squeeze(this,c)},p.prototype.clone=function(){return this.throwIfDisposed(),Ot.clone(this)},p.prototype.toString=function(c){return c===void 0&&(c=!1),function(a,l,y,S){var U=Tr(l),G=function(Se,Ie,Me,qe){var Ye=Qe(Ie),Xe=qe[qe.length-1],at=new Array(Xe).fill(0),gt=Ie.length,bt=Me==="complex64"?mo(Se):Se;if(gt>1)for(var _t=0;_t<Ye/Xe;_t++)for(var jt=_t*Xe,Qt=0;Qt<Xe;Qt++)at[Qt]=Math.max(at[Qt],ki(bt[jt+Qt],0,Me).length);return at}(a,l,y,U),ae=l.length,le=function Se(Ie,Me,qe,Ye,Xe,at){at===void 0&&(at=!0);var gt=qe==="complex64"?2:1,bt=Me[0],_t=Me.length;if(_t===0)return qe==="complex64"?[ki(mo(Ie)[0],0,qe)]:qe==="bool"?[Ei(Ie[0])]:[Ie[0].toString()];if(_t===1){if(bt>di){var jt=ri*gt,Qt=Array.from(Ie.slice(0,jt)),sn=Array.from(Ie.slice((bt-ri)*gt,bt*gt));return qe==="complex64"&&(Qt=mo(Qt),sn=mo(sn)),["["+Qt.map(function(Ar,_r){return ki(Ar,Xe[_r],qe)}).join(", ")+", ..., "+sn.map(function(Ar,_r){return ki(Ar,Xe[bt-ri+_r],qe)}).join(", ")+"]"]}return["["+(qe==="complex64"?mo(Ie):Array.from(Ie)).map(function(Ar,_r){return ki(Ar,Xe[_r],qe)}).join(", ")+"]"]}var Zt=Me.slice(1),rn=Ye.slice(1),Sn=Ye[0]*gt,Bn=[];if(bt>di){for(var Mn=0;Mn<ri;Mn++){var fr=(yr=Mn*Sn)+Sn;Bn.push.apply(Bn,Se(Ie.slice(yr,fr),Zt,qe,rn,Xe,!1))}for(Bn.push("..."),Mn=bt-ri;Mn<bt;Mn++)fr=(yr=Mn*Sn)+Sn,Bn.push.apply(Bn,Se(Ie.slice(yr,fr),Zt,qe,rn,Xe,Mn===bt-1))}else for(Mn=0;Mn<bt;Mn++){var yr;fr=(yr=Mn*Sn)+Sn,Bn.push.apply(Bn,Se(Ie.slice(yr,fr),Zt,qe,rn,Xe,Mn===bt-1))}var Cr=_t===2?",":"";for(Bn[0]="["+Bn[0]+Cr,Mn=1;Mn<Bn.length-1;Mn++)Bn[Mn]=" "+Bn[Mn]+Cr;var Nr=`,
`;for(Mn=2;Mn<_t;Mn++)Nr+=`
`;return Bn[Bn.length-1]=" "+Bn[Bn.length-1]+"]"+(at?"":Nr),Bn}(a,l,y,U,G),be=["Tensor"];return S&&(be.push("  dtype: "+y),be.push("  rank: "+ae),be.push("  shape: ["+l+"]"),be.push("  values:")),be.push(le.map(function(Se){return"    "+Se}).join(`
`)),be.join(`
`)}(this.dataSync(),this.shape,this.dtype,c)},p.prototype.gather=function(c,a){return a===void 0&&(a=0),this.throwIfDisposed(),Ot.gather(this,c,a)},p.prototype.matMul=function(c,a,l){return a===void 0&&(a=!1),l===void 0&&(l=!1),this.throwIfDisposed(),Ot.matMul(this,c,a,l)},p.prototype.dot=function(c){return this.throwIfDisposed(),Ot.dot(this,c)},p.prototype.norm=function(c,a,l){return c===void 0&&(c="euclidean"),a===void 0&&(a=null),l===void 0&&(l=!1),this.throwIfDisposed(),Ot.norm(this,c,a,l)},p.prototype.slice=function(c,a){return this.throwIfDisposed(),Ot.slice(this,c,a)},p.prototype.reverse=function(c){return this.throwIfDisposed(),Ot.reverse(this,c)},p.prototype.concat=function(c,a){return a===void 0&&(a=0),this.throwIfDisposed(),c instanceof p&&(c=[c]),Ot.concat([this].concat(c),a)},p.prototype.split=function(c,a){return a===void 0&&(a=0),this.throwIfDisposed(),Ot.split(this,c,a)},p.prototype.stack=function(c,a){return a===void 0&&(a=0),Ot.stack([this,c],a)},p.prototype.unstack=function(c){return c===void 0&&(c=0),Ot.unstack(this,c)},p.prototype.batchNormalization=function(c,a,l,y,S){return l===void 0&&(l=.001),$r("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(c,a,S,y,l)},p.prototype.all=function(c,a){return c===void 0&&(c=null),a===void 0&&(a=!1),this.throwIfDisposed(),Ot.all(this,c,a)},p.prototype.any=function(c,a){return c===void 0&&(c=null),a===void 0&&(a=!1),this.throwIfDisposed(),Ot.any(this,c,a)},p.prototype.logSumExp=function(c,a){return c===void 0&&(c=null),a===void 0&&(a=!1),this.throwIfDisposed(),Ot.logSumExp(this,c,a)},p.prototype.sum=function(c,a){return c===void 0&&(c=null),a===void 0&&(a=!1),this.throwIfDisposed(),Ot.sum(this,c,a)},p.prototype.prod=function(c,a){return c===void 0&&(c=null),a===void 0&&(a=!1),this.throwIfDisposed(),Ot.prod(this,c,a)},p.prototype.mean=function(c,a){return c===void 0&&(c=null),a===void 0&&(a=!1),this.throwIfDisposed(),Ot.mean(this,c,a)},p.prototype.min=function(c,a){return c===void 0&&(c=null),a===void 0&&(a=!1),this.throwIfDisposed(),Ot.min(this,c,a)},p.prototype.max=function(c,a){return c===void 0&&(c=null),a===void 0&&(a=!1),this.throwIfDisposed(),Ot.max(this,c,a)},p.prototype.argMin=function(c){return c===void 0&&(c=null),this.throwIfDisposed(),Ot.argMin(this,c)},p.prototype.argMax=function(c){return c===void 0&&(c=null),this.throwIfDisposed(),Ot.argMax(this,c)},p.prototype.cast=function(c){return this.throwIfDisposed(),Ot.cast(this,c)},p.prototype.addStrict=function(c){return this.throwIfDisposed(),Ot.addStrict(this,c)},p.prototype.atan2=function(c){return this.throwIfDisposed(),Ot.atan2(this,c)},p.prototype.sub=function(c){return this.throwIfDisposed(),Ot.sub(this,c)},p.prototype.subStrict=function(c){return this.throwIfDisposed(),Ot.subStrict(this,c)},p.prototype.pow=function(c){return this.throwIfDisposed(),Ot.pow(this,c)},p.prototype.powStrict=function(c){return this.throwIfDisposed(),Ot.powStrict(this,c)},p.prototype.mul=function(c){return this.throwIfDisposed(),Ot.mul(this,c)},p.prototype.mulStrict=function(c){return this.throwIfDisposed(),Ot.mulStrict(this,c)},p.prototype.floorDiv=function(c){return this.throwIfDisposed(),Ot.floorDiv(this,c)},p.prototype.divStrict=function(c){return this.throwIfDisposed(),Ot.divStrict(this,c)},p.prototype.minimum=function(c){return this.throwIfDisposed(),Ot.minimum(this,c)},p.prototype.minimumStrict=function(c){return this.throwIfDisposed(),Ot.minimumStrict(this,c)},p.prototype.maximum=function(c){return this.throwIfDisposed(),Ot.maximum(this,c)},p.prototype.maximumStrict=function(c){return this.throwIfDisposed(),Ot.maximumStrict(this,c)},p.prototype.mod=function(c){return this.throwIfDisposed(),Ot.mod(this,c)},p.prototype.modStrict=function(c){return this.throwIfDisposed(),Ot.modStrict(this,c)},p.prototype.squaredDifferenceStrict=function(c){return this.throwIfDisposed(),Ot.squaredDifferenceStrict(this,c)},p.prototype.notEqual=function(c){return this.throwIfDisposed(),Ot.notEqual(this,c)},p.prototype.notEqualStrict=function(c){return this.throwIfDisposed(),Ot.notEqualStrict(this,c)},p.prototype.less=function(c){return this.throwIfDisposed(),Ot.less(this,c)},p.prototype.lessStrict=function(c){return this.throwIfDisposed(),Ot.lessStrict(this,c)},p.prototype.equal=function(c){return this.throwIfDisposed(),Ot.equal(this,c)},p.prototype.equalStrict=function(c){return this.throwIfDisposed(),Ot.equalStrict(this,c)},p.prototype.lessEqual=function(c){return this.throwIfDisposed(),Ot.lessEqual(this,c)},p.prototype.lessEqualStrict=function(c){return this.throwIfDisposed(),Ot.lessEqualStrict(this,c)},p.prototype.greater=function(c){return this.throwIfDisposed(),Ot.greater(this,c)},p.prototype.greaterStrict=function(c){return this.throwIfDisposed(),Ot.greaterStrict(this,c)},p.prototype.greaterEqual=function(c){return this.throwIfDisposed(),Ot.greaterEqual(this,c)},p.prototype.greaterEqualStrict=function(c){return this.throwIfDisposed(),Ot.greaterEqualStrict(this,c)},p.prototype.logicalAnd=function(c){return this.throwIfDisposed(),Ot.logicalAnd(this,c)},p.prototype.logicalOr=function(c){return this.throwIfDisposed(),Ot.logicalOr(this,c)},p.prototype.logicalNot=function(){return this.throwIfDisposed(),Ot.logicalNot(this)},p.prototype.logicalXor=function(c){return this.throwIfDisposed(),Ot.logicalXor(this,c)},p.prototype.where=function(c,a){return this.throwIfDisposed(),Ot.where(c,this,a)},p.prototype.neg=function(){return this.throwIfDisposed(),Ot.neg(this)},p.prototype.ceil=function(){return this.throwIfDisposed(),Ot.ceil(this)},p.prototype.floor=function(){return this.throwIfDisposed(),Ot.floor(this)},p.prototype.sign=function(){return this.throwIfDisposed(),Ot.sign(this)},p.prototype.isNaN=function(){return this.throwIfDisposed(),Ot.isNaN(this)},p.prototype.isInf=function(){return this.throwIfDisposed(),Ot.isInf(this)},p.prototype.isFinite=function(){return this.throwIfDisposed(),Ot.isFinite(this)},p.prototype.exp=function(){return this.throwIfDisposed(),Ot.exp(this)},p.prototype.expm1=function(){return this.throwIfDisposed(),Ot.expm1(this)},p.prototype.log=function(){return this.throwIfDisposed(),Ot.log(this)},p.prototype.log1p=function(){return this.throwIfDisposed(),Ot.log1p(this)},p.prototype.sqrt=function(){return this.throwIfDisposed(),Ot.sqrt(this)},p.prototype.rsqrt=function(){return this.throwIfDisposed(),Ot.rsqrt(this)},p.prototype.square=function(){return this.throwIfDisposed(),Ot.square(this)},p.prototype.reciprocal=function(){return this.throwIfDisposed(),Ot.reciprocal(this)},p.prototype.abs=function(){return this.throwIfDisposed(),Ot.abs(this)},p.prototype.clipByValue=function(c,a){return this.throwIfDisposed(),Ot.clipByValue(this,c,a)},p.prototype.relu=function(){return this.throwIfDisposed(),Ot.relu(this)},p.prototype.relu6=function(){return this.throwIfDisposed(),Ot.relu6(this)},p.prototype.elu=function(){return this.throwIfDisposed(),Ot.elu(this)},p.prototype.selu=function(){return this.throwIfDisposed(),Ot.selu(this)},p.prototype.leakyRelu=function(c){return c===void 0&&(c=.2),this.throwIfDisposed(),Ot.leakyRelu(this,c)},p.prototype.prelu=function(c){return this.throwIfDisposed(),Ot.prelu(this,c)},p.prototype.sigmoid=function(){return this.throwIfDisposed(),Ot.sigmoid(this)},p.prototype.logSigmoid=function(){return this.throwIfDisposed(),Ot.logSigmoid(this)},p.prototype.softplus=function(){return this.throwIfDisposed(),Ot.softplus(this)},p.prototype.zerosLike=function(){return this.throwIfDisposed(),Ot.zerosLike(this)},p.prototype.onesLike=function(){return this.throwIfDisposed(),Ot.onesLike(this)},p.prototype.sin=function(){return this.throwIfDisposed(),Ot.sin(this)},p.prototype.cos=function(){return this.throwIfDisposed(),Ot.cos(this)},p.prototype.tan=function(){return this.throwIfDisposed(),Ot.tan(this)},p.prototype.asin=function(){return this.throwIfDisposed(),Ot.asin(this)},p.prototype.acos=function(){return this.throwIfDisposed(),Ot.acos(this)},p.prototype.atan=function(){return this.throwIfDisposed(),Ot.atan(this)},p.prototype.sinh=function(){return this.throwIfDisposed(),Ot.sinh(this)},p.prototype.cosh=function(){return this.throwIfDisposed(),Ot.cosh(this)},p.prototype.tanh=function(){return this.throwIfDisposed(),Ot.tanh(this)},p.prototype.asinh=function(){return this.throwIfDisposed(),Ot.asinh(this)},p.prototype.acosh=function(){return this.throwIfDisposed(),Ot.acosh(this)},p.prototype.atanh=function(){return this.throwIfDisposed(),Ot.atanh(this)},p.prototype.erf=function(){return this.throwIfDisposed(),Ot.erf(this)},p.prototype.round=function(){return this.throwIfDisposed(),Ot.round(this)},p.prototype.step=function(c){return c===void 0&&(c=0),this.throwIfDisposed(),Ot.step(this,c)},p.prototype.softmax=function(c){return c===void 0&&(c=-1),this.throwIfDisposed(),Ot.softmax(this,c)},p.prototype.logSoftmax=function(c){return c===void 0&&(c=-1),this.throwIfDisposed(),Ot.logSoftmax(this,c)},p.prototype.resizeBilinear=function(c,a){return a===void 0&&(a=!1),this.throwIfDisposed(),Ot.image.resizeBilinear(this,c,a)},p.prototype.resizeNearestNeighbor=function(c,a){return a===void 0&&(a=!1),this.throwIfDisposed(),Ot.image.resizeNearestNeighbor(this,c,a)},p.prototype.conv1d=function(c,a,l,y,S,U){return y===void 0&&(y="NWC"),S===void 0&&(S=1),this.throwIfDisposed(),Ot.conv1d(this,c,a,l,y,S,U)},p.prototype.conv2d=function(c,a,l,y,S,U){return y===void 0&&(y="NHWC"),S===void 0&&(S=[1,1]),this.throwIfDisposed(),Ot.conv2d(this,c,a,l,y,S,U)},p.prototype.conv2dTranspose=function(c,a,l,y,S){return this.throwIfDisposed(),Ot.conv2dTranspose(this,c,a,l,y,S)},p.prototype.depthwiseConv2D=function(c,a,l,y,S,U){return y===void 0&&(y="NHWC"),S===void 0&&(S=[1,1]),this.throwIfDisposed(),Ot.depthwiseConv2d(this,c,a,l,y,S,U)},p.prototype.separableConv2d=function(c,a,l,y,S,U){return S===void 0&&(S=[1,1]),U===void 0&&(U="NHWC"),this.throwIfDisposed(),Ot.separableConv2d(this,c,a,l,y,S,U)},p.prototype.avgPool=function(c,a,l,y){return this.throwIfDisposed(),Ot.avgPool(this,c,a,l,y)},p.prototype.maxPool=function(c,a,l,y){return this.throwIfDisposed(),Ot.maxPool(this,c,a,l,y)},p.prototype.localResponseNormalization=function(c,a,l,y){return c===void 0&&(c=5),a===void 0&&(a=1),l===void 0&&(l=1),y===void 0&&(y=.5),Ot.localResponseNormalization(this,c,a,l,y)},p.prototype.pool=function(c,a,l,y,S){return this.throwIfDisposed(),Ot.pool(this,c,a,l,y,S)},p.prototype.variable=function(c,a,l){return c===void 0&&(c=!0),this.throwIfDisposed(),Ui().makeVariable(this,c,a,l)},p.prototype.unsortedSegmentSum=function(c,a){return this.throwIfDisposed(),Ot.unsortedSegmentSum(this,c,a)},p.prototype.batchToSpaceND=function(c,a){return this.throwIfDisposed(),Ot.batchToSpaceND(this,c,a)},p.prototype.spaceToBatchND=function(c,a){return this.throwIfDisposed(),Ot.spaceToBatchND(this,c,a)},p.prototype.topk=function(c,a){return c===void 0&&(c=1),a===void 0&&(a=!0),this.throwIfDisposed(),Ot.topk(this,c,a)},p.prototype.stridedSlice=function(c,a,l,y,S,U,G,ae){return y===void 0&&(y=0),S===void 0&&(S=0),U===void 0&&(U=0),G===void 0&&(G=0),ae===void 0&&(ae=0),this.throwIfDisposed(),Ot.stridedSlice(this,c,a,l,y,S,U,G,ae)},p.prototype.depthToSpace=function(c,a){return this.throwIfDisposed(),Ot.depthToSpace(this,c,a)},p.prototype.fft=function(){return this.throwIfDisposed(),Ot.spectral.fft(this)},p.prototype.ifft=function(){return this.throwIfDisposed(),Ot.spectral.ifft(this)},p.prototype.rfft=function(){return this.throwIfDisposed(),Ot.spectral.rfft(this)},p.prototype.irfft=function(){return this.throwIfDisposed(),Ot.spectral.irfft(this)},p}();Object.defineProperty($t,Symbol.hasInstance,{value:function(p){return!!p&&p.dataId!=null&&p.shape!=null&&p.dtype!=null}});var xe,ge,ke,Ne,ot,xt=function(p){function c(a,l,y,S){var U=p.call(this,a.shape,a.dtype,a.dataId,S)||this;return U.trainable=l,U.name=y,U}return K(c,p),c.prototype.assign=function(a){if(a.dtype!==this.dtype)throw new Error("dtype of the new value ("+a.dtype+") and previous value ("+this.dtype+") must match");if(!fn(a.shape,this.shape))throw new Error("shape of the new value ("+a.shape+") and previous value ("+this.shape+") must match");Ui().disposeTensor(this),this.dataId=a.dataId,Ui().incRef(this,null)},c.prototype.dispose=function(){Ui().disposeVariable(this),this.isDisposedInternal=!0},c}($t);Object.defineProperty(xt,Symbol.hasInstance,{value:function(p){return p instanceof $t&&p.assign!=null&&p.assign instanceof Function}}),function(p){p.R0="R0",p.R1="R1",p.R2="R2",p.R3="R3",p.R4="R4",p.R5="R5",p.R6="R6"}(xe||(xe={})),function(p){p.float32="float32",p.int32="int32",p.bool="int32",p.complex64="complex64"}(ge||(ge={})),function(p){p.float32="float32",p.int32="int32",p.bool="bool",p.complex64="complex64"}(ke||(ke={})),function(p){p.float32="float32",p.int32="float32",p.bool="float32",p.complex64="complex64"}(Ne||(Ne={})),function(p){p.float32="complex64",p.int32="complex64",p.bool="complex64",p.complex64="complex64"}(ot||(ot={}));var Ht={float32:Ne,int32:ge,bool:ke,complex64:ot};function yn(p,c){if(p==="string"||c==="string"){if(p==="string"&&c==="string")return"string";throw new Error("Can not upcast "+p+" with "+c)}return Ht[p][c]}function dr(p){return yn(p,"int32")}function _n(p,c){if(p.dtype===c.dtype)return[p,c];var a=yn(p.dtype,c.dtype);return[p.cast(a),c.cast(a)]}function In(p,c){Ce(p.dtype===c.dtype,function(){return"The dtypes of the first("+p.dtype+") and second("+c.dtype+") input must match"})}function Gn(p){var c=[];return function a(l,y,S){if(l!=null){if(l instanceof $t)y.push(l);else if(U=l,Array.isArray(U)||typeof U=="object"){var U,G=l;for(var ae in G){var le=G[ae];S.has(le)||(S.add(le),a(le,y,S))}}}}(p,c,new Set),c}var Nt,Ft=Object.freeze({makeTypesMatch:_n,assertTypesMatch:In,isTensorInList:function(p,c){return c.some(function(a){return a.id===p.id})},getTensorsInContainer:Gn}),bn=function(){function p(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return p.prototype.dispose=function(){for(var c in this.registeredVariables)this.registeredVariables[c].dispose()},p}(),Yt=function(){function p(c){this.ENV=c,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new bn}return p.prototype.ready=function(){return M(this,void 0,void 0,function(){var c,a,l;return V(this,function(y){switch(y.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];c=this.getSortedBackends(),a=0,y.label=1;case 1:return a<c.length?(l=c[a],[4,this.initializeBackend(l).success]):[3,5];case 2:return y.sent()?[4,this.setBackend(l)]:[3,4];case 3:return y.sent(),[2];case 4:return a++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(p.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var c=this.initializeBackendsAndReturnBest(),a=c.name;if(c.asyncInit)throw new Error("The highest priority backend '"+a+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(a)}return this.backendInstance},enumerable:!0,configurable:!0}),p.prototype.backendNames=function(){return Object.keys(this.registryFactory)},p.prototype.findBackend=function(c){return!(c in this.registry)&&(!(c in this.registryFactory)||this.initializeBackend(c).asyncInit)?null:this.registry[c]},p.prototype.findBackendFactory=function(c){return c in this.registryFactory?this.registryFactory[c].factory:null},p.prototype.registerBackend=function(c,a,l){return l===void 0&&(l=1),c in this.registryFactory?(console.warn(c+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[c]={factory:a,priority:l},!0)},p.prototype.setBackend=function(c){return M(this,void 0,void 0,function(){var a,l,y;return V(this,function(S){switch(S.label){case 0:if(this.registryFactory[c]==null)throw new Error("Backend name '"+c+"' not found in registry");return this.backendName=c,this.registry[c]!=null?[3,4]:(this.backendInstance=null,a=this.initializeBackend(c),l=a.success,a.asyncInit?[4,l]:[3,2]);case 1:return y=S.sent(),[3,3];case 2:y=l,S.label=3;case 3:if(!y)return[2,!1];S.label=4;case 4:return this.backendInstance=this.registry[c],this.setupRegisteredKernels(),this.profiler=new Ai(this.backendInstance),[2,!0]}})})},p.prototype.setupRegisteredKernels=function(){var c=this;me(this.backendName).forEach(function(a){a.setupFunc!=null&&a.setupFunc(c.backendInstance)})},p.prototype.disposeRegisteredKernels=function(c){var a=this;me(c).forEach(function(l){l.disposeFunc!=null&&l.disposeFunc(a.registry[c])})},p.prototype.initializeBackend=function(c){var a=this,l=this.registryFactory[c];if(l==null)throw new Error("Cannot initialize backend "+c+", no registration found.");try{var y=l.factory();if(Promise.resolve(y)===y){var S=++this.pendingBackendInitId,U=y.then(function(G){return!(S<a.pendingBackendInitId||(a.registry[c]=G,a.pendingBackendInit=null,0))}).catch(function(G){return!(S<a.pendingBackendInitId||(a.pendingBackendInit=null,console.warn("Initialization of backend "+c+" failed"),console.warn(G.stack||G.message),1))});return this.pendingBackendInit=U,{success:U,asyncInit:!0}}return this.registry[c]=y,{success:!0,asyncInit:!1}}catch(G){return console.warn("Initialization of backend "+c+" failed"),console.warn(G.stack||G.message),{success:!1,asyncInit:!1}}},p.prototype.removeBackend=function(c){if(!(c in this.registryFactory))throw new Error(c+" backend not found in registry");this.backendName===c&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,c in this.registry&&(this.disposeRegisteredKernels(c),this.registry[c].dispose(),delete this.registry[c]),delete this.registryFactory[c],this.backendName===c&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},p.prototype.getSortedBackends=function(){var c=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(a,l){return c.registryFactory[l].priority-c.registryFactory[a].priority})},p.prototype.initializeBackendsAndReturnBest=function(){for(var c=this.getSortedBackends(),a=0;a<c.length;a++){var l=c[a],y=this.initializeBackend(l),S=y.success,U=y.asyncInit;if(U||S)return{name:l,asyncInit:U}}throw new Error("Could not initialize any backends, all backend initializations failed.")},p.prototype.moveData=function(c,a){var l=this.state.tensorInfo.get(a),y=l.backend,S=this.readSync(a);y.disposeData(a),l.backend=c,c.move(a,S,l.shape,l.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},p.prototype.tidy=function(c,a){var l,y=this,S=null;if(a==null){if(typeof c!="function")throw new Error("Please provide a function to tidy()");a=c}else{if(typeof c!="string"&&!(c instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof a!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");S=c}return this.scopedRun(function(){return y.startScope(S)},function(){return y.endScope(l)},function(){return(l=a())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),l})},p.prototype.scopedRun=function(c,a,l){c();try{var y=l();return a(),y}catch(S){throw a(),S}},p.prototype.nextTensorId=function(){return p.nextTensorId++},p.prototype.nextVariableId=function(){return p.nextVariableId++},p.prototype.clone=function(c){var a=this.makeTensorFromDataId(c.dataId,c.shape,c.dtype),l={x:c};return this.addTapeNode(this.state.activeScope.name,l,[a],function(y){return{x:function(){return y.toFloat()}}},[],{}),a},p.prototype.runKernel=function(c,a,l,y,S){return this.runKernelFunc(null,a,null,c,l,y,S)},p.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},p.prototype.checkKernelForMemLeak=function(c,a,l){var y=this.backend.numDataIds(),S=0;l.forEach(function(ae){S+=ae.dtype==="complex64"?3:1});var U=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],G=y-a-S-U;if(G>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+G+" data ids) after running '"+c+"'")},p.prototype.runKernelFunc=function(c,a,l,y,S,U,G){var ae,le=this,be=[],Se=this.isTapeOn();y==null&&(y=this.state.activeScope!=null?this.state.activeScope.name:"");var Ie,Me=this.state.numBytes,qe=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var Ye,Xe=se(y,this.backendName);if(Xe!=null)Ie=function(){var gt=le.backend.numDataIds();Ye=Xe.kernelFunc({inputs:a,attrs:S,backend:le.backend});var bt=Array.isArray(Ye)?Ye:[Ye];le.shouldCheckForMemLeaks()&&le.checkKernelForMemLeak(y,gt,bt);var _t=bt.map(function(sn){var Zt=sn.dataId,rn=sn.shape,Sn=sn.dtype;return le.makeTensorFromDataId(Zt,rn,Sn)});if(Se){var jt=le.getTensorsForGradient(y,a,_t);if(jt==null){G==null&&(G=[]);var Qt=_t.filter(function(sn,Zt){return G[Zt]});jt=(U||[]).slice().concat(Qt)}be=le.saveTensorsForBackwardMode(jt)}return _t};else{var at=function(gt){Se&&(be=gt.map(function(bt){return le.keep(le.clone(bt))}))};Ie=function(){var gt=le.backend.numDataIds();Ye=le.tidy(function(){return c(le.backend,at)});var bt=Array.isArray(Ye)?Ye:[Ye];return le.shouldCheckForMemLeaks()&&le.checkKernelForMemLeak(y,gt,bt),bt}}return this.scopedRun(function(){return le.state.kernelDepth++},function(){return le.state.kernelDepth--},function(){ae=le.ENV.getBool("DEBUG")?le.profiler.profileKernel(y,a,function(){return Ie()}):Ie()}),Se&&this.addTapeNode(y,a,ae,l,be,S),this.state.profiling&&this.state.activeProfile.kernels.push({name:y,bytesAdded:this.state.numBytes-Me,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-qe,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(a).map(function(gt){return a[gt].shape}),outputShapes:ae.map(function(gt){return gt.shape})}),Array.isArray(Ye)?ae:ae[0]},p.prototype.saveTensorsForBackwardMode=function(c){var a=this;return c.map(function(l){return a.keep(a.clone(l))})},p.prototype.getTensorsForGradient=function(c,a,l){var y=J(c);if(y!=null){var S=y.inputsToSave||[],U=y.outputsToSave||[],G=void 0;y.saveAllInputs?(Ce(Array.isArray(a),function(){return"saveAllInputs is true, expected inputs to be an array."}),G=Object.keys(a).map(function(le){return a[le]})):G=S.map(function(le){return a[le]});var ae=l.filter(function(le,be){return U[be]});return G.concat(ae)}return null},p.prototype.makeTensor=function(c,a,l,y){if(c==null)throw new Error("Values passed to engine.makeTensor() are null");l=l||"float32",y=y||this.backend;var S=c;l==="string"&&zn(c[0])&&(S=c.map(function(be){return jn(be)}));var U=y.write(S,a,l),G=new $t(a,l,U,this.nextTensorId());if(this.incRef(G,y),l==="string"){var ae=this.state.tensorInfo.get(U),le=Lt(S);this.state.numBytes+=le-ae.bytes,ae.bytes=le}return G},p.prototype.makeTensorFromDataId=function(c,a,l,y){var S=new $t(a,l=l||"float32",c,this.nextTensorId());return this.incRef(S,y),S},p.prototype.makeVariable=function(c,a,l,y){a===void 0&&(a=!0),l=l||this.nextVariableId().toString(),y!=null&&y!==c.dtype&&(c=c.asType(y));var S=new xt(c,a,l,this.nextTensorId());if(this.state.registeredVariables[S.name]!=null)throw new Error("Variable with name "+S.name+" was already registered");return this.state.registeredVariables[S.name]=S,this.incRef(S,this.backend),S},p.prototype.incRef=function(c,a){var l=this.state.tensorInfo.has(c.dataId)?this.state.tensorInfo.get(c.dataId).refCount:0;if(this.state.numTensors++,c.dtype==="string"&&this.state.numStringTensors++,l===0){this.state.numDataBuffers++;var y=0;c.dtype!=="complex64"&&c.dtype!=="string"&&(y=c.size*Dt(c.dtype)),this.state.tensorInfo.set(c.dataId,{backend:a||this.backend,dtype:c.dtype,shape:c.shape,bytes:y,refCount:0}),this.state.numBytes+=y}this.state.tensorInfo.get(c.dataId).refCount++,c instanceof xt||this.track(c)},p.prototype.disposeTensor=function(c){if(this.state.tensorInfo.has(c.dataId)){this.state.numTensors--,c.dtype==="string"&&this.state.numStringTensors--;var a=this.state.tensorInfo.get(c.dataId);a.refCount<=1?(c.dtype!=="complex64"&&(this.state.numBytes-=a.bytes),this.state.numDataBuffers--,a.backend.disposeData(c.dataId),this.state.tensorInfo.delete(c.dataId)):this.state.tensorInfo.get(c.dataId).refCount--}},p.prototype.disposeVariables=function(){for(var c in this.state.registeredVariables){var a=this.state.registeredVariables[c];this.disposeVariable(a)}},p.prototype.disposeVariable=function(c){this.disposeTensor(c),this.state.registeredVariables[c.name]!=null&&delete this.state.registeredVariables[c.name]},p.prototype.memory=function(){var c=this.backend.memory();return c.numTensors=this.state.numTensors,c.numDataBuffers=this.state.numDataBuffers,c.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(c.unreliable=!0,c.reasons==null&&(c.reasons=[]),c.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),c},p.prototype.profile=function(c){return M(this,void 0,void 0,function(){var a,l;return V(this,function(y){return this.state.profiling=!0,a=this.state.numBytes,l=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=c(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(S){return S.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-a,this.state.activeProfile.newTensors=this.state.numTensors-l,[2,this.state.activeProfile]})})},p.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},p.prototype.addTapeNode=function(c,a,l,y,S,U){var G=this,ae={id:this.state.nextTapeNodeId++,kernelName:c,inputs:a,outputs:l,saved:S},le=J(c);le!=null&&(y=le.gradFunc),y!=null&&(ae.gradient=function(be){return be=be.map(function(Se,Ie){if(Se==null){var Me=l[Ie],qe=nn(Me.size,Me.dtype);return G.makeTensor(qe,Me.shape,Me.dtype)}return Se}),y(be.length>1?be:be[0],S,U)}),this.state.activeTape.push(ae)},p.prototype.keep=function(c){return c.kept=!0,c},p.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},p.prototype.endTape=function(){this.state.gradientDepth--},p.prototype.startScope=function(c){var a={track:[],name:"unnamed scope",id:this.state.nextScopeId++};c&&(a.name=c),this.state.scopeStack.push(a),this.state.activeScope=a},p.prototype.endScope=function(c){for(var a=this,l=Gn(c),y=new Set(l.map(function(ae){return ae.id})),S=0;S<this.state.activeScope.track.length;S++){var U=this.state.activeScope.track[S];U.kept||y.has(U.id)||U.dispose()}var G=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],l.forEach(function(ae){ae.kept||ae.scopeId!==G.id||a.track(ae)})},p.prototype.gradients=function(c,a,l,y){var S=this;if(y===void 0&&(y=!1),Ce(a.length>0,function(){return"gradients() received an empty list of xs."}),l!=null&&l.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+l.dtype+"'");var U=this.scopedRun(function(){return S.startTape()},function(){return S.endTape()},function(){return S.tidy("forward",c)});Ce(U instanceof $t,function(){return"The result y returned by f() must be a tensor."});var G=function(ae,le,be){for(var Se={},Ie={},Me=0;Me<le.length;Me++)Se[le[Me].id]=!0;for(Me=0;Me<ae.length;Me++){var qe=(Qt=ae[Me]).inputs;for(var Ye in qe){for(var Xe=qe[Ye],at=!1,gt=0;gt<le.length;gt++)if(Se[Xe.id]){Qt.outputs.forEach(function(Sn){return Se[Sn.id]=!0}),at=!0,Ie[Qt.id]=!0;break}if(at)break}}var bt={};bt[be.id]=!0;var _t={};for(Me=ae.length-1;Me>=0;Me--)for(qe=(Qt=ae[Me]).inputs,gt=0;gt<Qt.outputs.length;gt++)if(bt[Qt.outputs[gt].id]){for(var Ye in qe)bt[qe[Ye].id]=!0,_t[Qt.id]=!0;break}var jt=[];for(Me=0;Me<ae.length;Me++){var Qt;if(Ie[(Qt=ae[Me]).id]&&_t[Qt.id]){var sn={};for(var Ye in Qt.inputs){var Zt=Qt.inputs[Ye];Se[Zt.id]&&(sn[Ye]=Zt)}var rn=Object.assign({},Qt);rn.inputs=sn,rn.outputs=Qt.outputs,jt.push(rn)}}return jt}(this.state.activeTape,a,U);if(!y&&G.length===0&&a.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var ae,le,be={};be[U.id]=l==null?(le=hn(Qe(ae=U.shape),"float32"),He.makeTensor(le,ae,"float32")):l,function(Ie,Me,qe){for(var Ye=function(at){var gt=Me[at],bt=[];if(gt.outputs.forEach(function(sn){var Zt=Ie[sn.id];Zt!=null?bt.push(Zt):bt.push(null)}),gt.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+gt.kernelName+".");var _t=gt.gradient(bt),jt=function(sn){if(!(sn in _t))throw new Error("Cannot backprop through input "+sn+". Available gradients found: "+Object.keys(_t)+".");var Zt=qe(function(){return _t[sn]()});if(Zt.dtype!=="float32")throw new Error("Error in gradient for op "+gt.kernelName+". The gradient of input "+sn+" must have 'float32' dtype, but has '"+Zt.dtype+"'");var rn=gt.inputs[sn];if(!fn(Zt.shape,rn.shape))throw new Error("Error in gradient for op "+gt.kernelName+". The gradient of input '"+sn+"' has shape '"+Zt.shape+"', which does not match the shape of the input '"+rn.shape+"'");if(Ie[rn.id]==null)Ie[rn.id]=Zt;else{var Sn=Ie[rn.id];Ie[rn.id]=Sn.add(Zt),Sn.dispose()}};for(var Qt in gt.inputs)jt(Qt)},Xe=Me.length-1;Xe>=0;Xe--)Ye(Xe)}(be,G,function(Ie){return S.tidy(Ie)});var Se=a.map(function(Ie){return be[Ie.id]});return S.state.gradientDepth===0&&(S.state.activeTape.forEach(function(Ie){for(var Me=0,qe=Ie.saved;Me<qe.length;Me++)qe[Me].dispose()}),S.state.activeTape=null),{value:U,grads:Se}})},p.prototype.customGrad=function(c){var a=this;return Ce(lr(c),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var l,y=[],S=0;S<arguments.length;S++)y[S]=arguments[S];Ce(y.every(function(G){return G instanceof $t}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var U={};return y.forEach(function(G,ae){U[ae]=G}),a.runKernelFunc(function(G,ae){return Ce((l=c.apply(void 0,y.concat([ae]))).value instanceof $t,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),Ce(lr(l.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),l.value},U,function(G,ae){var le=l.gradFunc(G,ae),be=Array.isArray(le)?le:[le];Ce(be.length===y.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),Ce(be.every(function(Ie){return Ie instanceof $t}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var Se={};return be.forEach(function(Ie,Me){Se[Me]=function(){return Ie}}),Se})}},p.prototype.readSync=function(c){return this.state.tensorInfo.get(c).backend.readSync(c)},p.prototype.read=function(c){return this.state.tensorInfo.get(c).backend.read(c)},p.prototype.time=function(c){return M(this,void 0,void 0,function(){var a,l;return V(this,function(y){switch(y.label){case 0:return a=an(),[4,this.backend.time(c)];case 1:return(l=y.sent()).wallMs=an()-a,[2,l]}})})},p.prototype.track=function(c){return this.state.activeScope!=null&&(c.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(c)),c},Object.defineProperty(p.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),p.prototype.reset=function(){for(var c in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new bn,this.registry)this.disposeRegisteredKernels(c),this.registry[c].dispose(),delete this.registry[c];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},p.nextTensorId=0,p.nextVariableId=0,p}(),He=function(){var p=function(){if(Nt==null){var a=void 0;if(typeof window!="undefined")a=window;else if(g!==void 0)a=g;else if(z!==void 0)a=z;else{if(typeof self=="undefined")throw new Error("Could not find a global object");a=self}Nt=a}return Nt}();if(p._tfengine==null){var c=new $(p);p._tfengine=new Yt(c)}return function(a){te=a}(p._tfengine.ENV),Ui=function(){return p._tfengine},p._tfengine}();function $n(){return typeof window!="undefined"&&window.document!=null||typeof WorkerGlobalScope!="undefined"}var ur=W();ur.registerFlag("DEBUG",function(){return!1},function(p){p&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),ur.registerFlag("IS_BROWSER",function(){return $n()}),ur.registerFlag("IS_NODE",function(){return z!==void 0&&z.versions!==void 0&&z.versions.node!==void 0}),ur.registerFlag("IS_CHROME",function(){return typeof navigator!="undefined"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),ur.registerFlag("PROD",function(){return!1}),ur.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return ur.getBool("DEBUG")}),ur.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),ur.registerFlag("IS_TEST",function(){return!1});var pr,kr,ui,Ir={},ji={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Do(p,c){Ir[p]=c}function Bi(p){p in Ir||(Ir[p]=function(a){if(a!==1&&a!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var l=function(y){if(typeof OffscreenCanvas!="undefined"&&y===2)return new OffscreenCanvas(300,150);if(typeof document!="undefined")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(a);return l.addEventListener("webglcontextlost",function(y){y.preventDefault(),delete Ir[a]},!1),a===1?l.getContext("webgl",ji)||l.getContext("experimental-webgl",ji):l.getContext("webgl2",ji)}(p));var c=Ir[p];return c.isContextLost()?(delete Ir[p],Bi(p)):(c.disable(c.DEPTH_TEST),c.disable(c.STENCIL_TEST),c.disable(c.BLEND),c.disable(c.DITHER),c.disable(c.POLYGON_OFFSET_FILL),c.disable(c.SAMPLE_COVERAGE),c.enable(c.SCISSOR_TEST),c.enable(c.CULL_FACE),c.cullFace(c.BACK),Ir[p])}function no(p,c){return[c,p]}function $i(p){var c=Qe(p);return Vt(Math.ceil(c/4))}function mi(p,c){return[Math.max(1,Math.ceil(c/2)),Math.max(1,Math.ceil(p/2))]}function ai(p,c){var a,l,y,S,U,G,ae,le,be,Se=p;return W().getNumber("WEBGL_VERSION")===2?(a=Se.R32F,l=Se.R16F,y=Se.RGBA16F,S=Se.RGBA32F,U=Se.RED,G=4,ae=1,le=Se.HALF_FLOAT,be=Se.FLOAT):(a=p.RGBA,l=p.RGBA,y=p.RGBA,S=Se.RGBA,U=p.RGBA,G=4,ae=4,le=c!=null?c.HALF_FLOAT_OES:null,be=p.FLOAT),{internalFormatFloat:a,internalFormatHalfFloat:l,internalFormatPackedHalfFloat:y,internalFormatPackedFloat:S,textureFormatFloat:U,downloadTextureFormat:p.RGBA,downloadUnpackNumChannels:G,defaultNumChannels:ae,textureTypeHalfFloat:le,textureTypeFloat:be}}function qn(p,c,a){var l=a();return c&&function(y){var S=y.getError();if(S!==y.NO_ERROR)throw new Error("WebGL Error: "+Wo(y,S))}(p),l}(function(p){p[p.DENSE=0]="DENSE",p[p.SHARED_BATCH=1]="SHARED_BATCH"})(pr||(pr={})),function(p){p[p.RENDER=0]="RENDER",p[p.UPLOAD=1]="UPLOAD",p[p.PIXELS=2]="PIXELS",p[p.DOWNLOAD=3]="DOWNLOAD"}(kr||(kr={})),function(p){p[p.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",p[p.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",p[p.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",p[p.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",p[p.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(ui||(ui={}));var Di=596e-10,ko=65504;function Zr(p){return!!(W().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||p===0||Di<Math.abs(p)&&Math.abs(p)<ko)}function Wo(p,c){switch(c){case p.NO_ERROR:return"NO_ERROR";case p.INVALID_ENUM:return"INVALID_ENUM";case p.INVALID_VALUE:return"INVALID_VALUE";case p.INVALID_OPERATION:return"INVALID_OPERATION";case p.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case p.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case p.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+c}}function Oo(p,c,a){return Ga(p,c,function(){return p.getExtension(a)},'Extension "'+a+'" not supported on this browser.')}function So(p,c,a){var l=Ga(p,c,function(){return p.createShader(p.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(qn(p,c,function(){return p.shaderSource(l,a)}),qn(p,c,function(){return p.compileShader(l)}),p.getShaderParameter(l,p.COMPILE_STATUS)===!1)throw console.log(p.getShaderInfoLog(l)),new Error("Failed to compile vertex shader.");return l}function To(p,c,a){var l=Ga(p,c,function(){return p.createShader(p.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(qn(p,c,function(){return p.shaderSource(l,a)}),qn(p,c,function(){return p.compileShader(l)}),p.getShaderParameter(l,p.COMPILE_STATUS)===!1)throw function(y,S){var U=Cf.exec(S);if(U==null)return console.log("Couldn't parse line number in error: "+S),void console.log(y);for(var G=+U[1],ae=y.split(`
`),le=ae.length.toString().length+2,be=ae.map(function(Xe,at){return En((at+1).toString(),le)+Xe}),Se=0,Ie=0;Ie<be.length;Ie++)Se=Math.max(be[Ie].length,Se);var Me=be.slice(0,G-1),qe=be.slice(G-1,G),Ye=be.slice(G);console.log(Me.join(`
`)),console.log(S.split(`
`)[0]),console.log("%c "+En(qe[0],Se),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(Ye.join(`
`))}(a,p.getShaderInfoLog(l)),new Error("Failed to compile fragment shader.");return l}var ds,As,Cf=/ERROR: [0-9]+:([0-9]+):/g;function eo(p,c){return Ga(p,c,function(){return p.createProgram()},"Unable to create WebGLProgram.")}function bu(p,c,a){if(qn(p,c,function(){return p.linkProgram(a)}),p.getProgramParameter(a,p.LINK_STATUS)===!1)throw console.log(p.getProgramInfoLog(a)),new Error("Failed to link vertex and fragment shaders.")}function wc(p,c,a){if(qn(p,c,function(){return p.validateProgram(a)}),p.getProgramParameter(a,p.VALIDATE_STATUS)===!1)throw console.log(p.getProgramInfoLog(a)),new Error("Shader program validation failed.")}function kc(p,c,a){var l=Ga(p,c,function(){return p.createBuffer()},"Unable to create WebGLBuffer");return qn(p,c,function(){return p.bindBuffer(p.ARRAY_BUFFER,l)}),qn(p,c,function(){return p.bufferData(p.ARRAY_BUFFER,a,p.STATIC_DRAW)}),l}function _c(p,c,a){var l=Ga(p,c,function(){return p.createBuffer()},"Unable to create WebGLBuffer");return qn(p,c,function(){return p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,l)}),qn(p,c,function(){return p.bufferData(p.ELEMENT_ARRAY_BUFFER,a,p.STATIC_DRAW)}),l}function ws(p,c){return Ga(p,c,function(){return p.createTexture()},"Unable to create WebGLTexture.")}function Ql(p,c){var a=W().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(p<=0||c<=0){var l="["+p+"x"+c+"]";throw new Error("Requested texture size "+l+" is invalid.")}if(p>a||c>a)throw l="["+p+"x"+c+"]",new Error("Requested texture size "+l+" greater than WebGL maximum on this browser / GPU ["+a+"x"+a+"].")}function Hs(p,c){return Ga(p,c,function(){return p.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Mc(p,c,a,l,y,S,U,G){var ae=p.getAttribLocation(a,l);return ae!==-1&&(qn(p,c,function(){return p.bindBuffer(p.ARRAY_BUFFER,y)}),qn(p,c,function(){return p.vertexAttribPointer(ae,S,p.FLOAT,!1,U,G)}),qn(p,c,function(){return p.enableVertexAttribArray(ae)}),!0)}function Af(p,c,a,l){Kc(p,l),qn(p,c,function(){return p.activeTexture(p.TEXTURE0+l)}),qn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,a)})}function Gs(p,c,a,l){return Ga(p,c,function(){return p.getUniformLocation(a,l)},'uniform "'+l+'" not present in program.')}function Zl(p,c,a){return p.getUniformLocation(c,a)}function pl(p,c,a,l,y,S){qn(p,c,function(){return Af(p,c,l,S)}),qn(p,c,function(){return p.uniform1i(y,S)})}function ml(p,c,a,l){qn(p,c,function(){return p.bindFramebuffer(p.FRAMEBUFFER,l)}),qn(p,c,function(){return p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,a,0)})}function Gc(p,c,a){qn(p,c,function(){return p.bindFramebuffer(p.FRAMEBUFFER,a)}),qn(p,c,function(){return p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,null,0)})}function ha(p){var c=p.checkFramebufferStatus(p.FRAMEBUFFER);if(c!==p.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+$c(p,c))}function $c(p,c){switch(c){case p.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case p.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case p.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case p.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+c}}function Ga(p,c,a,l){var y=qn(p,c,function(){return a()});if(y==null)throw new Error(l);return y}function Kc(p,c){var a=p.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,l=c+p.TEXTURE0;if(l<p.TEXTURE0||l>a)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+a+"].")}function Is(p,c){return c===void 0&&(c=2),Qe(p.slice(0,p.length-c))}function Ba(p){if(p.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[p.length>1?p[p.length-2]:1,p[p.length-1]]}function jc(p){var c=[1,1,1];return p.length===0||p.length===1&&p[0]===1||(c=[Is(p)].concat(Ba(p))),c}function ac(p,c){var a;c===void 0&&(c=!1);var l=W().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(c&&(l*=2,(p=p.map(function(le,be){return be>=p.length-2?Xt(p[be]):p[be]})).length===1&&(p=[2,p[0]])),p.length!==2){var y=Hn(p);p=y.newShape}var S=Qe(p);if(p.length<=1&&S<=l)return[1,S];if(p.length===2&&p[0]<=l&&p[1]<=l)return p;if(p.length===3&&p[0]*p[1]<=l&&p[2]<=l)return[p[0]*p[1],p[2]];if(p.length===3&&p[0]<=l&&p[1]*p[2]<=l)return[p[0],p[1]*p[2]];if(p.length===4&&p[0]*p[1]*p[2]<=l&&p[3]<=l)return[p[0]*p[1]*p[2],p[3]];if(p.length===4&&p[0]<=l&&p[1]*p[2]*p[3]<=l)return[p[0],p[1]*p[2]*p[3]];if(c){var U=Is(p),G=2,ae=2;return p.length&&(G=(a=Ba(p))[0],ae=a[1]),Vt(S=U*(G/2)*(ae/2)).map(function(le){return 2*le})}return Vt(S)}function Xc(p){return p%2==0}function eu(p,c){if(fn(p=p.slice(-2),c=c.slice(-2))||!p.length||!c.length||p[0]===0||p[1]===0||c[0]===0||c[1]===0)return!0;if(p.length!==c.length){var a=p.slice(-1)[0],l=c.slice(-1)[0];if(a===l||Xc(a)&&Xc(l)&&(p[0]===1||c[0]===1))return!0}return p[1]===c[1]&&Xc(p[0])&&Xc(c[0])}function ps(p){if(ds==null){var c=Bi(p);ds=c.getParameter(c.MAX_TEXTURE_SIZE)}return ds}function ef(p){if(As==null){var c=Bi(p);As=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,As)}function Yc(p){if(p===0)return 0;var c=Bi(p);return na(c,"EXT_disjoint_timer_query_webgl2")&&p===2?2:na(c,"EXT_disjoint_timer_query")?1:0}function na(p,c){return p.getExtension(c)!=null}function Xf(p){try{if(Bi(p)!=null)return!0}catch{return!1}return!1}function Jc(p){if(p===0)return!1;var c=Bi(p);if(p===1){if(!na(c,"OES_texture_float"))return!1}else if(!na(c,"EXT_color_buffer_float"))return!1;return da(c)}function Of(p){if(p===0)return!1;var c=Bi(p);return p!==1?na(c,"EXT_color_buffer_float")?da(c):!!na(c,"EXT_color_buffer_half_float")&&function(a,l){var y=ai(a,l),S=a.createTexture();a.bindTexture(a.TEXTURE_2D,S),a.texImage2D(a.TEXTURE_2D,0,y.internalFormatHalfFloat,1,1,0,y.textureFormatFloat,y.textureTypeHalfFloat,null);var U=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,U),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,S,0);var G=a.checkFramebufferStatus(a.FRAMEBUFFER)===a.FRAMEBUFFER_COMPLETE;return a.bindTexture(a.TEXTURE_2D,null),a.bindFramebuffer(a.FRAMEBUFFER,null),a.deleteTexture(S),a.deleteFramebuffer(U),G}(c,c.getExtension("EXT_color_buffer_half_float")):!!na(c,"OES_texture_float")&&!!na(c,"WEBGL_color_buffer_float")&&da(c)}function da(p){var c=ai(p),a=p.createTexture();p.bindTexture(p.TEXTURE_2D,a),p.texImage2D(p.TEXTURE_2D,0,c.internalFormatFloat,1,1,0,c.textureFormatFloat,c.textureTypeFloat,null);var l=p.createFramebuffer();p.bindFramebuffer(p.FRAMEBUFFER,l),p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,a,0);var y=p.checkFramebufferStatus(p.FRAMEBUFFER)===p.FRAMEBUFFER_COMPLETE;return p.bindTexture(p.TEXTURE_2D,null),p.bindFramebuffer(p.FRAMEBUFFER,null),p.deleteTexture(a),p.deleteFramebuffer(l),y}function Qi(p){return p===2&&Bi(p).fenceSync!=null}var xi=Object.freeze({callAndCheck:qn,canBeRepresented:Zr,getWebGLErrorMessage:Wo,getExtensionOrThrow:Oo,createVertexShader:So,createFragmentShader:To,createProgram:eo,linkProgram:bu,validateProgram:wc,createStaticVertexBuffer:kc,createStaticIndexBuffer:_c,getNumChannels:function(){return W().getNumber("WEBGL_VERSION")===2?1:4},createTexture:ws,validateTextureSize:Ql,createFramebuffer:Hs,bindVertexBufferToProgramAttribute:Mc,bindTextureUnit:Af,unbindTextureUnit:function(p,c,a){Kc(p,a),qn(p,c,function(){return p.activeTexture(p.TEXTURE0+a)}),qn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:Gs,getProgramUniformLocation:Zl,bindTextureToProgramUniformSampler:pl,bindCanvasToFramebuffer:function(p,c){qn(p,c,function(){return p.bindFramebuffer(p.FRAMEBUFFER,null)}),qn(p,c,function(){return p.viewport(0,0,p.canvas.width,p.canvas.height)}),qn(p,c,function(){return p.scissor(0,0,p.canvas.width,p.canvas.height)})},bindColorTextureToFramebuffer:ml,unbindColorTextureFromFramebuffer:Gc,validateFramebuffer:ha,getFramebufferErrorMessage:$c,getBatchDim:Is,getRowsCols:Ba,getShapeAs3D:jc,getTextureShapeFromLogicalShape:ac,isReshapeFree:eu,getWebGLMaxTextureSize:ps,resetMaxTextureSize:function(){ds=null},resetMaxTexturesInShader:function(){As=null},getMaxTexturesInShader:ef,getWebGLDisjointQueryTimerVersion:Yc,hasExtension:na,isWebGLVersionEnabled:Xf,isCapableOfRenderingToFloatTexture:Jc,isDownloadFloatTextureEnabled:Of,isWebGLFenceEnabled:Qi}),hr=W();function is(){W().set("PROD",!0)}function Nh(){W().set("DEBUG",!0)}function No(){W().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Qc(p){W().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(p+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Yf(){He.disposeVariables()}function zp(){return He}function tu(){return He.memory()}function Ih(p){return He.profile(p)}function so(p,c){return He.tidy(p,c)}function Oa(p){Gn(p).forEach(function(c){return c.dispose()})}function Fh(p){return He.keep(p)}function Zc(p){return He.time(p)}function Rh(p){return He.setBackend(p)}function Xd(){return He.ready()}function Tu(){return He.backendName}function Tl(p){He.removeBackend(p)}function Yd(p){return He.findBackend(p)}function Up(p){return He.findBackendFactory(p)}function Ec(p,c,a){return a===void 0&&(a=1),He.registerBackend(p,c,a)}function Sg(){return He.backend}function el(p,c){W().setPlatform(p,c)}function Jf(){for(var p=[],c=0;c<arguments.length;c++)p[c]=arguments[c];W().getBool("IS_TEST")||console.warn.apply(console,p)}function $s(p,c){var a=p;if(yt(p))return c==="string"?[]:[p.length];if(!Array.isArray(p))return[];for(var l=[];Array.isArray(a)||yt(a)&&c!=="string";)l.push(a.length),a=a[0];return Array.isArray(p)&&W().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function y(S,U,G){if(G=G||[],Array.isArray(S)||yt(S)){Ce(U.length>0,function(){return"Element arr["+G.join("][")+"] should be a primitive, but is an array of "+S.length+" elements"}),Ce(S.length===U[0],function(){return"Element arr["+G.join("][")+"] should have "+U[0]+" elements, but has "+S.length+" elements"});for(var ae=U.slice(1),le=0;le<S.length;++le)y(S[le],ae,G.concat(le))}else Ce(U.length===0,function(){return"Element arr["+G.join("][")+"] is a primitive, but should be an array/TypedArray of "+U[0]+" elements"})}(p,l,[]),l}function gl(p,c,a,l){if(p!=null&&(p!=="numeric"&&p!==c||p==="numeric"&&c==="string"))throw new Error("Argument '"+a+"' passed to '"+l+"' must be "+p+" tensor, but got "+c+" tensor")}function Ze(p,c,a,l){if(l===void 0&&(l="numeric"),p instanceof $t)return gl(l,p.dtype,c,a),p;var y=we(p);if(y!=="string"&&["bool","int32","float32"].indexOf(l)>=0&&(y=l),gl(l,y,c,a),p==null||!yt(p)&&!Array.isArray(p)&&typeof p!="number"&&typeof p!="boolean"&&typeof p!="string"){var S=p==null?"null":p.constructor.name;throw new Error("Argument '"+c+"' passed to '"+a+"' must be a Tensor or TensorLike, but got '"+S+"'")}var U=$s(p,y);yt(p)||Array.isArray(p)||(p=[p]);var G=y!=="string"?qr(p,y,W().getBool("DEBUG")):Ut(p,[],!0);return He.makeTensor(G,U,y)}function tl(p,c,a,l){if(l===void 0&&(l="numeric"),!Array.isArray(p))throw new Error("Argument "+c+" passed to "+a+" must be a `Tensor[]` or `TensorLike[]`");return p.map(function(y,S){return Ze(y,c+"["+S+"]",a)},l)}function es(p,c){for(var a=0;a<p.length;++a)if(p[p.length-a-1]!==c-1-a)return!1;return!0}function Nl(p,c,a){for(var l=p.length+c.length,y=[],S=0,U=0,G=0;G<l;G++)a.indexOf(G)===-1?y.push(p[S++]):y.push(c[U++]);return y}function pa(p,c){for(var a=[],l=p.length,y=0;y<l;y++)c.indexOf(y)===-1&&a.push(p[y]);return[a,c.map(function(S){return p[S]})]}function Ea(p,c){return Nl(p,c.map(function(a){return 1}),c)}function La(p,c,a){Ce(es(c,a),function(){return p+" supports only inner-most axes for now. Got axes "+c+" and rank-"+a+" input."})}function Fs(p,c){if(es(p,c))return null;for(var a=[],l=0;l<c;++l)p.indexOf(l)===-1&&a.push(l);return p.forEach(function(y){return a.push(y)}),a}function vl(p){return p.map(function(c,a){return[a,c]}).sort(function(c,a){return c[1]-a[1]}).map(function(c){return c[0]})}function Rs(p,c){for(var a=[],l=c-p;l<c;++l)a.push(l);return a}function tf(p,c){var a=p[0].length;p.forEach(function(y,S){Ce(y.length===a,function(){return"Error in concat"+a+"D: rank of tensors["+S+"] must be the same as the rank of the rest ("+a+")"})}),Ce(c>=0&&c<a,function(){return"Error in concat"+a+"D: axis must be between 0 and "+(a-1)+"."});var l=p[0];p.forEach(function(y,S){for(var U=0;U<a;U++)Ce(U===c||y[U]===l[U],function(){return"Error in concat"+a+"D: Shape of tensors["+S+"] ("+y+") does not match the shape of the rest ("+l+") along the non-concatenated axis "+S+"."})})}function Ku(p,c){for(var a=p[0].slice(),l=1;l<p.length;l++)a[c]+=p[l][c];return a}function Tt(p){var c=Object.keys(p);if(c.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+c.length+" keys.");var a=c[0],l=p[a];a.endsWith("_")&&(a=a.substring(0,a.length-1));var y=function(){for(var S=[],U=0;U<arguments.length;U++)S[U]=arguments[U];He.startScope(a);try{var G=l.apply(void 0,S);return G instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),He.endScope(G),G}catch(ae){throw He.endScope(null),ae}};return Object.defineProperty(y,"name",{value:a,configurable:!0}),y}hr.registerFlag("HAS_WEBGL",function(){return hr.getNumber("WEBGL_VERSION")>0}),hr.registerFlag("WEBGL_VERSION",function(){return Xf(2)?2:Xf(1)?1:0}),hr.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return hr.get("WEBGL_VERSION")===2}),hr.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),hr.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),hr.registerFlag("WEBGL_PACK",function(){return hr.getBool("HAS_WEBGL")}),hr.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return hr.getBool("WEBGL_PACK")}),hr.registerFlag("WEBGL_PACK_CLIP",function(){return hr.getBool("WEBGL_PACK")}),hr.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),hr.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return hr.getBool("WEBGL_PACK")}),hr.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return hr.getBool("WEBGL_PACK")}),hr.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return hr.getBool("WEBGL_PACK")}),hr.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return hr.getBool("WEBGL_PACK")}),hr.registerFlag("WEBGL_PACK_REDUCE",function(){return hr.getBool("WEBGL_PACK")}),hr.registerFlag("WEBGL_LAZILY_UNPACK",function(){return hr.getBool("WEBGL_PACK")}),hr.registerFlag("WEBGL_CONV_IM2COL",function(){return hr.getBool("WEBGL_PACK")}),hr.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return ps(hr.getNumber("WEBGL_VERSION"))}),hr.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return ef(hr.getNumber("WEBGL_VERSION"))}),hr.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var p=hr.getNumber("WEBGL_VERSION");return p===0?0:Yc(p)}),hr.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return hr.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(p=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(p)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(p.substr(0,4))));var p}),hr.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Jc(hr.getNumber("WEBGL_VERSION"))}),hr.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!hr.getBool("WEBGL_FORCE_F16_TEXTURES")&&hr.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),hr.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return Of(hr.getNumber("WEBGL_VERSION"))}),hr.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return Qi(hr.getNumber("WEBGL_VERSION"))}),hr.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return hr.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),$r=Qc;var aa=Tt({complex_:function(p,c){var a=Ze(p,"real","complex"),l=Ze(c,"imag","complex");return Wt(a.shape,l.shape,"real and imag shapes, "+a.shape+" and "+l.shape+", must match in call to tf.complex()."),He.runKernelFunc(function(y){return y.complex(a,l)},{$real:a,$imag:l})}}),ms=Tt({real_:function(p){var c=Ze(p,"input","real");return He.runKernelFunc(function(a){return a.real(c)},{$input:c})}}),Ks=Tt({imag_:function(p){var c=Ze(p,"input","imag");return He.runKernelFunc(function(a){return a.imag(c)},{$input:c})}});function la(p,c,a){return xu(p,c,$s(p,a),a)}function xu(p,c,a,l){if(l==null&&(l=we(p)),l==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!yt(p)&&!Array.isArray(p)&&typeof p!="number"&&typeof p!="boolean"&&typeof p!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(c!=null){or(c);var y=Qe(c),S=Qe(a);Ce(y===S,function(){return"Based on the provided shape, ["+c+"], the tensor should have "+y+" values but has "+S});for(var U=0;U<a.length;++U){var G=a[U],ae=U!==a.length-1||G!==Qe(c.slice(U));Ce(a[U]===c[U]||!ae,function(){return"Error creating a new Tensor. Inferred shape ("+a+") does not match the provided shape ("+c+"). "})}}return yt(p)||Array.isArray(p)||(p=[p]),c=c||a,p=l!=="string"?qr(p,l,W().getBool("DEBUG")):Ut(p,[],!0),He.makeTensor(p,c,l)}function Mr(p,c){if((yt(p)&&c!=="string"||Array.isArray(p))&&c!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(c==="string"&&yt(p)&&!(p instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return xu(p,[],[],c)}function Cc(p,c){en(p);var a=$s(p,c);if(a.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return xu(p,null,a,c)}function sc(p,c,a){if(en(p),c!=null&&c.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var l=$s(p,a);if(l.length!==2&&l.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(l.length===1&&c==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return xu(p,c,l,a)}function nf(p,c,a){if(en(p),c!=null&&c.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var l=$s(p,a);if(l.length!==3&&l.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(l.length===1&&c==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return xu(p,c,l,a)}function Ac(p,c,a){if(en(p),c!=null&&c.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var l=$s(p,a);if(l.length!==4&&l.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(l.length===1&&c==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return xu(p,c,l,a)}function yd(p,c,a){if(en(p),c!=null&&c.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var l=$s(p,a);if(l.length!==5&&l.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(l.length===1&&c==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return xu(p,c,l,a)}function uc(p,c,a){if(en(p),c!=null&&c.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var l=$s(p,a);if(l.length!==6&&l.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(l.length===1&&c==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return xu(p,c=c||l,l,a)}function bd(p,c,a,l){return c===void 0&&(c=!0),He.makeVariable(p,c,a,l)}function Xu(p,c){if(c===void 0&&(c="float32"),c==="complex64"){var a=Xu(p,"float32"),l=Io(p,"float32");return aa(a,l)}var y=hn(Qe(p),c);return He.makeTensor(y,p,c)}function Io(p,c){if(c===void 0&&(c="float32"),c==="complex64"){var a=Io(p,"float32"),l=Io(p,"float32");return aa(a,l)}var y=nn(Qe(p),c);return He.makeTensor(y,p,c)}function Nu(p,c,a){return He.runKernelFunc(function(l){return l.fill(p,c,a)},{})}function Jd(p,c,a){if(a<=0)throw new Error("The number of values should be positive.");return He.runKernelFunc(function(l){return l.linspace(p,c,a)},{})}function rf(p,c,a,l){if(a===void 0&&(a=1),l===void 0&&(l="float32"),a===0)throw new Error("Cannot have a step of zero");if(p===c||p<c&&a<0||c<p&&a>1)return Io([0],l);var y=nn(Math.abs(Math.ceil((c-p)/a)),l);c<p&&a===1&&(a=-1),y[0]=p;for(var S=1;S<y.length;S++)y[S]=y[S-1]+a;return Cc(y,l)}var Iu=Tt({onesLike_:function(p){var c=Ze(p,"x","onesLike");if(c.dtype==="complex64"){var a=Iu(ms(c)),l=Ri(Ks(c));return aa(a,l)}return He.runKernelFunc(function(y){return y.onesLike(c)},{x:c},function(y,S){return{x:function(){return Ri(y)}}},"OnesLike")}}),Ri=Tt({zerosLike_:function(p){var c=Ze(p,"x","zerosLike");return He.runKernelFunc(function(a){return a.zerosLike(c)},{x:c},function(a,l){return{x:function(){return Ri(a)}}},"ZerosLike")}}),$a=Tt({concat_:function(p,c){c===void 0&&(c=0),Ce(p.length>=1,function(){return"Pass at least one tensor to concat"});var a=tl(p,"tensors","concat");a[0].dtype==="complex64"&&a.forEach(function(G){if(G.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+G.dtype+". ")}),c=Tn(c,a[0].shape)[0];var l=Ku(a.map(function(G){return G.shape}),c);if(Qe(l)===0)return la([],l);if((a=a.filter(function(G){return G.size>0})).length===1)return a[0];var y=a.map(function(G){return G.shape});tf(y,c);var S=a,U={axis:c};return He.runKernelFunc(function(G){return G.concat(a,c)},S,function(G){var ae=y.map(function(le){return le[c]});return _o(G,ae,c).map(function(le){return function(){return le}})},"Concat",U)}}),of=Tt({concat1d_:function(p){return $a(p,0)}}),Wp=Tt({concat2d_:function(p,c){return $a(p,c)}}),Mh=Tt({concat3d_:function(p,c){return $a(p,c)}}),jh=Tt({concat4d_:function(p,c){return $a(p,c)}}),_o=Tt({split_:function(p,c,a){a===void 0&&(a=0);var l,y=Ze(p,"x","split");return a=Tn(a,y.shape)[0],typeof c=="number"?(Ce(y.shape[a]%c==0,function(){return"Number of splits must evenly divide the axis."}),l=new Array(c).fill(y.shape[a]/c)):(Ce(y.shape[a]===c.reduce(function(S,U){return S+U}),function(){return"The sum of sizes must match the size of the axis dimension."}),l=c),He.runKernelFunc(function(S){return S.split(y,l,a)},{$x:y},function(S){return{$x:function(){return $a(S,a)}}})}});function Ki(p,c,a){return c===void 0&&(c="float32"),c=c||"float32",or(p),new Gi(p,c,a)}function Ka(p,c){c===void 0&&(c=!1),console.log(p.toString(c))}var Vp=Tt({batchToSpaceND_:function(p,c,a){var l=Ze(p,"x","batchToSpaceND"),y=c.reduce(function(S,U){return S*U});return Ce(l.rank>=1+c.length,function(){return"input rank is "+l.rank+" but should be > than blockShape.length "+c.length}),Ce(a.length===c.length,function(){return"crops.length is "+a.length+" but should be equal to blockShape.length  "+c.length}),Ce(l.shape[0]%y==0,function(){return"input tensor batch is "+l.shape[0]+" but is not divisible by the product of the elements of blockShape "+c.join(" * ")+" === "+y}),He.runKernelFunc(function(S){return S.batchToSpaceND(l,c,a)},{$x:l},function(S){return{$x:function(){return S.spaceToBatchND(c,a)}}})}}),qp=Tt({cast_:function(p,c){var a=Ze(p,"x","cast");if(!et(c))throw new Error("Failed to cast to unknown dtype "+c);if(c==="string"&&a.dtype!=="string"||c!=="string"&&a.dtype==="string")throw new Error("Only strings can be casted to strings");var l={dtype:c};return He.runKernelFunc(function(y){return y.cast(a,c)},{x:a},function(y){return{x:function(){return y.clone()}}},"Cast",l)}}),Hp=Tt({cumsum_:function(p,c,a,l){c===void 0&&(c=0),a===void 0&&(a=!1),l===void 0&&(l=!1);var y=Ze(p,"x","cumsum"),S=Fs([c|=0],y.rank),U=y;S!=null&&(U=y.transpose(S));var G=Rs(1,y.rank)[0],ae=He.runKernelFunc(function(le){return le.cumsum(U,G,a,l)},{permutedX:U},function(le){return{permutedX:function(){return le.cumsum(c,a,!l)}}});return S!=null&&(ae=ae.transpose(S)),ae}}),Qf=Tt({depthToSpace_:function(p,c,a){a===void 0&&(a="NHWC");var l=Ze(p,"x","depthToSpace"),y=a==="NHWC"?l.shape[1]:l.shape[2],S=a==="NHWC"?l.shape[2]:l.shape[3],U=a==="NHWC"?l.shape[3]:l.shape[1];return Ce(y*c>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+y+" and "+c+`  for depthToSpace with input shape
      `+l.shape}),Ce(S*c>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+S+" and "+c+` for depthToSpace with input shape
          `+l.shape}),Ce(U%(c*c)==0,function(){return"Dimension size must be evenly divisible by "+c*c+" but is "+U+" for depthToSpace with input shape "+l.shape}),He.runKernelFunc(function(G){return G.depthToSpace(l,c,a)},{$x:l})}}),nu=Tt({expandDims_:function(p,c){c===void 0&&(c=0);var a=Ze(p,"x","expandDims",null);Ce(c<=a.rank,function(){return"Axis must be <= rank of the tensor"});var l=a.shape.slice();return c<0&&(Ce(-(a.rank+1)<=c,function(){return"Axis must be in the interval ["+-(a.rank+1)+", "+a.rank+"]"}),c=a.rank+c+1),l.splice(c,0,1),Fu(a,l)}}),Fu=Tt({reshape_:function(p,c){var a=Ze(p,"x","reshape",null);c=Rt(c,a.size),Ce(a.size===Qe(c),function(){return"new shape and old shape must have the same number of elements."});var l={shape:c};return He.runKernelFunc(function(y){return y.reshape(a,c)},{x:a},function(y){return{x:function(){return y.reshape(a.shape)}}},"Reshape",l)}}),Zf=Tt({spaceToBatchND_:function(p,c,a){var l=Ze(p,"x","spaceToBatchND");return Ce(l.rank>=1+c.length,function(){return"input rank "+l.rank+" should be > than [blockShape] "+c.length}),Ce(a.length===c.length,function(){return"paddings.shape[0] "+a.length+" must be equal to [blockShape] "+c.length}),Ce(l.shape.reduce(function(y,S,U){return U>0&&U<=c.length?y&&(S+a[U-1][0]+a[U-1][1])%c[U-1]==0:y},!0),function(){return"input spatial dimensions "+l.shape.slice(1)+" with paddings "+a.toString()+" must be divisible by blockShapes "+c.toString()}),He.runKernelFunc(function(y){return y.spaceToBatchND(l,c,a)},{$x:l},function(y){return{$x:function(){return y.batchToSpaceND(c,a)}}})}}),cc=Tt({squeeze_:function(p,c){var a=Ze(p,"x","squeeze");return Fu(a,Hn(a.shape,c).newShape)}}),Bc=Tt({stack_:function(p,c){c===void 0&&(c=0);var a=tl(p,"tensors","stack");if(Ce(a.length>=1,function(){return"Pass at least one tensor to tf.stack"}),a.length===1)return a[0].expandDims(c);var l=a[0].rank,y=a[0].shape,S=a[0].dtype;Ce(c<=l,function(){return"Axis must be <= rank of the tensor"}),a.forEach(function(G){Wt(y,G.shape,"All tensors passed to stack must have matching shapes")}),a.forEach(function(G){Ce(S===G.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var U=a.map(function(G){return G.expandDims(c)});return $a(U,c)}}),Qd=Tt({unstack_:function(p,c){c===void 0&&(c=0),c=c||0;var a=Ze(p,"x","unstack");Ce(c>=-a.shape.length&&c<a.shape.length,function(){return"Axis = "+c+" is not in [-"+a.shape.length+", "+a.shape.length+")"}),c<0&&(c+=a.shape.length);var l={axis:c};return He.runKernelFunc(function(y){return y.unstack(a,c)},{x:a},function(y){return{x:function(){return Bc(y,c)}}},"Unpack",l)}}),wo=function(p,c){return M(this,void 0,void 0,function(){var a,l,y,S,U,G,ae,le,be,Se;return V(this,function(Ie){switch(Ie.label){case 0:return a=Ze(p,"x","setdiff1d"),l=Ze(c,"y","setdiff1d"),Ce(a.dtype===l.dtype,function(){return"x and y should have the same dtype, but got x ("+a.dtype+") and y ("+l.dtype+")."}),Ce(a.rank===1,function(){return"x should be 1D tensor, but got x ("+a.shape+")."}),Ce(l.rank===1,function(){return"y should be 1D tensor, but got y ("+l.shape+")."}),[4,a.data()];case 1:return y=Ie.sent(),[4,l.data()];case 2:for(S=Ie.sent(),U=new Set(S),G=0,be=0;be<y.length;be++)U.has(y[be])||G++;for(ae=new Gi([G],a.dtype),le=new Gi([G],"int32"),be=0,Se=0;be<y.length;be++)U.has(y[be])||(ae.values[Se]=y[be],le.values[Se]=be,Se++);return[2,[ae.toTensor(),le.toTensor()]]}})})};function Il(p,c,a,l){l===void 0&&(l=!0);var y=[];if(l)(y=y.concat(c.slice(0))).push(p[0]/a),y=y.concat(p.slice(1));else{y=y.concat(p[0]);for(var S=c.length,U=0;U<S;++U)y=y.concat([p[U+1]/c[U],c[U]]);y=y.concat(p.slice(S+1))}return y}function cr(p,c,a){a===void 0&&(a=!0);var l=[];if(a){l.push(c);for(var y=c+1;y<p;++y)y<=2*c?(l.push(y),l.push(y-(c+1))):l.push(y)}else{var S=[],U=[];for(y=1;y<p;++y)y>=2*c+1||y%2==1?U.push(y):S.push(y);l.push.apply(l,S),l.push(0),l.push.apply(l,U)}return l}function jr(p,c,a,l){l===void 0&&(l=!0);var y=[];l?y.push(p[0]/a):y.push(p[0]*a);for(var S=1;S<p.length;++S)S<=c.length?l?y.push(c[S-1]*p[S]):y.push(p[S]/c[S-1]):y.push(p[S]);return y}function Or(p,c){for(var a=[0],l=0;l<c;++l)a.push(p[l][0]);return a}function Mi(p,c,a){for(var l=p.slice(0,1),y=0;y<a;++y)l.push(p[y+1]-c[y][0]-c[y][1]);return l}var go="Add",Ca="AddN",Eo="Div",za="FusedBatchNorm",Sf="SquaredDifference",Zd="Square",Ru="Transpose",Fl="NonMaxSuppressionV5",Df="BroadcastTo",af="OneHot",Tf="Identity",sf="Tile",ma="PadV2",Dg="FromPixels",eh="MaxPoolWithArgmax",Ua=Tt({add_:function(p,c){var a,l=Ze(p,"a","add"),y=Ze(c,"b","add");a=_n(l,y),l=a[0],y=a[1];var S={a:l,b:y};return He.runKernelFunc(function(U,G){var ae=U.add(l,y);return G([l,y]),ae},S,null,go)}});function Ms(p,c){for(var a=p.length,l=[],y=0;y<a;y++){var S=a-1-y,U=p[S]||1;(c[c.length-1-y]||1)>1&&U===1&&l.unshift(S)}return l}function Xs(p,c){for(var a=[],l=0;l<c.length;l++){var y=p[p.length-l-1],S=c.length-l-1,U=c[S];(y==null||y===1&&U>1)&&a.unshift(S)}return a}function Co(p,c){for(var a=[],l=Math.max(p.length,c.length),y=0;y<l;y++){var S=p[p.length-y-1];S==null&&(S=1);var U=c[c.length-y-1];if(U==null&&(U=1),S===1)a.unshift(U);else if(U===1)a.unshift(S);else{if(S!==U)throw Error("Operands could not be broadcast together with shapes "+p+" and "+c+".");a.unshift(S)}}return a}var cu=Tt({abs_:function(p){var c=Ze(p,"x","abs");return c.dtype==="complex64"?He.runKernelFunc(function(a){return a.complexAbs(c)},{$x:c}):He.runKernelFunc(function(a,l){var y=a.abs(c);return l([c]),y},{x:c},function(a,l){var y=l[0];return{x:function(){return a.mul(y.toFloat().step(-1))}}},"Abs")}}),lc=Tt({acos_:function(p){var c=Ze(p,"x","acos");return He.runKernelFunc(function(a,l){var y=a.acos(c);return l([c]),y},{$x:c},function(a,l){var y=l[0];return{$x:function(){return a.divStrict(Mr(1).sub(y.toFloat().square()).sqrt()).neg()}}})}}),Es=Tt({acosh_:function(p){var c=Ze(p,"x","acosh");return He.runKernelFunc(function(a,l){var y=a.acosh(c);return l([c]),y},{$x:c},function(a,l){var y=l[0];return{$x:function(){return a.divStrict(y.toFloat().square().sub(1).sqrt())}}})}}),uf=Tt({asin_:function(p){var c=Ze(p,"x","asin");return He.runKernelFunc(function(a,l){var y=a.asin(c);return l([c]),y},{$x:c},function(a,l){var y=l[0];return{$x:function(){return a.divStrict(Mr(1).sub(y.toFloat().square()).sqrt())}}})}}),Pc=Tt({asinh_:function(p){var c=Ze(p,"x","asinh");return He.runKernelFunc(function(a,l){var y=a.asinh(c);return l([c]),y},{$x:c},function(a,l){var y=l[0];return{$x:function(){return a.divStrict(Mr(1).add(y.toFloat().square()).sqrt())}}})}}),Bh=Tt({atan_:function(p){var c=Ze(p,"x","atan");return He.runKernelFunc(function(a,l){var y=a.atan(c);return l([c]),y},{$x:c},function(a,l){var y=l[0];return{$x:function(){return a.div(y.toFloat().square().add(1))}}})}}),Ph=Tt({atanh_:function(p){var c=Ze(p,"x","atanh");return He.runKernelFunc(function(a,l){var y=a.atanh(c);return l([c]),y},{$x:c},function(a,l){var y=l[0];return{$x:function(){return a.div(Mr(1).sub(y.toFloat().square()))}}})}}),Rl=Tt({ceil_:function(p){var c=Ze(p,"x","ceil");return He.runKernelFunc(function(a){return a.ceil(c)},{$x:c},function(a){return{$x:function(){return Ri(a)}}})}}),ep=Tt({clipByValue_:function(p,c,a){var l=Ze(p,"x","clipByValue");Ce(c<=a,function(){return"Error in clip: min ("+c+") must be less than or equal to max ("+a+")."});var y=[l],S={min:c,max:a};return He.runKernelFunc(function(U,G){var ae=U.clip(l,c,a);return G([l]),ae},{x:l},function(U,G){var ae=G[0];return{x:function(){return U.where(ae.greaterEqual(c).logicalAnd(ae.lessEqual(a)),Ri(U))}}},"ClipByValue",S,y)}}),Oc=Tt({cos_:function(p){var c=Ze(p,"x","cos"),a=[c];return He.runKernelFunc(function(l,y){var S=l.cos(c);return y([c]),S},{x:c},function(l,y){var S=y[0];return{x:function(){return S.toFloat().sin().neg().mul(l)}}},"Cos",{},a)}}),th=Tt({cosh_:function(p){var c=Ze(p,"x","cosh");return He.runKernelFunc(function(a,l){var y=a.cosh(c);return l([c]),y},{$x:c},function(a,l){var y=l[0];return{$x:function(){return y.toFloat().sinh().mulStrict(a)}}})}}),Lh=Tt({erf_:function(p){var c=Ze(p,"x","erf");return Ce(c.dtype==="int32"||c.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),c.dtype==="int32"&&(c=c.toFloat()),He.runKernelFunc(function(a,l){var y=a.erf(c);return l([c]),y},{$x:c},function(a,l){var y=l[0];return{$x:function(){return a.mul(y.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),zh=Tt({exp_:function(p){var c=Ze(p,"x","exp");return He.runKernelFunc(function(a,l){var y=a.exp(c);return l([y]),y},{x:c},function(a,l){return{x:function(){return a.mulStrict(l[0])}}},"Exp",{},[],[!0])}}),jm=Tt({expm1_:function(p){var c=Ze(p,"x","expm1");return He.runKernelFunc(function(a,l){var y=a.expm1(c);return l([c]),y},{$x:c},function(a,l){var y=l[0];return{$x:function(){return a.mul(y.exp())}}})}}),xd=Tt({floor_:function(p){var c=Ze(p,"x","floor");return He.runKernelFunc(function(a){return a.floor(c)},{$x:c},function(a){return{$x:function(){return Ri(a)}}})}}),Ml=Tt({log_:function(p){var c=Ze(p,"x","log"),a=[c];return He.runKernelFunc(function(l,y){var S=l.log(c);return y([c]),S},{x:c},function(l,y){var S=y[0];return{x:function(){return l.div(S.toFloat())}}},"Log",{},a)}}),Uh=Tt({log1p_:function(p){var c=Ze(p,"x","log1p");return He.runKernelFunc(function(a,l){var y=a.log1p(c);return l([c]),y},{$x:c},function(a,l){var y=l[0];return{$x:function(){return a.div(y.add(1))}}})}}),Wh=Tt({logSigmoid_:function(p){var c=Ze(p,"x","logSigmoid");return He.runKernelFunc(function(a,l){var y=a.softplus(c.neg()).neg();return l([c]),y},{$x:c},function(a,l){var y=l[0];return{$x:function(){return a.mul(y.neg().sigmoid())}}})}}),Os=Tt({neg_:function(p){var c=Ze(p,"x","neg"),a=[c];return He.runKernelFunc(function(l){return l.neg(c)},{x:c},function(l){return{x:function(){return l.neg()}}},"Neg",{},a)}}),nh=Tt({reciprocal_:function(p){var c=Ze(p,"x","reciprocal");return He.runKernelFunc(function(a,l){var y=a.reciprocal(c);return l([c]),y},{$x:c},function(a,l){var y=l[0];return{$x:function(){return a.div(y.square().neg())}}})}}),Yu=Tt({round_:function(p){var c=Ze(p,"x","round");return He.runKernelFunc(function(a){return a.round(c)},{$x:c},function(a){return{$x:function(){return Ri(a)}}})}}),Vh=Tt({rsqrt_:function(p){var c=Ze(p,"x","rsqrt"),a=[c];return He.runKernelFunc(function(l,y){var S=l.rsqrt(c);return y([c]),S},{x:c},function(l,y){var S=y[0];return{x:function(){return l.div(S.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},a)}}),Ss=Tt({sigmoid_:function(p){var c=Ze(p,"x","sigmoid");return He.runKernelFunc(function(a,l){var y=a.sigmoid(c);return l([y]),y},{x:c},function(a,l){var y=l[0];return{x:function(){return a.mul(y.mul(Mr(1).sub(y)))}}},"Sigmoid")}}),lu=Tt({sign_:function(p){var c=Ze(p,"x","sign");return He.runKernelFunc(function(a){return a.sign(c)},{$x:c},function(a){return{$x:function(){return Ri(a)}}})}}),Gp=Tt({isNaN_:function(p){var c=Ze(p,"x","isNaN");return He.runKernelFunc(function(a){return a.isNaN(c)},{$x:c},function(a){return{$x:function(){return Ri(a)}}})}}),wd=Tt({isInf_:function(p){var c=Ze(p,"x","isInf");return He.runKernelFunc(function(a){return a.isInf(c)},{$x:c},function(a){return{$x:function(){return Ri(a)}}})}}),rh=Tt({isFinite_:function(p){var c=Ze(p,"x","isFinite");return He.runKernelFunc(function(a){return a.isFinite(c)},{$x:c},function(a){return{$x:function(){return Ri(a)}}})}}),$p=Tt({sin_:function(p){var c=Ze(p,"x","sin"),a=[c];return He.runKernelFunc(function(l,y){var S=l.sin(c);return y([c]),S},{x:c},function(l,y){var S=y[0];return{x:function(){return S.toFloat().cos().mul(l)}}},"Sin",{},a)}}),kd=Tt({sinh_:function(p){var c=Ze(p,"x","sinh");return He.runKernelFunc(function(a,l){var y=a.sinh(c);return l([c]),y},{$x:c},function(a,l){var y=l[0];return{$x:function(){return y.toFloat().cosh().mulStrict(a)}}})}}),ln=Tt({softplus_:function(p){var c=Ze(p,"x","softplus");return He.runKernelFunc(function(a,l){var y=a.softplus(c);return l([c]),y},{$x:c},function(a,l){var y=l[0];return{$x:function(){return a.mul(y.sigmoid())}}})}}),Ju=Tt({sqrt_:function(p){var c=Ze(p,"x","sqrt");return He.runKernelFunc(function(a,l){var y=a.sqrt(c);return l([c]),y},{$x:c},function(a,l){var y=l[0];return{$x:function(){return a.div(y.toFloat().sqrt().mul(2))}}})}}),er=Tt({step_:function(p,c){c===void 0&&(c=0);var a=Ze(p,"x","step");return He.runKernelFunc(function(l){return l.step(a,c)},{$x:a},function(l){return{$x:function(){return Ri(l)}}})}}),ru=Tt({tan_:function(p){var c=Ze(p,"x","tan");return He.runKernelFunc(function(a,l){var y=a.tan(c);return l([c]),y},{$x:c},function(a,l){var y=l[0];return{$x:function(){return a.div(y.cos().square())}}})}}),Fo=Tt({tanh_:function(p){var c=Ze(p,"x","tanh");return He.runKernelFunc(function(a,l){var y=a.tanh(c);return l([y]),y},{x:c},function(a,l){var y=l[0];return{x:function(){return Mr(1).sub(y.square()).mulStrict(a)}}},"Tanh",{},null,[!0])}}),cf=Tt({addStrict_:function(p,c){var a=Ze(p,"a","addStrict"),l=Ze(c,"b","addStrict");return Wt(a.shape,l.shape,"Error in addStrict: "),a.add(l)}}),jl=Tt({atan2_:function(p,c){var a,l=Ze(p,"a","atan2"),y=Ze(c,"b","atan2");a=_n(l,y),l=a[0],y=a[1];var S=Co(l.shape,y.shape);return He.runKernelFunc(function(U,G){var ae=U.atan2(l,y);return G([l,y]),ae},{$a:l,$b:y},function(U,G){var ae=G[0],le=G[1];return{$a:function(){var be=Ua(ae.square(),le.square()),Se=U.mul(le.div(be)),Ie=Xs(ae.shape,S);return Ie.length>0&&(Se=Se.sum(Ie)),Se.reshape(ae.shape)},$b:function(){var be=Ua(ae.square(),le.square()),Se=Os(U.mul(ae.div(be))),Ie=Xs(le.shape,S);return Ie.length>0&&(Se=Se.sum(Ie)),Se.reshape(le.shape)}}})}}),wr=Tt({divStrict_:function(p,c){var a=Ze(p,"a","div"),l=Ze(c,"b","div");return Wt(a.shape,l.shape,"Error in divideStrict: "),a.div(l)}}),fu=Tt({floorDiv_:function(p,c){var a,l=Ze(p,"a","floorDiv"),y=Ze(c,"b","floorDiv");a=_n(l,y),l=a[0],y=a[1];var S=Co(l.shape,y.shape);return He.runKernelFunc(function(U,G){var ae=U.floorDiv(l,y);return G([l,y]),ae},{a:l,b:y},function(U,G){var ae=G[0],le=G[1];return{a:function(){var be=U.div(le.toFloat()),Se=Xs(ae.shape,S);return Se.length>0?be.sum(Se).reshape(ae.shape):be},b:function(){var be=U.mul(ae.toFloat()),Se=Xs(le.shape,S);Se.length>0&&(be=be.sum(Se).reshape(le.shape));var Ie=le.square();return be.div(Ie.toFloat()).neg()}}},"FloorDiv")}}),Ds=Tt({maximum_:function(p,c){var a,l=Ze(p,"a","maximum"),y=Ze(c,"b","maximum");return a=_n(l,y),l=a[0],y=a[1],l.dtype==="bool"&&(l=l.toInt(),y=y.toInt()),Co(l.shape,y.shape),He.runKernelFunc(function(S,U){var G=S.maximum(l,y);return U([l,y]),G},{a:l,b:y},function(S,U){var G=U[0],ae=U[1];return{a:function(){return S.mul(G.greaterEqual(ae).toFloat())},b:function(){return S.mul(G.less(ae).toFloat())}}},"Maximum")}}),Ro=Tt({maximumStrict_:function(p,c){var a=Ze(p,"a","maximumStrict"),l=Ze(c,"b","maximumStrict");return Wt(a.shape,l.shape,"Error in maximumStrict: "),a.maximum(l)}}),yl=Tt({minimum_:function(p,c){var a,l=Ze(p,"a","minimum"),y=Ze(c,"b","minimum");return a=_n(l,y),l=a[0],y=a[1],l.dtype==="bool"&&(l=l.toInt(),y=y.toInt()),Co(l.shape,y.shape),He.runKernelFunc(function(S,U){var G=S.minimum(l,y);return U([l,y]),G},{a:l,b:y},function(S,U){var G=U[0],ae=U[1];return{a:function(){return S.mul(G.lessEqual(ae).toFloat())},b:function(){return S.mul(G.greater(ae).toFloat())}}},"Minimum")}}),nl=Tt({minimumStrict_:function(p,c){var a=Ze(p,"a","minimumStrict"),l=Ze(c,"b","minimumStrict");return Wt(a.shape,l.shape,"Error in minimumStrict: "),a.minimum(l)}}),wu=Tt({mod_:function(p,c){var a,l=Ze(p,"a","mod"),y=Ze(c,"b","mod");a=_n(l,y),l=a[0],y=a[1];var S=Co(l.shape,y.shape);return He.runKernelFunc(function(U,G){var ae=U.mod(l,y);return G([l,y]),ae},{$a:l,$b:y},function(U,G){var ae=G[0],le=G[1];return{$a:function(){var be=Xs(ae.shape,S);return be.length>0?U.sum(be).reshape(ae.shape):U},$b:function(){var be=U.mul(ae.div(le).floor().neg()),Se=Xs(le.shape,S);return Se.length>0?be.sum(Se).reshape(le.shape):be}}})}}),Bl=Tt({modStrict_:function(p,c){var a=Ze(p,"a","modStrict"),l=Ze(c,"b","modStrict");return Wt(a.shape,l.shape,"Error in modStrict: "),a.mod(l)}}),Kt=Tt({mul_:function(p,c){var a,l=Ze(p,"a","mul"),y=Ze(c,"b","mul");a=_n(l,y),l=a[0],y=a[1];var S=Co(l.shape,y.shape);return He.runKernelFunc(function(U,G){var ae=U.multiply(l,y);return G([l,y]),ae},{a:l,b:y},function(U,G){var ae=G[0],le=G[1];return{a:function(){var be=U.mul(le.toFloat()),Se=Xs(ae.shape,S);return Se.length>0?be.sum(Se).reshape(ae.shape):be},b:function(){var be=U.mul(ae.toFloat()),Se=Xs(le.shape,S);return Se.length>0?be.sum(Se).reshape(le.shape):be}}},"Mul")}}),fc=Tt({mulStrict_:function(p,c){var a=Ze(p,"a","mul"),l=Ze(c,"b","mul");return Wt(a.shape,l.shape,"Error in multiplyStrict: "),a.mul(l)}}),Mu=Tt({pow_:function(p,c){var a,l=Ze(p,"base","pow"),y=Ze(c,"exp","pow");a=_n(l,y),l=a[0],y=a[1];var S=Co(l.shape,y.shape),U=[l,y];return He.runKernelFunc(function(G,ae){var le=G.pow(l,y);return ae([l,y,le]),le},{a:l,b:y},function(G,ae){var le=ae[0],be=ae[1],Se=ae[2];return{a:function(){var Ie=be.toFloat(),Me=G.mul(Ie.mul(le.pow(Ie.sub(Mr(1))))),qe=Xs(le.shape,S);return qe.length>0&&(Me=Me.sum(qe)),Me.reshape(le.shape)},b:function(){var Ie=le.greater(0),Me=le.log().where(Ie,Ri(le)),qe=G.mul(Se.mul(Me)),Ye=Xs(be.shape,S);return Ye.length>0&&(qe=qe.sum(Ye)),qe.reshape(be.shape)}}},"Pow",{},U,[!0])}}),po=Tt({powStrict_:function(p,c){return Wt(p.shape,c.shape,"Error in powStrict: "),p.pow(c)}}),uo=Tt({squaredDifferenceStrict_:function(p,c){var a=Ze(p,"a","squaredDifferenceStrict"),l=Ze(c,"b","squaredDifferenceStrict");return Wt(a.shape,l.shape,"Error in squaredDifferenceStrict: "),a.squaredDifference(l)}}),js=Tt({sub_:function(p,c){var a,l=Ze(p,"a","sub"),y=Ze(c,"b","sub");a=_n(l,y),l=a[0],y=a[1];var S=Co(l.shape,y.shape);return He.runKernelFunc(function(U){return U.subtract(l,y)},{a:l,b:y},function(U){return{a:function(){var G=U,ae=Xs(l.shape,S);return ae.length>0&&(G=G.sum(ae)),G.reshape(l.shape)},b:function(){var G=U,ae=Xs(y.shape,S);return ae.length>0&&(G=G.sum(ae)),G.neg().reshape(y.shape)}}},"Sub")}}),ju=Tt({subStrict_:function(p,c){var a=Ze(p,"a","subStrict"),l=Ze(c,"b","subStrict");return Wt(a.shape,l.shape,"Error in subStrict: "),a.sub(l)}}),ts=Tt({div_:function(p,c){var a,l=Ze(p,"a","div"),y=Ze(c,"b","div");if(a=_n(l,y),l=a[0],y=a[1],l.dtype==="int32"&&y.dtype==="int32")return fu(l,y);var S={a:l,b:y};return He.runKernelFunc(function(U,G){var ae=U.realDivide(l,y);return G([l,y]),ae},S,null,Eo,{})}});function iu(p,c){if(p.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+p.rank+".");if(c.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+c.rank+".");if(c.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+c.dtype+".");if(c.shape[c.rank-1]>p.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+c.shape[c.rank-1]+" vs. "+p.rank);if(p.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+p.shape+".");for(var a=c.shape,l=a[a.length-1],y=1,S=0;S<a.length-1;++S)y*=a[S];var U=p.shape,G=a.slice();G.pop();var ae=1;for(S=l;S<p.rank;++S)ae*=U[S],G.push(U[S]);var le=Tr(p.shape).map(function(be){return be/ae}).concat([1]).slice(0,l);return[G,y,ae,le]}var bl=Object.freeze({prepareAndValidate:iu}),Pl=30;function lf(p){return p<=Pl?p:Rr(p,Math.floor(Math.sqrt(p)))}function xl(p,c,a){var l=c.rank>1?c.shape[c.rank-1]:1,y=c.rank>1?c.rank-1:1,S="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+a.shape+", indices.shape: "+c.shape+", shape: "+p+", sliceDim: "+l+", and batchDim: "+y+".";if(a.rank<y)throw new Error(S+" update.rank < "+y+". ");if(p.length<l+(a.rank-y))throw new Error(S+" Output shape length < "+(l+(a.rank-y)));if(a.rank!==y+p.length-l)throw new Error(S+" update.rank != "+(y+p.length-l));for(var U=0;U<y;++U)if(a.shape[U]!==c.shape[U])throw new Error(S+" updates.shape["+U+"] ("+a.shape[U]+") != indices.shape["+U+"] ("+c.shape[U]+").");for(U=0;U<a.rank-y;++U)if(a.shape[U+y]!==p[U+l])throw new Error(S+" updates.shape["+(U+y)+"] ("+a.shape[U+y]+") != shape["+(U+y)+"] ("+p[U+y]+")")}function ih(p,c,a){if(c.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+c.rank+".");if(p.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+p.rank+".");if(c.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+c.dtype);if(a.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+a);if(a.length===0){if(c.size===0)throw new Error("Indices specified for empty output. indices shape: "+c.shape);if(p.size===0)throw new Error("Updates specified for empty output. updates shape: "+p.shape)}xl(a,c,p)}function hc(p,c,a){for(var l=c.shape.length,y=l>1?c.shape[l-1]:1,S=a.length,U=1,G=y;G<S;++G)U*=a[G];var ae=y<1?1:y;return{sliceRank:y,numUpdates:Qe(c.shape)/ae,sliceSize:U,strides:Tr(a.slice(0,y)).concat([1]),outputSize:Qe(a)}}var tp=Object.freeze({validateUpdateShape:xl,validateInput:ih,calculateShapes:hc});function oh(p,c,a){Ce(p.rank===c.length,function(){return"Error in slice"+p.rank+"D: Length of begin "+c+" must match the rank of the array ("+p.rank+")."}),Ce(p.rank===a.length,function(){return"Error in slice"+p.rank+"D: Length of size "+a+" must match the rank of the array ("+p.rank+")."});for(var l=function(S){Ce(c[S]+a[S]<=p.shape[S],function(){return"Error in slice"+p.rank+"D: begin["+S+"] + size["+S+"] ("+(c[S]+a[S])+") would overflow input.shape["+S+"] ("+p.shape[S]+")"})},y=0;y<p.rank;++y)l(y)}function Sc(p){for(var c=[],a=0;p>0;)1&p&&c.push(a),p/=2,a++;return c}function wl(p,c,a){for(var l=[],y=0;y<p.length;y++)l[y]=Math.ceil((c[y]-p[y])/a[y]);return l}function kl(p,c,a,l,y){var S=c[y],U=a[y]||1;(p&1<<y||S==null)&&(S=U>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var G=l[y];return S<0&&(S+=G),Mt(0,S,G-1)}function Ys(p,c,a,l,y){var S=c[y],U=a[y]||1;(p&1<<y||S==null)&&(S=U>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var G=l[y];return S<0&&(S+=G),U>0?Mt(0,S,G):Mt(-1,S,G-1)}function np(p,c,a){for(var l=a.length,y=0;y<a.length;y++)if(a[y]>1){l=y;break}for(y=l+1;y<a.length;y++)if(c[y]>0||a[y]!==p[y])return!1;return!0}function _d(p,c){for(var a=p.length>0?p[p.length-1]:1,l=0;l<p.length-1;l++)a+=p[l]*c[l];return a}var Ed=Object.freeze({assertParamsValid:oh,maskToAxes:Sc,computeOutShape:wl,startForAxis:kl,stopForAxis:Ys,isSliceContinous:np,computeFlatOffset:_d});function qh(p){return Ce(lr(p),function(){return"The f passed in grad(f) must be a function"}),function(c,a){var l=Ze(c,"x","tf.grad",null),y=a!=null?Ze(a,"dy","tf.grad"):null;return He.tidy(function(){var S=He.gradients(function(){return p(l)},[l],y),U=S.value,G=S.grads;return y!=null&&Wt(U.shape,y.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),oe(G),G[0]})}}function Cd(p){return Ce(lr(p),function(){return"The f passed in grads(f) must be a function"}),function(c,a){Ce(Array.isArray(c),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var l=tl(c,"args","tf.grads",null),y=a!=null?Ze(a,"dy","tf.grads"):null;return He.tidy(function(){var S=He.gradients(function(){return p.apply(void 0,l)},l,y),U=S.value,G=S.grads;return y!=null&&Wt(U.shape,y.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),oe(G),G})}}function re(p){return Ce(lr(p),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(c,a){Ce(c instanceof $t,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),Ce(a==null||a instanceof $t,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var l=He.gradients(function(){return p(c)},[c],a),y=l.grads,S=l.value;return oe(y),{grad:y[0],value:S}}}function Q(p){return Ce(lr(p),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(c,a){Ce(Array.isArray(c)&&c.every(function(y){return y instanceof $t}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),Ce(a==null||a instanceof $t,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var l=He.gradients(function(){return p.apply(void 0,c)},c,a);return a!=null&&Wt(l.value.shape,a.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),oe(l.grads),l}}function C(p,c){Ce(lr(p),function(){return"The f passed in variableGrads(f) must be a function"}),Ce(c==null||Array.isArray(c)&&c.every(function(be){return be instanceof xt}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var a=c!=null;if(!a)for(var l in c=[],He.registeredVariables)c.push(He.registeredVariables[l]);var y=a?c.filter(function(be){return!be.trainable}):null,S=c.length;Ce((c=c.filter(function(be){return be.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+S+" variables is trainable."});var U=He.gradients(p,c,null,!0),G=U.value,ae=U.grads;Ce(ae.some(function(be){return be!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),Ce(G.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+G.rank+" tensor"});var le={};return c.forEach(function(be,Se){ae[Se]!=null&&(le[be.name]=ae[Se])}),y!=null&&y.forEach(function(be){return le[be.name]=null}),{value:G,grads:le}}function R(p){return He.customGrad(p)}function oe(p){if(p.filter(function(c){return c==null}).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}var Ue=Tt({softmax_:function(p,c){c===void 0&&(c=-1);var a=Ze(p,"logits","softmax","float32");if(c===-1&&(c=a.rank-1),c!==a.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+a.rank+" and dim was "+c);return He.runKernelFunc(function(l,y){var S=l.softmax(a,c);return y([S]),S},{logits:a},function(l,y){var S=y[0],U=l.mul(S);return{logits:function(){return U.sub(U.sum([c],!0).mul(S))}}},"Softmax",{dim:c},[],[!0])}}),Je=Tt({logSoftmax_:function(p,c){c===void 0&&(c=-1);var a=Ze(p,"logits","logSoftmax");if(c===-1&&(c=a.rank-1),c!==a.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+a.rank+" and axis was "+c);return R(function(l,y){var S=l.max(c,!0),U=l.sub(S),G=U.toFloat().sub(U.exp().sum(c,!0).log());return y([G]),{value:G,gradFunc:function(ae,le){var be=le[0].exp();return ae.sub(ae.sum(c,!0).mul(be))}}})(a)}}),vt=Tt({transpose_:function(p,c){var a=Ze(p,"x","transpose");if(c==null&&(c=a.shape.map(function(y,S){return S}).reverse()),Ce(a.rank===c.length,function(){return"Error in transpose: rank of input "+a.rank+" must match length of perm "+c+"."}),c.forEach(function(y){Ce(y>=0&&y<a.rank,function(){return"All entries in 'perm' must be between 0 and "+(a.rank-1)+" but got "+c})}),a.rank<=1)return a.clone();var l={perm:c};return He.runKernelFunc(function(y){return y.transpose(a,c)},{x:a},null,"Transpose",l)}}),qt=function(){function p(c,a){this.backend=c,this.dataMover=a,this.data=new WeakMap,this.dataIdsCount=0}return p.prototype.get=function(c){return this.data.has(c)||this.dataMover.moveData(this.backend,c),this.data.get(c)},p.prototype.set=function(c,a){this.dataIdsCount++,this.data.set(c,a)},p.prototype.has=function(c){return this.data.has(c)},p.prototype.delete=function(c){return this.dataIdsCount--,this.data.delete(c)},p.prototype.numDataIds=function(){return this.dataIdsCount},p}(),Jt=function(){function p(){}return p.prototype.time=function(c){return pt("time")},p.prototype.read=function(c){return pt("read")},p.prototype.readSync=function(c){return pt("readSync")},p.prototype.numDataIds=function(){return pt("numDataIds")},p.prototype.disposeData=function(c){return pt("disposeData")},p.prototype.write=function(c,a,l){return pt("write")},p.prototype.move=function(c,a,l,y){return pt("move")},p.prototype.memory=function(){return pt("memory")},p.prototype.floatPrecision=function(){return pt("floatPrecision")},p.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},p.prototype.batchMatMul=function(c,a,l,y){return pt("batchMatMul")},p.prototype.fusedBatchMatMul=function(c){return c.a,c.b,c.transposeA,c.transposeB,c.bias,c.activation,c.preluActivationWeights,pt("fusedBatchMatMul")},p.prototype.slice=function(c,a,l){return pt("slice")},p.prototype.stridedSlice=function(c,a,l,y){return pt("stridedSlice")},p.prototype.unstack=function(c,a){return pt("unstack")},p.prototype.reverse=function(c,a){return pt("reverse")},p.prototype.concat=function(c,a){return pt("concat")},p.prototype.neg=function(c){return pt("neg")},p.prototype.add=function(c,a){return pt("add")},p.prototype.addN=function(c){return pt("addN")},p.prototype.subtract=function(c,a){return pt("subtract")},p.prototype.multiply=function(c,a){return pt("multiply")},p.prototype.realDivide=function(c,a){return pt("realDivide")},p.prototype.floorDiv=function(c,a){return pt("floorDiv")},p.prototype.sum=function(c,a){return pt("sum")},p.prototype.prod=function(c,a){return pt("prod")},p.prototype.unsortedSegmentSum=function(c,a,l){return pt("unsortedSegmentSum")},p.prototype.argMin=function(c,a){return pt("argMin")},p.prototype.argMax=function(c,a){return pt("argMax")},p.prototype.equal=function(c,a){return pt("equal")},p.prototype.notEqual=function(c,a){return pt("notEqual")},p.prototype.less=function(c,a){return pt("less")},p.prototype.lessEqual=function(c,a){return pt("lessEqual")},p.prototype.greater=function(c,a){return pt("greater")},p.prototype.greaterEqual=function(c,a){return pt("greaterEqual")},p.prototype.logicalNot=function(c){return pt("logicalNot")},p.prototype.logicalAnd=function(c,a){return pt("logicalAnd")},p.prototype.logicalOr=function(c,a){return pt("logicalOr")},p.prototype.where=function(c){return pt("where")},p.prototype.select=function(c,a,l){return pt("select")},p.prototype.topk=function(c,a,l){return pt("topk")},p.prototype.min=function(c,a){return pt("min")},p.prototype.minimum=function(c,a){return pt("minimum")},p.prototype.mod=function(c,a){return pt("mod")},p.prototype.max=function(c,a){return pt("max")},p.prototype.maximum=function(c,a){return pt("maximum")},p.prototype.all=function(c,a){return pt("all")},p.prototype.any=function(c,a){return pt("any")},p.prototype.squaredDifference=function(c,a){return pt("squaredDifference")},p.prototype.ceil=function(c){return pt("ceil")},p.prototype.floor=function(c){return pt("floor")},p.prototype.round=function(c){return pt("round")},p.prototype.sign=function(c){return pt("sign")},p.prototype.isNaN=function(c){return pt("isNaN")},p.prototype.isInf=function(c){return pt("isInf")},p.prototype.isFinite=function(c){return pt("isFinite")},p.prototype.pow=function(c,a){return pt("pow")},p.prototype.exp=function(c){return pt("exp")},p.prototype.expm1=function(c){return pt("expm1")},p.prototype.softmax=function(c,a){return pt("softmax")},p.prototype.log=function(c){return pt("log")},p.prototype.log1p=function(c){return pt("log1p")},p.prototype.sqrt=function(c){return pt("sqrt")},p.prototype.rsqrt=function(c){return pt("rsqrt")},p.prototype.square=function(c){return pt("square")},p.prototype.reciprocal=function(c){return pt("reciprocal")},p.prototype.relu=function(c){return pt("relu")},p.prototype.relu6=function(c){return pt("relu6")},p.prototype.prelu=function(c,a){return pt("prelu")},p.prototype.elu=function(c){return pt("elu")},p.prototype.eluDer=function(c,a){return pt("eluDer")},p.prototype.selu=function(c){return pt("selu")},p.prototype.int=function(c){return pt("int")},p.prototype.clip=function(c,a,l){return pt("clip")},p.prototype.abs=function(c){return pt("abs")},p.prototype.complexAbs=function(c){return pt("complexAbs")},p.prototype.sigmoid=function(c){return pt("sigmoid")},p.prototype.softplus=function(c){return pt("softplus")},p.prototype.sin=function(c){return pt("sin")},p.prototype.cos=function(c){return pt("cos")},p.prototype.tan=function(c){return pt("tan")},p.prototype.asin=function(c){return pt("asin")},p.prototype.acos=function(c){return pt("acos")},p.prototype.atan=function(c){return pt("atan")},p.prototype.atan2=function(c,a){return pt("atan2")},p.prototype.sinh=function(c){return pt("sinh")},p.prototype.cosh=function(c){return pt("cosh")},p.prototype.tanh=function(c){return pt("tanh")},p.prototype.asinh=function(c){return pt("asinh")},p.prototype.acosh=function(c){return pt("acosh")},p.prototype.atanh=function(c){return pt("atanh")},p.prototype.erf=function(c){return pt("erf")},p.prototype.step=function(c,a){return pt("step")},p.prototype.fusedConv2d=function(c){return c.input,c.filter,c.convInfo,c.bias,c.activation,c.preluActivationWeights,pt("fusedConv2d")},p.prototype.conv2d=function(c,a,l){return pt("conv2d")},p.prototype.conv2dDerInput=function(c,a,l){return pt("conv2dDerInput")},p.prototype.conv2dDerFilter=function(c,a,l){return pt("conv2dDerFilter")},p.prototype.fusedDepthwiseConv2D=function(c){return c.input,c.filter,c.convInfo,c.bias,c.activation,c.preluActivationWeights,pt("fusedDepthwiseConv2D")},p.prototype.depthwiseConv2D=function(c,a,l){return pt("depthwiseConv2D")},p.prototype.depthwiseConv2DDerInput=function(c,a,l){return pt("depthwiseConv2DDerInput")},p.prototype.depthwiseConv2DDerFilter=function(c,a,l){return pt("depthwiseConv2DDerFilter")},p.prototype.conv3d=function(c,a,l){return pt("conv3d")},p.prototype.conv3dDerInput=function(c,a,l){return pt("conv3dDerInput")},p.prototype.conv3dDerFilter=function(c,a,l){return pt("conv3dDerFilter")},p.prototype.maxPool=function(c,a){return pt("maxPool")},p.prototype.maxPoolBackprop=function(c,a,l,y){return pt("maxPoolBackprop")},p.prototype.avgPool=function(c,a){return pt("avgPool")},p.prototype.avgPoolBackprop=function(c,a,l){return pt("avgPoolBackprop")},p.prototype.avgPool3d=function(c,a){return pt("avgPool3d")},p.prototype.avgPool3dBackprop=function(c,a,l){return pt("avgPool3dBackprop")},p.prototype.maxPool3d=function(c,a){return pt("maxPool3d")},p.prototype.maxPool3dBackprop=function(c,a,l,y){return pt("maxPool3dBackprop")},p.prototype.reshape=function(c,a){return pt("reshape")},p.prototype.cast=function(c,a){return pt("cast")},p.prototype.tile=function(c,a){return pt("tile")},p.prototype.pad=function(c,a,l){return pt("pad")},p.prototype.transpose=function(c,a){return pt("transpose")},p.prototype.gather=function(c,a,l){return pt("gather")},p.prototype.gatherND=function(c,a){return pt("gatherND")},p.prototype.scatterND=function(c,a,l){return pt("scatterND")},p.prototype.batchToSpaceND=function(c,a,l){return pt("batchToSpaceND")},p.prototype.spaceToBatchND=function(c,a,l){return pt("spaceToBatchND")},p.prototype.resizeBilinear=function(c,a,l,y){return pt("resizeBilinear")},p.prototype.resizeBilinearBackprop=function(c,a,l){return pt("resizeBilinearBackprop")},p.prototype.resizeNearestNeighbor=function(c,a,l,y){return pt("resizeNearestNeighbor")},p.prototype.resizeNearestNeighborBackprop=function(c,a,l){return pt("resizeNearestNeighborBackprop")},p.prototype.batchNormalization=function(c,a,l,y,S,U){return pt("batchNormalization")},p.prototype.localResponseNormalization4D=function(c,a,l,y,S){return pt("localResponseNormalization4D")},p.prototype.LRNGrad=function(c,a,l,y,S,U,G){return pt("LRNGrad")},p.prototype.multinomial=function(c,a,l,y){return pt("multinomial")},p.prototype.oneHot=function(c,a,l,y){return pt("oneHot")},p.prototype.cumsum=function(c,a,l,y){return pt("cumsum")},p.prototype.nonMaxSuppression=function(c,a,l,y,S){return pt("nonMaxSuppression")},p.prototype.fft=function(c){return pt("fft")},p.prototype.ifft=function(c){return pt("ifft")},p.prototype.complex=function(c,a){return pt("complex")},p.prototype.real=function(c){return pt("real")},p.prototype.imag=function(c){return pt("imag")},p.prototype.cropAndResize=function(c,a,l,y,S,U){return pt("cropAndResize")},p.prototype.depthToSpace=function(c,a,l){return pt("depthToSpace")},p.prototype.split=function(c,a,l){return pt("split")},p.prototype.sparseToDense=function(c,a,l,y){return pt("sparseToDense")},p.prototype.diag=function(c){return pt("diag")},p.prototype.fill=function(c,a,l){return pt("fill")},p.prototype.onesLike=function(c){return pt("onesLike")},p.prototype.zerosLike=function(c){return pt("zerosLike")},p.prototype.linspace=function(c,a,l){return pt("linspace")},p.prototype.dispose=function(){return pt("dispose")},p}();function pt(p){throw new Error("'"+p+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Nn(p,c,a,l,y,S,U){U===void 0&&(U="channelsLast");var G,ae=br(c),le=ae[0],be=ae[1];if(U==="channelsLast")G=[le,be,p[3],p[3]];else{if(U!=="channelsFirst")throw new Error("Unknown dataFormat "+U);G=[le,be,p[1],p[1]]}return Vn(p,G,a,l,y,S,!1,U)}function Pn(p,c,a,l,y,S,U){U===void 0&&(U="NDHWC");var G,ae,le=xr(c),be=le[0],Se=le[1],Ie=le[2];if(U==="NDHWC")ae="channelsLast",G=[be,Se,Ie,p[4],p[4]];else{if(U!=="NCDHW")throw new Error("Unknown dataFormat "+U);ae="channelsFirst",G=[be,Se,Ie,p[1],p[1]]}return rr(p,G,a,l,y,!1,ae,S)}function Vn(p,c,a,l,y,S,U,G){U===void 0&&(U=!1),G===void 0&&(G="channelsLast");var ae=[-1,-1,-1,-1],le=ae[0],be=ae[1],Se=ae[2],Ie=ae[3];if(G==="channelsLast")le=p[0],be=p[1],Se=p[2],Ie=p[3];else{if(G!=="channelsFirst")throw new Error("Unknown dataFormat "+G);le=p[0],Ie=p[1],be=p[2],Se=p[3]}var Me,qe=c[0],Ye=c[1],Xe=c[3],at=br(a),gt=at[0],bt=at[1],_t=br(l),jt=_t[0],Qt=_t[1],sn=Lr(qe,jt),Zt=Lr(Ye,Qt),rn=function(yr,Cr,Nr,Ar,_r,Yr,Kr,fi){var Ti,Yi,ia;if(typeof yr=="number"){Ti={top:yr,bottom:yr,left:yr,right:yr,type:yr===0?"VALID":"NUMBER"};var oa=function(Uo,ka,Za,mc,gc){mc==null&&(mc=Yn(Uo,ka,Za));var vc=Uo[1],Ep=Hr((Uo[0]-ka+2*mc)/Za+1,gc);Ce(on(Ep),function(){return"The output # of rows ("+Ep+") must be an integer. Change the stride and/or zero pad parameters"});var qu=Hr((vc-ka+2*mc)/Za+1,gc);return Ce(on(qu),function(){return"The output # of columns ("+qu+") must be an integer. Change the stride and/or zero pad parameters"}),[Ep,qu]}([Cr,Nr],Yr,Ar,yr,fi);Yi=oa[0],ia=oa[1]}else if(yr==="same"){Yi=Math.ceil(Cr/Ar),ia=Math.ceil(Nr/_r);var wa=Math.max(0,(Yi-1)*Ar+Yr-Cr),ba=Math.max(0,(ia-1)*_r+Kr-Nr),ja=Math.floor(wa/2),Qa=wa-ja,Ls=Math.floor(ba/2);Ti={top:ja,bottom:Qa,left:Ls,right:ba-Ls,type:"SAME"}}else{if(yr!=="valid")throw Error("Unknown padding parameter: "+yr);Ti={top:0,bottom:0,left:0,right:0,type:"VALID"},Yi=Math.ceil((Cr-Yr+1)/Ar),ia=Math.ceil((Nr-Kr+1)/_r)}return{padInfo:Ti,outHeight:Yi,outWidth:ia}}(y,be,Se,gt,bt,sn,Zt,S),Sn=rn.padInfo,Bn=rn.outHeight,Mn=rn.outWidth,fr=U?Xe*Ie:Xe;return G==="channelsFirst"?Me=[le,fr,Bn,Mn]:G==="channelsLast"&&(Me=[le,Bn,Mn,fr]),{batchSize:le,dataFormat:G,inHeight:be,inWidth:Se,inChannels:Ie,outHeight:Bn,outWidth:Mn,outChannels:fr,padInfo:Sn,strideHeight:gt,strideWidth:bt,filterHeight:qe,filterWidth:Ye,effectiveFilterHeight:sn,effectiveFilterWidth:Zt,dilationHeight:jt,dilationWidth:Qt,inShape:p,outShape:Me,filterShape:c}}function rr(p,c,a,l,y,S,U,G){S===void 0&&(S=!1),U===void 0&&(U="channelsLast");var ae=[-1,-1,-1,-1,-1],le=ae[0],be=ae[1],Se=ae[2],Ie=ae[3],Me=ae[4];if(U==="channelsLast")le=p[0],be=p[1],Se=p[2],Ie=p[3],Me=p[4];else{if(U!=="channelsFirst")throw new Error("Unknown dataFormat "+U);le=p[0],Me=p[1],be=p[2],Se=p[3],Ie=p[4]}var qe,Ye=c[0],Xe=c[1],at=c[2],gt=c[4],bt=xr(a),_t=bt[0],jt=bt[1],Qt=bt[2],sn=xr(l),Zt=sn[0],rn=sn[1],Sn=sn[2],Bn=Lr(Ye,Zt),Mn=Lr(Xe,rn),fr=Lr(at,Sn),yr=function(Kr,fi,Ti,Yi,ia,oa,wa,ba,ja,Qa,Ls){var Uo,ka,Za,mc;if(typeof Kr=="number"){Uo={top:Kr,bottom:Kr,left:Kr,right:Kr,front:Kr,back:Kr,type:Kr===0?"VALID":"NUMBER"};var gc=function(dg,ym,A1,_v,Ap,O1){Ap==null&&(Ap=Yn(dg,ym,_v));var eb=dg[1],cy=dg[2],S1=Hr((dg[0]-ym+2*Ap)/_v+1,O1);Ce(on(S1),function(){return"The output # of depths ("+S1+") must be an integer. Change the stride and/or zero pad parameters"});var D1=Hr((eb-ym+2*Ap)/_v+1,O1);Ce(on(D1),function(){return"The output # of rows ("+D1+") must be an integer. Change the stride and/or zero pad parameters"});var T1=Hr((cy-ym+2*Ap)/_v+1,O1);return Ce(on(T1),function(){return"The output # of columns ("+T1+") must be an integer. Change the stride and/or zero pad parameters"}),[S1,D1,T1,1]}([fi,Ti,Yi,1],ba,0,ia,Kr,Ls);ka=gc[0],Za=gc[1],mc=gc[2]}else if(Kr==="same"){var vc=((ka=Math.ceil(fi/ia))-1)*ia+ba-fi,Ep=((Za=Math.ceil(Ti/oa))-1)*oa+ja-Ti,qu=((mc=Math.ceil(Yi/wa))-1)*wa+Qa-Yi,Ud=Math.floor(vc/2),fl=vc-Ud,e0=Math.floor(Ep/2),F0=Ep-e0,Cp=Math.floor(qu/2);Uo={top:e0,bottom:F0,left:Cp,right:qu-Cp,front:Ud,back:fl,type:"SAME"}}else{if(Kr!=="valid")throw Error("Unknown padding parameter: "+Kr);Uo={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},ka=Math.ceil((fi-ba+1)/ia),Za=Math.ceil((Ti-ja+1)/oa),mc=Math.ceil((Yi-Qa+1)/wa)}return{padInfo:Uo,outDepth:ka,outHeight:Za,outWidth:mc}}(y,be,Se,Ie,_t,jt,Qt,Bn,Mn,fr,G),Cr=yr.padInfo,Nr=yr.outDepth,Ar=yr.outHeight,_r=yr.outWidth,Yr=S?gt*Me:gt;return U==="channelsFirst"?qe=[le,Yr,Nr,Ar,_r]:U==="channelsLast"&&(qe=[le,Nr,Ar,_r,Yr]),{batchSize:le,dataFormat:U,inDepth:be,inHeight:Se,inWidth:Ie,inChannels:Me,outDepth:Nr,outHeight:Ar,outWidth:_r,outChannels:Yr,padInfo:Cr,strideDepth:_t,strideHeight:jt,strideWidth:Qt,filterDepth:Ye,filterHeight:Xe,filterWidth:at,effectiveFilterDepth:Bn,effectiveFilterHeight:Mn,effectiveFilterWidth:fr,dilationDepth:Zt,dilationHeight:rn,dilationWidth:Sn,inShape:p,outShape:qe,filterShape:c}}function Yn(p,c,a,l){l===void 0&&(l=1);var y=Lr(c,l);return Math.floor((p[0]*(a-1)-a+y)/2)}function br(p){return typeof p=="number"?[p,p,p]:p.length===2?[p[0],p[1],1]:p}function xr(p){return typeof p=="number"?[p,p,p]:p}function Lr(p,c){return c<=1?p:p+(p-1)*(c-1)}function Hr(p,c){if(!c)return p;switch(c){case"round":return Math.round(p);case"ceil":return Math.ceil(p);case"floor":return Math.floor(p);default:throw new Error("Unknown roundingMode "+c)}}function yi(p){var c=br(p),a=c[0],l=c[1],y=c[2];return a===1&&l===1&&y===1}function zr(p,c){return yi(p)||yi(c)}function li(p){if(p==="NHWC")return"channelsLast";if(p==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+p)}function pi(p,c,a){if(c==="complex64"){if(p.dtype==="complex64")return p.clone();var l=Io(p.shape),y=p.toFloat(),S=a.complex(y,l);return l.dispose(),y.dispose(),S}if(!Ke(p.dtype,c))return He.makeTensorFromDataId(p.dataId,p.shape,c);if(p.dtype==="complex64"){var U=a.real(p);return S=U.cast(c),U.dispose(),S}if(c==="int32")return a.int(p);if(c==="bool"){var G=Mr(0,p.dtype);return S=a.notEqual(p,G),G.dispose(),S}throw new Error("Error in Cast: failed to cast "+p.dtype+" to "+c)}function Pi(p,c){return He.makeTensorFromDataId(p.dataId,c,p.dtype)}function qi(p,c,a){var l=(c-p)/(a-1),y=nn(a,"float32");y[0]=p;for(var S=1;S<y.length;S++)y[S]=y[S-1]+l;return Cc(y,"float32")}var bi=Object.freeze({castTensor:pi,reshapeTensor:Pi,linspaceImpl:qi,upcastType:yn,axesAreInnerMostDims:es,combineLocations:Nl,computeOutAndReduceShapes:pa,expandShapeToKeepDim:Ea,assertAxesAreInnerMostDims:La,getAxesPermutation:Fs,getUndoAxesPermutation:vl,getInnerMostAxes:Rs,getBroadcastDims:Ms,getReductionAxes:Xs,assertAndGetBroadcastShape:Co,assertParamsConsistent:tf,computeOutShape:Ku,computePool2DInfo:Nn,computePool3DInfo:Pn,computeConv2DInfo:Vn,computeConv3DInfo:rr,computeDefaultPad:Yn,tupleValuesAreOne:yi,eitherStridesOrDilationsAreOne:zr,convertConv2DDataFormat:li,PARALLELIZE_THRESHOLD:Pl,computeOptimalWindowSize:lf});function Oi(p,c){if(p.length!==c.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+p.length+", imag: "+c.length+".");for(var a=new Float32Array(2*p.length),l=0;l<a.length;l+=2)a[l]=p[l/2],a[l+1]=c[l/2];return a}function Vo(p,c){return{real:p[2*c],imag:p[2*c+1]}}function qo(p,c,a,l){p[2*l]=c,p[2*l+1]=a}function Ia(p,c,a){var l=(a?2:-2)*Math.PI*(p/c);return{real:Math.cos(l),imag:Math.sin(l)}}function Ao(p,c,a){var l=function(S,U,G){return function(ae,le,be){for(var Se=0,Ie=ae.length,Me=0,qe=!1;Se<Ie;){var Ye=be(le,ae[Me=Se+(Ie-Se>>>1)]);Ye>0?Se=Me+1:(Ie=Me,qe=!Ye)}return qe?Se:-Se-1}(S,U,G||Ho)}(p,c,a),y=l<0?-(l+1):l;p.splice(y,0,c)}function Ho(p,c){return p>c?1:p<c?-1:0}function zo(p,c,a,l,y){return Xa(p,c,a,l,y,0).selectedIndices}function Sa(p,c,a,l,y,S){var U=Xa(p,c,a,l,y,S);return U.numValidOutputs.dispose(),{selectedIndices:U.selectedIndices,selectedScores:U.selectedScores}}function Xa(p,c,a,l,y,S,U,G){G===void 0&&(G=!1);for(var ae=Array.from(c).map(function(_t,jt){return{score:_t,boxIndex:jt,suppressBeginIndex:0}}).filter(function(_t){return _t.score>y}).sort(Jo),le=S>0?-.5/S:0,be=[],Se=[];be.length<a&&ae.length>0;){var Ie=ae.pop(),Me=Ie.score,qe=Ie.boxIndex,Ye=Ie.suppressBeginIndex;if(Me<y)break;for(var Xe=!1,at=be.length-1;at>=Ye;--at){var gt=Zi(p,qe,be[at]);if(gt>=l){Xe=!0;break}if(Ie.score=Ie.score*co(l,le,gt),Ie.score<=y)break}Ie.suppressBeginIndex=be.length,Xe||(Ie.score===Me?(be.push(qe),Se.push(Ie.score)):Ie.score>y&&Ao(ae,Ie,Jo))}var bt=be.length;return G&&(be.fill(0,bt),Se.fill(0,bt)),{selectedIndices:Cc(be,"int32"),selectedScores:Cc(Se,"float32"),numValidOutputs:Mr(bt,"int32")}}function Zi(p,c,a){var l=p.subarray(4*c,4*c+4),y=p.subarray(4*a,4*a+4),S=Math.min(l[0],l[2]),U=Math.min(l[1],l[3]),G=Math.max(l[0],l[2]),ae=Math.max(l[1],l[3]),le=Math.min(y[0],y[2]),be=Math.min(y[1],y[3]),Se=Math.max(y[0],y[2]),Ie=Math.max(y[1],y[3]),Me=(G-S)*(ae-U),qe=(Se-le)*(Ie-be);if(Me<=0||qe<=0)return 0;var Ye=Math.max(S,le),Xe=Math.max(U,be),at=Math.min(G,Se),gt=Math.min(ae,Ie),bt=Math.max(at-Ye,0)*Math.max(gt-Xe,0);return bt/(Me+qe-bt)}function co(p,c,a){var l=Math.exp(c*a*a);return a<=p?l:0}function Jo(p,c){return p.score-c.score||p.score===c.score&&c.boxIndex-p.boxIndex}function Pa(p,c,a){var l=new Array(p.rank).fill(0),y=p.shape.slice();return c.map(function(S){y[a]=S;var U=p.slice(l,y);return l[a]+=S,U})}function ks(p,c){for(var a=new Array(p.rank),l=0;l<a.length;l++)a[l]=p.shape[l]*c[l];var y=Ki(a,p.dtype);for(l=0;l<y.values.length;++l){for(var S=y.indexToLoc(l),U=new Array(p.rank),G=0;G<U.length;G++)U[G]=S[G]%p.shape[G];var ae=p.locToIndex(U);y.values[l]=p.values[ae]}return y.toTensor()}function Qo(p,c,a,l,y){for(var S=c[c.length-1],U=[p.length/S,S],G=U[0],ae=U[1],le=tr(a,G*l),be=tr("int32",G*l),Se=0;Se<G;Se++){for(var Ie=Se*ae,Me=p.subarray(Ie,Ie+ae),qe=[],Ye=0;Ye<Me.length;Ye++)qe.push({value:Me[Ye],index:Ye});qe.sort(function(_t,jt){return jt.value-_t.value});var Xe=Se*l,at=le.subarray(Xe,Xe+l),gt=be.subarray(Xe,Xe+l);for(Ye=0;Ye<l;Ye++)at[Ye]=qe[Ye].value,gt[Ye]=qe[Ye].index}var bt=c.slice();return bt[bt.length-1]=l,[la(le,bt,a),la(be,bt,"int32")]}function Wa(p,c){for(var a=[],l=0;l<c.length;l++)c[l]&&a.push(l);var y=Ki(p,"int32"),S=Ki([a.length,p.length],"int32");for(l=0;l<a.length;l++){var U=y.indexToLoc(a[l]),G=l*p.length;S.values.set(U,G)}return S.toTensor()}function ku(p,c){return["x","y","z","w","u","v"].slice(0,c).map(function(a){return p+"."+a})}function Cs(p,c){return c===1?[p]:ku(p,c)}function fa(){var p,c,a,l,y,S,U,G,ae,le;return W().getNumber("WEBGL_VERSION")===2?(p="#version 300 es",c="in",a="out",l="in",y="texture",S="outputColor",U="out vec4 outputColor;",G=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,ae="",le=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(p="",c="attribute",a="varying",l="varying",y="texture2D",S="gl_FragColor",U="",G=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,ae=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,le=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:p,attribute:c,varyingVs:a,varyingFs:l,texture2D:y,output:S,defineOutput:U,defineSpecialNaN:G,defineSpecialInf:ae,defineRound:le}}function _s(p,c,a){a===void 0&&(a="index");var l=Tr(c);return l.map(function(y,S){return"int "+p[S]+" = "+a+" / "+y+"; "+(S===l.length-1?"int "+p[S+1]+" = "+a+" - "+p[S]+" * "+y:"index -= "+p[S]+" * "+y)+";"}).join("")}function _l(p){var c=Tr(p).map(function(a){return a.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+c[0]+" + coords.y * "+c[1]+` + coords.z;
  }
`}var Js=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function Bs(p,c,a,l){var y=[];p.forEach(function(Me){var qe=Qe(Me.shapeInfo.logicalShape);Me.shapeInfo.isUniform?y.push("uniform float "+Me.name+(qe>1?"["+qe+"]":"")+";"):(y.push("uniform sampler2D "+Me.name+";"),y.push("uniform int offset"+Me.name+";"))});var S,U,G=y.join(`
`),ae=p.map(function(Me){return function(qe,Ye,Xe){Xe===void 0&&(Xe=!1);var at="";at+=Xe?function _t(jt){var Qt,sn,Zt;switch(jt.shapeInfo.logicalShape.length){case 0:return Qt=jt.name,sn="get"+Qt.charAt(0).toUpperCase()+Qt.slice(1),Zt=fa(),`
    vec4 `+sn+`() {
      return `+Zt.texture2D+"("+Qt+`, halfCR);
    }
  `;case 1:return function(rn){var Sn=rn.name,Bn="get"+Sn.charAt(0).toUpperCase()+Sn.slice(1),Mn=rn.shapeInfo.texShape,fr=[Math.ceil(Mn[0]/2),Math.ceil(Mn[1]/2)],yr=fa();return`
    vec4 `+Bn+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+fr[0]+", "+fr[1]+`, index);
      return `+yr.texture2D+"("+Sn+`, uv);
    }
  `}(jt);case 2:return function(rn){var Sn=rn.shapeInfo.logicalShape,Bn=rn.name,Mn="get"+Bn.charAt(0).toUpperCase()+Bn.slice(1),fr=rn.shapeInfo.texShape,yr=fr[0],Cr=fr[1],Nr=fa();if(fr!=null&&fn(Sn,fr))return`
      vec4 `+Mn+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+Cr+".0, "+yr+`.0);

        return `+Nr.texture2D+"("+Bn+`, uv);
      }
    `;var Ar=[Math.ceil(fr[0]/2),Math.ceil(fr[1]/2)],_r=Math.ceil(Sn[1]/2);return`
    vec4 `+Mn+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+_r+", "+Ar[0]+", "+Ar[1]+`, row, col);
      return `+Nr.texture2D+"("+Bn+`, uv);
    }
  `}(jt);case 3:return function(rn){var Sn=rn.shapeInfo.logicalShape,Bn=rn.name,Mn="get"+Bn.charAt(0).toUpperCase()+Bn.slice(1),fr=rn.shapeInfo.texShape,yr=[Math.ceil(fr[0]/2),Math.ceil(fr[1]/2)];if(Sn[0]===1){var Cr=Sn.slice(1),Nr=Qu(rn,Cr);return`
        `+_t(Nr)+`
        vec4 `+Mn+`(int b, int row, int col) {
          return `+Mn+"("+Pu(["b","row","col"],[1,2])+`);
        }
      `}var Ar=yr[0],_r=yr[1],Yr=Math.ceil(Sn[2]/2),Kr=Yr*Math.ceil(Sn[1]/2),fi=fa();return`
    vec4 `+Mn+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+Ar+", "+_r+", "+Kr+", "+Yr+`, b, row, col);
      return `+fi.texture2D+"("+Bn+`, uv);
    }
  `}(jt);default:return function(rn){for(var Sn=rn.shapeInfo.logicalShape,Bn=Sn.length,Mn=rn.name,fr="get"+Mn.charAt(0).toUpperCase()+Mn.slice(1),yr=rn.shapeInfo.texShape,Cr=[Math.ceil(yr[0]/2),Math.ceil(yr[1]/2)],Nr=Cr[0],Ar=Cr[1],_r=Math.ceil(Sn[Bn-1]/2),Yr=_r*Math.ceil(Sn[Bn-2]/2),Kr="int b, int row, int col",fi="b * "+Yr+" + (row / 2) * "+_r+" + (col / 2)",Ti=2;Ti<Bn-1;Ti++)Kr="int b"+Ti+", "+Kr,Yr*=Sn[Bn-Ti-1],fi="b"+Ti+" * "+Yr+" + "+fi;var Yi=fa();return`
    vec4 `+fr+"("+Kr+`) {
      int index = `+fi+`;
      int texR = index / `+Ar+`;
      int texC = index - texR * `+Ar+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+Ar+", "+Nr+`);
      return `+Yi.texture2D+"("+Mn+`, uv);
    }
  `}(jt)}}(qe):function _t(jt){var Qt=jt.shapeInfo.logicalShape;switch(Qt.length){case 0:return function(sn){var Zt=sn.name,rn="get"+Zt.charAt(0).toUpperCase()+Zt.slice(1);if(sn.shapeInfo.isUniform)return"float "+rn+"() {return "+Zt+";}";var Sn=sn.shapeInfo.texShape,Bn=Sn[0],Mn=Sn[1];if(Bn===1&&Mn===1)return`
      float `+rn+`() {
        return sampleTexture(`+Zt+`, halfCR);
      }
    `;var fr=sn.shapeInfo.texShape,yr=fr[0],Cr=fr[1],Nr=ns(Zt);return`
    float `+rn+`() {
      vec2 uv = uvFromFlat(`+yr+", "+Cr+", "+Nr+`);
      return sampleTexture(`+Zt+`, uv);
    }
  `}(jt);case 1:return function(sn){var Zt=sn.name,rn="get"+Zt.charAt(0).toUpperCase()+Zt.slice(1);if(sn.shapeInfo.isUniform)return`
      float `+rn+`(int index) {
        `+Bu(sn)+`
      }
    `;var Sn=sn.shapeInfo.texShape,Bn=Sn[0],Mn=Sn[1];if(Mn===1&&Bn===1)return`
      float `+rn+`(int index) {
        return sampleTexture(`+Zt+`, halfCR);
      }
    `;var fr=ns(Zt);return Mn===1?`
      float `+rn+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+fr+") + 0.5) / "+Bn+`.0);
        return sampleTexture(`+Zt+`, uv);
      }
    `:Bn===1?`
      float `+rn+`(int index) {
        vec2 uv = vec2((float(index + `+fr+") + 0.5) / "+Mn+`.0, 0.5);
        return sampleTexture(`+Zt+`, uv);
      }
    `:`
    float `+rn+`(int index) {
      vec2 uv = uvFromFlat(`+Bn+", "+Mn+", index + "+fr+`);
      return sampleTexture(`+Zt+`, uv);
    }
  `}(jt);case 2:return function(sn){var Zt=sn.shapeInfo.logicalShape,rn=sn.name,Sn="get"+rn.charAt(0).toUpperCase()+rn.slice(1),Bn=sn.shapeInfo.texShape;if(Bn!=null&&fn(Zt,Bn)){var Mn=Bn[0],fr=Bn[1];return`
    float `+Sn+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+fr+".0, "+Mn+`.0);
      return sampleTexture(`+rn+`, uv);
    }
  `}var yr=Hn(Zt),Cr=yr.newShape,Nr=yr.keptDims,Ar=Cr;if(Ar.length<Zt.length){var _r=Qu(sn,Ar);return`
      `+_t(_r)+`
      float `+Sn+`(int row, int col) {
        return `+Sn+"("+Pu(["row","col"],Nr)+`);
      }
    `}if(sn.shapeInfo.isUniform)return`
      float `+Sn+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+Zt[1]+`, 1)));
        `+Bu(sn)+`
      }
    `;var Yr=Bn[0],Kr=Bn[1],fi=ns(rn);return Kr===1?`
    float `+Sn+`(int row, int col) {
      float index = dot(vec3(row, col, `+fi+"), vec3("+Zt[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+Yr+`.0);
      return sampleTexture(`+rn+`, uv);
    }
  `:Yr===1?`
    float `+Sn+`(int row, int col) {
      float index = dot(vec3(row, col, `+fi+"), vec3("+Zt[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+Kr+`.0, 0.5);
      return sampleTexture(`+rn+`, uv);
    }
  `:`
  float `+Sn+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+Zt[1]+" + col + "+fi+`;
    vec2 uv = uvFromFlat(`+Yr+", "+Kr+`, index);
    return sampleTexture(`+rn+`, uv);
  }
`}(jt);case 3:return function(sn){var Zt=sn.shapeInfo.logicalShape,rn=sn.name,Sn="get"+rn.charAt(0).toUpperCase()+rn.slice(1),Bn=Zt[1]*Zt[2],Mn=Zt[2],fr=Hn(Zt),yr=fr.newShape,Cr=fr.keptDims,Nr=yr;if(Nr.length<Zt.length){var Ar=Qu(sn,Nr);return`
        `+_t(Ar)+`
        float `+Sn+`(int row, int col, int depth) {
          return `+Sn+"("+Pu(["row","col","depth"],Cr)+`);
        }
      `}if(sn.shapeInfo.isUniform)return`
      float `+Sn+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+Bn+", "+Mn+`, 1)));
        `+Bu(sn)+`
      }
    `;var _r=sn.shapeInfo.texShape,Yr=_r[0],Kr=_r[1],fi=sn.shapeInfo.flatOffset;if(Kr===Bn&&fi==null)return`
        float `+Sn+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+Mn+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+Kr+".0, "+Yr+`.0);
          return sampleTexture(`+rn+`, uv);
        }
      `;if(Kr===Mn&&fi==null)return`
    float `+Sn+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+Zt[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+Kr+".0, "+Yr+`.0);
      return sampleTexture(`+rn+`, uv);
    }
  `;var Ti=ns(rn);return`
      float `+Sn+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+Bn+" + col * "+Mn+" + depth + "+Ti+`;
        vec2 uv = uvFromFlat(`+Yr+", "+Kr+`, index);
        return sampleTexture(`+rn+`, uv);
      }
  `}(jt);case 4:return function(sn){var Zt=sn.shapeInfo.logicalShape,rn=sn.name,Sn="get"+rn.charAt(0).toUpperCase()+rn.slice(1),Bn=Zt[3],Mn=Zt[2]*Bn,fr=Zt[1]*Mn,yr=Hn(Zt),Cr=yr.newShape,Nr=yr.keptDims;if(Cr.length<Zt.length){var Ar=Qu(sn,Cr);return`
      `+_t(Ar)+`
      float `+Sn+`(int row, int col, int depth, int depth2) {
        return `+Sn+"("+Pu(["row","col","depth","depth2"],Nr)+`);
      }
    `}if(sn.shapeInfo.isUniform)return`
      float `+Sn+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+fr+", "+Mn+", "+Bn+`, 1)));
        `+Bu(sn)+`
      }
    `;var _r=sn.shapeInfo.flatOffset,Yr=sn.shapeInfo.texShape,Kr=Yr[0],fi=Yr[1];if(fi===fr&&_r==null)return`
      float `+Sn+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+Mn+", "+Bn+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+fi+".0, "+Kr+`.0);
        return sampleTexture(`+rn+`, uv);
      }
    `;if(fi===Bn&&_r==null)return`
      float `+Sn+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+Zt[1]*Zt[2]+", "+Zt[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+fi+".0, "+Kr+`.0);
        return sampleTexture(`+rn+`, uv);
      }
    `;var Ti=ns(rn);return`
    float `+Sn+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+fr+" + col * "+Mn+` +
          depth * `+Bn+` + depth2;
      vec2 uv = uvFromFlat(`+Kr+", "+fi+", index + "+Ti+`);
      return sampleTexture(`+rn+`, uv);
    }
  `}(jt);case 5:return function(sn){var Zt=sn.shapeInfo.logicalShape,rn=sn.name,Sn="get"+rn.charAt(0).toUpperCase()+rn.slice(1),Bn=Zt[4],Mn=Zt[3]*Bn,fr=Zt[2]*Mn,yr=Zt[1]*fr,Cr=Hn(Zt),Nr=Cr.newShape,Ar=Cr.keptDims;if(Nr.length<Zt.length){var _r=Qu(sn,Nr);return`
      `+_t(_r)+`
      float `+Sn+`(int row, int col, int depth, int depth2, int depth3) {
        return `+Sn+"("+Pu(["row","col","depth","depth2","depth3"],Ar)+`);
      }
    `}if(sn.shapeInfo.isUniform)return`
      float `+Sn+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+yr+", "+fr+", "+Mn+", "+Bn+`)) +
          depth3;
        `+Bu(sn)+`
      }
    `;var Yr=sn.shapeInfo.flatOffset,Kr=sn.shapeInfo.texShape,fi=Kr[0],Ti=Kr[1];if(Ti===yr&&Yr==null)return`
      float `+Sn+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+fr+", "+Mn+", "+Bn+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+Ti+".0, "+fi+`.0);
        return sampleTexture(`+rn+`, uv);
      }
    `;if(Ti===Bn&&Yr==null)return`
      float `+Sn+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+Zt[1]*Zt[2]*Zt[3]+`,
               `+Zt[2]*Zt[3]+", "+Zt[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+Ti+".0, "+fi+`.0);
        return sampleTexture(`+rn+`, uv);
      }
    `;var Yi=ns(rn);return`
    float `+Sn+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+yr+" + col * "+fr+" + depth * "+Mn+` +
          depth2 * `+Bn+" + depth3 + "+Yi+`;
      vec2 uv = uvFromFlat(`+fi+", "+Ti+`, index);
      return sampleTexture(`+rn+`, uv);
    }
  `}(jt);case 6:return function(sn){var Zt=sn.shapeInfo.logicalShape,rn=sn.name,Sn="get"+rn.charAt(0).toUpperCase()+rn.slice(1),Bn=Hn(Zt),Mn=Bn.newShape,fr=Bn.keptDims;if(Mn.length<Zt.length){var yr=Qu(sn,Mn);return`
      `+_t(yr)+`
      float `+Sn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+Sn+"("+Pu(["row","col","depth","depth2","depth3","depth4"],fr)+`);
      }
    `}var Cr=Zt[5],Nr=Zt[4]*Cr,Ar=Zt[3]*Nr,_r=Zt[2]*Ar,Yr=Zt[1]*_r;if(sn.shapeInfo.isUniform)return`
      float `+Sn+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+Yr+", "+_r+", "+Ar+", "+Nr+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+Cr+`, 1)));
        `+Bu(sn)+`
      }
    `;var Kr=sn.shapeInfo.flatOffset,fi=sn.shapeInfo.texShape,Ti=fi[0],Yi=fi[1];if(Yi===Yr&&Kr==null)return`
      float `+Sn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+_r+", "+Ar+", "+Nr+", "+Cr+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+Yi+".0, "+Ti+`.0);
        return sampleTexture(`+rn+`, uv);
      }
    `;if(Yi===Cr&&Kr==null)return`
      float `+Sn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+Zt[1]*Zt[2]*Zt[3]*Zt[4]+`,
               `+Zt[2]*Zt[3]*Zt[4]+`,
               `+Zt[3]*Zt[4]+`,
               `+Zt[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+Yi+".0, "+Ti+`.0);
        return sampleTexture(`+rn+`, uv);
      }
    `;var ia=ns(rn);return`
    float `+Sn+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+Yr+" + col * "+_r+" + depth * "+Ar+` +
          depth2 * `+Nr+" + depth3 * "+Cr+" + depth4 + "+ia+`;
      vec2 uv = uvFromFlat(`+Ti+", "+Yi+`, index);
      return sampleTexture(`+rn+`, uv);
    }
  `}(jt);default:throw new Error(Qt.length+"-D input sampling is not yet supported")}}(qe);var gt=qe.shapeInfo.logicalShape,bt=Ye.logicalShape;return gt.length<=bt.length&&(at+=Xe?function(_t,jt){var Qt,sn=_t.name,Zt=sn.charAt(0).toUpperCase()+sn.slice(1),rn="get"+Zt+"AtOutCoords",Sn=_t.shapeInfo.logicalShape.length,Bn=jt.logicalShape.length,Mn=Ms(_t.shapeInfo.logicalShape,jt.logicalShape),fr=Da(Bn),yr=Bn-Sn,Cr=["x","y","z","w","u","v"];Qt=Sn===0?"":Bn<2&&Mn.length>=1?"coords = 0;":Mn.map(function(Ti){return"coords."+Cr[Ti+yr]+" = 0;"}).join(`
`);var Nr;Nr=Bn<2&&Sn>0?"coords":_t.shapeInfo.logicalShape.map(function(Ti,Yi){return"coords."+Cr[Yi+yr]}).join(", ");var Ar="return outputValue;",_r=Qe(_t.shapeInfo.logicalShape)===1,Yr=Qe(jt.logicalShape)===1;if(Sn!==1||_r||Yr){if(_r&&!Yr)Ar=Bn===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(Mn.length){var Kr=Sn-2,fi=Sn-1;Mn.indexOf(Kr)>-1&&Mn.indexOf(fi)>-1?Ar="return vec4(outputValue.x);":Mn.indexOf(Kr)>-1?Ar="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":Mn.indexOf(fi)>-1&&(Ar="return vec4(outputValue.xx, outputValue.zz);")}}else Ar=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+rn+`() {
      `+fr+` coords = getOutputCoords();
      `+Qt+`
      vec4 outputValue = get`+Zt+"("+Nr+`);
      `+Ar+`
    }
  `}(qe,Ye):function(_t,jt){var Qt=_t.name,sn=Qt.charAt(0).toUpperCase()+Qt.slice(1),Zt="get"+sn+"AtOutCoords",rn=jt.texShape,Sn=_t.shapeInfo.texShape,Bn=_t.shapeInfo.logicalShape.length,Mn=jt.logicalShape.length;if(!_t.shapeInfo.isUniform&&Bn===Mn&&_t.shapeInfo.flatOffset==null&&fn(Sn,rn))return`
      float `+Zt+`() {
        return sampleTexture(`+Qt+`, resultUV);
      }
    `;var fr=Da(Mn),yr=Ms(_t.shapeInfo.logicalShape,jt.logicalShape),Cr=Mn-Bn,Nr=["x","y","z","w","u","v"];return`
    float `+Zt+`() {
      `+fr+` coords = getOutputCoords();
      `+(Bn===0?"":Mn<2&&yr.length>=1?"coords = 0;":yr.map(function(Ar){return"coords."+Nr[Ar+Cr]+" = 0;"}).join(`
`))+`
      return get`+sn+"("+(Mn<2&&Bn>0?"coords":_t.shapeInfo.logicalShape.map(function(Ar,_r){return"coords."+Nr[_r+Cr]}).join(", "))+`);
    }
  `}(qe,Ye)),at}(Me,c,l)}).join(`
`),le=c.texShape,be=fa(),Se=`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+be.texture2D+`(textureSampler, uv).r;
    }
  `,Ie=function(Me){return Me.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+Me.varyingFs+` vec2 resultUV;
    `+Me.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+Me.defineSpecialNaN+`
    `+Me.defineSpecialInf+`
    `+Me.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+Fa+`
    `+ff+`
    `+_u+`
  `}(be);return c.isPacked?(S=function(Me,qe){switch(Me.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(_t,jt){var Qt=[Math.ceil(jt[0]/2),Math.ceil(jt[1]/2)];return Qt[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+Qt[1]+`.0);
      }
    `:Qt[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+Qt[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Qt[0]+", "+Qt[1]+`));
      return 2 * (resTexRC.x * `+Qt[1]+` + resTexRC.y);
    }
  `}(0,qe);case 2:return function(_t,jt){var Qt=[Math.ceil(jt[0]/2),Math.ceil(jt[1]/2)];if(fn(_t,jt))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+Qt[0]+", "+Qt[1]+`));
      }
    `;var sn=Math.ceil(_t[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Qt[0]+", "+Qt[1]+`));

      int index = resTexRC.x * `+Qt[1]+` + resTexRC.y;
      int r = 2 * (index / `+sn+`);
      int c = imod(index, `+sn+`) * 2;

      return ivec2(r, c);
    }
  `}(Me,qe);case 3:return Ye=Me,Xe=qe,at=[Math.ceil(Xe[0]/2),Math.ceil(Xe[1]/2)],bt=(gt=Math.ceil(Ye[2]/2))*Math.ceil(Ye[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+at[0]+", "+at[1]+`));
      int index = resTexRC.x * `+at[1]+` + resTexRC.y;

      int b = index / `+bt+`;
      index -= b * `+bt+`;

      int r = 2 * (index / `+gt+`);
      int c = imod(index, `+gt+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(_t,jt){for(var Qt=[Math.ceil(jt[0]/2),Math.ceil(jt[1]/2)],sn=Math.ceil(_t[_t.length-1]/2),Zt=sn*Math.ceil(_t[_t.length-2]/2),rn=Zt,Sn="",Bn="b, r, c",Mn=2;Mn<_t.length-1;Mn++)Sn=`
      int b`+Mn+" = index / "+(rn*=_t[_t.length-Mn-1])+`;
      index -= b`+Mn+" * "+rn+`;
    `+Sn,Bn="b"+Mn+", "+Bn;return`
    ivec`+_t.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Qt[0]+", "+Qt[1]+`));
      int index = resTexRC.x * `+Qt[1]+` + resTexRC.y;

      `+Sn+`

      int b = index / `+Zt+`;
      index -= b * `+Zt+`;

      int r = 2 * (index / `+sn+`);
      int c = imod(index, `+sn+`) * 2;

      return ivec`+_t.length+"("+Bn+`);
    }
  `}(Me,qe)}var Ye,Xe,at,gt,bt}(c.logicalShape,le),U=`
    void setOutput(vec4 val) {
      `+be.output+` = val;
    }
  `):(S=function(Me,qe){switch(Me.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(at,gt){return gt[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+gt[1]+`.0);
      }
    `:gt[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+gt[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+gt[0]+", "+gt[1]+`));
      return resTexRC.x * `+gt[1]+` + resTexRC.y;
    }
  `}(0,qe);case 2:return function(at,gt){return fn(at,gt)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+gt[0]+", "+gt[1]+`));
      }
    `:at[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+gt[0]+", "+gt[1]+`));
        int index = resTexRC.x * `+gt[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:at[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+gt[0]+", "+gt[1]+`));
        int index = resTexRC.x * `+gt[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+gt[0]+", "+gt[1]+`));
      int index = resTexRC.x * `+gt[1]+` + resTexRC.y;
      int r = index / `+at[1]+`;
      int c = index - r * `+at[1]+`;
      return ivec2(r, c);
    }
  `}(Me,qe);case 3:return Ye=qe,Xe=_s(["r","c","d"],Me),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Ye[0]+", "+Ye[1]+`));
      int index = resTexRC.x * `+Ye[1]+` + resTexRC.y;
      `+Xe+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(at,gt){var bt=_s(["r","c","d","d2"],at);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+gt[0]+", "+gt[1]+`));
      int index = resTexRC.x * `+gt[1]+` + resTexRC.y;
      `+bt+`
      return ivec4(r, c, d, d2);
    }
  `}(Me,qe);case 5:return function(at,gt){var bt=_s(["r","c","d","d2","d3"],at);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+gt[0]+`,
                             `+gt[1]+`));

      int index = resTexRC.x * `+gt[1]+` + resTexRC.y;

      `+bt+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(Me,qe);case 6:return function(at,gt){var bt=_s(["r","c","d","d2","d3","d4"],at);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+gt[0]+", "+gt[1]+`));
      int index = resTexRC.x * `+gt[1]+` + resTexRC.y;

      `+bt+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(Me,qe);default:throw new Error(Me.length+"-D output sampling is not yet supported")}var Ye,Xe}(c.logicalShape,le),U=`
    void setOutput(float val) {
      `+be.output+` = vec4(val, 0, 0, 0);
    }
  `),l&&(Ie+=dc),[Ie,Se,U,G,S,ae,a].join(`
`)}var Fa=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,ff=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,_u=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,dc=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function ns(p){return"offset"+p}function Bu(p){var c=p.name,a=Qe(p.shapeInfo.logicalShape);return a<2?"return "+c+";":`
    for (int i = 0; i < `+a+`; i++) {
      if (i == index) {
        return `+c+`[i];
      }
    }
  `}function Da(p){if(p<=1)return"int";if(p===2)return"ivec2";if(p===3)return"ivec3";if(p===4)return"ivec4";if(p===5)return"ivec5";if(p===6)return"ivec6";throw Error("GPU for rank "+p+" is not yet supported")}function Qu(p,c){var a=JSON.parse(JSON.stringify(p));return a.shapeInfo.logicalShape=c,a}function Pu(p,c){return c.map(function(a){return p[a]}).join(", ")}var Zo=function(p,c,a){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Co(c,a),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+p+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Lu="return a + b;",Qs="return a - b;",Dc="return a * b;",Ll="return (a < 0.) ? b * a : a;",Va=function(p,c,a){this.variableNames=["A","B"],this.outputShape=Co(c,a),this.userCode=`
      float binaryOperation(float a, float b) {
        `+p+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},hu=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Ps=function(p,c,a,l){l===void 0&&(l=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Co(c,a);var y=this.outputShape.length,S="";if(l)if(y===0||Qe(this.outputShape)===1)S=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(S=`
          `+Da(y)+` coords = getOutputCoords();
        `,y===1)S+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var U=Cs("coords",y);S+=`
            bool nextRowOutOfBounds =
              (`+U[y-2]+" + 1) >= "+this.outputShape[y-2]+`;
            bool nextColOutOfBounds =
              (`+U[y-1]+" + 1) >= "+this.outputShape[y-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+p+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+S+`

        setOutput(result);
      }
    `},rl=function(){function p(c){this.variableNames=["A"],this.outputShape=c,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return p.prototype.getCustomSetupFunc=function(c,a){var l=this;return function(y,S){l.minLoc==null&&(l.minLoc=y.getUniformLocationNoThrow(S,"minVal"),l.maxLoc=y.getUniformLocationNoThrow(S,"maxVal")),y.gl.uniform1f(l.minLoc,c),y.gl.uniform1f(l.maxLoc,a)}},p}(),ah=function(){function p(c){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=c,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return p.prototype.getCustomSetupFunc=function(c,a){var l=this;return function(y,S){l.minLoc==null&&(l.minLoc=y.getUniformLocationNoThrow(S,"minVal"),l.maxLoc=y.getUniformLocationNoThrow(S,"maxVal")),y.gl.uniform1f(l.minLoc,c),y.gl.uniform1f(l.maxLoc,a)}},p}();function Wi(p,c,a){var l=p.indexOf(c);return p.map(function(y,S){return S===l?y+" - "+a:y}).join()}var rp=function(p,c,a,l){c===void 0&&(c=!1),a===void 0&&(a=null),l===void 0&&(l=!1),this.variableNames=["x","W"],this.outputShape=p.outShape;var y=p.padInfo.top,S=p.padInfo.left,U=p.strideHeight,G=p.strideWidth,ae=p.dilationHeight,le=p.dilationWidth,be=p.filterHeight,Se=p.filterWidth,Ie=4*Math.floor(p.inChannels/4),Me=p.inChannels%4,qe=p.dataFormat==="channelsLast",Ye=qe?1:2,Xe=qe?2:3,at=qe?3:1,gt="",bt="";a&&(gt=l?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+a+`
        }`:`
          float activation(float x) {
            `+a+`
          }
        `,bt="result = activation(result);");var _t=c?"result += getBiasAtOutCoords();":"";c&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+gt+`

      const ivec2 strides = ivec2(`+U+", "+G+`);
      const ivec2 pads = ivec2(`+y+", "+S+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+at+`];

        ivec2 xRCCorner =
            ivec2(coords[`+Ye+"], coords["+Xe+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+be+`; wR++) {
          int xR = xRCorner + wR * `+ae+`;

          if (xR < 0 || xR >= `+p.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+Se+`; wC++) {
            int xC = xCCorner + wC * `+le+`;

            if (xC < 0 || xC >= `+p.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+Ie+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+qe+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(Me===1)+`) {

              if (`+qe+`) {
                dotProd +=
                    getX(batch, xR, xC, `+Ie+`) *
                    getW(wR, wC, `+Ie+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+Ie+`, xR, xC) *
                    getW(wR, wC, `+Ie+`, d2);
              }

            } else if (`+(Me===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+Ie+`, d2),
                getW(wR, wC, `+Ie+` + 1, d2)
              );

              if (`+qe+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+Ie+`),
                  getX(batch, xR, xC, `+Ie+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+Ie+`, xR, xC),
                  getX(batch, `+Ie+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(Me===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+Ie+`, d2),
                getW(wR, wC, `+Ie+` + 1, d2),
                getW(wR, wC, `+Ie+` + 2, d2)
              );

              if (`+qe+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+Ie+`),
                  getX(batch, xR, xC, `+Ie+` + 1),
                  getX(batch, xR, xC, `+Ie+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+Ie+`, xR, xC),
                  getX(batch, `+Ie+` + 1, xR, xC),
                  getX(batch, `+Ie+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+_t+`
        `+bt+`
        setOutput(result);
      }
    `},sh=function(p,c,a,l){c===void 0&&(c=!1),a===void 0&&(a=null),l===void 0&&(l=!1),this.variableNames=["x","W"],this.outputShape=p.outShape;var y=p.inHeight,S=p.inWidth,U=p.padInfo.top,G=p.padInfo.left,ae=p.strideHeight,le=p.strideWidth,be=p.dilationHeight,Se=p.dilationWidth,Ie=p.filterHeight,Me=p.filterWidth,qe=p.outChannels/p.inChannels,Ye="",Xe="";a&&(Ye=l?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+a+`
        }`:`
          float activation(float x) {
            `+a+`
          }
        `,Xe="result = activation(result);");var at=c?"result += getBiasAtOutCoords();":"";c&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+Ye+`

      const ivec2 strides = ivec2(`+ae+", "+le+`);
      const ivec2 pads = ivec2(`+U+", "+G+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+qe+`;
        int q = d2 - d1 * `+qe+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+Ie+`; wR++) {
          int xR = xRCorner + wR * `+be+`;

          if (xR < 0 || xR >= `+y+`) {
            continue;
          }

          for (int wC = 0; wC < `+Me+`; wC++) {
            int xC = xCCorner + wC * `+Se+`;

            if (xC < 0 || xC >= `+S+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+at+`
        `+Xe+`
        setOutput(result);
      }
    `},uh=function(p,c,a,l){c===void 0&&(c=!1),a===void 0&&(a=null),l===void 0&&(l=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=p.outShape;for(var y=p.inHeight,S=p.inWidth,U=p.padInfo.top,G=p.padInfo.left,ae=p.strideHeight,le=p.strideWidth,be=p.dilationHeight,Se=p.dilationWidth,Ie=p.filterHeight,Me=p.filterWidth,qe=Me,Ye="int xR; int xC; int xCOffset;",Xe=0;Xe<Ie;Xe++)for(var at=0;at<Me;at++)Ye+=`
          vec4 xTexelR`+Xe+"C"+2*at+` = vec4(0.);
          vec4 wR`+Xe+"C"+at+` = vec4(0.);
          vec4 xR`+Xe+"C"+at+" = vec4(0.);";for(Xe=0;Xe<Ie;Xe++)for(var gt=0;gt<qe;gt++){if(Ye+=`
          xR = xRCorner + `+Xe*be+`;
          xC = xCCorner + `+(at=2*gt)*Se+`;
        `,le===1){if(at<Me&&(Ye+=G%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+y+" && xCOffset >= 0 && xCOffset < "+S+`) {
                  xTexelR`+Xe+"C"+at+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+S+`) {
                    xTexelR`+Xe+"C"+at+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+Xe+"C"+at+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+y+" && xCOffset >= 0 && xCOffset < "+S+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+S+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+Xe+"C"+at+" = vec4(previous.zw, xTexelR"+Xe+"C"+at+`.xy);
                } else {
                  xR`+Xe+"C"+at+" = vec4(0, 0, xTexelR"+Xe+"C"+at+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+y+" && xC >= 0 && xC < "+S+`) {
                  xTexelR`+Xe+"C"+at+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+Xe+"C"+at+` = vec4(0.);
                }

                xR`+Xe+"C"+at+" = xTexelR"+Xe+"C"+at+`;
              `,at+1<Me)){var bt=G%2==0?Xt(Se):Se;Se%2==0&&G%2==1||Se%2!=0&&G%2!=1?(Ye+=`
                  xCOffset = xC + `+G%2+" + "+bt+`;

                  if(xR >= 0 && xR < `+y+` &&
                    xCOffset >= 0 && xCOffset < `+S+`) {
                    xTexelR`+Xe+"C"+(at+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,Se>1&&(Ye+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+y+` &&
                      xCOffset >= 0 && xCOffset < `+S+`) {
                      xTexelR`+Xe+"C"+at+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+Xe+"C"+at+` = vec4(0.);
                    }
                  `),Ye+=`
                  xR`+Xe+"C"+(at+1)+` = vec4(
                    xTexelR`+Xe+"C"+at+".zw, xTexelR"+Xe+"C"+(at+2)+`.xy);
                `):Ye+=`
                  xCOffset = xC + `+bt+`;

                  if(xR >= 0 && xR < `+y+` &&
                    xCOffset >= 0 && xCOffset < `+S+`) {
                    xTexelR`+Xe+"C"+(at+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+Xe+"C"+(at+1)+" = xTexelR"+Xe+"C"+(at+2)+`;
                `}}else at<Me&&(Ye+=`
              if(xR >= 0 && xR < `+y+`) {
            `,G%2==1?(Ye+=`
                xCOffset = xC + 1 - `+le+`;
                if(xCOffset >= 0 && xCOffset < `+S+`) {
                  xTexelR`+Xe+"C"+at+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+Xe+"C"+at+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+S+`) {
                  xTexelR`+Xe+"C"+(at+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+Xe+"C"+(at+2)+` = vec4(0.);
                }

                xR`+Xe+"C"+at+` = vec4(
                  xTexelR`+Xe+"C"+at+".zw, xTexelR"+Xe+"C"+(at+2)+`.zw);
              `,at+1<Me&&(Ye+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+le+`;
                  if(xCOffset >= 0 && xCOffset < `+S+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+Xe+"C"+(at+1)+" = vec4(xTexelR"+Xe+"C"+(at+2)+`.xy, final.xy);
                `)):(Ye+=`
                if(xC >= 0 && xC < `+S+`) {
                  xTexelR`+Xe+"C"+at+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+Xe+"C"+at+` = vec4(0.);
                }

                xCOffset = xC + `+le+`;
                if(xCOffset >= 0 && xCOffset < `+S+`) {
                  xTexelR`+Xe+"C"+(at+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+Xe+"C"+(at+2)+` = vec4(0.);
                }

                xR`+Xe+"C"+at+` = vec4(
                  xTexelR`+Xe+"C"+at+".xy, xTexelR"+Xe+"C"+(at+2)+`.xy);
              `,at+1<Me&&(Ye+=`
                  xR`+Xe+"C"+(at+1)+` = vec4(
                    xTexelR`+Xe+"C"+at+".zw, xTexelR"+Xe+"C"+(at+2)+`.zw);
                `)),Ye+="}");at<Me&&(Ye+=`
            vec4 wTexelR`+Xe+"C"+at+" = getW("+Xe+", "+at+`, d1, q);
            wR`+Xe+"C"+at+" = vec4(wTexelR"+Xe+"C"+at+".xz, wTexelR"+Xe+"C"+at+`.xz);
          `,at+1<Me&&(Ye+=`
              vec4 wTexelR`+Xe+"C"+(at+1)+" = getW("+Xe+", "+(at+1)+`, d1, q);
              wR`+Xe+"C"+(at+1)+` =
                vec4(wTexelR`+Xe+"C"+(at+1)+".xz, wTexelR"+Xe+"C"+(at+1)+".xz);"))}for(Xe=0;Xe<Ie;Xe++)for(at=0;at<Me;at++)Ye+="dotProd += xR"+Xe+"C"+at+" * wR"+Xe+"C"+at+";";var _t="",jt="";a&&(_t=l?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+a+`
        }`:`vec4 activation(vec4 x) {
          `+a+`
        }`,jt="result = activation(result);");var Qt=c?"result += getBiasAtOutCoords();":"";c&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+_t+`

      const ivec2 strides = ivec2(`+ae+", "+le+`);
      const ivec2 pads = ivec2(`+U+", "+G+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+Ye+`

        vec4 result = dotProd;
        `+Qt+`
        `+jt+`
        setOutput(result);
      }
    `};function s0(p,c){if(p===1)return""+c;if(p===2)return c+".y";if(p===3)return c+".z";if(p===4)return c+".w";throw Error("Cumulative sum for rank "+p+" is not yet supported")}var Bm=function(){function p(c,a,l){this.variableNames=["x"],this.outputShape=[],this.outputShape=c,this.blockSize=a,this.dataFormat=l,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+a+`;
      int offset_h = imod(h, `+a+`);
      int in_w = w / `+a+`;
      int offset_w = imod(w, `+a+`);
      int offset_d = (offset_h * `+a+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return p.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},p.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},p.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},p.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},p.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},p}(),Pm=function(p,c,a){this.variableNames=["real","imag"];var l=c[1];this.outputShape=c;var y=a?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,S=a?l+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+y+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+p+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+l+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+l+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+S+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},Kp=function(){function p(c,a){this.outputShape=[],this.variableNames=["x"],this.outputShape=c,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return p.prototype.getCustomSetupFunc=function(c){var a=this;return function(l,y){a.valueLoc==null&&(a.valueLoc=l.getUniformLocationNoThrow(y,"value")),l.gl.uniform1f(a.valueLoc,c)}},p}();function u0(p,c){var a=fa();return So(p,c,a.version+`
    precision highp float;
    `+a.attribute+` vec3 clipSpacePos;
    `+a.attribute+` vec2 uv;
    `+a.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function Xp(p,c){return kc(p,c,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function sa(p,c){return _c(p,c,new Uint16Array([0,1,2,2,1,3]))}function Ad(p,c,a,l,y,S,U){Ql(a,l);var G=ws(p,c),ae=p.TEXTURE_2D;return qn(p,c,function(){return p.bindTexture(ae,G)}),qn(p,c,function(){return p.texParameteri(ae,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE)}),qn(p,c,function(){return p.texParameteri(ae,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE)}),qn(p,c,function(){return p.texParameteri(ae,p.TEXTURE_MIN_FILTER,p.NEAREST)}),qn(p,c,function(){return p.texParameteri(ae,p.TEXTURE_MAG_FILTER,p.NEAREST)}),qn(p,c,function(){return p.texImage2D(ae,0,y,a,l,0,S,U,null)}),qn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,null)}),G}function Yp(p,c,a,l,y){var S=no(a,l);return Ad(p,c,S[0],S[1],y.internalFormatFloat,y.textureFormatFloat,p.FLOAT)}function ip(p,c,a,l,y){var S=no(a,l);return Ad(p,c,S[0],S[1],y.internalFormatHalfFloat,y.textureFormatFloat,y.textureTypeHalfFloat)}function Tg(p,c,a,l,y){var S=no(a,l);return Ad(p,c,S[0],S[1],p.RGBA,p.RGBA,p.UNSIGNED_BYTE)}function c0(p,c,a,l,y){var S=mi(a,l);return Ad(p,c,S[0],S[1],y.internalFormatPackedFloat,p.RGBA,p.FLOAT)}function Nf(p,c,a,l,y){var S=mi(a,l);return Ad(p,c,S[0],S[1],y.internalFormatPackedHalfFloat,p.RGBA,y.textureTypeHalfFloat)}function Zu(p,c,a,l){return qn(p,c,function(){return p.bindBuffer(p.ARRAY_BUFFER,l)}),Mc(p,c,a,"clipSpacePos",l,3,20,0)&&Mc(p,c,a,"uv",l,2,20,12)}function Jp(p,c,a,l,y,S,U){var G,ae,le;qn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,a)}),S instanceof Uint8Array?(G=new Uint8Array(l*y*4),ae=p.UNSIGNED_BYTE,le=p.RGBA):(G=new Float32Array(l*y*4),ae=p.FLOAT,le=U.internalFormatPackedFloat),G.set(S),qn(p,c,function(){return p.texImage2D(p.TEXTURE_2D,0,le,l,y,0,p.RGBA,ae,G)}),qn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,null)})}function op(p,c,a,l){qn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,a)}),l.data instanceof Uint8Array?qn(p,c,function(){return p.texImage2D(p.TEXTURE_2D,0,p.RGBA,l.width,l.height,0,p.RGBA,p.UNSIGNED_BYTE,l.data)}):qn(p,c,function(){return p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,l)}),qn(p,c,function(){return p.bindTexture(p.TEXTURE_2D,null)})}function Qp(p,c,a,l,y){var S=p.createBuffer();qn(p,c,function(){return p.bindBuffer(p.PIXEL_PACK_BUFFER,S)});var U=16*a*l;return qn(p,c,function(){return p.bufferData(p.PIXEL_PACK_BUFFER,U,p.STREAM_READ)}),qn(p,c,function(){return p.readPixels(0,0,l,a,p.RGBA,p.FLOAT,0)}),qn(p,c,function(){return p.bindBuffer(p.PIXEL_PACK_BUFFER,null)}),S}function l0(p,c,a){var l=p,y=new Float32Array(a);return l.bindBuffer(l.PIXEL_PACK_BUFFER,c),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,y),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),y}function Lm(p,c,a,l,y){var S=no(a,l),U=S[0],G=S[1],ae=new Uint8Array(a*l*4);return qn(p,c,function(){return p.readPixels(0,0,U,G,y.downloadTextureFormat,p.UNSIGNED_BYTE,ae)}),new Float32Array(ae.buffer)}function ec(p,c,a,l,y,S,U,G){var ae=p,le=new Float32Array(function(be,Se){var Ie=mi(S,U);return Ie[0]*Ie[1]*4}());return ae.bindBuffer(ae.PIXEL_PACK_BUFFER,c),ae.getBufferSubData(ae.PIXEL_PACK_BUFFER,0,le),ae.bindBuffer(ae.PIXEL_PACK_BUFFER,null),le}function il(p,c,a,l){var y=new Float32Array(a*l*4);return qn(p,c,function(){return p.readPixels(0,0,l,a,p.RGBA,p.FLOAT,y)}),y}var zl=Object.freeze({createVertexShader:u0,createVertexBuffer:Xp,createIndexBuffer:sa,createFloat32MatrixTexture:Yp,createFloat16MatrixTexture:ip,createUnsignedBytesMatrixTexture:Tg,createPackedMatrixTexture:c0,createFloat16PackedMatrixTexture:Nf,bindVertexProgramAttributeStreams:Zu,uploadDenseMatrixToTexture:Jp,uploadPixelDataToTexture:op,createBufferFromOutputTexture:Qp,downloadFloat32MatrixFromBuffer:l0,downloadByteEncodedFloatMatrixFromOutputTexture:Lm,downloadPackedMatrixFromBuffer:ec,downloadMatrixFromPackedOutputTexture:il}),zm=function(){function p(c){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var a=W().getNumber("WEBGL_VERSION");c!=null?(this.gl=c,Do(a,c)):this.gl=Bi(a);var l="WEBGL_color_buffer_float";if(W().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=Oo(this.gl,this.debug,"OES_texture_float"),na(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Oo(this.gl,this.debug,"OES_texture_half_float");else if(W().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(l),na(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Oo(this.gl,this.debug,"EXT_color_buffer_half_float");else if(W().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(l="EXT_color_buffer_float",na(this.gl,l))this.colorBufferFloatExtension=this.gl.getExtension(l);else{if(!na(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Xp(this.gl,this.debug),this.indexBuffer=sa(this.gl,this.debug),this.framebuffer=Hs(this.gl,this.debug),this.textureConfig=ai(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(p.prototype,"debug",{get:function(){return W().getBool("DEBUG")},enumerable:!0,configurable:!0}),p.prototype.dispose=function(){var c=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var a=this.gl;qn(a,this.debug,function(){return a.finish()}),qn(a,this.debug,function(){return a.bindFramebuffer(a.FRAMEBUFFER,null)}),qn(a,this.debug,function(){return a.deleteFramebuffer(c.framebuffer)}),qn(a,this.debug,function(){return a.bindBuffer(a.ARRAY_BUFFER,null)}),qn(a,this.debug,function(){return a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null)}),qn(a,this.debug,function(){return a.deleteBuffer(c.indexBuffer)}),this.disposed=!0}},p.prototype.createFloat32MatrixTexture=function(c,a){return this.throwIfDisposed(),Yp(this.gl,this.debug,c,a,this.textureConfig)},p.prototype.createFloat16MatrixTexture=function(c,a){return this.throwIfDisposed(),ip(this.gl,this.debug,c,a,this.textureConfig)},p.prototype.createUnsignedBytesMatrixTexture=function(c,a){return this.throwIfDisposed(),Tg(this.gl,this.debug,c,a,this.textureConfig)},p.prototype.uploadPixelDataToTexture=function(c,a){this.throwIfDisposed(),op(this.gl,this.debug,c,a)},p.prototype.uploadDenseMatrixToTexture=function(c,a,l,y){this.throwIfDisposed(),Jp(this.gl,this.debug,c,a,l,y,this.textureConfig)},p.prototype.createFloat16PackedMatrixTexture=function(c,a){return this.throwIfDisposed(),Nf(this.gl,this.debug,c,a,this.textureConfig)},p.prototype.createPackedMatrixTexture=function(c,a){return this.throwIfDisposed(),c0(this.gl,this.debug,c,a,this.textureConfig)},p.prototype.deleteMatrixTexture=function(c){var a=this;this.throwIfDisposed(),this.outputTexture===c&&(Gc(this.gl,this.debug,this.framebuffer),this.outputTexture=null),qn(this.gl,this.debug,function(){return a.gl.deleteTexture(c)})},p.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(c,a,l){var y=this;return this.downloadMatrixDriver(c,function(){return Lm(y.gl,y.debug,a,l,y.textureConfig)})},p.prototype.downloadPackedMatrixFromBuffer=function(c,a,l,y,S,U){return ec(this.gl,c,0,0,0,S,U,this.textureConfig)},p.prototype.downloadFloat32MatrixFromBuffer=function(c,a){return l0(this.gl,c,a)},p.prototype.createBufferFromTexture=function(c,a,l){this.bindTextureToFrameBuffer(c);var y=Qp(this.gl,this.debug,a,l,this.textureConfig);return this.unbindTextureToFrameBuffer(),y},p.prototype.createAndWaitForFence=function(){var c=this.createFence(this.gl);return this.pollFence(c)},p.prototype.createFence=function(c){var a,l,y=this;if(W().getBool("WEBGL_FENCE_API_ENABLED")){var S=c,U=S.fenceSync(S.SYNC_GPU_COMMANDS_COMPLETE,0);c.flush(),l=function(){var G=S.clientWaitSync(U,0,0);return G===S.ALREADY_SIGNALED||G===S.CONDITION_SATISFIED},a=U}else W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(a=this.beginQuery(),this.endQuery(),l=function(){return y.isQueryAvailable(a,W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):l=function(){return!0};return{query:a,isFencePassed:l}},p.prototype.downloadMatrixFromPackedTexture=function(c,a,l){var y=this;return this.downloadMatrixDriver(c,function(){return il(y.gl,y.debug,a,l)})},p.prototype.createProgram=function(c){this.throwIfDisposed();var a=this.gl,l=To(a,this.debug,c),y=u0(a,this.debug),S=eo(a,this.debug);return qn(a,this.debug,function(){return a.attachShader(S,y)}),qn(a,this.debug,function(){return a.attachShader(S,l)}),bu(a,this.debug,S),this.debug&&wc(a,this.debug,S),this.vertexAttrsAreBound||(this.setProgram(S),this.vertexAttrsAreBound=Zu(a,this.debug,this.program,this.vertexBuffer)),S},p.prototype.deleteProgram=function(c){var a=this;this.throwIfDisposed(),c===this.program&&(this.program=null),c!=null&&qn(this.gl,this.debug,function(){return a.gl.deleteProgram(c)})},p.prototype.setProgram=function(c){var a=this;this.throwIfDisposed(),this.program=c,this.program!=null&&this.debug&&wc(this.gl,this.debug,this.program),qn(this.gl,this.debug,function(){return a.gl.useProgram(c)})},p.prototype.getUniformLocation=function(c,a,l){return l===void 0&&(l=!0),this.throwIfDisposed(),l?Gs(this.gl,this.debug,c,a):Zl(this.gl,c,a)},p.prototype.getAttributeLocation=function(c,a){var l=this;return this.throwIfDisposed(),qn(this.gl,this.debug,function(){return l.gl.getAttribLocation(c,a)})},p.prototype.getUniformLocationNoThrow=function(c,a){return this.throwIfDisposed(),this.gl.getUniformLocation(c,a)},p.prototype.setInputMatrixTexture=function(c,a,l){this.throwIfDisposed(),this.throwIfNoProgram(),pl(this.gl,this.debug,this.program,c,a,l)},p.prototype.setOutputMatrixTexture=function(c,a,l){this.setOutputMatrixTextureDriver(c,l,a)},p.prototype.setOutputPackedMatrixTexture=function(c,a,l){this.throwIfDisposed();var y=mi(a,l),S=y[0],U=y[1];this.setOutputMatrixTextureDriver(c,S,U)},p.prototype.setOutputMatrixWriteRegion=function(c,a,l,y){this.setOutputMatrixWriteRegionDriver(l,c,y,a)},p.prototype.setOutputPackedMatrixWriteRegion=function(c,a,l,y){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},p.prototype.debugValidate=function(){this.program!=null&&wc(this.gl,this.debug,this.program),ha(this.gl)},p.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var c=this.gl;this.debug&&this.debugValidate(),qn(c,this.debug,function(){return c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0)})},p.prototype.blockUntilAllProgramsCompleted=function(){var c=this;this.throwIfDisposed(),qn(this.gl,this.debug,function(){return c.gl.finish()})},p.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Oo(this.gl,this.debug,W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},p.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},p.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},p.prototype.beginQuery=function(){if(W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var c=this.gl,a=this.getQueryTimerExtensionWebGL2(),l=c.createQuery();return c.beginQuery(a.TIME_ELAPSED_EXT,l),l}var y=this.getQueryTimerExtensionWebGL1(),S=y.createQueryEXT();return y.beginQueryEXT(y.TIME_ELAPSED_EXT,S),S},p.prototype.endQuery=function(){if(W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var c=this.getQueryTimerExtensionWebGL1();c.endQueryEXT(c.TIME_ELAPSED_EXT)}else{var a=this.gl,l=this.getQueryTimerExtensionWebGL2();a.endQuery(l.TIME_ELAPSED_EXT)}},p.prototype.waitForQueryAndGetTime=function(c){return M(this,void 0,void 0,function(){var a=this;return V(this,function(l){switch(l.label){case 0:return[4,Pt(function(){return a.disposed||a.isQueryAvailable(c,W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return l.sent(),[2,this.getQueryTime(c,W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},p.prototype.getQueryTime=function(c,a){if(a===0)return null;if(a===2){var l=this.gl;return l.getQueryParameter(c,l.QUERY_RESULT)/1e6}var y=this.getQueryTimerExtensionWebGL1();return y.getQueryObjectEXT(c,y.QUERY_RESULT_EXT)/1e6},p.prototype.isQueryAvailable=function(c,a){if(a===0)return!0;if(a===2){var l=this.gl,y=this.getQueryTimerExtensionWebGL2(),S=l.getQueryParameter(c,l.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(y.GPU_DISJOINT_EXT)),S&&!this.disjoint}return S=(y=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(c,y.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(y.GPU_DISJOINT_EXT)),S&&!this.disjoint},p.prototype.pollFence=function(c){var a=this;return new Promise(function(l){a.addItemToPoll(function(){return c.isFencePassed()},function(){return l()})})},p.prototype.pollItems=function(){for(var c=function(l){for(var y=0;y<l.length&&l[y]();++y);return y-1}(this.itemsToPoll.map(function(l){return l.isDoneFn})),a=0;a<=c;++a)(0,this.itemsToPoll[a].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(c+1)},p.prototype.addItemToPoll=function(c,a){var l=this;this.itemsToPoll.push({isDoneFn:c,resolveFn:a}),this.itemsToPoll.length>1||Pt(function(){return l.pollItems(),l.itemsToPoll.length===0})},p.prototype.bindTextureToFrameBuffer=function(c){this.throwIfDisposed(),ml(this.gl,this.debug,c,this.framebuffer),this.debug&&ha(this.gl)},p.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(ml(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&ha(this.gl)):Gc(this.gl,this.debug,this.framebuffer)},p.prototype.downloadMatrixDriver=function(c,a){this.bindTextureToFrameBuffer(c);var l=a();return this.unbindTextureToFrameBuffer(),l},p.prototype.setOutputMatrixTextureDriver=function(c,a,l){this.throwIfDisposed();var y=this.gl;ml(y,this.debug,c,this.framebuffer),this.debug&&ha(y),this.outputTexture=c,qn(y,this.debug,function(){return y.viewport(0,0,a,l)}),qn(y,this.debug,function(){return y.scissor(0,0,a,l)})},p.prototype.setOutputMatrixWriteRegionDriver=function(c,a,l,y){var S=this;this.throwIfDisposed(),qn(this.gl,this.debug,function(){return S.gl.scissor(c,a,l,y)})},p.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},p.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},p}();function ap(p,c){if(p.length!==c.length)throw Error("Binary was compiled with "+p.length+" inputs, but was executed with "+c.length+" inputs");p.forEach(function(a,l){var y=a.logicalShape,S=c[l],U=S.shape;if(!fn(y,U))throw Error("Binary was compiled with different shapes than the current args. Shapes "+y+" and "+U+" must match");if(!a.isUniform||!S.isUniform){var G=a.texShape,ae=S.isUniform?null:S.texData.texShape;if(!fn(G,ae))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+G+" and "+ae+" must match")}})}var ol=function(p,c,a,l,y,S,U){a===void 0&&(a=!1),l===void 0&&(l=!1),y===void 0&&(y=!1),S===void 0&&(S=null),U===void 0&&(U=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=c;var G=a?p[1]:p[2],ae=Math.ceil(G/2),le=a?"i * 2, rc.y":"rc.y, i * 2",be=l?"rc.z, i * 2":"i * 2, rc.z",Se=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],Ie=l?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],Me="",qe="";S&&(Me=U?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+S+`
        }`:`vec4 activation(vec4 x) {
          `+S+`
        }`,qe="result = activation(result);");var Ye=y?"result += getBiasAtOutCoords();":"";y&&this.variableNames.push("bias"),U&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+Me+`

      const float sharedDimension = `+ae+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+ae+`; i++) {
          vec4 a = getMatrixA(rc.x, `+le+`);
          vec4 b = getMatrixB(rc.x, `+be+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+Se[0]+" * "+Ie[0]+`);
          result += (`+Se[1]+" * "+Ie[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+Ye+`

        `+qe+`

        setOutput(result);
      }
    `},Zp=function(){function p(c,a,l){this.variableNames=["probs"],this.outputShape=[c,l],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(a-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(a-1)+`));
      }
    `}return p.prototype.getCustomSetupFunc=function(c){var a=this;return function(l,y){a.seedLoc==null&&(a.seedLoc=l.getUniformLocation(y,"seed")),l.gl.uniform1f(a.seedLoc,c)}},p}(),Od=function(p,c,a,l,y){if(l===void 0&&(l=!1),y===void 0&&(y=!1),this.variableNames=["x"],c==="avg"&&a)throw new Error("Cannot compute positions for average pool.");var S=p.filterWidth,U=p.strideHeight,G=p.strideWidth,ae=p.dilationHeight,le=p.dilationWidth,be=p.effectiveFilterHeight,Se=p.effectiveFilterWidth,Ie=p.padInfo.top,Me=p.padInfo.left;this.outputShape=p.outShape;var qe=c==="avg",Ye="((batch  * "+p.inHeight+" + xR) * "+p.inWidth+" + xC) * "+p.inChannels+" + d",Xe="(xR * "+p.inWidth+" + xC) * "+p.inChannels+" + d",at="0.0";if(qe||(at="-1.0 / 1e-20"),a)this.userCode=`
        const ivec2 strides = ivec2(`+U+", "+G+`);
        const ivec2 pads = ivec2(`+Ie+", "+Me+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+be+`;
              wR += `+ae+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+p.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+Se+`;
                wC += `+le+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+p.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = `+(l?y?Ye:Xe:"wR * "+Se+" + wC")+`;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var gt=c+"("+c+"("+c+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";c==="avg"&&(gt="avgValue / count");var bt=4*Math.floor(S/4),_t=S%4,jt=`
      if (`+qe+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+U+", "+G+`);
      const ivec2 pads = ivec2(`+Ie+", "+Me+`);
      const float initializationValue = `+at+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+p.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+at+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+be+`;
            wR += `+ae+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+p.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+bt+`; wC += 4) {
            int xC = xCCorner + wC * `+le+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+le+`, d),
              getValue(batch, xR, xC + 2 * `+le+`, d),
              getValue(batch, xR, xC + 3 * `+le+`, d)
            );

            `+jt+`
          }

          int xC = xCCorner + `+bt+`;
          if (`+(_t===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+jt+`
          } else if (`+(_t===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+le+`, d),
              initializationValue,
              initializationValue
            );

            `+jt+`
          } else if (`+(_t===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+le+`, d),
              getValue(batch, xR, xC + 2 * `+le+`, d),
              initializationValue
            );

            `+jt+`
          }
        }
        setOutput(`+gt+`);
      }
    `}},Sd=function(p,c,a,l,y){if(l===void 0&&(l=!1),y===void 0&&(y=!1),this.variableNames=["x"],c==="avg"&&a)throw new Error("Cannot compute positions for average pool.");var S=p.filterWidth,U=p.strideDepth,G=p.strideHeight,ae=p.strideWidth,le=p.dilationDepth,be=p.dilationHeight,Se=p.dilationWidth,Ie=p.effectiveFilterDepth,Me=p.effectiveFilterHeight,qe=p.effectiveFilterWidth,Ye=p.padInfo.front,Xe=p.padInfo.top,at=p.padInfo.left;this.outputShape=p.outShape;var gt=c==="avg",bt="0.0";if(gt||(bt="-1.0 / 1e-20"),a)this.userCode=`
        const ivec3 strides =
            ivec3(`+U+", "+G+", "+ae+`);
        const ivec3 pads = ivec3(`+Ye+", "+Xe+", "+at+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+Ie+`;
              wD += `+le+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+p.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+Me+`;
                wR += `+be+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+p.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+qe+`;
                  wC += `+Se+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+p.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = `+(l?y?"(((batch * "+p.inDepth+" + xD) * "+p.inHeight+" + xR) * "+p.inWidth+" + xC) * "+p.inChannels+" + ch":"((xD * "+p.inHeight+" + xR) * "+p.inWidth+" + xC) * "+p.inChannels+" + ch":"wD * "+Me+" * "+qe+` +
                      wR * `+qe+" + wC")+`;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var _t=c+"("+c+"("+c+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";c==="avg"&&(_t="avgValue / count");var jt=4*Math.floor(S/4),Qt=S%4,sn=`
      if (`+gt+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+U+", "+G+", "+ae+`);
      const ivec3 pads = ivec3(`+Ye+", "+Xe+", "+at+`);
      const float initializationValue = `+bt+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+p.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+bt+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+Ie+`;
            wD += `+le+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+p.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+Me+`;
            wR += `+be+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+p.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+jt+`; wC += 4) {
              int xC = xCCorner + wC * `+Se+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+Se+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+Se+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+Se+`, ch)
              );

              `+sn+`
            }

            int xC = xCCorner + `+jt+`;
            if (`+(Qt===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+sn+`
            } else if (`+(Qt===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+Se+`, ch),
                initializationValue,
                initializationValue
              );

              `+sn+`
            } else if (`+(Qt===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+Se+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+Se+`, ch),
                initializationValue
              );

              `+sn+`
            }
          }
          setOutput(`+_t+`);
        }
      }
    `}},Ng=function(p,c,a,l,y,S,U){this.variableNames=["updates","indices","defaultValue"],this.outputShape=S;var G=Da(y.length),ae=Da(S.length),le="";a===1?le="i":a===2&&(le="i, j");var be="getIndices("+le+")",Se="";l===1?Se="i":l===2&&(Se="i, coords[1]");var Ie="getUpdates("+Se+")",Me=c>1?"strides[j]":"strides";this.userCode=`
        `+G+" strides = "+G+"("+y+`);

        void main() {
          `+ae+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+p+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+c+`; j++) {
              int index = round(`+be+`);
              flattenedIndex += index * `+Me+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+Ie+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},Ul=function(){function p(c){this.variableNames=["source"],this.outputShape=c,this.rank=c.length;var a,l=Da(this.rank),y="uniform int start["+this.rank+"];",S=function(U){if(U===1)return"sourceLoc";if(U<=6)return If.slice(0,U).map(function(G){return"sourceLoc."+G}).join(",");throw Error("Slicing for rank "+U+" is not yet supported")}(this.rank);a=`
        `+l+` sourceLoc;
        `+l+` coords = getOutputCoords();
        `+c.map(function(U,G){return"sourceLoc."+If[G]+" = start["+G+"] + coords."+If[G]+";"}).join(`
`)+`
      `,this.userCode=`
      `+y+`
      void main() {
        `+a+`
        setOutput(getSource(`+S+`));
      }
    `}return p.prototype.getCustomSetupFunc=function(c){var a=this;if(c.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+c.length+")");return function(l,y){a.startLoc==null&&(a.startLoc=l.getUniformLocationNoThrow(y,"start"),a.startLoc==null)||l.gl.uniform1iv(a.startLoc,c)}},p}(),If=["x","y","z","w","u","v"],Wl=function(){function p(c){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=c,this.rank=c.length;var a=Da(this.rank),l=Cs("coords",this.rank),y=Cs("sourceLoc",this.rank),S=this.rank===1?"sourceLoc":"vec2("+y.slice(-2).join()+")",U="getChannel(getSource("+y.join()+"), "+S+")",G=`
      result.x = `+U+`;
      if (++`+l[this.rank-1]+" < "+c[this.rank-1]+`) {
        ++`+y[this.rank-1]+`;
        result.y = `+U+`;
        --`+y[this.rank-1]+`;
      }
    `,ae=this.rank===1?"":`
      --`+l[this.rank-1]+`;
      if (++`+l[this.rank-2]+" < "+c[this.rank-2]+`) {
        ++`+y[this.rank-2]+`;
        result.z = `+U+`;
        if (++`+l[this.rank-1]+" < "+c[this.rank-1]+`) {
          ++`+y[this.rank-1]+`;
          result.w = `+U+`;
        }
      }
    `,le=this.rank<=4?`sourceLoc = coords +
            `+a+"("+c.map(function(be,Se){return"start["+Se+"]"}).join()+");":c.map(function(be,Se){return y[Se]+" = "+l[Se]+" + start["+Se+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+a+` coords = getOutputCoords();
        `+a+` sourceLoc;
        `+le+`
        vec4 result = vec4(0.);
        `+G+`
        `+ae+`
        setOutput(result);
      }
    `}return p.prototype.getCustomSetupFunc=function(c){var a=this;if(c.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+c.length+")");return function(l,y){a.startLoc==null&&(a.startLoc=l.getUniformLocationNoThrow(y,"start"),a.startLoc==null)||l.gl.uniform1iv(a.startLoc,c)}},p}(),Ig=function(){function p(c){this.gpgpu=c,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return p.prototype.acquireTexture=function(c,a,l){var y,S=Fg(a,l),U=em(c,S,l);if(U in this.freeTextures||(this.freeTextures[U]=[]),U in this.usedTextures||(this.usedTextures[U]=[]),this.freeTextures[U].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var G=this.freeTextures[U].shift();return this.usedTextures[U].push(G),G}return this.numUsedTextures++,this.log(),S===ui.PACKED_2X2_FLOAT32?y=this.gpgpu.createPackedMatrixTexture(c[0],c[1]):S===ui.PACKED_2X2_FLOAT16?y=this.gpgpu.createFloat16PackedMatrixTexture(c[0],c[1]):S===ui.UNPACKED_FLOAT32?y=this.gpgpu.createFloat32MatrixTexture(c[0],c[1]):S===ui.UNPACKED_FLOAT16?y=this.gpgpu.createFloat16MatrixTexture(c[0],c[1]):S===ui.PACKED_4X1_UNSIGNED_BYTE&&(y=this.gpgpu.createUnsignedBytesMatrixTexture(c[0],c[1])),this.usedTextures[U].push(y),y},p.prototype.releaseTexture=function(c,a,l,y){if(this.freeTextures!=null){var S=em(a,Fg(l,y),y);S in this.freeTextures||(this.freeTextures[S]=[]),this.freeTextures[S].push(c),this.numFreeTextures++,this.numUsedTextures--;var U=this.usedTextures[S],G=U.indexOf(c);if(G<0)throw new Error("Cannot release a texture that was never provided by this texture manager");U.splice(G,1),this.log()}},p.prototype.log=function(){if(this.logEnabled){var c=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+c+")")}},p.prototype.getNumUsedTextures=function(){return this.numUsedTextures},p.prototype.getNumFreeTextures=function(){return this.numFreeTextures},p.prototype.dispose=function(){var c=this;if(this.freeTextures!=null){for(var a in this.freeTextures)this.freeTextures[a].forEach(function(l){c.gpgpu.deleteMatrixTexture(l)});for(var a in this.usedTextures)this.usedTextures[a].forEach(function(y){c.gpgpu.deleteMatrixTexture(y)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},p}();function Fg(p,c){if(p===kr.UPLOAD)return ui.PACKED_2X2_FLOAT32;if(p===kr.RENDER||p==null)return function(a){return W().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?a?ui.PACKED_2X2_FLOAT32:ui.UNPACKED_FLOAT32:a?ui.PACKED_2X2_FLOAT16:ui.UNPACKED_FLOAT16}(c);if(p===kr.DOWNLOAD||p===kr.PIXELS)return ui.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+p)}function em(p,c,a){return p[0]+"_"+p[1]+"_"+c+"_"+a}var yv=1.7580993408473768,bv=1.0507009873554805,ra=function(p,c){this.variableNames=["A"],this.outputShape=p,this.userCode=`
      float unaryOperation(float x) {
        `+c+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},Rg="if (isnan(x)) return x;",Mg="return x;",Um="return abs(x);",jg=Rg+`
  return (x < 0.0) ? 0.0 : x;
`,sp=Rg+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,ou="return (x >= 0.0) ? x : (exp(x) - 1.0);",tc="return -x;",f0="return ceil(x);",h0="return floor(x);",ch="return exp(x);",Vl="return exp(x) - 1.0;",Dd="return x;",H0="return x;",Wm=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Ff=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,nc=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,ql=function(p,c){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=p,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+c+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},Hh={};function lh(p,c){if(c===void 0&&(c=!1),p==="linear")return c?H0:Mg;if(p==="relu")return c?Wm:jg;if(p==="elu")return c?nc:ou;if(p==="relu6")return c?Ff:sp;if(p==="prelu")return c?hu:Ll;throw new Error("Activation "+p+" has not been implemented for the WebGL backend.")}var Bg=600,Td=function(p){function c(a){var l,y=p.call(this)||this;if(y.pendingRead=new WeakMap,y.pendingDisposal=new WeakSet,y.dataRefCount=new WeakMap,y.numBytesInGPU=0,y.uploadWaitMs=0,y.downloadWaitMs=0,y.warnedAboutMemory=!1,y.pendingDeletes=0,y.disposed=!1,!W().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(a==null){var S=Bi(W().getNumber("WEBGL_VERSION"));y.binaryCache=((l=W().getNumber("WEBGL_VERSION"))in Hh||(Hh[l]={}),Hh[l]),y.gpgpu=new zm(S),y.canvas=S.canvas,y.gpgpuCreatedLocally=!0}else y.gpgpu=a,y.binaryCache={},y.gpgpuCreatedLocally=!1,y.canvas=a.gl.canvas;return y.textureManager=new Ig(y.gpgpu),y.numMBBeforeWarning=W().global.screen==null?1024:W().global.screen.height*W().global.screen.width*window.devicePixelRatio*Bg/1024/1024,y.texData=new qt(y,He),y}return K(c,p),c.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},c.prototype.write=function(a,l,y){if(W().getBool("DEBUG")&&this.checkNumericalProblems(a),y==="complex64"&&a!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var S={};return this.texData.set(S,{shape:l,dtype:y,values:a,usage:kr.UPLOAD}),S},c.prototype.move=function(a,l,y,S){if(W().getBool("DEBUG")&&this.checkNumericalProblems(l),S==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(a,{shape:y,dtype:S,values:l,usage:kr.UPLOAD})},c.prototype.readSync=function(a){var l=this.texData.get(a),y=l.values,S=l.dtype,U=l.complexTensors,G=l.slice,ae=l.shape,le=l.isPacked;if(G!=null){var be;be=le?new ql(ae,Dd):new ra(ae,Dd);var Se=this.runWebGLProgram(be,[{dataId:a,shape:ae,dtype:S}],S),Ie=this.readSync(Se.dataId);return this.disposeData(Se.dataId),Ie}if(y!=null)return this.convertAndCacheOnCPU(a);if(S==="string")return y;var Me,qe,Ye=this.activeTimers!=null;return Ye&&(Me=an()),qe=S==="complex64"?Oi(U.real.dataSync(),U.imag.dataSync()):this.getValuesFromTexture(a),Ye&&(this.downloadWaitMs+=an()-Me),this.convertAndCacheOnCPU(a,qe)},c.prototype.read=function(a){return M(this,void 0,void 0,function(){var l,y,S,U,G,ae,le,be,Se,Ie,Me,qe,Ye,Xe,at,gt,bt,_t,jt,Qt,sn,Zt;return V(this,function(rn){switch(rn.label){case 0:if(this.pendingRead.has(a))return l=this.pendingRead.get(a),[2,new Promise(function(Sn){return l.push(Sn)})];if(y=this.texData.get(a),S=y.values,U=y.shape,G=y.slice,ae=y.dtype,le=y.complexTensors,be=y.isPacked,G!=null)return Se=void 0,Se=be?new ql(U,Dd):new ra(U,Dd),Ie=this.runWebGLProgram(Se,[{dataId:a,shape:U,dtype:ae}],ae),Me=this.read(Ie.dataId),this.disposeData(Ie.dataId),[2,Me];if(S!=null)return[2,this.convertAndCacheOnCPU(a)];if(!W().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&W().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return qe=null,ae!=="complex64"&&W().get("WEBGL_BUFFER_SUPPORTED")&&(Ye=this.decode(a),Xe=this.texData.get(Ye.dataId),qe=(Zt=this.gpgpu).createBufferFromTexture.apply(Zt,[Xe.texture].concat($i(U)))),this.pendingRead.set(a,[]),ae==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:rn.sent(),rn.label=2;case 2:return ae!=="complex64"?[3,4]:[4,Promise.all([le.real.data(),le.imag.data()])];case 3:return gt=rn.sent(),bt=gt[0],_t=gt[1],at=Oi(bt,_t),[3,5];case 4:qe==null?at=this.getValuesFromTexture(a):(jt=Qe(U),at=this.gpgpu.downloadFloat32MatrixFromBuffer(qe,jt)),rn.label=5;case 5:return Ye!=null&&this.disposeData(Ye.dataId),Qt=this.convertAndCacheOnCPU(a,at),sn=this.pendingRead.get(a),this.pendingRead.delete(a),sn.forEach(function(Sn){return Sn(Qt)}),this.pendingDisposal.has(a)&&(this.pendingDisposal.delete(a),this.disposeData(a),this.pendingDeletes--),[2,Qt]}})})},c.prototype.checkNumericalProblems=function(a){if(a!=null)for(var l=0;l<a.length;l++){var y=a[l];if(!Zr(y))throw W().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+y+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+y+" cannot be represented on this device.")}},c.prototype.getValuesFromTexture=function(a){var l,y=this.texData.get(a),S=y.shape,U=y.dtype,G=y.isPacked,ae=Qe(S);if(W().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var le=this.decode(a),be=this.texData.get(le.dataId),Se=(l=this.gpgpu).downloadMatrixFromPackedTexture.apply(l,[be.texture].concat($i(S))).subarray(0,ae);return this.disposeData(le.dataId),Se}var Ie=W().getBool("WEBGL_PACK")&&G===!0,Me=Ie?jc(S):S,qe=Ie?new function(gt){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=kr.DOWNLOAD;var bt=fa();this.outputShape=gt,this.userCode=`
      `+Js+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+bt.output+` = encode_float(x);
      }
    `}(Me):new function(gt){this.variableNames=["A"],this.outTexUsage=kr.DOWNLOAD;var bt=fa();this.outputShape=gt,this.userCode=`
      `+Js+`

      void main() {
        float x = getAAtOutCoords();
        `+bt.output+` = encode_float(x);
      }
    `}(Me),Ye=this.runWebGLProgram(qe,[{shape:Me,dtype:U,dataId:a}],"float32"),Xe=this.texData.get(Ye.dataId),at=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(Xe.texture,Xe.texShape[0],Xe.texShape[1]).subarray(0,ae);return this.disposeData(Ye.dataId),at},c.prototype.time=function(a){return M(this,void 0,void 0,function(){var l,y,S,U,G,ae,le;return V(this,function(be){switch(be.label){case 0:return l=this.activeTimers,y=[],S=!1,this.programTimersStack==null?(this.programTimersStack=y,S=!0):this.activeTimers.push(y),this.activeTimers=y,a(),U=Ut(this.activeTimers.map(function(Se){return Se.query})).filter(function(Se){return Se!=null}),G=Ut(this.activeTimers.map(function(Se){return Se.name})).filter(function(Se){return Se!=null}),this.activeTimers=l,S&&(this.programTimersStack=null),ae={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(U)]:[3,2];case 1:return le=be.sent(),ae.kernelMs=tn(le),ae.getExtraProfileInfo=function(){return le.map(function(Se,Ie){return{name:G[Ie],ms:Se}}).map(function(Se){return Se.name+": "+Se.ms}).join(", ")},[3,3];case 2:ae.kernelMs={error:"WebGL query timers are not supported in this environment."},be.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,ae]}})})},c.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},c.prototype.startTimer=function(){return W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:an(),endMs:null}},c.prototype.endTimer=function(a){return W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),a):(a.endMs=an(),a)},c.prototype.getQueryTime=function(a){return M(this,void 0,void 0,function(){var l;return V(this,function(y){return W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(a)]:[2,(l=a).endMs-l.startMs]})})},c.prototype.disposeData=function(a){if(!this.pendingDisposal.has(a)){if(this.pendingRead.has(a))return this.pendingDisposal.add(a),void this.pendingDeletes++;if(this.texData.has(a)){this.releaseGPUData(a);var l=this.texData.get(a).complexTensors;l!=null&&(l.real.dispose(),l.imag.dispose()),this.texData.delete(a)}}},c.prototype.releaseGPUData=function(a){var l=this.texData.get(a),y=l.texture,S=l.dtype,U=l.texShape,G=l.usage,ae=l.isPacked,le=l.slice,be=le&&le.origDataId||a,Se=this.dataRefCount.get(be);Se>1?this.dataRefCount.set(be,Se-1):(this.dataRefCount.delete(be),y!=null&&(this.numBytesInGPU-=this.computeBytes(U,S),this.textureManager.releaseTexture(y,U,G,ae)));var Ie=this.texData.get(a);Ie.texture=null,Ie.texShape=null,Ie.isPacked=!1,Ie.slice=null},c.prototype.getTexture=function(a){return this.uploadToGPU(a),this.texData.get(a).texture},c.prototype.getDataInfo=function(a){return this.texData.get(a)},c.prototype.getCPUBackend=function(){return W().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=He.findBackend("cpu")),this.cpuBackend):null},c.prototype.shouldExecuteOnCPU=function(a,l){var y=this;return l===void 0&&(l=128),this.getCPUBackend()!=null&&a.every(function(S){return y.texData.get(S.dataId).texture==null&&Qe(S.shape)<l})},c.prototype.getGPGPUContext=function(){return this.gpgpu},c.prototype.complex=function(a,l){var y=this.makeOutput(a.shape,"complex64");return this.texData.get(y.dataId).complexTensors={real:He.keep(a.clone()),imag:He.keep(l.clone())},y},c.prototype.real=function(a){return this.texData.get(a.dataId).complexTensors.real.clone()},c.prototype.imag=function(a){return this.texData.get(a.dataId).complexTensors.imag.clone()},c.prototype.slice=function(a,l,y){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.slice(a,l,y);if(Qe(y)===0)return la([],y,a.dtype);var S=this.texData.get(a.dataId).isPacked,U=np(a.shape,l,y);if(S||!U){var G=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Wl(y):new Ul(y),ae=G.getCustomSetupFunc(l);return this.compileAndRun(G,[a],null,ae)}return this.uploadToGPU(a.dataId),this.shallowSlice(a,l,y)},c.prototype.shallowSlice=function(a,l,y){var S=this.texData.get(a.dataId),U=this.makeOutput(y,a.dtype),G=this.texData.get(U.dataId);Object.assign(G,S),G.shape=y,G.dtype=a.dtype;var ae=_d(l,a.strides);S.slice&&(ae+=S.slice.flatOffset),G.slice={flatOffset:ae,origDataId:S.slice&&S.slice.origDataId||a.dataId};var le=this.dataRefCount.get(G.slice.origDataId)||1;return this.dataRefCount.set(G.slice.origDataId,le+1),U},c.prototype.stridedSlice=function(a,l,y,S){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.stridedSlice(a,l,y,S);var U=wl(l,y,S);if(U.some(function(ae){return ae===0}))return la([],U);var G=new function(ae,le,be){this.variableNames=["x"],this.outputShape=be;var Se=be.length,Ie=Da(be.length),Me=Da(be.length),qe="";if(Se===1)qe="coords * strides + begin";else{var Ye=0;qe=be.map(function(Xe,at){return Ye++,be.length===1?"coords * strides["+at+"] + begin["+at+"]":"coords["+(Ye-1)+"] * strides["+at+"] + begin["+at+"]"}).join(",")}this.userCode=`
      `+Ie+" begin = "+Ie+"("+ae+`);
      `+Ie+" strides = "+Ie+"("+le+`);

      void main() {
        `+Me+` coords = getOutputCoords();
        setOutput(getX(`+qe+`));
      }
    `}(l,S,U);return this.compileAndRun(G,[a])},c.prototype.reverse=function(a,l){var y=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(S,U){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var G=S.length;if(G>4)throw new Error("WebGL backend: Reverse of rank-"+G+" tensor is not yet supported");this.outputShape=S;var ae=Cs("rc",G),le=ae[G-1]+" + 1 < "+this.outputShape[G-1],be=ae[G-2]+" + 1 < "+this.outputShape[G-2],Se=Da(G);function Ie(Me){var qe=S.map(function(Ye,Xe){return function(at,gt){return U.indexOf(at)!==-1&&S[at]!==1?S[at]+" - "+gt[at]+" - 1":""+gt[at]}(Xe,Me)});return"getChannel(getX("+qe.join(",")+"), vec2("+qe.slice(-2).join(",")+"))"}this.userCode=G===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+S[0]+` - rc - 1),
            `+S[0]+` - rc - 1);
          if(`+le+`){
              result.g = getChannel(getX(`+S[0]+` - (rc  + 1) - 1),
                `+S[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+Se+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+Ie(ae.slice())+`;
          if(`+le+`){
            result.g = `+function(Me){return Me[G-1]="("+Me[G-1]+" + 1)",Ie(Me)}(ae.slice())+`;
          }
          if(`+be+`) {
            result.b = `+function(Me){return Me[G-2]="("+Me[G-2]+" + 1)",Ie(Me)}(ae.slice())+`;
            if(`+le+`) {
              result.a = `+function(Me){return Me[G-1]="("+Me[G-1]+" + 1)",Me[G-2]="("+Me[G-2]+" + 1)",Ie(Me)}(ae.slice())+`;
            }
          }
          setOutput(result);
        }
    `}(a.shape,l):new function(S,U){this.variableNames=["x"];var G=S.length;if(G>4)throw new Error("WebGL backend: Reverse of rank-"+G+" tensor is not yet supported");if(this.outputShape=S,G!==1){var ae=S.map(function(be,Se){return function(Ie){return U.indexOf(Ie)!==-1&&S[Ie]!==1?S[Ie]+" - coords["+Ie+"] - 1":"coords["+Ie+"]"}(Se)}).join(","),le=Da(G);this.userCode=`
      void main() {
        `+le+` coords = getOutputCoords();
        setOutput(getX(`+ae+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+S[0]+` - coord - 1));
        }
      `}(a.shape,l);return this.compileAndRun(y,[a])},c.prototype.concat=function(a,l){if(a[0].dtype==="complex64"){var y=a.map(function(Me){return ms(Me)}),S=a.map(function(Me){return Ks(Me)});return aa(this.concat(y,l),this.concat(S,l))}if(this.shouldExecuteOnCPU(a))return this.cpuBackend.concat(a,l);if(a.length===1)return a[0];if(a.length>W().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var U=Math.floor(a.length/2),G=this.concat(a.slice(0,U),l),ae=this.concat(a.slice(U),l);return this.concat([G,ae],l)}if(W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&a[0].rank>1){var le=new function(Me,qe){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Ku(Me,qe);var Ye=this.outputShape,Xe=Ye.length,at=Da(Xe),gt=Cs("coords",Xe),bt=["x","y","z","w","u","v"].slice(0,Xe);this.variableNames=Me.map(function(fr,yr){return"T"+yr});var _t=new Array(Me.length-1);_t[0]=Me[0][qe];for(var jt=1;jt<_t.length;jt++)_t[jt]=_t[jt-1]+Me[jt][qe];var Qt=bt[qe],sn=bt.slice(-2),Zt=bt.join(),rn="if ("+Qt+" < "+_t[0]+`) {
        return getChannel(
            getT0(`+Zt+"), vec2("+sn.join()+`));
        }`;for(jt=1;jt<_t.length;jt++){var Sn=_t[jt-1];rn+=`
        if (`+Qt+" < "+_t[jt]+"  && "+Qt+" >= "+_t[jt-1]+`) {
          return getChannel(
            getT`+jt+"("+Wi(bt,Qt,Sn)+`),
            vec2(`+Wi(sn,Qt,Sn)+`));
        }`}var Bn=_t.length,Mn=_t[_t.length-1];rn+=`
        return getChannel(
          getT`+Bn+"("+Wi(bt,Qt,Mn)+`),
          vec2(`+Wi(sn,Qt,Mn)+"));",this.userCode=`
      float getValue(`+bt.map(function(fr){return"int "+fr})+`) {
        `+rn+`
      }

      void main() {
        `+at+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+gt+`), 0., 0., 0.);

        `+gt[Xe-1]+" = "+gt[Xe-1]+` + 1;
        if (`+gt[Xe-1]+" < "+Ye[Xe-1]+`) {
          result.g = getValue(`+gt+`);
        }

        `+gt[Xe-2]+" = "+gt[Xe-2]+` + 1;
        if (`+gt[Xe-2]+" < "+Ye[Xe-2]+`) {
          result.a = getValue(`+gt+`);
        }

        `+gt[Xe-1]+" = "+gt[Xe-1]+` - 1;
        if (`+gt[Xe-2]+" < "+Ye[Xe-2]+` &&
            `+gt[Xe-1]+" < "+Ye[Xe-1]+`) {
          result.b = getValue(`+gt+`);
        }
        setOutput(result);
      }
    `}(a.map(function(Me){return Me.shape}),l);return this.compileAndRun(le,a)}var be=Ku(a.map(function(Me){return Me.shape}),l),Se=a.map(function(Me){return Me.as2D(-1,Qe(Me.shape.slice(l)))}),Ie=new function(Me){this.outputShape=[],this.outputShape=Ku(Me,1),this.variableNames=Me.map(function(_t,jt){return"T"+jt});var qe=new Array(Me.length-1);qe[0]=Me[0][1];for(var Ye=1;Ye<qe.length;Ye++)qe[Ye]=qe[Ye-1]+Me[Ye][1];var Xe=["if (yC < "+qe[0]+") setOutput(getT0(yR, yC));"];for(Ye=1;Ye<qe.length;Ye++){var at=qe[Ye-1];Xe.push("else if (yC < "+qe[Ye]+") setOutput(getT"+Ye+"(yR, yC-"+at+"));")}var gt=qe.length,bt=qe[qe.length-1];Xe.push("else setOutput(getT"+gt+"(yR, yC-"+bt+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+Xe.join(`
        `)+`
      }
    `}(Se.map(function(Me){return Me.shape}));return this.compileAndRun(Ie,Se).reshape(be)},c.prototype.neg=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.neg(a);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,tc,a.dtype);var l=new ra(a.shape,tc);return this.compileAndRun(l,[a])},c.prototype.batchMatMul=function(a,l,y,S){var U=y?a.shape[2]:a.shape[1],G=S?l.shape[1]:l.shape[2],ae=y?a.shape[1]:a.shape[2],le=a.shape[0];if((U===1||G===1)&&ae>1e3){y&&(a=vt(a,[0,2,1])),S&&(l=vt(l,[0,2,1]));var be=G===1?a:a.as3D(le,ae,1),Se=G===1?2:1,Ie=G===1?l.as3D(le,1,ae):l;return this.multiply(be,Ie).sum(Se,!0)}var Me=yn(a.dtype,l.dtype),qe=new ol(a.shape,[le,U,G],y,S);return this.compileAndRun(qe,[a,l],Me)},c.prototype.fusedBatchMatMul=function(a){var l=a.a,y=a.b,S=a.transposeA,U=a.transposeB,G=a.bias,ae=a.activation,le=a.preluActivationWeights,be=S?l.shape[2]:l.shape[1],Se=U?y.shape[1]:y.shape[2],Ie=l.shape[0],Me=yn(l.dtype,y.dtype),qe=G!=null,Ye=le!=null,Xe=ae?lh(ae,!0):null,at=new ol(l.shape,[Ie,be,Se],S,U,qe,Xe,Ye),gt=[l,y];return G&&gt.push(G),le&&gt.push(le),this.compileAndRun(at,gt,Me)},c.prototype.multiply=function(a,l){if(a.dtype==="complex64"){var y=this.texData.get(a.dataId),S=this.texData.get(l.dataId),U=new Zo("return areal * breal - aimag * bimag;",a.shape,l.shape),G=new Zo("return areal * bimag + aimag * breal;",a.shape,l.shape),ae=[this.makeComplexComponentTensorInfo(a,y.complexTensors.real),this.makeComplexComponentTensorInfo(a,y.complexTensors.imag),this.makeComplexComponentTensorInfo(l,S.complexTensors.real),this.makeComplexComponentTensorInfo(l,S.complexTensors.imag)],le=this.compileAndRun(U,ae),be=this.compileAndRun(G,ae),Se=this.complex(le,be);return le.dispose(),be.dispose(),Se}if(this.shouldExecuteOnCPU([a,l]))return this.cpuBackend.multiply(a,l);if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,Dc,a.dtype);var Ie=new Va(Dc,a.shape,l.shape);return this.compileAndRun(Ie,[a,l],a.dtype)},c.prototype.batchNormalization=function(a,l,y,S,U,G){var ae=[a,l,y],le=null;G!=null&&(le=G.shape,ae.push(G));var be=null;if(U!=null&&(be=U.shape,ae.push(U)),W().getBool("WEBGL_PACK_NORMALIZATION")){var Se=new function(Me,qe,Ye,Xe,at,gt){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Co(Me,qe),Co(Me,Ye);var bt="vec4(0.0)";Xe!=null&&(Co(Me,Xe),this.variableNames.push("offset"),bt="getOffsetAtOutCoords()");var _t="vec4(1.0)";at!=null&&(Co(Me,at),this.variableNames.push("scale"),_t="getScaleAtOutCoords()"),this.outputShape=Me,this.userCode=`
      void main() {
        vec4 offset = `+bt+`;
        vec4 scale = `+_t+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+gt+`));

        setOutput((x - mean) * inv + offset);
      }
    `}(a.shape,l.shape,y.shape,le,be,S);return this.compileAndRun(Se,ae)}var Ie=new function(Me,qe,Ye,Xe,at,gt){this.outputShape=[],this.variableNames=["x","mean","variance"],Co(Me,qe),Co(Me,Ye);var bt="0.0";Xe!=null&&(Co(Me,Xe),this.variableNames.push("offset"),bt="getOffsetAtOutCoords()");var _t="1.0";at!=null&&(Co(Me,at),this.variableNames.push("scale"),_t="getScaleAtOutCoords()"),this.outputShape=Me,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+bt+`;
        float scale = `+_t+`;
        float inv = scale * inversesqrt(variance + float(`+gt+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}(a.shape,l.shape,y.shape,le,be,S);return this.compileAndRun(Ie,ae)},c.prototype.localResponseNormalization4D=function(a,l,y,S,U){var G=W().getBool("WEBGL_PACK_NORMALIZATION")?new function(ae,le,be,Se,Ie){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var Me,qe=le,Ye=ae[3]-1;this.outputShape=ae;var Xe="float("+be+") + float("+Se+") * sum";Me=Ie===.5?"inversesqrt("+Xe+")":Ie===1?"1.0/("+Xe+")":"exp(log("+Xe+") * float(-"+Ie+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+qe+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+qe+"; j <= "+qe+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+Ye+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+Me+`;
        setOutput(result);
      }
    `}(a.shape,l,y,S,U):new function(ae,le,be,Se,Ie){this.variableNames=["x"],this.outputShape=[];var Me,qe=le,Ye=ae[3]-1;this.outputShape=ae;var Xe="float("+be+") + float("+Se+") * sum";Me=Ie===.5?"inversesqrt("+Xe+")":Ie===1?"1.0/("+Xe+")":"exp(log("+Xe+") * float(-"+Ie+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+qe+"; j <= "+qe+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+Ye+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+Me+`;
        setOutput(val);
      }
    `}(a.shape,l,y,S,U);return this.compileAndRun(G,[a])},c.prototype.LRNGrad=function(a,l,y,S,U,G,ae){var le=new function(be,Se,Ie,Me,qe){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=be,this.depth=be[3],this.depthRadius=Se,this.bias=Ie,this.alpha=Me,this.beta=qe,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+Se+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+Se+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+Me+") * norm + float("+Ie+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+Me+`)
                * float(`+qe+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+qe+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}(l.shape,S,U,G,ae);return this.compileAndRun(le,[l,y,a])},c.prototype.tile=function(a,l){if(a.dtype==="string"){var y=this.readSync(a.dataId).map(function(U){return Fr(U)});return ks(Ki(a.shape,a.dtype,y),l)}var S=new function(U,G){this.variableNames=["A"];for(var ae=new Array(U.length),le=0;le<ae.length;le++)ae[le]=U[le]*G[le];this.outputShape=ae,this.rank=ae.length;var be=Da(this.rank),Se=function(Ie){var Me=Ie.length;if(Me>5)throw Error("Tile for rank "+Me+" is not yet supported");if(Me===1)return"imod(resRC, "+Ie[0]+")";for(var qe=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],Ye=[],Xe=0;Xe<Ie.length;Xe++)Ye.push("imod("+qe[Xe]+", "+Ie[Xe]+")");return Ye.join()}(U);this.userCode=`
      void main() {
        `+be+` resRC = getOutputCoords();
        setOutput(getA(`+Se+`));
      }
    `}(a.shape,l);return this.compileAndRun(S,[a])},c.prototype.pad=function(a,l,y){var S=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(U,G,ae){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=G.map(function(Qt,sn){return Qt[0]+U[sn]+Qt[1]});for(var le=U.length,be=Da(le),Se=G.map(function(Qt){return Qt[0]}).join(","),Ie=G.map(function(Qt,sn){return Qt[0]+U[sn]}).join(","),Me=Cs("rc",le),qe=Cs("source",le),Ye=Me[le-1]+" < "+this.outputShape[le-1],Xe=le===1?"source":"vec2("+qe.slice(-2).join()+")",at=[be+" rc = outputLoc;",Me[le-1]+` += 1;
       if(`+Ye+`) {
      `,le===1?"":`}
       rc = outputLoc;
       `+Me[le-2]+` += 1;
       if(`+Me[le-2]+" < "+this.outputShape[le-2]+") {",le===1?"":"  "+Me[le-1]+` += 1;
         if(`+Ye+") {"],gt=le===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",bt="",_t=0,jt=le===1?2:4;_t<jt;_t++)bt+=`
        `+at[_t]+`
        if (`+gt+`) {
          result[`+_t+"] = float("+ae+`);
        } else {
          `+be+` source = rc - start;
          result[`+_t+"] = getChannel(getX("+qe.join()+"), "+Xe+`);
        }
      `;bt+=le===1?"} ":"}}",this.userCode=`
      const `+be+" start = "+be+"("+Se+`);
      const `+be+" end = "+be+"("+Ie+`);

      void main() {
        `+be+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+bt+`
        setOutput(result);
      }
    `}(a.shape,l,y):new function(U,G,ae){this.variableNames=["x"],this.outputShape=G.map(function(qe,Ye){return qe[0]+U[Ye]+qe[1]});var le=U.length,be=Da(le),Se=G.map(function(qe){return qe[0]}).join(","),Ie=G.map(function(qe,Ye){return qe[0]+U[Ye]}).join(","),Me=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,le);this.userCode=le!==1?`
      `+be+" start = "+be+"("+Se+`);
      `+be+" end = "+be+"("+Ie+`);

      void main() {
        `+be+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+ae+`));
        } else {
          `+be+` coords = outC - start;
          setOutput(getX(`+Me+`));
        }
      }
    `:`
        int start = `+Se+`;
        int end = `+Ie+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+ae+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}(a.shape,l,y);return this.compileAndRun(S,[a])},c.prototype.gather=function(a,l,y){if(this.shouldExecuteOnCPU([a,l]))return this.cpuBackend.gather(a,l,y);var S=new function(U,G,ae){this.variableNames=["A","indices"];var le=U.slice();le[ae]=G,this.outputShape=le,this.rank=le.length;var be=Da(this.rank),Se=function(Ie,Me){var qe=Ie.length;if(qe>4)throw Error("Gather for rank "+qe+" is not yet supported");if(qe===1)return"int(getIndices(resRC))";for(var Ye=["resRC.x","resRC.y","resRC.z","resRC.w"],Xe=[],at=0;at<Ie.length;at++)at===Me?Xe.push("int(getIndices("+Ye[at]+"))"):Xe.push(""+Ye[at]);return Xe.join()}(U,ae);this.userCode=`
      void main() {
        `+be+` resRC = getOutputCoords();
        setOutput(getA(`+Se+`));
      }
    `}(a.shape,l.size,y);return this.compileAndRun(S,[a,l])},c.prototype.batchToSpaceND=function(a,l,y){Ce(a.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var S=l.reduce(function(Se,Ie){return Se*Ie}),U=Il(a.shape,l,S),G=cr(U.length,l.length),ae=jr(a.shape,l,S),le=Or(y,l.length),be=Mi(ae,y,l.length);return vt(a.reshape(U),G).reshape(ae).slice(le,be)},c.prototype.spaceToBatchND=function(a,l,y){Ce(a.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var S=l.reduce(function(Ie,Me){return Ie*Me}),U=[[0,0]];U.push.apply(U,y);for(var G=1+l.length;G<a.shape.length;++G)U.push([0,0]);var ae=a.pad(U),le=Il(ae.shape,l,S,!1),be=cr(le.length,l.length,!1),Se=jr(ae.shape,l,S,!1);return vt(ae.reshape(le),be).reshape(Se)},c.prototype.reduce=function(a,l,y){var S=a.shape[0],U=a.shape[1],G=new function(le,be){this.variableNames=["x"];var Se=le.windowSize,Ie=le.batchSize,Me=le.inSize,qe=Math.ceil(Me/Se);this.outputShape=[Ie,qe];var Ye="0.0",Xe="";be==="prod"?Ye="1.0":be==="min"?(Ye="1.0 / 1e-20",Xe="min"):be==="max"&&(Ye="-1.0 / 1e-20",Xe="max");var at=be+"("+be+"("+be+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";be==="sum"?at="sumValue":be==="prod"?at="prodValue":be==="all"?at="allValue":be==="any"&&(at="anyValue");var gt=4*Math.floor(Se/4),bt=Se%4,_t=`
      if (`+(be==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(be==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+Xe+`(values, minMaxValue);
      }
    `,jt="vec4";be==="all"?(Ye="1.0",_t=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,jt="bvec4"):be==="any"&&(Ye="0.0",_t=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,jt="bvec4");var Qt="";Me%Se>0&&(Qt=`
        if (inIdx < 0 || inIdx >= `+Me+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+Ye+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+Qt+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+Se+`;

        vec4 minMaxValue = vec4(`+Ye+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+gt+`; i += 4) {
          int inIdx = inOffset + i;
          `+jt+" values = "+jt+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+_t+`
        }

        int inIdx = inOffset + `+gt+`;
        if (`+(bt===1)+`) {
          `+jt+" values = "+jt+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+_t+`
        } else if (`+(bt===2)+`) {
          `+jt+" values = "+jt+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+_t+`
        } else if (`+(bt===3)+`) {
          `+jt+" values = "+jt+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+_t+`
        }
        setOutput(`+at+`);
      }
    `}({windowSize:lf(U),inSize:U,batchSize:S},l),ae=this.compileAndRun(G,[a],y);return ae.shape[1]===1?ae:this.reduce(ae,l,y)},c.prototype.argReduce=function(a,l,y){y===void 0&&(y=null);var S=a.shape[0],U=a.shape[1];y!=null&&(S=y.shape[0],U=y.shape[1]);var G=new function(be,Se,Ie){this.variableNames=["A"];var Me=be.windowSize,qe=be.batchSize,Ye=be.inSize,Xe=Math.ceil(Ye/Me);Ie||this.variableNames.push("bestIndicesA"),this.outputShape=[qe,Xe];var at=Se==="max"?">":"<",gt=Ie?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+Me+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+Me+`; i++) {
          int inIdx = `+gt+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+at+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}({windowSize:lf(U),inSize:U,batchSize:S},l,y==null),ae=[a];y!=null&&ae.push(y);var le=this.compileAndRun(G,ae,"int32");return le.shape[1]===1?le:this.argReduce(a,l,le)},c.prototype.argReducePacked=function(a,l,y){y===void 0&&(y=null);var S=y!=null?y.shape:a.shape,U=new function(le,be,Se,Ie){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Ce(le.length>2,function(){return"Packed arg"+(Se.charAt(0).toUpperCase()+Se.slice(1))+" supports only inputs with rank above 2."});var Me=le[le.length-1],qe=Math.ceil(Me/be);this.outputShape=le.slice(0,-1),qe>1&&this.outputShape.push(qe),Ie||this.variableNames.push("bestIndicesA");var Ye,Xe,at=this.outputShape,gt=at.length,bt=Da(gt),_t=Cs("coords",gt);if(qe===1){var jt=Da(Xe=gt+1);Ye=`
        `+jt+" sourceLocR = "+jt+"("+_t.join()+`, 0);
        ++`+_t[gt-1]+`;
        `+jt+" sourceLocG = "+jt+"("+_t.join()+`, 0);
        ++`+_t[gt-2]+`;
        `+jt+" sourceLocA = "+jt+"("+_t.join()+`, 0);
        --`+_t[gt-1]+`;
        `+jt+" sourceLocB = "+jt+"("+_t.join()+`, 0);
        --`+_t[gt-2]+";"}else Xe=gt,Ye=`
        `+bt+` sourceLocR = coords;
        ++`+_t[gt-1]+`;
        `+bt+` sourceLocG = coords;
        ++`+_t[gt-2]+`;
        `+bt+` sourceLocA = coords;
        --`+_t[gt-1]+`;
        `+bt+` sourceLocB = coords;
        --`+_t[gt-2]+";";var Qt=["x","y","z","w","u","v"].slice(0,Xe),sn="."+Qt[Xe-1],Zt=Qt.map(function(Ar){return"int "+Ar}),rn=Cs("sourceLocR",Xe-1).concat("inIdx.r"),Sn=Cs("sourceLocG",Xe-1).concat("inIdx.g"),Bn=Cs("sourceLocB",Xe-1).concat("inIdx.b"),Mn=Cs("sourceLocA",Xe-1).concat("inIdx.a"),fr=Se==="max"?"greaterThan":"lessThan",yr=Ie?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+rn.join()+`),
                             getBestIndicesAChannel(`+Sn.join()+`),
                             getBestIndicesAChannel(`+Bn.join()+`),
                             getBestIndicesAChannel(`+Mn.join()+")));",Cr=`vec4(
            getAChannel(`+rn.join()+`),
            hasNextCol ? getAChannel(`+Sn.join()+`) : 0.,
            hasNextRow ? getAChannel(`+Bn.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+Mn.join()+") : 0.)",Nr=Ie?"":`
      float getBestIndicesAChannel(`+Zt.join()+`) {
        return getChannel(getBestIndicesA(`+Qt.join()+`),
                                          vec2(`+Qt.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+Zt.join()+`) {
        return getChannel(getA(`+Qt.join()+`),
                               vec2(`+Qt.slice(-2).join()+`));
      }
      `+Nr+`
      void main() {
        `+bt+` coords = getOutputCoords();
        bool hasNextCol = `+_t[gt-1]+" < "+(at[gt-1]-1)+`;
        bool hasNextRow = `+_t[gt-2]+" < "+(at[gt-2]-1)+`;
        `+Ye+`
        ivec4 srcIdx = ivec4(sourceLocR`+sn+", sourceLocG"+sn+`,
          sourceLocB`+sn+", sourceLocA"+sn+") * "+be+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+Cr+`;

        for (int i = 0; i < `+be+`; i++) {
          inIdx = srcIdx;
          `+yr+`
          vec4 candidate = `+Cr+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+fr+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}(S,lf(S[S.length-1]),l,y==null),G=y==null?[a]:[a,y],ae=this.compileAndRun(U,G,"int32");return ae.rank===a.rank?this.argReducePacked(a,l,ae):ae},c.prototype.sum=function(a,l){La("sum",l,a.rank);var y=pa(a.shape,l),S=y[0],U=Qe(y[1]),G=a.as2D(-1,U),ae=dr(a.dtype);return this.reduce(G,"sum",ae).reshape(S)},c.prototype.prod=function(a,l){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.prod(a,l);var y=pa(a.shape,l),S=y[0],U=Qe(y[1]),G=a.as2D(-1,U),ae=dr(a.dtype);return this.reduce(G,"prod",ae).reshape(S)},c.prototype.unsortedSegmentSum=function(a,l,y){var S=0,U=Fs([S],a.rank),G=a;U!=null&&(G=vt(a,U),S=Rs(1,a.rank)[0]);var ae=function(Me,qe,Ye){for(var Xe=[],at=Me.length,gt=0;gt<at;gt++)gt!==qe?Xe.push(Me[gt]):Xe.push(Ye);return Xe}(G.shape,S,y),le=Qe([G.shape[S]]),be=G.as2D(-1,le),Se=dr(a.dtype),Ie=this.segOpCompute(be,"unsortedSegmentSum",l,Se,y).reshape(ae);return U!=null&&(Ie=vt(Ie,vl(U))),Ie},c.prototype.segOpCompute=function(a,l,y,S,U){var G=a.shape[0],ae=a.shape[1],le=function(Ie,Me){var qe,Ye=!1;for(Ie<=Pl?(qe=Ie,Ye=!0):qe=Rr(Ie,Math.floor(Math.sqrt(Ie)));!Ye;)qe>Me||qe===Ie?Ye=!0:qe=Rr(Ie,qe+1);return qe}(ae,U),be=new function(Ie,Me){this.variableNames=["x","segmentIds"];var qe=Ie.windowSize,Ye=Ie.batchSize,Xe=Ie.inSize,at=Ie.numSegments,gt=at*Math.ceil(Xe/qe);this.outputShape=[Ye,gt];var bt=4*Math.floor(qe/4),_t=qe%4,jt=`
        sumValue += dot(values, segFilter);
    `,Qt="";Xe%qe>0&&(Qt=`
        if (inIdx < 0 || inIdx >= `+Xe+`) {
          return initializationValue;
        }
      `);var sn="";Xe%qe>0&&(sn=`
        if (inIdx < 0 || inIdx >= `+Xe+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+Qt+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+sn+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+at+")) * float("+qe+`));
        int currentSeg = int(mod(float(outIdx), float(`+at+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+bt+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+jt+`
        }

        int inIdx = inOffset + `+bt+`;
        if (`+(_t===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+jt+`
        } else if (`+(_t===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+jt+`
        } else if (`+(_t===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+jt+`
        }
        setOutput(sumValue);
      }
    `}({windowSize:le,inSize:ae,batchSize:G,numSegments:U}),Se=this.compileAndRun(be,[a,y],S);return Se.shape[1]===U?Se:(y=rf(0,U).tile([ae/le]),this.segOpCompute(Se,l,y,S,U))},c.prototype.argMinMaxReduce=function(a,l,y){var S=[l];if(La("arg"+y.charAt(0).toUpperCase()+y.slice(1),S,a.rank),!W().getBool("WEBGL_PACK_REDUCE")||a.rank<=2){var U=pa(a.shape,S),G=U[0],ae=Qe(U[1]),le=a.as2D(-1,ae);return this.argReduce(le,y).reshape(G)}return this.argReducePacked(a,y)},c.prototype.argMin=function(a,l){return this.argMinMaxReduce(a,l,"min")},c.prototype.argMax=function(a,l){return this.argMinMaxReduce(a,l,"max")},c.prototype.cumsum=function(a,l,y,S){if(l!==a.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(a.rank-1)+" but got axis="+l);var U=new function(G,ae,le){this.variableNames=["x"],this.outputShape=G;var be=G.length,Se=G[G.length-1],Ie=le?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(le?"return "+Se+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Da(be)+` coords = getOutputCoords();
        int end = `+s0(be,"coords")+`;
        float val = 0.0;
        for (int i = `+Se+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+Ie+` end) {
            continue;
          }
          if (idx == end && `+ae+`) {
            continue;
          }
          `+s0(be,"coords")+` = idx;
          val += getX(`+function(Me,qe){if(Me===1)return""+qe;if(Me===2)return qe+".x, "+qe+".y";if(Me===3)return qe+".x, "+qe+".y, "+qe+".z";if(Me===4)return qe+".x, "+qe+".y, "+qe+".z, "+qe+".w";throw Error("Cumulative sum for rank "+Me+" is not yet supported")}(be,"coords")+`);
        }
        setOutput(val);
      }
    `}(a.shape,y,S);return this.compileAndRun(U,[a])},c.prototype.equal=function(a,l){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,`
  return vec4(equal(a, b));
`,"bool");var y=new Va("return float(a == b);",a.shape,l.shape);return this.compileAndRun(y,[a,l],"bool")},c.prototype.notEqual=function(a,l){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,`
  return vec4(notEqual(a, b));
`,"bool");var y=new Va("return float(a != b);",a.shape,l.shape);return this.compileAndRun(y,[a,l],"bool")},c.prototype.less=function(a,l){if(this.shouldExecuteOnCPU([a,l]))return this.cpuBackend.less(a,l);if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,`
  return vec4(lessThan(a, b));
`,"bool");var y=new Va("return float(a < b);",a.shape,l.shape);return this.compileAndRun(y,[a,l],"bool")},c.prototype.lessEqual=function(a,l){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,`
  return vec4(lessThanEqual(a, b));
`,"bool");var y=new Va("return float(a <= b);",a.shape,l.shape);return this.compileAndRun(y,[a,l],"bool")},c.prototype.greater=function(a,l){if(this.shouldExecuteOnCPU([a,l]))return this.cpuBackend.greater(a,l);if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,`
  return vec4(greaterThan(a, b));
`,"bool");var y=new Va("return float(a > b);",a.shape,l.shape);return this.compileAndRun(y,[a,l],"bool")},c.prototype.greaterEqual=function(a,l){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var y=new Va("return float(a >= b);",a.shape,l.shape);return this.compileAndRun(y,[a,l],"bool")},c.prototype.logicalNot=function(a){var l=new ra(a.shape,"return float(!(x >= 1.0));");return this.compileAndRun(l,[a])},c.prototype.logicalAnd=function(a,l){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var y=new Va("return float(a >= 1.0 && b >= 1.0);",a.shape,l.shape);return this.compileAndRun(y,[a,l],"bool")},c.prototype.logicalOr=function(a,l){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var y=new Va("return float(a >= 1.0 || b >= 1.0);",a.shape,l.shape);return this.compileAndRun(y,[a,l],"bool")},c.prototype.select=function(a,l,y){var S=new function(U,G,ae){var le,be;if(this.variableNames=["c","a","b"],this.outputShape=G,ae>4)throw Error("Where for rank "+ae+" is not yet supported");if(ae===1)be="resRC",le="resRC";else{for(var Se=["resRC.x","resRC.y","resRC.z","resRC.w"],Ie=[],Me=[],qe=0;qe<G.length;qe++)Me.push(""+Se[qe]),qe<U&&Ie.push(""+Se[qe]);le=Ie.join(),be=Me.join()}var Ye=Da(ae);this.userCode=`
      void main() {
        `+Ye+` resRC = getOutputCoords();
        float cVal = getC(`+le+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+be+`));
        } else {
          setOutput(getB(`+be+`));
        }
      }
    `}(a.rank,l.shape,l.rank);return this.compileAndRun(S,[a,l,y],yn(l.dtype,y.dtype))},c.prototype.where=function(a){Jf("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var l=a.dataSync();return Wa(a.shape,l)},c.prototype.topk=function(a,l,y){return Qo(a.dataSync(),a.shape,a.dtype,l)},c.prototype.min=function(a,l){La("min",l,a.rank);var y=pa(a.shape,l),S=y[0],U=Qe(y[1]),G=a.as2D(-1,U);return this.reduce(G,"min",G.dtype).reshape(S)},c.prototype.minimum=function(a,l){if(this.shouldExecuteOnCPU([a,l]))return this.cpuBackend.minimum(a,l);var y=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ps(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,a.shape,l.shape):new Va(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,a.shape,l.shape);return this.compileAndRun(y,[a,l])},c.prototype.mod=function(a,l){var y=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ps(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,a.shape,l.shape):new Va(`if (b == 0.0) return NAN;
  return mod(a, b);`,a.shape,l.shape);return this.compileAndRun(y,[a,l])},c.prototype.max=function(a,l){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.max(a,l);La("max",l,a.rank);var y=pa(a.shape,l),S=y[0],U=Qe(y[1]),G=a.as2D(-1,U);return this.reduce(G,"max",G.dtype).reshape(S)},c.prototype.maximum=function(a,l){if(this.shouldExecuteOnCPU([a,l]))return this.cpuBackend.maximum(a,l);var y=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ps(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,a.shape,l.shape):new Va(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,a.shape,l.shape);return this.compileAndRun(y,[a,l])},c.prototype.all=function(a,l){La("all",l,a.rank);var y=pa(a.shape,l),S=y[0],U=Qe(y[1]),G=a.as2D(-1,U);return this.reduce(G,"all",G.dtype).reshape(S)},c.prototype.any=function(a,l){La("any",l,a.rank);var y=pa(a.shape,l),S=y[0],U=Qe(y[1]),G=a.as2D(-1,U);return this.reduce(G,"any",G.dtype).reshape(S)},c.prototype.floorDiv=function(a,l){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var y=new Va(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,a.shape,l.shape);return this.compileAndRun(y,[a,l],"int32")},c.prototype.add=function(a,l){if(a.dtype==="complex64"&&l.dtype==="complex64")return this.complexSeparableBinaryOp(a,l,Lu);if(this.shouldExecuteOnCPU([a,l]))return this.cpuBackend.add(a,l);var y=yn(a.dtype,l.dtype);if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,Lu,y);var S=new Va(Lu,a.shape,l.shape);return this.compileAndRun(S,[a,l],y)},c.prototype.packedUnaryOp=function(a,l,y){var S=new ql(a.shape,l);return this.compileAndRun(S,[a],y)},c.prototype.packedBinaryOp=function(a,l,y,S,U){U===void 0&&(U=!1);var G=new Ps(y,a.shape,l.shape,U);return this.compileAndRun(G,[a,l],S)},c.prototype.complexSeparableBinaryOp=function(a,l,y){var S=this,U=this.texData.get(a.dataId),G=this.texData.get(l.dataId),ae=[[U.complexTensors.real,G.complexTensors.real],[U.complexTensors.imag,G.complexTensors.imag]].map(function(Ie){var Me=Ie[0],qe=Ie[1],Ye=S.makeComplexComponentTensorInfo(a,Me),Xe=S.makeComplexComponentTensorInfo(l,qe),at=new Va(y,a.shape,l.shape);return S.compileAndRun(at,[Ye,Xe],yn(Me.dtype,qe.dtype))}),le=ae[0],be=ae[1],Se=this.complex(le,be);return le.dispose(),be.dispose(),Se},c.prototype.makeComplexComponentTensorInfo=function(a,l){return{dataId:l.dataId,dtype:l.dtype,shape:a.shape}},c.prototype.addN=function(a){if(a.length===1)return a[0];if(a.length>W().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var l=Math.floor(a.length/2),y=this.addN(a.slice(0,l)),S=this.addN(a.slice(l));return this.addN([y,S])}var U=a.map(function(le){return le.dtype}).reduce(function(le,be){return yn(le,be)}),G=a.map(function(le){return le.shape}),ae=W().getBool("WEBGL_PACK")?new function(le,be){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=le,this.variableNames=be.map(function(Me,qe){return"T"+qe});var Se=[];this.variableNames.forEach(function(Me){Se.push("vec4 v"+Me+" = get"+Me+"AtOutCoords();")});var Ie=this.variableNames.map(function(Me){return"v"+Me}).join(" + ");this.userCode=`
      void main() {
        `+Se.join(`
        `)+`

        vec4 result = `+Ie+`;
        setOutput(result);
      }
    `}(a[0].shape,G):new function(le,be){this.outputShape=[],this.outputShape=le,this.variableNames=be.map(function(Me,qe){return"T"+qe});var Se=[];this.variableNames.forEach(function(Me){Se.push("float v"+Me+" = get"+Me+"AtOutCoords();")});var Ie=this.variableNames.map(function(Me){return"v"+Me}).join(" + ");this.userCode=`
      void main() {
        `+Se.join(`
        `)+`

        float result = `+Ie+`;
        setOutput(result);
      }
    `}(a[0].shape,G);return this.compileAndRun(ae,a,U)},c.prototype.subtract=function(a,l){if(a.dtype==="complex64"&&l.dtype==="complex64")return this.complexSeparableBinaryOp(a,l,Qs);if(this.shouldExecuteOnCPU([a,l]))return this.cpuBackend.subtract(a,l);var y=yn(a.dtype,l.dtype);if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,l,Qs,a.dtype);var S=new Va(Qs,a.shape,l.shape);return this.compileAndRun(S,[a,l],y)},c.prototype.pow=function(a,l){var y=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ps(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,a.shape,l.shape):new Va(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,a.shape,l.shape),S=yn(a.dtype,l.dtype);return this.compileAndRun(y,[a,l],S)},c.prototype.ceil=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.ceil(a);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,f0,a.dtype);var l=new ra(a.shape,f0);return this.compileAndRun(l,[a])},c.prototype.floor=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.floor(a);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,h0,a.dtype);var l=new ra(a.shape,h0);return this.compileAndRun(l,[a])},c.prototype.sign=function(a){var l=new ra(a.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(l,[a])},c.prototype.isNaN=function(a){var l=new ra(a.shape,"return float(isnan(x));");return this.compileAndRun(l,[a],"bool")},c.prototype.isInf=function(a){var l=new ra(a.shape,"return float(isinf(x));");return this.compileAndRun(l,[a],"bool")},c.prototype.isFinite=function(a){var l=new ra(a.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(l,[a],"bool")},c.prototype.round=function(a){var l=new ra(a.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(l,[a])},c.prototype.exp=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.exp(a);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,ch,a.dtype);var l=new ra(a.shape,ch);return this.compileAndRun(l,[a])},c.prototype.expm1=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.expm1(a);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,Vl,a.dtype);var l=new ra(a.shape,Vl);return this.compileAndRun(l,[a])},c.prototype.softmax=function(a,l){var y=Tn([l],a.shape),S=this.max(a,y),U=Ea(S.shape,y),G=this.subtract(a,S.reshape(U)),ae=this.exp(G),le=this.sum(ae,y).reshape(U);return ts(ae,le)},c.prototype.log=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.log(a);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,a.dtype);var l=new ra(a.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(l,[a])},c.prototype.log1p=function(a){var l=new ra(a.shape,"return log(1.0 + x);");return this.compileAndRun(l,[a])},c.prototype.sqrt=function(a){var l=new ra(a.shape,"return sqrt(x);");return this.compileAndRun(l,[a])},c.prototype.rsqrt=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.rsqrt(a);var l=new ra(a.shape,"return inversesqrt(x);");return this.compileAndRun(l,[a])},c.prototype.reciprocal=function(a){var l=new ra(a.shape,"return 1.0 / x;");return this.compileAndRun(l,[a])},c.prototype.relu=function(a){var l;return l=W().getBool("WEBGL_PACK")?new ql(a.shape,Wm):new ra(a.shape,jg),this.compileAndRun(l,[a])},c.prototype.relu6=function(a){var l;return l=W().getBool("WEBGL_PACK")?new ql(a.shape,Ff):new ra(a.shape,sp),this.compileAndRun(l,[a])},c.prototype.prelu=function(a,l){var y=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ps(hu,a.shape,l.shape):new Va(Ll,a.shape,l.shape);return this.compileAndRun(y,[a,l])},c.prototype.elu=function(a){if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,nc,a.dtype);var l=new ra(a.shape,ou);return this.compileAndRun(l,[a])},c.prototype.eluDer=function(a,l){var y=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ps(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,a.shape,l.shape):new Va("return (b >= 1.0) ? a : a * (b + 1.0);",a.shape,l.shape);return this.compileAndRun(y,[a,l])},c.prototype.selu=function(a){var l=new ra(a.shape,`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = 1.7580993408473768;
  float scale = 1.0507009873554805;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`);return this.compileAndRun(l,[a])},c.prototype.int=function(a){var l=new ra(a.shape,"return float(int(x));");return this.compileAndRun(l,[a],"int32")},c.prototype.clip=function(a,l,y){var S,U=(S=W().getBool("WEBGL_PACK_CLIP")?new ah(a.shape):new rl(a.shape)).getCustomSetupFunc(l,y);return this.compileAndRun(S,[a],null,U)},c.prototype.abs=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.abs(a);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,Um,a.dtype);var l=new ra(a.shape,Um);return this.compileAndRun(l,[a])},c.prototype.complexAbs=function(a){var l=this.texData.get(a.dataId),y=new function(U){this.variableNames=["real","imag"],this.outputShape=U,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}(a.shape),S=[this.makeComplexComponentTensorInfo(a,l.complexTensors.real),this.makeComplexComponentTensorInfo(a,l.complexTensors.imag)];return this.compileAndRun(y,S)},c.prototype.sigmoid=function(a){var l=new ra(a.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(l,[a])},c.prototype.softplus=function(a){var l=new ra(a.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(l,[a])},c.prototype.sin=function(a){var l=new ra(a.shape,`if (isnan(x)) return x;
  return sin(x);
`);return this.compileAndRun(l,[a])},c.prototype.cos=function(a){var l=new ra(a.shape,`if (isnan(x)) return x;
  return cos(x);
`);return this.compileAndRun(l,[a])},c.prototype.tan=function(a){var l=new ra(a.shape,"return tan(x);");return this.compileAndRun(l,[a])},c.prototype.asin=function(a){var l=new ra(a.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`);return this.compileAndRun(l,[a])},c.prototype.acos=function(a){var l=new ra(a.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`);return this.compileAndRun(l,[a])},c.prototype.atan=function(a){var l=new ra(a.shape,`if (isnan(x)) return x;
  return atan(x);
`);return this.compileAndRun(l,[a])},c.prototype.atan2=function(a,l){var y=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ps(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,a.shape,l.shape):new Va(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,a.shape,l.shape);return this.compileAndRun(y,[a,l])},c.prototype.sinh=function(a){var l=new ra(a.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(l,[a])},c.prototype.cosh=function(a){var l=new ra(a.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(l,[a])},c.prototype.tanh=function(a){var l=new ra(a.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(l,[a])},c.prototype.asinh=function(a){var l=new ra(a.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(l,[a])},c.prototype.acosh=function(a){var l=new ra(a.shape,`if (isnan(x)) return x;
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`);return this.compileAndRun(l,[a])},c.prototype.atanh=function(a){var l=new ra(a.shape,`if (isnan(x)) return x;
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`);return this.compileAndRun(l,[a])},c.prototype.erf=function(a){var l=new ra(a.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(l,[a])},c.prototype.step=function(a,l){var y=new ra(a.shape,function(S){return S===void 0&&(S=0),Rg+`
    return x > 0.0 ? 1.0 : float(`+S+`);
  `}(l));return this.compileAndRun(y,[a])},c.prototype.conv2dByMatMul=function(a,l,y,S,U,G){var ae=a.shape,le=this.texData.get(a.dataId),be=y.inChannels,Se=ae[0]*ae[1]*ae[2],Ie=y.outChannels,Me=y.dataFormat==="channelsLast",qe=(Se===1||Ie===1)&&be>1e3,Ye=ae[2]%2!=0&&!!le.isPacked;if(qe||!W().getBool("WEBGL_LAZILY_UNPACK")||!W().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!Ye){var Xe=Me?ae[0]*ae[1]*ae[2]:ae[0]*ae[2]*ae[3],at=this.reshape(a,[1,Xe,y.inChannels]),gt=this.reshape(l,[1,y.inChannels,y.outChannels]);return this.reshape(this.fusedBatchMatMul({a:at,b:gt,transposeA:!1,transposeB:!1,bias:S,activation:U,preluActivationWeights:G}),y.outShape)}var bt=Me?ae[0]*ae[1]*(ae[2]+1):ae[0]*ae[2]*(ae[3]+1),_t={dataId:a.dataId,shape:[1,bt,y.inChannels],dtype:a.dtype},jt=le.shape;le.shape=le.shape.slice(),le.shape[le.shape.length-2]++,Ce(eu(le.shape,_t.shape),function(){return"packed reshape "+le.shape+" to "+_t.shape+" isn't free"});var Qt=this.reshape(l,[1,y.inChannels,y.outChannels]),sn=this.fusedBatchMatMul({a:_t,b:Qt,transposeA:!1,transposeB:!1,bias:S,activation:U,preluActivationWeights:G}),Zt=this.texData.get(sn.dataId);return Ce(Zt.isPacked,function(){return"batchMatMul result is expected to be packed"}),le.shape=jt,Zt.shape=y.outShape,He.makeTensorFromDataId(sn.dataId,y.outShape,sn.dtype)},c.prototype.conv2dWithIm2Row=function(a,l,y,S,U,G){var ae=y.filterWidth,le=y.filterHeight,be=y.inChannels,Se=y.outWidth,Ie=y.outHeight,Me=y.dataFormat==="channelsLast",qe=ae*le*be,Ye=Ie*Se,Xe=[qe,Ye],at=a.squeeze([0]),gt=l.reshape([1,qe,-1]),bt=new function(Bn,Mn,fr){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Bn;for(var yr=fr.filterWidth,Cr=fr.inChannels,Nr=fr.strideWidth,Ar=fr.strideHeight,_r=fr.padInfo,Yr=fr.outWidth,Kr=fr.dilationWidth,fi=fr.dilationHeight,Ti=fr.dataFormat,Yi=_r.left,ia=_r.top,oa=Cr*yr,wa=fa(),ba=Ti==="channelsLast",ja=ba?0:1,Qa=ba?1:2,Ls="",Uo=0;Uo<=1;Uo++)for(var ka=0;ka<=1;ka++)Ls+=`
          blockIndex = rc.y + `+ka+`;
          pos = rc.x + `+Uo+`;

          if(blockIndex < `+Bn[1]+" && pos < "+Bn[0]+`) {
            offsetY = int(blockIndex / (`+Yr+")) * "+Ar+" - "+ia+`;
            d0 = offsetY + `+fi+" * (pos / "+oa+`);

            if(d0 < `+Mn[ja]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+Yr+".) * "+Nr+". - "+Yi+`.);
              d1 = offsetX + `+Kr+" * (int(mod(float(pos), "+oa+".) / "+Cr+`.));

              if(d1 < `+Mn[Qa]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+Cr+`.));

                if (`+ba+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*Uo+ka)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*Uo+ka)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+Ls+`

        `+wa.output+` = result;
      }
    `}(Xe,at.shape,y),_t=this.compileAndRun(bt,[at]).reshape([1,Xe[0],Xe[1]]),jt=S!=null,Qt=G!=null,sn=U?lh(U,!0):null,Zt=new ol(_t.shape,[1,Ye,y.outChannels],!0,!1,jt,sn,Qt),rn=[_t,gt];S&&rn.push(S),Qt&&rn.push(G);var Sn=this.compileAndRun(Zt,rn);return Me?Sn.reshape([1,Ie,Se,y.outChannels]):Sn.reshape([1,y.outChannels,Ie,Se])},c.prototype.fusedConv2d=function(a){var l=a.input,y=a.filter,S=a.convInfo,U=a.bias,G=a.activation,ae=a.preluActivationWeights;if(S.filterHeight===1&&S.filterWidth===1&&S.dilationHeight===1&&S.dilationWidth===1&&S.strideHeight===1&&S.strideWidth===1&&(S.padInfo.type==="SAME"||S.padInfo.type==="VALID"))return this.conv2dByMatMul(l,y,S,U,G,ae);if(W().getBool("WEBGL_CONV_IM2COL")&&l.shape[0]===1)return this.conv2dWithIm2Row(l,y,S,U,G,ae);var le=U!=null,be=ae!=null,Se=G?lh(G,!1):null,Ie=new rp(S,le,Se,be),Me=[l,y];return U&&Me.push(U),ae&&Me.push(ae),this.compileAndRun(Ie,Me)},c.prototype.conv2d=function(a,l,y){if(y.filterHeight===1&&y.filterWidth===1&&y.dilationHeight===1&&y.dilationWidth===1&&y.strideHeight===1&&y.strideWidth===1&&(y.padInfo.type==="SAME"||y.padInfo.type==="VALID"))return this.conv2dByMatMul(a,l,y);if(W().getBool("WEBGL_CONV_IM2COL")&&a.shape[0]===1)return this.conv2dWithIm2Row(a,l,y);var S=new rp(y);return this.compileAndRun(S,[a,l])},c.prototype.conv2dDerInput=function(a,l,y){var S=new function(U){this.variableNames=["dy","W"],this.outputShape=U.inShape;var G=U.filterHeight,ae=U.filterWidth,le=U.strideHeight,be=U.strideWidth,Se=U.dataFormat==="channelsLast",Ie=G-1-U.padInfo.top,Me=ae-1-U.padInfo.left,qe=Se?1:2,Ye=Se?2:3,Xe=Se?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+Ie+", "+Me+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+Xe+`];

        ivec2 dyCorner = ivec2(coords[`+qe+"], coords["+Ye+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+G+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+le+`.0;

          if (dyR < 0.0 || dyR >= `+U.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+G+` - 1 - wR;

          for (int wC = 0; wC < `+ae+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+be+`.0;

            if (dyC < 0.0 || dyC >= `+U.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+ae+` - 1 - wC;

            for (int d2 = 0; d2 < `+U.outChannels+`; d2++) {

              if (`+Se+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(S,[a,l])},c.prototype.conv2dDerFilter=function(a,l,y){var S=new function(U){this.variableNames=["x","dy"],this.outputShape=U.filterShape;var G=U.strideHeight,ae=U.strideWidth,le=U.padInfo.top,be=U.padInfo.left,Se=U.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+U.batchSize+`; b++) {
          for (int yR = 0; yR < `+U.outHeight+`; yR++) {
            int xR = wR + yR * `+G+" - "+le+`;

            if (xR < 0 || xR >= `+U.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+U.outWidth+`; yC++) {
              int xC = wC + yC * `+ae+" - "+be+`;

              if (xC < 0 || xC >= `+U.inWidth+`) {
                continue;
              }

              if (`+Se+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(S,[a,l])},c.prototype.fusedDepthwiseConv2D=function(a){var l,y=a.input,S=a.filter,U=a.convInfo,G=a.bias,ae=a.activation,le=a.preluActivationWeights,be=W().getBool("WEBGL_PACK_DEPTHWISECONV")&&U.strideWidth<=2&&U.outChannels/U.inChannels==1,Se=ae?lh(ae,be):null,Ie=[y,S],Me=G!=null,qe=le!=null;return Me&&Ie.push(G),qe&&Ie.push(le),be?(l=new uh(U,Me,Se,qe),this.compileAndRun(l,Ie)):(l=new sh(U,Me,Se,qe),this.compileAndRun(l,Ie))},c.prototype.depthwiseConv2D=function(a,l,y){var S;return W().getBool("WEBGL_PACK_DEPTHWISECONV")&&y.strideWidth<=2&&y.outChannels/y.inChannels==1?(S=new uh(y),this.compileAndRun(S,[a,l])):(S=new sh(y),this.compileAndRun(S,[a,l]))},c.prototype.depthwiseConv2DDerInput=function(a,l,y){var S=new function(U){this.variableNames=["dy","W"],this.outputShape=U.inShape;var G=U.filterHeight,ae=U.filterWidth,le=U.strideHeight,be=U.strideWidth,Se=G-1-U.padInfo.top,Ie=ae-1-U.padInfo.left,Me=U.outChannels/U.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+Se+", "+Ie+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+G+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+le+`.0;

          if (dyR < 0.0 || dyR >= `+U.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+G+` - 1 - wR;

          for (int wC = 0; wC < `+ae+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+be+`.0;

            if (dyC < 0.0 || dyC >= `+U.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+ae+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+Me+`; dm++) {
              int d2 = d1 * `+Me+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(S,[a,l])},c.prototype.depthwiseConv2DDerFilter=function(a,l,y){var S=new function(U){this.variableNames=["x","dy"],this.outputShape=U.filterShape;var G=U.strideHeight,ae=U.strideWidth,le=U.padInfo.top,be=U.padInfo.left,Se=U.outChannels/U.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+Se+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+U.batchSize+`; b++) {
          for (int yR = 0; yR < `+U.outHeight+`; yR++) {
            int xR = wR + yR * `+G+" - "+le+`;

            if (xR < 0 || xR >= `+U.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+U.outWidth+`; yC++) {
              int xC = wC + yC * `+ae+" - "+be+`;

              if (xC < 0 || xC >= `+U.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(S,[a,l])},c.prototype.conv3d=function(a,l,y){var S=new function(U){this.variableNames=["x","W"],this.outputShape=U.outShape;var G=U.padInfo.front,ae=U.padInfo.top,le=U.padInfo.left,be=U.strideDepth,Se=U.strideHeight,Ie=U.strideWidth,Me=U.dilationDepth,qe=U.dilationHeight,Ye=U.dilationWidth,Xe=U.filterDepth,at=U.filterHeight,gt=U.filterWidth,bt=4*Math.floor(U.inChannels/4),_t=U.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+be+", "+Se+", "+Ie+`);
      const ivec3 pads = ivec3(`+G+", "+ae+", "+le+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+Xe+`; wF++) {
          int xF = xFCorner + wF * `+Me+`;

          if (xF < 0 || xF >= `+U.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+at+`; wR++) {
            int xR = xRCorner + wR * `+qe+`;

            if (xR < 0 || xR >= `+U.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+gt+`; wC++) {
              int xC = xCCorner + wC * `+Ye+`;

              if (xC < 0 || xC >= `+U.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+bt+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(_t===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+bt+`) *
                  getW(wF, wR, wC, `+bt+`, d2);
              } else if (`+(_t===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+bt+`),
                  getX(batch, xF, xR, xC, `+bt+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+bt+`, d2),
                  getW(wF, wR, wC, `+bt+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(_t===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+bt+`),
                  getX(batch, xF, xR, xC, `+bt+` + 1),
                  getX(batch, xF, xR, xC, `+bt+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+bt+`, d2),
                  getW(wF, wR, wC, `+bt+` + 1, d2),
                  getW(wF, wR, wC, `+bt+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(S,[a,l])},c.prototype.conv3dDerInput=function(a,l,y){var S=new function(U){this.variableNames=["dy","W"],this.outputShape=U.inShape;var G=U.filterDepth,ae=U.filterHeight,le=U.filterWidth,be=U.strideDepth,Se=U.strideHeight,Ie=U.strideWidth,Me=G-1-U.padInfo.front,qe=ae-1-U.padInfo.top,Ye=le-1-U.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+Me+", "+qe+", "+Ye+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+G+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+be+`.0;

          if (dyF < 0.0 || dyF >= `+U.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+G+` - 1 - wF;

          for (int wR = 0; wR < `+ae+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+Se+`.0;

            if (dyR < 0.0 || dyR >= `+U.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+ae+` - 1 - wR;

            for (int wC = 0; wC < `+le+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+Ie+`.0;

              if (dyC < 0.0 || dyC >= `+U.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+le+` - 1 - wC;

              for (int d2 = 0; d2 < `+U.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(S,[a,l])},c.prototype.conv3dDerFilter=function(a,l,y){var S=new function(U){this.variableNames=["x","dy"],this.outputShape=U.filterShape;var G=U.strideDepth,ae=U.strideHeight,le=U.strideWidth,be=U.padInfo.front,Se=U.padInfo.top,Ie=U.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+U.batchSize+`; b++) {
          for (int yF = 0; yF < `+U.outDepth+`; yF++) {
            int xF = wF + yF * `+G+" - "+be+`;

            if (xF < 0 || xF >= `+U.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+U.outHeight+`; yR++) {
              int xR = wR + yR * `+ae+" - "+Se+`;

              if (xR < 0 || xR >= `+U.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+U.outWidth+`; yC++) {
                int xC = wC + yC * `+le+" - "+Ie+`;

                if (xC < 0 || xC >= `+U.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(S,[a,l])},c.prototype.maxPool=function(a,l){var y=new Od(l,"max",!1);return this.compileAndRun(y,[a])},c.prototype.avgPool=function(a,l){var y=new Od(l,"avg",!1);return this.compileAndRun(y,[a],"float32")},c.prototype.maxPoolBackprop=function(a,l,y,S){var U=new Od(S,"max",!0),G=this.compileAndRun(U,[l]),ae=new function(be){this.variableNames=["dy","maxPos"],this.outputShape=be.inShape;var Se=be.strideHeight,Ie=be.strideWidth,Me=be.dilationHeight,qe=be.effectiveFilterHeight,Ye=be.effectiveFilterWidth,Xe=qe-1-be.padInfo.top,at=Ye-1-be.padInfo.left,gt=qe*Ye-1;this.userCode=`
      const ivec2 pads = ivec2(`+Xe+", "+at+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+qe+`;
          wR += `+Me+`) {
          float dyR = float(dyRCorner + wR) / `+Se+`.0;

          if (dyR < 0.0 || dyR >= `+be.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+Ye+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+Ie+`.0;

            if (dyC < 0.0 || dyC >= `+be.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+gt+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+Ye+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}(S),le=this.compileAndRun(ae,[a,G],l.dtype);return G.dispose(),le},c.prototype.avgPoolBackprop=function(a,l,y){var S=new function(U){this.variableNames=["dy"],this.outputShape=U.inShape;var G=U.filterHeight,ae=U.filterWidth,le=U.strideHeight,be=U.strideWidth,Se=U.dilationHeight,Ie=U.dilationWidth,Me=U.effectiveFilterHeight,qe=U.effectiveFilterWidth,Ye=Me-1-U.padInfo.top,Xe=qe-1-U.padInfo.left,at=1/(G*ae);this.userCode=`
      const ivec2 pads = ivec2(`+Ye+", "+Xe+`);
      const float avgMultiplier = float(`+at+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+Me+`;
            wR += `+Se+`) {
          float dyR = float(dyRCorner + wR) / `+le+`.0;

          if (dyR < 0.0 || dyR >= `+U.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+qe+`;
            wC+= `+Ie+`) {
            float dyC = float(dyCCorner + wC) / `+be+`.0;

            if (dyC < 0.0 || dyC >= `+U.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(S,[a],l.dtype)},c.prototype.cast=function(a,l){return pi(a,l,this)},c.prototype.unstack=function(a,l){for(var y=a.shape[l],S=new Array(a.rank-1),U=0,G=0;G<a.rank;G++)G!==l&&(S[U++]=a.shape[G]);var ae=new Array(a.rank).fill(0),le=a.shape.slice();le[l]=1;var be=new Array(y);for(G=0;G<be.length;G++)ae[l]=G,be[G]=this.slice(a,ae,le).reshape(S);return be},c.prototype.avgPool3d=function(a,l){var y=new Sd(l,"avg",!1);return this.compileAndRun(y,[a],"float32")},c.prototype.avgPool3dBackprop=function(a,l,y){var S=new function(U){this.variableNames=["dy"],this.outputShape=U.inShape;var G=U.filterDepth,ae=U.filterHeight,le=U.filterWidth,be=U.strideDepth,Se=U.strideHeight,Ie=U.strideWidth,Me=U.dilationDepth,qe=U.dilationHeight,Ye=U.dilationWidth,Xe=U.effectiveFilterDepth,at=U.effectiveFilterHeight,gt=U.effectiveFilterWidth,bt=Xe-1-U.padInfo.front,_t=at-1-U.padInfo.top,jt=gt-1-U.padInfo.left,Qt=1/(G*ae*le);this.userCode=`
      const ivec3 pads = ivec3(`+bt+", "+_t+", "+jt+`);
      const float avgMultiplier = float(`+Qt+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+Xe+`;
            wD += `+Me+`) {
          float dyD = float(dyDCorner + wD) / `+be+`.0;

          if (dyD < 0.0 || dyD >= `+U.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+at+`;
              wR += `+qe+`) {
            float dyR = float(dyRCorner + wR) / `+Se+`.0;

            if (dyR < 0.0 || dyR >= `+U.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+gt+`;
                wC += `+Ye+`) {
              float dyC = float(dyCCorner + wC) / `+Ie+`.0;

              if (dyC < 0.0 || dyC >= `+U.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(y);return this.compileAndRun(S,[a],l.dtype)},c.prototype.maxPool3d=function(a,l){var y=new Sd(l,"max",!1);return this.compileAndRun(y,[a],"float32")},c.prototype.maxPool3dBackprop=function(a,l,y,S){var U=new Sd(S,"max",!0),G=this.compileAndRun(U,[l]),ae=new function(be){this.variableNames=["dy","maxPos"],this.outputShape=be.inShape;var Se=be.strideDepth,Ie=be.strideHeight,Me=be.strideWidth,qe=be.dilationDepth,Ye=be.dilationHeight,Xe=be.dilationWidth,at=be.effectiveFilterDepth,gt=be.effectiveFilterHeight,bt=be.effectiveFilterWidth,_t=at-1-be.padInfo.front,jt=gt-1-be.padInfo.top,Qt=bt-1-be.padInfo.left,sn=at*gt*bt-1;this.userCode=`
      const ivec3 pads = ivec3(`+_t+", "+jt+", "+Qt+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+at+`;
           wD += `+qe+`) {
          float dyD = float(dyDCorner + wD) / `+Se+`.0;

          if (dyD < 0.0 || dyD >= `+be.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+gt+`;
              wR += `+Ye+`) {
            float dyR = float(dyRCorner + wR) / `+Ie+`.0;

            if (dyR < 0.0 || dyR >= `+be.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+bt+`;
                wC += `+Xe+`) {
              float dyC = float(dyCCorner + wC) / `+Me+`.0;

              if (dyC < 0.0 || dyC >= `+be.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+sn+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+gt+" * "+bt+` +
                  wR * `+bt+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(S),le=this.compileAndRun(ae,[a,G],l.dtype);return G.dispose(),le},c.prototype.reshape=function(a,l){var y=this.texData.get(a.dataId);if(y.isPacked&&!eu(a.shape,l)&&(y.texture===null||!eu(y.shape,l))){var S=this.packedReshape(a,l);return He.makeTensorFromDataId(S.dataId,S.shape,S.dtype)}return Pi(a,l)},c.prototype.resizeBilinear=function(a,l,y,S){var U=W().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new function(G,ae,le,be){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var Se=G[0],Ie=G[1],Me=G[2],qe=G[3];this.outputShape=[Se,ae,le,qe];var Ye=[be&&ae>1?Ie-1:Ie,be&&le>1?Me-1:Me],Xe=[be&&ae>1?ae-1:ae,be&&le>1?le-1:le];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+Ye[0]/Xe[0]+`,
          `+Ye[1]/Xe[1]+`,
          `+Ye[1]/Xe[1]+`);
      const vec3 inputShapeRC = vec3(`+Ie+".0, "+Me+`.0,
                                     `+Me+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(qe-1)+`;
        bool hasNextRow = coords.z < `+(le-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}(a.shape,l,y,S):new function(G,ae,le,be){this.variableNames=["A"],this.outputShape=[];var Se=G[0],Ie=G[1],Me=G[2],qe=G[3];this.outputShape=[Se,ae,le,qe];var Ye=[be&&ae>1?Ie-1:Ie,be&&le>1?Me-1:Me],Xe=[be&&ae>1?ae-1:ae,be&&le>1?le-1:le];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+Ye[0]/Xe[0]+`,
          `+Ye[1]/Xe[1]+`);
      const vec2 inputShapeRC = vec2(`+Ie+".0, "+Me+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}(a.shape,l,y,S);return this.compileAndRun(U,[a],"float32")},c.prototype.resizeBilinearBackprop=function(a,l,y){var S=new function(U,G,ae){this.variableNames=["dy"],this.outputShape=[],this.outputShape=G.shape;var le=G.shape,be=le[1],Se=le[2],Ie=U.shape,Me=Ie[1],qe=Ie[2],Ye=[ae&&Me>1?be-1:be,ae&&qe>1?Se-1:Se],Xe=[ae&&Me>1?Me-1:Me,ae&&qe>1?qe-1:qe],at=Ye[0]/Xe[0],gt=Ye[1]/Xe[1],bt=1/at,_t=1/gt,jt=2*Math.ceil(bt)+2,Qt=2*Math.ceil(_t)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+at+`);
        const float widthScale = float(`+gt+`);

        const float invHeightScale = float(`+bt+`);
        const float invWidthScale = float(`+_t+`);

        const int winHeight = int(`+jt+`);
        const int winWidth = int(`+Qt+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+Me+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+qe+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(be-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(Se-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}(a,l,y);return this.compileAndRun(S,[a])},c.prototype.resizeNearestNeighbor=function(a,l,y,S){var U=new function(G,ae,le,be){this.variableNames=["A"],this.outputShape=[];var Se=G[0],Ie=G[1],Me=G[2],qe=G[3];this.outputShape=[Se,ae,le,qe];var Ye=[be&&ae>1?Ie-1:Ie,be&&le>1?Me-1:Me],Xe=[be&&ae>1?ae-1:ae,be&&le>1?le-1:le],at=be?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+Ye[0]/Xe[0]+`,
          `+Ye[1]/Xe[1]+`);
      const vec2 inputShapeRC = vec2(`+Ie+".0, "+Me+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+at+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}(a.shape,l,y,S);return this.compileAndRun(U,[a])},c.prototype.resizeNearestNeighborBackprop=function(a,l,y){var S=new function(U,G,ae){this.variableNames=["dy"],this.outputShape=[],this.outputShape=G.shape;var le=G.shape,be=le[1],Se=le[2],Ie=U.shape,Me=Ie[1],qe=Ie[2],Ye=[ae&&Me>1?be-1:be,ae&&qe>1?Se-1:Se],Xe=[ae&&Me>1?Me-1:Me,ae&&qe>1?qe-1:qe],at=Ye[0]/Xe[0],gt=Ye[1]/Xe[1],bt=1/at,_t=1/gt,jt=2*Math.ceil(bt)+2,Qt=2*Math.ceil(_t)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+at+`);
        const float widthScale = float(`+gt+`);

        const float invHeightScale = float(`+bt+`);
        const float invWidthScale = float(`+_t+`);

        const int winHeight = int(`+jt+`);
        const int winWidth = int(`+Qt+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+Me+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+qe+`) {
              continue;
            }

            float sourceFracRow =
              float(`+Ye[0]+`) *
                (float(dyR) / float(`+Xe[0]+`));

            float sourceFracCol =
                float(`+Ye[1]+`) *
                  (float(dyC) / float(`+Xe[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+be+`) - 1),
                `+ae+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+Se+`) - 1),
                `+ae+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}(a,l,y);return this.compileAndRun(S,[a])},c.prototype.multinomial=function(a,l,y,S){var U=l?a:Ue(a),G=U.shape[0],ae=U.shape[1],le=new Zp(G,ae,y),be=le.getCustomSetupFunc(S);return this.compileAndRun(le,[U],"int32",be)},c.prototype.oneHot=function(a,l,y,S){var U=new function(G,ae,le,be){this.variableNames=["indices"],this.outputShape=[G,ae],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+be+"), float("+le+`),
                      float(index == coords.y)));
      }
    `}(a.size,l,y,S);return this.compileAndRun(U,[a])},c.prototype.diag=function(a){var l=new function(y){this.variableNames=["X"],this.outputShape=[y,y],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}(a.size);return this.compileAndRun(l,[a])},c.prototype.nonMaxSuppression=function(a,l,y,S,U){return Jf("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),zo(a.dataSync(),l.dataSync(),y,S,U)},c.prototype.cropAndResize=function(a,l,y,S,U,G){var ae=new function(le,be,Se,Ie,Me){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var qe=le[0],Ye=le[1],Xe=le[2],at=le[3],gt=be[0],bt=Se[0],_t=Se[1];this.outputShape=[gt,bt,_t,at];var jt=Ie==="bilinear"?1:0,Qt=[Ye-1+".0",Xe-1+".0"],sn=Qt[0],Zt=Qt[1],rn=bt>1?[""+(Ye-1)/(bt-1),"(y2-y1) * height_ratio","y1*"+sn+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+sn],Sn=rn[0],Bn=rn[1],Mn=rn[2],fr=_t>1?[""+(Xe-1)/(_t-1),"(x2-x1) * width_ratio","x1*"+Zt+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+Zt],yr=fr[0],Cr=fr[1],Nr=fr[2];this.userCode=`
      const float height_ratio = float(`+Sn+`);
      const float width_ratio = float(`+yr+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+qe+`) {
          return;
        }

        float height_scale = `+Bn+`;
        float width_scale = `+Cr+`;

        float in_y = `+Mn+`;
        if( in_y < 0.0 || in_y > `+sn+` ) {
          setOutput(float(`+Me+`));
          return;
        }
        float in_x = `+Nr+`;
        if( in_x < 0.0 || in_x > `+Zt+` ) {
          setOutput(float(`+Me+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+jt+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}(a.shape,l.shape,S,U,G);return this.compileAndRun(ae,[a,l,y],"float32")},c.prototype.depthToSpace=function(a,l,y){Ce(l>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+l});var S=a.shape[0],U=y==="NHWC"?a.shape[1]:a.shape[2],G=y==="NHWC"?a.shape[2]:a.shape[3],ae=y==="NHWC"?a.shape[3]:a.shape[1],le=U*l,be=G*l,Se=ae/(l*l),Ie=new Bm(y==="NHWC"?[S,le,be,Se]:[S,Se,le,be],l,y);return this.compileAndRun(Ie,[a])},c.prototype.split=function(a,l,y){return Pa(a,l,y)},c.prototype.scatterND=function(a,l,y){var S=hc(0,a,y),U=S.sliceRank,G=S.numUpdates,ae=S.sliceSize,le=S.strides,be=S.outputSize,Se=[be/ae,ae],Ie=a.reshape([G,U]),Me=l.reshape([G,ae]);if(be===0)return Pi(la([]),y);var qe=Mr(0),Ye=new Ng(G,U,Ie.rank,Me.rank,le,Se);return this.compileAndRun(Ye,[Me,Ie,qe]).reshape(y)},c.prototype.sparseToDense=function(a,l,y,S){var U=hc(0,a,y),G=U.sliceRank,ae=U.numUpdates,le=U.strides,be=U.outputSize,Se=new Ng(ae,G,a.rank,l.rank,le,[be,1]);return this.compileAndRun(Se,[l,a,S]).reshape(y)},c.prototype.fft=function(a){return this.fftImpl(a,!1)},c.prototype.ifft=function(a){return this.fftImpl(a,!0)},c.prototype.fftImpl=function(a,l){var y=this.texData.get(a.dataId),S=new Pm("return real * expR - imag * expI;",a.shape,l),U=new Pm("return real * expI + imag * expR;",a.shape,l),G=[this.makeComplexComponentTensorInfo(a,y.complexTensors.real),this.makeComplexComponentTensorInfo(a,y.complexTensors.imag)],ae=this.compileAndRun(S,G),le=this.compileAndRun(U,G),be=this.complex(ae,le).as2D(a.shape[0],a.shape[1]);return ae.dispose(),le.dispose(),be},c.prototype.gatherND=function(a,l){var y=l.shape,S=y[y.length-1],U=iu(a,l),G=U[0],ae=U[1],le=U[2],be=U[3],Se=l.reshape([ae,S]),Ie=a.reshape([a.size/le,le]),Me=new function(qe,Ye,Xe){this.sliceDim=qe,this.strides=Ye,this.variableNames=["x","indices"],this.outputShape=Xe;var at=Da(Ye.length),gt=Da(Xe.length),bt=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+at+" strides = "+at+"("+this.strides+`);
         void main() {
          `+gt+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+bt+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}(S,be,[ae,le]);return this.compileAndRun(Me,[Ie,Se]).reshape(G)},c.prototype.fill=function(a,l,y){if((y=y||we(l))==="string"){var S=pn(y,Qe(a));return S.fill(l),He.makeTensor(S,a,y,this)}var U=new Kp(a,l),G=U.getCustomSetupFunc(l);return this.compileAndRun(U,[],y,G)},c.prototype.onesLike=function(a){if(a.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(a.shape,1,a.dtype)},c.prototype.zerosLike=function(a){return this.fill(a.shape,a.dtype==="string"?"":0,a.dtype)},c.prototype.linspace=function(a,l,y){return qi(a,l,y)},c.prototype.makeTensorInfo=function(a,l){var y=this.write(null,a,l);return this.texData.get(y).usage=null,{dataId:y,shape:a,dtype:l}},c.prototype.makeOutput=function(a,l){var y=this.makeTensorInfo(a,l).dataId;return He.makeTensorFromDataId(y,a,l,this)},c.prototype.unpackTensor=function(a){var l=new function(y){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=y;var S=y.length,U=Cs("rc",S),G=Da(S),ae=function(Se,Ie){if(Se===1)return"rc";for(var Me="",qe=0;qe<Se;qe++)Me+=Ie[qe],qe<Se-1&&(Me+=",");return Me}(S,U),le=U.slice(-2),be=S<=1?"rc":"vec2("+le.join(",")+")";this.userCode=`
      void main() {
        `+G+` rc = getOutputCoords();
        vec4 packedInput = getA(`+ae+`);

        setOutput(getChannel(packedInput, `+be+`));
      }
    `}(a.shape);return this.runWebGLProgram(l,[a],a.dtype)},c.prototype.packTensor=function(a){var l=new function(y){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=y;var S=y.length;if(S===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var U=Cs("rc",S),G=Da(S),ae=function(Se,Ie,Me){if(Se===1)return"rc > "+Ie[0];for(var qe="",Ye=Se-2;Ye<Se;Ye++)qe+=Me[Ye]+" >= "+Ie[Ye],Ye<Se-1&&(qe+="||");return qe}(S,y,U),le=function(Se,Ie,Me,qe){if(Se===1)return"";var Ye=qe.slice(-2);return`
    int r = `+Ye[0]+`;
    int c = `+Ye[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+Ie+`;
    bool rEdge = rp1 >= `+Me+`;
  `}(S,y[y.length-1],y[y.length-2],U),be=function(Se,Ie){var Me=Se.length,qe=function(Ye,Xe){for(var at=[],gt=0;gt<=1;gt++)for(var bt=0;bt<=1;bt++){for(var _t=(gt===0?"r":"rp1")+", "+(bt===0?"c":"cp1"),jt=2;jt<Ye;jt++)_t=Xe[Xe.length-1-jt]+","+_t;at.push(_t)}return at}(Me,Ie);return Me===1?`getA(rc),
            rc + 1 >= `+Se[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+qe[0]+`),
          cEdge ? 0. : getA(`+qe[1]+`),
          rEdge ? 0. : getA(`+qe[2]+`),
          rEdge || cEdge ? 0. : getA(`+qe[3]+")"}(y,U);this.userCode=`
        void main() {
          `+G+` rc = getOutputCoords();

          if(`+ae+`) {
            setOutput(vec4(0));
          } else {
            `+le+`

            setOutput(vec4(`+be+`));
          }
        }
      `}}(a.shape);return this.runWebGLProgram(l,[a],a.dtype,null,!0)},c.prototype.packedReshape=function(a,l){var y=[Is(a.shape)].concat(Ba(a.shape)),S={dtype:a.dtype,shape:y,dataId:a.dataId},U=new function(ae,le){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ae;for(var be="",Se=0;Se<4;Se++){var Ie="thisRC = rc;";Se%2==1&&(Ie+="thisRC.z += 1;"),Se>1&&(Ie+="thisRC.y += 1;"),be+=`
        `+Ie+`
        `+(Se>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+Se+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(Se>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+_s(["r","c","d"],le)+`
      return ivec3(r, c, d);
    }
  
      `+_l(ae)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+ae[1]+`;
        int cols = `+ae[2]+`;

        `+be+`

        setOutput(result);
      }
    `}([Is(l)].concat(Ba(l)),y),G=this.runWebGLProgram(U,[S],a.dtype,null,!0);return{dataId:G.dataId,shape:l,dtype:G.dtype}},c.prototype.decode=function(a){var l,y=this.texData.get(a),S=y.isPacked,U=y.shape,G=y.dtype,ae=jc(U);return l=S?new function(le){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=pr.DENSE;var be=$i(le),Se=fa();this.outputShape=le,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+_s(["r","c","d"],le)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+be[0]+", "+be[1]+`));
        int index = 4 * (resTexRC.x * `+be[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+Se.output+` = result;
      }
    `}(ae):new function(le){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=pr.DENSE;var be=$i(le),Se=fa();this.outputShape=le,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+_s(["r","c","d"],le)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+be[0]+", "+be[1]+`));
        int index = 4 * (resTexRC.x * `+be[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+Se.output+` = result;
      }
    `}(ae),{dtype:G,shape:U,dataId:this.runWebGLProgram(l,[{shape:ae,dtype:G,dataId:a}],G,null,!0).dataId}},c.prototype.runWebGLProgram=function(a,l,y,S,U){var G=this;U===void 0&&(U=!1);var ae=this.makeTensorInfo(a.outputShape,y),le=this.texData.get(ae.dataId);if(a.packedOutput&&(le.isPacked=!0),a.outPackingScheme===pr.DENSE){var be=$i(a.outputShape);le.texShape=be.map(function(bt){return 2*bt})}if(a.outTexUsage!=null&&(le.usage=a.outTexUsage),Qe(ae.shape)===0)return le.values=tr(ae.dtype,0),ae;var Se=[],Ie=l.map(function(bt){if(bt.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var _t=G.texData.get(bt.dataId);if(_t.texture==null){if(!a.packedInputs&&Qe(bt.shape)<=W().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:bt.shape,texData:null,isUniform:!0,uniformValues:_t.values};a.packedInputs&&(_t.isPacked=!0,_t.shape=bt.shape)}else if(!!_t.isPacked!=!!a.packedInputs)bt=_t.isPacked?G.unpackTensor(bt):G.packTensor(bt),Se.push(bt),_t=G.texData.get(bt.dataId);else if(_t.isPacked&&!eu(_t.shape,bt.shape)){var jt=bt,Qt=bt.shape;bt.shape=_t.shape,bt=G.packedReshape(bt,Qt),Se.push(bt),_t=G.texData.get(bt.dataId),jt.shape=Qt}return G.uploadToGPU(bt.dataId),{shape:bt.shape,texData:_t,isUniform:!1}});this.uploadToGPU(ae.dataId);var Me,qe={shape:ae.shape,texData:le,isUniform:!1},Ye=function(bt,_t,jt){var Qt="";Ie.concat(jt).forEach(function(Zt){var rn=Zt.texData!=null&&Zt.texData.slice!=null&&Zt.texData.slice.flatOffset>0,Sn=Zt.isUniform?"uniform":Zt.texData.texShape;Qt+=Zt.shape+"_"+Sn+"_"+rn});var sn=bt.userCode;return bt.constructor.name+"_"+Qt+"_"+sn}(a,0,qe),Xe=this.getAndSaveBinary(Ye,function(){return function(bt,_t,jt,Qt){var sn=_t.userCode,Zt=jt.map(function(_r,Yr){var Kr={logicalShape:_r.shape,texShape:_r.isUniform?null:_r.texData.texShape,isUniform:_r.isUniform,isPacked:!_r.isUniform&&_r.texData.isPacked,flatOffset:null};return _r.texData!=null&&_r.texData.slice!=null&&_r.texData.slice.flatOffset>0&&(Kr.flatOffset=_r.texData.slice.flatOffset),{name:_t.variableNames[Yr],shapeInfo:Kr}}),rn=Zt.map(function(_r){return _r.shapeInfo}),Sn={logicalShape:Qt.shape,texShape:Qt.texData.texShape,isUniform:!1,isPacked:Qt.texData.isPacked,flatOffset:null},Bn=Bs(Zt,Sn,sn,_t.packedInputs),Mn=bt.createProgram(Bn),fr=null,yr=bt.getUniformLocation(Mn,"NAN",!1);W().getNumber("WEBGL_VERSION")===1&&(fr=bt.getUniformLocation(Mn,"INFINITY",!1));for(var Cr={},Nr=0;Nr<_t.variableNames.length;Nr++){var Ar=_t.variableNames[Nr];Cr[Ar]=bt.getUniformLocation(Mn,Ar,!1),Cr["offset"+Ar]=bt.getUniformLocation(Mn,"offset"+Ar,!1)}return{program:_t,source:Bn,webGLProgram:Mn,uniformLocations:Cr,inShapeInfos:rn,outShapeInfo:Sn,infLoc:fr,nanLoc:yr}}(G.gpgpu,a,Ie,qe)}),at=this.activeTimers!=null;if(at&&(Me=this.startTimer()),function(bt,_t,jt,Qt,sn){ap(_t.inShapeInfos,jt),ap([_t.outShapeInfo],[Qt]);var Zt=Qt.texData.texture,rn=Qt.texData.texShape;Qt.texData.isPacked?bt.setOutputPackedMatrixTexture(Zt,rn[0],rn[1]):bt.setOutputMatrixTexture(Zt,rn[0],rn[1]),bt.setProgram(_t.webGLProgram),W().getNumber("WEBGL_VERSION")===1&&_t.infLoc!==null&&bt.gl.uniform1f(_t.infLoc,1/0),_t.nanLoc!==null&&bt.gl.uniform1f(_t.nanLoc,NaN),jt.forEach(function(Sn,Bn){var Mn=_t.program.variableNames[Bn],fr=_t.uniformLocations[Mn],yr=_t.uniformLocations["offset"+Mn];if(fr!=null)if(Sn.isUniform)if(Qe(Sn.shape)<2)bt.gl.uniform1f(fr,Sn.uniformValues[0]);else{var Cr=Sn.uniformValues;Cr instanceof Float32Array||(Cr=new Float32Array(Cr)),bt.gl.uniform1fv(fr,Cr)}else Sn.texData.slice!=null&&yr!=null&&bt.gl.uniform1i(yr,Sn.texData.slice.flatOffset),bt.setInputMatrixTexture(Sn.texData.texture,fr,Bn)}),sn!=null&&sn(bt,_t.webGLProgram),bt.executeProgram()}(this.gpgpu,Xe,Ie,qe,S),Se.forEach(function(bt){return G.disposeData(bt.dataId)}),at&&(Me=this.endTimer(Me),this.activeTimers.push({name:a.constructor.name,query:this.getQueryTime(Me)})),!W().getBool("WEBGL_LAZILY_UNPACK")&&le.isPacked&&U===!1){var gt=this.unpackTensor(ae);return this.disposeData(ae.dataId),gt}return ae},c.prototype.compileAndRun=function(a,l,y,S,U){U===void 0&&(U=!1),y=y||l[0].dtype;var G=this.runWebGLProgram(a,l,y,S,U);return He.makeTensorFromDataId(G.dataId,G.shape,G.dtype)},c.prototype.getAndSaveBinary=function(a,l){return a in this.binaryCache||(this.binaryCache[a]=l()),this.binaryCache[a]},c.prototype.getTextureManager=function(){return this.textureManager},c.prototype.dispose=function(){var a=this;this.disposed||(W().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(l){a.gpgpu.deleteProgram(a.binaryCache[l].webGLProgram),delete a.binaryCache[l]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement!="undefined"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},c.prototype.floatPrecision=function(){var a=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=so(function(){if(!W().get("WEBGL_RENDER_FLOAT32_ENABLED")){var l=W().getBool("DEBUG");W().set("DEBUG",!1);var y=a.abs(Mr(1e-8)).dataSync()[0];if(W().set("DEBUG",l),y>0)return 32}return 16})),this.floatPrecisionValue},c.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},c.prototype.uploadToGPU=function(a){var l,y=this.texData.get(a),S=y.shape,U=y.dtype,G=y.values,ae=y.texture,le=y.usage,be=y.isPacked;if(ae==null){var Se,Ie=this.activeTimers!=null;Ie&&(Se=an());var Me=y.texShape;if(Me==null&&(Me=ac(S,be),y.texShape=Me),G!=null){var qe=jc(S),Ye=void 0,Xe=Me[1],at=Me[0],gt=G instanceof Uint8Array;be?(Xe=(l=mi(Me[0],Me[1]))[0],Ye=new function(sn,Zt,rn){rn===void 0&&(rn=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var Sn=fa(),Bn=Zt[0],Mn=Zt[1];this.outputShape=sn;var fr="",yr="result";rn&&(yr="floor(result * 255. + 0.5)");for(var Cr=0;Cr<=1;Cr++)for(var Nr=0;Nr<=1;Nr++){var Ar=2*Cr+Nr;fr+=`
          localCoords = coords;
          if(localCoords[2] + `+Nr+" < "+sn[2]+`) {
            localCoords[2] += `+Nr+`;
            if(localCoords[1] + `+Cr+" < "+sn[1]+`) {
              localCoords[1] += `+Cr+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+Mn+`;
              c = imod(flatIndex, `+Mn+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+Mn+".0, "+Bn+`.0);
              values = `+Sn.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+Ar+`] = values[0];
              } else if(offset == 1) {
                result[`+Ar+`] = values[1];
              } else if(offset == 2) {
                result[`+Ar+`] = values[2];
              } else {
                result[`+Ar+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+_l(sn)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+fr+`

        `+Sn.output+" = "+yr+`;
      }
    `}(qe,[at=l[1],Xe],gt)):Ye=new function(sn,Zt,rn){rn===void 0&&(rn=!1),this.variableNames=["A"];var Sn=fa(),Bn=Zt[0],Mn=Zt[1];this.outputShape=sn;var fr="result";rn&&(fr="floor(result * 255. + 0.5)"),this.userCode=`
      `+_l(sn)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+Mn+`;
        int c = imod(flatIndex, `+Mn+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+Mn+".0, "+Bn+`.0);
        vec4 values = `+Sn.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+Sn.output+" = vec4("+fr+`, 0., 0., 0.);
      }
    `}(qe,[at,Xe],gt);var bt=this.makeTensorInfo([at,Xe],U);this.texData.get(bt.dataId).usage=gt?kr.PIXELS:kr.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(bt.dataId),Xe,at,G);var _t=this.runWebGLProgram(Ye,[bt],U,null,!0),jt=this.texData.get(_t.dataId);y.texture=jt.texture,y.texShape=jt.texShape,y.isPacked=jt.isPacked,y.usage=jt.usage,this.disposeData(bt.dataId),this.texData.delete(_t.dataId),y.values=null,Ie&&(this.uploadWaitMs+=an()-Se)}else{var Qt=this.acquireTexture(Me,le,U,be);y.texture=Qt}}},c.prototype.convertAndCacheOnCPU=function(a,l){var y=this.texData.get(a),S=y.dtype;return this.releaseGPUData(a),l!=null&&(y.values=function(U,G){if(G==="float32"||G==="complex64")return U;if(G==="int32"||G==="bool"){for(var ae=G==="int32"?new Int32Array(U.length):new Uint8Array(U.length),le=0;le<ae.length;++le)ae[le]=Math.round(U[le]);return ae}throw new Error("Unknown dtype "+G)}(l,S)),y.values},c.prototype.acquireTexture=function(a,l,y,S){if(this.numBytesInGPU+=this.computeBytes(a,y),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var U=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+U+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(a,l,S)},c.prototype.computeBytes=function(a,l){return a[0]*a[1]*Dt(l)},c}(Jt);function al(p,c){return p(c={exports:{}},c.exports),c.exports}$n()&&He.registerBackend("webgl",function(){return new Td},2);var Lc=al(function(p){(function(c,a,l){function y(U,G){return G.c=U.c,G.s0=U.s0,G.s1=U.s1,G.s2=U.s2,G}function S(U,G){var ae=new function(Se){var Ie,Me=this,qe=(Ie=4022871197,function(Ye){Ye=Ye.toString();for(var Xe=0;Xe<Ye.length;Xe++){var at=.02519603282416938*(Ie+=Ye.charCodeAt(Xe));at-=Ie=at>>>0,Ie=(at*=Ie)>>>0,Ie+=4294967296*(at-=Ie)}return 23283064365386963e-26*(Ie>>>0)});Me.next=function(){var Ye=2091639*Me.s0+23283064365386963e-26*Me.c;return Me.s0=Me.s1,Me.s1=Me.s2,Me.s2=Ye-(Me.c=0|Ye)},Me.c=1,Me.s0=qe(" "),Me.s1=qe(" "),Me.s2=qe(" "),Me.s0-=qe(Se),Me.s0<0&&(Me.s0+=1),Me.s1-=qe(Se),Me.s1<0&&(Me.s1+=1),Me.s2-=qe(Se),Me.s2<0&&(Me.s2+=1),qe=null}(U),le=G&&G.state,be=ae.next;return be.int32=function(){return 4294967296*ae.next()|0},be.double=function(){return be()+11102230246251565e-32*(2097152*be()|0)},be.quick=be,le&&(typeof le=="object"&&y(le,ae),be.state=function(){return y(ae,{})}),be}a&&a.exports?a.exports=S:this.alea=S})(0,p)}),Vm=al(function(p){(function(c,a,l){function y(U,G){return G.x=U.x,G.y=U.y,G.z=U.z,G.w=U.w,G}function S(U,G){var ae=new function(Se){var Ie=this,Me="";Ie.x=0,Ie.y=0,Ie.z=0,Ie.w=0,Ie.next=function(){var Ye=Ie.x^Ie.x<<11;return Ie.x=Ie.y,Ie.y=Ie.z,Ie.z=Ie.w,Ie.w^=Ie.w>>>19^Ye^Ye>>>8},Se===(0|Se)?Ie.x=Se:Me+=Se;for(var qe=0;qe<Me.length+64;qe++)Ie.x^=0|Me.charCodeAt(qe),Ie.next()}(U),le=G&&G.state,be=function(){return(ae.next()>>>0)/4294967296};return be.double=function(){do var Se=((ae.next()>>>11)+(ae.next()>>>0)/4294967296)/2097152;while(Se===0);return Se},be.int32=ae.next,be.quick=be,le&&(typeof le=="object"&&y(le,ae),be.state=function(){return y(ae,{})}),be}a&&a.exports?a.exports=S:this.xor128=S})(0,p)}),Gh=al(function(p){(function(c,a,l){function y(U,G){return G.x=U.x,G.y=U.y,G.z=U.z,G.w=U.w,G.v=U.v,G.d=U.d,G}function S(U,G){var ae=new function(Se){var Ie=this,Me="";Ie.next=function(){var Ye=Ie.x^Ie.x>>>2;return Ie.x=Ie.y,Ie.y=Ie.z,Ie.z=Ie.w,Ie.w=Ie.v,(Ie.d=Ie.d+362437|0)+(Ie.v=Ie.v^Ie.v<<4^Ye^Ye<<1)|0},Ie.x=0,Ie.y=0,Ie.z=0,Ie.w=0,Ie.v=0,Se===(0|Se)?Ie.x=Se:Me+=Se;for(var qe=0;qe<Me.length+64;qe++)Ie.x^=0|Me.charCodeAt(qe),qe==Me.length&&(Ie.d=Ie.x<<10^Ie.x>>>4),Ie.next()}(U),le=G&&G.state,be=function(){return(ae.next()>>>0)/4294967296};return be.double=function(){do var Se=((ae.next()>>>11)+(ae.next()>>>0)/4294967296)/2097152;while(Se===0);return Se},be.int32=ae.next,be.quick=be,le&&(typeof le=="object"&&y(le,ae),be.state=function(){return y(ae,{})}),be}a&&a.exports?a.exports=S:this.xorwow=S})(0,p)}),Pg=al(function(p){(function(c,a,l){function y(U,G){return G.x=U.x.slice(),G.i=U.i,G}function S(U,G){U==null&&(U=+new Date);var ae=new function(Se){var Ie=this;Ie.next=function(){var Me,qe,Ye=Ie.x,Xe=Ie.i;return Me=Ye[Xe],qe=(Me^=Me>>>7)^Me<<24,qe^=(Me=Ye[Xe+1&7])^Me>>>10,qe^=(Me=Ye[Xe+3&7])^Me>>>3,qe^=(Me=Ye[Xe+4&7])^Me<<7,Me=Ye[Xe+7&7],qe^=(Me^=Me<<13)^Me<<9,Ye[Xe]=qe,Ie.i=Xe+1&7,qe},function(Me,qe){var Ye,Xe=[];if(qe===(0|qe))Xe[0]=qe;else for(qe=""+qe,Ye=0;Ye<qe.length;++Ye)Xe[7&Ye]=Xe[7&Ye]<<15^qe.charCodeAt(Ye)+Xe[Ye+1&7]<<13;for(;Xe.length<8;)Xe.push(0);for(Ye=0;Ye<8&&Xe[Ye]===0;++Ye);for(Ye==8?Xe[7]=-1:Xe[Ye],Me.x=Xe,Me.i=0,Ye=256;Ye>0;--Ye)Me.next()}(Ie,Se)}(U),le=G&&G.state,be=function(){return(ae.next()>>>0)/4294967296};return be.double=function(){do var Se=((ae.next()>>>11)+(ae.next()>>>0)/4294967296)/2097152;while(Se===0);return Se},be.int32=ae.next,be.quick=be,le&&(le.x&&y(le,ae),be.state=function(){return y(ae,{})}),be}a&&a.exports?a.exports=S:this.xorshift7=S})(0,p)}),G0=al(function(p){(function(c,a,l){function y(U,G){return G.i=U.i,G.w=U.w,G.X=U.X.slice(),G}function S(U,G){U==null&&(U=+new Date);var ae=new function(Se){var Ie=this;Ie.next=function(){var Me,qe,Ye=Ie.w,Xe=Ie.X,at=Ie.i;return Ie.w=Ye=Ye+1640531527|0,qe=Xe[at+34&127],Me=Xe[at=at+1&127],qe^=qe<<13,Me^=Me<<17,qe^=qe>>>15,Me^=Me>>>12,qe=Xe[at]=qe^Me,Ie.i=at,qe+(Ye^Ye>>>16)|0},function(Me,qe){var Ye,Xe,at,gt,bt,_t=[],jt=128;for(qe===(0|qe)?(Xe=qe,qe=null):(qe+="\0",Xe=0,jt=Math.max(jt,qe.length)),at=0,gt=-32;gt<jt;++gt)qe&&(Xe^=qe.charCodeAt((gt+32)%qe.length)),gt===0&&(bt=Xe),Xe^=Xe<<10,Xe^=Xe>>>15,Xe^=Xe<<4,Xe^=Xe>>>13,gt>=0&&(bt=bt+1640531527|0,at=(Ye=_t[127&gt]^=Xe+bt)==0?at+1:0);for(at>=128&&(_t[127&(qe&&qe.length||0)]=-1),at=127,gt=512;gt>0;--gt)Xe=_t[at+34&127],Ye=_t[at=at+1&127],Xe^=Xe<<13,Ye^=Ye<<17,Xe^=Xe>>>15,Ye^=Ye>>>12,_t[at]=Xe^Ye;Me.w=bt,Me.X=_t,Me.i=at}(Ie,Se)}(U),le=G&&G.state,be=function(){return(ae.next()>>>0)/4294967296};return be.double=function(){do var Se=((ae.next()>>>11)+(ae.next()>>>0)/4294967296)/2097152;while(Se===0);return Se},be.int32=ae.next,be.quick=be,le&&(le.X&&y(le,ae),be.state=function(){return y(ae,{})}),be}a&&a.exports?a.exports=S:this.xor4096=S})(0,p)}),qm=al(function(p){(function(c,a,l){function y(U,G){return G.a=U.a,G.b=U.b,G.c=U.c,G.d=U.d,G}function S(U,G){var ae=new function(Se){var Ie=this,Me="";Ie.next=function(){var Ye=Ie.b,Xe=Ie.c,at=Ie.d,gt=Ie.a;return Ye=Ye<<25^Ye>>>7^Xe,Xe=Xe-at|0,at=at<<24^at>>>8^gt,gt=gt-Ye|0,Ie.b=Ye=Ye<<20^Ye>>>12^Xe,Ie.c=Xe=Xe-at|0,Ie.d=at<<16^Xe>>>16^gt,Ie.a=gt-Ye|0},Ie.a=0,Ie.b=0,Ie.c=-1640531527,Ie.d=1367130551,Se===Math.floor(Se)?(Ie.a=Se/4294967296|0,Ie.b=0|Se):Me+=Se;for(var qe=0;qe<Me.length+20;qe++)Ie.b^=0|Me.charCodeAt(qe),Ie.next()}(U),le=G&&G.state,be=function(){return(ae.next()>>>0)/4294967296};return be.double=function(){do var Se=((ae.next()>>>11)+(ae.next()>>>0)/4294967296)/2097152;while(Se===0);return Se},be.int32=ae.next,be.quick=be,le&&(typeof le=="object"&&y(le,ae),be.state=function(){return y(ae,{})}),be}a&&a.exports?a.exports=S:this.tychei=S})(0,p)}),fh=al(function(p){(function(c,a){var l,y=this,S=256,U=6,G="random",ae=a.pow(S,U),le=a.pow(2,52),be=2*le,Se=S-1;function Ie(at,gt,bt){var _t=[],jt=Ye(function Zt(rn,Sn){var Bn,Mn=[],fr=typeof rn;if(Sn&&fr=="object")for(Bn in rn)try{Mn.push(Zt(rn[Bn],Sn-1))}catch{}return Mn.length?Mn:fr=="string"?rn:rn+"\0"}((gt=gt==1?{entropy:!0}:gt||{}).entropy?[at,Xe(c)]:at==null?function(){try{var Zt;return l&&(Zt=l.randomBytes)?Zt=Zt(S):(Zt=new Uint8Array(S),(y.crypto||y.msCrypto).getRandomValues(Zt)),Xe(Zt)}catch{var rn=y.navigator,Sn=rn&&rn.plugins;return[+new Date,y,Sn,y.screen,Xe(c)]}}():at,3),_t),Qt=new Me(_t),sn=function(){for(var Zt=Qt.g(U),rn=ae,Sn=0;Zt<le;)Zt=(Zt+Sn)*S,rn*=S,Sn=Qt.g(1);for(;Zt>=be;)Zt/=2,rn/=2,Sn>>>=1;return(Zt+Sn)/rn};return sn.int32=function(){return 0|Qt.g(4)},sn.quick=function(){return Qt.g(4)/4294967296},sn.double=sn,Ye(Xe(Qt.S),c),(gt.pass||bt||function(Zt,rn,Sn,Bn){return Bn&&(Bn.S&&qe(Bn,Qt),Zt.state=function(){return qe(Qt,{})}),Sn?(a[G]=Zt,rn):Zt})(sn,jt,"global"in gt?gt.global:this==a,gt.state)}function Me(at){var gt,bt=at.length,_t=this,jt=0,Qt=_t.i=_t.j=0,sn=_t.S=[];for(bt||(at=[bt++]);jt<S;)sn[jt]=jt++;for(jt=0;jt<S;jt++)sn[jt]=sn[Qt=Se&Qt+at[jt%bt]+(gt=sn[jt])],sn[Qt]=gt;(_t.g=function(Zt){for(var rn,Sn=0,Bn=_t.i,Mn=_t.j,fr=_t.S;Zt--;)rn=fr[Bn=Se&Bn+1],Sn=Sn*S+fr[Se&(fr[Bn]=fr[Mn=Se&Mn+rn])+(fr[Mn]=rn)];return _t.i=Bn,_t.j=Mn,Sn})(S)}function qe(at,gt){return gt.i=at.i,gt.j=at.j,gt.S=at.S.slice(),gt}function Ye(at,gt){for(var bt,_t=at+"",jt=0;jt<_t.length;)gt[Se&jt]=Se&(bt^=19*gt[Se&jt])+_t.charCodeAt(jt++);return Xe(gt)}function Xe(at){return String.fromCharCode.apply(0,at)}if(a["seed"+G]=Ie,Ye(a.random(),c),p.exports){p.exports=Ie;try{l=o(390)}catch{}}})([],Math)});fh.alea=Lc,fh.xor128=Vm,fh.xorwow=Gh,fh.xorshift7=Pg,fh.xor4096=G0,fh.tychei=qm;var $h=fh.alea,Nd=Tt({addN_:function(p){Ce(Array.isArray(p),function(){return"The argument passed to tf.addN() must be a list of tensors"}),Ce(p.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+p.length});var c=p.map(function(y,S){return Ze(y,"tensors"+S,"addN")}),a=c[0];c.forEach(function(y){if(y.dtype!==a.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),c.forEach(function(y){if(!fn(y.shape,a.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var l=c;return He.runKernelFunc(function(y,S){return y.addN(c)},l,null,"AddN")}});function Kh(){Qc("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function Rf(p){return p.rank===0||p.rank===1?p.as4D(1,1,1,p.size):p.rank===2?p.as4D(1,1,p.shape[0],p.shape[1]):p.rank===3?p.as4D(1,p.shape[0],p.shape[1],p.shape[2]):p}function Hm(p,c,a,l,y,S){S==null&&(S=.001);var U,G,ae=Ze(p,"x","batchNorm"),le=Ze(c,"mean","batchNorm"),be=Ze(a,"variance","batchNorm");y!=null&&(U=Ze(y,"scale","batchNorm")),l!=null&&(G=Ze(l,"offset","batchNorm")),Ce(le.rank===be.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),Ce(G==null||le.rank===G.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),Ce(U==null||le.rank===U.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var Se={x:ae,scale:U,offset:G,mean:le,variance:be},Ie={varianceEpsilon:S};return He.runKernelFunc(function(Me,qe){var Ye=Rf(ae),Xe=Me.batchNormalization(Ye,Xh(le),Xh(be),S,Xh(U),Xh(G));return qe([ae,le,be,U]),Xe},Se,null,"FusedBatchNorm",Ie).reshape(ae.shape)}function Xh(p){return p==null?null:p.rank===0?p.as1D():p.rank===1?p:p.rank===2?p.as4D(1,1,p.shape[0],p.shape[1]):p.rank===3?p.as4D(1,p.shape[0],p.shape[1],p.shape[2]):p}var Ko=Tt({batchNormalization_:function(p,c,a,l,y,S){return l===void 0&&(l=.001),Kh(),Hm(p,c,a,S,y,l)}}),hh=Tt({batchNorm_:Hm});function up(p,c,a,l,y,S){var U,G,ae=Ze(p,"x","batchNorm"),le=Ze(c,"mean","batchNorm"),be=Ze(a,"variance","batchNorm");return y!=null&&(U=Ze(y,"scale","batchNorm")),l!=null&&(G=Ze(l,"offset","batchNorm")),Ce(ae.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+ae.rank+"."}),Ce(le.rank===2||le.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+le.rank+"."}),Ce(be.rank===2||be.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+be.rank+"."}),U!=null&&Ce(U.rank===2||U.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+U.rank+"."}),G!=null&&Ce(G.rank===2||G.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+G.rank+"."}),hh(ae,le,be,G,U,S)}var $0=Tt({batchNormalization2d_:function(p,c,a,l,y,S){return l===void 0&&(l=.001),Kh(),up(p,c,a,S,y,l)}}),dh=Tt({batchNorm2d_:up});function cp(p,c,a,l,y,S){var U,G,ae=Ze(p,"x","batchNorm"),le=Ze(c,"mean","batchNorm"),be=Ze(a,"variance","batchNorm");return y!=null&&(U=Ze(y,"scale","batchNorm")),l!=null&&(G=Ze(l,"offset","batchNorm")),Ce(ae.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+ae.rank+"."}),Ce(le.rank===3||le.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+le.rank+"."}),Ce(be.rank===3||be.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+be.rank+"."}),U!=null&&Ce(U.rank===3||U.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+U.rank+"."}),G!=null&&Ce(G.rank===3||G.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+G.rank+"."}),hh(ae,le,be,G,U,S)}var Mf=Tt({batchNormalization3d_:function(p,c,a,l,y,S){return l===void 0&&(l=.001),Kh(),cp(p,c,a,S,y,l)}}),hf=Tt({batchNorm3d_:cp});function Yh(p,c,a,l,y,S){var U,G,ae=Ze(p,"x","batchNorm"),le=Ze(c,"mean","batchNorm"),be=Ze(a,"variance","batchNorm");return y!=null&&(U=Ze(y,"scale","batchNorm")),l!=null&&(G=Ze(l,"offset","batchNorm")),Ce(ae.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+ae.rank+"."}),Ce(le.rank===4||le.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+le.rank+"."}),Ce(be.rank===4||be.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+be.rank+"."}),U!=null&&Ce(U.rank===4||U.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+U.rank+"."}),G!=null&&Ce(G.rank===4||G.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+G.rank+"."}),hh(ae,le,be,G,U,S)}var df=Tt({batchNormalization4d_:function(p,c,a,l,y,S){return l===void 0&&(l=.001),Kh(),Yh(p,c,a,S,y,l)}}),to=Tt({batchNorm4d_:Yh}),pf=Tt({broadcastTo_:function(p,c){var a=Ze(p,"broadcastTo","x"),l=a.shape;if(c.some(function(Se){return!(Se>0)||Se%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+c+"].");if(c.length<a.rank)throw new Error("broadcastTo(): shape.length="+c.length+" < input.rank="+a.rank+".");if(c.length>a.rank){for(var y=a.shape.slice();y.length<c.length;)y.unshift(1);a=a.reshape(y)}for(var S=a.shape,U=Array.from(c),G=c.length-1;G>=0;G--)if(S[G]===c[G])U[G]=1;else if(a.shape[G]!==1)throw new Error("broadcastTo(): ["+l+"] cannot be broadcast to ["+c+"].");var ae=U.map(function(Se,Ie){return Se>1?Ie:-1}).filter(function(Se){return Se>=0});if(ae.length===0)return a.clone();var le={x:a},be={shape:c,inputShape:S};return He.runKernelFunc(function(Se){return Se.tile(a,U)},le,function(Se){return{x:function(){return Se.sum(ae,!0)}}},Df,be)}}),jf=Tt({clone_:function(p){var c=Ze(p,"x","clone",null);return He.runKernelFunc(function(){return He.makeTensorFromDataId(c.dataId,c.shape,c.dtype)},{x:c},null,Tf)}}),zu=Tt({logicalAnd_:function(p,c){var a=Ze(p,"a","logicalAnd","bool"),l=Ze(c,"b","logicalAnd","bool");return Co(a.shape,l.shape),He.runKernelFunc(function(y){return y.logicalAnd(a,l)},{a,b:l},null,"LogicalAnd")}}),lp=Tt({logicalNot_:function(p){var c=Ze(p,"x","logicalNot","bool");return He.runKernelFunc(function(a){return a.logicalNot(c)},{$x:c})}}),ph=Tt({logicalOr_:function(p,c){var a=Ze(p,"a","logicalOr","bool"),l=Ze(c,"b","logicalOr","bool");return Co(a.shape,l.shape),He.runKernelFunc(function(y){return y.logicalOr(a,l)},{$a:a,$b:l})}}),Bf=Tt({logicalXor_:function(p,c){var a=Ze(p,"a","logicalXor","bool"),l=Ze(c,"b","logicalXor","bool");return Co(a.shape,l.shape),ph(p,c).logicalAnd(zu(p,c).logicalNot())}}),Ts=Tt({where_:function(p,c,a){var l=Ze(c,"a","where"),y=Ze(a,"b","where"),S=Ze(p,"condition","where","bool");return Wt(l.shape,y.shape,"Error in where: "),S.rank===1?Ce(S.shape[0]===l.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Wt(S.shape,y.shape,"Error in where: "),He.runKernelFunc(function(U,G){var ae=U.select(S,l,y);return G([S]),ae},{$condition:S,$a:l,$b:y},function(U,G){var ae=G[0];return{$condition:function(){return Ri(ae).toFloat()},$a:function(){return U.mul(ae.cast(U.dtype))},$b:function(){return U.mul(ae.logicalNot().cast(U.dtype))}}})}}),Id=function(p){return M(this,void 0,void 0,function(){var c,a,l;return V(this,function(y){switch(y.label){case 0:return[4,(c=Ze(p,"condition","whereAsync","bool")).data()];case 1:return a=y.sent(),l=Wa(c.shape,a),p!==c&&c.dispose(),[2,l]}})})},Gm=Tt({divNoNan_:function(p,c){var a,l=Ze(p,"a","div"),y=Ze(c,"b","div");l=(a=_n(l,y))[0],y=a[1];var S=ts(l,y),U=Ri(S),G=y.equal(U);return Ts(G,U,S)}}),Jh=Tt({tile_:function(p,c){var a=Ze(p,"x","tile",null);Ce(a.rank===c.length,function(){return"Error in transpose: rank of input "+a.rank+" must match length of reps "+c+"."});var l=[a],y={x:a},S={reps:c};return He.runKernelFunc(function(U,G){var ae=U.tile(a,c);return G([a]),ae},y,null,sf,S,l)}}),Pf=Tt({eye_:function(p,c,a,l){l===void 0&&(l="float32"),c==null&&(c=p);for(var y=Ki([p,c],l),S=p<=c?p:c,U=0;U<S;++U)y.set(1,U,U);var G=y.toTensor().as2D(p,c);if(a==null)return G;if(a.length===1)return Jh(nu(G,0),[a[0],1,1]);if(a.length===2)return Jh(nu(nu(G,0),0),[a[0],a[1],1,1]);if(a.length===3)return Jh(nu(nu(nu(G,0),0),0),[a[0],a[1],a[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+a.length+"D.")}}),du=Tt({multinomial_:function(p,c,a,l){l===void 0&&(l=!1);var y=Ze(p,"logits","multinomial"),S=y.size,U=y.rank;if(S<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+S+".");if(U>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+U);a=a||Math.random();var G=U===1?y.as2D(1,-1):y,ae=He.runKernelFunc(function(le){return le.multinomial(G,l,c,a)},{logits2D:G});return U===1?ae.as1D():ae}}),mf=Tt({oneHot_:function(p,c,a,l){if(a===void 0&&(a=1),l===void 0&&(l=0),c<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+c);var y=Ze(p,"indices","oneHot","int32"),S=y.shape.concat([c]),U={indices:y=y.flatten()},G={depth:c,onValue:a,offValue:l};return He.runKernelFunc(function(ae,le){return le([y]),ae.oneHot(y,c,a,l)},U,null,af,G).reshape(S)}}),El=Tt({pad_:function(p,c,a){a===void 0&&(a=0);var l=Ze(p,"x","pad");if(l.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var y={paddings:c,constantValue:a},S={x:l};return He.runKernelFunc(function(U,G){return G([l]),U.pad(l,c,a)},S,null,ma,y)}}),sl=Tt({pad1d_:function(p,c,a){return a===void 0&&(a=0),Ce(c.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),El(p,[c],a)}}),ul=Tt({pad2d_:function(p,c,a){return a===void 0&&(a=0),Ce(c.length===2&&c[0].length===2&&c[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),El(p,c,a)}}),rc=Tt({pad3d_:function(p,c,a){return a===void 0&&(a=0),Ce(c.length===3&&c[0].length===2&&c[1].length===2&&c[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),El(p,c,a)}}),tm=Tt({pad4d_:function(p,c,a){return a===void 0&&(a=0),Ce(c.length===4&&c[0].length===2&&c[1].length===2&&c[2].length===2&&c[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),El(p,c,a)}}),Lg=Tt({rand_:function(p,c,a){var l=Qe(p),y=null;if(a==null||a==="float32")y=new Float32Array(l);else if(a==="int32")y=new Int32Array(l);else{if(a!=="bool")throw new Error("Unknown data type "+a);y=new Uint8Array(l)}for(var S=0;S<l;S++)y[S]=c();return He.makeTensor(y,p,a)}}),Fd=.001,Ra=.1;function nm(){return He.backend.floatPrecision()===32?Fd:Ra}function zc(p,c,a){var l=!0;if((yt(p)||yt(c))&&(l=!1),yt(p)&&yt(c)&&(l=!0),l){var y=p.constructor.name,S=c.constructor.name;if(y!==S)throw new Error("Arrays are of different type. Actual: "+y+". Expected: "+S)}if(Array.isArray(p)&&Array.isArray(c)){var U=$s(p),G=$s(c);if(!fn(U,G))throw new Error("Arrays have different shapes. Actual: ["+U+"]. Expected: ["+G+"]")}var ae=yt(p)?p:Ut(p),le=yt(c)?c:Ut(c);if(ae.length!==le.length)throw new Error("Arrays have different lengths actual: "+ae.length+" vs expected: "+le.length+`.
Actual:   `+ae+`.
Expected: `+le+".");for(var be=0;be<le.length;++be){var Se=ae[be],Ie=le[be];if(!a(Se,Ie))throw new Error("Arrays differ: actual["+be+"] = "+Se+", expected["+be+"] = "+Ie+`.
Actual:   `+ae+`.
Expected: `+le+".")}}function Qh(p,c,a){return!isFinite(p)&&!isFinite(c)||!(isNaN(p)||isNaN(c)||Math.abs(p-c)>a)}var Zh=Object.freeze({TEST_EPSILON_FLOAT16:Ra,expectArraysClose:function(p,c,a){return a==null&&(a=nm()),zc(p,c,function(l,y){return Qh(l,y,a)})},testEpsilon:nm,expectPromiseToFail:function(p,c){p().then(function(){return c.fail()},function(){return c()})},expectArraysEqual:function(p,c){var a=typeof c=="string"||typeof c=="number"||typeof c=="boolean"?[c]:c;return zn(p)||zn(p[0])||zn(c)||zn(c[0])?zc(p,a,function(l,y){return l==y}):zc(p,c,function(l,y){return Qh(l,y,0)})},expectNumbersClose:function(p,c,a){if(a==null&&(a=nm()),!Qh(p,c,a))throw new Error("Numbers differ: actual === "+p+", expected === "+c)},expectValuesInRange:function(p,c,a){for(var l=0;l<p.length;l++)if(p[l]<c||p[l]>a)throw new Error("Value out of range:"+p[l]+" low: "+c+", high: "+a)},expectArrayBuffersEqual:function(p,c){expect(new Float32Array(p)).toEqual(new Float32Array(c))}}),rm=function(){function p(c,a,l,y,S){this.mean=c,this.stdDev=a,this.dtype=l,this.nextVal=NaN,this.truncated=y,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var U=S||Math.random();this.random=$h(U.toString())}return p.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var c=this.nextVal;return this.nextVal=NaN,c}for(var a,l,y=!1;!y;){var S=void 0,U=void 0,G=void 0;do G=(S=2*this.random()-1)*S+(U=2*this.random()-1)*U;while(G>=1||G===0);var ae=Math.sqrt(-2*Math.log(G)/G);a=this.mean+this.stdDev*S*ae,l=this.mean+this.stdDev*U*ae,this.truncated&&!this.isValidTruncated(a)||(y=!0)}return this.truncated&&!this.isValidTruncated(l)||(this.nextVal=this.convertValue(l)),this.convertValue(a)},p.prototype.convertValue=function(c){return this.dtype==null||this.dtype==="float32"?c:Math.round(c)},p.prototype.isValidTruncated=function(c){return c<=this.upper&&c>=this.lower},p}(),$m=function(){function p(c,a,l,y){this.alpha=c,this.beta=1/a,this.dtype=l;var S=y||Math.random();this.randu=$h(S.toString()),this.randn=new rm(0,1,l,!1,this.randu()),this.d=c<1?c+2/3:c-1/3,this.c=1/Math.sqrt(9*this.d)}return p.prototype.nextValue=function(){for(var c,a,l,y,S,U;;){do y=this.randn.nextValue(),U=1+this.c*y;while(U<=0);if(U*=U*U,a=1-.331*(c=y*y)*c,l=.5*c+this.d*(1-U+Math.log(U)),(S=this.randu())<a||Math.log(S)<l)break}return U=1/this.beta*this.d*U,this.alpha<1&&(U*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(U)},p.prototype.convertValue=function(c){return this.dtype==="float32"?c:Math.round(c)},p}(),Km=function(){function p(c,a,l,y){var S=this;if(c===void 0&&(c=0),a===void 0&&(a=1),this.canReturnFloat=function(){return S.dtype==null||S.dtype==="float32"},this.min=c,this.range=a-c,this.dtype=l,y==null&&(y=Math.random()),typeof y=="number"&&(y=y.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+c+" - "+a+" <= 1 and dtype is not float");this.random=$h(y)}return p.prototype.convertValue=function(c){return this.canReturnFloat()?c:Math.round(c)},p.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},p}(),Xm=Tt({randomGamma_:function(p,c,a,l,y){if(a===void 0&&(a=1),l===void 0&&(l="float32"),a==null&&(a=1),l==null&&(l="float32"),l!=="float32"&&l!=="int32")throw new Error("Unsupported data type "+l);for(var S=new $m(c,a,l,y),U=Ki(p,l),G=0;G<U.values.length;G++)U.values[G]=S.nextValue();return U.toTensor()}}),zg=Tt({randomNormal_:function(p,c,a,l,y){if(c===void 0&&(c=0),a===void 0&&(a=1),l!=null&&l==="bool")throw new Error("Unsupported data type "+l);for(var S=new rm(c,a,l,!1,y),U=Ki(p,l),G=0;G<U.values.length;G++)U.values[G]=S.nextValue();return U.toTensor()}}),im=Tt({randomUniform_:function(p,c,a,l,y){c===void 0&&(c=0),a===void 0&&(a=1),l===void 0&&(l="float32");for(var S=Ki(p,l),U=new Km(c,a,null,y),G=0;G<S.values.length;G++)S.values[G]=U.nextValue();return S.toTensor()}}),ed=Tt({square_:function(p){var c=Ze(p,"x","square"),a=[c];return He.runKernelFunc(function(l,y){return y([c]),l.square(c)},{x:c},null,"Square",{},a,[])}}),fp=Tt({squaredDifference_:function(p,c){var a,l=Ze(p,"a","squaredDifference"),y=Ze(c,"b","squaredDifference");a=_n(l,y),l=a[0],y=a[1],Co(l.shape,y.shape);var S={a:l,b:y},U=[l,y];return He.runKernelFunc(function(G,ae){var le=G.squaredDifference(l,y);return ae([l,y]),le},S,function(G,ae){var le=ae[0],be=ae[1],Se=Mr(2);return{a:function(){return G.mul(le.sub(be).mul(Se))},b:function(){return G.mul(be.sub(le).mul(Se))}}},Sf,{},U,[])}}),Rd=Tt({truncatedNormal_:function(p,c,a,l,y){if(c===void 0&&(c=0),a===void 0&&(a=1),l!=null&&l==="bool")throw new Error("Unsupported data type $ { dtype }");for(var S=new rm(c,a,l,!0,y),U=Ki(p,l),G=0;G<U.values.length;G++)U.values[G]=S.nextValue();return U.toTensor()}}),td=Tt({equal_:function(p,c){var a,l=Ze(p,"a","equal"),y=Ze(c,"b","equal");return a=_n(l,y),l=a[0],y=a[1],Co(l.shape,y.shape),He.runKernelFunc(function(S){return S.equal(l,y)},{$a:l,$b:y})}}),om=Tt({equalStrict_:function(p,c){var a=Ze(p,"a","equalStrict"),l=Ze(c,"b","equalStrict");return Wt(a.shape,l.shape,"Error in equalStrict: "),a.equal(l)}}),Ym=Tt({greater_:function(p,c){var a,l=Ze(p,"a","greater"),y=Ze(c,"b","greater");return a=_n(l,y),l=a[0],y=a[1],Co(l.shape,y.shape),He.runKernelFunc(function(S){return S.greater(l,y)},{a:l,b:y},null,"Greater")}}),hp=Tt({greaterEqual_:function(p,c){var a,l=Ze(p,"a","greaterEqual"),y=Ze(c,"b","greaterEqual");return a=_n(l,y),l=a[0],y=a[1],Co(l.shape,y.shape),He.runKernelFunc(function(S,U){var G=S.greaterEqual(l,y);return U([l,y]),G},{a:l,b:y},function(S,U){var G=U[0],ae=U[1];return{a:function(){return Ri(G)},b:function(){return Ri(ae)}}},"GreaterEqual")}}),dp=Tt({greaterEqualStrict_:function(p,c){var a=Ze(p,"a","greaterEqualStrict"),l=Ze(c,"b","greaterEqualStrict");return Wt(a.shape,l.shape,"Error in greaterEqualStrict: "),a.greaterEqual(l)}}),am=Tt({greaterStrict_:function(p,c){var a=Ze(p,"a","greaterStrict"),l=Ze(c,"b","greaterStrict");return Wt(a.shape,l.shape,"Error in greaterStrict: "),a.greater(l)}}),gf=Tt({less_:function(p,c){var a,l=Ze(p,"a","less"),y=Ze(c,"b","less");return a=_n(l,y),l=a[0],y=a[1],Co(l.shape,y.shape),He.runKernelFunc(function(S){return S.less(l,y)},{a:l,b:y},null,"Less")}}),Uc=Tt({lessEqual_:function(p,c){var a,l=Ze(p,"a","lessEqual"),y=Ze(c,"b","lessEqual");return a=_n(l,y),l=a[0],y=a[1],Co(l.shape,y.shape),He.runKernelFunc(function(S,U){var G=S.lessEqual(l,y);return U([l,y]),G},{a:l,b:y},null,"LessEqual")}}),K0=Tt({lessEqualStrict_:function(p,c){var a=Ze(p,"a","lessEqualStrict"),l=Ze(c,"b","lessEqualStrict");return Wt(a.shape,l.shape,"Error in lessEqualStrict: "),a.lessEqual(l)}}),Ug=Tt({lessStrict_:function(p,c){var a=Ze(p,"a","lessStrict"),l=Ze(c,"b","lessStrict");return Wt(a.shape,l.shape,"Error in lessStrict: "),a.less(l)}}),sm=Tt({notEqual_:function(p,c){var a,l=Ze(p,"a","notEqual"),y=Ze(c,"b","notEqual");return a=_n(l,y),l=a[0],y=a[1],Co(l.shape,y.shape),He.runKernelFunc(function(S){return S.notEqual(l,y)},{a:l,b:y},null,"NotEqual")}}),d0=Tt({notEqualStrict_:function(p,c){var a=Ze(p,"a","notEqualStrict"),l=Ze(c,"b","notEqualStrict");return Wt(a.shape,l.shape,"Error in notEqualStrict: "),a.notEqual(l)}});function nd(p,c){for(var a=[],l=p;l<c;++l)a.push(l);return a}function p0(p){for(var c=[],a=0;a<p.length;++a)for(var l=0;l<p[a].length;++l)c.push(p[a][l]);return c}var um=Tt({gather_:function(p,c,a){a===void 0&&(a=0);var l=Ze(p,"x","gather"),y=Ze(c,"indices","gather","int32");a=Tn(a,l.shape)[0];var S=function(U,G,ae){for(var le=U.shape[ae],be=[],Se=1,Ie=1,Me=0;Me<ae;Me++)be.push(U.shape[Me]),Se*=U.shape[Me];for(Me=0;Me<G.rank;Me++)be.push(G.shape[Me]);for(Me=ae+1;Me<U.rank;Me++)be.push(U.shape[Me]),Ie*=U.shape[Me];return{batchSize:Se,sliceSize:Ie,dimSize:le,outputShape:be}}(l,y,a);return He.runKernelFunc(function(U,G){var ae=U.gather(l,y.flatten(),a);return G([y]),ae},{x:l,indices:y},function(U,G){var ae=G[0];return{x:function(){var le=l.shape,be=ae.size,Se=le.slice(0,a),Ie=Se.length,Me=le.slice(a,le.length).slice(1),qe=Me.length,Ye=nd(0,Ie),Xe=nd(Ie+1,Ie+1+qe),at=p0([Se,[be],Me]),gt=U.reshape(at),bt=ae.reshape([be]),_t=p0([[Ie],Ye,Xe]),jt=gt.transpose(_t),Qt=Jm(jt,bt,l.shape[a]),sn=vl(_t);return Qt.transpose(sn)},indices:function(){return ae}}},"Gather",{axis:a}).reshape(S.outputShape)}}),Jm=Tt({unsortedSegmentSum_:function(p,c,a){var l=Ze(p,"x","unsortedSegmentSum"),y=Ze(c,"segmentIds","unsortedSegmentSum","int32");return Ce(on(a),function(){return"numSegments must be of dtype int"}),He.runKernelFunc(function(S,U){var G=S.unsortedSegmentSum(l,y,a);return U([y]),G},{$x:l},function(S,U){var G=U[0];return{$x:function(){return function(ae,le){for(var be=Ds(le,Ri(le)),Se=um(ae,be),Ie=hp(le,Mr(0,"int32")),Me=Se.rank-Ie.rank,qe=0;qe<Me;++qe)Ie=nu(Ie,qe+1);Ie=zu(Ie,Xu(Se.shape,"bool"));var Ye=Ri(Se);return Ts(Ie,Se,Ye)}(S,G)}}})}}),m0=function(p,c,a){return M(this,void 0,void 0,function(){var l,y,S,U,G,ae,le,be,Se,Ie,Me,qe,Ye;return V(this,function(Xe){switch(Xe.label){case 0:for(l=Ze(p,"tensor","boolMask"),y=Ze(c,"mask","boolMask","bool"),S=a==null?0:a,U=y.rank,G=l.shape,Ce(U>0,function(){return"mask cannot be scalar"}),Wt(G.slice(S,S+U),y.shape,"mask's shape must match the first K dimensions of tensor's shape,"),ae=1,le=S;le<S+U;le++)ae*=G[le];return be=G.slice(0,S).concat([ae],G.slice(S+U)),Se=l.reshape(be),Ie=y.reshape([-1]),[4,Id(Ie)];case 1:return Me=Xe.sent(),qe=Me.squeeze([1]),Ye=um(Se,qe,S),p!==l&&l.dispose(),c!==y&&y.dispose(),qe.dispose(),Se.dispose(),Ie.dispose(),Me.dispose(),[2,Ye]}})})};function g0(p,c,a,l,y,S,U){S===void 0&&(S="NHWC"),Ce(p.length===c.rank,function(){return"Length of inShape ("+p.length+") and rank of dy ("+c.rank+") must match"});var G=p,ae=c,le=!1;c.rank===3&&(le=!0,ae=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]),G=[1,p[0],p[1],p[2]]),Ce(G.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+G.length+"."}),Ce(ae.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+ae.rank}),Ce(a.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+a.rank});var be=S==="NHWC"?G[3]:G[1],Se=S==="NHWC"?ae.shape[3]:ae.shape[1];Ce(be===a.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+be+") must match input depth for filter "+a.shape[2]+"."}),Ce(Se===a.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+Se+") must match output depth for filter "+a.shape[3]+"."}),U!=null&&Ce(on(y),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+U+" but got pad "+y+"."});var Ie=li(S),Me=Vn(G,a.shape,l,1,y,U,!1,Ie),qe=He.runKernelFunc(function(Ye,Xe){var at=Ye.conv2dDerInput(ae,a,Me);return Xe([a,ae]),at},{dy4D:ae,filter:a},function(Ye,Xe){var at=Xe[0],gt=Xe[1];return{dy4D:function(){return rd(Ye,at,l,y,S,1,U)},filter:function(){return Vg(Ye,gt,at.shape,l,y,S,U)}}});return le?qe.as3D(qe.shape[1],qe.shape[2],qe.shape[3]):qe}function Wg(p){var c=function(S){return typeof S=="number"?[S,S,S]:S.length===2?[S[0],S[1],1]:S}(p),a=c[0],l=c[1],y=c[2];return a===1&&l===1&&y===1}function v0(p,c,a,l,y){Ce(p.length===c.rank,function(){return"Length of inShape ("+p.length+") and rank of dy ("+c.rank+") must match"});var S=p,U=c,G=!1;c.rank===4&&(G=!0,U=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),S=[1,p[0],p[1],p[2],p[3]]);var ae=S[4],le=U.shape[4];Ce(S.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+S.length+"."}),Ce(U.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+U.rank}),Ce(a.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+a.rank}),Ce(ae===a.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+ae+") must match input depth for filter "+a.shape[3]+"."}),Ce(le===a.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+le+") must match output depth for filter "+a.shape[4]+"."});var be=rr(S,a.shape,l,1,y),Se=He.runKernelFunc(function(Ie){return Ie.conv3dDerInput(U,a,be)},{dy5D:U});return G?Se.as4D(Se.shape[1],Se.shape[2],Se.shape[3],Se.shape[4]):Se}var y0=Tt({conv1d_:function(p,c,a,l,y,S,U){y===void 0&&(y="NWC"),S===void 0&&(S=1);var G=Ze(p,"x","conv1d"),ae=Ze(c,"filter","conv1d"),le=G,be=!1;G.rank===2&&(be=!0,le=G.as3D(1,G.shape[0],G.shape[1])),Ce(le.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+le.rank+"."}),Ce(ae.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+ae.rank+"."}),U!=null&&Ce(on(l),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+U+" but got pad "+l+"."}),Ce(le.shape[2]===ae.shape[1],function(){return"Error in conv1d: depth of input ("+le.shape[2]+") must match input depth for filter "+ae.shape[1]+"."}),Ce(zr(a,S),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+a+" and dilation '"+S+"'"}),Ce(y==="NWC",function(){return"Error in conv1d: got dataFormat of "+y+" but only NWC is currently supported."});var Se=ae.as4D(1,ae.shape[0],ae.shape[1],ae.shape[2]),Ie=le.as4D(le.shape[0],1,le.shape[1],le.shape[2]),Me=rd(Ie,Se,[1,a],l,"NHWC",[1,S],U);return be?Me.as2D(Me.shape[2],Me.shape[3]):Me.as3D(Me.shape[0],Me.shape[2],Me.shape[3])}}),rd=Tt({conv2d_:function(p,c,a,l,y,S,U){y===void 0&&(y="NHWC"),S===void 0&&(S=[1,1]);var G=Ze(p,"x","conv2d"),ae=Ze(c,"filter","conv2d"),le=G,be=!1;G.rank===3&&(be=!0,le=G.as4D(1,G.shape[0],G.shape[1],G.shape[2])),Ce(le.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+le.rank+"."}),Ce(ae.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+ae.rank+"."}),U!=null&&Ce(on(l),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+U+" but got pad "+l+"."});var Se=y==="NHWC"?le.shape[3]:le.shape[1];Ce(Se===ae.shape[2],function(){return"Error in conv2d: depth of input ("+Se+") must match input depth for filter "+ae.shape[2]+"."}),Ce(zr(a,S),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+S+"'"});var Ie=li(y),Me=Vn(le.shape,ae.shape,a,S,l,U,!1,Ie),qe=[ae,le],Ye=He.runKernelFunc(function(Xe,at){var gt=Xe.conv2d(le,ae,Me);return at([ae,le]),gt},{x:le,filter:ae},function(Xe,at){var gt=at,bt=gt[0],_t=gt[1];return Ce(yi(S),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+S+"'"}),{x:function(){return mh(_t.shape,Xe,bt,a,l,y)},filter:function(){return Vg(_t,Xe,bt.shape,a,l,y)}}},"Conv2D",Me,qe);return be?Ye.as3D(Ye.shape[1],Ye.shape[2],Ye.shape[3]):Ye}}),b0=Tt({conv3d_:function(p,c,a,l,y,S){y===void 0&&(y="NDHWC"),S===void 0&&(S=[1,1,1]);var U=Ze(p,"x","conv3d"),G=Ze(c,"filter","conv3d"),ae=U,le=!1;U.rank===4&&(le=!0,ae=U.as5D(1,U.shape[0],U.shape[1],U.shape[2],U.shape[3])),Ce(ae.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+ae.rank+"."}),Ce(G.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+G.rank+"."}),Ce(ae.shape[4]===G.shape[3],function(){return"Error in conv3d: depth of input ("+ae.shape[4]+") must match input depth for filter "+G.shape[3]+"."}),Ce(function(Ie,Me){return Wg(a)||Wg(Me)}(0,S),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+S+"'"}),Ce(y==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+y+" but only NDHWC is currently supported."});var be=rr(ae.shape,G.shape,a,S,l),Se=He.runKernelFunc(function(Ie,Me){var qe=Ie.conv3d(ae,G,be);return Me([ae,G]),qe},{x:ae,$filter:G},function(Ie,Me){Ce(Wg(S),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+S+"'"});var qe=Me[0],Ye=Me[1];return{x:function(){return v0(qe.shape,Ie,Ye,a,l)},$filter:function(){return function(Xe,at,gt,bt,_t){var jt=Xe;Xe.rank===4&&(jt=Xe.as5D(1,Xe.shape[0],Xe.shape[1],Xe.shape[2],Xe.shape[3]));var Qt=at;Qt.rank===4&&(Qt=at.as5D(1,at.shape[0],at.shape[1],at.shape[2],at.shape[3])),Ce(jt.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+jt.shape+"."}),Ce(Qt.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+Qt.shape+"."}),Ce(gt.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+gt+"."}),Ce(jt.shape[4]===gt[3],function(){return"Error in conv3dDerFilter: depth of input "+jt.shape[4]+") must match input depth in filter ("+gt[3]+"."}),Ce(Qt.shape[4]===gt[4],function(){return"Error in conv3dDerFilter: depth of dy ("+Qt.shape[4]+") must match output depth for filter ("+gt[4]+")."});var sn=rr(jt.shape,gt,bt,1,_t);return He.runKernelFunc(function(Zt){return Zt.conv3dDerFilter(jt,Qt,sn)},{x5D:jt,dy5D:Qt})}(qe,Ie,Ye.shape,a,l)}}});return le?Se.as4D(Se.shape[1],Se.shape[2],Se.shape[3],Se.shape[4]):Se}}),Vg=Tt({conv2dDerFilter_:function(p,c,a,l,y,S,U){S===void 0&&(S="NHWC");var G=p;p.rank===3&&(G=p.as4D(1,p.shape[0],p.shape[1],p.shape[2]));var ae=c;ae.rank===3&&(ae=c.as4D(1,c.shape[0],c.shape[1],c.shape[2])),Ce(G.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+G.shape+"."}),Ce(ae.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+ae.shape+"."}),Ce(a.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+a+"."});var le=S==="NHWC"?G.shape[3]:G.shape[1],be=S==="NHWC"?ae.shape[3]:ae.shape[1];Ce(le===a[2],function(){return"Error in conv2dDerFilter: depth of input "+le+") must match input depth in filter ("+a[2]+"."}),Ce(be===a[3],function(){return"Error in conv2dDerFilter: depth of dy ("+be+") must match output depth for filter ("+a[3]+")."}),U!=null&&Ce(on(y),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+U+" but got pad "+y+"."});var Se=li(S),Ie=Vn(G.shape,a,l,1,y,U,!1,Se);return He.runKernelFunc(function(Me){return Me.conv2dDerFilter(G,ae,Ie)},{x4D:G,dy4D:ae})}}),mh=Tt({conv2dDerInput_:g0}),qg=Tt({depthwiseConv2d_:function(p,c,a,l,y,S,U){S===void 0&&(S=[1,1]);var G=Ze(p,"x","depthwiseConv2d"),ae=Ze(c,"filter","depthwiseConv2d"),le=G,be=!1;G.rank===3&&(be=!0,le=G.as4D(1,G.shape[0],G.shape[1],G.shape[2])),Ce(le.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+le.rank+"."}),Ce(ae.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+ae.rank+"."}),Ce(le.shape[3]===ae.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+le.shape[3]+") must match the inChannels dimension in filter "+ae.shape[2]+"."}),S==null&&(S=[1,1]),Ce(zr(a,S),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+S+"'"}),U!=null&&Ce(on(l),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+U+" but got pad "+l+"."});var Se=Vn(le.shape,ae.shape,a,S,l,U,!0),Ie=[le,ae],Me=He.runKernelFunc(function(qe,Ye){var Xe=qe.depthwiseConv2D(le,ae,Se);return Ye([le,ae]),Xe},{x:le,filter:ae},function(qe,Ye){Ce(yi(S),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+S+"'"});var Xe=Ye[0],at=Ye[1];return{x:function(){return x0(Xe.shape,qe,at,Se)},filter:function(){return id(Xe,qe,at.shape,Se)}}},"DepthwiseConv2dNative",Se,Ie);return be?Me.as3D(Me.shape[1],Me.shape[2],Me.shape[3]):Me}}),x0=Tt({depthwiseConv2dDerInput_:function(p,c,a,l){var y=c,S=!1;c.rank===3&&(S=!0,y=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]));var U=He.runKernelFunc(function(G){return G.depthwiseConv2DDerInput(y,a,l)},{dy4D:y});return S?U.as3D(U.shape[1],U.shape[2],U.shape[3]):U}}),id=Tt({depthwiseConv2dDerFilter_:function(p,c,a,l){var y=p;p.rank===3&&(y=p.as4D(1,p.shape[0],p.shape[1],p.shape[2]));var S=c;return S.rank===3&&(S=c.as4D(1,c.shape[0],c.shape[1],c.shape[2])),He.runKernelFunc(function(U){return U.depthwiseConv2DDerFilter(y,S,l)},{x4D:y,dy4D:S})}}),gh=Tt({separableConv2d_:function(p,c,a,l,y,S,U){S===void 0&&(S=[1,1]),U===void 0&&(U="NHWC");var G=Ze(p,"x","separableConv2d"),ae=Ze(c,"depthwiseFilter","separableConv2d"),le=Ze(a,"pointwiseFilter","separableConv2d"),be=G,Se=!1;if(G.rank===3&&(Se=!0,be=G.as4D(1,G.shape[0],G.shape[1],G.shape[2])),U==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Ce(be.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+be.rank+"."}),Ce(ae.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+ae.rank+"."}),Ce(le.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+ae.rank+"."}),Ce(le.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+le.shape[0]+"."}),Ce(le.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+le.shape[1]+"."});var Ie=ae.shape[2],Me=ae.shape[3];Ce(le.shape[2]===Ie*Me,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+Ie*Me+", but got "+le.shape[2]+"."});var qe=qg(be,ae,l,y,U,S),Ye=rd(qe,le,1,"valid",U);return Se?Ye.as3D(Ye.shape[1],Ye.shape[2],Ye.shape[3]):Ye}}),Qm=Tt({conv2dTranspose_:function(p,c,a,l,y,S){return g0(a,Ze(p,"x","conv2dTranspose"),Ze(c,"filter","conv2dTranspose"),l,y,"NHWC",S)}}),Hg=Tt({conv3dTranspose_:function(p,c,a,l,y){return v0(a,Ze(p,"x","conv3dTranspose"),Ze(c,"filter","conv3dTranspose"),l,y)}}),vf=Tt({matMul_:function(p,c,a,l){var y;a===void 0&&(a=!1),l===void 0&&(l=!1);var S=Ze(p,"a","matMul"),U=Ze(c,"b","matMul");y=_n(S,U),S=y[0],U=y[1];var G=a?S.shape[S.rank-2]:S.shape[S.rank-1],ae=l?U.shape[U.rank-1]:U.shape[U.rank-2],le=a?S.shape[S.rank-1]:S.shape[S.rank-2],be=l?U.shape[U.rank-2]:U.shape[U.rank-1],Se=S.shape.slice(0,-2),Ie=U.shape.slice(0,-2),Me=Qe(Se),qe=Qe(Ie);Ce(S.rank>=2&&U.rank>=2&&S.rank===U.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+S.rank+" and "+U.rank+"."}),Ce(fn(Se,Ie),function(){return"Error in matMul: outer dimensions ("+Se+") and ("+Ie+") of Tensors with shapes "+S.shape+" and "+U.shape+" must match."}),Ce(G===ae,function(){return"Error in matMul: inner shapes ("+G+") and ("+ae+") of Tensors with shapes "+S.shape+" and "+U.shape+" and transposeA="+a+" and transposeB="+l+" must match."});var Ye=S.shape.slice(0,-2).concat([le,be]),Xe=a?S.as3D(Me,G,le):S.as3D(Me,le,G),at=l?U.as3D(qe,be,ae):U.as3D(qe,ae,be),gt={transposeA:a,transposeB:l};return He.runKernelFunc(function(bt,_t){var jt=bt.batchMatMul(Xe,at,a,l);return _t([Xe,at]),jt},{a:Xe,b:at},function(bt,_t){var jt=_t,Qt=jt[0],sn=jt[1];return a||l?!a&&l?{a:function(){return bt.matMul(sn,!1,!1)},b:function(){return bt.matMul(Qt,!0,!1)}}:a&&!l?{a:function(){return sn.matMul(bt,!1,!0)},b:function(){return Qt.matMul(bt,!1,!1)}}:{a:function(){return sn.matMul(bt,!0,!0)},b:function(){return bt.matMul(Qt,!0,!0)}}:{a:function(){return bt.matMul(sn,!1,!0)},b:function(){return Qt.matMul(bt,!0,!1)}}},"BatchMatMul",gt).reshape(Ye)}}),Gg=Tt({dot_:function(p,c){var a=Ze(p,"t1","dot"),l=Ze(c,"t2","dot");Ce(!(a.rank!==1&&a.rank!==2||l.rank!==1&&l.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+a.rank+" and "+l.rank+"."});var y=a.rank===1?a.size:a.shape[1],S=l.rank===1?l.size:l.shape[0];return Ce(y===S,function(){return"Error in dot: inner dimensions of inputs must match, but got "+y+" and "+S+"."}),a.rank===1&&l.rank===1?a.as2D(1,-1).matMul(l.as2D(-1,1)).asScalar():a.rank===1&&l.rank===2?a.as2D(1,-1).matMul(l.as2D(l.shape[0],l.shape[1])).as1D():a.rank===2&&l.rank===1?a.matMul(l.as2D(-1,1)).as1D():a.matMul(l.as2D(l.shape[0],l.shape[1]))}}),w0=Tt({outerProduct_:function(p,c){var a=Ze(p,"v1","outerProduct"),l=Ze(c,"v2","outerProduct");return Ce(a.rank===1&&l.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+a.rank+" and "+l.rank+"."}),a.as2D(-1,1).matMul(l.as2D(1,-1))}}),Uu=Tt({reverse_:function(p,c){var a=Ze(p,"x","reverse");if(a.rank===0)return a.clone();var l=Tn(c,a.shape);return He.runKernelFunc(function(y){return y.reverse(a,l)},{$x:a},function(y){return{$x:function(){return y.reverse(l)}}}).reshapeAs(a)}}),X0=Tt({reverse1d_:function(p){var c=Ze(p,"x","reverse");return Ce(c.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+c.rank+"."}),Uu(c,0)}}),pp=Tt({reverse2d_:function(p,c){var a=Ze(p,"x","reverse");return Ce(a.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+a.rank+"."}),Uu(a,c)}}),mp=Tt({reverse3d_:function(p,c){var a=Ze(p,"x","reverse");return Ce(a.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+a.rank+"."}),Uu(a,c)}}),vh=Tt({reverse4d_:function(p,c){var a=Ze(p,"x","reverse");return Ce(a.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+a.rank+"."}),Uu(a,c)}});function k0(p,c,a,l,y,S){var U=Ze(p,"x","maxPool"),G=U,ae=!1;U.rank===3&&(ae=!0,G=U.as4D(1,U.shape[0],U.shape[1],U.shape[2])),l==null&&(l=[1,1]),Ce(G.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+G.rank+"."}),Ce(zr(a,l),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+l+"'"}),S!=null&&Ce(on(y),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+S+" but got pad "+y+"."});var le=Nn(G.shape,c,a,l,y,S);if(le.filterWidth===1&&le.filterHeight===1&&fn(le.inShape,le.outShape))return U.clone();var be=[G],Se=He.runKernelFunc(function(Ie,Me){var qe=Ie.maxPool(G,le);return Me([G,qe]),qe},{x:G},function(Ie,Me){var qe=Me[0],Ye=Me[1];return{x:function(){return function(Xe,at,gt,bt,_t,jt,Qt,sn){var Zt=Ze(Xe,"dy","maxPoolBackprop"),rn=Ze(at,"input","maxPoolBackprop"),Sn=Ze(gt,"output","maxPoolBackprop");Ce(rn.rank===Zt.rank,function(){return"Rank of input ("+rn.rank+") does not match rank of dy ("+Zt.rank+")"}),jt==null&&(jt=[1,1]),Ce(zr(_t,jt),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+_t+" and dilations '"+jt+"'"}),Ce(Zt.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+Zt.rank+"."}),Ce(rn.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+rn.rank+"."});var Bn=Nn(rn.shape,bt,_t,jt,Qt,sn);return He.runKernelFunc(function(Mn){return Mn.maxPoolBackprop(Zt,rn,Sn,Bn)},{$dy:Zt,$input:rn})}(Ie,qe,Ye,c,a,l,y)}}},"MaxPool",le,be);return ae?Se.as3D(Se.shape[1],Se.shape[2],Se.shape[3]):Se}function Md(p,c,a,l,y,S){var U=Ze(p,"x","avgPool","float32");l==null&&(l=[1,1]),Ce(zr(a,l),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+l+"'"});var G=U,ae=!1;U.rank===3&&(ae=!0,G=U.as4D(1,U.shape[0],U.shape[1],U.shape[2])),Ce(G.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+G.rank+"."}),S!=null&&Ce(on(y),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+S+" but got pad "+y+"."});var le=Nn(G.shape,c,a,l,y,S);if(le.filterWidth===1&&le.filterHeight===1&&fn(le.inShape,le.outShape))return U.clone();var be=He.runKernelFunc(function(Se){return Se.avgPool(G,le)},{x:G},function(Se){return{x:function(){return function(Ie,Me,qe,Ye,Xe,at){var gt=Ze(Ie,"dy","avgPoolBackprop"),bt=Ze(Me,"input","avgPoolBackprop");Ce(bt.rank===gt.rank,function(){return"Rank of input ("+bt.rank+") does not match rank of dy ("+gt.rank+")"}),Xe==null&&(Xe=[1,1]),Ce(zr(Ye,Xe),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+Ye+" and dilations '"+Xe+"'"});var _t=bt,jt=gt,Qt=!1;bt.rank===3&&(Qt=!0,_t=bt.as4D(1,bt.shape[0],bt.shape[1],bt.shape[2]),jt=gt.as4D(1,gt.shape[0],gt.shape[1],gt.shape[2])),Ce(jt.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+jt.rank+"."}),Ce(_t.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+_t.rank+"."});var sn=Nn(_t.shape,qe,Ye,Xe,at),Zt=He.runKernelFunc(function(rn){return rn.avgPoolBackprop(jt,_t,sn)},{dy4D:jt,input4D:_t});return Qt?Zt.as3D(Zt.shape[1],Zt.shape[2],Zt.shape[3]):Zt}(Se,G,c,a,l,y)}}},"AvgPool",le);return be=be.cast(U.dtype),ae?be.as3D(be.shape[1],be.shape[2],be.shape[3]):be}var yf=Tt({maxPool_:function(p,c,a,l,y){return k0(p,c,a,1,l,y)}}),gp=Tt({avgPool_:function(p,c,a,l,y){return Md(p,c,a,1,l,y)}}),jd=Tt({pool_:function(p,c,a,l,y,S){y==null&&(y=[1,1]),S==null&&(S=1),l===0&&(l="valid");var U=Ze(p,"x","maxPool"),G=U,ae=!1;U.rank===3&&(ae=!0,G=U.as4D(1,U.shape[0],U.shape[1],U.shape[2])),Ce(zr(S,y),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+S+" and dilations '"+y+"'"});var le,be=Nn(G.shape,c,S,y,l),Se=[be.dilationHeight,be.dilationWidth];le=l==="same"?function(_t,jt){var Qt=_t.map(function(rn,Sn){return rn+(rn-1)*(jt[Sn]-1)}).map(function(rn){return rn-1}),sn=Qt.map(function(rn){return Math.floor(rn/2)}),Zt=Qt.map(function(rn,Sn){return rn-sn[Sn]});return Qt.map(function(rn,Sn){return[sn[Sn],Zt[Sn]]})}([be.filterHeight,be.filterWidth],Se):[[0,0],[0,0]];var Ie=Se[0]===1&&Se[1]===1,Me=function(_t,jt,Qt){var sn=Qt.map(function(Mn){return Mn[0]}),Zt=Qt.map(function(Mn){return Mn[1]}),rn=_t.concat(sn,Zt),Sn=jt.map(function(Mn,fr){return(Mn-rn[fr]%Mn)%Mn}),Bn=Zt.map(function(Mn,fr){return Mn+Sn[fr]});return[jt.map(function(Mn,fr){return[sn[fr],Bn[fr]]}),jt.map(function(Mn,fr){return[0,Sn[fr]]})]}([be.inHeight,be.inWidth],Se,le),qe=Me[0],Ye=Me[1],Xe=Ie?l:"valid",at=Ie?G:Zf(G,Se,qe),gt=(a==="avg"?function(){return Md(at,c,S,1,Xe)}:function(){return k0(at,c,S,1,Xe)})(),bt=Ie?gt:Vp(gt,Se,Ye);return ae?bt.as3D(bt.shape[1],bt.shape[2],bt.shape[3]):bt}}),Zm=Tt({maxPool3d_:function(p,c,a,l,y,S,U){S===void 0&&(S="NDHWC");var G=Ze(p,"x","maxPool3d"),ae=G,le=!1;G.rank===4&&(le=!0,ae=G.as5D(1,G.shape[0],G.shape[1],G.shape[2],G.shape[3])),U==null&&(U=[1,1,1]),Ce(ae.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+ae.rank+"."}),Ce(S==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+S}),Ce(zr(a,U),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+U+"'"}),y!=null&&Ce(on(l),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+y+" but got pad "+l+"."});var be=Pn(ae.shape,c,a,U,l,y,S),Se=He.runKernelFunc(function(Ie,Me){var qe=Ie.maxPool3d(ae,be);return Me([ae,qe]),qe},{x:ae},function(Ie,Me){var qe=Me[0],Ye=Me[1];return{x:function(){return function(Xe,at,gt,bt,_t,jt,Qt,sn){var Zt=Ze(Xe,"dy","maxPool3dBackprop"),rn=Ze(at,"input","maxPool3dBackprop"),Sn=Ze(gt,"output","maxPool3dBackprop"),Bn=Zt,Mn=rn,fr=Sn,yr=!1;rn.rank===4&&(yr=!0,Bn=Zt.as5D(1,Zt.shape[0],Zt.shape[1],Zt.shape[2],Zt.shape[3]),Mn=rn.as5D(1,rn.shape[0],rn.shape[1],rn.shape[2],rn.shape[3]),fr=Sn.as5D(1,Sn.shape[0],Sn.shape[1],Sn.shape[2],Sn.shape[3])),Ce(Bn.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+Bn.rank+"."}),Ce(Mn.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+Mn.rank+"."}),Ce(fr.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+fr.rank+"."}),jt==null&&(jt=[1,1,1]),Ce(zr(_t,jt),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+_t+" and dilations '"+jt+"'"}),sn!=null&&Ce(on(Qt),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+sn+" but got pad "+Qt+"."});var Cr=Pn(Mn.shape,bt,_t,jt,Qt,sn),Nr=He.runKernelFunc(function(Ar){return Ar.maxPool3dBackprop(Bn,Mn,fr,Cr)},{dy5D:Bn,input5D:Mn});return yr?Nr.as4D(Nr.shape[1],Nr.shape[2],Nr.shape[3],Nr.shape[4]):Nr}(Ie,qe,Ye,c,a,U,l,y)}}});return le?Se.as4D(Se.shape[1],Se.shape[2],Se.shape[3],Se.shape[4]):Se}}),$g=Tt({avgPool3d_:function(p,c,a,l,y,S,U){S===void 0&&(S="NDHWC");var G=Ze(p,"x","avgPool3d","float32"),ae=G,le=!1;G.rank===4&&(le=!0,ae=G.as5D(1,G.shape[0],G.shape[1],G.shape[2],G.shape[3])),U==null&&(U=[1,1,1]),Ce(ae.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+ae.rank+"."}),Ce(S==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+S}),Ce(zr(a,U),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+U+"'"}),y!=null&&Ce(on(l),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+y+" but got pad "+l+"."});var be=Pn(ae.shape,c,a,U,l,y,S),Se=He.runKernelFunc(function(Ie){return Ie.avgPool3d(ae,be)},{x:ae},function(Ie){return{x:function(){return function(Me,qe,Ye,Xe,at,gt,bt){var _t=Ze(Me,"dy","avgPool3dBackprop"),jt=Ze(qe,"input","avgPool3dBackprop"),Qt=_t,sn=jt,Zt=!1;jt.rank===4&&(Zt=!0,Qt=_t.as5D(1,_t.shape[0],_t.shape[1],_t.shape[2],_t.shape[3]),sn=jt.as5D(1,jt.shape[0],jt.shape[1],jt.shape[2],jt.shape[3])),Ce(Qt.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+Qt.rank+"."}),Ce(sn.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+sn.rank+"."}),at==null&&(at=[1,1,1]),Ce(zr(Xe,at),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+Xe+" and dilations '"+at+"'"}),bt!=null&&Ce(on(gt),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+bt+" but got pad "+gt+"."});var rn=Pn(sn.shape,Ye,Xe,at,gt,bt),Sn=He.runKernelFunc(function(Bn){return Bn.avgPool3dBackprop(Qt,sn,rn)},{dy5D:Qt,input5D:sn});return Zt?Sn.as4D(Sn.shape[1],Sn.shape[2],Sn.shape[3],Sn.shape[4]):Sn}(Ie,ae,c,a,U,l,y)}}});return Se=Se.cast(ae.dtype),le?Se.as4D(Se.shape[1],Se.shape[2],Se.shape[3],Se.shape[4]):Se}}),_0=Tt({maxPoolWithArgmax_:function(p,c,a,l,y){y===void 0&&(y=!1);var S=Ze(p,"x","maxPoolWithArgmax"),U={filterSize:c,strides:a,pad:l,includeBatchInIndex:y},G=He.runKernel("MaxPoolWithArgmax",{x:S},U);return{result:G[0],indexes:G[1]}}}),Eu=Tt({slice_:function(p,c,a){var l,y,S=Ze(p,"x","slice");if(S.rank===0)throw new Error("Slicing scalar is not possible");(l=typeof c=="number"?[c].concat(new Array(S.rank-1).fill(0)):c.length<S.rank?c.concat(new Array(S.rank-c.length).fill(0)):c.slice()).forEach(function(ae){Ce(ae!==-1,function(){return"slice() does not support negative begin indexing."})}),y=(y=a==null?new Array(S.rank).fill(-1):typeof a=="number"?[a].concat(new Array(S.rank-1).fill(-1)):a.length<S.rank?a.concat(new Array(S.rank-a.length).fill(-1)):a).map(function(ae,le){return ae>=0?ae:(Ce(ae===-1,function(){return"Negative size values should be exactly -1 but got "+ae+" for the slice() size at index "+le+"."}),S.shape[le]-l[le])}),oh(S,l,y);var U=S.shape,G={begin:l,size:y};return He.runKernelFunc(function(ae){return ae.slice(S,l,y)},{x:S},function(ae){for(var le=[],be=0;be<ae.rank;be++)le.push([l[be],U[be]-l[be]-y[be]]);return{x:function(){return El(ae,le)}}},"Slice",G)}}),E0=Tt({slice1d_:function(p,c,a){var l=Ze(p,"x","slice1d");return Ce(l.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+l.rank+" tensor"}),Eu(l,[c],[a])}}),vp=Tt({slice2d_:function(p,c,a){var l=Ze(p,"x","slice2d");return Ce(l.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+l.rank+" tensor"}),Eu(l,c,a)}}),C0=Tt({slice3d_:function(p,c,a){var l=Ze(p,"x","slice3d");return Ce(l.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+l.rank+" tensor"}),Eu(l,c,a)}}),eg=Tt({slice4d_:function(p,c,a){var l=Ze(p,"x","slice4d");return Ce(l.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+l.rank+" tensor"}),Eu(l,c,a)}});function od(p,c,a,l,y){return c.rank<a.rank&&(c=c.reshape(Ea(c.shape,l))),p.rank<a.rank&&(p=p.reshape(Ea(p.shape,l))),{x:function(){var S=p.mul(a.equal(c).cast(p.dtype));return y==null?S:S.transpose(y)}}}var cm=Tt({all_:function(p,c,a){c===void 0&&(c=null),a===void 0&&(a=!1);var l=Ze(p,"x","all","bool"),y=Tn(c,l.shape),S=y,U=Fs(S,l.rank);U!=null&&(l=l.transpose(U),S=Rs(S.length,l.rank));var G=He.runKernelFunc(function(le){return le.all(l,S)},{$x:l});if(a){var ae=Ea(G.shape,y);return G.reshape(ae)}return G}}),yh=Tt({any_:function(p,c,a){c===void 0&&(c=null),a===void 0&&(a=!1);var l=Ze(p,"x","any","bool"),y=Tn(c,l.shape),S=y,U=Fs(S,l.rank);U!=null&&(l=l.transpose(U),S=Rs(S.length,l.rank));var G=He.runKernelFunc(function(le){return le.any(l,S)},{$x:l});if(a){var ae=Ea(G.shape,y);return G.reshape(ae)}return G}}),A0=Tt({argMax_:function(p,c){c===void 0&&(c=0);var a=Ze(p,"x","argMax");c==null&&(c=0);var l=Tn(c,a.shape),y=Fs(l,a.rank);y!=null&&(a=a.transpose(y),l=Rs(l.length,a.rank));var S={axis:l[0]},U=[a];return He.runKernelFunc(function(G,ae){var le=G.argMax(a,l[0]);return ae([a]),le},{x:a},function(G,ae){var le=ae[0];return{x:function(){return Ri(le)}}},"ArgMax",S,U)}}),tg=Tt({argMin_:function(p,c){c===void 0&&(c=0);var a=Ze(p,"x","argMin");c==null&&(c=0);var l=Tn(c,a.shape),y=Fs(l,a.rank);return y!=null&&(a=a.transpose(y),l=Rs(l.length,a.rank)),He.runKernelFunc(function(S,U){var G=S.argMin(a,l[0]);return U([a]),G},{$x:a},function(S,U){var G=U[0];return{$x:function(){return Ri(G)}}})}}),ng=Tt({logSumExp_:function(p,c,a){c===void 0&&(c=null),a===void 0&&(a=!1);var l=Ze(p,"x","logSumExp"),y=Tn(c,l.shape),S=l.max(y,!0),U=l.sub(S).exp().sum(y).log(),G=S.reshape(U.shape).add(U);if(a){var ae=Ea(G.shape,y);return G.reshape(ae)}return G}}),Kg=Tt({max_:function(p,c,a){c===void 0&&(c=null),a===void 0&&(a=!1);var l=Ze(p,"x","max"),y=l,S=Tn(c,l.shape),U=S,G=Fs(U,l.rank);G!=null&&(l=l.transpose(G),U=Rs(U.length,l.rank));var ae=[l],le=He.runKernelFunc(function(Se,Ie){var Me=Se.max(l,U);return Ie([y,Me]),Me},{x:l},function(Se,Ie){return od(Se,Ie[1],Ie[0],S,G)},"Max",{axes:U},ae,[!0]);if(a){var be=Ea(le.shape,S);le=le.reshape(be)}return le}}),Lf=Tt({mean_:function(p,c,a){c===void 0&&(c=null),a===void 0&&(a=!1);var l=Ze(p,"x","mean"),y=Tn(c,l.shape),S=Qe(pa(l.shape,y)[1]);return R(function(U){var G=Mr(S);return{value:(G.dtype===U.dtype?U:U.cast(G.dtype)).div(G).sum(c,a),gradFunc:function(ae){var le=U.shape.slice();return y.forEach(function(be){le[be]=1}),ae.reshape(le).mul(Xu(U.shape,"float32")).div(S)}}})(l)}}),rg=Tt({min_:function(p,c,a){c===void 0&&(c=null),a===void 0&&(a=!1);var l=Ze(p,"x","min"),y=l,S=Tn(c,l.shape),U=S,G=Fs(U,l.rank);G!=null&&(l=l.transpose(G),U=Rs(U.length,l.rank));var ae=[l],le=He.runKernelFunc(function(Se,Ie){var Me=Se.min(l,U);return Ie([y,Me]),Me},{x:l},function(Se,Ie){return od(Se,Ie[1],Ie[0],S,G)},"Min",{axes:U},ae,[!0]);if(a){var be=Ea(le.shape,S);le=le.reshape(be)}return le}}),O0=Tt({moments_:function(p,c,a){c===void 0&&(c=null),a===void 0&&(a=!1);var l=Tn(c,(p=Ze(p,"x","moments")).shape),y=p.mean(l,a),S=y.shape;return a||(S=Ea(y.shape,l)),{mean:y,variance:p.toFloat().sub(y.reshape(S)).square().mean(l,a)}}}),bh=Tt({sum_:function(p,c,a){c===void 0&&(c=null),a===void 0&&(a=!1);var l=Ze(p,"x","sum");l.dtype==="bool"&&(l=l.toInt());var y=Tn(c,l.shape);return R(function(S){var U=Fs(y,S.rank),G=y,ae=S;U!=null&&(ae=S.transpose(U),G=Rs(G.length,S.rank));var le=function(Me){var qe=S.shape.slice();return y.forEach(function(Ye){qe[Ye]=1}),Me.reshape(qe).mul(Xu(S.shape,"float32"))},be={axes:G},Se=He.runKernelFunc(function(Me){return Me.sum(ae,G)},{x:ae},function(Me){return{x:function(){return le(Me)}}},"Sum",be);if(a){var Ie=Ea(Se.shape,y);Se=Se.reshape(Ie)}return{value:Se,gradFunc:le}})(l)}}),lm=Tt({prod_:function(p,c,a){c===void 0&&(c=null),a===void 0&&(a=!1);var l=Ze(p,"x","prod");l.dtype==="bool"&&(l=l.toInt());var y=Tn(c,l.shape),S=Fs(y,l.rank),U=y,G=l;S!=null&&(G=l.transpose(S),U=Rs(U.length,l.rank));var ae=He.runKernelFunc(function(be){return be.prod(G,U)},{permutedX:G});if(a){var le=Ea(ae.shape,y);ae=ae.reshape(le)}return ae}}),xh=Tt({elu_:function(p){var c=Ze(p,"x","elu");return He.runKernelFunc(function(a,l){var y=a.elu(c);return l([y]),y},{$x:c},function(a,l){var y=l[0];return{$x:function(){return He.runKernelFunc(function(S){return S.eluDer(a,y)},{dy:a,y})}}})}}),yp=Tt({leakyRelu_:function(p,c){c===void 0&&(c=.2);var a=Ze(p,"x","leakyRelu");return Ds(Mr(c).mul(a),a)}}),Cu=Tt({prelu_:function(p,c){var a=Ze(p,"x","prelu"),l=Ze(c,"alpha","prelu");return He.runKernelFunc(function(y,S){var U=y.prelu(a,l);return S([a,l]),U},{x:a,alpha:l},function(y,S){var U=S[0],G=S[1],ae=U.greater(0);return{x:function(){return Ts(ae,y,y.mul(G))},alpha:function(){var le=Ts(ae,Ri(y),y.mul(U)),be=Xs(G.shape,y.shape);return be.length>0&&(le=le.sum(be)),le.reshape(G.shape)}}},"Prelu")}}),ig=Tt({relu_:function(p){var c=Ze(p,"x","relu");return c.dtype==="bool"?c.toInt():He.runKernelFunc(function(a,l){var y=a.relu(c);return l([c]),y},{x:c},function(a,l){var y=l[0];return{x:function(){return a.mulStrict(y.step().toFloat())}}},"Relu")}}),Xg=Tt({relu6_:function(p){var c=Ze(p,"x","relu6");return c.dtype==="bool"?c.toInt():He.runKernelFunc(function(a,l){var y=a.relu6(c);return l([c]),y},{x:c},function(a,l){var y=l[0],S=y.lessEqual(6).mul(y.step());return{x:function(){return a.mulStrict(S.toFloat())}}},"Relu6")}}),fm=Tt({selu_:function(p){var c=Ze(p,"x","selu");return He.runKernelFunc(function(a,l){var y=a.selu(c);return l([c]),y},{$x:c},function(a,l){var y=l[0];return{$x:function(){var S=y.greater(Mr(0)),U=Mr(yv),G=Mr(bv),ae=a.mul(G),le=a.mul(U).mul(y.toFloat().exp());return Ts(S,ae,le)}}})}}),hm=Tt({localResponseNormalization_:function(p,c,a,l,y){c===void 0&&(c=5),a===void 0&&(a=1),l===void 0&&(l=1),y===void 0&&(y=.5);var S=Ze(p,"x","localResponseNormalization");Ce(S.rank===4||S.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+S.rank+"."}),Ce(on(c),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+c+"."});var U=S,G=!1;S.rank===3&&(G=!0,U=S.as4D(1,S.shape[0],S.shape[1],S.shape[2]));var ae=He.runKernelFunc(function(le,be){var Se=le.localResponseNormalization4D(U,c,a,l,y);return be([U,Se]),Se},{x4D:U},function(le,be){var Se=be[0],Ie=be[1];return{x4D:function(){return He.runKernelFunc(function(Me){return Me.LRNGrad(le,Se,Ie,c,a,l,y)},{})}}});return G?ae.as3D(ae.shape[1],ae.shape[2],ae.shape[3]):ae}}),Yg=Tt({norm_:function(p,c,a,l){c===void 0&&(c="euclidean"),a===void 0&&(a=null),l===void 0&&(l=!1);var y=function G(ae,le,be){if(be===void 0&&(be=null),ae.rank===0)return ae.abs();if(ae.rank!==1&&be===null)return G(ae.reshape([-1]),le,be);if(ae.rank===1||typeof be=="number"||Array.isArray(be)&&be.length===1){if(le===1)return ae.abs().sum(be);if(le===1/0)return ae.abs().max(be);if(le===-1/0)return ae.abs().min(be);if(le==="euclidean"||le===2)return ae.abs().pow(Mr(2,"int32")).sum(be).sqrt();throw new Error("Error in norm: invalid ord value: "+le)}if(Array.isArray(be)&&be.length===2){if(le===1)return ae.abs().sum(be[0]).max(be[1]-1);if(le===1/0)return ae.abs().sum(be[1]).max(be[0]);if(le===-1/0)return ae.abs().sum(be[1]).min(be[0]);if(le==="fro"||le==="euclidean")return ae.square().sum(be).sqrt();throw new Error("Error in norm: invalid ord value: "+le)}throw new Error("Error in norm: invalid axis: "+be)}(p=Ze(p,"x","norm"),c,a),S=y.shape;if(l){var U=Tn(a,p.shape);S=Ea(y.shape,U)}return y.reshape(S)}}),S0=Tt({basicLSTMCell_:function(p,c,a,l,y,S){var U=Ze(p,"forgetBias","basicLSTMCell"),G=Ze(c,"lstmKernel","basicLSTMCell"),ae=Ze(a,"lstmBias","basicLSTMCell"),le=Ze(l,"data","basicLSTMCell"),be=Ze(y,"c","basicLSTMCell"),Se=Ze(S,"h","basicLSTMCell"),Ie=le.concat(Se,1).matMul(G).add(ae),Me=Ie.shape[0],qe=Ie.shape[1]/4,Ye=[Me,qe],Xe=Ie.slice([0,0],Ye),at=Ie.slice([0,qe],Ye),gt=Ie.slice([0,2*qe],Ye),bt=Ie.slice([0,3*qe],Ye),_t=Xe.sigmoid().mulStrict(at.tanh()).addStrict(be.mulStrict(U.add(gt).sigmoid()));return[_t,_t.tanh().mulStrict(bt.sigmoid())]}}),Y0=Tt({multiRNNCell_:function(p,c,a,l){for(var y=Ze(c,"data","multiRNNCell"),S=tl(a,"c","multiRNNCell"),U=tl(l,"h","multiRNNCell"),G=y,ae=[],le=0;le<p.length;le++){var be=p[le](G,S[le],U[le]);ae.push(be[0]),ae.push(be[1]),G=be[1]}var Se=[],Ie=[];for(le=0;le<ae.length;le+=2)Se.push(ae[le]),Ie.push(ae[le+1]);return[Se,Ie]}}),bf=Tt({movingAverage_:function(p,c,a,l,y){y===void 0&&(y=!0);var S=Ze(p,"v","movingAverage"),U=Ze(c,"x","movingAverage"),G=Ze(a,"decay","movingAverage");In(S,U),Ce(fn(S.shape,U.shape),function(){return"Shape mismatch in v and x"});var ae=Mr(1),le=ae.sub(G),be=U.sub(S).mul(le);if(y){Ce(l!=null,function(){return"When using zeroDebias: true, step is required."});var Se=Ze(l,"step","movingAverage");be=be.div(ae.sub(Mu(G,Se)))}return S.add(be)}}),Bd=Tt({stridedSlice_:function(p,c,a,l,y,S,U,G,ae){if(y===void 0&&(y=0),S===void 0&&(S=0),U===void 0&&(U=0),G===void 0&&(G=0),ae===void 0&&(ae=0),l==null&&(l=new Array(c.length)),U!==0)throw new Error("ellipsis mask is not yet supported");var le=Ze(p,"x","stridedSlice"),be=Sc(G),Se=le.shape.slice();be.forEach(function(Xe){c[Xe]=0,a[Xe]=1,Se.splice(Xe,0,1)}),le=le.reshape(Se);for(var Ie=0;Ie<le.rank;Ie++)c[Ie]=kl(y,c,l,le.shape,Ie),a[Ie]=Ys(S,a,l,le.shape,Ie),l[Ie]=l[Ie]||1;var Me=Sc(ae);Me.forEach(function(Xe){a[Xe]=c[Xe]+1,l[Xe]=1});var qe=wl(c,a,l),Ye=qe.filter(function(Xe,at){return Me.indexOf(at)===-1});return l.every(function(Xe){return Xe===1})?Eu(le,c,qe).reshape(Ye):He.runKernelFunc(function(Xe){return Xe.stridedSlice(le,c,a,l)},{$x:le}).reshape(Ye)}}),og=Tt({topk_:function(p,c,a){c===void 0&&(c=1),a===void 0&&(a=!0);var l=Ze(p,"x","topk");if(l.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var y=l.shape[l.shape.length-1];if(c>y)throw new Error("'k' passed to topk() must be <= the last dimension ("+y+") but got "+c);var S=He.runKernelFunc(function(U){return U.topk(l,c,a)},{$x:l});return{values:S[0],indices:S[1]}}}),D0=Tt({scatterND_:function(p,c,a){var l=Ze(p,"indices","scatterND","int32"),y=Ze(c,"updates","scatterND");return ih(y,l,a),He.runKernelFunc(function(S){return S.scatterND(l,y,a)},{indices:l,updates:y},null,"ScatterNd",{shape:a})}}),zf=Tt({fft_:function(p){Ce(p.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+p.dtype+"."});var c=p.shape[p.shape.length-1],a=p.size/c,l=p.as2D(a,c);return He.runKernelFunc(function(y){return y.fft(l)},{input:p}).reshape(p.shape)}}),pu=Tt({ifft_:function(p){Ce(p.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+p.dtype+"."});var c=p.shape[p.shape.length-1],a=p.size/c,l=p.as2D(a,c);return He.runKernelFunc(function(y){return y.ifft(l)},{input:p}).reshape(p.shape)}}),bp=Tt({rfft_:function(p,c){Ce(p.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+p.dtype});var a,l=p.shape[p.shape.length-1],y=p.size/l;if(c!=null&&c<l){var S=p.shape.map(function(at){return 0}),U=p.shape.map(function(at){return at});U[p.shape.length-1]=c,a=p.slice(S,U),l=c}else if(c!=null&&c>l){var G=p.shape.map(function(at){return at});G[p.shape.length-1]=c-l,a=p.concat(Io(G),p.shape.length-1),l=c}else a=p;var ae=a.zerosLike(),le=aa(a,ae).as2D(y,l),be=zf(le),Se=Math.floor(l/2)+1,Ie=ms(be),Me=Ks(be),qe=Ie.split([Se,l-Se],Ie.shape.length-1),Ye=Me.split([Se,l-Se],Me.shape.length-1),Xe=a.shape.slice();return Xe[a.shape.length-1]=Se,aa(qe[0],Ye[0]).reshape(Xe)}}),dm=Tt({irfft_:function(p){var c=p.shape[p.shape.length-1],a=p.size/c;if(c<=2){var l=p.as2D(a,c),y=pu(l);return ms(y)}var S=[a,2*(c-1)],U=ms(p).as2D(a,c),G=Ks(p).as2D(a,c),ae=U.slice([0,1],[a,c-2]).reverse(1),le=G.slice([0,1],[a,c-2]).reverse(1).mul(Mr(-1)),be=U.concat(ae,1),Se=G.concat(le,1);return l=aa(be,Se).as2D(S[0],S[1]),y=pu(l),ms(y)}}),ag=Object.freeze({fft:zf,ifft:pu,rfft:bp,irfft:dm}),T0=Tt({sparseToDense_:function(p,c,a,l){l===void 0&&(l=0);var y=Ze(p,"sparseIndices","sparseToDense","int32"),S=Ze(c,"sparseValues","sparseToDense"),U=Ze(l,"defaultValue","sparseToDense",S.dtype);return function(G,ae,le,be){if(G.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+G.dtype+".");if(G.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+G.shape+".");var Se=G.rank>0?G.shape[0]:1,Ie=G.rank>1?G.shape[1]:1;if(le.length!==Ie)throw new Error("outputShape has incorrect number of elements:, "+le.length+", should be: "+Ie+".");var Me=ae.size;if(ae.rank!==0&&(ae.rank!==1||Me!==Se))throw new Error("sparseValues has incorrect shape "+ae.shape+", should be [] or ["+Se+"]");if(ae.dtype!==be.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(y,S,a,U),He.runKernelFunc(function(G){return G.sparseToDense(y,S,a,U)},{$sparseIndices:y,$sparseValues:S,$defaultValue:U})}}),sg=Tt({gatherND_:function(p,c){var a=Ze(c,"indices","gatherND","int32"),l=Ze(p,"x","gatherND");return He.runKernelFunc(function(y){return y.gatherND(l,a)},{x:l,indices:a},null,"GatherNd")}}),ad=Tt({diag_:function(p){var c=Ze(p,"x","diag").flatten(),a=p.shape.concat(p.shape);return He.runKernelFunc(function(l){return l.diag(c)},{$x:c}).reshape(a)}}),xv=Tt({dropout_:function(p,c,a,l){var y=Ze(p,"x","dropout");if(Ce(y.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+y.dtype+" tensor instead."}),Ce(c>=0&&c<1,function(){return"rate must be a float in the range [0, 1), but got "+c+"."}),c===0)return p instanceof $t?y.clone():y;var S=function(ae,le){if(le==null)return ae.shape.slice();if(fn(ae.shape,le))return le;if(ae.shape.length===le.length){for(var be=[],Se=0;Se<ae.shape.length;Se++)le[Se]==null&&ae.shape[Se]!=null?be.push(ae.shape[Se]):be.push(le[Se]);return be}return le}(y,a),U=1-c,G=im(S,0,1,"float32",l).add(U).floor().div(U);return y.mul(G)}});function ug(p,c,a){for(var l=1-p%2,y=new Float32Array(p),S=0;S<p;++S){var U=2*Math.PI*S/(p+l-1);y[S]=c-a*Math.cos(U)}return Cc(y,"float32")}var au,pm=Tt({hannWindow_:function(p){return ug(p,.5,.5)}}),Pd=Tt({hammingWindow_:function(p){return ug(p,.54,.46)}}),cg=Tt({frame_:function(p,c,a,l,y){l===void 0&&(l=!1),y===void 0&&(y=0);for(var S=0,U=[];S+c<=p.size;)U.push(Eu(p,S,c)),S+=a;if(l)for(;S<p.size;){var G=S+c-p.size,ae=$a([Eu(p,S,c-G),Nu([G],y)]);U.push(ae),S+=a}return U.length===0?sc([],[0,c]):$a(U).as2D(U.length,c)}}),mm=Tt({stft_:function(p,c,a,l,y){var S;y===void 0&&(y=pm),l==null&&(S=c,l=Math.floor(Math.pow(2,Math.ceil(Math.log(S)/Math.log(2)))));for(var U=cg(p,c,a),G=Kt(U,y(c)),ae=[],le=0;le<U.shape[0];le++)ae.push(bp(G.slice([le,0],[1,c]),l));return $a(ae)}}),lg=Object.freeze({hannWindow:pm,hammingWindow:Pd,frame:cg,stft:mm}),fg=function(p,c,a){return a===void 0&&(a=1),M(this,void 0,void 0,function(){var l,y,S,U,G,ae,le,be,Se,Ie,Me,qe,Ye,Xe;return V(this,function(at){switch(at.label){case 0:return l=Ze(p,"predictions","inTopK"),y=Ze(c,"targets","inTopK"),Ce(l.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+l.rank}),Ce(l.rank-1===y.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+l.rank+" and targets rank "+y.rank}),Wt(l.shape.slice(0,l.shape.length-1),y.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),S=l.shape[l.shape.length-1],Ce(a>0&&a<=S,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+S+"), but got "+a}),[4,l.data()];case 1:return U=at.sent(),[4,y.data()];case 2:for(G=at.sent(),ae=[U.length/S,S],be=ae[1],Se=tr("bool",le=ae[0]),Ie=0;Ie<le;Ie++){for(Me=Ie*be,qe=U.subarray(Me,Me+be),Ye=[],Xe=0;Xe<qe.length;Xe++)Ye.push({value:qe[Xe],index:Xe});for(Ye.sort(function(gt,bt){return bt.value-gt.value}),Se[Ie]=0,Xe=0;Xe<a;Xe++)if(Ye[Xe].index===G[Ie]){Se[Ie]=1;break}}return p!==l&&l.dispose(),c!==y&&y.dispose(),[2,la(Se,y.shape,"bool")]}})})};(function(p){p[p.NONE=0]="NONE",p[p.MEAN=1]="MEAN",p[p.SUM=2]="SUM",p[p.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(au||(au={}));var sd=Tt({absoluteDifference_:function(p,c,a,l){l===void 0&&(l=au.SUM_BY_NONZERO_WEIGHTS);var y=Ze(p,"labels","absoluteDifference"),S=Ze(c,"predictions","absoluteDifference"),U=null;a!=null&&(U=Ze(a,"weights","absoluteDifference")),Wt(y.shape,S.shape,"Error in absoluteDifference: ");var G=y.sub(S).abs();return Hl(G,U,l)}}),Hl=Tt({computeWeightedLoss_:function(p,c,a){a===void 0&&(a=au.SUM_BY_NONZERO_WEIGHTS);var l=Ze(p,"losses","computeWeightedLoss"),y=null;c!=null&&(y=Ze(c,"weights","computeWeightedLoss"));var S=y==null?l:l.mul(y);if(a===au.NONE)return S;if(a===au.SUM)return S.sum();if(a===au.MEAN){if(y==null)return S.mean();var U=l.size/y.size,G=S.sum().div(y.sum());return U>1?G.div(Mr(U)):G}if(a===au.SUM_BY_NONZERO_WEIGHTS){if(y==null)return S.sum().div(Mr(l.size));var ae=y.mul(Xu(l.shape)).notEqual(Mr(0)).sum().toFloat();return S.sum().div(ae)}throw Error("Unknown reduction: "+a)}}),N0=Tt({cosineDistance_:function(p,c,a,l,y){y===void 0&&(y=au.SUM_BY_NONZERO_WEIGHTS);var S=Ze(p,"labels","cosineDistance"),U=Ze(c,"predictions","cosineDistance"),G=null;l!=null&&(G=Ze(l,"weights","cosineDistance")),Wt(S.shape,U.shape,"Error in cosineDistance: ");var ae=Mr(1).sub(S.mul(U).sum(a,!0));return Hl(ae,G,y)}}),I0=Tt({hingeLoss_:function(p,c,a,l){l===void 0&&(l=au.SUM_BY_NONZERO_WEIGHTS);var y=Ze(p,"labels","hingeLoss"),S=Ze(c,"predictions","hingeLoss"),U=null;a!=null&&(U=Ze(a,"weights","hingeLoss")),Wt(y.shape,S.shape,"Error in hingeLoss: ");var G=Mr(1);y=Mr(2).mul(y).sub(G);var ae=G.sub(y.mul(S)).relu();return Hl(ae,U,l)}}),wh=Tt({huberLoss_:function(p,c,a,l,y){l===void 0&&(l=1),y===void 0&&(y=au.SUM_BY_NONZERO_WEIGHTS);var S=Ze(p,"labels","huberLoss"),U=Ze(c,"predictions","huberLoss"),G=null;a!=null&&(G=Ze(a,"weights","huberLoss")),Wt(S.shape,U.shape,"Error in huberLoss: ");var ae=Mr(l),le=U.sub(S).abs(),be=yl(le,ae),Se=le.sub(be),Ie=Mr(.5).mul(be.square()).add(ae.mul(Se));return Hl(Ie,G,y)}}),gm=Tt({logLoss_:function(p,c,a,l,y){l===void 0&&(l=1e-7),y===void 0&&(y=au.SUM_BY_NONZERO_WEIGHTS);var S=Ze(p,"labels","logLoss"),U=Ze(c,"predictions","logLoss"),G=null;a!=null&&(G=Ze(a,"weights","logLoss")),Wt(S.shape,U.shape,"Error in logLoss: ");var ae=Mr(1),le=Mr(l),be=S.mul(U.add(le).log()).neg().sub(ae.sub(S).mul(ae.sub(U).add(le).log()));return Hl(be,G,y)}}),J0=Tt({meanSquaredError_:function(p,c,a,l){l===void 0&&(l=au.SUM_BY_NONZERO_WEIGHTS);var y=Ze(p,"labels","meanSquaredError"),S=Ze(c,"predictions","meanSquaredError"),U=null;a!=null&&(U=Ze(a,"weights","meanSquaredError")),Wt(y.shape,S.shape,"Error in meanSquaredError: ");var G=y.squaredDifference(S);return Hl(G,U,l)}}),Jg=Tt({sigmoidCrossEntropy_:function(p,c,a,l,y){l===void 0&&(l=0),y===void 0&&(y=au.SUM_BY_NONZERO_WEIGHTS);var S=Ze(p,"multiClassLabels","sigmoidCrossEntropy"),U=Ze(c,"logits","sigmoidCrossEntropy"),G=null;if(a!=null&&(G=Ze(a,"weights","sigmoidCrossEntropy")),Wt(S.shape,U.shape,"Error in sigmoidCrossEntropy: "),l>0){var ae=Mr(l),le=Mr(1),be=Mr(.5);S=S.mul(le.sub(ae)).add(be.mul(ae))}var Se=function(Ie,Me){var qe=Ze(Ie,"labels","sigmoidCrossEntropyWithLogits"),Ye=Ze(Me,"logits","sigmoidCrossEntropyWithLogits");Wt(qe.shape,Ye.shape,"Error in sigmoidCrossEntropyWithLogits: ");var Xe=Ye.relu(),at=Ye.mul(qe),gt=Ye.abs().neg().exp().log1p();return Xe.sub(at).add(gt)}(S,U);return Hl(Se,G,y)}}),hg=Tt({softmaxCrossEntropy_:function(p,c,a,l,y){l===void 0&&(l=0),y===void 0&&(y=au.SUM_BY_NONZERO_WEIGHTS);var S=Ze(p,"onehotLabels","softmaxCrossEntropy"),U=Ze(c,"logits","softmaxCrossEntropy"),G=null;if(a!=null&&(G=Ze(a,"weights","softmaxCrossEntropy")),Wt(S.shape,U.shape,"Error in softmaxCrossEntropy: "),l>0){var ae=Mr(l),le=Mr(1),be=Mr(S.shape[1]);S=S.mul(le.sub(ae)).add(ae.div(be))}var Se=function(Ie,Me,qe){if(qe===void 0&&(qe=-1),qe===-1&&(qe=Me.rank-1),qe!==Me.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+Me.rank+" and dim was "+qe);return R(function(Ye,Xe,at){var gt=Xe.logSumExp([qe],!0),bt=Xe.toFloat().sub(gt);return at([Ye,bt]),{value:bt.mul(Ye).neg().sum([qe]),gradFunc:function(_t,jt){var Qt=jt[0],sn=jt[1],Zt=Ea(_t.shape,[qe]);return[_t.reshape(Zt).mul(Qt.toFloat().sub(sn.exp())),_t.reshape(Zt).mul(sn.exp().sub(Qt.toFloat()))]}}})(Ie,Me)}(S,U);return Hl(Se,G,y)}}),ii=Object.freeze({get Reduction(){return au},absoluteDifference:sd,computeWeightedLoss:Hl,cosineDistance:N0,hingeLoss:I0,huberLoss:wh,logLoss:gm,meanSquaredError:J0,sigmoidCrossEntropy:Jg,softmaxCrossEntropy:hg});function P(p,c){return c===void 0&&(c=!1),He.tidy(function(){if(p.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+p.shape.length+"D Tensor.");for(var a=p.shape[0],l=p.shape[1],y=Pf(a),S=p.clone(),U=sc([[1]],[1,1]),G=U.clone(),ae=a>=l?l:a,le=function(Se){var Ie,Me=S,qe=G,Ye=y;Ie=He.tidy(function(){var Xe=S.slice([Se,Se],[a-Se,1]),at=Xe.norm(),gt=S.slice([Se,Se],[1,1]),bt=sc([[-1]]).where(gt.greater(0),sc([[1]])),_t=gt.sub(bt.mul(at)),jt=Xe.div(_t);G=jt.shape[0]===1?U.clone():U.concat(jt.slice([1,0],[jt.shape[0]-1,jt.shape[1]]),0);var Qt=bt.matMul(_t).div(at).neg(),sn=S.slice([Se,0],[a-Se,l]),Zt=Qt.mul(G),rn=G.transpose();if(Se===0)S=sn.sub(Zt.matMul(rn.matMul(sn)));else{var Sn=sn.sub(Zt.matMul(rn.matMul(sn)));S=S.slice([0,0],[Se,l]).concat(Sn,0)}var Bn=Zt.transpose(),Mn=y.slice([0,Se],[a,y.shape[1]-Se]);if(Se===0)y=Mn.sub(Mn.matMul(G).matMul(Bn));else{var fr=Mn.sub(Mn.matMul(G).matMul(Bn));y=y.slice([0,0],[a,Se]).concat(fr,1)}return[G,S,y]}),G=Ie[0],S=Ie[1],y=Ie[2],Oa([Me,qe,Ye])},be=0;be<ae;++be)le(be);return!c&&a>l&&(y=y.slice([0,0],[a,l]),S=S.slice([0,0],[l,l])),[y,S]})}var E=Tt({bandPart_:function(p,c,a){if(c%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+c+".");if(a%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+a+".");var l=Ze(p,"a","bandPart");if(l.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+l.rank+".");var y=l.shape,S=l.shape.slice(-2),U=S[0],G=S[1];if(!(c<=U))throw new Error("bandPart(): numLower ("+c+") must not be greater than the number of rows ("+U+").");if(!(a<=G))throw new Error("bandPart(): numUpper ("+a+") must not be greater than the number of columns ("+G+").");c<0&&(c=U),a<0&&(a=G);var ae=rf(0,U,1,"int32").reshape([-1,1]),le=rf(0,G,1,"int32"),be=js(ae,le),Se=zu(be.lessEqual(Mr(+c,"int32")),be.greaterEqual(Mr(-a,"int32"))),Ie=Io([U,G],l.dtype);return Bc(Qd(l.reshape([-1,U,G])).map(function(Me){return Ts(Se,Me,Ie)})).reshape(y)}}),_=Tt({gramSchmidt_:function(p){var c;if(Array.isArray(p)){c=!1,Ce(p!=null&&p.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var a=p[0].shape[0],l=function(ae){Ce(p[ae].shape[0]===a,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+p[ae].shape[0]+" vs. "+a+")"})},y=1;y<p.length;++y)l(y)}else c=!0,p=_o(p,p.shape[0],0).map(function(ae){return cc(ae,[0])});Ce(p.length<=p[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+p.length+") exceeds number of dimensions ("+p[0].shape[0]+")."});var S=[],U=p,G=function(ae){S.push(He.tidy(function(){var le=U[ae];if(ae>0)for(var be=0;be<ae;++be){var Se=bh(S[be].mulStrict(le)).mul(S[be]);le=le.sub(Se)}return le.div(Yg(le,"euclidean"))}))};for(y=0;y<p.length;++y)G(y);return c?Bc(S,0):S}}),k=Tt({qr_:function(p,c){if(c===void 0&&(c=!1),p.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+p.rank);if(p.rank===2)return P(p,c);var a=p.shape.slice(0,p.shape.length-2).reduce(function(S,U){return S*U}),l=[],y=[];return Qd(p.reshape([a,p.shape[p.shape.length-2],p.shape[p.shape.length-1]]),0).forEach(function(S){var U=P(S,c),G=U[0],ae=U[1];l.push(G),y.push(ae)}),[Bc(l,0).reshape(p.shape),Bc(y,0).reshape(p.shape)]}}),D=Object.freeze({bandPart:E,gramSchmidt:_,qr:k});function q(p,c,a,l,y,S){l==null&&(l=.5),y==null&&(y=Number.NEGATIVE_INFINITY),S==null&&(S=0);var U=p.shape[0];return a=Math.min(a,U),Ce(0<=l&&l<=1,function(){return"iouThreshold must be in [0, 1], but was '"+l+"'"}),Ce(p.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+p.rank+"'"}),Ce(p.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+p.shape[1]}),Ce(c.rank===1,function(){return"scores must be a 1D tensor"}),Ce(c.shape[0]===U,function(){return"scores has incompatible shape with boxes. Expected "+U+", but was "+c.shape[0]}),Ce(0<=S&&S<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+S+"'"}),{maxOutputSize:a,iouThreshold:l,scoreThreshold:y,softNmsSigma:S}}var ee=Tt({resizeBilinear_:function(p,c,a){a===void 0&&(a=!1);var l=Ze(p,"images","resizeBilinear");Ce(l.rank===3||l.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+l.rank+"."}),Ce(c.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+c+"."});var y=l,S=!1;l.rank===3&&(S=!0,y=l.as4D(1,l.shape[0],l.shape[1],l.shape[2]));var U=c[0],G=c[1],ae=He.runKernelFunc(function(le,be){return be([y]),le.resizeBilinear(y,U,G,a)},{x:y},function(le,be){return{x:function(){return He.runKernelFunc(function(Se){return Se.resizeBilinearBackprop(le,be[0],a)},{})}}},"ResizeBilinear",{alignCorners:a,newHeight:U,newWidth:G});return S?ae.as3D(ae.shape[1],ae.shape[2],ae.shape[3]):ae}}),de=Tt({resizeNearestNeighbor_:function(p,c,a){a===void 0&&(a=!1);var l=Ze(p,"images","resizeNearestNeighbor");Ce(l.rank===3||l.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+l.rank+"."}),Ce(c.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+c+"."}),Ce(l.dtype==="float32"||l.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var y=l,S=!1;l.rank===3&&(S=!0,y=l.as4D(1,l.shape[0],l.shape[1],l.shape[2]));var U=c[0],G=c[1],ae=He.runKernelFunc(function(le,be){return be([y]),le.resizeNearestNeighbor(y,U,G,a)},{batchImages:y},function(le,be){return{batchImages:function(){return He.runKernelFunc(function(Se){return Se.resizeNearestNeighborBackprop(le,be[0],a)},{})}}});return S?ae.as3D(ae.shape[1],ae.shape[2],ae.shape[3]):ae}}),_e=Tt({nonMaxSuppression_:function(p,c,a,l,y){l===void 0&&(l=.5),y===void 0&&(y=Number.NEGATIVE_INFINITY);var S=Ze(p,"boxes","nonMaxSuppression"),U=Ze(c,"scores","nonMaxSuppression"),G=q(S,U,a,l,y);a=G.maxOutputSize,l=G.iouThreshold,y=G.scoreThreshold;var ae={maxOutputSize:a,iouThreshold:l,scoreThreshold:y};return He.runKernelFunc(function(le){return le.nonMaxSuppression(S,U,a,l,y)},{boxes:S,scores:U},null,"NonMaxSuppressionV3",ae)}}),Re=Tt({nonMaxSuppressionWithScore_:function(p,c,a,l,y,S){l===void 0&&(l=.5),y===void 0&&(y=Number.NEGATIVE_INFINITY),S===void 0&&(S=0);var U=Ze(p,"boxes","nonMaxSuppression"),G=Ze(c,"scores","nonMaxSuppression"),ae=q(U,G,a,l,y,S),le={maxOutputSize:a=ae.maxOutputSize,iouThreshold:l=ae.iouThreshold,scoreThreshold:y=ae.scoreThreshold,softNmsSigma:S=ae.softNmsSigma},be=He.runKernel("NonMaxSuppressionV5",{boxes:U,scores:G},le);return{selectedIndices:be[0],selectedScores:be[1]}}}),De=Tt({cropAndResize_:function(p,c,a,l,y,S){var U=Ze(p,"image","cropAndResize"),G=Ze(c,"boxes","cropAndResize","float32"),ae=Ze(a,"boxInd","cropAndResize","int32");y=y||"bilinear",S=S||0;var le=G.shape[0];return Ce(U.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+U.rank+"."}),Ce(G.rank===2&&G.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+le+",4] but had shape "+G.shape+"."}),Ce(ae.rank===1&&ae.shape[0]===le,function(){return"Error in cropAndResize: boxInd must be have size ["+le+"] but had shape "+G.shape+"."}),Ce(l.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+l.length+"."}),Ce(l[0]>=1&&l[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+l}),Ce(y==="bilinear"||y==="nearest",function(){return"method must be bilinear or nearest, but was "+y}),He.runKernelFunc(function(be,Se){return be.cropAndResize(U,G,ae,l,y,S)},{images:U,boxes:G,boxInd:ae},null,"CropAndResize",{method:y,extrapolationValue:S,cropSize:l})}}),tt=Object.freeze({resizeBilinear:ee,resizeNearestNeighbor:de,nonMaxSuppression:_e,nonMaxSuppressionAsync:function(p,c,a,l,y){return l===void 0&&(l=.5),y===void 0&&(y=Number.NEGATIVE_INFINITY),M(this,void 0,void 0,function(){var S,U,G,ae,le,be,Se;return V(this,function(Ie){switch(Ie.label){case 0:return S=Ze(p,"boxes","nonMaxSuppressionAsync"),U=Ze(c,"scores","nonMaxSuppressionAsync"),G=q(S,U,a,l,y),a=G.maxOutputSize,l=G.iouThreshold,y=G.scoreThreshold,[4,Promise.all([S.data(),U.data()])];case 1:return ae=Ie.sent(),le=ae[0],be=ae[1],Se=zo(le,be,a,l,y),S!==p&&S.dispose(),U!==c&&U.dispose(),[2,Se]}})})},nonMaxSuppressionWithScore:Re,nonMaxSuppressionWithScoreAsync:function(p,c,a,l,y,S){return l===void 0&&(l=.5),y===void 0&&(y=Number.NEGATIVE_INFINITY),S===void 0&&(S=0),M(this,void 0,void 0,function(){var U,G,ae,le,be,Se,Ie;return V(this,function(Me){switch(Me.label){case 0:return U=Ze(p,"boxes","nonMaxSuppressionAsync"),G=Ze(c,"scores","nonMaxSuppressionAsync"),ae=q(U,G,a,l,y,S),a=ae.maxOutputSize,l=ae.iouThreshold,y=ae.scoreThreshold,S=ae.softNmsSigma,[4,Promise.all([U.data(),G.data()])];case 1:return le=Me.sent(),be=le[0],Se=le[1],Ie=Sa(be,Se,a,l,y,S),U!==p&&U.dispose(),G!==c&&G.dispose(),[2,Ie]}})})},cropAndResize:De}),st=function(p,c){return!(p>0)||c==="linear"},It=function(p,c,a){if(a==null||a==="linear")return p;if(a==="relu")return p.mul(c.step());throw new Error("Gradient for activation "+a+" has not been implemented yet.")},Bt=function(p,c){var a=c,l=Xs(p.shape,c.shape);return l.length>0&&(a=a.sum(l)),a.reshape(p.shape)},mn=function(p,c,a){if(c==="linear")return p;if(c==="relu")return ig(p);if(c==="elu")return xh(p);if(c==="relu6")return Xg(p);if(c==="prelu")return Cu(p,a);throw new Error("Unknown fused activation "+c+".")},xn=Tt({fusedMatMul_:function(p){var c,a=p.a,l=p.b,y=p.transposeA,S=y!==void 0&&y,U=p.transposeB,G=U!==void 0&&U,ae=p.bias,le=p.activation,be=le===void 0?"linear":le,Se=p.preluActivationWeights;if(st(He.state.gradientDepth,be)===!1){var Ie=vf(a,l,S,G);return ae!=null&&(Ie=Ua(Ie,ae)),mn(Ie,be,Se)}var Me=Ze(a,"a","fused matMul"),qe=Ze(l,"b","fused matMul");c=_n(Me,qe),Me=c[0],qe=c[1];var Ye=S?Me.shape[Me.rank-2]:Me.shape[Me.rank-1],Xe=G?qe.shape[qe.rank-1]:qe.shape[qe.rank-2],at=S?Me.shape[Me.rank-1]:Me.shape[Me.rank-2],gt=G?qe.shape[qe.rank-2]:qe.shape[qe.rank-1],bt=Me.shape.slice(0,-2),_t=qe.shape.slice(0,-2),jt=Qe(bt),Qt=Qe(_t);Ce(Me.rank>=2&&qe.rank>=2&&Me.rank===qe.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+Me.rank+" and "+qe.rank+"."}),Ce(fn(bt,_t),function(){return"Error in fused matMul: outer dimensions ("+bt+") and ("+_t+") of Tensors with shapes "+Me.shape+" and "+qe.shape+" must match."}),Ce(Ye===Xe,function(){return"Error in fused matMul: inner shapes ("+Ye+") and ("+Xe+") of Tensors with shapes "+Me.shape+" and "+qe.shape+" and transposeA="+S+" and transposeB="+G+" must match."});var sn,Zt,rn=Me.shape.slice(0,-2).concat([at,gt]),Sn=S?Me.as3D(jt,Ye,at):Me.as3D(jt,at,Ye),Bn=G?qe.as3D(Qt,gt,Xe):qe.as3D(Qt,Xe,gt);ae!=null&&Co(rn,(sn=_n(sn=Ze(ae,"bias","fused matMul"),Me)[0]).shape),Se!=null&&(Zt=Ze(Se,"prelu weights","fused matMul"));var Mn={a:Sn,b:Bn};ae!=null&&(Mn.bias=sn),Se!=null&&(Mn.preluActivationWeights=Zt);var fr=[Sn,Bn];return He.runKernelFunc(function(yr,Cr){var Nr=yr.fusedBatchMatMul({a:Sn,b:Bn,transposeA:S,transposeB:G,bias:sn,activation:be,preluActivationWeights:Zt});return Cr([Sn,Bn,Nr]),Nr},Mn,function(yr,Cr){var Nr=Cr[0],Ar=Cr[1],_r=Cr[2],Yr=It(yr,_r,be),Kr={};return ae!=null&&(Kr={bias:function(){return Bt(sn,Yr)}}),Object.assign(S||G?!S&&G?{a:function(){return Yr.matMul(Ar,!1,!1)},b:function(){return Yr.matMul(Nr,!0,!1)}}:S&&!G?{a:function(){return Ar.matMul(Yr,!1,!0)},b:function(){return Nr.matMul(Yr,!1,!1)}}:{a:function(){return Ar.matMul(Yr,!0,!0)},b:function(){return Yr.matMul(Nr,!0,!0)}}:{a:function(){return Yr.matMul(Ar,!1,!0)},b:function(){return Nr.matMul(Yr,!0,!1)}},Kr)},"_FusedMatMul",{transposeA:S,transposeB:G,activation:be},fr,[!0]).reshape(rn)}}),Fn=Tt({fusedConv2d_:function(p){var c=p.x,a=p.filter,l=p.strides,y=p.pad,S=p.dataFormat,U=S===void 0?"NHWC":S,G=p.dilations,ae=G===void 0?[1,1]:G,le=p.dimRoundingMode,be=p.bias,Se=p.activation,Ie=Se===void 0?"linear":Se,Me=p.preluActivationWeights;if(Ie=Ie||"linear",st(He.state.gradientDepth,Ie)===!1){var qe=rd(c,a,l,y,U,ae,le);return be!=null&&(qe=Ua(qe,be)),mn(qe,Ie,Me)}var Ye=Ze(c,"x","conv2d"),Xe=Ze(a,"filter","conv2d"),at=Ye,gt=!1;Ye.rank===3&&(gt=!0,at=Ye.as4D(1,Ye.shape[0],Ye.shape[1],Ye.shape[2])),Ce(at.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+at.rank+"."}),Ce(Xe.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+Xe.rank+"."}),le!=null&&Ce(on(y),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+le+" but got pad "+y+"."}),Ce(at.shape[3]===Xe.shape[2],function(){return"Error in conv2d: depth of input ("+at.shape[3]+") must match input depth for filter "+Xe.shape[2]+"."}),Ce(zr(l,ae),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+l+" and dilations '"+ae+"'"}),Ce(U==="NHWC",function(){return"Error in conv2d: got dataFormat of "+U+" but only NHWC is currently supported."});var bt,_t,jt=Vn(at.shape,Xe.shape,l,ae,y,le);be!=null&&(bt=_n(bt=Ze(be,"bias","fused conv2d"),Ye)[0],Co(jt.outShape,bt.shape)),Me!=null&&(_t=Ze(Me,"prelu weights","fused conv2d"));var Qt={x:at,filter:Xe};be!=null&&(Qt.bias=bt),Me!=null&&(Qt.preluActivationWeights=_t);var sn=[Xe,at],Zt=He.runKernelFunc(function(rn,Sn){var Bn=rn.fusedConv2d({input:at,filter:Xe,convInfo:jt,bias:bt,activation:Ie,preluActivationWeights:_t});return Sn([Xe,at,Bn]),Bn},Qt,function(rn,Sn){var Bn=Sn,Mn=Bn[0],fr=Bn[1],yr=Bn[2],Cr=It(rn,yr,Ie);Ce(yi(ae),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+ae+"'"});var Nr={};return be!=null&&(Nr={bias:function(){return Bt(bt,Cr)}}),Object.assign({x:function(){return mh(fr.shape,Cr,Mn,l,y)},filter:function(){return Vg(fr,Cr,Mn.shape,l,y)}},Nr)},"FusedConv2D",{convInfo:jt,activation:Ie},sn,[!0]);return gt?Zt.as3D(Zt.shape[1],Zt.shape[2],Zt.shape[3]):Zt}}),Rn=Tt({fusedDepthwiseConv2d_:function(p){var c=p.x,a=p.filter,l=p.strides,y=p.pad,S=p.dataFormat,U=S===void 0?"NHWC":S,G=p.dilations,ae=G===void 0?[1,1]:G,le=p.dimRoundingMode,be=p.bias,Se=p.activation,Ie=Se===void 0?"linear":Se,Me=p.preluActivationWeights;if(st(He.state.gradientDepth,Ie)===!1){var qe=qg(c,a,l,y,U,ae,le);return be!=null&&(qe=Ua(qe,be)),mn(qe,Ie,Me)}var Ye=Ze(c,"x","depthwiseConv2d"),Xe=Ze(a,"filter","depthwiseConv2d"),at=Ye,gt=!1;Ye.rank===3&&(gt=!0,at=Ye.as4D(1,Ye.shape[0],Ye.shape[1],Ye.shape[2])),Ce(at.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+at.rank+"."}),Ce(Xe.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+Xe.rank+"."}),Ce(at.shape[3]===Xe.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+at.shape[3]+") must match the inChannels dimension in filter "+Xe.shape[2]+"."}),ae==null&&(ae=[1,1]),Ce(zr(l,ae),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+l+" and dilations '"+ae+"'"}),le!=null&&Ce(on(y),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+le+" but got pad "+y+"."});var bt,_t,jt=Vn(at.shape,Xe.shape,l,ae,y,le,!0);be!=null&&(bt=_n(bt=Ze(be,"bias","fused conv2d"),Ye)[0],Co(jt.outShape,bt.shape)),Me!=null&&(_t=Ze(Me,"prelu weights","fused depthwiseConv2d"));var Qt={x:at,filter:Xe};be!=null&&(Qt.bias=bt),Me!=null&&(Qt.preluActivationWeights=_t);var sn=[Xe,at],Zt=He.runKernelFunc(function(rn,Sn){var Bn=rn.fusedDepthwiseConv2D({input:at,filter:Xe,convInfo:jt,bias:bt,activation:Ie,preluActivationWeights:_t});return Sn([Xe,at,Bn]),Bn},Qt,function(rn,Sn){Ce(yi(ae),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+ae+"'"});var Bn=Sn[0],Mn=Sn[1],fr=Sn[2],yr=It(rn,fr,Ie),Cr={};return be!=null&&(Cr={bias:function(){return Bt(bt,yr)}}),Object.assign({x:function(){return x0(Mn.shape,yr,Bn,jt)},filter:function(){return id(Mn,yr,Bn.shape,jt)}},Cr)},"FusedDepthwiseConv2D",{convInfo:jt,activation:Ie},sn,[!0]);return gt?Zt.as3D(Zt.shape[1],Zt.shape[2],Zt.shape[3]):Zt}}),Ln=Object.freeze({matMul:xn,conv2d:Fn,depthwiseConv2d:Rn}),Zn=Object.freeze({image:tt,linalg:D,losses:ii,spectral:ag,fused:Ln,signal:lg,add:Ua,addN:Nd,batchNorm:hh,batchNormalization:Ko,batchNorm2d:dh,batchNormalization2d:$0,batchNorm3d:hf,batchNormalization3d:Mf,batchNorm4d:to,batchNormalization4d:df,broadcastTo:pf,clone:jf,div:ts,divNoNan:Gm,eye:Pf,multinomial:du,oneHot:mf,pad:El,pad1d:sl,pad2d:ul,pad3d:rc,pad4d:tm,rand:Lg,randomGamma:Xm,randomNormal:zg,randomUniform:im,square:ed,squaredDifference:fp,tile:Jh,truncatedNormal:Rd,conv1d:y0,conv2d:rd,conv3d:b0,depthwiseConv2d:qg,separableConv2d:gh,conv2dTranspose:Qm,conv3dTranspose:Hg,op:Tt,booleanMaskAsync:m0,complex:aa,real:ms,imag:Ks,concat:$a,concat1d:of,concat2d:Wp,concat3d:Mh,concat4d:jh,split:_o,matMul:vf,dot:Gg,outerProduct:w0,reverse:Uu,reverse1d:X0,reverse2d:pp,reverse3d:mp,reverse4d:vh,maxPool:yf,avgPool:gp,pool:jd,maxPool3d:Zm,avgPool3d:$g,maxPoolWithArgmax:_0,slice:Eu,slice1d:E0,slice2d:vp,slice3d:C0,slice4d:eg,abs:cu,acos:lc,acosh:Es,asin:uf,asinh:Pc,atan:Bh,atanh:Ph,ceil:Rl,clipByValue:ep,cos:Oc,cosh:th,erf:Lh,exp:zh,expm1:jm,floor:xd,log:Ml,log1p:Uh,logSigmoid:Wh,neg:Os,reciprocal:nh,round:Yu,rsqrt:Vh,sigmoid:Ss,sign:lu,isNaN:Gp,isInf:wd,isFinite:rh,sin:$p,sinh:kd,softplus:ln,sqrt:Ju,step:er,tan:ru,tanh:Fo,all:cm,any:yh,argMax:A0,argMin:tg,logSumExp:ng,max:Kg,mean:Lf,min:rg,moments:O0,sum:bh,prod:lm,equal:td,equalStrict:om,greater:Ym,greaterEqual:hp,greaterEqualStrict:dp,greaterStrict:am,less:gf,lessEqual:Uc,lessEqualStrict:K0,lessStrict:Ug,notEqual:sm,notEqualStrict:d0,addStrict:cf,atan2:jl,divStrict:wr,floorDiv:fu,maximum:Ds,maximumStrict:Ro,minimum:yl,minimumStrict:nl,mod:wu,modStrict:Bl,mul:Kt,mulStrict:fc,pow:Mu,powStrict:po,squaredDifferenceStrict:uo,sub:js,subStrict:ju,elu:xh,leakyRelu:yp,prelu:Cu,relu:ig,relu6:Xg,selu:fm,logicalAnd:zu,logicalNot:lp,logicalOr:ph,logicalXor:Bf,where:Ts,whereAsync:Id,buffer:Ki,print:Ka,batchToSpaceND:Vp,cast:qp,cumsum:Hp,depthToSpace:Qf,expandDims:nu,reshape:Fu,spaceToBatchND:Zf,squeeze:cc,stack:Bc,unstack:Qd,setdiff1dAsync:wo,fill:Nu,linspace:Jd,ones:Xu,range:rf,scalar:Mr,tensor:la,tensor1d:Cc,tensor2d:sc,tensor3d:nf,tensor4d:Ac,tensor5d:yd,tensor6d:uc,variable:bd,zeros:Io,onesLike:Iu,zerosLike:Ri,transpose:vt,softmax:Ue,logSoftmax:Je,localResponseNormalization:hm,norm:Yg,gather:um,unsortedSegmentSum:Jm,basicLSTMCell:S0,multiRNNCell:Y0,movingAverage:bf,stridedSlice:Bd,topk:og,scatterND:D0,fft:zf,ifft:pu,rfft:bp,irfft:dm,sparseToDense:T0,gatherND:sg,diag:ad,dropout:xv,hannWindow:pm,hammingWindow:Pd,frame:cg,stft:mm,inTopKAsync:fg});function An(p,c){Array.isArray(p)||(p=[p]),p.forEach(function(a){a!=null&&Ce(a.dtype!=="complex64",function(){return c+" does not support complex64 tensors."})})}function Sr(p,c,a,l,y,S){for(var U=y.strideHeight,G=y.strideWidth,ae=y.dilationHeight,le=y.dilationWidth,be=y.effectiveFilterHeight,Se=y.effectiveFilterWidth,Ie=y.padInfo.top,Me=y.padInfo.left,qe=S==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,Ye=Ki(y.outShape,a),Xe=Ye.values,at=y.outShape[1]*y.outShape[2]*y.outShape[3],gt=y.outShape[2]*y.outShape[3],bt=y.outShape[3],_t=0;_t<y.batchSize;++_t)for(var jt=_t*at,Qt=_t*l[0],sn=0;sn<y.inChannels;++sn)for(var Zt=0;Zt<y.outHeight;++Zt)for(var rn=Zt*U-Ie,Sn=Math.max(0,rn),Bn=Math.min(y.inHeight,be+rn),Mn=jt+Zt*gt,fr=0;fr<y.outWidth;++fr){for(var yr=fr*G-Me,Cr=Math.max(0,yr),Nr=Math.min(y.inWidth,Se+yr),Ar=qe,_r=0,Yr=0,Kr=Sn;Kr<Bn;Kr+=ae){for(var fi=Qt+Kr*l[1],Ti=Cr;Ti<Nr;Ti+=le){var Yi=p[fi+Ti*l[2]+sn];S==="max"&&Yi>Ar?Ar=Yi:S==="avg"&&(_r+=Yi,Yr++)}if(isNaN(Ar))break}Xe[Mn+fr*bt+sn]=S==="avg"?_r/Yr:Ar}return Ye}function Ur(p,c,a,l,y,S){y===void 0&&(y=!1),S===void 0&&(S=!1);for(var U=Ki(l.outShape,"int32"),G=l.strideHeight,ae=l.strideWidth,le=l.dilationHeight,be=l.dilationWidth,Se=l.effectiveFilterHeight,Ie=l.effectiveFilterWidth,Me=l.padInfo.top,qe=l.padInfo.left,Ye=Ki(c,a,p),Xe=0;Xe<l.batchSize;++Xe)for(var at=0;at<l.inChannels;++at)for(var gt=0;gt<l.outHeight;++gt){for(var bt=gt*G-Me,_t=bt;_t<0;)_t+=le;for(var jt=Math.min(l.inHeight,Se+bt),Qt=0;Qt<l.outWidth;++Qt){for(var sn=Qt*ae-qe,Zt=sn;Zt<0;)Zt+=be;for(var rn=Math.min(l.inWidth,Ie+sn),Sn=Number.NEGATIVE_INFINITY,Bn=-1,Mn=_t;Mn<jt;Mn+=le)for(var fr=Mn-bt,yr=Zt;yr<rn;yr+=be){var Cr=yr-sn,Nr=Ye.get(Xe,Mn,yr,at);Nr>Sn&&(Sn=Nr,Bn=y?S?((Xe*l.inHeight+Mn)*l.inWidth+yr)*l.inChannels+at:(Mn*l.inWidth+yr)*l.inChannels+at:fr*Ie+Cr)}U.set(Bn,Xe,gt,Qt,at)}}return U}function Wr(p,c,a,l){if(a==="linear")return p.linear(c);if(a==="relu")return p.relu(c);if(a==="elu")return p.elu(c);if(a==="relu6")return p.relu6(c);if(a==="prelu")return p.prelu(c,l);throw new Error("Activation "+a+" has not been implemented for the CPU backend.")}var ci=function(p){function c(){var a=p.call(this)||this;return a.blockSize=48,a.firstUse=!0,a.data=new qt(a,He),a}return K(c,p),c.prototype.write=function(a,l,y){this.firstUse&&(this.firstUse=!1,W().get("IS_NODE")&&Jf(`
============================
Hi there \u{1F44B}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var S={};return this.data.set(S,{values:a,dtype:y}),S},c.prototype.move=function(a,l,y,S){this.data.set(a,{values:l,dtype:S})},c.prototype.numDataIds=function(){return this.data.numDataIds()},c.prototype.read=function(a){return M(this,void 0,void 0,function(){return V(this,function(l){return[2,this.readSync(a)]})})},c.prototype.readSync=function(a){var l=this.data.get(a),y=l.dtype,S=l.complexTensors;return y==="complex64"?Oi(this.readSync(S.real.dataId),this.readSync(S.imag.dataId)):this.data.get(a).values},c.prototype.bufferSync=function(a){var l=this.readSync(a.dataId),y=l;if(a.dtype==="string")try{y=l.map(function(S){return Fr(S)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ki(a.shape,a.dtype,y)},c.prototype.makeOutput=function(a,l,y){var S=this.write(a,l,y);return He.makeTensorFromDataId(S,l,y,this)},c.prototype.disposeData=function(a){if(this.data.has(a)){var l=this.data.get(a).complexTensors;l!=null&&(l.real.dispose(),l.imag.dispose()),this.data.delete(a)}},c.prototype.time=function(a){return M(this,void 0,void 0,function(){var l;return V(this,function(y){return l=an(),a(),[2,{kernelMs:an()-l}]})})},c.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},c.prototype.complex=function(a,l){var y=this.makeOutput(null,a.shape,"complex64");return this.data.get(y.dataId).complexTensors={real:He.keep(a.clone()),imag:He.keep(l.clone())},y},c.prototype.real=function(a){return this.data.get(a.dataId).complexTensors.real.clone()},c.prototype.imag=function(a){return this.data.get(a.dataId).complexTensors.imag.clone()},c.prototype.slice=function(a,l,y){if(An(a,"slice"),np(a.shape,l,y)){var S=_d(l,a.strides),U=Qe(y);return la(this.readSync(a.dataId).subarray(S,S+U),y,a.dtype)}for(var G=Ki(y,a.dtype),ae=this.bufferSync(a),le=0;le<G.size;++le){var be=G.indexToLoc(le).map(function(Se,Ie){return Se+l[Ie]});G.values[le]=ae.get.apply(ae,be)}return G.toTensor()},c.prototype.stridedSlice=function(a,l,y,S){An(a,"stridedSlice");var U=wl(l,y,S);if(U.some(function(Me){return Me===0}))return la([],U);for(var G=Ki(U,a.dtype),ae=this.bufferSync(a),le=0;le<G.size;le++){for(var be=G.indexToLoc(le),Se=new Array(be.length),Ie=0;Ie<Se.length;Ie++)Se[Ie]=be[Ie]*S[Ie]+l[Ie];G.set.apply(G,[ae.get.apply(ae,Se)].concat(be))}return G.toTensor()},c.prototype.diag=function(a){for(var l=this.readSync(a.dataId),y=Ki([a.size,a.size],a.dtype),S=y.values,U=0;U<l.length;U++)S[U*a.size+U]=l[U];return y.toTensor()},c.prototype.unstack=function(a,l){for(var y=a.shape[l],S=new Array(a.rank-1),U=0,G=0;G<a.rank;G++)G!==l&&(S[U++]=a.shape[G]);var ae=new Array(a.rank).fill(0),le=a.shape.slice();le[l]=1;var be=new Array(y);for(G=0;G<be.length;G++)ae[l]=G,be[G]=this.slice(a,ae,le).reshape(S);return be},c.prototype.reverse=function(a,l){An(a,"reverse");for(var y=Ki(a.shape,a.dtype),S=this.bufferSync(a),U=function(ae){var le=y.indexToLoc(ae),be=le.slice();l.forEach(function(Se){return be[Se]=a.shape[Se]-1-be[Se]}),y.set.apply(y,[S.get.apply(S,be)].concat(le))},G=0;G<y.size;G++)U(G);return y.toTensor()},c.prototype.concat=function(a,l){var y=this;if(a[0].dtype==="complex64"){var S=a.map(function(Me){return ms(Me)}),U=a.map(function(Me){return Ks(Me)});return aa(this.concat(S,l),this.concat(U,l))}var G=a.map(function(Me){var qe=Qe(Me.shape.slice(l));return Me.as2D(-1,qe)}),ae=Ku(G.map(function(Me){return Me.shape}),1),le=Ki(ae,a[0].dtype).values;if(G[0].shape[0]===1){var be=0;G.forEach(function(Me){le.set(y.readSync(Me.dataId),be),be+=Me.size})}else{var Se=0;G.forEach(function(Me){for(var qe=y.readSync(Me.dataId),Ye=0,Xe=0;Xe<Me.shape[0];++Xe)for(var at=Xe*ae[1]+Se,gt=0;gt<Me.shape[1];++gt)le[at+gt]=qe[Ye++];Se+=Me.shape[1]})}var Ie=Ku(a.map(function(Me){return Me.shape}),l);return la(le,Ie,a[0].dtype)},c.prototype.neg=function(a){return An(a,"neg"),this.multiply(Mr(-1),a)},c.prototype.add=function(a,l){return a.dtype==="complex64"||l.dtype==="complex64"?this.broadcastedBinaryComplexOp(a.cast("complex64"),l.cast("complex64"),function(y,S,U,G){return{real:y+U,imag:S+G}}):this.broadcastedBinaryOp(a,l,yn(a.dtype,l.dtype),function(y,S){return y+S})},c.prototype.addN=function(a){var l=this;An(a,"addN");for(var y=a.map(function(be){return l.readSync(be.dataId)}),S=Ki(a[0].shape,a[0].dtype),U=S.values,G=0;G<a.length;G++)for(var ae=y[G],le=0;le<U.length;le++)U[le]+=ae[le];return S.toTensor()},c.prototype.softmax=function(a,l){var y=Tn([l],a.shape),S=this.max(a,y),U=Ea(S.shape,y),G=this.subtract(a,S.reshape(U)),ae=this.exp(G),le=this.sum(ae,y).reshape(U);return ts(ae,le)},c.prototype.subtract=function(a,l){return a.dtype==="complex64"||l.dtype==="complex64"?this.broadcastedBinaryComplexOp(a.cast("complex64"),l.cast("complex64"),function(y,S,U,G){return{real:y-U,imag:S-G}}):this.broadcastedBinaryOp(a,l,yn(a.dtype,l.dtype),function(y,S){return y-S})},c.prototype.pow=function(a,l){return An([a,l],"pow"),this.broadcastedBinaryOp(a,l,a.dtype,function(y,S){return Math.pow(y,S)})},c.prototype.batchMatMul=function(a,l,y,S){An([a,l],"matMul");for(var U=y?a.shape[1]:a.shape[2],G=y?a.shape[2]:a.shape[1],ae=S?l.shape[1]:l.shape[2],le=a.shape[0],be=this.readSync(a.dataId),Se=this.readSync(l.dataId),Ie=y?[a.strides[0],1,a.strides[1]]:[a.strides[0],a.strides[1],1],Me=Ie[0],qe=Ie[1],Ye=Ie[2],Xe=S?[1,l.strides[1],l.strides[0]]:[l.strides[1],1,l.strides[0]],at=Xe[0],gt=Xe[1],bt=Xe[2],_t=G*ae,jt=Ki([le,G,ae],a.dtype),Qt=jt.values,sn=this.blockSize,Zt=0;Zt<le;Zt++)for(var rn=0;rn<G;rn+=sn)for(var Sn=0;Sn<ae;Sn+=sn)for(var Bn=0;Bn<U;Bn+=sn)for(var Mn=Math.min(rn+sn,G),fr=Math.min(Sn+sn,ae),yr=Math.min(Bn+sn,U),Cr=rn;Cr<Mn;Cr++)for(var Nr=Sn;Nr<fr;Nr++){for(var Ar=0,_r=Bn;_r<yr;_r++)Ar+=be[Zt*Me+Cr*qe+_r*Ye]*Se[_r*at+Nr*gt+Zt*bt];Qt[Zt*_t+(Cr*ae+Nr)]+=Ar}return jt.toTensor()},c.prototype.fusedBatchMatMul=function(a){var l=a.a,y=a.b,S=a.transposeA,U=a.transposeB,G=a.bias,ae=a.activation,le=a.preluActivationWeights,be=this.batchMatMul(l,y,S,U);return G&&(be=this.add(be,G)),ae&&(be=Wr(this,be,ae,le)),be},c.prototype.multiply=function(a,l){return a.dtype==="complex64"||l.dtype==="complex64"?this.broadcastedBinaryComplexOp(a.cast("complex64"),l.cast("complex64"),function(y,S,U,G){return{real:y*U-S*G,imag:y*G+S*U}}):this.broadcastedBinaryOp(a,l,yn(a.dtype,l.dtype),function(y,S){return y*S})},c.prototype.floorDiv=function(a,l){return An([a,l],"floorDiv"),this.broadcastedBinaryOp(a,l,"int32",function(y,S){return Math.floor(y/S)})},c.prototype.sum=function(a,l){An(a,"sum"),La("sum",l,a.rank);for(var y=pa(a.shape,l),S=y[0],U=y[1],G=Io(S,yn(a.dtype,"int32")),ae=Qe(U),le=this.readSync(G.dataId),be=this.readSync(a.dataId),Se=0;Se<le.length;++Se){for(var Ie=Se*ae,Me=0,qe=0;qe<ae;++qe)Me+=be[Ie+qe];le[Se]=Me}return G},c.prototype.prod=function(a,l){An(a,"sum");for(var y=pa(a.shape,l),S=y[0],U=y[1],G=Io(S,yn(a.dtype,"int32")),ae=Qe(U),le=this.readSync(G.dataId),be=this.readSync(a.dataId),Se=0;Se<le.length;++Se){for(var Ie=Se*ae,Me=1,qe=0;qe<ae;++qe)Me*=be[Ie+qe];le[Se]=Me}return G},c.prototype.unsortedSegmentSum=function(a,l,y){An(a,"unsortedSegmentSum");for(var S=[],U=a.rank-l.rank,G=0;G<U;++G)l=l.expandDims(G+1);for(G=0;G<y;++G){var ae=Mr(G,"int32"),le=td(ae,l).asType("float32").mul(a).sum(0);S.push(le)}return Bc(S)},c.prototype.argMin=function(a,l){An(a,"argMin");var y=[l];La("argMin",y,a.rank);for(var S=pa(a.shape,y),U=S[0],G=S[1],ae=Io(U,"int32"),le=Qe(G),be=this.readSync(ae.dataId),Se=this.readSync(a.dataId),Ie=0;Ie<be.length;++Ie){for(var Me=Ie*le,qe=Se[Me],Ye=0,Xe=0;Xe<le;++Xe){var at=Se[Me+Xe];at<qe&&(qe=at,Ye=Xe)}be[Ie]=Ye}return ae},c.prototype.argMax=function(a,l){An(a,"argMax");var y=[l];La("argMax",y,a.rank);for(var S=pa(a.shape,y),U=S[0],G=S[1],ae=Io(U,"int32"),le=Qe(G),be=this.readSync(ae.dataId),Se=this.readSync(a.dataId),Ie=0;Ie<be.length;++Ie){for(var Me=Ie*le,qe=Se[Me],Ye=0,Xe=0;Xe<le;++Xe){var at=Se[Me+Xe];at>qe&&(qe=at,Ye=Xe)}be[Ie]=Ye}return ae},c.prototype.cumsum=function(a,l,y,S){if(An(a,"cumsum"),l!==a.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(a.rank-1)+" but got axis="+l);for(var U=yn(a.dtype,"int32"),G=Io(a.shape,U),ae=this.readSync(G.dataId),le=this.readSync(a.dataId),be=a.shape[a.rank-1],Se=S?function(Xe,at){return Xe+be-at-1}:function(Xe,at){return Xe+at},Ie=0;Ie<le.length;Ie+=be)for(var Me=0;Me<be;Me++){var qe=Se(Ie,Me);if(Me===0)ae[qe]=y?0:le[qe];else{var Ye=Se(Ie,Me-1);ae[qe]=y?le[Ye]+ae[Ye]:le[qe]+ae[Ye]}}return G},c.prototype.equal=function(a,l){return An([a,l],"equal"),this.broadcastedBinaryOp(a,l,"bool",function(y,S){return y===S?1:0})},c.prototype.notEqual=function(a,l){return An([a,l],"notEqual"),this.broadcastedBinaryOp(a,l,"bool",function(y,S){return y!==S?1:0})},c.prototype.less=function(a,l){return An([a,l],"less"),this.broadcastedBinaryOp(a,l,"bool",function(y,S){return y<S?1:0})},c.prototype.lessEqual=function(a,l){return An([a,l],"lessEqual"),this.broadcastedBinaryOp(a,l,"bool",function(y,S){return y<=S?1:0})},c.prototype.greater=function(a,l){return An([a,l],"greater"),this.broadcastedBinaryOp(a,l,"bool",function(y,S){return y>S?1:0})},c.prototype.greaterEqual=function(a,l){return An([a,l],"greaterEqual"),this.broadcastedBinaryOp(a,l,"bool",function(y,S){return y>=S?1:0})},c.prototype.logicalNot=function(a){An(a,"logicalNot");for(var l=this.readSync(a.dataId),y=new Uint8Array(l.length),S=0;S<l.length;++S)y[S]=l[S]?0:1;return this.makeOutput(y,a.shape,"bool")},c.prototype.logicalAnd=function(a,l){return An([a,l],"logicalAnd"),this.broadcastedBinaryOp(a,l,"bool",function(y,S){return y&&S})},c.prototype.logicalOr=function(a,l){return An([a,l],"logicalOr"),this.broadcastedBinaryOp(a,l,"bool",function(y,S){return y||S})},c.prototype.select=function(a,l,y){An([a,l,y],"select");for(var S=this.readSync(a.dataId),U=this.readSync(l.dataId),G=this.readSync(y.dataId),ae=Io(l.shape,yn(l.dtype,y.dtype)),le=this.readSync(ae.dataId),be=0,Se=a.rank===0||a.rank>1||l.rank===1?1:Qe(l.shape.slice(1)),Ie=0;Ie<S.length;Ie++)for(var Me=0;Me<Se;Me++)S[Ie]===1?le[be++]=U[Ie]:le[be++]=G[Ie];return ae},c.prototype.where=function(a){An([a],"where");var l=this.readSync(a.dataId);return Wa(a.shape,l)},c.prototype.topk=function(a,l,y){return An(a,"topk"),Qo(this.readSync(a.dataId),a.shape,a.dtype,l)},c.prototype.min=function(a,l){An(a,"min"),La("min",l,a.rank);for(var y=pa(a.shape,l),S=y[0],U=y[1],G=Io(S,a.dtype),ae=Qe(U),le=this.readSync(G.dataId),be=this.readSync(a.dataId),Se=0;Se<le.length;++Se){for(var Ie=Se*ae,Me=be[Ie],qe=0;qe<ae;++qe){var Ye=be[Ie+qe];Ye<Me&&(Me=Ye)}le[Se]=Me}return G},c.prototype.minimum=function(a,l){return An([a,l],"minimum"),this.broadcastedBinaryOp(a,l,a.dtype,function(y,S){return Math.min(y,S)})},c.prototype.mod=function(a,l){return An([a,l],"mod"),this.broadcastedBinaryOp(a,l,a.dtype,function(y,S){var U=y%S;return y<0&&S<0||y>=0&&S>=0?U:(U+S)%S})},c.prototype.max=function(a,l){An(a,"max"),La("max",l,a.rank);for(var y=pa(a.shape,l),S=y[0],U=y[1],G=Io(S,a.dtype),ae=Qe(U),le=this.readSync(G.dataId),be=this.readSync(a.dataId),Se=0;Se<le.length;++Se){for(var Ie=Se*ae,Me=be[Ie],qe=0;qe<ae;++qe){var Ye=be[Ie+qe];Ye>Me&&(Me=Ye)}le[Se]=Me}return G},c.prototype.maximum=function(a,l){return An([a,l],"maximum"),this.broadcastedBinaryOp(a,l,a.dtype,function(y,S){return Math.max(y,S)})},c.prototype.all=function(a,l){An(a,"all"),La("all",l,a.rank);for(var y=pa(a.shape,l),S=y[0],U=y[1],G=Io(S,a.dtype),ae=Qe(U),le=this.readSync(G.dataId),be=this.readSync(a.dataId),Se=0;Se<le.length;++Se){for(var Ie=Se*ae,Me=be[Ie],qe=0;qe<ae;++qe){var Ye=be[Ie+qe];Me=Me&&Ye}le[Se]=Me}return G},c.prototype.any=function(a,l){An(a,"any"),La("any",l,a.rank);for(var y=pa(a.shape,l),S=y[0],U=y[1],G=Io(S,a.dtype),ae=Qe(U),le=this.readSync(G.dataId),be=this.readSync(a.dataId),Se=0;Se<le.length;++Se){for(var Ie=Se*ae,Me=be[Ie],qe=0;qe<ae;++qe){var Ye=be[Ie+qe];Me=Me||Ye}le[Se]=Me}return G},c.prototype.squaredDifference=function(a,l){return An([a,l],"squaredDifference"),this.broadcastedBinaryOp(a,l,a.dtype,function(y,S){var U=y-S;return U*U})},c.prototype.ceil=function(a){An(a,"ceil");for(var l=this.readSync(a.dataId),y=new Float32Array(l.length),S=0;S<l.length;++S)y[S]=Math.ceil(l[S]);return this.makeOutput(y,a.shape,"float32")},c.prototype.floor=function(a){An(a,"floor");for(var l=this.readSync(a.dataId),y=new Float32Array(l.length),S=0;S<l.length;++S)y[S]=Math.floor(l[S]);return this.makeOutput(y,a.shape,"float32")},c.prototype.sign=function(a){An(a,"x");for(var l=this.readSync(a.dataId),y=new Float32Array(l.length),S=0;S<l.length;++S)l[S]<0?y[S]=-1:l[S]>0?y[S]=1:y[S]=0;return this.makeOutput(y,a.shape,"float32")},c.prototype.isNaN=function(a){An(a,"x");for(var l=this.readSync(a.dataId),y=new Uint8Array(l.length),S=0;S<l.length;++S)Number.isNaN(l[S])&&(y[S]=1);return this.makeOutput(y,a.shape,"bool")},c.prototype.isInf=function(a){An(a,"x");for(var l=this.readSync(a.dataId),y=new Uint8Array(l.length),S=0;S<l.length;++S)Math.abs(l[S])===1/0&&(y[S]=1);return this.makeOutput(y,a.shape,"bool")},c.prototype.isFinite=function(a){An(a,"x");for(var l=this.readSync(a.dataId),y=new Uint8Array(l.length),S=0;S<l.length;++S)Number.isFinite(l[S])&&(y[S]=1);return this.makeOutput(y,a.shape,"bool")},c.prototype.round=function(a){An(a,"round");for(var l=this.readSync(a.dataId),y=new Float32Array(l.length),S=0;S<l.length;++S){var U=Math.floor(l[S]);l[S]-U<.5?y[S]=Math.floor(l[S]):l[S]-U>.5?y[S]=Math.ceil(l[S]):y[S]=U%2==0?U:U+1}return this.makeOutput(y,a.shape,"float32")},c.prototype.exp=function(a){An(a,"exp");for(var l=this.readSync(a.dataId),y=new Float32Array(l.length),S=0;S<l.length;++S)y[S]=Math.exp(l[S]);return this.makeOutput(y,a.shape,"float32")},c.prototype.expm1=function(a){An(a,"expm1");for(var l=this.readSync(a.dataId),y=new Float32Array(l.length),S=0;S<l.length;++S)y[S]=Math.expm1(l[S]);return this.makeOutput(y,a.shape,"float32")},c.prototype.log=function(a){An(a,"log");for(var l=this.readSync(a.dataId),y=new Float32Array(l.length),S=0;S<l.length;++S){var U=l[S];y[S]=Math.log(U)}return this.makeOutput(y,a.shape,"float32")},c.prototype.log1p=function(a){An(a,"log1p");for(var l=this.readSync(a.dataId),y=new Float32Array(l.length),S=0;S<l.length;++S){var U=l[S];y[S]=Math.log1p(U)}return this.makeOutput(y,a.shape,"float32")},c.prototype.sqrt=function(a){An(a,"sqrt");for(var l=this.readSync(a.dataId),y=new Float32Array(l.length),S=0;S<l.length;++S){var U=l[S];y[S]=Math.sqrt(U)}return this.makeOutput(y,a.shape,"float32")},c.prototype.rsqrt=function(a){An(a,"rsqrt");for(var l=this.readSync(a.dataId),y=new Float32Array(l.length),S=0;S<l.length;++S){var U=l[S];y[S]=1/Math.sqrt(U)}return this.makeOutput(y,a.shape,"float32")},c.prototype.reciprocal=function(a){An(a,"reciprocal");for(var l=this.readSync(a.dataId),y=new Float32Array(l.length),S=0;S<l.length;++S)y[S]=1/l[S];return this.makeOutput(y,a.shape,"float32")},c.prototype.linear=function(a){return a},c.prototype.relu=function(a){An(a,"relu");for(var l=Io(a.shape,a.dtype),y=this.readSync(l.dataId),S=this.readSync(a.dataId),U=0;U<S.length;++U)y[U]=Math.max(0,S[U]);return l},c.prototype.relu6=function(a){An(a,"relu");for(var l=Io(a.shape,a.dtype),y=this.readSync(l.dataId),S=this.readSync(a.dataId),U=0;U<S.length;++U)y[U]=Math.min(Math.max(0,S[U]),6);return l},c.prototype.prelu=function(a,l){return An([a,l],"prelu"),this.broadcastedBinaryOp(a,l,a.dtype,function(y,S){return y<0?S*y:y})},c.prototype.elu=function(a){An(a,"elu");for(var l=new Float32Array(a.size),y=this.readSync(a.dataId),S=0;S<y.length;++S){var U=y[S];l[S]=U>=0?U:Math.exp(U)-1}return this.makeOutput(l,a.shape,"float32")},c.prototype.eluDer=function(a,l){An([a,l],"eluDer");for(var y=new Float32Array(l.size),S=this.readSync(l.dataId),U=this.readSync(a.dataId),G=0;G<S.length;++G){var ae=S[G];y[G]=ae>=1?U[G]:U[G]*(ae+1)}return this.makeOutput(y,l.shape,"float32")},c.prototype.selu=function(a){An(a,"selu");for(var l=new Float32Array(a.size),y=this.readSync(a.dataId),S=0;S<y.length;++S){var U=y[S];l[S]=U>=0?1.0507009873554805*U:1.7580993408473768*(Math.exp(U)-1)}return this.makeOutput(l,a.shape,"float32")},c.prototype.clip=function(a,l,y){An(a,"clip");for(var S=new Float32Array(a.size),U=this.readSync(a.dataId),G=0;G<U.length;++G){var ae=U[G];S[G]=ae>y?y:ae<l?l:ae}return this.makeOutput(S,a.shape,"float32")},c.prototype.abs=function(a){for(var l=new Float32Array(a.size),y=this.readSync(a.dataId),S=0;S<y.length;++S)l[S]=Math.abs(y[S]);return this.makeOutput(l,a.shape,"float32")},c.prototype.complexAbs=function(a){for(var l=new Float32Array(a.size),y=this.readSync(a.dataId),S=0;S<a.size;++S){var U=y[2*S],G=y[2*S+1];l[S]=Math.hypot(U,G)}return this.makeOutput(l,a.shape,"float32")},c.prototype.int=function(a){An(a,"int");for(var l=new Int32Array(a.size),y=this.readSync(a.dataId),S=0;S<y.length;++S)l[S]=y[S];return this.makeOutput(l,a.shape,"int32")},c.prototype.sigmoid=function(a){An(a,"sigmoid");for(var l=new Float32Array(a.size),y=this.readSync(a.dataId),S=0;S<y.length;++S)l[S]=1/(1+Math.exp(-y[S]));return this.makeOutput(l,a.shape,"float32")},c.prototype.softplus=function(a){An(a,"softplus");for(var l=Math.log(11920928955078125e-23)+2,y=new Float32Array(a.size),S=this.readSync(a.dataId),U=0;U<S.length;++U){var G,ae=S[U]>-l,le=S[U]<l,be=Math.exp(S[U]);G=le?be:ae?S[U]:Math.log(1+be),y[U]=G}return this.makeOutput(y,a.shape,"float32")},c.prototype.sin=function(a){An(a,"sin");for(var l=new Float32Array(a.size),y=this.readSync(a.dataId),S=0;S<y.length;++S)l[S]=Math.sin(y[S]);return this.makeOutput(l,a.shape,"float32")},c.prototype.cos=function(a){An(a,"cos");for(var l=new Float32Array(a.size),y=this.readSync(a.dataId),S=0;S<y.length;++S)l[S]=Math.cos(y[S]);return this.makeOutput(l,a.shape,"float32")},c.prototype.tan=function(a){An(a,"tan");for(var l=new Float32Array(a.size),y=this.readSync(a.dataId),S=0;S<y.length;++S)l[S]=Math.tan(y[S]);return this.makeOutput(l,a.shape,"float32")},c.prototype.asin=function(a){An(a,"asin");for(var l=new Float32Array(a.size),y=this.readSync(a.dataId),S=0;S<y.length;++S)l[S]=Math.asin(y[S]);return this.makeOutput(l,a.shape,"float32")},c.prototype.acos=function(a){An(a,"acos");for(var l=new Float32Array(a.size),y=this.readSync(a.dataId),S=0;S<y.length;++S)l[S]=Math.acos(y[S]);return this.makeOutput(l,a.shape,"float32")},c.prototype.atan=function(a){An(a,"atan");for(var l=new Float32Array(a.size),y=this.readSync(a.dataId),S=0;S<y.length;++S)l[S]=Math.atan(y[S]);return this.makeOutput(l,a.shape,"float32")},c.prototype.atan2=function(a,l){return An([a,l],"atan2"),this.broadcastedBinaryOp(a,l,a.dtype,function(y,S){return Math.atan2(y,S)})},c.prototype.sinh=function(a){An(a,"sinh");for(var l=new Float32Array(a.size),y=this.readSync(a.dataId),S=0;S<y.length;++S)l[S]=Math.sinh(y[S]);return this.makeOutput(l,a.shape,"float32")},c.prototype.cosh=function(a){An(a,"cosh");for(var l=new Float32Array(a.size),y=this.readSync(a.dataId),S=0;S<y.length;++S)l[S]=Math.cosh(y[S]);return this.makeOutput(l,a.shape,"float32")},c.prototype.tanh=function(a){An(a,"tanh");for(var l=new Float32Array(a.size),y=this.readSync(a.dataId),S=0;S<y.length;++S)l[S]=Ct(y[S]);return this.makeOutput(l,a.shape,"float32")},c.prototype.asinh=function(a){An(a,"asinh");for(var l=new Float32Array(a.size),y=this.readSync(a.dataId),S=0;S<y.length;++S)l[S]=Math.asinh(y[S]);return this.makeOutput(l,a.shape,"float32")},c.prototype.acosh=function(a){An(a,"acosh");for(var l=new Float32Array(a.size),y=this.readSync(a.dataId),S=0;S<y.length;++S)l[S]=Math.acosh(y[S]);return this.makeOutput(l,a.shape,"float32")},c.prototype.atanh=function(a){An(a,"atanh");for(var l=new Float32Array(a.size),y=this.readSync(a.dataId),S=0;S<y.length;++S)l[S]=Math.atanh(y[S]);return this.makeOutput(l,a.shape,"float32")},c.prototype.erf=function(a){An(a,"erf");for(var l=new Float32Array(a.size),y=this.readSync(a.dataId),S=0;S<y.length;++S){var U=Math.sign(y[S]),G=Math.abs(y[S]),ae=1/(1+.3275911*G);l[S]=U*(1-((((1.061405429*ae-1.453152027)*ae+1.421413741)*ae-.284496736)*ae+.254829592)*ae*Math.exp(-G*G))}return this.makeOutput(l,a.shape,"float32")},c.prototype.step=function(a,l){l===void 0&&(l=0),An(a,"step");for(var y=new Float32Array(a.size),S=this.readSync(a.dataId),U=0;U<S.length;++U){var G=S[U];isNaN(G)?y[U]=NaN:y[U]=G>0?1:l}return this.makeOutput(y,a.shape,"float32")},c.prototype.fusedConv2d=function(a){var l=a.input,y=a.filter,S=a.convInfo,U=a.bias,G=a.activation,ae=a.preluActivationWeights,le=this.conv2d(l,y,S);return U&&(le=this.add(le,U)),G&&(le=Wr(this,le,G,ae)),le},c.prototype.conv2d=function(a,l,y){An([a,l],"conv2d");for(var S=y.filterHeight,U=y.filterWidth,G=y.dilationHeight,ae=y.dilationWidth,le=y.padInfo.left,be=y.padInfo.top,Se=y.dataFormat==="channelsLast",Ie=Ki(y.outShape,a.dtype),Me=a.strides[0],qe=Se?a.strides[1]:a.strides[2],Ye=Se?a.strides[2]:1,Xe=Se?1:a.strides[1],at=Ie.strides[0],gt=Se?Ie.strides[1]:Ie.strides[2],bt=Se?Ie.strides[2]:1,_t=Se?1:Ie.strides[1],jt=this.readSync(a.dataId),Qt=this.readSync(l.dataId),sn=Ie.values,Zt=0;Zt<y.batchSize;++Zt)for(var rn=Zt*Me,Sn=Zt*at,Bn=0;Bn<y.outHeight;++Bn)for(var Mn=Sn+Bn*gt,fr=Bn*y.strideHeight-be,yr=0;yr<S;yr++){var Cr=fr+yr*G;if(!(Cr<0||Cr>=y.inHeight))for(var Nr=yr*l.strides[0],Ar=rn+Cr*qe,_r=0;_r<y.outWidth;++_r)for(var Yr=Mn+_r*bt,Kr=_r*y.strideWidth-le,fi=0;fi<U;fi++){var Ti=Kr+fi*ae;if(!(Ti<0||Ti>=y.inWidth))for(var Yi=Ar+Ti*Ye,ia=Nr+fi*l.strides[1],oa=0;oa<y.inChannels;++oa){for(var wa=jt[Yi+oa*Xe],ba=0;ba<y.outChannels;++ba)sn[Yr+ba*_t]+=wa*Qt[ia+ba];ia+=y.outChannels}}}return Ie.toTensor()},c.prototype.conv3d=function(a,l,y){for(var S=y.filterDepth,U=y.filterHeight,G=y.filterWidth,ae=y.dilationDepth,le=y.dilationHeight,be=y.dilationWidth,Se=y.padInfo.front,Ie=y.padInfo.left,Me=y.padInfo.top,qe=Ki(y.outShape,a.dtype),Ye=this.readSync(a.dataId),Xe=this.readSync(l.dataId),at=qe.values,gt=0;gt<y.batchSize;++gt)for(var bt=gt*a.strides[0],_t=gt*qe.strides[0],jt=0;jt<y.outDepth;++jt)for(var Qt=_t+jt*qe.strides[1],sn=jt*y.strideDepth-Se,Zt=0;Zt<S;Zt++){var rn=sn+Zt*ae;if(!(rn<0||rn>=y.inDepth))for(var Sn=Zt*l.strides[0],Bn=bt+rn*a.strides[1],Mn=0;Mn<y.outHeight;++Mn)for(var fr=Qt+Mn*qe.strides[2],yr=Mn*y.strideHeight-Me,Cr=0;Cr<U;Cr++){var Nr=yr+Cr*le;if(!(Nr<0||Nr>=y.inHeight))for(var Ar=Sn+Cr*l.strides[1],_r=Bn+Nr*a.strides[2],Yr=0;Yr<y.outWidth;++Yr)for(var Kr=fr+Yr*y.outChannels,fi=Yr*y.strideWidth-Ie,Ti=0;Ti<G;Ti++){var Yi=fi+Ti*be;if(!(Yi<0||Yi>=y.inWidth))for(var ia=Ar+Ti*l.strides[2],oa=_r+Yi*y.inChannels,wa=ia,ba=0;ba<y.inChannels;++ba){for(var ja=Ye[oa+ba],Qa=0;Qa<y.outChannels;++Qa)at[Kr+Qa]+=ja*Xe[wa+Qa];wa+=y.outChannels}}}}return qe.toTensor()},c.prototype.conv2dDerInput=function(a,l,y){An([a,l],"conv2dDerInput");for(var S=Ki(y.inShape,"float32"),U=S.values,G=this.readSync(a.dataId),ae=this.readSync(l.dataId),le=l.strides,be=le[0],Se=le[1],Ie=le[2],Me=y.batchSize,qe=y.filterHeight,Ye=y.filterWidth,Xe=y.inChannels,at=y.inHeight,gt=y.inWidth,bt=y.outChannels,_t=y.outHeight,jt=y.outWidth,Qt=y.strideHeight,sn=y.strideWidth,Zt=y.dataFormat,rn=qe-1-y.padInfo.top,Sn=Ye-1-y.padInfo.left,Bn=Zt==="channelsLast",Mn=S.strides[0],fr=Bn?S.strides[1]:S.strides[2],yr=Bn?S.strides[2]:1,Cr=Bn?1:S.strides[1],Nr=a.strides[0],Ar=Bn?a.strides[1]:a.strides[2],_r=Bn?a.strides[2]:1,Yr=Bn?1:a.strides[1],Kr=0;Kr<Me;++Kr)for(var fi=0;fi<Xe;++fi)for(var Ti=0;Ti<at;++Ti)for(var Yi=Ti-rn,ia=Math.max(0,Math.ceil(Yi/Qt)),oa=Math.min(_t,(qe+Yi)/Qt),wa=0;wa<gt;++wa){for(var ba=wa-Sn,ja=Math.max(0,Math.ceil(ba/sn)),Qa=Math.min(jt,(Ye+ba)/sn),Ls=0,Uo=ia;Uo<oa;++Uo)for(var ka=Uo*Qt-Yi,Za=ja;Za<Qa;++Za)for(var mc=Nr*Kr+Ar*Uo+_r*Za,gc=be*(qe-1-ka)+Se*(Ye-1-(Za*sn-ba))+Ie*fi,vc=0;vc<bt;++vc)Ls+=G[mc+Yr*vc]*ae[gc+vc];U[Mn*Kr+fr*Ti+yr*wa+Cr*fi]=Ls}return S.toTensor()},c.prototype.conv3dDerInput=function(a,l,y){for(var S=Ki(y.inShape,"float32"),U=S.values,G=S.strides,ae=G[0],le=G[1],be=G[2],Se=G[3],Ie=this.readSync(a.dataId),Me=a.strides,qe=Me[0],Ye=Me[1],Xe=Me[2],at=Me[3],gt=this.readSync(l.dataId),bt=l.strides,_t=bt[0],jt=bt[1],Qt=bt[2],sn=bt[3],Zt=y.batchSize,rn=y.filterDepth,Sn=y.filterHeight,Bn=y.filterWidth,Mn=y.inChannels,fr=y.inDepth,yr=y.inHeight,Cr=y.inWidth,Nr=y.outChannels,Ar=y.outDepth,_r=y.outHeight,Yr=y.outWidth,Kr=y.strideDepth,fi=y.strideHeight,Ti=y.strideWidth,Yi=rn-1-y.padInfo.front,ia=Sn-1-y.padInfo.top,oa=Bn-1-y.padInfo.left,wa=0;wa<Zt;++wa)for(var ba=0;ba<Mn;++ba)for(var ja=0;ja<fr;++ja)for(var Qa=ja-Yi,Ls=Math.max(0,Math.ceil(Qa/Kr)),Uo=Math.min(Ar,(rn+Qa)/Kr),ka=0;ka<yr;++ka)for(var Za=ka-ia,mc=Math.max(0,Math.ceil(Za/fi)),gc=Math.min(_r,(Sn+Za)/fi),vc=0;vc<Cr;++vc){for(var Ep=vc-oa,qu=Math.max(0,Math.ceil(Ep/Ti)),Ud=Math.min(Yr,(Bn+Ep)/Ti),fl=0,e0=Ls;e0<Uo;++e0)for(var F0=e0*Kr-Qa,Cp=mc;Cp<gc;++Cp)for(var dg=Cp*fi-Za,ym=qu;ym<Ud;++ym)for(var A1=qe*wa+Ye*e0+Xe*Cp+at*ym,_v=_t*(rn-1-F0)+jt*(Sn-1-dg)+Qt*(Bn-1-(ym*Ti-Ep))+sn*ba,Ap=0;Ap<Nr;++Ap)fl+=Ie[A1+Ap]*gt[_v+Ap];U[ae*wa+le*ja+be*ka+Se*vc+ba]=fl}return S.toTensor()},c.prototype.conv2dDerFilter=function(a,l,y){An([a,l],"conv2dDerFilter");for(var S=y.strideHeight,U=y.strideWidth,G=y.filterHeight,ae=y.filterWidth,le=y.dataFormat==="channelsLast",be=Ki(y.filterShape,"float32"),Se=y.padInfo.left,Ie=y.padInfo.top,Me=this.bufferSync(a),qe=this.bufferSync(l),Ye=0;Ye<G;++Ye)for(var Xe=Math.max(0,Math.ceil((Ie-Ye)/S)),at=Math.min(y.outHeight,(y.inHeight+Ie-Ye)/S),gt=0;gt<ae;++gt)for(var bt=Math.max(0,Math.ceil((Se-gt)/U)),_t=Math.min(y.outWidth,(y.inWidth+Se-gt)/U),jt=0;jt<y.inChannels;++jt)for(var Qt=0;Qt<y.outChannels;++Qt){for(var sn=0,Zt=0;Zt<y.batchSize;++Zt)for(var rn=Xe;rn<at;++rn)for(var Sn=Ye+rn*S-Ie,Bn=bt;Bn<_t;++Bn){var Mn=gt+Bn*U-Se;sn+=le?Me.get(Zt,Sn,Mn,jt)*qe.get(Zt,rn,Bn,Qt):Me.get(Zt,jt,Sn,Mn)*qe.get(Zt,Qt,rn,Bn)}be.set(sn,Ye,gt,jt,Qt)}return be.toTensor()},c.prototype.conv3dDerFilter=function(a,l,y){for(var S=y.strideDepth,U=y.strideHeight,G=y.strideWidth,ae=y.filterDepth,le=y.filterHeight,be=y.filterWidth,Se=Ki(y.filterShape,"float32"),Ie=Se.values,Me=Se.strides,qe=Me[0],Ye=Me[1],Xe=Me[2],at=Me[3],gt=this.readSync(l.dataId),bt=l.strides,_t=bt[0],jt=bt[1],Qt=bt[2],sn=bt[3],Zt=this.readSync(a.dataId),rn=a.strides,Sn=rn[0],Bn=rn[1],Mn=rn[2],fr=rn[3],yr=y.padInfo.front,Cr=y.padInfo.left,Nr=y.padInfo.top,Ar=0;Ar<ae;++Ar)for(var _r=Math.max(0,Math.ceil((yr-Ar)/S)),Yr=Math.min(y.outDepth,(y.inDepth+yr-Ar)/S),Kr=Ar*qe,fi=0;fi<le;++fi)for(var Ti=Math.max(0,Math.ceil((Nr-fi)/U)),Yi=Math.min(y.outHeight,(y.inHeight+Nr-fi)/U),ia=fi*Ye+Kr,oa=0;oa<be;++oa)for(var wa=Math.max(0,Math.ceil((Cr-oa)/G)),ba=Math.min(y.outWidth,(y.inWidth+Cr-oa)/G),ja=oa*Xe+ia,Qa=0;Qa<y.inChannels;++Qa)for(var Ls=Qa*at+ja,Uo=0;Uo<y.outChannels;++Uo){for(var ka=0,Za=0;Za<y.batchSize;++Za)for(var mc=Za*Sn,gc=Za*_t,vc=_r;vc<Yr;++vc)for(var Ep=(Ar+vc*S-yr)*Bn+mc,qu=vc*jt+gc,Ud=Ti;Ud<Yi;++Ud)for(var fl=(fi+Ud*U-Nr)*Mn+Ep,e0=Ud*Qt+qu,F0=wa;F0<ba;++F0){var Cp=F0*sn+e0;ka+=Zt[(oa+F0*G-Cr)*fr+fl+Qa]*gt[Cp+Uo]}Ie[Ls+Uo]=ka}return Se.toTensor()},c.prototype.fusedDepthwiseConv2D=function(a){var l=a.input,y=a.filter,S=a.convInfo,U=a.bias,G=a.activation,ae=a.preluActivationWeights,le=this.depthwiseConv2D(l,y,S);return U&&(le=this.add(le,U)),G&&(le=Wr(this,le,G,ae)),le},c.prototype.depthwiseConv2D=function(a,l,y){An([a,l],"depthwiseConv2D");for(var S=y.filterHeight,U=y.filterWidth,G=y.dilationHeight,ae=y.dilationWidth,le=y.padInfo.left,be=y.padInfo.top,Se=y.outChannels/y.inChannels,Ie=Ki(y.outShape,a.dtype),Me=this.readSync(a.dataId),qe=this.readSync(l.dataId),Ye=Ie.values,Xe=0;Xe<y.batchSize;++Xe)for(var at=Xe*a.strides[0],gt=Xe*Ie.strides[0],bt=0;bt<y.outHeight;++bt)for(var _t=gt+bt*Ie.strides[1],jt=bt*y.strideHeight-le,Qt=0;Qt<S;++Qt){var sn=jt+Qt*G;if(!(sn<0||sn>=y.inHeight))for(var Zt=Qt*l.strides[0],rn=at+sn*a.strides[1],Sn=0;Sn<y.outWidth;++Sn)for(var Bn=_t+Sn*Ie.strides[2],Mn=Sn*y.strideWidth-be,fr=0;fr<U;++fr){var yr=Mn+fr*ae;if(!(yr<0||yr>=y.inWidth))for(var Cr=Zt+fr*l.strides[1],Nr=rn+yr*y.inChannels,Ar=Bn,_r=Cr,Yr=0;Yr<y.inChannels;++Yr){for(var Kr=Me[Nr+Yr],fi=0;fi<Se;++fi)Ye[Ar+fi]+=Kr*qe[_r+fi];Ar+=Se,_r+=Se}}}return Ie.toTensor()},c.prototype.depthwiseConv2DDerInput=function(a,l,y){An([a,l],"depthwiseConv2DDerInput");for(var S=Ki(y.inShape,"float32"),U=S.values,G=S.strides,ae=G[0],le=G[1],be=G[2],Se=this.readSync(a.dataId),Ie=a.strides,Me=Ie[0],qe=Ie[1],Ye=Ie[2],Xe=this.readSync(l.dataId),at=l.strides,gt=at[0],bt=at[1],_t=at[2],jt=y.batchSize,Qt=y.filterHeight,sn=y.filterWidth,Zt=y.inChannels,rn=y.inHeight,Sn=y.inWidth,Bn=y.outChannels,Mn=y.outHeight,fr=y.outWidth,yr=y.strideHeight,Cr=y.strideWidth,Nr=Qt-1-y.padInfo.top,Ar=sn-1-y.padInfo.left,_r=Bn/Zt,Yr=0;Yr<jt;++Yr)for(var Kr=0;Kr<Zt;++Kr)for(var fi=0;fi<rn;++fi)for(var Ti=fi-Nr,Yi=Math.max(0,Math.ceil(Ti/yr)),ia=Math.min(Mn,(Qt+Ti)/yr),oa=0;oa<Sn;++oa){for(var wa=oa-Ar,ba=Math.max(0,Math.ceil(wa/Cr)),ja=Math.min(fr,(sn+wa)/Cr),Qa=0,Ls=Yi;Ls<ia;++Ls)for(var Uo=Ls*yr-Ti,ka=ba;ka<ja;++ka)for(var Za=Me*Yr+qe*Ls+Ye*ka,mc=gt*(Qt-1-Uo)+bt*(sn-1-(ka*Cr-wa))+_t*Kr,gc=0;gc<_r;++gc)Qa+=Se[Za+(Kr*_r+gc)]*Xe[mc+gc];U[ae*Yr+le*fi+be*oa+Kr]=Qa}return S.toTensor()},c.prototype.depthwiseConv2DDerFilter=function(a,l,y){An([a,l],"depthwiseConv2DDerFilter");for(var S=y.strideHeight,U=y.strideWidth,G=y.filterHeight,ae=y.filterWidth,le=Ki(y.filterShape,"float32"),be=y.padInfo.left,Se=y.padInfo.top,Ie=y.outChannels/y.inChannels,Me=this.bufferSync(a),qe=this.bufferSync(l),Ye=0;Ye<G;++Ye)for(var Xe=Math.max(0,Math.ceil((Se-Ye)/S)),at=Math.min(y.outHeight,(y.inHeight+Se-Ye)/S),gt=0;gt<ae;++gt)for(var bt=Math.max(0,Math.ceil((be-gt)/U)),_t=Math.min(y.outWidth,(y.inWidth+be-gt)/U),jt=0;jt<y.outChannels;++jt){for(var Qt=Math.trunc(jt/Ie),sn=jt%Ie,Zt=0,rn=0;rn<y.batchSize;++rn)for(var Sn=Xe;Sn<at;++Sn)for(var Bn=Ye+Sn*S-Se,Mn=bt;Mn<_t;++Mn){var fr=gt+Mn*U-be;Zt+=Me.get(rn,Bn,fr,Qt)*qe.get(rn,Sn,Mn,jt)}le.set(Zt,Ye,gt,Qt,sn)}return le.toTensor()},c.prototype.tile=function(a,l){return An(a,"tile"),ks(this.bufferSync(a),l)},c.prototype.pad=function(a,l,y){An(a,"pad");var S=l.map(function(Ie,Me){return Ie[0]+a.shape[Me]+Ie[1]}),U=l.map(function(Ie){return Ie[0]}),G=this.bufferSync(a),ae=Ki(S,a.dtype);y!==0&&ae.values.fill(y);for(var le=0;le<a.size;le++){var be=G.indexToLoc(le),Se=be.map(function(Ie,Me){return Ie+U[Me]});ae.set.apply(ae,[G.get.apply(G,be)].concat(Se))}return ae.toTensor()},c.prototype.gather=function(a,l,y){An([a,l],"gather");var S=a.shape.slice(),U=this.readSync(l.dataId);S[y]=U.length;for(var G=Ki(S,a.dtype),ae=this.bufferSync(a),le=0;le<G.size;++le){var be=G.indexToLoc(le),Se=be.slice();Se[y]=U[be[y]];var Ie=ae.locToIndex(Se);G.values[le]=ae.values[Ie]}return G.toTensor()},c.prototype.batchToSpaceND=function(a,l,y){An([a],"batchToSpaceND");var S=l.reduce(function(Se,Ie){return Se*Ie}),U=Il(a.shape,l,S),G=cr(U.length,l.length),ae=jr(a.shape,l,S),le=Or(y,l.length),be=Mi(ae,y,l.length);return vt(a.reshape(U),G).reshape(ae).slice(le,be)},c.prototype.spaceToBatchND=function(a,l,y){An([a],"spaceToBatchND");var S=l.reduce(function(Ie,Me){return Ie*Me}),U=[[0,0]];U.push.apply(U,y);for(var G=1+l.length;G<a.shape.length;++G)U.push([0,0]);var ae=a.pad(U),le=Il(ae.shape,l,S,!1),be=cr(le.length,l.length,!1),Se=jr(ae.shape,l,S,!1);return vt(ae.reshape(le),be).reshape(Se)},c.prototype.maxPool=function(a,l){return An(a,"maxPool"),Sr(this.readSync(a.dataId),a.shape,a.dtype,a.strides,l,"max").toTensor()},c.prototype.maxPoolBackprop=function(a,l,y,S){An([l,y],"maxPoolBackprop");for(var U=this.readSync(l.dataId),G=Ki(S.outShape,l.dtype,Ur(U,l.shape,l.dtype,S).values),ae=S.strideHeight,le=S.strideWidth,be=S.dilationHeight,Se=S.dilationWidth,Ie=S.effectiveFilterHeight,Me=S.effectiveFilterWidth,qe=Me-1-S.padInfo.left,Ye=Ie-1-S.padInfo.top,Xe=Ki(l.shape,"float32"),at=this.bufferSync(a),gt=0;gt<S.batchSize;++gt)for(var bt=0;bt<S.inChannels;++bt)for(var _t=0;_t<S.inHeight;++_t)for(var jt=0;jt<S.inWidth;++jt){for(var Qt=_t-Ye,sn=jt-qe,Zt=0,rn=0;rn<Ie;rn+=be){var Sn=(Qt+rn)/ae;if(!(Sn<0||Sn>=S.outHeight||Math.floor(Sn)!==Sn))for(var Bn=0;Bn<Me;Bn+=Se){var Mn=(sn+Bn)/le;if(!(Mn<0||Mn>=S.outWidth||Math.floor(Mn)!==Mn)){var fr=Ie*Me-1-G.get(gt,Sn,Mn,bt)===rn*Me+Bn?1:0;fr!==0&&(Zt+=at.get(gt,Sn,Mn,bt)*fr)}}}Xe.set(Zt,gt,_t,jt,bt)}return Xe.toTensor()},c.prototype.avgPoolBackprop=function(a,l,y){An([a,l],"avgPoolBackprop");for(var S=y.strideHeight,U=y.strideWidth,G=y.filterHeight,ae=y.filterWidth,le=y.dilationHeight,be=y.dilationWidth,Se=y.effectiveFilterHeight,Ie=y.effectiveFilterWidth,Me=Ie-1-y.padInfo.left,qe=Se-1-y.padInfo.top,Ye=Ki(l.shape,"float32"),Xe=1/(G*ae),at=this.bufferSync(a),gt=0;gt<y.batchSize;++gt)for(var bt=0;bt<y.inChannels;++bt)for(var _t=0;_t<y.inHeight;++_t)for(var jt=0;jt<y.inWidth;++jt){for(var Qt=_t-qe,sn=jt-Me,Zt=0,rn=0;rn<Se;rn+=le){var Sn=(Qt+rn)/S;if(!(Sn<0||Sn>=y.outHeight||Math.floor(Sn)!==Sn))for(var Bn=0;Bn<Ie;Bn+=be){var Mn=(sn+Bn)/U;Mn<0||Mn>=y.outWidth||Math.floor(Mn)!==Mn||(Zt+=at.get(gt,Sn,Mn,bt))}}Ye.set(Zt*Xe,gt,_t,jt,bt)}return Ye.toTensor()},c.prototype.pool3d=function(a,l,y){An(a,"pool3d");for(var S=l.strideDepth,U=l.strideHeight,G=l.strideWidth,ae=l.dilationDepth,le=l.dilationHeight,be=l.dilationWidth,Se=l.effectiveFilterDepth,Ie=l.effectiveFilterHeight,Me=l.effectiveFilterWidth,qe=l.padInfo.front,Ye=l.padInfo.top,Xe=l.padInfo.left,at=y==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,gt=this.readSync(a.dataId),bt=Ki(l.outShape,a.dtype),_t=bt.values,jt=l.outShape[1]*l.outShape[2]*l.outShape[3]*l.outShape[4],Qt=l.outShape[2]*l.outShape[3]*l.outShape[4],sn=l.outShape[3]*l.outShape[4],Zt=l.outShape[4],rn=0;rn<l.batchSize;++rn)for(var Sn=rn*jt,Bn=rn*a.strides[0],Mn=0;Mn<l.inChannels;++Mn)for(var fr=0;fr<l.outDepth;++fr){for(var yr=fr*S-qe,Cr=yr;Cr<0;)Cr+=ae;for(var Nr=Math.min(l.inDepth,Se+yr),Ar=Sn+fr*Qt,_r=0;_r<l.outHeight;++_r){for(var Yr=_r*U-Ye,Kr=Yr;Kr<0;)Kr+=le;for(var fi=Math.min(l.inHeight,Ie+Yr),Ti=Ar+_r*sn,Yi=0;Yi<l.outWidth;++Yi){for(var ia=Yi*G-Xe,oa=ia;oa<0;)oa+=be;for(var wa=Math.min(l.inWidth,Me+ia),ba=Ti+Yi*Zt,ja=at,Qa=0,Ls=0,Uo=Cr;Uo<Nr;Uo+=ae){for(var ka=Bn+Uo*a.strides[1],Za=Kr;Za<fi;Za+=le){for(var mc=ka+Za*a.strides[2],gc=oa;gc<wa;gc+=be){var vc=gt[mc+gc*a.strides[3]+Mn];if(y==="max"&&vc>ja?ja=vc:y==="avg"&&(Qa+=vc,Ls++),isNaN(ja))break}if(isNaN(ja))break}if(isNaN(ja))break}_t[ba+Mn]=y==="avg"?Qa/Ls:ja}}}return bt.toTensor()},c.prototype.avgPool3d=function(a,l){return An(a,"avgPool3d"),this.pool3d(a,l,"avg").toFloat()},c.prototype.avgPool3dBackprop=function(a,l,y){An([a,l],"avgPool3dBackprop");for(var S=y.strideDepth,U=y.strideHeight,G=y.strideWidth,ae=y.filterDepth,le=y.filterHeight,be=y.filterWidth,Se=y.dilationDepth,Ie=y.dilationHeight,Me=y.dilationWidth,qe=y.effectiveFilterDepth,Ye=y.effectiveFilterHeight,Xe=y.effectiveFilterWidth,at=qe-1-y.padInfo.front,gt=Xe-1-y.padInfo.left,bt=Ye-1-y.padInfo.top,_t=Ki(l.shape,"float32"),jt=1/(ae*le*be),Qt=this.bufferSync(a),sn=0;sn<y.batchSize;++sn)for(var Zt=0;Zt<y.inChannels;++Zt)for(var rn=0;rn<y.inDepth;++rn)for(var Sn=0;Sn<y.inHeight;++Sn)for(var Bn=0;Bn<y.inWidth;++Bn){for(var Mn=rn-at,fr=Sn-bt,yr=Bn-gt,Cr=0,Nr=0;Nr<qe;Nr+=Se){var Ar=(Mn+Nr)/S;if(!(Ar<0||Ar>=y.outDepth||Math.floor(Ar)!==Ar))for(var _r=0;_r<Ye;_r+=Ie){var Yr=(fr+_r)/U;if(!(Yr<0||Yr>=y.outHeight||Math.floor(Yr)!==Yr))for(var Kr=0;Kr<Xe;Kr+=Me){var fi=(yr+Kr)/G;fi<0||fi>=y.outWidth||Math.floor(fi)!==fi||(Cr+=Qt.get(sn,Ar,Yr,fi,Zt))}}}_t.set(Cr*jt,sn,rn,Sn,Bn,Zt)}return _t.toTensor()},c.prototype.maxPool3d=function(a,l){return An(a,"maxPool3d"),this.pool3d(a,l,"max").toFloat()},c.prototype.maxPool3dPositions=function(a,l){for(var y=Ki(l.outShape,"int32"),S=l.strideDepth,U=l.strideHeight,G=l.strideWidth,ae=l.dilationDepth,le=l.dilationHeight,be=l.dilationWidth,Se=l.effectiveFilterDepth,Ie=l.effectiveFilterHeight,Me=l.effectiveFilterWidth,qe=l.padInfo.front,Ye=l.padInfo.top,Xe=l.padInfo.left,at=this.bufferSync(a),gt=0;gt<l.batchSize;++gt)for(var bt=0;bt<l.inChannels;++bt)for(var _t=0;_t<l.outDepth;++_t){for(var jt=_t*S-qe,Qt=jt;Qt<0;)Qt+=ae;for(var sn=Math.min(l.inDepth,Se+jt),Zt=0;Zt<l.outHeight;++Zt){for(var rn=Zt*U-Ye,Sn=rn;Sn<0;)Sn+=le;for(var Bn=Math.min(l.inHeight,Ie+rn),Mn=0;Mn<l.outWidth;++Mn){for(var fr=Mn*G-Xe,yr=fr;yr<0;)yr+=be;for(var Cr=Math.min(l.inWidth,Me+fr),Nr=Number.NEGATIVE_INFINITY,Ar=-1,_r=Qt;_r<sn;_r+=ae)for(var Yr=_r-jt,Kr=Sn;Kr<Bn;Kr+=le)for(var fi=Kr-rn,Ti=yr;Ti<Cr;Ti+=be){var Yi=Ti-fr,ia=at.get(gt,_r,Kr,Ti,bt);ia>=Nr&&(Nr=ia,Ar=Yr*Ie*Me+fi*Ie+Yi)}y.set(Ar,gt,_t,Zt,Mn,bt)}}}return y.toTensor()},c.prototype.maxPool3dBackprop=function(a,l,y,S){An([l,y],"maxPool3dBackprop");for(var U=this.maxPool3dPositions(l,S),G=S.strideDepth,ae=S.strideHeight,le=S.strideWidth,be=S.dilationDepth,Se=S.dilationHeight,Ie=S.dilationWidth,Me=S.effectiveFilterDepth,qe=S.effectiveFilterHeight,Ye=S.effectiveFilterWidth,Xe=Me-1-S.padInfo.front,at=Ye-1-S.padInfo.left,gt=qe-1-S.padInfo.top,bt=Ki(l.shape,"float32"),_t=this.bufferSync(U),jt=this.bufferSync(a),Qt=0;Qt<S.batchSize;++Qt)for(var sn=0;sn<S.inChannels;++sn)for(var Zt=0;Zt<S.inDepth;++Zt)for(var rn=0;rn<S.inHeight;++rn)for(var Sn=0;Sn<S.inWidth;++Sn){for(var Bn=Zt-Xe,Mn=rn-gt,fr=Sn-at,yr=0,Cr=0;Cr<Me;Cr+=be){var Nr=(Bn+Cr)/G;if(!(Nr<0||Nr>=S.outDepth||Math.floor(Nr)!==Nr))for(var Ar=0;Ar<qe;Ar+=Se){var _r=(Mn+Ar)/ae;if(!(_r<0||_r>=S.outHeight||Math.floor(_r)!==_r))for(var Yr=0;Yr<Ye;Yr+=Ie){var Kr=(fr+Yr)/le;if(!(Kr<0||Kr>=S.outWidth||Math.floor(Kr)!==Kr)){var fi=Me*qe*Ye-1-_t.get(Qt,Nr,_r,Kr,sn)===Cr*qe*Ye+Ar*Ye+Yr?1:0;fi!==0&&(yr+=jt.get(Qt,Nr,_r,Kr,sn)*fi)}}}}bt.set(yr,Qt,Zt,rn,Sn,sn)}return bt.toTensor()},c.prototype.cast=function(a,l){return pi(a,l,this)},c.prototype.reshape=function(a,l){return Pi(a,l)},c.prototype.avgPool=function(a,l){return An(a,"avgPool"),An(a,"maxPool"),Sr(this.readSync(a.dataId),a.shape,a.dtype,a.strides,l,"avg").toTensor().toFloat()},c.prototype.resizeBilinear=function(a,l,y,S){An(a,"resizeBilinear");for(var U=a.shape,G=U[0],ae=U[1],le=U[2],be=U[3],Se=this.readSync(a.dataId),Ie=new Float32Array(Qe([G,l,y,be])),Me=[S&&l>1?ae-1:ae,S&&y>1?le-1:le],qe=[S&&l>1?l-1:l,S&&y>1?y-1:y],Ye=0,Xe=Me[0]/qe[0],at=Me[1]/qe[1],gt=0;gt<G;gt++)for(var bt=0;bt<l;bt++)for(var _t=Xe*bt,jt=Math.floor(_t),Qt=_t-jt,sn=Math.min(ae-1,Math.ceil(_t)),Zt=gt*a.strides[0]+jt*a.strides[1],rn=gt*a.strides[0]+sn*a.strides[1],Sn=0;Sn<y;Sn++)for(var Bn=at*Sn,Mn=Math.floor(Bn),fr=Bn-Mn,yr=Math.min(le-1,Math.ceil(Bn)),Cr=Zt+Mn*a.strides[2],Nr=rn+Mn*a.strides[2],Ar=Zt+yr*a.strides[2],_r=rn+yr*a.strides[2],Yr=0;Yr<be;Yr++){var Kr=Se[Cr+Yr],fi=Se[Nr+Yr],Ti=Kr+(Se[Ar+Yr]-Kr)*fr,Yi=Ti+(fi+(Se[_r+Yr]-fi)*fr-Ti)*Qt;Ie[Ye++]=Yi}return la(Ie,[G,l,y,be])},c.prototype.resizeBilinearBackprop=function(a,l,y){An([a,l],"resizeBilinearBackprop");for(var S=l.shape,U=S[0],G=S[1],ae=S[2],le=S[3],be=a.shape,Se=be[1],Ie=be[2],Me=new Float32Array(U*G*ae*le),qe=[y&&Se>1?G-1:G,y&&Ie>1?ae-1:ae],Ye=[y&&Se>1?Se-1:Se,y&&Ie>1?Ie-1:Ie],Xe=qe[0]/Ye[0],at=qe[1]/Ye[1],gt=this.readSync(a.dataId),bt=0,_t=0;_t<U;_t++)for(var jt=_t*l.strides[0],Qt=0;Qt<Se;Qt++)for(var sn=Qt*Xe,Zt=Math.floor(sn),rn=Math.min(Math.ceil(sn),G-1),Sn=jt+Zt*l.strides[1],Bn=jt+rn*l.strides[1],Mn=sn-Zt,fr=1-Mn,yr=0;yr<Ie;yr++)for(var Cr=yr*at,Nr=Math.floor(Cr),Ar=Math.min(Math.ceil(Cr),ae-1),_r=Cr-Nr,Yr=1-_r,Kr=Sn+Nr*l.strides[2],fi=Sn+Ar*l.strides[2],Ti=Bn+Nr*l.strides[2],Yi=Bn+Ar*l.strides[2],ia=fr*Yr,oa=fr*_r,wa=Mn*Yr,ba=Mn*_r,ja=0;ja<le;ja++){var Qa=gt[bt++];Me[Kr+ja]+=Qa*ia,Me[fi+ja]+=Qa*oa,Me[Ti+ja]+=Qa*wa,Me[Yi+ja]+=Qa*ba}return Ac(Me,[U,ae,G,le],l.dtype)},c.prototype.resizeNearestNeighbor=function(a,l,y,S){An(a,"resizeNearestNeighbor");for(var U=a.shape,G=U[0],ae=U[1],le=U[2],be=U[3],Se=this.readSync(a.dataId),Ie=new Float32Array(G*l*y*be),Me=[S&&l>1?ae-1:ae,S&&y>1?le-1:le],qe=[S&&l>1?l-1:l,S&&y>1?y-1:y],Ye=Me[0]/qe[0],Xe=Me[1]/qe[1],at=0,gt=0;gt<G;gt++)for(var bt=gt*a.strides[0],_t=0;_t<l;_t++)for(var jt=Ye*_t,Qt=bt+Math.min(ae-1,S?Math.round(jt):Math.floor(jt))*a.strides[1],sn=0;sn<y;sn++)for(var Zt=Xe*sn,rn=Qt+Math.min(le-1,S?Math.round(Zt):Math.floor(Zt))*a.strides[2],Sn=0;Sn<be;Sn++){var Bn=Se[rn+Sn];Ie[at++]=Bn}return la(Ie,[G,l,y,be],a.dtype)},c.prototype.resizeNearestNeighborBackprop=function(a,l,y){An([a,l],"resizeNearestNeighborBackprop");for(var S=l.shape,U=S[0],G=S[1],ae=S[2],le=S[3],be=a.shape,Se=be[1],Ie=be[2],Me=new Float32Array(U*G*ae*le),qe=this.readSync(a.dataId),Ye=[y&&Se>1?G-1:G,y&&Ie>1?ae-1:ae],Xe=[y&&Se>1?Se-1:Se,y&&Ie>1?Ie-1:Ie],at=Ye[0]/Xe[0],gt=Ye[1]/Xe[1],bt=1/at,_t=1/gt,jt=2*Math.ceil(bt)+2,Qt=2*Math.ceil(_t)+2,sn=0;sn<U;sn++)for(var Zt=sn*l.strides[0],rn=0;rn<G;rn++)for(var Sn=Zt+rn*l.strides[1],Bn=Math.floor(rn*bt),Mn=Math.floor(Bn-jt/2),fr=0;fr<ae;fr++)for(var yr=Sn+fr*l.strides[2],Cr=Math.floor(fr*_t),Nr=Math.floor(Cr-Qt/2),Ar=0;Ar<le;Ar++){for(var _r=0,Yr=0;Yr<jt;Yr++){var Kr=Yr+Mn;if(!(Kr<0||Kr>=Se)){var fi=Zt+Kr*a.strides[1],Ti=Kr*at;if(rn===Math.min(G-1,y?Math.round(Ti):Math.floor(Ti)))for(var Yi=0;Yi<Qt;Yi++){var ia=Yi+Nr;if(!(ia<0||ia>=Ie)){var oa=fi+ia*a.strides[2],wa=ia*gt;fr===Math.min(ae-1,y?Math.round(wa):Math.floor(wa))&&(_r+=qe[oa+Ar])}}}}Me[yr+Ar]=_r}return Ac(Me,l.shape,l.dtype)},c.prototype.batchNormalization=function(a,l,y,S,U,G){An([a,l,y,U,G],"batchNorm");for(var ae=this.readSync(a.dataId),le=this.readSync(l.dataId),be=this.readSync(y.dataId),Se=U?this.readSync(U.dataId):new Float32Array([1]),Ie=G?this.readSync(G.dataId):new Float32Array([0]),Me=new Float32Array(ae.length),qe=Ie.length,Ye=Se.length,Xe=be.length,at=le.length,gt=0,bt=0,_t=0,jt=0,Qt=0;Qt<ae.length;++Qt)Me[Qt]=Ie[gt++]+(ae[Qt]-le[bt++])*Se[_t++]/Math.sqrt(be[jt++]+S),gt>=qe&&(gt=0),bt>=at&&(bt=0),_t>=Ye&&(_t=0),jt>=Xe&&(jt=0);return Ac(Me,a.shape)},c.prototype.localResponseNormalization4D=function(a,l,y,S,U){An(a,"localResponseNormalization4D");var G=a.shape[3],ae=G-1,le=this.readSync(a.dataId),be=a.size,Se=new Float32Array(be);function Ie(Xe){for(var at=Xe%G,gt=Xe-at+Math.max(0,at-l),bt=Xe-at+Math.min(at+l,ae),_t=0;gt<=bt;gt++){var jt=le[gt];_t+=jt*jt}return _t}for(var Me=0;Me<be;Me++){var qe=Ie(Me),Ye=le[Me]*Math.pow(y+S*qe,-U);Se[Me]=Ye}return Ac(Se,a.shape)},c.prototype.LRNGrad=function(a,l,y,S,U,G,ae){An(a,"LRNGrad");for(var le=a.shape[3],be=this.readSync(a.dataId),Se=this.readSync(l.dataId),Ie=this.readSync(y.dataId),Me=new Float32Array(a.size),qe=a.size,Ye=0;Ye<qe;Ye++){for(var Xe=Ye%le,at=Ye-Xe+Math.max(0,Xe-S),gt=Ye-Xe+Math.min(le,Xe+S+1),bt=0,_t=at;_t<gt;_t++)bt+=Math.pow(Se[_t],2);for(bt=G*bt+U,_t=at;_t<gt;_t++){var jt=-2*G*ae*Se[_t]*Ie[Ye]/bt;Ye===_t&&(jt+=Math.pow(bt,-ae)),jt*=be[Ye],Me[_t]+=jt}}return Ac(Me,a.shape)},c.prototype.multinomial=function(a,l,y,S){An(a,"multinomial");for(var U=l?a:Ue(a),G=U.shape[0],ae=U.shape[1],le=Io([G,y],"int32"),be=this.readSync(le.dataId),Se=this.readSync(U.dataId),Ie=0;Ie<G;++Ie){var Me=Ie*ae,qe=new Float32Array(ae-1);qe[0]=Se[Me];for(var Ye=1;Ye<qe.length;++Ye)qe[Ye]=qe[Ye-1]+Se[Me+Ye];for(var Xe=$h(S.toString()),at=Ie*y,gt=0;gt<y;++gt){var bt=Xe();be[at+gt]=qe.length;for(var _t=0;_t<qe.length;_t++)if(bt<qe[_t]){be[at+gt]=_t;break}}}return le},c.prototype.oneHot=function(a,l,y,S){An(a,"oneHot");var U=new Float32Array(a.size*l);U.fill(S);for(var G=this.readSync(a.dataId),ae=0;ae<a.size;++ae)G[ae]>=0&&G[ae]<l&&(U[ae*l+G[ae]]=y);return sc(U,[a.size,l],"int32")},c.prototype.nonMaxSuppression=function(a,l,y,S,U){return An(a,"nonMaxSuppression"),zo(this.readSync(a.dataId),this.readSync(l.dataId),y,S,U)},c.prototype.fft=function(a){return this.fftBatch(a,!1)},c.prototype.ifft=function(a){return this.fftBatch(a,!0)},c.prototype.fftBatch=function(a,l){for(var y=a.shape[0],S=a.shape[1],U=Ki(a.shape,"float32"),G=Ki(a.shape,"float32"),ae=ms(a).as2D(y,S),le=Ks(a).as2D(y,S),be=0;be<y;be++)for(var Se=ae.slice([be,0],[1,S]),Ie=le.slice([be,0],[1,S]),Me=aa(Se,Ie),qe=this.readSync(this.fftImpl(Me,l).dataId),Ye=0;Ye<S;Ye++){var Xe=Vo(qe,Ye);U.values[be*S+Ye]=Xe.real,G.values[be*S+Ye]=Xe.imag}return aa(U.toTensor(),G.toTensor()).as2D(y,S)},c.prototype.fftImpl=function(a,l){var y=a.as1D(),S=y.size;if(this.isExponentOf2(S)){var U=this.fftRadix2(y,S,l).as2D(a.shape[0],a.shape[1]);return l&&(U=aa(ms(U).div(Mr(S)),Ks(U).div(Mr(S)))),U}var G=this.readSync(a.dataId),ae=function(le){for(var be=new Float32Array(le.length/2),Se=new Float32Array(le.length/2),Ie=0;Ie<le.length;Ie+=2)be[Ie/2]=le[Ie],Se[Ie/2]=le[Ie+1];return{real:be,imag:Se}}(this.fourierTransformByMatmul(G,S,l));return aa(ae.real,ae.imag).as2D(a.shape[0],a.shape[1])},c.prototype.isExponentOf2=function(a){return(a&a-1)==0},c.prototype.fftRadix2=function(a,l,y){if(l===1)return a;var S=this.readSync(a.dataId),U=l/2,G=function(at){for(var gt=Math.ceil(at.length/4),bt=new Float32Array(gt),_t=new Float32Array(gt),jt=0;jt<at.length;jt+=4)bt[Math.floor(jt/4)]=at[jt],_t[Math.floor(jt/4)]=at[jt+1];return{real:bt,imag:_t}}(S),ae=aa(G.real,G.imag).as1D(),le=function(at){for(var gt=Math.floor(at.length/4),bt=new Float32Array(gt),_t=new Float32Array(gt),jt=2;jt<at.length;jt+=4)bt[Math.floor(jt/4)]=at[jt],_t[Math.floor(jt/4)]=at[jt+1];return{real:bt,imag:_t}}(S),be=aa(le.real,le.imag).as1D();ae=this.fftRadix2(ae,U,y),be=this.fftRadix2(be,U,y);var Se=function(at,gt){for(var bt=new Float32Array(at/2),_t=new Float32Array(at/2),jt=0;jt<Math.ceil(at/2);jt++){var Qt=(gt?2:-2)*Math.PI*(jt/at);bt[jt]=Math.cos(Qt),_t[jt]=Math.sin(Qt)}return{real:bt,imag:_t}}(l,y),Ie=aa(Se.real,Se.imag).mul(be),Me=ae.add(Ie),qe=ae.sub(Ie),Ye=ms(Me).concat(ms(qe)),Xe=Ks(Me).concat(Ks(qe));return aa(Ye,Xe).as1D()},c.prototype.fourierTransformByMatmul=function(a,l,y){for(var S=new Float32Array(2*l),U=0;U<l;U++){for(var G=0,ae=0,le=0;le<l;le++){var be=Ia(U*le,l,y),Se=Vo(a,le);G+=Se.real*be.real-Se.imag*be.imag,ae+=Se.real*be.imag+Se.imag*be.real}y&&(G/=l,ae/=l),qo(S,G,ae,U)}return S},c.prototype.depthToSpace=function(a,l,y){Ce(y==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+y}),Ce(l>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+l});for(var S=a.shape[0],U=a.shape[1],G=a.shape[2],ae=a.shape[3],le=U*l,be=G*l,Se=ae/(l*l),Ie=this.readSync(a.dataId),Me=new Float32Array(S*le*be*Se),qe=0,Ye=0;Ye<S;++Ye)for(var Xe=0;Xe<le;++Xe)for(var at=Math.floor(Xe/l),gt=Xe%l,bt=0;bt<be;++bt)for(var _t=Math.floor(bt/l),jt=(gt*l+bt%l)*Se,Qt=0;Qt<Se;++Qt){var sn=Qt+jt+ae*(_t+G*(at+U*Ye));Me[qe++]=Ie[sn]}return Ac(Me,[S,le,be,Se])},c.prototype.broadcastedBinaryOp=function(a,l,y,S){var U=Co(a.shape,l.shape),G=Ki(U,y),ae=this.readSync(a.dataId),le=this.readSync(l.dataId),be=Ms(a.shape,U),Se=Ms(l.shape,U),Ie=G.values;if(be.length+Se.length===0)for(var Me=0;Me<Ie.length;++Me)Ie[Me]=S(ae[Me%ae.length],le[Me%le.length]);else{var qe=this.bufferSync(a),Ye=this.bufferSync(l),Xe=function(at){var gt=G.indexToLoc(at),bt=gt.slice(-a.rank);be.forEach(function(sn){return bt[sn]=0});var _t=qe.locToIndex(bt),jt=gt.slice(-l.rank);Se.forEach(function(sn){return jt[sn]=0});var Qt=Ye.locToIndex(jt);Ie[at]=S(ae[_t],le[Qt])};for(Me=0;Me<Ie.length;++Me)Xe(Me)}return G.toTensor()},c.prototype.broadcastedBinaryComplexOp=function(a,l,y){var S=Co(a.shape,l.shape),U=Ki(S,"float32"),G=Ki(S,"float32"),ae=this.readSync(a.dataId),le=this.readSync(l.dataId),be=Ms(a.shape,S),Se=Ms(l.shape,S),Ie=U.values,Me=G.values;if(be.length+Se.length===0)for(var qe=0;qe<Ie.length;qe++){var Ye=qe%ae.length,Xe=qe%le.length,at=y(ae[2*Ye],ae[2*Ye+1],le[2*Xe],le[2*Xe+1]);Ie[qe]=at.real,Me[qe]=at.imag}else{var gt=this.bufferSync(this.data.get(a.dataId).complexTensors.real),bt=this.bufferSync(this.data.get(l.dataId).complexTensors.real),_t=function(jt){var Qt=U.indexToLoc(jt),sn=Qt.slice(-a.rank);be.forEach(function(Mn){return sn[Mn]=0});var Zt=gt.locToIndex(sn),rn=Qt.slice(-l.rank);Se.forEach(function(Mn){return rn[Mn]=0});var Sn=bt.locToIndex(rn),Bn=y(ae[2*Zt],ae[2*Zt+1],le[2*Sn],le[2*Sn+1]);Ie[jt]=Bn.real,Me[jt]=Bn.imag};for(qe=0;qe<Ie.length;qe++)_t(qe)}return this.complex(U.toTensor(),G.toTensor())},c.prototype.split=function(a,l,y){return Pa(a,l,y)},c.prototype.dispose=function(){},c.prototype.floatPrecision=function(){return 32},c.prototype.epsilon=function(){return 1e-7},c.prototype.cropAndResize=function(a,l,y,S,U,G){for(var ae=a.shape,le=ae[0],be=ae[1],Se=ae[2],Ie=ae[3],Me=l.shape[0],qe=S[0],Ye=S[1],Xe=Ki([Me,qe,Ye,Ie],"float32"),at=this.readSync(l.dataId),gt=this.readSync(y.dataId),bt=this.readSync(a.dataId),_t=a.strides,jt=Xe.strides,Qt=0;Qt<Me;Qt++){var sn=4*Qt,Zt=at[sn],rn=at[sn+1],Sn=at[sn+2],Bn=at[sn+3],Mn=gt[Qt];if(!(Mn>=le))for(var fr=qe>1?(Sn-Zt)*(be-1)/(qe-1):0,yr=Ye>1?(Bn-rn)*(Se-1)/(Ye-1):0,Cr=0;Cr<qe;Cr++){var Nr=qe>1?Zt*(be-1)+Cr*fr:.5*(Zt+Sn)*(be-1);if(Nr<0||Nr>be-1)for(var Ar=0;Ar<Ye;Ar++)for(var _r=0;_r<Ie;_r++){var Yr=_r+Ar*jt[2]+Cr*jt[1]+Qt*jt[0];Xe.values[Yr]=G}else if(U==="bilinear"){var Kr=Math.floor(Nr),fi=Math.ceil(Nr),Ti=Nr-Kr;for(Ar=0;Ar<Ye;Ar++)if((Uo=Ye>1?rn*(Se-1)+Ar*yr:.5*(rn+Bn)*(Se-1))<0||Uo>Se-1)for(_r=0;_r<Ie;_r++)Yr=_r+Ar*jt[2]+Cr*jt[1]+Qt*jt[0],Xe.values[Yr]=G;else{var Yi=Math.floor(Uo),ia=Math.ceil(Uo),oa=Uo-Yi;for(_r=0;_r<Ie;_r++){var wa=bt[Yr=_r+Yi*_t[2]+Kr*_t[1]+Mn*_t[0]],ba=bt[Yr=_r+ia*_t[2]+Kr*_t[1]+Mn*_t[0]],ja=bt[Yr=_r+Yi*_t[2]+fi*_t[1]+Mn*_t[0]],Qa=wa+(ba-wa)*oa,Ls=ja+(bt[Yr=_r+ia*_t[2]+fi*_t[1]+Mn*_t[0]]-ja)*oa;Yr=_r+Ar*jt[2]+Cr*jt[1]+Qt*jt[0],Xe.values[Yr]=Qa+(Ls-Qa)*Ti}}}else for(Ar=0;Ar<Ye;++Ar){var Uo;if((Uo=Ye>1?rn*(Se-1)+Ar*yr:.5*(rn+Bn)*(Se-1))<0||Uo>Se-1)for(_r=0;_r<Ie;_r++)Yr=_r+Ar*jt[2]+Cr*jt[1]+Qt*jt[0],Xe.values[Yr]=G;else{var ka=Math.round(Uo),Za=Math.round(Nr);for(_r=0;_r<Ie;_r++){var mc=_r+ka*_t[2]+Za*_t[1]+Mn*_t[0],gc=_r+Ar*jt[2]+Cr*jt[1]+Qt*jt[0];Xe.values[gc]=bt[mc]}}}}}return Xe.toTensor()},c.prototype.sparseToDense=function(a,l,y,S){var U=hc(0,a,y),G=U.sliceRank,ae=U.numUpdates,le=U.sliceSize,be=U.strides,Se=U.outputSize;return this.scatter(a,l,y,Se,le,ae,G,be,S,!1)},c.prototype.gatherND=function(a,l){var y=l.shape,S=y[y.length-1],U=iu(a,l),G=U[0],ae=U[1],le=U[2],be=U[3];if(ae===0)return la([],G,a.dtype);for(var Se=new Gi([ae,le],a.dtype),Ie=this.readSync(l.dataId),Me=this.readSync(a.dataId),qe=0;qe<ae;qe++){for(var Ye=[],Xe=0,at=0;at<S;at++){var gt=Ie[qe*S+at];Xe+=gt*be[at],Ye.push(gt)}if(Xe<0||Xe>=a.size/le)throw new Error("Invalid indices: "+Ye+" does not index into "+a.shape);for(var bt=0;bt<le;bt++)Se.values[qe*le+bt]=Me[Xe*le+bt]}return Se.toTensor().reshape(G)},c.prototype.scatterND=function(a,l,y){var S=hc(0,a,y),U=S.sliceRank,G=S.numUpdates,ae=S.sliceSize,le=S.strides,be=S.outputSize,Se=Mr(0);return this.scatter(a,l,y,be,ae,G,U,le,Se,!0)},c.prototype.fill=function(a,l,y){var S=pn(y=y||we(l),Qe(a));return S.fill(l),He.makeTensor(S,a,y,this)},c.prototype.onesLike=function(a){if(a.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(a.shape,1,a.dtype)},c.prototype.zerosLike=function(a){var l=pn(a.dtype,Qe(a.shape));return this.makeOutput(l,a.shape,a.dtype)},c.prototype.linspace=function(a,l,y){return qi(a,l,y)},c.prototype.scatter=function(a,l,y,S,U,G,ae,le,be,Se){var Ie=[S/U,U],Me=this.readSync(a.dataId),qe=this.readSync(l.dataId);if(S===0)return la([],y,l.dtype);var Ye=new Gi(Ie,l.dtype);Ye.values.fill(this.readSync(be.dataId)[0]);for(var Xe=0;Xe<G;Xe++){for(var at=[],gt=0,bt=0;bt<ae;bt++){var _t=Me[Xe*ae+bt];at.push(_t),gt+=_t*le[bt]}if(gt<0||gt>=S/U)throw new Error("Invalid indices: "+at+" does not index into "+y);for(var jt=0;jt<U;jt++)Se?Ye.values[gt*U+jt]+=qe[Xe*U+jt]:Ye.values[gt*U+jt]=l.rank===0?qe[0]:qe[Xe*U+jt]}return Ye.toTensor().reshape(y)},c}(Jt);function Jr(p,c){return{kernelName:p,backendName:"cpu",kernelFunc:function(a){var l=a.inputs,y=a.backend,S=l,U=S.a,G=S.b,ae=y;An([U,G],p);var le=ae.data.get(U.dataId).values,be=ae.data.get(G.dataId).values,Se=c(U.shape,G.shape,le,be,U.dtype),Ie=Se[0],Me=Se[1];return{dataId:ae.write(Ie,Me,U.dtype),shape:Me,dtype:U.dtype}}}}function Xi(p){return function(c,a,l,y,S){var U=Co(c,a),G=U.length,ae=Tr(U),le=tr(S,Qe(U)),be=c.length,Se=a.length,Ie=Tr(c),Me=Tr(a),qe=Ms(c,U),Ye=Ms(a,U);if(qe.length+Ye.length===0)for(var Xe=0;Xe<le.length;++Xe)le[Xe]=p(l[Xe%l.length],y[Xe%y.length]);else{var at=function(gt){var bt=Br(gt,G,ae),_t=bt.slice(-be);qe.forEach(function(Zt){return _t[Zt]=0});var jt=Pr(_t,be,Ie),Qt=bt.slice(-Se);Ye.forEach(function(Zt){return Qt[Zt]=0});var sn=Pr(Qt,Se,Me);le[gt]=p(l[jt],y[sn])};for(Xe=0;Xe<le.length;++Xe)at(Xe)}return[le,U]}}He.registerBackend("cpu",function(){return new ci},1);var lo=Xi(function(p,c){return p/c}),io=Jr(Eo,lo),ga={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(p){var c=p.inputs,a=p.attrs,l=p.backend,y=c.x,S=a,U=S.filterSize,G=S.strides,ae=S.pad,le=S.includeBatchInIndex,be=l;An(y,"MaxPoolWithArgmax");var Se=be.data.get(y.dataId).values,Ie=Nn(y.shape,U,G,[1,1],ae),Me=function(gt,bt,_t,jt,Qt){var sn=Sr(gt,0,_t,Tr(bt),Qt,"max"),Zt=Ur(gt,bt,_t,Qt,!0,jt);return[sn.values,Zt.values]}(Se,y.shape,y.dtype,le,Ie),qe=Me[0],Ye=Me[1],Xe=be.write(qe,Ie.outShape,y.dtype),at=be.write(Ye,Ie.outShape,y.dtype);return[{dataId:Xe,shape:Ie.outShape,dtype:y.dtype},{dataId:at,shape:Ie.outShape,dtype:"int32"}]}},Ya={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(p){var c=p.inputs,a=p.backend,l=p.attrs,y=c,S=y.boxes,U=y.scores,G=l,ae=G.maxOutputSize,le=G.iouThreshold,be=G.scoreThreshold,Se=G.softNmsSigma,Ie=a;An(S,"NonMaxSuppressionWithScore");var Me=Sa(Ie.data.get(S.dataId).values,Ie.data.get(U.dataId).values,ae,le,be,Se);return[Me.selectedIndices,Me.selectedScores]}},Ta={kernelName:"Square",backendName:"cpu",kernelFunc:function(p){var c=p.inputs,a=p.backend,l=c.x,y=a;An(l,"square");for(var S=y.data.get(l.dataId).values,U=new Float32Array(S.length),G=0;G<S.length;++G){var ae=S[G];U[G]=ae*ae}return{dataId:y.write(U,l.shape,l.dtype),shape:l.shape,dtype:l.dtype}}},Aa=Xi(function(p,c){var a=p-c;return a*a});function Ma(p,c,a,l,y){for(var S=Qe(c),U=c.length,G=Tr(c),ae=Tr(y),le=tr(a,Qe(y)),be=0;be<S;++be){for(var Se=Br(be,U,G),Ie=new Array(Se.length),Me=0;Me<Ie.length;Me++)Ie[Me]=Se[l[Me]];le[Pr(Ie,U,ae)]=p[be]}return le}for(var rs=0,va=[Ya,Ta,Jr(Sf,Aa),io,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(p){var c=p.inputs,a=p.attrs,l=p.backend,y=c.x,S=a.perm,U=l;An(y,"transpose");for(var G=y.shape.length,ae=new Array(G),le=0;le<ae.length;le++)ae[le]=y.shape[S[le]];var be=Ma(U.data.get(y.dataId).values,y.shape,y.dtype,S,ae);return{dataId:U.write(be,ae,y.dtype),shape:ae,dtype:y.dtype}}},ga];rs<va.length;rs++)pe(va[rs]);for(var Ns,Tc=0,Ji=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(p){var c=p.inputs,a=p.backend,l=p.attrs,y=c.pixels,S=l.numChannels,U=typeof HTMLVideoElement!="undefined"&&y instanceof HTMLVideoElement,G=typeof HTMLImageElement!="undefined"&&y instanceof HTMLImageElement,ae=U?[y.videoWidth,y.videoHeight]:[y.width,y.height],le=ae[0],be=ae[1],Se=[be,le],Ie=[be,le,S];(G||U)&&(Ns==null&&(Ns=document.createElement("canvas").getContext("2d")),Ns.canvas.width=le,Ns.canvas.height=be,Ns.drawImage(y,0,0,le,be),y=Ns.canvas);var Me=a.makeTensorInfo(Se,"int32");a.texData.get(Me.dataId).usage=kr.PIXELS,a.gpgpu.uploadPixelDataToTexture(a.getTexture(Me.dataId),y);var qe=W().getBool("WEBGL_PACK")?new function(Xe){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var at=fa(),gt=Xe[0],bt=Xe[1];this.outputShape=Xe,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+bt+".0, "+gt+`.0);
            vec4 values = `+at.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+at.output+` = result;
      }
    `}(Ie):new function(Xe){this.variableNames=["A"];var at=fa(),gt=Xe[0],bt=Xe[1];this.outputShape=Xe,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+bt+".0, "+gt+`.0);

        vec4 values = `+at.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}(Ie),Ye=a.runWebGLProgram(qe,[Me],"int32");return a.disposeData(Me.dataId),Ye}},{kernelName:Eo,backendName:"webgl",kernelFunc:function(p){var c=p.inputs,a=p.backend,l=c;return function(y,S,U){var G=new Va(`
if (a == b) {
  return 1.0;
};
return a / b;`,y.shape,S.shape);return W().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(G=new Ps(`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,y.shape,S.shape,!0)),U.runWebGLProgram(G,[y,S],"float32")}(l.a,l.b,a)}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(p){var c=p.inputs,a=p.backend,l=p.attrs;Jf("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var y=c,S=y.boxes,U=y.scores,G=l,ae=G.maxOutputSize,le=G.iouThreshold,be=G.scoreThreshold,Se=G.softNmsSigma,Ie=a,Me=Sa(Ie.readSync(S.dataId),Ie.readSync(U.dataId),ae,le,be,Se);return[Me.selectedIndices,Me.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(p){var c=p.inputs,a=p.backend,l=c.x,y=a,S=new ra(l.shape,"return x * x;");return y.runWebGLProgram(S,[l],l.dtype)}},{kernelName:Sf,backendName:"webgl",kernelFunc:function(p){var c=p.inputs,a=p.backend,l=c,y=l.a,S=l.b,U=a,G=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ps("return (a - b) * (a - b);",y.shape,S.shape):new Va("return (a - b) * (a - b);",y.shape,S.shape);return U.compileAndRun(G,[y,S])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(p){for(var c,a=p.inputs,l=p.attrs,y=p.backend,S=a.x,U=l.perm,G=y,ae=S.shape.length,le=new Array(ae),be=0;be<le.length;be++)le[be]=S.shape[U[be]];if(G.shouldExecuteOnCPU([S])){var Se=Ma(G.texData.get(S.dataId).values,S.shape,S.dtype,U,le);c=G.makeTensorInfo(le,S.dtype),G.texData.get(c.dataId).values=Se}else c=function(Ie,Me,qe){var Ye=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(Xe,at){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var gt=new Array(Xe.length),bt=0;bt<gt.length;bt++)gt[bt]=Xe[at[bt]];if(this.outputShape=gt,this.rank=gt.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var _t=Da(this.rank),jt=ku("rc",this.rank),Qt=new Array(this.rank);for(bt=0;bt<at.length;bt++)Qt[at[bt]]=jt[bt];var sn="vec2("+Qt.slice(-2).join()+")",Zt="++"+jt[this.rank-1]+" < "+gt[this.rank-1],rn="getChannel(getA("+Qt.join()+"), "+sn+")";this.userCode=`
    void main() {
      `+_t+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+rn+`;
      if(`+Zt+`) {
        result[1] = `+rn+`;
      }
      --`+jt[this.rank-1]+`;
      if(++`+jt[this.rank-2]+" < "+gt[this.rank-2]+`) {
        result[2] = `+rn+`;
        if(`+Zt+`) {
          result[3] = `+rn+`;
        }
      }
      setOutput(result);
    }
    `}(Ie.shape,Me):new function(Xe,at){this.variableNames=["A"];for(var gt=new Array(Xe.length),bt=0;bt<gt.length;bt++)gt[bt]=Xe[at[bt]];this.outputShape=gt,this.rank=gt.length;var _t=Da(this.rank),jt=function(Qt){var sn=Qt.length;if(sn>6)throw Error("Transpose for rank "+sn+" is not yet supported");for(var Zt=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],rn=new Array(sn),Sn=0;Sn<Qt.length;Sn++)rn[Qt[Sn]]=Zt[Sn];return rn.join()}(at);this.userCode=`
    void main() {
      `+_t+` resRC = getOutputCoords();
      setOutput(getA(`+jt+`));
    }
    `}(Ie.shape,Me);return qe.runWebGLProgram(Ye,[Ie],Ie.dtype)}(S,U,G);return c}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(p){var c=p.inputs,a=p.attrs,l=p.backend,y=c.x,S=a,U=S.filterSize,G=S.strides,ae=S.pad,le=S.includeBatchInIndex,be=l;Ce(y.shape.length===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+y.shape.length+"."});var Se=[1,1];Ce(zr(G,Se),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+G+" and dilations '"+Se+"'"});var Ie=Nn(y.shape,U,G,Se,ae),Me=function(qe,Ye,Xe,at){var gt=new Od(Xe,"max",!1),bt=at.runWebGLProgram(gt,[qe],"float32");return gt=new Od(Xe,"max",!0,!0,Ye),[bt,at.runWebGLProgram(gt,[qe],"float32")]}(y,le,Ie,be);return[Me[0],Me[1]]}}];Tc<Ji.length;Tc++)pe(Ji[Tc]);for(var Hi=0,mu=[{kernelName:go,inputsToSave:["a","b"],gradFunc:function(p,c){var a=c[0],l=c[1],y=Co(a.shape,l.shape);return{a:function(){var S=p,U=Xs(a.shape,y);return U.length>0&&(S=S.sum(U)),S.reshape(a.shape)},b:function(){var S=p,U=Xs(l.shape,y);return U.length>0&&(S=S.sum(U)),S.reshape(l.shape)}}}},{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(p,c){var a={};return c.forEach(function(l,y){a[y]=function(){return p.clone()}}),a}},{kernelName:Df,gradFunc:function(p,c,a){for(var l=a,y=l.inputShape,S=l.shape,U=Array.from(S),G=y.length-1;G>=0;G--)if(y[G]===S[G])U[G]=1;else if(y[G]!==1)throw new Error("broadcastTo(): ["+y+"] cannot be broadcast to ["+S+"].");var ae=[];for(G=0;G<U.length;G++)U[G]>1&&ae.push(G);return{x:function(){return p.sum(ae,!0)}}}},{kernelName:Eo,inputsToSave:["a","b"],gradFunc:function(p,c){var a=c[0],l=c[1],y=Co(a.shape,l.shape);return{a:function(){var S=ts(p,l.toFloat()),U=Xs(a.shape,y);return U.length>0?bh(S,U).reshape(a.shape):S},b:function(){var S=p.mul(a.toFloat()),U=Xs(l.shape,y);U.length>0&&(S=bh(S,U).reshape(l.shape));var G=ed(l);return Os(ts(S,G.toFloat()))}}}},{kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(p,c,a){var l=a.varianceEpsilon,y=c[0],S=c[1],U=c[2],G=c[3],ae=Rf(y),le=G==null?Mr(1):G,be=Xs(S.shape,ae.shape),Se=[];if(S.rank===1){for(var Ie=0;Ie<ae.shape.length-1;++Ie)Se.push(ae.shape[Ie]);Se.push(1)}var Me=js(y,S),qe=Kt(p,le),Ye=Vh(Ua(U,Mr(l))),Xe=Kt(Kt(Kt(Ye,Ye),Ye),Mr(-.5));return{x:function(){return S.rank===1?Fu(Kt(Kt(p,Jh(Ye.as4D(1,1,1,S.shape[0]),Se)),le),y.shape):Fu(Kt(Kt(p,Ye),le),y.shape)},mean:function(){var at=Kt(Kt(Ye,Mr(-1)),qe);return S.rank===1&&(at=bh(at,be)),Fu(at,S.shape)},variance:function(){var at=Kt(Kt(Xe,Me),qe);return S.rank===1&&(at=bh(at,be)),Fu(at,S.shape)},scale:function(){var at=Kt(Me,Ye),gt=Kt(p,at);return S.rank===1&&(gt=bh(gt,be)),Fu(gt,S.shape)},offset:function(){var at=p;return S.rank===1&&(at=bh(at,be)),Fu(at,S.shape)}}}},{kernelName:Tf,gradFunc:function(p){return{x:function(){return p.toFloat()}}}},{kernelName:af,inputsToSave:["indices"],gradFunc:function(p,c){var a=c[0];return{indices:function(){return Io(a.shape,"float32")}}}},{kernelName:ma,inputsToSave:["x"],gradFunc:function(p,c,a){var l=c[0],y=a.paddings.map(function(S){return S[0]});return{x:function(){return p.slice(y,l.shape)}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(p,c){var a=c[0];return{x:function(){return p.mul(a.toFloat().mul(2))}}}},{kernelName:Sf,inputsToSave:["a","b"],gradFunc:function(p,c){var a=c[0],l=c[1],y=Mr(2);return{a:function(){return Kt(p,Kt(y,js(a,l)))},b:function(){return Kt(p,Kt(y,js(l,a)))}}}},{kernelName:sf,inputsToSave:["x"],gradFunc:function(p,c,a){var l=c[0],y=a.reps;return{x:function(){var S=Ri(l);if(l.rank===1)for(var U=0;U<y[0];++U)S=S.add(p.slice([U*l.shape[0]],[l.shape[0]]));else if(l.rank===2)for(U=0;U<y[0];++U)for(var G=0;G<y[1];++G)S=S.add(p.slice([U*l.shape[0],G*l.shape[1]],[l.shape[0],l.shape[1]]));else if(l.rank===3)for(U=0;U<y[0];++U)for(G=0;G<y[1];++G)for(var ae=0;ae<y[2];++ae)S=S.add(p.slice([U*l.shape[0],G*l.shape[1],ae*l.shape[2]],[l.shape[0],l.shape[1],l.shape[2]]));else{if(l.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+l.rank+" tensors yet.");for(U=0;U<y[0];++U)for(G=0;G<y[1];++G)for(ae=0;ae<y[2];++ae)for(var le=0;le<y[3];++le)S=S.add(p.slice([U*l.shape[0],G*l.shape[1],ae*l.shape[2],le*l.shape[3]],[l.shape[0],l.shape[1],l.shape[2],l.shape[3]]))}return S}}}},{kernelName:"Transpose",gradFunc:function(p,c,a){var l=vl(a.perm);return{x:function(){return vt(p,l)}}}}];Hi<mu.length;Hi++)Oe(mu[Hi]);var os=function(){function p(){}return p.prototype.fetch=function(c,a){return fetch(c,a)},p.prototype.now=function(){return performance.now()},p.prototype.encode=function(c,a){if(a!=="utf-8"&&a!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+a);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(c)},p.prototype.decode=function(c,a){return new TextDecoder(a).decode(c)},p}();W().get("IS_BROWSER")&&W().setPlatform("browser",new os);var ya,cl=function(){function p(){this.util=o(388),this.textEncoder=new this.util.TextEncoder}return p.prototype.fetch=function(c,a){return W().global.fetch!=null?W().global.fetch(c,a):(ya==null&&(ya=o(389)),ya(c,a))},p.prototype.now=function(){var c=z.hrtime();return 1e3*c[0]+c[1]/1e6},p.prototype.encode=function(c,a){if(a!=="utf-8"&&a!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+a);return this.textEncoder.encode(c)},p.prototype.decode=function(c,a){return c.length===0?"":new this.util.TextDecoder(a).decode(c)},p}();W().get("IS_NODE")&&W().setPlatform("node",new cl);var gu={float32:4,int32:4,uint16:2,uint8:1,bool:1},ll=4;function xp(p,c){for(var a={},l=0,y=function(G){var ae=G.name,le=G.dtype,be=G.shape,Se=Qe(be),Ie=void 0;if("quantization"in G){var Me=G.quantization;if(Me.dtype!=="uint8"&&Me.dtype!=="uint16")throw new Error("Weight "+G.name+" has unknown quantization dtype "+Me.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var qe=gu[Me.dtype],Ye=p.slice(l,l+Se*qe),Xe=Me.dtype==="uint8"?new Uint8Array(Ye):new Uint16Array(Ye);if(le==="float32")Ie=Float32Array.from(Xe,function(Qt){return Qt*Me.scale+Me.min});else{if(le!=="int32")throw new Error("Unsupported dtype in weight '"+ae+"': "+le);Ie=Int32Array.from(Xe,function(Qt){return Math.round(Qt*Me.scale+Me.min)})}l+=Se*qe}else if(le==="string"){var at=Qe(G.shape);Ie=[];for(var gt=0;gt<at;gt++){var bt=new Uint32Array(p.slice(l,l+ll))[0];l+=ll;var _t=new Uint8Array(p.slice(l,l+bt));Ie.push(_t),l+=bt}}else{var jt=gu[le];if(Ye=p.slice(l,l+Se*jt),le==="float32")Ie=new Float32Array(Ye);else if(le==="int32")Ie=new Int32Array(Ye);else{if(le!=="bool")throw new Error("Unsupported dtype in weight '"+ae+"': "+le);Ie=new Uint8Array(Ye)}l+=Se*jt}a[ae]=la(Ie,be,le)},S=0,U=c;S<U.length;S++)y(U[S]);return a}var Ld=I!==void 0&&(typeof Blob=="undefined"||typeof atob=="undefined"||typeof btoa=="undefined");function kh(p){return Ld?I.byteLength(p):new Blob([p]).size}function ud(p){var c=0;p.forEach(function(y){c+=y.byteLength});var a=new Uint8Array(c),l=0;return p.forEach(function(y){a.set(new Uint8Array(y),l),l+=y.byteLength}),a.buffer}function xf(p){for(p=p.trim();p.endsWith("/");)p=p.slice(0,p.length-1);var c=p.split("/");return c[c.length-1]}function Gl(p){if(p.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:p.modelTopology==null?0:kh(JSON.stringify(p.modelTopology)),weightSpecsBytes:p.weightSpecs==null?0:kh(JSON.stringify(p.weightSpecs)),weightDataBytes:p.weightData==null?0:p.weightData.byteLength}}var Ja=function(){function p(){this.saveRouters=[],this.loadRouters=[]}return p.getInstance=function(){return p.instance==null&&(p.instance=new p),p.instance},p.registerSaveRouter=function(c){p.getInstance().saveRouters.push(c)},p.registerLoadRouter=function(c){p.getInstance().loadRouters.push(c)},p.getSaveHandlers=function(c){return p.getHandlers(c,"save")},p.getLoadHandlers=function(c,a){return p.getHandlers(c,"load",a)},p.getHandlers=function(c,a,l){var y=[];return(a==="load"?p.getInstance().loadRouters:p.getInstance().saveRouters).forEach(function(S){var U=S(c,l);U!==null&&y.push(U)}),y},p}(),_h="://",Uf=function(){function p(){this.managers={}}return p.getInstance=function(){return p.instance==null&&(p.instance=new p),p.instance},p.registerManager=function(c,a){Ce(c!=null,function(){return"scheme must not be undefined or null."}),c.endsWith(_h)&&(c=c.slice(0,c.indexOf(_h))),Ce(c.length>0,function(){return"scheme must not be an empty string."});var l=p.getInstance();Ce(l.managers[c]==null,function(){return"A model store manager is already registered for scheme '"+c+"'."}),l.managers[c]=a},p.getManager=function(c){var a=this.getInstance().managers[c];if(a==null)throw new Error("Cannot find model manager for scheme '"+c+"'");return a},p.getSchemes=function(){return Object.keys(this.getInstance().managers)},p}();function gs(p){if(p.indexOf(_h)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Uf.getSchemes().join(","));return{scheme:p.split(_h)[0],path:p.split(_h)[1]}}function as(p,c,a){return a===void 0&&(a=!1),M(this,void 0,void 0,function(){var l,y,S,U,G,ae,le,be,Se;return V(this,function(Ie){switch(Ie.label){case 0:return Ce(p!==c,function(){return"Old path and new path are the same: '"+p+"'"}),Ce((l=Ja.getLoadHandlers(p)).length>0,function(){return"Copying failed because no load handler is found for source URL "+p+"."}),Ce(l.length<2,function(){return"Copying failed because more than one ("+l.length+") load handlers for source URL "+p+"."}),y=l[0],Ce((S=Ja.getSaveHandlers(c)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+c+"."}),Ce(S.length<2,function(){return"Copying failed because more than one ("+l.length+") save handlers for destination URL "+c+"."}),U=S[0],G=gs(p).scheme,ae=gs(p).path,le=G===gs(p).scheme,[4,y.load()];case 1:return be=Ie.sent(),a&&le?[4,Uf.getManager(G).removeModel(ae)]:[3,3];case 2:Ie.sent(),Ie.label=3;case 3:return[4,U.save(be)];case 4:return Se=Ie.sent(),!a||le?[3,6]:[4,Uf.getManager(G).removeModel(ae)];case 5:Ie.sent(),Ie.label=6;case 6:return[2,Se.modelArtifactsInfo]}})})}var Au="models_store",zd="model_info_store";function wp(){if(!W().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var p=window||self,c=p.indexedDB||p.mozIndexedDB||p.webkitIndexedDB||p.msIndexedDB||p.shimIndexedDB;if(c==null)throw new Error("The current browser does not appear to support IndexedDB.");return c}function kp(p){var c=p.result;c.createObjectStore(Au,{keyPath:"modelPath"}),c.createObjectStore(zd,{keyPath:"modelPath"})}var Wf=function(){function p(c){if(this.indexedDB=wp(),c==null||!c)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=c}return p.prototype.save=function(c){return M(this,void 0,void 0,function(){return V(this,function(a){if(c.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,c)]})})},p.prototype.load=function(){return M(this,void 0,void 0,function(){return V(this,function(c){return[2,this.databaseAction(this.modelPath)]})})},p.prototype.databaseAction=function(c,a){var l=this;return new Promise(function(y,S){var U=l.indexedDB.open("tensorflowjs",1);U.onupgradeneeded=function(){return kp(U)},U.onsuccess=function(){var G=U.result;if(a==null){var ae=G.transaction(Au,"readonly"),le=ae.objectStore(Au).get(l.modelPath);le.onsuccess=function(){if(le.result==null)return G.close(),S(new Error("Cannot find model with path '"+l.modelPath+"' in IndexedDB."));y(le.result.modelArtifacts)},le.onerror=function(Ye){return G.close(),S(le.error)},ae.oncomplete=function(){return G.close()}}else{var be,Se=Gl(a),Ie=G.transaction(zd,"readwrite"),Me=Ie.objectStore(zd),qe=Me.put({modelPath:l.modelPath,modelArtifactsInfo:Se});qe.onsuccess=function(){var Ye=(be=G.transaction(Au,"readwrite")).objectStore(Au).put({modelPath:l.modelPath,modelArtifacts:a,modelArtifactsInfo:Se});Ye.onsuccess=function(){return y({modelArtifactsInfo:Se})},Ye.onerror=function(Xe){var at=(Me=Ie.objectStore(zd)).delete(l.modelPath);at.onsuccess=function(){return G.close(),S(Ye.error)},at.onerror=function(gt){return G.close(),S(Ye.error)}}},qe.onerror=function(Ye){return G.close(),S(qe.error)},Ie.oncomplete=function(){be==null?G.close():be.oncomplete=function(){return G.close()}}}},U.onerror=function(G){return S(U.error)}})},p.URL_SCHEME="indexeddb://",p}(),vm=function(p){return W().getBool("IS_BROWSER")&&!Array.isArray(p)&&p.startsWith(Wf.URL_SCHEME)?(c=p.slice(Wf.URL_SCHEME.length),new Wf(c)):null;var c};Ja.registerSaveRouter(vm),Ja.registerLoadRouter(vm);var $l=function(){function p(){this.indexedDB=wp()}return p.prototype.listModels=function(){return M(this,void 0,void 0,function(){var c=this;return V(this,function(a){return[2,new Promise(function(l,y){var S=c.indexedDB.open("tensorflowjs",1);S.onupgradeneeded=function(){return kp(S)},S.onsuccess=function(){var U=S.result,G=U.transaction(zd,"readonly"),ae=G.objectStore(zd).getAll();ae.onsuccess=function(){for(var le={},be=0,Se=ae.result;be<Se.length;be++){var Ie=Se[be];le[Ie.modelPath]=Ie.modelArtifactsInfo}l(le)},ae.onerror=function(le){return U.close(),y(ae.error)},G.oncomplete=function(){return U.close()}},S.onerror=function(U){return y(S.error)}})]})})},p.prototype.removeModel=function(c){return M(this,void 0,void 0,function(){var a=this;return V(this,function(l){var y;return c=(y=c).startsWith(Wf.URL_SCHEME)?y.slice(Wf.URL_SCHEME.length):y,[2,new Promise(function(S,U){var G=a.indexedDB.open("tensorflowjs",1);G.onupgradeneeded=function(){return kp(G)},G.onsuccess=function(){var ae,le=G.result,be=le.transaction(zd,"readwrite"),Se=be.objectStore(zd),Ie=Se.get(c);Ie.onsuccess=function(){if(Ie.result==null)return le.close(),U(new Error("Cannot find model with path '"+c+"' in IndexedDB."));var Me=Se.delete(c),qe=function(){var Ye=(ae=le.transaction(Au,"readwrite")).objectStore(Au).delete(c);Ye.onsuccess=function(){return S(Ie.result.modelArtifactsInfo)},Ye.onerror=function(Xe){return U(Ie.error)}};Me.onsuccess=qe,Me.onerror=function(Ye){return qe(),le.close(),U(Ie.error)}},Ie.onerror=function(Me){return le.close(),U(Ie.error)},be.oncomplete=function(){ae==null?le.close():ae.oncomplete=function(){return le.close()}}},G.onerror=function(ae){return U(G.error)}})]})})},p}();if(W().getBool("IS_BROWSER"))try{Uf.registerManager(Wf.URL_SCHEME,new $l)}catch{}var Wu="/",pc="tensorflowjs_models",vu="info",Eh="model_topology",cd="weight_specs",Ch="weight_data",Vu="model_metadata";function Vf(p){return{info:[pc,p,vu].join(Wu),topology:[pc,p,Eh].join(Wu),weightSpecs:[pc,p,cd].join(Wu),weightData:[pc,p,Ch].join(Wu),modelMetadata:[pc,p,Vu].join(Wu)}}function Ah(p){var c=p.split(Wu);if(c.length<3)throw new Error("Invalid key format: "+p);return c.slice(1,c.length-1).join(Wu)}var Wc=function(){function p(c){if(!W().getBool("IS_BROWSER")||typeof window=="undefined"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,c==null||!c)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=c,this.keys=Vf(this.modelPath)}return p.prototype.save=function(c){return M(this,void 0,void 0,function(){var a,l,y;return V(this,function(S){if(c.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");a=JSON.stringify(c.modelTopology),l=JSON.stringify(c.weightSpecs),y=Gl(c);try{return this.LS.setItem(this.keys.info,JSON.stringify(y)),this.LS.setItem(this.keys.topology,a),this.LS.setItem(this.keys.weightSpecs,l),this.LS.setItem(this.keys.weightData,function(U){if(Ld)return I.from(U).toString("base64");for(var G=new Uint8Array(U),ae="",le=0,be=G.length;le<be;le++)ae+=String.fromCharCode(G[le]);return btoa(ae)}(c.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata})),[2,{modelArtifactsInfo:y}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+y.modelTopologyBytes+", weightSpecsBytes="+y.weightSpecsBytes+", weightDataBytes="+y.weightDataBytes+".")}return[2]})})},p.prototype.load=function(){return M(this,void 0,void 0,function(){var c,a,l,y,S,U,G;return V(this,function(ae){if((c=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(c.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(a={},(l=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(a.modelTopology=l,(y=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(a.weightSpecs=y,(S=this.LS.getItem(this.keys.modelMetadata))!=null&&(U=JSON.parse(S),a.format=U.format,a.generatedBy=U.generatedBy,a.convertedBy=U.convertedBy,a.userDefinedMetadata=U.userDefinedMetadata),(G=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return a.weightData=function(le){if(Ld){var be=I.from(le,"base64");return be.buffer.slice(be.byteOffset,be.byteOffset+be.byteLength)}for(var Se=atob(le),Ie=new Uint8Array(Se.length),Me=0;Me<Se.length;++Me)Ie.set([Se.charCodeAt(Me)],Me);return Ie.buffer}(G),[2,a]})})},p.URL_SCHEME="localstorage://",p}(),wv=function(p){return W().getBool("IS_BROWSER")&&!Array.isArray(p)&&p.startsWith(Wc.URL_SCHEME)?(c=p.slice(Wc.URL_SCHEME.length),new Wc(c)):null;var c};Ja.registerSaveRouter(wv),Ja.registerLoadRouter(wv);var Oh=function(){function p(){Ce(W().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),Ce(typeof window=="undefined"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return p.prototype.listModels=function(){return M(this,void 0,void 0,function(){var c,a,l,y,S,U;return V(this,function(G){for(c={},a=pc+Wu,l=Wu+vu,y=0;y<this.LS.length;++y)(S=this.LS.key(y)).startsWith(a)&&S.endsWith(l)&&(U=Ah(S),c[U]=JSON.parse(this.LS.getItem(S)));return[2,c]})})},p.prototype.removeModel=function(c){return M(this,void 0,void 0,function(){var a,l;return V(this,function(y){var S;if(c=(S=c).startsWith(Wc.URL_SCHEME)?S.slice(Wc.URL_SCHEME.length):S,a=Vf(c),this.LS.getItem(a.info)==null)throw new Error("Cannot find model at path '"+c+"'");return l=JSON.parse(this.LS.getItem(a.info)),this.LS.removeItem(a.info),this.LS.removeItem(a.topology),this.LS.removeItem(a.weightSpecs),this.LS.removeItem(a.weightData),[2,l]})})},p}();if(W().getBool("IS_BROWSER"))try{Uf.registerManager(Wc.URL_SCHEME,new Oh)}catch{}var _p="model",Q0=".json",ld=".weights.bin";function ua(p){return new Promise(function(c){return setTimeout(c)}).then(p)}var Qg=function(){function p(c){if(!W().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");c.startsWith(p.URL_SCHEME)&&(c=c.slice(p.URL_SCHEME.length)),c!=null&&c.length!==0||(c=_p),this.modelTopologyFileName=c+Q0,this.weightDataFileName=c+ld}return p.prototype.save=function(c){return M(this,void 0,void 0,function(){var a,l,y,S,U,G;return V(this,function(ae){switch(ae.label){case 0:if(typeof document=="undefined")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(a=window.URL.createObjectURL(new Blob([c.weightData],{type:"application/octet-stream"})),!(c.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return l=[{paths:["./"+this.weightDataFileName],weights:c.weightSpecs}],y={modelTopology:c.modelTopology,format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,weightsManifest:l},S=window.URL.createObjectURL(new Blob([JSON.stringify(y)],{type:"application/json"})),(U=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,U.href=S,[4,ua(function(){return U.dispatchEvent(new MouseEvent("click"))})];case 2:return ae.sent(),c.weightData==null?[3,4]:((G=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,G.href=a,[4,ua(function(){return G.dispatchEvent(new MouseEvent("click"))})]);case 3:ae.sent(),ae.label=4;case 4:return[2,{modelArtifactsInfo:Gl(c)}]}})})},p.URL_SCHEME="downloads://",p}(),Kl=function(){function p(c){if(c==null||c.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+c);this.files=c}return p.prototype.load=function(){return M(this,void 0,void 0,function(){var c,a,l=this;return V(this,function(y){return c=this.files[0],a=this.files.slice(1),[2,new Promise(function(S,U){var G=new FileReader;G.onload=function(ae){var le=JSON.parse(ae.target.result),be=le.modelTopology;if(be!=null){a.length===0&&S({modelTopology:be});var Se=le.weightsManifest;if(Se!=null){var Ie;try{Ie=l.checkManifestAndWeightFiles(Se,a)}catch(Xe){return void U(Xe)}var Me=[],qe=[],Ye=[];Se.forEach(function(Xe){Xe.paths.forEach(function(at){qe.push(at),Ye.push(null)}),Me.push.apply(Me,Xe.weights)}),Se.forEach(function(Xe){Xe.paths.forEach(function(at){var gt=new FileReader;gt.onload=function(bt){var _t=bt.target.result,jt=qe.indexOf(at);Ye[jt]=_t,Ye.indexOf(null)===-1&&S({modelTopology:be,weightSpecs:Me,weightData:ud(Ye),format:le.format,generatedBy:le.generatedBy,convertedBy:le.convertedBy,userDefinedMetadata:le.userDefinedMetadata})},gt.onerror=function(bt){return U("Failed to weights data from file of path '"+at+"'.")},gt.readAsArrayBuffer(Ie[at])})})}else U(new Error("weightManifest field is missing from file "+c.name))}else U(new Error("modelTopology field is missing from file "+c.name))},G.onerror=function(ae){return U("Failed to read model topology and weights manifest JSON from file '"+c.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},G.readAsText(c)})]})})},p.prototype.checkManifestAndWeightFiles=function(c,a){for(var l=[],y=a.map(function(ae){return xf(ae.name)}),S={},U=0,G=c;U<G.length;U++)G[U].paths.forEach(function(ae){var le=xf(ae);if(l.indexOf(le)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+le+"'");if(l.push(le),y.indexOf(le)===-1)throw new Error("Weight file with basename '"+le+"' is not provided.");S[ae]=a[y.indexOf(le)]});if(l.length!==a.length)throw new Error("Mismatch in the number of files in weights manifest ("+l.length+") and the number of weight files provided ("+a.length+").");return S},p}();function Zg(p,c,a,l){(function(S){Ce(S!=null&&Array.isArray(S)&&S.length>0,function(){return"promises must be a none empty array"})})(p),function(S,U){Ce(S>=0&&S<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+S}),Ce(U>=0&&U<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+U}),Ce(U>=S,function(){return"startFraction must be no more than endFraction, but got startFraction "+S+" and endFraction "+U})}(a=a==null?0:a,l=l==null?1:l);var y=0;return Promise.all(p.map(function(S){return S.then(function(U){var G=a+ ++y/p.length*(l-a);return c(G),U}),S}))}function Z0(p,c){return M(this,void 0,void 0,function(){var a,l,y,S,U,G,ae,le,be;return V(this,function(Se){switch(Se.label){case 0:return c==null&&(c={}),a=c.fetchFunc==null?W().platform.fetch:c.fetchFunc,l=p.map(function(Ie){return a(Ie,c.requestInit,{isBinary:!0})}),y=0,S=.5,c.onProgress!=null?[3,2]:[4,Promise.all(l)];case 1:return U=Se.sent(),[3,4];case 2:return[4,Zg(l,c.onProgress,y,S)];case 3:U=Se.sent(),Se.label=4;case 4:return G=U.map(function(Ie){return Ie.arrayBuffer()}),ae=.5,le=1,c.onProgress!=null?[3,6]:[4,Promise.all(G)];case 5:return be=Se.sent(),[3,8];case 6:return[4,Zg(G,c.onProgress,ae,le)];case 7:be=Se.sent(),Se.label=8;case 8:return[2,be]}})})}function ca(p){var c=this;return function(a,l,y){return l===void 0&&(l=""),M(c,void 0,void 0,function(){var S,U,G,ae,le,be,Se,Ie,Me,qe;return V(this,function(Ye){switch(Ye.label){case 0:if(S=a.map(function(){return!1}),U={},G=y!=null?y.map(function(){return!1}):[],ae=[],a.forEach(function(Xe,at){var gt=0;Xe.weights.forEach(function(bt){var _t="quantization"in bt?bt.quantization.dtype:bt.dtype,jt=gu[_t]*Qe(bt.shape),Qt=function(){S[at]=!0,U[at]==null&&(U[at]=[]),U[at].push({manifestEntry:bt,groupOffset:gt,sizeBytes:jt})};y!=null?y.forEach(function(sn,Zt){sn===bt.name&&(Qt(),G[Zt]=!0)}):Qt(),ae.push(bt.name),gt+=jt})}),!G.every(function(Xe){return Xe}))throw le=y.filter(function(Xe,at){return!G[at]}),new Error("Could not find weights in manifest with names: "+le.join(", ")+`. 
Manifest JSON has weights with names: `+ae.join(", ")+".");return be=S.reduce(function(Xe,at,gt){return at&&Xe.push(gt),Xe},[]),Se=[],be.forEach(function(Xe){a[Xe].paths.forEach(function(at){var gt=l+(l.endsWith("/")?"":"/")+at;Se.push(gt)})}),[4,p(Se)];case 1:return Ie=Ye.sent(),Me={},qe=0,be.forEach(function(Xe){for(var at=a[Xe].paths.length,gt=0,bt=0;bt<at;bt++)gt+=Ie[qe+bt].byteLength;for(var _t=new ArrayBuffer(gt),jt=new Uint8Array(_t),Qt=0,sn=0;sn<at;sn++){var Zt=new Uint8Array(Ie[qe+sn]);jt.set(Zt,Qt),Qt+=Zt.byteLength}U[Xe].forEach(function(rn){var Sn=xp(_t.slice(rn.groupOffset,rn.groupOffset+rn.sizeBytes),[rn.manifestEntry]);for(var Bn in Sn)Me[Bn]=Sn[Bn]}),qe+=at}),[2,Me]}})})}}Ja.registerSaveRouter(function(p){return W().getBool("IS_BROWSER")&&!Array.isArray(p)&&p.startsWith(Qg.URL_SCHEME)?function(c){return c===void 0&&(c="model"),new Qg(c)}(p.slice(Qg.URL_SCHEME.length)):null});var kv=function(){function p(c,a){if(this.DEFAULT_METHOD="POST",a==null&&(a={}),this.weightPathPrefix=a.weightPathPrefix,this.onProgress=a.onProgress,a.fetchFunc!=null?(Ce(typeof a.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=a.fetchFunc):this.fetch=W().platform.fetch,Ce(c!=null&&c.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(c)&&Ce(c.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+c.length+")."}),this.path=c,a.requestInit!=null&&a.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=a.requestInit||{}}return p.prototype.save=function(c){return M(this,void 0,void 0,function(){var a,l,y,S;return V(this,function(U){switch(U.label){case 0:if(c.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(a=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,l=[{paths:["./model.weights.bin"],weights:c.weightSpecs}],y={modelTopology:c.modelTopology,format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata,weightsManifest:l},a.body.append("model.json",new Blob([JSON.stringify(y)],{type:"application/json"}),"model.json"),c.weightData!=null&&a.body.append("model.weights.bin",new Blob([c.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,a)];case 1:if((S=U.sent()).ok)return[2,{modelArtifactsInfo:Gl(c),responses:[S]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+S.status+".")}})})},p.prototype.load=function(){return M(this,void 0,void 0,function(){var c,a,l,y,S,U,G,ae,le,be,Se,Ie;return V(this,function(Me){switch(Me.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(c=Me.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+c.status+". Please verify this URL points to the model JSON of the model to load.");Me.label=2;case 2:return Me.trys.push([2,4,,5]),[4,c.json()];case 3:return a=Me.sent(),[3,5];case 4:throw Me.sent(),l="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?l+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":l+=" Please make sure the server is serving valid JSON for this request.",new Error(l);case 5:if(y=a.modelTopology,S=a.weightsManifest,U=a.generatedBy,G=a.convertedBy,ae=a.format,le=a.userDefinedMetadata,y==null&&S==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return S==null?[3,7]:[4,this.loadWeights(S)];case 6:Ie=Me.sent(),be=Ie[0],Se=Ie[1],Me.label=7;case 7:return[2,{modelTopology:y,weightSpecs:be,weightData:Se,userDefinedMetadata:le,generatedBy:U,convertedBy:G,format:ae}]}})})},p.prototype.loadWeights=function(c){return M(this,void 0,void 0,function(){var a,l,y,S,U,G,ae,le,be,Se,Ie;return V(this,function(Me){switch(Me.label){case 0:for(a=Array.isArray(this.path)?this.path[1]:this.path,l=function(qe){var Ye=qe.lastIndexOf("/"),Xe=qe.lastIndexOf("?");return[qe.substring(0,Ye)+"/",Xe>Ye?qe.substring(Xe):""]}(a),y=l[0],S=l[1],U=this.weightPathPrefix||y,G=[],ae=0,le=c;ae<le.length;ae++)be=le[ae],G.push.apply(G,be.weights);return Se=[],c.forEach(function(qe){qe.paths.forEach(function(Ye){Se.push(U+Ye+S)})}),[4,Z0(Se,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return Ie=Me.sent(),[2,[G,ud(Ie)]]}})})},p.URL_SCHEME_REGEX=/^https?:\/\//,p}();function Cl(p){return p.match(kv.URL_SCHEME_REGEX)!=null}var wf=function(p,c){return typeof fetch=="undefined"?null:(Array.isArray(p)?p.every(function(a){return Cl(a)}):Cl(p))?b(p,{onProgress:c}):null};function b(p,c){return new kv(p,c)}Ja.registerSaveRouter(wf),Ja.registerLoadRouter(wf);var h,u=function(){function p(c){this.modelArtifacts=c}return p.prototype.load=function(){return M(this,void 0,void 0,function(){return V(this,function(c){return[2,this.modelArtifacts]})})},p}(),d=function(){function p(c){this.saveHandler=c}return p.prototype.save=function(c){return M(this,void 0,void 0,function(){return V(this,function(a){return[2,this.saveHandler(c)]})})},p}(),x=Object.freeze({browserFiles:function(p){return new Kl(p)},browserHTTPRequest:function(p,c){return b(p,c)},concatenateArrayBuffers:ud,decodeWeights:xp,encodeWeights:function(p,c){return M(this,void 0,void 0,function(){var a,l,y,S,U,G=this;return V(this,function(ae){switch(ae.label){case 0:for(a=[],l=[],y=Array.isArray(p)?p.map(function(le){return le.name}):Object.keys(p),S=function(le){var be=y[le],Se=Array.isArray(p)?p[le].tensor:p[be];if(Se.dtype!=="float32"&&Se.dtype!=="int32"&&Se.dtype!=="bool"&&Se.dtype!=="string")throw new Error("Unsupported dtype in weight '"+be+"': "+Se.dtype);var Ie={name:be,shape:Se.shape,dtype:Se.dtype};if(Se.dtype==="string"){var Me=new Promise(function(qe){return M(G,void 0,void 0,function(){var Ye,Xe,at,gt,bt,_t,jt;return V(this,function(Qt){switch(Qt.label){case 0:return[4,Se.bytes()];case 1:for(Ye=Qt.sent(),Xe=Ye.reduce(function(sn,Zt){return sn+Zt.length},0)+ll*Ye.length,at=new Uint8Array(Xe),gt=0,bt=0;bt<Ye.length;bt++)_t=Ye[bt],jt=new Uint8Array(new Uint32Array([_t.length]).buffer),at.set(jt,gt),gt+=ll,at.set(_t,gt),gt+=_t.length;return qe(at),[2]}})})});l.push(Me)}else l.push(Se.data());c!=null&&(Ie.group=c),a.push(Ie)},U=0;U<y.length;++U)S(U);return[4,Promise.all(l)];case 1:return[2,{data:function(le){if(le===null)throw new Error("Invalid input value: "+JSON.stringify(le));var be=0,Se=[];le.forEach(function(qe){if(be+=qe.byteLength,Se.push(qe.byteLength===qe.buffer.byteLength?qe:new qe.constructor(qe)),!(qe instanceof Float32Array||qe instanceof Int32Array||qe instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+qe.constructor.name)});var Ie=new Uint8Array(be),Me=0;return Se.forEach(function(qe){Ie.set(new Uint8Array(qe.buffer),Me),Me+=qe.byteLength}),Ie.buffer}(ae.sent()),specs:a}]}})})},fromMemory:function(p,c,a,l){return arguments.length===1?p.modelTopology!=null||p.weightSpecs!=null?new u(p):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new u({modelTopology:p})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new u({modelTopology:p,weightSpecs:c,weightData:a,trainingConfig:l}))},getLoadHandlers:function(p,c){return Ja.getLoadHandlers(p,c)},getModelArtifactsInfoForJSON:Gl,getSaveHandlers:function(p){return Ja.getSaveHandlers(p)},http:b,isHTTPScheme:Cl,loadWeights:function(p,c,a,l){return c===void 0&&(c=""),M(this,void 0,void 0,function(){return V(this,function(y){return[2,ca(function(S){return Z0(S,{requestInit:l})})(p,c,a)]})})},registerLoadRouter:function(p){return Ja.registerLoadRouter(p)},registerSaveRouter:function(p){return Ja.registerSaveRouter(p)},weightsLoaderFactory:ca,withSaveHandler:function(p){return new d(p)},copyModel:function(p,c){return M(this,void 0,void 0,function(){return V(this,function(a){return[2,as(p,c,!1)]})})},listModels:function(){return M(this,void 0,void 0,function(){var p,c,a,l,y,S,U;return V(this,function(G){switch(G.label){case 0:p=Uf.getSchemes(),c={},a=0,l=p,G.label=1;case 1:return a<l.length?(y=l[a],[4,Uf.getManager(y).listModels()]):[3,4];case 2:for(U in S=G.sent())c[y+_h+U]=S[U];G.label=3;case 3:return a++,[3,1];case 4:return[2,c]}})})},moveModel:function(p,c){return M(this,void 0,void 0,function(){return V(this,function(a){return[2,as(p,c,!0)]})})},removeModel:function(p){return M(this,void 0,void 0,function(){var c;return V(this,function(a){return c=gs(p),[2,Uf.getManager(c.scheme).removeModel(c.path)]})})}}),T=Tt({confusionMatrix_:function(p,c,a){var l=Ze(p,"labels","confusionMatrix"),y=Ze(c,"predictions","confusionMatrix");Ce(a==null||a>0&&Number.isInteger(a),function(){return"If provided, numClasses must be a positive integer, but got "+a}),Ce(l.rank===1,function(){return"Expected the rank of labels to be 1, but got "+l.rank}),Ce(y.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+y.rank}),Ce(l.shape[0]===y.shape[0],function(){return"Mismatch in the number of examples: "+l.shape[0]+" vs. "+y.shape[0]+". Labels and predictions should have the same number of elements."}),Ce(a>0&&Number.isInteger(a),function(){return"numClasses is required to be a positive integer, but got "+a});var S=mf(l.asType("int32"),a),U=mf(y.asType("int32"),a);return S.transpose().matMul(U).asType("int32")}}),H=Object.freeze({confusionMatrix:T}),Z=Tt({fromPixels_:function(p,c){if(c===void 0&&(c=3),c>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(p==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var a=!1,l=!1,y=!1,S=!1,U=!1;if(p.data instanceof Uint8Array)a=!0;else if(typeof ImageData!="undefined"&&p instanceof ImageData)l=!0;else if(typeof HTMLVideoElement!="undefined"&&p instanceof HTMLVideoElement)y=!0;else if(typeof HTMLImageElement!="undefined"&&p instanceof HTMLImageElement)S=!0;else{if(p.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+p.constructor.name);U=!0}if(y&&y&&p.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(se("FromPixels",He.backendName)!=null)return He.runKernel("FromPixels",{pixels:p},{numChannels:c});var G,ae,le=y?[p.videoWidth,p.videoHeight]:[p.width,p.height],be=le[0],Se=le[1];if(U?G=p.getContext("2d").getImageData(0,0,be,Se).data:l||a?G=p.data:(S||y)&&(h==null&&(h=document.createElement("canvas").getContext("2d")),h.canvas.width=be,h.canvas.height=Se,h.drawImage(p,0,0,be,Se),G=h.getImageData(0,0,be,Se).data),c===4)ae=new Int32Array(G);else{var Ie=be*Se;ae=new Int32Array(Ie*c);for(var Me=0;Me<Ie;Me++)for(var qe=0;qe<c;++qe)ae[Me*c+qe]=G[4*Me+qe]}return nf(ae,[Se,be,c],"int32")}}),ce=Object.freeze({toPixels:function(p,c){return M(this,void 0,void 0,function(){var a,l,y,S,U,G,ae,le,be,Se,Ie,Me,qe,Ye,Xe,at,gt,bt,_t,jt,Qt,sn,Zt;return V(this,function(rn){switch(rn.label){case 0:if(a=Ze(p,"img","toPixels"),p instanceof $t||(a=a.toInt()),a.rank!==2&&a.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+a.rank+".");if(l=a.shape.slice(0,2),y=l[0],S=l[1],(U=a.rank===2?1:a.shape[2])>4||U===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+U);return[4,a.data()];case 1:return G=rn.sent(),ae=a.min(),le=a.max(),[4,Promise.all([ae.data(),le.data()])];case 2:if(be=rn.sent(),Se=be[0],Ie=be[1],Me=Se[0],qe=Ie[0],ae.dispose(),le.dispose(),a.dtype==="float32"){if(Me<0||qe>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+Me+" - "+qe+"].")}else{if(a.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+a.dtype+". Please use float32 or int32 tensors.");if(Me<0||qe>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+Me+" - "+qe+"].")}for(Ye=a.dtype==="float32"?255:1,Xe=new Uint8ClampedArray(S*y*4),at=0;at<y*S;++at)gt=void 0,bt=void 0,_t=void 0,jt=void 0,U===1?(gt=G[at]*Ye,bt=G[at]*Ye,_t=G[at]*Ye,jt=255):U===3?(gt=G[3*at]*Ye,bt=G[3*at+1]*Ye,_t=G[3*at+2]*Ye,jt=255):U===4&&(gt=G[4*at]*Ye,bt=G[4*at+1]*Ye,_t=G[4*at+2]*Ye,jt=G[4*at+3]*Ye),Xe[0+(Qt=4*at)]=Math.round(gt),Xe[Qt+1]=Math.round(bt),Xe[Qt+2]=Math.round(_t),Xe[Qt+3]=Math.round(jt);return c!=null&&(c.width=S,c.height=y,sn=c.getContext("2d"),Zt=new ImageData(Xe,S,y),sn.putImageData(Zt,0,0)),a!==p&&a.dispose(),[2,Xe]}})})},fromPixels:Z}),ye=function(){function p(){}return p.prototype.getClassName=function(){return this.constructor.className},p.fromConfig=function(c,a){return new c(a)},p}(),Ee=function(){function p(){this.classNameMap={}}return p.getMap=function(){return p.instance==null&&(p.instance=new p),p.instance},p.register=function(c){p.getMap().classNameMap[c.className]=[c,c.fromConfig]},p}();function je(p){Ce(p.className!=null,function(){return"Class being registered does not have the static className property defined."}),Ce(typeof p.className=="string",function(){return"className is required to be a string, but got type "+typeof p.className}),Ce(p.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),Ee.register(p)}var Pe=Object.freeze({Serializable:ye,SerializationMap:Ee,registerClass:je}),ze="1.7.4",Ge=Object.freeze({gpgpu_util:zl,webgl_util:xi,forceHalfFloat:function(){W().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:Td,setWebGLContext:Do,GPGPUContext:zm}),rt=function(p){function c(){return p!==null&&p.apply(this,arguments)||this}return K(c,p),c.prototype.minimize=function(a,l,y){l===void 0&&(l=!1);var S=this.computeGradients(a,y),U=S.value,G=S.grads;if(y!=null){var ae=y.map(function(le){return{name:le.name,tensor:G[le.name]}});this.applyGradients(ae)}else this.applyGradients(G);return Oa(G),l?U:(U.dispose(),null)},Object.defineProperty(c.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),c.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},c.prototype.computeGradients=function(a,l){return C(a,l)},c.prototype.dispose=function(){this.iterations_!=null&&Oa(this.iterations_)},c.prototype.saveIterations=function(){return M(this,void 0,void 0,function(){return V(this,function(a){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Mr(this.iterations_,"int32")}]})})},c.prototype.getWeights=function(){return M(this,void 0,void 0,function(){return V(this,function(a){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},c.prototype.setWeights=function(a){return M(this,void 0,void 0,function(){return V(this,function(l){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},c.prototype.extractIterations=function(a){return M(this,void 0,void 0,function(){var l;return V(this,function(y){switch(y.label){case 0:return l=this,[4,a[0].tensor.data()];case 1:return l.iterations_=y.sent()[0],[2,a.slice(1)]}})})},c}(ye);Object.defineProperty(rt,Symbol.hasInstance,{value:function(p){return p.minimize!=null&&p.computeGradients!=null&&p.applyGradients!=null}});var it=function(p){function c(a,l,y){y===void 0&&(y=null);var S=p.call(this)||this;return S.learningRate=a,S.rho=l,S.epsilon=y,S.accumulatedGrads=[],S.accumulatedUpdates=[],y==null&&(S.epsilon=He.backend.epsilon()),S}return K(c,p),c.prototype.applyGradients=function(a){var l=this;(Array.isArray(a)?a.map(function(y){return y.name}):Object.keys(a)).forEach(function(y,S){var U=He.registeredVariables[y];l.accumulatedGrads[S]==null&&(l.accumulatedGrads[S]={originalName:y+"/accum_grad",variable:so(function(){return Ri(U).variable(!1)})}),l.accumulatedUpdates[S]==null&&(l.accumulatedUpdates[S]={originalName:y+"/accum_var",variable:so(function(){return Ri(U).variable(!1)})});var G=Array.isArray(a)?a[S].tensor:a[y];if(G!=null){var ae=l.accumulatedGrads[S].variable,le=l.accumulatedUpdates[S].variable;so(function(){var be=ae.mul(l.rho).add(G.square().mul(1-l.rho)),Se=le.add(l.epsilon).sqrt().div(ae.add(l.epsilon).sqrt()).mul(G),Ie=le.mul(l.rho).add(Se.square().mul(1-l.rho));ae.assign(be),le.assign(Ie);var Me=Se.mul(-l.learningRate).add(U);U.assign(Me)})}}),this.incrementIterations()},c.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Oa(this.accumulatedGrads.map(function(a){return a.variable})),Oa(this.accumulatedUpdates.map(function(a){return a.variable})))},c.prototype.getWeights=function(){return M(this,void 0,void 0,function(){var a;return V(this,function(l){switch(l.label){case 0:return a=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[l.sent()].concat(a.map(function(y){return{name:y.originalName,tensor:y.variable}}))]}})})},c.prototype.setWeights=function(a){return M(this,void 0,void 0,function(){var l;return V(this,function(y){switch(y.label){case 0:return[4,this.extractIterations(a)];case 1:return a=y.sent(),l=a.length/2,this.accumulatedGrads=a.slice(0,l).map(function(S){return{originalName:S.name,variable:S.tensor.variable(!1)}}),this.accumulatedUpdates=a.slice(l,2*l).map(function(S){return{originalName:S.name,variable:S.tensor.variable(!1)}}),[2]}})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},c.fromConfig=function(a,l){return new a(l.learningRate,l.rho,l.epsilon)},c.className="Adadelta",c}(rt);je(it);var ht=function(p){function c(a,l){l===void 0&&(l=.1);var y=p.call(this)||this;return y.learningRate=a,y.initialAccumulatorValue=l,y.accumulatedGrads=[],y}return K(c,p),c.prototype.applyGradients=function(a){var l=this;(Array.isArray(a)?a.map(function(y){return y.name}):Object.keys(a)).forEach(function(y,S){var U=He.registeredVariables[y];l.accumulatedGrads[S]==null&&(l.accumulatedGrads[S]={originalName:y+"/accumulator",variable:so(function(){return Nu(U.shape,l.initialAccumulatorValue).variable(!1)})});var G=Array.isArray(a)?a[S].tensor:a[y];if(G!=null){var ae=l.accumulatedGrads[S].variable;so(function(){var le=ae.add(G.square());ae.assign(le);var be=G.div(le.add(He.backend.epsilon()).sqrt()).mul(-l.learningRate).add(U);U.assign(be)})}}),this.incrementIterations()},c.prototype.dispose=function(){this.accumulatedGrads!=null&&Oa(this.accumulatedGrads.map(function(a){return a.variable}))},c.prototype.getWeights=function(){return M(this,void 0,void 0,function(){return V(this,function(a){switch(a.label){case 0:return[4,this.saveIterations()];case 1:return[2,[a.sent()].concat(this.accumulatedGrads.map(function(l){return{name:l.originalName,tensor:l.variable}}))]}})})},c.prototype.setWeights=function(a){return M(this,void 0,void 0,function(){return V(this,function(l){switch(l.label){case 0:return[4,this.extractIterations(a)];case 1:return a=l.sent(),this.accumulatedGrads=a.map(function(y){return{originalName:y.name,variable:y.tensor.variable(!1)}}),[2]}})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},c.fromConfig=function(a,l){return new a(l.learningRate,l.initialAccumulatorValue)},c.className="Adagrad",c}(rt);je(ht);var Et=function(p){function c(a,l,y,S){S===void 0&&(S=null);var U=p.call(this)||this;return U.learningRate=a,U.beta1=l,U.beta2=y,U.epsilon=S,U.accumulatedFirstMoment=[],U.accumulatedSecondMoment=[],so(function(){U.accBeta1=Mr(l).variable(),U.accBeta2=Mr(y).variable()}),S==null&&(U.epsilon=He.backend.epsilon()),U}return K(c,p),c.prototype.applyGradients=function(a){var l=this,y=Array.isArray(a)?a.map(function(S){return S.name}):Object.keys(a);so(function(){var S=js(1,l.accBeta1),U=js(1,l.accBeta2);y.forEach(function(G,ae){var le=He.registeredVariables[G];l.accumulatedFirstMoment[ae]==null&&(l.accumulatedFirstMoment[ae]={originalName:G+"/m",variable:so(function(){return Ri(le).variable(!1)})}),l.accumulatedSecondMoment[ae]==null&&(l.accumulatedSecondMoment[ae]={originalName:G+"/v",variable:so(function(){return Ri(le).variable(!1)})});var be=Array.isArray(a)?a[ae].tensor:a[G];if(be!=null){var Se=l.accumulatedFirstMoment[ae].variable,Ie=l.accumulatedSecondMoment[ae].variable,Me=Se.mul(l.beta1).add(be.mul(1-l.beta1)),qe=Ie.mul(l.beta2).add(be.square().mul(1-l.beta2)),Ye=Me.div(S),Xe=qe.div(U);Se.assign(Me),Ie.assign(qe);var at=Ye.div(Xe.sqrt().add(l.epsilon)).mul(-l.learningRate).add(le);le.assign(at)}}),l.accBeta1.assign(l.accBeta1.mul(l.beta1)),l.accBeta2.assign(l.accBeta2.mul(l.beta2))}),this.incrementIterations()},c.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Oa(this.accumulatedFirstMoment.map(function(a){return a.variable})),this.accumulatedSecondMoment!=null&&Oa(this.accumulatedSecondMoment.map(function(a){return a.variable}))},c.prototype.getWeights=function(){return M(this,void 0,void 0,function(){var a;return V(this,function(l){switch(l.label){case 0:return a=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[l.sent()].concat(a.map(function(y){return{name:y.originalName,tensor:y.variable}}))]}})})},c.prototype.setWeights=function(a){return M(this,void 0,void 0,function(){var l,y=this;return V(this,function(S){switch(S.label){case 0:return[4,this.extractIterations(a)];case 1:return a=S.sent(),so(function(){y.accBeta1.assign(Mu(y.beta1,y.iterations_+1)),y.accBeta2.assign(Mu(y.beta2,y.iterations_+1))}),l=a.length/2,this.accumulatedFirstMoment=a.slice(0,l).map(function(U){return{originalName:U.name,variable:U.tensor.variable(!1)}}),this.accumulatedSecondMoment=a.slice(l,2*l).map(function(U){return{originalName:U.name,variable:U.tensor.variable(!1)}}),[2]}})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},c.fromConfig=function(a,l){return new a(l.learningRate,l.beta1,l.beta2,l.epsilon)},c.className="Adam",c}(rt);je(Et);var At=function(p){function c(a,l,y,S,U){S===void 0&&(S=null),U===void 0&&(U=0);var G=p.call(this)||this;return G.learningRate=a,G.beta1=l,G.beta2=y,G.epsilon=S,G.decay=U,G.accumulatedFirstMoment=[],G.accumulatedWeightedInfNorm=[],so(function(){G.iteration=Mr(0).variable(),G.accBeta1=Mr(l).variable()}),S==null&&(G.epsilon=He.backend.epsilon()),G}return K(c,p),c.prototype.applyGradients=function(a){var l=this,y=Array.isArray(a)?a.map(function(S){return S.name}):Object.keys(a);so(function(){var S=js(1,l.accBeta1),U=ts(-l.learningRate,l.iteration.mul(l.decay).add(1));y.forEach(function(G,ae){var le=He.registeredVariables[G];l.accumulatedFirstMoment[ae]==null&&(l.accumulatedFirstMoment[ae]={originalName:G+"/m",variable:Ri(le).variable(!1)}),l.accumulatedWeightedInfNorm[ae]==null&&(l.accumulatedWeightedInfNorm[ae]={originalName:G+"/v",variable:Ri(le).variable(!1)});var be=Array.isArray(a)?a[ae].tensor:a[G];if(be!=null){var Se=l.accumulatedFirstMoment[ae].variable,Ie=l.accumulatedWeightedInfNorm[ae].variable,Me=Se.mul(l.beta1).add(be.mul(1-l.beta1)),qe=Ie.mul(l.beta2),Ye=be.abs(),Xe=qe.maximum(Ye);Se.assign(Me),Ie.assign(Xe);var at=U.div(S).mul(Me.div(Xe.add(l.epsilon))).add(le);le.assign(at)}}),l.iteration.assign(l.iteration.add(1)),l.accBeta1.assign(l.accBeta1.mul(l.beta1))}),this.incrementIterations()},c.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Oa(this.accumulatedFirstMoment.map(function(a){return a.variable})),this.accumulatedWeightedInfNorm!=null&&Oa(this.accumulatedWeightedInfNorm.map(function(a){return a.variable}))},c.prototype.getWeights=function(){return M(this,void 0,void 0,function(){return V(this,function(a){throw new Error("getWeights() is not implemented for Adamax yet.")})})},c.prototype.setWeights=function(a){return M(this,void 0,void 0,function(){return V(this,function(l){throw new Error("setWeights() is not implemented for Adamax yet.")})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},c.fromConfig=function(a,l){return new a(l.learningRate,l.beta1,l.beta2,l.epsilon,l.decay)},c.className="Adamax",c}(rt);je(At);var St=function(p){function c(a){var l=p.call(this)||this;return l.learningRate=a,l.setLearningRate(a),l}return K(c,p),c.prototype.applyGradients=function(a){var l=this;(Array.isArray(a)?a.map(function(y){return y.name}):Object.keys(a)).forEach(function(y,S){var U=Array.isArray(a)?a[S].tensor:a[y];if(U!=null){var G=He.registeredVariables[y];so(function(){var ae=l.c.mul(U).add(G);G.assign(ae)})}}),this.incrementIterations()},c.prototype.setLearningRate=function(a){this.learningRate=a,this.c!=null&&this.c.dispose(),this.c=Fh(Mr(-a))},c.prototype.dispose=function(){this.c.dispose()},c.prototype.getWeights=function(){return M(this,void 0,void 0,function(){return V(this,function(a){switch(a.label){case 0:return[4,this.saveIterations()];case 1:return[2,[a.sent()]]}})})},c.prototype.setWeights=function(a){return M(this,void 0,void 0,function(){return V(this,function(l){switch(l.label){case 0:return[4,this.extractIterations(a)];case 1:if((a=l.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate}},c.fromConfig=function(a,l){return new a(l.learningRate)},c.className="SGD",c}(rt);je(St);var Gt=function(p){function c(a,l,y){y===void 0&&(y=!1);var S=p.call(this,a)||this;return S.learningRate=a,S.momentum=l,S.useNesterov=y,S.accumulations=[],S.m=Mr(S.momentum),S}return K(c,p),c.prototype.applyGradients=function(a){var l=this;(Array.isArray(a)?a.map(function(y){return y.name}):Object.keys(a)).forEach(function(y,S){var U=He.registeredVariables[y];l.accumulations[S]==null&&(l.accumulations[S]={originalName:y+"/momentum",variable:so(function(){return Ri(U).variable(!1)})});var G=l.accumulations[S].variable,ae=Array.isArray(a)?a[S].tensor:a[y];ae!=null&&so(function(){var le,be=l.m.mul(G).add(ae);le=l.useNesterov?l.c.mul(ae.add(be.mul(l.m))).add(U):l.c.mul(be).add(U),G.assign(be),U.assign(le)})}),this.incrementIterations()},c.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Oa(this.accumulations.map(function(a){return a.variable}))},c.prototype.setMomentum=function(a){this.momentum=a},c.prototype.getWeights=function(){return M(this,void 0,void 0,function(){return V(this,function(a){switch(a.label){case 0:return[4,this.saveIterations()];case 1:return[2,[a.sent()].concat(this.accumulations.map(function(l){return{name:l.originalName,tensor:l.variable}}))]}})})},c.prototype.setWeights=function(a){return M(this,void 0,void 0,function(){return V(this,function(l){switch(l.label){case 0:return[4,this.extractIterations(a)];case 1:return a=l.sent(),this.accumulations=a.map(function(y){return{originalName:y.name,variable:y.tensor.variable(!1)}}),[2]}})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},c.fromConfig=function(a,l){return new a(l.learningRate,l.momentum,l.useNesterov)},c.className="Momentum",c}(St);je(Gt);var un=function(p){function c(a,l,y,S,U){l===void 0&&(l=.9),y===void 0&&(y=0),S===void 0&&(S=null),U===void 0&&(U=!1);var G=p.call(this)||this;if(G.learningRate=a,G.decay=l,G.momentum=y,G.epsilon=S,G.accumulatedMeanSquares=[],G.accumulatedMoments=[],G.accumulatedMeanGrads=[],G.centered=U,S==null&&(G.epsilon=He.backend.epsilon()),a==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return G}return K(c,p),c.prototype.applyGradients=function(a){var l=this;(Array.isArray(a)?a.map(function(y){return y.name}):Object.keys(a)).forEach(function(y,S){var U=He.registeredVariables[y];l.accumulatedMeanSquares[S]==null&&(l.accumulatedMeanSquares[S]={originalName:y+"/rms",variable:so(function(){return Ri(U).variable(!1)})}),l.accumulatedMoments[S]==null&&(l.accumulatedMoments[S]={originalName:y+"/momentum",variable:so(function(){return Ri(U).variable(!1)})}),l.accumulatedMeanGrads[S]==null&&l.centered&&(l.accumulatedMeanGrads[S]={originalName:y+"/mg",variable:so(function(){return Ri(U).variable(!1)})});var G=Array.isArray(a)?a[S].tensor:a[y];if(G!=null){var ae=l.accumulatedMeanSquares[S].variable,le=l.accumulatedMoments[S].variable;so(function(){var be=ae.mul(l.decay).add(G.square().mul(1-l.decay));if(l.centered){var Se=l.accumulatedMeanGrads[S].variable,Ie=Se.mul(l.decay).add(G.mul(1-l.decay)),Me=le.mul(l.momentum).add(G.mul(l.learningRate).div(be.sub(Ie.square().add(l.epsilon)).sqrt()));ae.assign(be),Se.assign(Ie),le.assign(Me);var qe=U.sub(Me);U.assign(qe)}else{var Ye=ae.mul(l.decay).add(G.square().mul(1-l.decay));Me=le.mul(l.momentum).add(G.mul(l.learningRate).div(Ye.add(l.epsilon).sqrt())),ae.assign(Ye),le.assign(Me),qe=U.sub(Me),U.assign(qe)}})}}),this.incrementIterations()},c.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Oa(this.accumulatedMeanSquares.map(function(a){return a.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Oa(this.accumulatedMeanGrads.map(function(a){return a.variable})),this.accumulatedMoments!=null&&Oa(this.accumulatedMoments.map(function(a){return a.variable}))},c.prototype.getWeights=function(){return M(this,void 0,void 0,function(){var a;return V(this,function(l){switch(l.label){case 0:return a=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&a.push.apply(a,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[l.sent()].concat(a.map(function(y){return{name:y.originalName,tensor:y.variable}}))]}})})},c.prototype.setWeights=function(a){return M(this,void 0,void 0,function(){var l;return V(this,function(y){switch(y.label){case 0:return[4,this.extractIterations(a)];case 1:return a=y.sent(),l=this.centered?a.length/3:a.length/2,this.accumulatedMeanSquares=a.slice(0,l).map(function(S){return{originalName:S.name,variable:S.tensor.variable(!1)}}),this.accumulatedMoments=a.slice(l,2*l).map(function(S){return{originalName:S.name,variable:S.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=a.slice(2*l,3*l).map(function(S){return{originalName:S.name,variable:S.tensor.variable(!1)}})),[2]}})})},c.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},c.fromConfig=function(a,l){return new a(l.learningRate,l.decay,l.momentum,l.epsilon,l.centered)},c.className="RMSProp",c}(rt);je(un);var vn=function(){function p(){}return p.sgd=function(c){return new St(c)},p.momentum=function(c,a,l){return l===void 0&&(l=!1),new Gt(c,a,l)},p.rmsprop=function(c,a,l,y,S){return a===void 0&&(a=.9),l===void 0&&(l=0),y===void 0&&(y=null),S===void 0&&(S=!1),new un(c,a,l,y,S)},p.adam=function(c,a,l,y){return c===void 0&&(c=.001),a===void 0&&(a=.9),l===void 0&&(l=.999),y===void 0&&(y=null),new Et(c,a,l,y)},p.adadelta=function(c,a,l){return c===void 0&&(c=.001),a===void 0&&(a=.95),l===void 0&&(l=null),new it(c,a,l)},p.adamax=function(c,a,l,y,S){return c===void 0&&(c=.002),a===void 0&&(a=.9),l===void 0&&(l=.999),y===void 0&&(y=null),S===void 0&&(S=0),new At(c,a,l,y,S)},p.adagrad=function(c,a){return a===void 0&&(a=.1),new ht(c,a)},p}(),cn={sgd:vn.sgd,momentum:vn.momentum,adadelta:vn.adadelta,adagrad:vn.adagrad,rmsprop:vn.rmsprop,adamax:vn.adamax,adam:vn.adam},kn=typeof requestAnimationFrame!="undefined"?requestAnimationFrame:A!==void 0?A:function(p){return p()};function On(){return new Promise(function(p){return kn(function(){return p()})})}$t.prototype.add=function(p){return Ua(this,p)},$t.prototype.broadcastTo=function(p){return pf(this,p)},$t.prototype.div=function(p){return ts(this,p)},$t.prototype.divNoNan=function(p){return Gm(this,p)},$t.prototype.squaredDifference=function(p){return fp(this,p)},$t.prototype.tile=function(p){return Jh(this,p)},$t.prototype.oneHot=function(p,c,a){return c===void 0&&(c=1),a===void 0&&(a=0),mf(this,p,c,a)},$t.prototype.transpose=function(p){return vt(this,p)},$t.prototype.pad=function(p,c){return El(this,p,c)},$t.prototype.batchNorm=function(p,c,a,l,y){return hh(this,p,c,a,l,y)},Ot=Zn}.call(this,o(59),o(75),o(92).Buffer,o(207).setImmediate)},function(j,m,o){function g(Nt,Ft,bn){return Nt.fields=Ft||[],Nt.fname=bn,Nt}function z(Nt){return Nt==null?null:Nt.fname}function I(Nt){return Nt==null?null:Nt.fields}function A(Nt){return Nt.length===1?X(Nt[0]):K(Nt)}o.d(m,"a",function(){return Ae}),o.d(m,"b",function(){return Oe}),o.d(m,"c",function(){return Le}),o.d(m,"d",function(){return pe}),o.d(m,"e",function(){return Fe}),o.d(m,"f",function(){return g}),o.d(m,"g",function(){return I}),o.d(m,"h",function(){return z}),o.d(m,"i",function(){return zn}),o.d(m,"j",function(){return Rr}),o.d(m,"k",function(){return Cn}),o.d(m,"l",function(){return lr}),o.d(m,"m",function(){return hn}),o.d(m,"n",function(){return nn}),o.d(m,"o",function(){return M}),o.d(m,"p",function(){return an}),o.d(m,"q",function(){return or}),o.d(m,"r",function(){return jn}),o.d(m,"s",function(){return J}),o.d(m,"t",function(){return wi}),o.d(m,"u",function(){return $}),o.d(m,"v",function(){return Ai}),o.d(m,"w",function(){return Pr}),o.d(m,"x",function(){return W}),o.d(m,"y",function(){return te}),o.d(m,"z",function(){return Jn}),o.d(m,"A",function(){return di}),o.d(m,"B",function(){return Mt}),o.d(m,"C",function(){return ri}),o.d(m,"D",function(){return Dr}),o.d(m,"E",function(){return ar}),o.d(m,"F",function(){return ki}),o.d(m,"G",function(){return Ei}),o.d(m,"H",function(){return Xt}),o.d(m,"I",function(){return mo}),o.d(m,"J",function(){return Gi}),o.d(m,"K",function(){return Ui}),o.d(m,"L",function(){return Ot}),o.d(m,"M",function(){return ft}),o.d(m,"N",function(){return $t}),o.d(m,"O",function(){return xe}),o.d(m,"P",function(){return Ce}),o.d(m,"Q",function(){return ue}),o.d(m,"R",function(){return ke}),o.d(m,"S",function(){return Rt}),o.d(m,"T",function(){return Tn}),o.d(m,"U",function(){return Hn}),o.d(m,"V",function(){return tr}),o.d(m,"W",function(){return Ut}),o.d(m,"X",function(){return Dt}),o.d(m,"Y",function(){return ge}),o.d(m,"Z",function(){return Ne}),o.d(m,"Aa",function(){return V}),o.d(m,"Ba",function(){return ot}),o.d(m,"Ca",function(){return xt}),o.d(m,"Da",function(){return yn}),o.d(m,"Ea",function(){return Qe}),o.d(m,"Fa",function(){return _n}),o.d(m,"Ga",function(){return dr}),o.d(m,"Ha",function(){return In}),o.d(m,"Ia",function(){return se}),o.d(m,"Ja",function(){return Lt}),o.d(m,"Ka",function(){return Gn}),o.d(m,"La",function(){return Wt}),o.d(m,"Ma",function(){return F}),o.d(m,"Na",function(){return $e}),o.d(m,"Oa",function(){return et}),o.d(m,"Pa",function(){return Ke}),o.d(m,"Qa",function(){return yt});const X=Nt=>function(Ft){return Ft[Nt]},K=Nt=>{const Ft=Nt.length;return function(bn){for(let Yt=0;Yt<Ft;++Yt)bn=bn[Nt[Yt]];return bn}};function M(Nt){throw Error(Nt)}function V(Nt){const Ft=[],bn=Nt.length;let Yt,He,$n,ur=null,pr=0,kr="";function ui(){Ft.push(kr+Nt.substring(Yt,He)),kr="",Yt=He+1}for(Nt+="",Yt=He=0;He<bn;++He)if(($n=Nt[He])==="\\")kr+=Nt.substring(Yt,He),kr+=Nt.substring(++He,++He),Yt=He;else if($n===ur)ui(),ur=null,pr=-1;else{if(ur)continue;Yt===pr&&$n==='"'||Yt===pr&&$n==="'"?(Yt=He+1,ur=$n):$n!=="."||pr?$n==="["?(He>Yt&&ui(),pr=Yt=He+1):$n==="]"&&(pr||M("Access path missing open bracket: "+Nt),pr>0&&ui(),pr=0,Yt=He+1):He>Yt?ui():Yt=He+1}return pr&&M("Access path missing closing bracket: "+Nt),ur&&M("Access path missing closing quote: "+Nt),He>Yt&&(He++,ui()),Ft}function $(Nt,Ft,bn){const Yt=V(Nt);return Nt=Yt.length===1?Yt[0]:Nt,g((bn&&bn.get||A)(Yt),[Nt],Ft||Nt)}const W=$("id"),te=g(Nt=>Nt,[],"identity"),F=g(()=>0,[],"zero"),ue=g(()=>1,[],"one"),se=g(()=>!0,[],"true"),J=g(()=>!1,[],"false");function me(Nt,Ft,bn){const Yt=[Ft].concat([].slice.call(bn));console[Nt].apply(console,Yt)}const pe=0,Oe=1,Fe=2,Le=3,Ae=4;function ft(Nt,Ft){let bn=Nt||pe;return{level(Yt){return arguments.length?(bn=+Yt,this):bn},error(){return bn>=Oe&&me(Ft||"error","ERROR",arguments),this},warn(){return bn>=Fe&&me(Ft||"warn","WARN",arguments),this},info(){return bn>=Le&&me(Ft||"log","INFO",arguments),this},debug(){return bn>=Ae&&me(Ft||"log","DEBUG",arguments),this}}}var Mt=Array.isArray;function Xt(Nt){return Nt===Object(Nt)}const tn=Nt=>Nt!=="__proto__";function Ce(...Nt){return Nt.reduce((Ft,bn)=>{for(const Yt in bn)if(Yt==="signals")Ft.signals=en(Ft.signals,bn.signals);else{const He=Yt==="legend"?{layout:1}:Yt==="style"||null;Wt(Ft,Yt,bn[Yt],He)}return Ft},{})}function Wt(Nt,Ft,bn,Yt){if(!tn(Ft))return;let He,$n;if(Xt(bn)&&!Mt(bn))for(He in $n=Xt(Nt[Ft])?Nt[Ft]:Nt[Ft]={},bn)Yt&&(Yt===!0||Yt[He])?Wt($n,He,bn[He]):tn(He)&&($n[He]=bn[He]);else Nt[Ft]=bn}function en(Nt,Ft){if(Nt==null)return Ft;const bn={},Yt=[];function He($n){bn[$n.name]||(bn[$n.name]=1,Yt.push($n))}return Ft.forEach(He),Nt.forEach(He),Yt}function Ut(Nt){return Nt[Nt.length-1]}function Qe(Nt){return Nt==null||Nt===""?null:+Nt}const fn=Nt=>Ft=>Nt*Math.exp(Ft),on=Nt=>Ft=>Math.log(Nt*Ft),Ct=Nt=>Ft=>Math.sign(Ft)*Math.log1p(Math.abs(Ft/Nt)),Vt=Nt=>Ft=>Math.sign(Ft)*Math.expm1(Math.abs(Ft))*Nt,En=Nt=>Ft=>Ft<0?-Math.pow(-Ft,Nt):Math.pow(Ft,Nt);function Pt(Nt,Ft,bn,Yt){const He=bn(Nt[0]),$n=bn(Ut(Nt)),ur=($n-He)*Ft;return[Yt(He-ur),Yt($n-ur)]}function Rt(Nt,Ft){return Pt(Nt,Ft,Qe,te)}function Tn(Nt,Ft){var bn=Math.sign(Nt[0]);return Pt(Nt,Ft,on(bn),fn(bn))}function Hn(Nt,Ft,bn){return Pt(Nt,Ft,En(bn),En(1/bn))}function tr(Nt,Ft,bn){return Pt(Nt,Ft,Ct(bn),Vt(bn))}function pn(Nt,Ft,bn,Yt,He){const $n=Yt(Nt[0]),ur=Yt(Ut(Nt)),pr=Ft!=null?Yt(Ft):($n+ur)/2;return[He(pr+($n-pr)*bn),He(pr+(ur-pr)*bn)]}function $e(Nt,Ft,bn){return pn(Nt,Ft,bn,Qe,te)}function et(Nt,Ft,bn){const Yt=Math.sign(Nt[0]);return pn(Nt,Ft,bn,on(Yt),fn(Yt))}function Ke(Nt,Ft,bn,Yt){return pn(Nt,Ft,bn,En(Yt),En(1/Yt))}function yt(Nt,Ft,bn,Yt){return pn(Nt,Ft,bn,Ct(Yt),Vt(Yt))}function Dt(Nt){return 1+~~(new Date(Nt).getMonth()/3)}function Lt(Nt){return 1+~~(new Date(Nt).getUTCMonth()/3)}function zn(Nt){return Nt!=null?Mt(Nt)?Nt:[Nt]:[]}function Cn(Nt,Ft,bn){let Yt,He=Nt[0],$n=Nt[1];return $n<He&&(Yt=$n,$n=He,He=Yt),(Yt=$n-He)>=bn-Ft?[Ft,bn]:[He=Math.min(Math.max(He,Ft),bn-Yt),He+Yt]}function ar(Nt){return typeof Nt=="function"}const we="descending";function lr(Nt,Ft,bn){bn=bn||{},Ft=zn(Ft)||[];const Yt=[],He=[],$n={},ur=bn.comparator||Tr;return zn(Nt).forEach((pr,kr)=>{pr!=null&&(Yt.push(Ft[kr]===we?-1:1),He.push(pr=ar(pr)?pr:$(pr,null,bn)),(I(pr)||[]).forEach(ui=>$n[ui]=1))}),He.length===0?null:g(ur(He,Yt),Object.keys($n))}const Rr=(Nt,Ft)=>(Nt<Ft||Nt==null)&&Ft!=null?-1:(Nt>Ft||Ft==null)&&Nt!=null?1:(Ft=Ft instanceof Date?+Ft:Ft,(Nt=Nt instanceof Date?+Nt:Nt)!==Nt&&Ft==Ft?-1:Ft!=Ft&&Nt==Nt?1:0),Tr=(Nt,Ft)=>Nt.length===1?qr(Nt[0],Ft[0]):Gr(Nt,Ft,Nt.length),qr=(Nt,Ft)=>function(bn,Yt){return Rr(Nt(bn),Nt(Yt))*Ft},Gr=(Nt,Ft,bn)=>(Ft.push(0),function(Yt,He){let $n,ur=0,pr=-1;for(;ur===0&&++pr<bn;)$n=Nt[pr],ur=Rr($n(Yt),$n(He));return ur*Ft[pr]});function hn(Nt){return ar(Nt)?Nt:()=>Nt}function nn(Nt,Ft){let bn;return Yt=>{bn&&clearTimeout(bn),bn=setTimeout(()=>(Ft(Yt),bn=null),Nt)}}function an(Nt){for(let Ft,bn,Yt=1,He=arguments.length;Yt<He;++Yt)for(bn in Ft=arguments[Yt])Nt[bn]=Ft[bn];return Nt}function or(Nt,Ft){let bn,Yt,He,$n,ur=0;if(Nt&&(bn=Nt.length))if(Ft==null){for(Yt=Nt[ur];ur<bn&&(Yt==null||Yt!=Yt);Yt=Nt[++ur]);for(He=$n=Yt;ur<bn;++ur)(Yt=Nt[ur])!=null&&(Yt<He&&(He=Yt),Yt>$n&&($n=Yt))}else{for(Yt=Ft(Nt[ur]);ur<bn&&(Yt==null||Yt!=Yt);Yt=Ft(Nt[++ur]));for(He=$n=Yt;ur<bn;++ur)(Yt=Ft(Nt[ur]))!=null&&(Yt<He&&(He=Yt),Yt>$n&&($n=Yt))}return[He,$n]}function jn(Nt,Ft){const bn=Nt.length;let Yt,He,$n,ur,pr,kr=-1;if(Ft==null){for(;++kr<bn;)if((He=Nt[kr])!=null&&He>=He){Yt=$n=He;break}if(kr===bn)return[-1,-1];for(ur=pr=kr;++kr<bn;)(He=Nt[kr])!=null&&(Yt>He&&(Yt=He,ur=kr),$n<He&&($n=He,pr=kr))}else{for(;++kr<bn;)if((He=Ft(Nt[kr],kr,Nt))!=null&&He>=He){Yt=$n=He;break}if(kr===bn)return[-1,-1];for(ur=pr=kr;++kr<bn;)(He=Ft(Nt[kr],kr,Nt))!=null&&(Yt>He&&(Yt=He,ur=kr),$n<He&&($n=He,pr=kr))}return[ur,pr]}const Fr=Object.prototype.hasOwnProperty;function Pr(Nt,Ft){return Fr.call(Nt,Ft)}const Br={};function wi(Nt){let Ft,bn={};function Yt($n){return Pr(bn,$n)&&bn[$n]!==Br}const He={size:0,empty:0,object:bn,has:Yt,get:$n=>Yt($n)?bn[$n]:void 0,set($n,ur){return Yt($n)||(++He.size,bn[$n]===Br&&--He.empty),bn[$n]=ur,this},delete($n){return Yt($n)&&(--He.size,++He.empty,bn[$n]=Br),this},clear(){He.size=He.empty=0,He.object=bn={}},test($n){return arguments.length?(Ft=$n,He):Ft},clean(){const $n={};let ur=0;for(const pr in bn){const kr=bn[pr];kr===Br||Ft&&Ft(kr)||($n[pr]=kr,++ur)}He.size=ur,He.empty=0,He.object=bn=$n}};return Nt&&Object.keys(Nt).forEach($n=>{He.set($n,Nt[$n])}),He}function Ai(Nt,Ft,bn,Yt,He,$n){if(!bn&&bn!==0)return $n;const ur=+bn;let pr,kr=Nt[0],ui=Ut(Nt);ui<kr&&(pr=kr,kr=ui,ui=pr),pr=Math.abs(Ft-kr);const Ir=Math.abs(ui-Ft);return pr<Ir&&pr<=ur?Yt:Ir<=ur?He:$n}function Jn(Nt,Ft,bn){const Yt=Nt.prototype=Object.create(Ft.prototype);return Object.defineProperty(Yt,"constructor",{value:Nt,writable:!0,enumerable:!0,configurable:!0}),an(Yt,bn)}function di(Nt,Ft,bn,Yt){let He,$n=Ft[0],ur=Ft[Ft.length-1];return $n>ur&&(He=$n,$n=ur,ur=He),bn=bn===void 0||bn,Yt=Yt===void 0||Yt,(bn?$n<=Nt:$n<Nt)&&(Yt?Nt<=ur:Nt<ur)}function ri(Nt){return typeof Nt=="boolean"}function Dr(Nt){return Object.prototype.toString.call(Nt)==="[object Date]"}function ki(Nt){return Nt&&ar(Nt[Symbol.iterator])}function Ei(Nt){return typeof Nt=="number"}function mo(Nt){return Object.prototype.toString.call(Nt)==="[object RegExp]"}function Gi(Nt){return typeof Nt=="string"}function Ui(Nt,Ft,bn){Nt&&(Nt=Ft?zn(Nt).map(pr=>pr.replace(/\\(.)/g,"$1")):zn(Nt));const Yt=Nt&&Nt.length,He=bn&&bn.get||A,$n=pr=>He(Ft?[pr]:V(pr));let ur;if(Yt)if(Yt===1){const pr=$n(Nt[0]);ur=function(kr){return""+pr(kr)}}else{const pr=Nt.map($n);ur=function(kr){let ui=""+pr[0](kr),Ir=0;for(;++Ir<Yt;)ui+="|"+pr[Ir](kr);return ui}}else ur=function(){return""};return g(ur,Nt,"key")}function Ot(Nt,Ft){const bn=Nt[0],Yt=Ut(Nt),He=+Ft;return He?He===1?Yt:bn+He*(Yt-bn):bn}const $r=1e4;function $t(Nt){let Ft,bn,Yt;Nt=+Nt||$r;const He=()=>{Ft={},bn={},Yt=0},$n=(ur,pr)=>(++Yt>Nt&&(bn=Ft,Ft={},Yt=1),Ft[ur]=pr);return He(),{clear:He,has:ur=>Pr(Ft,ur)||Pr(bn,ur),get:ur=>Pr(Ft,ur)?Ft[ur]:Pr(bn,ur)?$n(ur,bn[ur]):void 0,set:(ur,pr)=>Pr(Ft,ur)?Ft[ur]=pr:$n(ur,pr)}}function xe(Nt,Ft,bn,Yt){const He=Ft.length,$n=bn.length;if(!$n)return Ft;if(!He)return bn;const ur=Yt||new Ft.constructor(He+$n);let pr=0,kr=0,ui=0;for(;pr<He&&kr<$n;++ui)ur[ui]=Nt(Ft[pr],bn[kr])>0?bn[kr++]:Ft[pr++];for(;pr<He;++pr,++ui)ur[ui]=Ft[pr];for(;kr<$n;++kr,++ui)ur[ui]=bn[kr];return ur}function ge(Nt,Ft){let bn="";for(;--Ft>=0;)bn+=Nt;return bn}function ke(Nt,Ft,bn,Yt){const He=bn||" ",$n=Nt+"",ur=Ft-$n.length;return ur<=0?$n:Yt==="left"?ge(He,ur)+$n:Yt==="center"?ge(He,~~(ur/2))+$n+ge(He,Math.ceil(ur/2)):$n+ge(He,ur)}function Ne(Nt){return Nt&&Ut(Nt)-Nt[0]||0}function ot(Nt){return Mt(Nt)?"["+Nt.map(ot)+"]":Xt(Nt)||Gi(Nt)?JSON.stringify(Nt).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):Nt}function xt(Nt){return Nt==null||Nt===""?null:!(!Nt||Nt==="false"||Nt==="0")&&!!Nt}const Ht=Nt=>Ei(Nt)||Dr(Nt)?Nt:Date.parse(Nt);function yn(Nt,Ft){return Ft=Ft||Ht,Nt==null||Nt===""?null:Ft(Nt)}function dr(Nt){return Nt==null||Nt===""?null:Nt+""}function _n(Nt){const Ft={},bn=Nt.length;for(let Yt=0;Yt<bn;++Yt)Ft[Nt[Yt]]=!0;return Ft}function In(Nt,Ft,bn,Yt){const He=Yt!=null?Yt:"\u2026",$n=Nt+"",ur=$n.length,pr=Math.max(0,Ft-He.length);return ur<=Ft?$n:bn==="left"?He+$n.slice(ur-pr):bn==="center"?$n.slice(0,Math.ceil(pr/2))+He+$n.slice(ur-~~(pr/2)):$n.slice(0,pr)+He}function Gn(Nt,Ft,bn){if(Nt)if(Ft){const Yt=Nt.length;for(let He=0;He<Yt;++He){const $n=Ft(Nt[He]);$n&&bn($n,He,Nt)}}else Nt.forEach(bn)}},function(j,m,o){o.r(m);var g=o(0),z=function(re,Q){return(z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,R){C.__proto__=R}||function(C,R){for(var oe in R)R.hasOwnProperty(oe)&&(C[oe]=R[oe])})(re,Q)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I(re,Q){function C(){this.constructor=re}z(re,Q),re.prototype=Q===null?Object.create(Q):(C.prototype=Q.prototype,new C)}var A,X=function(){return(X=Object.assign||function(re){for(var Q,C=1,R=arguments.length;C<R;C++)for(var oe in Q=arguments[C])Object.prototype.hasOwnProperty.call(Q,oe)&&(re[oe]=Q[oe]);return re}).apply(this,arguments)};function K(re,Q,C,R){return new(C||(C=Promise))(function(oe,Ue){function Je(Jt){try{qt(R.next(Jt))}catch(pt){Ue(pt)}}function vt(Jt){try{qt(R.throw(Jt))}catch(pt){Ue(pt)}}function qt(Jt){Jt.done?oe(Jt.value):new C(function(pt){pt(Jt.value)}).then(Je,vt)}qt((R=R.apply(re,Q||[])).next())})}function M(re,Q){var C,R,oe,Ue,Je={label:0,sent:function(){if(1&oe[0])throw oe[1];return oe[1]},trys:[],ops:[]};return Ue={next:vt(0),throw:vt(1),return:vt(2)},typeof Symbol=="function"&&(Ue[Symbol.iterator]=function(){return this}),Ue;function vt(qt){return function(Jt){return function(pt){if(C)throw new TypeError("Generator is already executing.");for(;Je;)try{if(C=1,R&&(oe=2&pt[0]?R.return:pt[0]?R.throw||((oe=R.return)&&oe.call(R),0):R.next)&&!(oe=oe.call(R,pt[1])).done)return oe;switch(R=0,oe&&(pt=[2&pt[0],oe.value]),pt[0]){case 0:case 1:oe=pt;break;case 4:return Je.label++,{value:pt[1],done:!1};case 5:Je.label++,R=pt[1],pt=[0];continue;case 7:pt=Je.ops.pop(),Je.trys.pop();continue;default:if(!(oe=(oe=Je.trys).length>0&&oe[oe.length-1])&&(pt[0]===6||pt[0]===2)){Je=0;continue}if(pt[0]===3&&(!oe||pt[1]>oe[0]&&pt[1]<oe[3])){Je.label=pt[1];break}if(pt[0]===6&&Je.label<oe[1]){Je.label=oe[1],oe=pt;break}if(oe&&Je.label<oe[2]){Je.label=oe[2],Je.ops.push(pt);break}oe[2]&&Je.ops.pop(),Je.trys.pop();continue}pt=Q.call(re,Je)}catch(Nn){pt=[6,Nn],R=0}finally{C=oe=0}if(5&pt[0])throw pt[1];return{value:pt[0]?pt[1]:void 0,done:!0}}([qt,Jt])}}}function V(){return A==null&&(A=Object(g.backend)().epsilon()),A}var $=function(re){function Q(C){var R=re.call(this,C)||this;return Object.setPrototypeOf(R,Q.prototype),R}return I(Q,re),Q}(Error),W=function(re){function Q(C){var R=re.call(this,C)||this;return Object.setPrototypeOf(R,Q.prototype),R}return I(Q,re),Q}(Error),te=function(re){function Q(C){var R=re.call(this,C)||this;return Object.setPrototypeOf(R,Q.prototype),R}return I(Q,re),Q}(Error),F=function(re){function Q(C){var R=re.call(this,C)||this;return Object.setPrototypeOf(R,Q.prototype),R}return I(Q,re),Q}(Error),ue=function(re){function Q(C){var R=re.call(this,C)||this;return Object.setPrototypeOf(R,Q.prototype),R}return I(Q,re),Q}(Error);(function(re){function Q(C){var R=re.call(this,C)||this;return Object.setPrototypeOf(R,Q.prototype),R}I(Q,re)})(Error);function se(re,Q){if(Array.isArray(re)){for(var C=[],R=0;R<Q;R++)C=C.concat(re);return C}return(C=new Array(Q)).fill(re),C}function J(re,Q){if(!re)throw new ue(Q)}function me(re,Q){for(var C=0,R=0,oe=re;R<oe.length;R++)oe[R]===Q&&C++;return C}function pe(re){return re.length===1?re[0]:re}function Oe(re){return Array.isArray(re)?re:[re]}function Fe(re){var Q=re.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return Q[0]!=="_"?Q:"private"+Q}function Le(re){return re.length<=1||re.indexOf("_")===-1?re:re.replace(/[_]+(\w|$)/g,function(Q,C){return C.toUpperCase()})}var Ae={};function ft(re){if(re==null)return null;var Q={};return Q.className=re.getClassName(),Q.config=re.getConfig(),Q}function Mt(re,Q,C,R,oe){var Ue,Je,vt;if(Q===void 0&&(Q={}),C===void 0&&(C={}),R===void 0&&(R="object"),oe===void 0&&(oe=!1),typeof re=="string"){var qt=re,Jt=void 0;if(qt in C)Jt=C[qt];else if(qt in Ae)Jt=Ae[qt];else if((Jt=Q[qt])==null)throw new te("Unknown "+R+": "+re+`. This may be due to one of the following reasons:
1. The `+R+` is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom `+R+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");return Jt}var pt=re;if(pt.className==null||pt.config==null)throw new te(R+": Improper config format: "+JSON.stringify(pt)+`.
'className' and 'config' must set.`);var Nn=pt.className,Pn=void 0,Vn=void 0;if(Nn in C?(Pn=(Ue=C[Nn])[0],Vn=Ue[1]):Nn in Ae?(Pn=(Je=Ae.className)[0],Vn=Je[1]):Nn in Q&&(Pn=(vt=Q[Nn])[0],Vn=vt[1]),Pn==null)throw new te("Unknown "+R+": "+Nn+`. This may be due to one of the following reasons:
1. The `+R+` is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom `+R+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");if(Vn!=null){for(var rr={},Yn=0,br=Object.keys(Ae);Yn<br.length;Yn++)rr[li=br[Yn]]=Ae[li];for(var xr=0,Lr=Object.keys(C);xr<Lr.length;xr++)rr[li=Lr[xr]]=C[li];pt.config.customObjects=rr;for(var Hr=X({},Ae),yi=0,zr=Object.keys(C);yi<zr.length;yi++){var li=zr[yi];Ae[li]=C[li]}(function bi(Oi){if(Oi!=null&&typeof Oi=="object")if(Array.isArray(Oi))Oi.forEach(function(Ho){return bi(Ho)});else for(var Vo=0,qo=Object.keys(Oi);Vo<qo.length;Vo++){var Ia=qo[Vo],Ao=Oi[Ia];Ao!=null&&typeof Ao=="object"&&(Array.isArray(Ao)||Ao.type!=="ndarray"||typeof Ao.value!="number"?bi(Ao):Oi[Ia]=Ao.value)}})(pt.config);var pi=Vn(Pn,pt.config,C,oe);return Ae=X({},Hr),pi}Hr=X({},Ae);for(var Pi=0,qi=Object.keys(C);Pi<qi.length;Pi++)li=qi[Pi],Ae[li]=C[li];return pi=new Pn(pt.config),Ae=X({},Hr),pi}function Xt(re,Q){return-1*function(C,R){return C<R?-1:C>R?1:0}(re,Q)}function tn(re){if(re==null)return re;for(var Q=[],C=0,R=re;C<R.length;C++){var oe=R[C];Q.indexOf(oe)===-1&&Q.push(oe)}return Q}function Ce(re){if(re==null)throw new te("Invalid value in obj: "+JSON.stringify(re));for(var Q in re)if(re.hasOwnProperty(Q))return!1;return!0}function Wt(re,Q,C){if(C!=null&&re.indexOf(C)<0)throw new te(C+" is not a valid "+Q+".  Valid values are "+re+" or null/undefined.")}function en(re,Q,C,R){return C===void 0&&(C=0),R===void 0&&(R=1/0),J(C>=0),J(R>=C),Array.isArray(re)&&re.length>=C&&re.length<=R&&re.every(function(oe){return typeof oe===Q})}function Ut(re,Q){Array.isArray(re)?(g.util.assert(re.length>0,function(){return Q+" is unexpectedly an empty array."}),re.forEach(function(C,R){return Ut(C,"element "+(R+1)+" of "+Q)})):g.util.assert(Number.isInteger(re)&&re>0,function(){return"Expected "+Q+" to be a positive integer, but got "+function C(R){return R===null?"null":Array.isArray(R)?"["+R.map(function(oe){return C(oe)}).join(",")+"]":typeof R=="string"?'"'+R+'"':""+R}(re)+"."})}function Qe(re){return re==="relu"?"relu":re==="linear"?"linear":re==="elu"?"elu":null}function fn(re,Q){return Object(g.tidy)(function(){return Object(g.sqrt)(Object(g.sum)(Object(g.mulStrict)(re,re),Q,!0))})}var on=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.getConfig=function(){return{}},Q}(g.serialization.Serializable),Ct=function(re){function Q(C){var R=re.call(this)||this;return R.defaultMaxValue=2,R.defaultAxis=0,R.maxValue=C.maxValue!=null?C.maxValue:R.defaultMaxValue,R.axis=C.axis!=null?C.axis:R.defaultAxis,R}return I(Q,re),Q.prototype.apply=function(C){var R=this;return Object(g.tidy)(function(){var oe=fn(C,R.axis),Ue=Object(g.clipByValue)(oe,0,R.maxValue);return Object(g.mul)(C,Object(g.div)(Ue,Object(g.add)(V(),oe)))})},Q.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},Q.className="MaxNorm",Q}(on);g.serialization.registerClass(Ct);var Vt=function(re){function Q(C){var R=re.call(this)||this;return R.defaultAxis=0,R.axis=C.axis!=null?C.axis:R.defaultAxis,R}return I(Q,re),Q.prototype.apply=function(C){var R=this;return Object(g.tidy)(function(){return Object(g.div)(C,Object(g.add)(V(),fn(C,R.axis)))})},Q.prototype.getConfig=function(){return{axis:this.axis}},Q.className="UnitNorm",Q}(on);g.serialization.registerClass(Vt);var En=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.apply=function(C){return Object(g.relu)(C)},Q.className="NonNeg",Q}(on);g.serialization.registerClass(En);var Pt=function(re){function Q(C){var R=re.call(this)||this;return R.defaultMinValue=0,R.defaultMaxValue=1,R.defaultRate=1,R.defaultAxis=0,R.minValue=C.minValue!=null?C.minValue:R.defaultMinValue,R.maxValue=C.maxValue!=null?C.maxValue:R.defaultMaxValue,R.rate=C.rate!=null?C.rate:R.defaultRate,R.axis=C.axis!=null?C.axis:R.defaultAxis,R}return I(Q,re),Q.prototype.apply=function(C){var R=this;return Object(g.tidy)(function(){var oe=fn(C,R.axis),Ue=Object(g.add)(Object(g.mul)(R.rate,Object(g.clipByValue)(oe,R.minValue,R.maxValue)),Object(g.mul)(1-R.rate,oe));return Object(g.mul)(C,Object(g.div)(Ue,Object(g.add)(V(),oe)))})},Q.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},Q.className="MinMaxNorm",Q}(on);g.serialization.registerClass(Pt);var Rt={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Tn(re){return ft(re)}function Hn(re,Q){return Q===void 0&&(Q={}),Mt(re,g.serialization.SerializationMap.getMap().classNameMap,Q,"constraint")}function tr(re){return re==null?null:typeof re=="string"?Hn({className:re in Rt?Rt[re]:re,config:{}}):re instanceof on?re:Hn(re)}var pn=Object.freeze({maxNorm:function(re){return new Ct(re)},unitNorm:function(re){return new Vt(re)},nonNeg:function(){return new En},minMaxNorm:function(re){return new Pt(re)}}),$e=["channelsFirst","channelsLast"],et=["valid","same","causal"],Ke=["max","avg"],yt=["sum","mul","concat","ave"],Dt=new Map;function Lt(re){Wt($e,"DataFormat",re)}function zn(re){Wt(et,"PaddingMode",re)}function Cn(re){Wt(Ke,"PoolMode",re)}var ar=[],we="/";function lr(re,Q){ar.push(re);try{var C=Q();return ar.pop(),C}catch(R){throw ar.pop(),R}}function Rr(re){if(!Gr(re))throw new Error("Not a valid tensor name: '"+re+"'");return(ar.length===0?"":ar.join(we)+we)+re}function Tr(re){if(!Gr(re))throw new Error("Not a valid tensor name: '"+re+"'");Dt.has(re)||Dt.set(re,0);var Q=Dt.get(re);if(Dt.set(re,Dt.get(re)+1),Q>0){var C=re+"_"+Q;return Dt.set(C,1),C}return re}var qr=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Gr(re){return!!re.match(qr)}function hn(re){return re===parseInt(re.toString(),10)}function nn(re,Q,C){Q==null&&(Q=0),C==null&&(C=re.length);for(var R=1,oe=Q;oe<C;++oe)R*=re[oe];return R}function an(re){return re=Array.isArray(re)?new Float32Array(re):re,Object(g.tensor1d)(re)}function or(re){return Object(g.min)(an(re)).dataSync()[0]}function jn(re){return Object(g.max)(an(re)).dataSync()[0]}function Fr(re,Q){if(Q<re)throw new te("end ("+Q+") < begin ("+re+") is forbidden.");for(var C=[],R=re;R<Q;++R)C.push(R);return C}function Pr(re,Q){return re.asType(Q)}function Br(re,Q){Q===void 0&&(Q=-1);var C=re.shape.slice();return Q<0&&(Q=C.length+Q+1),C.splice(Q,0,1),re.reshape(C)}function wi(re,Q,C){return Object(g.tidy)(function(){switch(re.rank){case 1:return Object(g.slice1d)(re,Q,C);case 2:return Object(g.slice2d)(re,[Q,0],[C,re.shape[1]]);case 3:return Object(g.slice3d)(re,[Q,0,0],[C,re.shape[1],re.shape[2]]);case 4:return Object(g.slice4d)(re,[Q,0,0,0],[C,re.shape[1],re.shape[2],re.shape[3]]);case 5:return Object(g.slice)(re,[Q,0,0,0,0],[C,re.shape[1],re.shape[2],re.shape[3],re.shape[4]]);case 6:return Object(g.slice)(re,[Q,0,0,0,0,0],[C,re.shape[1],re.shape[2],re.shape[3],re.shape[4],re.shape[5]]);default:throw new te("sliceAlongFirstAxis() received an unsupported tensor rank: "+re.rank)}})}function Ai(re,Q,C){return Object(g.tidy)(function(){switch(re.rank){case 1:return Object(g.slice1d)(re,Q,C);case 2:return Object(g.slice2d)(re,[0,Q],[re.shape[0],C]);case 3:return Object(g.slice3d)(re,[0,0,Q],[re.shape[0],re.shape[1],C]);case 4:return Object(g.slice4d)(re,[0,0,0,Q],[re.shape[0],re.shape[1],re.shape[2],C]);default:throw new te("sliceAlongLastAxis() received an unsupported tensor rank: "+re.rank)}})}function Jn(re,Q,C,R){return Object(g.tidy)(function(){switch(re.rank){case 1:return Object(g.slice1d)(re,Q,C);case 2:switch(R){case 1:return wi(re,Q,C);case 2:return Ai(re,Q,C);default:throw new te("The axis is not within the rank of the tensor "+R)}case 3:switch(R){case 1:return wi(re,Q,C);case 2:return Object(g.slice3d)(re,[0,Q,0],[re.shape[0],C,re.shape[2]]);case 3:return Ai(re,Q,C);default:throw new te("The axis is not within the rank of the tensor "+R)}case 4:switch(R){case 1:return wi(re,Q,C);case 2:return Object(g.slice4d)(re,[0,Q,0,0],[re.shape[0],C,re.shape[2],re.shape[3]]);case 3:return Object(g.slice4d)(re,[0,0,Q,0],[re.shape[0],re.shape[1],C,re.shape[3]]);case 4:return Ai(re,Q,C);default:throw new te("The axis is not within the rank of the tensor "+R)}default:throw new te("sliceAlongLastAxis() received an unsupported tensor rank: "+re.rank)}})}function di(re,Q){var C;return Q===void 0&&(Q=-1),Q<0&&(Q=(C=re[0].rank)!==0?C:0),Q===re[0].rank&&(Q=-1),Object(g.concat)(re,Q)}function ri(re,Q){switch(re.rank){case 1:return Object(g.concat1d)([re,Q]);case 2:return Object(g.concat2d)([re,Q],0);case 3:return Object(g.concat3d)([re,Q],0);case 4:return Object(g.concat4d)([re,Q],0);default:throw new te("concatAlongFirstAxis() received an unsupported tensor rank: "+re.rank)}}function Dr(re,Q){if(Array.isArray(Q)||(Q=[Q]),re.rank!==Q.length)throw new te("The length of input n ("+Q.length+") does not match the number of dimensions in input x ("+re.rank+")");return Object(g.tile)(re,Q)}function ki(re,Q,C,R,oe){return Q===void 0&&(Q=0),C===void 0&&(C=1),Object(g.randomNormal)(re,Q,C,R,oe)}function Ei(re,Q,C,R){if(re.rank<2||Q.rank<2)throw new F("dot requires both inputs to be rank >= 2 but got x shape = "+re.shape+" and y shape = "+Q.shape);if(Q.rank>=3&&re.shape.slice(-1)[0]!==(pt=Q.shape.slice(-2)[0]))throw new F("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = "+re.shape+" and  y shape = "+Q.shape);if(re.rank===2&&Q.rank===2){var oe=!1,Ue=!1;return g.fused.matMul({a:re,b:Q,transposeA:oe,transposeB:Ue,bias:R?Ui(re.rank,R,"channelsLast"):null,activation:C})}var Je=re.shape.slice(),vt=Je.pop();re=re.reshape([-1,vt]);var qt=Q.shape.slice(),Jt=qt.pop(),pt=qt.pop(),Nn=qt.concat([Jt]),Pn=Array.from({length:Q.rank},function(rr,Yn){return Yn===0?Q.rank-2:Yn<=Q.rank-2?Yn-1:Yn});Q=Q.transpose(Pn).reshape([pt,-1]);var Vn=Je.concat(Nn);return oe=!1,Ue=!1,g.fused.matMul({a:re,b:Q,transposeA:oe,transposeB:Ue,bias:R?Ui(re.rank,R,"channelsLast"):null,activation:C}).reshape(Vn)}function mo(re,Q,C){return Object(g.tidy)(function(){return Q=Array.isArray(Q)?Object(g.tensor1d)(Q,"int32"):Q.toInt(),Object(g.gather)(re,Q,C)})}function Gi(re){return Object(g.mulStrict)(re,re)}function Ui(re,Q,C){var R=Q.shape;if(Q.rank!==1&&Q.rank!==re)throw new te("Unexpected bias dimensions: "+Q.rank+"; expected it to be 1 or "+re);if(re===5){if(C==="channelsFirst")return R.length===1?Q.reshape([1,R[0],1,1,1]):Q.reshape([1,R[3],R[0],R[1],R[2]]);if(C==="channelsLast")return R.length===1?Q.reshape([1,1,1,1,R[0]]):Q.reshape([1].concat(R))}else if(re===4){if(C==="channelsFirst")return R.length===1?Q.reshape([1,R[0],1,1]):Q.reshape([1,R[2],R[0],R[1]]);if(C==="channelsLast")return R.length===1?Q.reshape([1,1,1,R[0]]):Q.reshape([1].concat(R))}else if(re===3){if(C==="channelsFirst")return R.length===1?Q.reshape([1,R[0],1]):Q.reshape([1,R[1],R[0]]);if(C==="channelsLast")return R.length===1?Q.reshape([1,1,R[0]]):Q.reshape([1].concat(R))}else if(re<3)return Q;throw new te("Unsupported input rank by biasAdd: "+Q.rank)}function Ot(re,Q,C){return Object(g.tidy)(function(){return C==null&&(C="channelsLast"),Lt(C),re.add(Ui(re.rank,Q,C))})}function $r(re,Q,C,R){return Object(g.tidy)(function(){return Object(g.dropout)(re,Q,C,R)})}function $t(re,Q,C){return C===void 0&&(C=!1),C?re():Q()}var xe=["fanIn","fanOut","fanAvg"],ge=["normal","uniform","truncatedNormal"],ke=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.fromConfigUsesCustomObjects=function(){return!1},Q.prototype.getConfig=function(){return{}},Q}(g.serialization.Serializable),Ne=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.apply=function(C,R){return Object(g.zeros)(C,R)},Q.className="Zeros",Q}(ke);g.serialization.registerClass(Ne);var ot=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.apply=function(C,R){return Object(g.ones)(C,R)},Q.className="Ones",Q}(ke);g.serialization.registerClass(ot);var xt=function(re){function Q(C){var R=re.call(this)||this;if(typeof C!="object")throw new te("Expected argument of type ConstantConfig but got "+C);if(C.value===void 0)throw new te("config must have value set but got "+C);return R.value=C.value,R}return I(Q,re),Q.prototype.apply=function(C,R){var oe=this;return Object(g.tidy)(function(){return Object(g.mul)(Object(g.scalar)(oe.value),Object(g.ones)(C,R))})},Q.prototype.getConfig=function(){return{value:this.value}},Q.className="Constant",Q}(ke);g.serialization.registerClass(xt);var Ht=function(re){function Q(C){var R=re.call(this)||this;return R.DEFAULT_MINVAL=-.05,R.DEFAULT_MAXVAL=.05,R.minval=C.minval||R.DEFAULT_MINVAL,R.maxval=C.maxval||R.DEFAULT_MAXVAL,R.seed=C.seed,R}return I(Q,re),Q.prototype.apply=function(C,R){return Object(g.randomUniform)(C,this.minval,this.maxval,R)},Q.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},Q.className="RandomUniform",Q}(ke);g.serialization.registerClass(Ht);var yn=function(re){function Q(C){var R=re.call(this)||this;return R.DEFAULT_MEAN=0,R.DEFAULT_STDDEV=.05,R.mean=C.mean||R.DEFAULT_MEAN,R.stddev=C.stddev||R.DEFAULT_STDDEV,R.seed=C.seed,R}return I(Q,re),Q.prototype.apply=function(C,R){if((R=R||"float32")!=="float32"&&R!=="int32")throw new F("randomNormal does not support dType "+R+".");return ki(C,this.mean,this.stddev,R,this.seed)},Q.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},Q.className="RandomNormal",Q}(ke);g.serialization.registerClass(yn);var dr=function(re){function Q(C){var R=re.call(this)||this;return R.DEFAULT_MEAN=0,R.DEFAULT_STDDEV=.05,R.mean=C.mean||R.DEFAULT_MEAN,R.stddev=C.stddev||R.DEFAULT_STDDEV,R.seed=C.seed,R}return I(Q,re),Q.prototype.apply=function(C,R){if((R=R||"float32")!=="float32"&&R!=="int32")throw new F("truncatedNormal does not support dType "+R+".");return Object(g.truncatedNormal)(C,this.mean,this.stddev,R,this.seed)},Q.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},Q.className="TruncatedNormal",Q}(ke);g.serialization.registerClass(dr);var _n=function(re){function Q(C){var R=re.call(this)||this;return R.gain=C.gain!=null?C.gain:1,R}return I(Q,re),Q.prototype.apply=function(C,R){var oe=this;return Object(g.tidy)(function(){if(C.length!==2||C[0]!==C[1])throw new te("Identity matrix initializer can only be used for 2D square matrices.");return Object(g.mul)(oe.gain,Object(g.eye)(C[0]))})},Q.prototype.getConfig=function(){return{gain:this.gain}},Q.className="Identity",Q}(ke);g.serialization.registerClass(_n);var In=function(re){function Q(C){var R=re.call(this)||this;if(C.scale<0)throw new te("scale must be a positive float. Got: "+C.scale);return R.scale=C.scale==null?1:C.scale,R.mode=C.mode==null?"fanIn":C.mode,function(oe){Wt(xe,"FanMode",oe)}(R.mode),R.distribution=C.distribution==null?"normal":C.distribution,function(oe){Wt(ge,"Distribution",oe)}(R.distribution),R.seed=C.seed,R}return I(Q,re),Q.prototype.apply=function(C,R){var oe=function(pt,Nn){var Pn,Vn;if(Nn===void 0&&(Nn="channelsLast"),Lt(Nn),pt.length===2)Pn=pt[0],Vn=pt[1];else if([3,4,5].indexOf(pt.length)!==-1)if(Nn==="channelsFirst"){var rr=nn(pt,2);Pn=pt[1]*rr,Vn=pt[0]*rr}else Nn==="channelsLast"&&(rr=nn(pt,0,pt.length-2),Pn=pt[pt.length-2]*rr,Vn=pt[pt.length-1]*rr);else{var Yn=nn(pt);Pn=Math.sqrt(Yn),Vn=Math.sqrt(Yn)}return[Pn,Vn]}(C),Ue=oe[0],Je=oe[1],vt=this.scale;if(this.mode==="fanIn"?vt/=Math.max(1,Ue):this.mode==="fanOut"?vt/=Math.max(1,Je):vt/=Math.max(1,(Ue+Je)/2),this.distribution==="normal"){var qt=Math.sqrt(vt);if((R=R||"float32")!=="float32"&&R!=="int32")throw new F(this.getClassName()+" does not support dType "+R+".");return Object(g.truncatedNormal)(C,0,qt,R,this.seed)}var Jt=Math.sqrt(3*vt);return Object(g.randomUniform)(C,-Jt,Jt,R)},Q.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},Q.className="VarianceScaling",Q}(ke);g.serialization.registerClass(In);var Gn=function(re){function Q(C){return re.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:C==null?null:C.seed})||this}return I(Q,re),Q.prototype.getClassName=function(){return In.className},Q.className="GlorotUniform",Q}(In);g.serialization.registerClass(Gn);var Nt=function(re){function Q(C){return re.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:C==null?null:C.seed})||this}return I(Q,re),Q.prototype.getClassName=function(){return In.className},Q.className="GlorotNormal",Q}(In);g.serialization.registerClass(Nt);var Ft=function(re){function Q(C){return re.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:C==null?null:C.seed})||this}return I(Q,re),Q.prototype.getClassName=function(){return In.className},Q.className="HeNormal",Q}(In);g.serialization.registerClass(Ft);var bn=function(re){function Q(C){return re.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:C==null?null:C.seed})||this}return I(Q,re),Q.prototype.getClassName=function(){return In.className},Q.className="HeUniform",Q}(In);g.serialization.registerClass(bn);var Yt=function(re){function Q(C){return re.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:C==null?null:C.seed})||this}return I(Q,re),Q.prototype.getClassName=function(){return In.className},Q.className="LeCunNormal",Q}(In);g.serialization.registerClass(Yt);var He=function(re){function Q(C){return re.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:C==null?null:C.seed})||this}return I(Q,re),Q.prototype.getClassName=function(){return In.className},Q.className="LeCunNormal",Q}(In);g.serialization.registerClass(He);var $n=function(re){function Q(C){var R=re.call(this)||this;if(R.DEFAULT_GAIN=1,R.gain=C.gain==null?R.DEFAULT_GAIN:C.gain,R.seed=C.seed,R.seed!=null)throw new F("Random seed is not implemented for Orthogonal Initializer yet.");return R}return I(Q,re),Q.prototype.apply=function(C,R){var oe=this;return Object(g.tidy)(function(){if(C.length!==2)throw new F("The Orthogonal Initializer does not support non-2D shapes yet.");C[0]*C[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 ("+C[0]*C[1]+") elements: Slowness may result.");var Ue=ki(C[0]>C[1]?[C[1],C[0]]:C,0,1,"float32"),Je=g.linalg.gramSchmidt(Ue);return C[0]>C[1]&&(Je=Je.transpose()),Object(g.mul)(oe.gain,Je)})},Q.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},Q.className="Orthogonal",Q}(ke);g.serialization.registerClass($n);var ur={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function pr(re,Q){return Q===void 0&&(Q={}),Mt(re,g.serialization.SerializationMap.getMap().classNameMap,Q,"initializer")}function kr(re){return ft(re)}function ui(re){if(typeof re=="string"){var Q=re in ur?ur[re]:re;if(Q==="GlorotNormal")return new Nt;if(Q==="GlorotUniform")return new Gn;if(Q==="HeNormal")return new Ft;if(Q==="HeUniform")return new bn;if(Q==="LeCunNormal")return new Yt;if(Q==="LeCunUniform")return new He;var C={};return C.className=Q,C.config={},pr(C)}return re instanceof ke?re:pr(re)}var Ir=Object.freeze({zeros:function(){return new Ne},ones:function(){return new ot},constant:function(re){return new xt(re)},randomUniform:function(re){return new Ht(re)},randomNormal:function(re){return new yn(re)},truncatedNormal:function(re){return new dr(re)},identity:function(re){return new _n(re)},varianceScaling:function(re){return new In(re)},glorotUniform:function(re){return new Gn(re)},glorotNormal:function(re){return new Nt(re)},heNormal:function(re){return new Ft(re)},heUniform:function(re){return new bn(re)},leCunNormal:function(re){return new Yt(re)},leCunUniform:function(re){return new He(re)},orthogonal:function(re){return new $n(re)}}),ji=0;function Do(){return ji++}var Bi={};function no(re){return re===void 0&&(re=""),re in Bi||(Bi[re]=0),Bi[re]+=1,re+Bi[re].toString()}function $i(re){return Array.isArray(re)&&Array.isArray(re[0])}function mi(re){return re.length===0?[]:Array.isArray(re[0])?re:[re]}function ai(re){var Q;if(Array.isArray(re)){if(re.length!==1)throw new te("Expected Tensor length to be 1; got "+re.length);Q=re[0]}else Q=re;return Q}function qn(re){if(Array.isArray(re)&&Array.isArray(re[0])){if(re.length===1)return(re=re)[0];throw new te("Expected exactly 1 Shape; got "+re.length)}return re}function Di(re){for(var Q=0,C=0,R=re;C<R.length;C++){var oe=R[C];oe.shape.length===0?Q+=1:Q+=oe.shape.reduce(function(Ue,Je){return Ue*Je})}return Q}var ko="Variable",Zr=function(){function re(Q,C,R,oe,Ue){C===void 0&&(C="float32"),R===void 0&&(R=ko),oe===void 0&&(oe=!0),Ue===void 0&&(Ue=null),this.dtype=C==null?"float32":C,this.shape=Q.shape,this.id=Do(),R=R==null?ko:R,this.originalName=Rr(R),this.name=Tr(this.originalName),this.trainable_=oe,this.constraint=Ue,this.val=Object(g.variable)(Q,this.trainable_,this.name,this.dtype)}return re.prototype.read=function(){return this.assertNotDisposed(),this.val},re.prototype.write=function(Q){return this.assertNotDisposed(),function(C,R){if(C.shape.toString()!==R.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(C.shape)+" vs. "+JSON.stringify(R.shape))}(this.val,Q),this.val.id!==Q.id&&(this.val.assign(Q),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this},re.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},re.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},Object.defineProperty(re.prototype,"trainable",{get:function(){return this.trainable_},set:function(Q){this.trainable_=Q,this.val.trainable=Q},enumerable:!0,configurable:!0}),re}();function Wo(re){return re.map(function(Q){return Q.read()})}function Oo(re){re.forEach(function(Q){Q[0].write(Q[1])})}var So=function(re){this.dtype=re.dtype,this.shape=re.shape,re.shape!=null?this.ndim=re.shape.length:this.ndim=re.ndim,this.maxNDim=re.maxNDim,this.minNDim=re.minNDim,this.axes=re.axes||{}},To=function(re,Q,C,R,oe,Ue,Je){this.dtype=re,this.shape=Q,this.sourceLayer=C,this.inputs=R,this.callArgs=oe,this.outputTensorIndex=Je,this.id=Do(),Ue!=null&&(this.originalName=Rr(Ue),this.name=Tr(this.originalName)),this.rank=Q.length},ds=0,As=function(){function re(Q,C){this.callArgs=C,this.id=ds++,this.outboundLayer=Q.outboundLayer,this.inboundLayers=Q.inboundLayers,this.nodeIndices=Q.nodeIndices,this.tensorIndices=Q.tensorIndices,this.inputTensors=Q.inputTensors,this.outputTensors=Q.outputTensors,this.inputMasks=Q.inputMasks,this.outputMasks=Q.outputMasks,this.inputShapes=Q.inputShapes,this.outputShapes=Q.outputShapes;for(var R=0,oe=Q.inboundLayers;R<oe.length;R++){var Ue=oe[R];Ue!=null&&Ue.outboundNodes.push(this)}Q.outboundLayer.inboundNodes.push(this)}return re.prototype.getConfig=function(){for(var Q=[],C=0,R=this.inboundLayers;C<R.length;C++){var oe=R[C];oe!=null?Q.push(oe.name):Q.push(null)}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:Q,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},re}(),Cf=0,eo=function(re){function Q(C){var R=re.call(this)||this;R._callHook=null,R._addedWeightNames=[],R._stateful=!1,R.id=Cf++,R.activityRegularizer=null,R.inputSpec=null,R.supportsMasking=!1,R._trainableWeights=[],R._nonTrainableWeights=[],R._losses=[],R._updates=[],R._built=!1,R.inboundNodes=[],R.outboundNodes=[];var oe=C.name;if(!oe){var Ue=R.getClassName();oe=Fe(Ue)+"_"+no(Ue)}if(R.name=oe,R.trainable_=C.trainable==null||C.trainable,C.inputShape!=null||C.batchInputShape!=null){var Je=void 0;if(C.batchInputShape!=null)Je=C.batchInputShape;else if(C.inputShape!=null){var vt=null;C.batchSize!=null&&(vt=C.batchSize),Je=[vt].concat(C.inputShape)}R.batchInputShape=Je;var qt=C.dtype;qt==null&&(qt=C.inputDType),qt==null&&(qt="float32"),R.dtype=qt}return C.weights!=null?R.initialWeights=C.weights:R.initialWeights=null,R._refCount=null,R.fastWeightInitDuringBuild=!1,R}return I(Q,re),Q.nodeKey=function(C,R){return C.name+"_ib-"+R.toString()},Q.prototype.getNodeAtIndex=function(C,R){if(this.inboundNodes.length===0)throw new W("The layer has never been called and thus has no defined "+R+".");if(this.inboundNodes.length<=C)throw new te("Asked to get "+R+" at node "+C+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[C]},Q.prototype.getInputAt=function(C){return pe(this.getNodeAtIndex(C,"input").inputTensors)},Q.prototype.getOutputAt=function(C){return pe(this.getNodeAtIndex(C,"output").outputTensors)},Object.defineProperty(Q.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new $("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(this.inboundNodes.length===0)throw new $("Layer "+this.name+" is not connected, no input to return.");return pe(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"output",{get:function(){if(this.inboundNodes.length===0)throw new $("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new $("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return pe(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),Q.prototype.calculateLosses=function(){return this.losses.map(function(C){return C()})},Object.defineProperty(Q.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"built",{get:function(){return this._built},set:function(C){this._built=C},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"trainable",{get:function(){return this.trainable_},set:function(C){this._trainableWeights.forEach(function(R){return R.trainable=C}),this.trainable_=C},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter(function(C){return C.trainable}):[]},set:function(C){this._trainableWeights=C},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter(function(C){return!C.trainable}).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(C){this._nonTrainableWeights=C},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),Q.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},Q.prototype.assertInputCompatibility=function(C){if(C=Oe(C),this.inputSpec!=null&&this.inputSpec.length!==0){var R=Oe(this.inputSpec);if(C.length!==R.length)throw new te("Layer "+this.name+" expects "+R.length+" inputs, but it received "+C.length+" input tensors. Input received: "+C);for(var oe=0;oe<C.length;oe++){var Ue=C[oe],Je=R[oe];if(Je!=null){var vt=Ue.rank;if(Je.ndim!=null&&vt!==Je.ndim)throw new te("Input "+oe+" is incompatible with layer "+this.name+": expected ndim="+Je.ndim+", found ndim="+vt);if(Je.maxNDim!=null&&vt>Je.maxNDim)throw new te("Input "+oe+" is incompatible with layer "+this.name+": expected max_ndim="+Je.maxNDim+", found ndim="+vt);if(Je.minNDim!=null&&vt<Je.minNDim)throw new te("Input "+oe+" is incompatible with layer "+this.name+": expected min_ndim="+Je.minNDim+", found ndim="+vt+".");if(Je.dtype!=null&&Ue.dtype!==Je.dtype)throw new te("Input "+oe+" is incompatible with layer "+this.name+" : expected dtype="+Je.dtype+", found dtype="+Ue.dtype+".");if(Je.axes){var qt=Ue.shape;for(var Jt in Je.axes){var pt=Number(Jt),Nn=Je.axes[Jt],Pn=pt>=0?qt[pt]:qt[qt.length+pt];if(Nn!=null&&[Nn,null].indexOf(Pn)===-1)throw new te("Input "+oe+" is incompatible with layer "+this.name+": expected axis "+pt+" of input shape to have value "+Nn+" but got shape "+qt+".")}}if(Je.shape!=null)for(var Vn=0;Vn<Je.shape.length;++Vn){var rr=Je.shape[Vn],Yn=Ue.shape[Vn];if(rr!=null&&Yn!=null&&rr!==Yn)throw new te("Input "+oe+" is incompatible with layer "+this.name+": expected shape="+Je.shape+", found shape="+Ue.shape+".")}}}}},Q.prototype.call=function(C,R){return C},Q.prototype.invokeCallHook=function(C,R){this._callHook!=null&&this._callHook(C,R)},Q.prototype.setCallHook=function(C){this._callHook=C},Q.prototype.clearCallHook=function(){this._callHook=null},Q.prototype.apply=function(C,R){var oe=this;R=R||{},this.assertNotDisposed();for(var Ue=Oe(C),Je=!0,vt=0,qt=Ue;vt<qt.length;vt++)if(!(qt[vt]instanceof To)){Je=!1;break}for(var Jt=!0,pt=0,Nn=Ue;pt<Nn.length;pt++)if(Nn[pt]instanceof To){Jt=!1;break}if(Je===Jt)throw new te("Arguments to apply() must be all SymbolicTensors or all Tensors");return lr(this.name,function(){if(!oe.built){oe.assertInputCompatibility(C);for(var Pn=[],Vn=0,rr=Oe(C);Vn<rr.length;Vn++){var Yn=rr[Vn];Pn.push(Yn.shape)}oe.build(pe(Pn)),oe.built=!0,oe.initialWeights&&oe.setWeights(oe.initialWeights),oe._refCount===null&&Jt&&(oe._refCount=1)}if(oe.assertInputCompatibility(C),Jt){for(var br=[],xr=0,Lr=Oe(li=oe.call(C,R));xr<Lr.length;xr++){var Hr=Lr[xr];Ue.indexOf(Hr)!==-1&&(Hr=Hr.clone()),br.push(Hr)}if(li=pe(br),oe.activityRegularizer!=null)throw new F("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return li}var yi=function(Pi){for(var qi=[],bi=0,Oi=Pi=Oe(Pi);bi<Oi.length;bi++){var Vo=Oi[bi];qi.push(Vo.shape)}return pe(qi)}(C),zr=oe.computeOutputShape(yi),li=void 0,pi="float32";if(oe.warnOnIncompatibleInputShape(Array.isArray(C)?yi[0]:yi),li=zr!=null&&zr.length>0&&Array.isArray(zr[0])?zr.map(function(Pi,qi){return new To(pi,Pi,oe,Oe(C),R,oe.name,qi)}):new To(pi,zr,oe,Oe(C),R,oe.name),oe.addInboundNode(C,li,null,null,yi,zr,R),oe._refCount++,oe.activityRegularizer!=null)throw new F("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return li})},Q.prototype.warnOnIncompatibleInputShape=function(C){if(this.batchInputShape!=null)if(C.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(C)+") does not match that of the batchInputShape ("+JSON.stringify(this.batchInputShape)+") of the layer "+this.name);else{var R=!1;this.batchInputShape.forEach(function(oe,Ue){oe!=null&&C[Ue]!=null&&C[Ue]!==oe&&(R=!0)}),R&&console.warn("The shape of the input tensor ("+JSON.stringify(C)+") does not match the expectation of layer "+this.name+": "+JSON.stringify(this.batchInputShape))}},Object.defineProperty(Q.prototype,"outputShape",{get:function(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new $("The layer "+this.name+" has never been called and thus has no defined output shape.");for(var C=[],R=0,oe=this.inboundNodes;R<oe.length;R++){var Ue=oe[R],Je=JSON.stringify(Ue.outputShapes);C.indexOf(Je)===-1&&C.push(Je)}if(C.length===1){var vt=this.inboundNodes[0].outputShapes;return Array.isArray(vt)&&Array.isArray(vt[0])&&vt.length===1?vt[0]:vt}throw new $("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "outut shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),Q.prototype.countParams=function(){if(!this.built)throw new W("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return Di(this.weights)},Q.prototype.build=function(C){this.built=!0},Q.prototype.getWeights=function(C){return C===void 0&&(C=!1),Wo(C?this.trainableWeights:this.weights)},Q.prototype.setWeights=function(C){var R=this;Object(g.tidy)(function(){var oe=R.weights;if(oe.length!==C.length)throw new te('You called setWeights(weights) on layer "'+R.name+'" with a weight list of length '+C.length+", but the layer was expecting "+oe.length+" weights. Provided weights: "+C+"...");if(oe.length!==0){for(var Ue=[],Je=Wo(oe),vt=0;vt<Je.length;++vt){var qt=Je[vt],Jt=oe[vt],pt=C[vt];if(!g.util.arraysEqual(qt.shape,pt.shape))throw new te("Layer weight shape "+qt.shape+" not compatible with provided weight shape "+pt.shape);Ue.push([Jt,pt])}Oo(Ue)}})},Q.prototype.addWeight=function(C,R,oe,Ue,Je,vt,qt){if(this._addedWeightNames.indexOf(C)!==-1)throw new te("Duplicate weight name "+C+" for layer "+this.name);this._addedWeightNames.push(C),oe==null&&(oe="float32"),this.fastWeightInitDuringBuild&&(Ue=ui("zeros"));var Jt=Ue.apply(R,oe),pt=new Zr(Jt,oe,C,vt,qt);return Jt.dispose(),Je!=null&&this.addLoss(function(){return Je.apply(pt.read())}),vt==null&&(vt=!0),vt?this._trainableWeights.push(pt):this._nonTrainableWeights.push(pt),pt},Q.prototype.setFastWeightInitDuringBuild=function(C){this.fastWeightInitDuringBuild=C},Q.prototype.addLoss=function(C){var R;C==null||Array.isArray(C)&&C.length===0||(C=Oe(C),this._losses!==void 0&&this._losses!==null&&(R=this.losses).push.apply(R,C))},Q.prototype.computeOutputShape=function(C){return C},Q.prototype.computeMask=function(C,R){var oe=this;if(!this.supportsMasking){if(R!=null){if(!Array.isArray(R))throw new TypeError("Layer "+this.name+" does not support masking, but was passed an inputMask.");R.forEach(function(Ue){if(Ue!=null)throw new TypeError("Layer "+oe.name+" does not support masking, but was passed an inputMask.")})}return null}return R},Q.prototype.addInboundNode=function(C,R,oe,Ue,Je,vt,qt){qt===void 0&&(qt=null);var Jt=Oe(C);R=Oe(R),oe=Oe(oe),Ue=Oe(Ue),Je=mi(Je),vt=mi(vt);for(var pt=[],Nn=[],Pn=[],Vn=0,rr=Jt;Vn<rr.length;Vn++){var Yn=rr[Vn];pt.push(Yn.sourceLayer),Nn.push(Yn.nodeIndex),Pn.push(Yn.tensorIndex)}new As({outboundLayer:this,inboundLayers:pt,nodeIndices:Nn,tensorIndices:Pn,inputTensors:Jt,outputTensors:R,inputMasks:oe,outputMasks:Ue,inputShapes:Je,outputShapes:vt},qt);for(var br=0;br<R.length;br++)R[br].sourceLayer=this,R[br].nodeIndex=this.inboundNodes.length-1,R[br].tensorIndex=br},Q.prototype.getConfig=function(){var C={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(C.batchInputShape=this.batchInputShape),this.dtype!=null&&(C.dtype=this.dtype),C},Q.prototype.disposeWeights=function(){return this.weights.forEach(function(C){return C.dispose()}),this.weights.length},Q.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Layer '"+this.name+"' is already disposed.")},Q.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(this._refCount===null)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var C=0;return--this._refCount==0&&(C=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:C}},Q}(g.serialization.Serializable),bu,wc=function(re){function Q(C){var R=re.call(this,{dtype:C.dtype,name:C.name!=null?C.name:no("input").toString()})||this;if(C.batchSize==null&&(C.batchSize=null),C.sparse==null&&(C.sparse=!1),R.trainable=!1,R.built=!0,R.sparse=C.sparse,C.inputShape!=null&&C.batchInputShape!=null)throw new te("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var oe=C.batchInputShape;if(oe==null){if(C.inputShape==null)throw new te("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");oe=[C.batchSize].concat(C.inputShape)}else if(C.batchSize!=null)throw new te("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var Ue=C.dtype||"float32";R.batchInputShape=oe,R.dtype=Ue,R.inputSpec=[{shape:oe}];var Je=new To(R.dtype,R.batchInputShape,R,[],{},R.name);return Je.nodeIndex=0,Je.tensorIndex=0,new As({outboundLayer:R,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[Je],outputTensors:[Je],inputMasks:[null],outputMasks:[null],inputShapes:[oe],outputShapes:[oe]}),R}return I(Q,re),Q.prototype.apply=function(C,R){throw new te("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},Q.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},Q.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},Q.className="InputLayer",Q}(eo);function kc(re){if(re.batchShape==null&&re.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(re.batchShape!=null&&re.shape!=null)throw new te("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var Q=re.batchShape;re.shape!=null&&Q==null&&(Q=[null].concat(re.shape));var C=re.dtype;return C==null&&(C="float32"),new wc({batchInputShape:Q,name:re.name,dtype:C,sparse:re.sparse}).inboundNodes[0].outputTensors[0]}function _c(re){return K(this,void 0,void 0,function(){var Q,C,R,oe,Ue,Je,vt,qt;return M(this,function(Jt){switch(Jt.label){case 0:if(re==null)return[2];for(oe in Q=[],C=[],R=[],re)typeof(Ue=re[oe])!="number"&&(Je=Ue,Q.push(Je.data()),C.push(oe),R.push(Je));return Q.length>0?[4,Promise.all(Q)]:[3,2];case 1:for(vt=Jt.sent(),qt=0;qt<vt.length;++qt)re[C[qt]]=vt[qt][0];Object(g.dispose)(R),Jt.label=2;case 2:return[2]}})})}function ws(re){if(re!=null)for(var Q in re){var C=re[Q];typeof C!="number"&&C.dispose()}}g.serialization.registerClass(wc),function(re){re[re.SILENT=0]="SILENT",re[re.VERBOSE=1]="VERBOSE"}(bu||(bu={}));var Ql=125,Hs=function(){function re(){this.validationData=null}return re.prototype.setParams=function(Q){this.params=Q},re.prototype.onEpochBegin=function(Q,C){return K(this,void 0,void 0,function(){return M(this,function(R){return[2]})})},re.prototype.onEpochEnd=function(Q,C){return K(this,void 0,void 0,function(){return M(this,function(R){return[2]})})},re.prototype.onBatchBegin=function(Q,C){return K(this,void 0,void 0,function(){return M(this,function(R){return[2]})})},re.prototype.onBatchEnd=function(Q,C){return K(this,void 0,void 0,function(){return M(this,function(R){return[2]})})},re.prototype.onTrainBegin=function(Q){return K(this,void 0,void 0,function(){return M(this,function(C){return[2]})})},re.prototype.onTrainEnd=function(Q){return K(this,void 0,void 0,function(){return M(this,function(C){return[2]})})},re.prototype.setModel=function(Q){},re}(),Mc=function(){function re(Q,C){C===void 0&&(C=10),Q==null&&(Q=[]),this.callbacks=Q,this.queueLength=C}return re.prototype.append=function(Q){this.callbacks.push(Q)},re.prototype.setParams=function(Q){for(var C=0,R=this.callbacks;C<R.length;C++)R[C].setParams(Q)},re.prototype.setModel=function(Q){for(var C=0,R=this.callbacks;C<R.length;C++)R[C].setModel(Q)},re.prototype.onEpochBegin=function(Q,C){return K(this,void 0,void 0,function(){var R,oe;return M(this,function(Ue){switch(Ue.label){case 0:C==null&&(C={}),R=0,oe=this.callbacks,Ue.label=1;case 1:return R<oe.length?[4,oe[R].onEpochBegin(Q,C)]:[3,4];case 2:Ue.sent(),Ue.label=3;case 3:return R++,[3,1];case 4:return[2]}})})},re.prototype.onEpochEnd=function(Q,C){return K(this,void 0,void 0,function(){var R,oe;return M(this,function(Ue){switch(Ue.label){case 0:C==null&&(C={}),R=0,oe=this.callbacks,Ue.label=1;case 1:return R<oe.length?[4,oe[R].onEpochEnd(Q,C)]:[3,4];case 2:Ue.sent(),Ue.label=3;case 3:return R++,[3,1];case 4:return[2]}})})},re.prototype.onBatchBegin=function(Q,C){return K(this,void 0,void 0,function(){var R,oe;return M(this,function(Ue){switch(Ue.label){case 0:C==null&&(C={}),R=0,oe=this.callbacks,Ue.label=1;case 1:return R<oe.length?[4,oe[R].onBatchBegin(Q,C)]:[3,4];case 2:Ue.sent(),Ue.label=3;case 3:return R++,[3,1];case 4:return[2]}})})},re.prototype.onBatchEnd=function(Q,C){return K(this,void 0,void 0,function(){var R,oe;return M(this,function(Ue){switch(Ue.label){case 0:C==null&&(C={}),R=0,oe=this.callbacks,Ue.label=1;case 1:return R<oe.length?[4,oe[R].onBatchEnd(Q,C)]:[3,4];case 2:Ue.sent(),Ue.label=3;case 3:return R++,[3,1];case 4:return[2]}})})},re.prototype.onTrainBegin=function(Q){return K(this,void 0,void 0,function(){var C,R;return M(this,function(oe){switch(oe.label){case 0:Q==null&&(Q={}),C=0,R=this.callbacks,oe.label=1;case 1:return C<R.length?[4,R[C].onTrainBegin(Q)]:[3,4];case 2:oe.sent(),oe.label=3;case 3:return C++,[3,1];case 4:return[2]}})})},re.prototype.onTrainEnd=function(Q){return K(this,void 0,void 0,function(){var C,R;return M(this,function(oe){switch(oe.label){case 0:Q==null&&(Q={}),C=0,R=this.callbacks,oe.label=1;case 1:return C<R.length?[4,R[C].onTrainEnd(Q)]:[3,4];case 2:oe.sent(),oe.label=3;case 3:return C++,[3,1];case 4:return[2]}})})},re}(),Af=function(re){function Q(){return re.call(this)||this}return I(Q,re),Q.prototype.onEpochBegin=function(C){return K(this,void 0,void 0,function(){return M(this,function(R){return this.seen=0,this.totals={},[2]})})},Q.prototype.onBatchEnd=function(C,R){return K(this,void 0,void 0,function(){var oe,Ue,Je,vt,qt=this;return M(this,function(Jt){for(vt in R==null&&(R={}),oe=R.size==null?0:R.size,this.seen+=oe,Ue=function(pt){var Nn=R[pt];if(typeof Nn=="number")Je.totals.hasOwnProperty(pt)||(Je.totals[pt]=0),Je.totals[pt]=Je.totals[pt]+Nn*oe;else{var Pn=void 0;pt in Je.totals?Pn=Je.totals[pt]:Je.totals[pt]=0;var Vn=Object(g.tidy)(function(){return Object(g.add)(qt.totals[pt],Object(g.mul)(Nn,oe))});Je.totals[pt]=Vn,Pn!=null&&Pn.dispose()}},Je=this,R)Ue(vt);return[2]})})},Q.prototype.onEpochEnd=function(C,R){return K(this,void 0,void 0,function(){var oe,Ue,Je,vt,qt,Jt=this;return M(this,function(pt){if(R!=null)for(oe=function(Nn){if(Ue.totals[Nn]==null)return"continue";typeof Ue.totals[Nn]=="number"?R[Nn]=Ue.totals[Nn]/Ue.seen:Object(g.tidy)(function(){var Pn=Object(g.mul)(Object(g.div)(1,Jt.seen),Jt.totals[Nn]);R[Nn]=Pn,Jt.totals[Nn].dispose(),Object(g.keep)(R[Nn])})},Ue=this,Je=0,vt=this.params.metrics;Je<vt.length;Je++)qt=vt[Je],oe(qt);return[2]})})},Q}(Hs),Gs=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.onTrainBegin=function(C){return K(this,void 0,void 0,function(){return M(this,function(R){return this.epoch=[],this.history={},[2]})})},Q.prototype.onEpochEnd=function(C,R){return K(this,void 0,void 0,function(){var oe;return M(this,function(Ue){for(oe in R==null&&(R={}),this.epoch.push(C),R)this.history[oe]==null&&(this.history[oe]=[]),this.history[oe].push(R[oe]);return[2]})})},Q.prototype.syncData=function(){return K(this,void 0,void 0,function(){var C,R,oe,Ue,Je,vt,qt,Jt,pt;return M(this,function(Nn){switch(Nn.label){case 0:for(Ue in C=[],R=[],oe=[],this.history)for(Je=this.history[Ue],vt=0;vt<Je.length;++vt)typeof Je[vt]!="number"&&(qt=Je[vt],C.push(qt.data()),R.push(Ue),oe.push(vt));return[4,Promise.all(C)];case 1:for(Jt=Nn.sent(),pt=0;pt<Jt.length;++pt)this.history[R[pt]][oe[pt]].dispose(),this.history[R[pt]][oe[pt]]=Jt[pt][0];return[2]}})})},Q}(Hs),Zl=function(re){function Q(C,R){var oe=re.call(this)||this;if(oe.currentEpoch=0,oe.yieldEvery=R||"auto",oe.yieldEvery==="auto"&&(oe.yieldEvery=Ql),oe.yieldEvery==="never"&&C.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return g.util.isNumber(oe.yieldEvery)&&(oe.maybeWait=function(Ue,Je){var vt,qt=g.util.now();return function(){for(var Jt=[],pt=0;pt<arguments.length;pt++)Jt[pt]=arguments[pt];var Nn=g.util.now();return Nn-qt<Je?vt:(qt=Nn,vt=Ue.apply(void 0,Jt))}}(oe.maybeWait.bind(oe),oe.yieldEvery)),oe.trainBegin=C.onTrainBegin,oe.trainEnd=C.onTrainEnd,oe.epochBegin=C.onEpochBegin,oe.epochEnd=C.onEpochEnd,oe.batchBegin=C.onBatchBegin,oe.batchEnd=C.onBatchEnd,oe.yield=C.onYield,oe}return I(Q,re),Q.prototype.maybeWait=function(C,R,oe){return K(this,void 0,void 0,function(){var Ue;return M(this,function(Je){switch(Je.label){case 0:return Ue=[],this.yield==null?[3,2]:[4,_c(oe)];case 1:Je.sent(),Ue.push(this.yield(C,R,oe)),Je.label=2;case 2:return Ue.push(Object(g.nextFrame)()),[4,Promise.all(Ue)];case 3:return Je.sent(),[2]}})})},Q.prototype.onEpochBegin=function(C,R){return K(this,void 0,void 0,function(){return M(this,function(oe){switch(oe.label){case 0:return this.currentEpoch=C,this.epochBegin==null?[3,3]:[4,_c(R)];case 1:return oe.sent(),[4,this.epochBegin(C,R)];case 2:oe.sent(),oe.label=3;case 3:return[2]}})})},Q.prototype.onEpochEnd=function(C,R){return K(this,void 0,void 0,function(){var oe;return M(this,function(Ue){switch(Ue.label){case 0:return oe=[],this.epochEnd==null?[3,2]:[4,_c(R)];case 1:Ue.sent(),oe.push(this.epochEnd(C,R)),Ue.label=2;case 2:return this.yieldEvery==="epoch"&&oe.push(Object(g.nextFrame)()),[4,Promise.all(oe)];case 3:return Ue.sent(),[2]}})})},Q.prototype.onBatchBegin=function(C,R){return K(this,void 0,void 0,function(){return M(this,function(oe){switch(oe.label){case 0:return this.batchBegin==null?[3,3]:[4,_c(R)];case 1:return oe.sent(),[4,this.batchBegin(C,R)];case 2:oe.sent(),oe.label=3;case 3:return[2]}})})},Q.prototype.onBatchEnd=function(C,R){return K(this,void 0,void 0,function(){var oe;return M(this,function(Ue){switch(Ue.label){case 0:return oe=[],this.batchEnd==null?[3,2]:[4,_c(R)];case 1:Ue.sent(),oe.push(this.batchEnd(C,R)),Ue.label=2;case 2:return this.yieldEvery==="batch"?oe.push(Object(g.nextFrame)()):g.util.isNumber(this.yieldEvery)&&oe.push(this.maybeWait(this.currentEpoch,C,R)),[4,Promise.all(oe)];case 3:return Ue.sent(),[2]}})})},Q.prototype.onTrainBegin=function(C){return K(this,void 0,void 0,function(){return M(this,function(R){switch(R.label){case 0:return this.trainBegin==null?[3,3]:[4,_c(C)];case 1:return R.sent(),[4,this.trainBegin(C)];case 2:R.sent(),R.label=3;case 3:return[2]}})})},Q.prototype.onTrainEnd=function(C){return K(this,void 0,void 0,function(){return M(this,function(R){switch(R.label){case 0:return this.trainEnd==null?[3,3]:[4,_c(C)];case 1:return R.sent(),[4,this.trainEnd(C)];case 2:R.sent(),R.label=3;case 3:return[2]}})})},Q}(Hs);function pl(re,Q){return re==null&&(re={}),re instanceof Hs?[re]:Array.isArray(re)&&re[0]instanceof Hs?re:Oe(re).map(function(C){return new Zl(C,Q)})}var ml=function(){function re(){}return re.registerCallbackConstructor=function(Q,C){g.util.assert(Q>=0&&Number.isInteger(Q),function(){return"Verbosity level is expected to be an integer >= 0, but got "+Q}),re.checkForDuplicate(C),re.constructors[Q]==null&&(re.constructors[Q]=[]),re.constructors[Q].push(C)},re.checkForDuplicate=function(Q){for(var C in re.constructors)re.constructors[+C].forEach(function(R){if(R===Q)throw new te("Duplicate callback constructor.")})},re.clear=function(){re.constructors={}},re.createCallbacks=function(Q){var C=[];for(var R in re.constructors){var oe=+R;Q>=oe&&C.push.apply(C,re.constructors[oe])}return C.map(function(Ue){return new Ue})},re.constructors={},re}();function Gc(re,Q,C,R,oe,Ue,Je,vt,qt){var Jt=new Gs,pt=[new Af].concat(ml.createCallbacks(Q));re!=null&&pt.push.apply(pt,re),pt.push(Jt);var Nn=new Mc(pt);return Nn.setParams({epochs:C,initialEpoch:R,samples:oe,steps:Ue,batchSize:Je,verbose:Q,doValidation:vt,metrics:qt}),{callbackList:Nn,history:Jt}}function ha(re,Q,C){return Q===void 0&&(Q={}),C===void 0&&(C=!1),Mt(re,g.serialization.SerializationMap.getMap().classNameMap,Q,"layer",C)}function $c(re,Q){return Object(g.tidy)(function(){re.dtype!=="float32"&&(re=re.asType("float32"));var C=Object(g.sum)(Gi(re),Q,!0),R=Object(g.fill)(C.shape,V()),oe=Object(g.sqrt)(Object(g.maximum)(C,R));return Object(g.div)(re,oe)})}function Ga(re,Q){return Object(g.tidy)(function(){return Object(g.mean)(Gi(Object(g.sub)(Q,re)),-1)})}function Kc(re,Q){return Object(g.tidy)(function(){return Object(g.mean)(Object(g.abs)(Object(g.sub)(Q,re)),-1)})}function Is(re,Q){return Object(g.tidy)(function(){var C=Object(g.sub)(re,Q),R=Object(g.clipByValue)(Object(g.abs)(re),V(),Number.MAX_VALUE),oe=Object(g.abs)(Object(g.div)(C,R));return Object(g.mul)(100,Object(g.mean)(oe,-1))})}function Ba(re,Q,C){return C===void 0&&(C=!1),Object(g.tidy)(function(){if(C)Q=Object(g.softmax)(Q);else{var R=Object(g.sum)(Q,Q.shape.length-1,!0);Q=Object(g.div)(Q,R)}return Q=Object(g.clipByValue)(Q,V(),1-V()),Object(g.neg)(Object(g.sum)(Object(g.mul)(re.toFloat(),Object(g.log)(Q)),Q.shape.length-1))})}function jc(re,Q){return Object(g.tidy)(function(){var C=Object(g.floor)(function(oe){var Ue=[nn(oe.shape)];return oe.reshape(Ue)}(re)).toInt(),R=(Q=Object(g.clipByValue)(Q,V(),1-V())).shape;return Ba(Object(g.oneHot)(C,R[R.length-1]).reshape(R),Q,!1)})}function ac(re,Q){return Object(g.tidy)(function(){var C;return C=Object(g.clipByValue)(Q,V(),1-V()),C=Object(g.log)(Object(g.div)(C,Object(g.sub)(1,C))),Object(g.mean)(function(R,oe){if(!g.util.arraysEqual(R.shape,oe.shape))throw new te("logits and labels must have the same shape, but got shapes "+JSON.stringify(R.shape)+" and "+JSON.stringify(oe.shape));return Object(g.tidy)(function(){var Ue=oe.relu(),Je=oe.abs().neg();return Ue.sub(oe.mul(R)).add(Je.exp().log1p())})}(re,C),-1)})}function Xc(re,Q){return Object(g.tidy)(function(){var C=$c(re,-1),R=$c(Q,-1),oe=Object(g.mul)(C,R);return Object(g.neg)(Object(g.sum)(oe,-1))})}var eu={meanSquaredError:Ga,meanAbsoluteError:Kc,meanAbsolutePercentageError:Is,meanSquaredLogarithmicError:function(re,Q){return Object(g.tidy)(function(){var C=Object(g.clipByValue)(Q,V(),Number.MAX_VALUE),R=Object(g.log)(Object(g.add)(1,C)),oe=Object(g.clipByValue)(re,V(),Number.MAX_VALUE),Ue=Object(g.log)(Object(g.add)(1,oe));return Object(g.mean)(Gi(Object(g.sub)(R,Ue)),-1)})},squaredHinge:function(re,Q){return Object(g.tidy)(function(){var C=Object(g.maximum)(0,Object(g.sub)(1,Object(g.mul)(re,Q)));return Object(g.mean)(Gi(C),-1)})},hinge:function(re,Q){return Object(g.tidy)(function(){var C=Object(g.maximum)(0,Object(g.sub)(1,Object(g.mul)(re,Q)));return Object(g.mean)(C,-1)})},categoricalHinge:function(re,Q){return Object(g.tidy)(function(){var C=Object(g.sum)(Object(g.mul)(re,Q),-1),R=Object(g.max)(Object(g.mul)(Object(g.sub)(1,re),Q),-1);return Object(g.maximum)(0,Object(g.add)(1,Object(g.sub)(R,C)))})},logcosh:function(re,Q){return Object(g.tidy)(function(){var C=Math.log(2),R=Object(g.sub)(Q,re),oe=Object(g.sub)(Object(g.add)(R,Object(g.softplus)(Object(g.mul)(-2,R))),C);return Object(g.mean)(oe,-1)})},categoricalCrossentropy:Ba,sparseCategoricalCrossentropy:jc,binaryCrossentropy:ac,kullbackLeiblerDivergence:function(re,Q){return Object(g.tidy)(function(){var C=Object(g.clipByValue)(re,V(),1),R=Object(g.clipByValue)(Q,V(),1);return Object(g.sum)(Object(g.mul)(re,Object(g.log)(Object(g.div)(C,R))),-1)})},poisson:function(re,Q){return Object(g.tidy)(function(){var C=Object(g.log)(Object(g.add)(V(),Q));return Object(g.mean)(Object(g.sub)(Q,Object(g.mul)(re,C)),-1)})},cosineProximity:Xc};function ps(re){if(typeof re=="string"){if(re in eu)return eu[re];var Q="Unknown loss "+re;throw re.toLowerCase().includes("softmaxcrossentropy")&&(Q="Unknown loss "+re+'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new te(Q)}return re}function ef(re,Q){return Object(g.tidy)(function(){var C=Object(g.mul)(.5,Object(g.onesLike)(Q)),R=Pr(Object(g.greater)(Q,C),re.dtype);return Object(g.mean)(Object(g.equal)(re,R),-1)})}function Yc(re,Q){return Object(g.tidy)(function(){return Pr(Object(g.equal)(Object(g.argMax)(re,-1),Object(g.argMax)(Q,-1)),"float32")})}function na(re,Q){return Object(g.tidy)(function(){return Object(g.logicalAnd)(re.equal(1),Q.equal(1)).sum().cast("float32")})}function Xf(re,Q){return Object(g.tidy)(function(){var C=na(re,Q),R=function(Ue,Je){return Object(g.tidy)(function(){return Object(g.logicalAnd)(Ue.equal(0),Je.equal(1)).sum().cast("float32")})}(re,Q),oe=C.add(R);return Object(g.where)(Object(g.greater)(oe,0),C.div(oe),0).cast("float32")})}function Jc(re,Q){return Object(g.tidy)(function(){var C=na(re,Q),R=function(Ue,Je){return Object(g.tidy)(function(){return Object(g.logicalAnd)(Ue.equal(1),Je.equal(0)).sum().cast("float32")})}(re,Q),oe=C.add(R);return Object(g.where)(Object(g.greater)(oe,0),C.div(oe),0).cast("float32")})}function Of(re,Q){return ac(re,Q)}function da(re,Q){return re.rank===Q.rank&&(re=re.squeeze([re.rank-1])),(Q=Q.argMax(-1)).dtype!==re.dtype&&(Q=Q.asType(re.dtype)),Object(g.equal)(re,Q).asType("float32")}var Qi=Ba,xi=jc,hr={binaryAccuracy:ef,categoricalAccuracy:Yc,precision:Xf,categoricalCrossentropy:Qi,sparseCategoricalCrossentropy:xi,mse:Ga,MSE:Ga,mae:Kc,MAE:Kc,mape:Is,MAPE:Is,cosine:Xc};function is(re){if(J(re!==null,"Unknown LossOrMetricFn "+re),typeof re=="string")return re;for(var Q=void 0,C=0,R=Object.keys(eu);C<R.length;C++){var oe=R[C];if(eu[oe]===re){Q=oe;break}}if(Q!==void 0)return Q;for(var Ue=0,Je=Object.keys(hr);Ue<Je.length;Ue++)if(oe=Je[Ue],hr[oe]===re){Q=oe;break}return Q!==void 0?Q:re.name}var Nh=1048576;function No(re,Q,C){if(C===void 0&&(C=!1),re==null||typeof re!="object"||Object.getPrototypeOf(re)!==Object.prototype||!function oe(Ue){if(Ue===null)return!0;if(typeof Ue=="object"){if(Object.getPrototypeOf(Ue)===Object.prototype){for(var Je=0,vt=Object.keys(Ue);Je<vt.length;Je++){var qt=vt[Je];if(typeof qt!="string"||!oe(Ue[qt]))return!1}return!0}if(Array.isArray(Ue)){for(var Jt=0,pt=Ue;Jt<pt.length;Jt++)if(!oe(pt[Jt]))return!1;return!0}return!1}var Nn=typeof Ue;return Nn==="string"||Nn==="number"||Nn==="boolean"}(re))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(C){var R=JSON.stringify(re);R.length>Nh&&console.warn('User-defined metadata of model "'+Q+'" is too large in size (length='+R.length+" when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+Nh+".")}}function Qc(re,Q,C,R){R===void 0&&(R=console.log);var oe,Ue=function(Pn){var Vn=!0,rr=[],Yn=[];for(var br in Pn.nodesByDepth)rr.push(Pn.nodesByDepth[br]);for(var xr=0,Lr=rr;xr<Lr.length;xr++){var Hr=Lr[xr];if(Hr.length>1||Hr.length===1&&Hr[0].inboundLayers.length>1){Vn=!1;break}Yn.push.apply(Yn,Hr)}if(Vn)for(var yi=0,zr=Pn.layers;yi<zr.length;yi++){for(var li=!1,pi=0,Pi=zr[yi].inboundNodes;pi<Pi.length;pi++){var qi=Pi[pi];if(Yn.indexOf(qi)!==-1){if(li){Vn=!1;break}li=!0}}if(!Vn)break}return Vn}(re),Je=["Layer (type)","Output shape","Param #"];if(Ue?(Q=Q||65,C=C||[.45,.85,1]):(Q=Q||98,C=C||[.33,.55,.67,1]),C[C.length-1]<=1&&(C=C.map(function(Pn){return Math.floor(Q*Pn)})),!Ue)for(var vt in Je.push("Receives inputs"),oe=[],re.nodesByDepth)oe.push.apply(oe,re.nodesByDepth[vt]);R("_".repeat(Q)),Yf(Je,C,R),R("=".repeat(Q));for(var qt=re.layers,Jt=0;Jt<qt.length;++Jt)Ue?zp(qt[Jt],C,R):tu(qt[Jt],C,oe,R),R((Jt===qt.length-1?"=":"_").repeat(Q));re.checkTrainableWeightsConsistency();var pt=function(Pn){return Pn.collectedTrainableWeights!=null?Di(Pn.collectedTrainableWeights):Di(Pn.trainableWeights)}(re),Nn=Di(re.nonTrainableWeights);R("Total params: "+(pt+Nn)),R("Trainable params: "+pt),R("Non-trainable params: "+Nn),R("_".repeat(Q))}function Yf(re,Q,C){C===void 0&&(C=console.log);for(var R="",oe=0;oe<re.length;++oe)oe>0&&(R=R.slice(0,R.length-1)+" "),R=(R+=re[oe]).slice(0,Q[oe]),R+=" ".repeat(Q[oe]-R.length);C(R)}function zp(re,Q,C){var R;try{R=JSON.stringify(re.outputShape)}catch{R="multiple"}Yf([re.name+" ("+re.getClassName()+")",R,re.countParams().toString()],Q,C)}function tu(re,Q,C,R){var oe;try{oe=JSON.stringify(re.outputShape)}catch{oe="multiple"}for(var Ue=[],Je=0,vt=re.inboundNodes;Je<vt.length;Je++){var qt=vt[Je];if(!(C!=null&&C.length>0&&C.indexOf(qt)===-1))for(var Jt=0;Jt<qt.inboundLayers.length;++Jt){var pt=qt.inboundLayers[Jt].name,Nn=qt.nodeIndices[Jt],Pn=qt.tensorIndices[Jt];Ue.push(pt+"["+Nn+"]["+Pn+"]")}}var Vn=re.name,rr=re.getClassName(),Yn=Ue.length===0?"":Ue[0];for(Yf([Vn+" ("+rr+")",oe,re.countParams().toString(),Yn],Q,R),Jt=1;Jt<Ue.length;++Jt)Yf(["","","",Ue[Jt]],Q,R)}function Ih(re,Q,C){return(re==="inboundNodes"||re==="outputLayers"||re==="inputLayers")&&Q===0&&typeof C=="string"}function so(re,Q){if(re===null)return null;if(typeof re=="string")return Le(re);if(typeof re=="number"||typeof re=="boolean")return re;if(re instanceof Array){for(var C=[],R=re.length,oe=0;oe<R;++oe){var Ue=re[oe];Ih(Q,oe,Ue)?C.push(Ue):C.push(so(Ue,Q))}return C}for(var Je={},vt=0,qt=Object.keys(re);vt<qt.length;vt++){var Jt=qt[vt],pt=re[Jt];if(Jt==="name"&&typeof pt=="string")Je[Jt]=pt;else{var Nn=Le(Jt);Je[Nn]=so(pt,Nn)}}return Je}var Oa=function(){function re(Q){if(this.id2Value={},this.id2Mask={},this.name2Id={},Q instanceof re)for(var C in Q.id2Value)this.id2Value[C]=Q.id2Value[C],C in Q.id2Mask&&(this.id2Mask[C]=Q.id2Mask[C]);else{if(Q==null)return;for(var R=0,oe=Q;R<oe.length;R++){var Ue=oe[R];this.add(Ue.key,Ue.value)}}}return re.prototype.add=function(Q,C,R){if(this.id2Value[Q.id]!=null)throw new te("Duplicate key: name="+Q.name+", id="+Q.id);return this.id2Value[Q.id]=function(oe,Ue){if(oe.dtype==null||oe.dtype===Ue.dtype)return Ue;try{return Object(g.cast)(Ue,oe.dtype)}catch{throw new te("The dtype of the feed ("+Ue.dtype+") can not be cast to the dtype of the key '"+oe.name+"' ("+oe.dtype+").")}}(Q,C),this.name2Id[Q.name]=Q.id,R!=null&&(this.id2Mask[Q.id]=R),this},re.prototype.addFeed=function(Q){this.add(Q.key,Q.value)},re.prototype.hasKey=function(Q){return this.id2Value[Q.id]!=null},re.prototype.names=function(){return Object.keys(this.name2Id)},re.prototype.getValue=function(Q){if(Q instanceof To){if(this.id2Value[Q.id]==null)throw new te("Nonexistent key: "+Q.name);return this.id2Value[Q.id]}var C=this.name2Id[Q];if(C==null)throw new te("Feed dict has no SymbolicTensor name: "+Q);return this.id2Value[C]},re.prototype.getMask=function(Q){if(Q instanceof To){if(this.id2Value[Q.id]==null)throw new te("Nonexistent key: "+Q.name);return this.id2Mask[Q.id]}var C=this.name2Id[Q];if(C==null)throw new te("Feed dict has no SymbolicTensor name: "+Q);return this.id2Mask[C]},re.prototype.disposeMasks=function(){this.id2Mask!=null&&Object(g.dispose)(this.id2Mask)},re}(),Fh={},Zc={};function Rh(re,Q,C,R){for(var oe=C!=null&&C.training,Ue=Array.isArray(re),Je=Ue?re:[re],vt=Je.map(function(co){return co.name}),qt=[],Jt=Q.names(),pt=0,Nn=vt;pt<Nn.length;pt++){var Pn=Nn[pt];Jt.indexOf(Pn)!==-1?qt.push(Q.getValue(Pn)):qt.push(null)}R!=null&&(R.maxNumTensors=-1/0,R.minNumTensors=1/0);var Vn,rr,Yn=vt.join(",")+"|"+Q.names().join(",");if(Fh[Yn]==null){var br=function(co,Jo){g.util.assert(co!=null&&co.length>0,function(){return"Expected at least one fetch, got none"});var Pa=[],ks={};if(co.length===1){var Qo=Xd(co[0],Jo);Pa=Qo.sorted,ks=Qo.recipientMap}else for(var Wa=new Set,ku=0,Cs=co;ku<Cs.length;ku++){for(var fa=Xd(Cs[ku],Jo),_s=fa.sorted,_l=fa.recipientMap,Js=0,Bs=_s;Js<Bs.length;Js++){var Fa=Bs[Js];Wa.has(Fa.name)||(Pa.push(Fa),Wa.add(Fa.name))}var ff=function(dc){ks[dc]==null&&(ks[dc]=new Set),_l[dc].forEach(function(ns){return ks[dc].add(ns)})};for(var _u in _l)ff(_u)}return{sorted:Pa,recipientCounts:function(dc){var ns={};for(var Bu in dc)ns[Bu]=dc[Bu].size;return ns}(ks)}}(Je,Q);Vn=br.sorted,rr=br.recipientCounts,Fh[Yn]=Vn,Zc[Yn]=rr}Vn=Fh[Yn],rr={},oe||Object.assign(rr,Zc[Yn]);for(var xr=new Oa(Q),Lr=0;Lr<Vn.length;++Lr){if(R!=null){var Hr=Object(g.memory)().numTensors;Hr>R.maxNumTensors&&(R.maxNumTensors=Hr),Hr<R.minNumTensors&&(R.minNumTensors=Hr)}var yi=Vn[Lr],zr=yi.sourceLayer;if(!(zr instanceof wc)){for(var li=[],pi=[],Pi=[],qi=!1,bi=0,Oi=yi.inputs;bi<Oi.length;bi++){var Vo=Oi[bi],qo=xr.getValue(Vo),Ia=xr.getMask(Vo);li.push(qo),pi.push(Ia),Ia!=null&&(qi=!0),oe||(rr[Vo.name]--,rr[Vo.name]!==0||Q.hasKey(Vo)||vt.indexOf(Vo.name)!==-1||qo.isDisposed||Vo.sourceLayer.stateful===!0||Pi.push(qo))}qi&&((C=C||{}).mask=pi[0]);var Ao=Oe(zr.apply(li,C)),Ho=null;zr.supportsMasking&&(Ho=zr.computeMask(li,pi));for(var zo=Tu(yi),Sa=Array.isArray(zo)?zo:[zo],Xa=0;Xa<Sa.length;++Xa){xr.hasKey(Sa[Xa])||xr.add(Sa[Xa],Ao[Xa],Array.isArray(Ho)?Ho[0]:Ho);var Zi=vt.indexOf(Sa[Xa].name);Zi!==-1&&(qt[Zi]=Ao[Xa])}oe||Object(g.dispose)(Pi)}}return xr.disposeMasks(),Ue?qt:qt[0]}function Xd(re,Q){for(var C=new Set,R=[],oe={},Ue=0,Je=Q.names();Ue<Je.length;Ue++){var vt=Je[Ue];C.add(vt)}var qt=[],Jt=[];for(qt.push(re);qt.length>0;){var pt=qt[qt.length-1];if(C.has(pt.name))qt.pop();else{var Nn=Jt[Jt.length-1]===qt.length-1;if(pt.inputs.length===0||Nn)qt.pop(),R.push(pt),C.add(pt.name),Nn&&Jt.pop();else{Jt.push(qt.length-1);for(var Pn=0,Vn=pt.inputs;Pn<Vn.length;Pn++){var rr=Vn[Pn];oe[rr.name]==null&&(oe[rr.name]=new Set),oe[rr.name].add(pt.name),C.has(rr.name)||qt.push(rr)}}}}return{sorted:R,recipientMap:oe}}function Tu(re){var Q;if(re.sourceLayer.inboundNodes.length===1)Q=re.sourceLayer.output;else{for(var C=null,R=0;R<re.sourceLayer.inboundNodes.length;++R)for(var oe=0,Ue=re.sourceLayer.inboundNodes[R].outputTensors;oe<Ue.length;oe++)if(Ue[oe].id===re.id){C=R;break}Q=re.sourceLayer.getOutputAt(C)}return Q}function Tl(re,Q){return function(C,R,oe){var Ue=R.length;if(C==null||Array.isArray(C)&&C.length===0)return R.map(function(vt){return null});if(Ue===1)return Array.isArray(C)&&C.length===1?C:typeof C=="object"&&R[0]in C?[C[R[0]]]:[C];if(Array.isArray(C)){if(C.length!==Ue)throw new Error("Provided "+oe+" is an array of "+C.length+" element(s), but the model has "+Ue+" outputs. Make sure a set of weights is provided for each model output.");return C}if(typeof C=="object"&&Object.keys(C).length>0&&typeof C[Object.keys(C)[0]]=="object"){var Je=[];return R.forEach(function(vt){vt in C?Je.push(C[vt]):Je.push(null)}),Je}throw new Error("The model has multiple ("+Ue+") outputs, so "+oe+" must be either an array with "+Ue+" elements or an object with "+R+" keys. Provided "+oe+" not understood: "+JSON.stringify(C))}(re,Q,"classWeight")}function Yd(re,Q,C,R){return K(this,void 0,void 0,function(){var oe,Ue,Je,vt,qt;return M(this,function(Jt){switch(Jt.label){case 0:if(Q!=null||R!=null)throw new Error("Support sampleWeight is not implemented yet");return C==null?[3,2]:(oe=Object(g.tidy)(function(){if(re.shape.length===1)return re.clone();if(re.shape.length===2){if(re.shape[1]>1)return re.argMax(1);if(re.shape[1]===1)return re.reshape([re.shape[0]]);throw new Error("Encountered unexpected last-dimension size ("+re.shape[1]+") during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor ("+re.rank+") during handling of class weights. The rank is expected to be 1 or 2.")}),vt=(Je=Array).from,[4,oe.data()]);case 1:return Ue=vt.apply(Je,[Jt.sent()]),Object(g.dispose)(oe),qt=[],Ue.forEach(function(pt){if(C[pt]==null)throw new Error("classWeight must contain all classes in the training data. The class "+pt+" exists in the data but not in classWeight");qt.push(C[pt])}),[2,Object(g.tensor1d)(qt,"float32")];case 2:return[2,null]}})})}function Up(re,Q){return Object(g.mul)(re,Q)}var Ec=32;function Sg(re,Q){var C,R,oe=Q;C=oe.xs,R=oe.ys,g.util.assert(C!=null&&R!=null,function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+Q});var Ue=el("input",re.inputNames,C),Je=el("output",re.outputNames,R),vt=Ue[0].shape[0];g.util.assert(Ue.length===re.inputs.length,function(){return"LayersModel has "+re.inputs.length+" inputs, but the dataset provides "+Ue.length+" inputs.  (Expected input keys: "+JSON.stringify(re.inputNames)+")"}),g.util.assert(Je.length===re.outputs.length,function(){return"LayersModel has "+re.outputs.length+" outputs, but the dataset provides "+Je.length+" outputs.  (Expected output keys: "+JSON.stringify(re.outputNames)+")"});for(var qt=function(Pn){g.util.assert(Ue[Pn].shape[0]===vt,function(){return"Batch size mismatch: input "+re.inputNames[Pn]+" has "+Ue[Pn].shape[0]+"; expected  "+vt+" based on input "+re.inputNames[0]+"."})},Jt=0;Jt<Ue.length;Jt++)qt(Jt);for(var pt=function(Pn){g.util.assert(Je[Pn].shape[0]===vt,function(){return"Batch size mismatch: output "+re.outputNames[Pn]+" has "+Je[Pn].shape[0]+"; expected  "+vt+" based on input "+re.inputNames[0]+"."})},Nn=0;Nn<Je.length;Nn++)pt(Nn);return{xs:Ue,ys:Je}}function el(re,Q,C){if(C instanceof g.Tensor)return[C];if(Array.isArray(C))return g.util.assert(C.length===Q.length,function(){return"Received an array of "+C.length+" Tensors, but expected "+Q.length+" to match the "+re+" keys "+Q+"."}),C;for(var R=[],oe=0,Ue=Q;oe<Ue.length;oe++){var Je=Ue[oe];if(C[Je]==null)throw new te("The feature data generated by the dataset lacks the required "+re+" key '"+Je+"'.");R.push(C[Je])}return R}function Jf(re,Q,C){return K(this,void 0,void 0,function(){var R,oe,Ue,Je,vt,qt,Jt,pt,Nn,Pn,Vn,rr,Yn,br,xr,Lr,Hr,yi,zr,li,pi,Pi,qi,bi,Oi,Vo,qo,Ia,Ao,Ho,zo,Sa,Xa,Zi;return M(this,function(co){switch(co.label){case 0:if(R=C.batchesPerEpoch!=null,g.util.assert(re.optimizer!=null,function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."}),g.util.assert(C!=null,function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."}),g.util.assert(C.epochs!=null&&C.epochs>0&&Number.isInteger(C.epochs),function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got "+C.epochs}),g.util.assert(!R||C.batchesPerEpoch>0&&Number.isInteger(C.batchesPerEpoch),function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+C.batchesPerEpoch}),g.util.assert(C.validationSplit==null,function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."}),re.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");re.isTraining=!0,co.label=1;case 1:return co.trys.push([1,,26,27]),oe=C.validationData!=null,Ue=void 0,Je=void 0,oe&&($s(C.validationData)?g.util.assert(C.validationBatches==null||C.validationBatches>0&&Number.isInteger(C.validationBatches),function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+C.validationBatches}):(vt=function(Jo){if(Jo.length===3)throw new F("Validation with sample weights is not implemented yet.");return{xs:Jo[0],ys:Jo[1]}}(C.validationData),Ue=vt.xs,Je=vt.ys)),qt=re.makeTrainFunction(),Jt=re.getDedupedMetricsNames(),pt=void 0,pt=oe?Jt.slice().concat(Jt.map(function(Jo){return"val_"+Jo})):Jt.slice(),Nn=pl(C.callbacks,C.yieldEvery),Pn=C.verbose==null?1:C.verbose,Vn=Gc(Nn,Pn,C.epochs,null,null,function(Jo,Pa){var ks=null;return Pa.batchesPerEpoch!=null?ks=Pa.batchesPerEpoch:Number.isFinite(Jo.size)&&(ks=Jo.size),ks}(Q,C),null,oe,pt),rr=Vn.callbackList,Yn=Vn.history,rr.setModel(re),re.history=Yn,[4,rr.onTrainBegin()];case 2:return co.sent(),re.stopTraining_=!1,br=C.initialEpoch==null?0:C.initialEpoch,[4,Q.iterator()];case 3:xr=co.sent(),co.label=4;case 4:return br<C.epochs?(Lr={},[4,rr.onEpochBegin(br)]):[3,23];case 5:return co.sent(),Hr=0,yi=0,R?[3,7]:[4,Q.iterator()];case 6:xr=co.sent(),co.label=7;case 7:return!R||Hr<C.batchesPerEpoch?[4,xr.next()]:[3,21];case 8:return zr=co.sent(),R&&zr.done?(console.warn("You provided `batchesPerEpoch` as "+C.batchesPerEpoch+", but your dataset iterator ran out of data after "+Hr+" batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+C.batchesPerEpoch*C.epochs+" batches). You may need to use the repeat() function when building your dataset."),[3,21]):zr.value==null?[3,15]:(li=Sg(re,zr.value),pi=li.xs,Pi=li.ys,(qi={}).batch=yi,qi.size=pi[0].shape[0],[4,rr.onBatchBegin(yi,qi)]);case 9:if(co.sent(),bi=[],C.classWeight==null)return[3,13];Oi=Tl(C.classWeight,re.outputNames),Zi=0,co.label=10;case 10:return Zi<Oi.length?(qo=(Vo=bi).push,[4,Yd(Pi[Zi],null,Oi[Zi])]):[3,13];case 11:qo.apply(Vo,[co.sent()]),co.label=12;case 12:return++Zi,[3,10];case 13:for(Ia=pi.concat(Pi).concat(bi),Ao=qt(Ia),Object(g.dispose)(Ia),Zi=0;Zi<Jt.length;++Zi)Ho=Jt[Zi],zo=Ao[Zi],qi[Ho]=zo,Object(g.keep)(zo);return[4,rr.onBatchEnd(yi,qi)];case 14:co.sent(),ws(qi),yi++,Hr++,co.label=15;case 15:return(R?Hr>=C.batchesPerEpoch:zr.done)?oe?(Sa=void 0,$s(C.validationData)?(Xa=Oe,[4,re.evaluateDataset(C.validationData,{batches:C.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return Sa=Xa.apply(void 0,[co.sent()]),[3,18];case 17:Sa=Oe(re.evaluate(Ue,Je,{batchSize:C.validationBatchSize==null?Ec:C.validationBatchSize,verbose:0})),co.label=18;case 18:for(Zi=0;Zi<re.metricsNames.length;++Zi)Lr["val_"+re.metricsNames[Zi]]=Sa[Zi];co.label=19;case 19:return[3,21];case 20:return re.stopTraining_?[3,21]:[3,7];case 21:return[4,rr.onEpochEnd(br,Lr)];case 22:return co.sent(),br++,re.stopTraining_?[3,23]:[3,4];case 23:return[4,rr.onTrainEnd()];case 24:return co.sent(),[4,re.history.syncData()];case 25:return co.sent(),[2,re.history];case 26:return re.isTraining=!1,[7];case 27:return[2]}})})}function $s(re){return typeof re.iterator=="function"}function gl(re){g.util.assert(re>0&&Number.isInteger(re),function(){return"batchSize is required to be a positive integer, but got "+re})}function Ze(re,Q,C){return re==null?[null]:Array.isArray(re)?re.map(function(R){return wi(R,Q,C-Q)}):wi(re,Q,C-Q)}function tl(re,Q){return Object(g.tidy)(function(){return re==null?null:Array.isArray(re)?re.map(function(C){return tl(C,Q)}):mo(re,Q.dtype==="int32"?Q:Q.toInt())})}function es(re,Q){for(var C=[],R=0,oe=null;R<re;)(oe=R+Q)>=re&&(oe=re),C.push([R,oe]),R=oe;return C}function Nl(re,Q,C,R){return R===void 0&&(R={}),K(this,void 0,void 0,function(){var oe,Ue,Je,vt,qt,Jt,pt,Nn,Pn,Vn,rr,Yn,br,xr,Lr,Hr,yi,zr,li,pi,Pi,qi;return M(this,function(bi){switch(bi.label){case 0:if(re.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");re.isTraining=!0,bi.label=1;case 1:return bi.trys.push([1,,7,8]),gl(Nn=R.batchSize==null?32:R.batchSize),Pn=!1,[4,re.standardizeUserData(Q,C,R.sampleWeight,R.classWeight,Pn,Nn)];case 2:if(Vn=bi.sent(),oe=Vn[0],Ue=Vn[1],pt=Vn[2],rr=!1,Yn=void 0,!(R.validationData!=null&&R.validationData.length>0))return[3,4];if(rr=!0,R.validationData.length!==2)throw R.validationData.length===3?new F("validationData including sample weights is not supported yet."):new te("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+R.validationData+" is invalid.");return Je=R.validationData[0],vt=R.validationData[1],br=!0,[4,re.standardizeUserData(Je,vt,null,null,br,Nn)];case 3:return xr=bi.sent(),qt=xr[0],Jt=xr[1],Yn=qt.concat(Jt),[3,5];case 4:R.validationSplit!=null&&R.validationSplit>0&&R.validationSplit<1?(rr=!0,Lr=Math.floor(oe[0].shape[0]*(1-R.validationSplit)),Hr=oe[0].shape[0],qt=Ze(oe,Lr,Hr),oe=Ze(oe,0,Lr),Jt=Ze(Ue,Lr,Hr),Ue=Ze(Ue,0,Lr),Yn=qt.concat(Jt)):R.validationSteps!=null&&(rr=!0),bi.label=5;case 5:return yi=oe.concat(Ue).concat(pt),re.checkTrainableWeightsConsistency(),zr=re.makeTrainFunction(),li=re.getDedupedMetricsNames(),pi=void 0,Pi=void 0,rr?(re.makeTestFunction(),pi=re.testFunction,Pi=li.slice().concat(li.map(function(Oi){return"val_"+Oi}))):(pi=null,Yn=[],Pi=li.slice()),qi=pl(R.callbacks,R.yieldEvery),[4,function(Oi,Vo,qo,Ia,Ao,Ho,zo,Sa,Xa,Zi,co,Jo,Pa,ks,Qo){return K(this,void 0,void 0,function(){var Wa,ku,Cs,fa,_s,_l,Js,Bs;return M(this,function(Fa){switch(Fa.label){case 0:if(Ao==null&&(Ao=32),Ho==null&&(Ho=1),co==null&&(co=!0),Pa==null&&(Pa=0),Wa=!1,Xa!=null&&Zi!=null&&(Wa=!0),Qo!=null&&(Wa=!0,ks==null))throw new te("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return(ku=Oi.checkNumSamples(qo,Ao,ks,"steps_per_epoch"))!=null&&(Cs=Fr(0,ku)),zo==null&&(zo=1),fa=Gc(Sa,zo,Ho,Pa,ku,ks,Ao,Wa,Jo),_s=fa.callbackList,_l=fa.history,_s.setModel(Oi),Oi.history=_l,[4,_s.onTrainBegin()];case 1:Fa.sent(),Oi.stopTraining_=!1,Js=function(ff){var _u,dc,ns,Bu,Da;return M(this,function(Qu){switch(Qu.label){case 0:return[4,_s.onEpochBegin(ff)];case 1:if(Qu.sent(),_u={},ks==null)return[3,2];throw new F("stepsPerEpoch mode is not implemented yet.");case 2:if(co==="batch")throw new F("batch shuffling is not implemneted yet");co&&g.util.shuffle(Cs),dc=Object(g.tensor1d)(Cs),ns=es(ku,Ao),Bu=function(Pu){var Zo;return M(this,function(Lu){switch(Lu.label){case 0:return Zo={},[4,_s.onBatchBegin(Pu,Zo)];case 1:return Lu.sent(),Object(g.tidy)(function(){var Qs=ns[Pu][0],Dc=ns[Pu][1],Ll=wi(dc,Qs,Dc-Qs);Zo.batch=Pu,Zo.size=Dc-Qs;for(var Va=tl(qo,Ll),hu=Vo(Va),Ps=0;Ps<Ia.length;++Ps){var rl=Ia[Ps],ah=hu[Ps];Zo[rl]=ah,Object(g.keep)(ah)}if(Pu===ns.length-1&&Wa){var Wi=Oi.testLoop(Xa,Zi,Ao);for(Ps=0;Ps<Ia.length;++Ps)rl=Ia[Ps],ah=Wi[Ps],Object(g.keep)(ah),_u["val_"+rl]=ah}}),[4,_s.onBatchEnd(Pu,Zo)];case 2:return Lu.sent(),ws(Zo),Oi.stopTraining_?[2,"break"]:[2]}})},Da=0,Qu.label=3;case 3:return Da<ns.length?[5,Bu(Da)]:[3,6];case 4:if(Qu.sent()==="break")return[3,6];Qu.label=5;case 5:return++Da,[3,3];case 6:dc.dispose(),Qu.label=7;case 7:return[4,_s.onEpochEnd(ff,_u)];case 8:return Qu.sent(),Oi.stopTraining_?[2,"break"]:[2]}})},Bs=Pa,Fa.label=2;case 2:return Bs<Ho?[5,Js(Bs)]:[3,5];case 3:if(Fa.sent()==="break")return[3,5];Fa.label=4;case 4:return++Bs,[3,2];case 5:return[4,_s.onTrainEnd()];case 6:return Fa.sent(),[4,Oi.history.syncData()];case 7:return Fa.sent(),[2,Oi.history]}})})}(re,zr,yi,li,Nn,R.epochs,R.verbose,qi,pi,Yn,R.shuffle,Pi,R.initialEpoch,null,null)];case 6:return[2,bi.sent()];case 7:return re.isTraining=!1,Ea(oe,Q),Ea(Ue,C),Ea(qt,Je),Ea(Jt,vt),pt!=null&&Object(g.dispose)(pt),[7];case 8:return[2]}})})}function pa(re){var Q=[];re instanceof g.Tensor&&(re=[re]);for(var C=0;C<re.length;++C){var R=re[C];if(R.rank===1)Q.push(Br(R,1));else{if(R.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");Q.push(R)}}return Q}function Ea(re,Q){if(re!=null){var C=[];if(Q instanceof g.Tensor)C.push(Q.id);else if(Array.isArray(Q))Q.forEach(function(qt){return C.push(qt.id)});else if(Q!=null)for(var R in Q){var oe=Q[R];C.push(oe.id)}var Ue=[];if(re instanceof g.Tensor)C.indexOf(re.id)===-1&&Ue.push(re);else if(Array.isArray(re))re.forEach(function(qt){C.indexOf(qt.id)===-1&&Ue.push(qt)});else if(re!=null)for(var Je in re){var vt=re[Je];C.indexOf(vt.id)===-1&&Ue.push(vt)}Ue.forEach(function(qt){qt.isDisposed||qt.dispose()})}}function La(re){return Array.isArray(re)}function Fs(re){return!function(Q){return Q instanceof g.Tensor}(re)&&!La(re)}function vl(re,Q,C,R,oe){if(R===void 0&&(R=!0),oe===void 0&&(oe=""),Q==null||Q.length===0){if(re!=null){var Ue=!1;if(La(re)&&re.length>0)Ue=!0;else if(Fs(re)){for(var Je in re)if(re.hasOwnProperty(Je)){Ue=!0;break}}else Ue=!0;if(Ue)throw new te("Error when checking model "+oe+" expected no data, but got "+re)}return[]}if(re==null)return Q.map(function(br){return null});var vt;if(Fs(re)){re=re,vt=[];for(var qt=0,Jt=Q;qt<Jt.length;qt++){var pt=Jt[qt];if(re[pt]==null)throw new te('No data provided for "'+pt+'". Need data for each key in: '+Q);vt.push(re[pt])}}else if(La(re)){if((re=re).length!==Q.length)throw new te("Error when checking model "+oe+": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see "+Q.length+" Tensor(s), but instead got the following list of Tensor(s): "+re);vt=re}else{if(re=re,Q.length>1)throw new te("The model "+oe+" expects "+Q.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+re.shape);vt=[re]}if(vt=pa(vt),C!=null){for(var Nn=0;Nn<Q.length;++Nn)if(C[Nn]!=null){var Pn=vt[Nn];if(Pn.shape.length!==C[Nn].length)throw new te("Error when checking "+oe+": expected "+Q[Nn]+" to have "+C[Nn].length+" dimension(s). but got array with shape "+Pn.shape);for(var Vn=0;Vn<C[Nn].length;++Vn)if(Vn!==0||R){var rr=Pn.shape[Vn],Yn=C[Nn][Vn];if(Yn!=null&&Yn>=0&&rr!==Yn)throw new te("Error when checking "+oe+": expected "+Q[Nn]+" to have shape ["+C[Nn]+"], but got array with shape ["+Pn.shape+"].")}}}return vt}function Rs(re,Q,C,R,oe){var Ue;if(R===void 0&&(R=!0),oe===void 0&&(oe=""),Array.isArray(re)){if(re.length!==Q.length)throw new te("Error when checking model "+oe+": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see "+Q.length+" Tensor(s), but instead got "+re.length+" Tensors(s).");Ue=re}else{if(Q.length>1)throw new te("The model expects "+Q.length+" "+oe+" Tensors, but only received one Tensor. Found: array with shape "+JSON.stringify(re.shape)+".");Ue=[re]}if(C!=null){for(var Je=0;Je<Q.length;++Je)if(C[Je]!=null){var vt=Ue[Je];if(vt.shape.length!==C[Je].length)throw new te("Error when checking "+oe+": expected "+Q[Je]+" to have "+C[Je].length+" dimension(s), but got array with shape "+JSON.stringify(vt.shape));for(var qt=0;qt<C[Je].length;++qt)if(qt!==0||R){var Jt=vt.shape[qt],pt=C[Je][qt];if(pt!=null&&pt!==Jt)throw new te("Error when checking "+oe+": expected "+Q[Je]+" to have shape "+JSON.stringify(C[Je])+" but got array with shape "+JSON.stringify(vt.shape)+".")}}}}var tf=function(re){function Q(C){var R=re.call(this,C)||this;return R.isTraining=!1,R}return I(Q,re),Q.prototype.summary=function(C,R,oe){if(oe===void 0&&(oe=console.log),!this.built)throw new te("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Qc(this,C,R,oe)},Q.prototype.compile=function(C){var R=this;if(C.loss==null&&(C.loss=[]),this.loss=C.loss,typeof C.optimizer=="string")this.optimizer_=function(br){var xr={Adagrad:function(){return g.train.adagrad(.01)},Adadelta:function(){return g.train.adadelta(1,.95,V())},Adam:function(){return g.train.adam(.001,.9,.999,V())},Adamax:function(){return g.train.adamax(.002,.9,.999,V(),0)},RMSProp:function(){return g.train.rmsprop(.001,.9,0,V())},SGD:function(){return g.train.sgd(.01)}};if(xr.adagrad=xr.Adagrad,xr.adadelta=xr.Adadelta,xr.adam=xr.Adam,xr.adamax=xr.Adamax,xr.rmsprop=xr.RMSProp,xr.sgd=xr.SGD,br in xr)return xr[br]();throw new te("Unknown Optimizer "+br)}(C.optimizer),this.isOptimizerOwned=!0;else{if(!(C.optimizer instanceof g.Optimizer))throw new te("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=C.optimizer,this.isOptimizerOwned=!1}var oe=[];if(Array.isArray(C.loss)||typeof C.loss=="string"||typeof C.loss=="function")if(Array.isArray(C.loss)){if(C.loss.length!==this.outputs.length)throw new te("When passing an Array as loss, it should have one entry per model output. The model has "+this.outputs.length+" output(s), but you passed loss="+C.loss+".");var Ue=C.loss;oe=Ue.map(function(br){return ps(br)})}else{var Je=ps(C.loss);this.outputs.forEach(function(br){oe.push(Je)})}else{for(var vt in C.loss=C.loss,C.loss)if(this.outputNames.indexOf(vt)===-1)throw new te('Unknown entry in loss dictionary: "'+vt+'". Only expected the following keys: '+this.outputNames);for(var qt=0,Jt=this.outputNames;qt<Jt.length;qt++){var pt=Jt[qt];C.loss[pt]==null&&console.warn('Output "'+pt+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to '+pt+" during training"),oe.push(ps(C.loss[pt]))}}this.lossFunctions=oe,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var Nn=0;Nn<this.outputs.length;++Nn){var Pn=this.internalOutputShapes[Nn],Vn=this.outputNames[Nn];this.feedOutputNames.push(Vn),this.feedOutputShapes.push(Pn),this.feedLossFns.push(this.lossFunctions[Nn])}var rr=[];this.metrics=C.metrics,this.metricsNames=["loss"],this.metricsTensors=[],lr("loss",function(){for(var br=0;br<R.outputs.length;++br)if(rr.indexOf(br)===-1){var xr=R.lossFunctions[br];R.outputs.length>1&&(R.metricsTensors.push([xr,br]),R.metricsNames.push(R.outputNames[br]+"_loss"))}});var Yn=function(br,xr){if(br==null||Array.isArray(br)&&br.length===0)return xr.map(function(Pi){return[]});var Lr;if(typeof br=="string"||typeof br=="function")Lr=[br];else{if(!Array.isArray(br)&&typeof br!="object")throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: "+br);Lr=br}if(Array.isArray(Lr))return xr.map(function(Pi){return Lr});for(var Hr=[],yi=0,zr=xr;yi<zr.length;yi++){var li=zr[yi],pi=Lr.hasOwnProperty(li)?Lr[li]:[];Array.isArray(pi)||(pi=[pi]),Hr.push(pi)}return Hr}(C.metrics,this.outputNames);lr("metric",function(){for(var br=function(Lr){if(rr.indexOf(Lr)!==-1)return"continue";(function(Hr){for(var yi,zr,li,pi=function(bi){if(typeof bi=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(bi)!==-1){var Oi=R.internalOutputShapes[Lr];Oi[Oi.length-1]===1||R.lossFunctions[Lr]===ac?["accuracy","acc"].indexOf(bi)!==-1?zr=ef:["crossentropy","ce"].indexOf(bi)!==-1&&(zr=Of):R.lossFunctions[Lr]===jc?["accuracy","acc"].indexOf(bi)!==-1?zr=da:["crossentropy","ce"].indexOf(bi)!==-1&&(zr=xi):["accuracy","acc"].indexOf(bi)!==-1?zr=Yc:["crossentropy","ce"].indexOf(bi)!==-1&&(zr=Qi);var Vo=void 0;["accuracy","acc"].indexOf(bi)!==-1?Vo="acc":["crossentropy","ce"].indexOf(bi)!==-1&&(Vo="ce"),li=zr,yi=""+Vo}else{var qo=function(Ao){if(typeof Ao=="string"&&Ao in hr)return hr[Ao];if(typeof Ao!="string"&&Ao!=null)return Ao;throw new te("Unknown metric "+Ao)}(bi);li=qo,yi=""+is(bi)}var Ia;lr(yi,function(){Ia=li}),function(Ao,Ho,zo){R.outputNames.length>1&&(Ho=R.outputNames[Ao]+"_"+Ho),R.metricsNames.push(Ho),R.metricsTensors.push([zo,Ao])}(Lr,yi,Ia)},Pi=0,qi=Yn[Lr];Pi<qi.length;Pi++)pi(qi[Pi])})()},xr=0;xr<R.outputs.length;++xr)br(xr)}),this.collectedTrainableWeights=this.trainableWeights},Q.prototype.checkTrainableWeightsConsistency=function(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},Q.prototype.evaluate=function(C,R,oe){oe===void 0&&(oe={});var Ue=oe.batchSize==null?32:oe.batchSize;gl(Ue);var Je=this.standardizeUserDataXY(C,R,!0,Ue);try{var vt=Je[0].concat(Je[1]);this.makeTestFunction();var qt=this.testFunction;return pe(this.testLoop(qt,vt,Ue,oe.verbose,oe.steps))}finally{Ea(Je[0],C),Ea(Je[1],R)}},Q.prototype.evaluateDataset=function(C,R){return K(this,void 0,void 0,function(){return M(this,function(oe){return this.makeTestFunction(),[2,function(Ue,Je,vt){return K(this,void 0,void 0,function(){var qt,Jt,pt,Nn,Pn,Vn,rr,Yn,br,xr;return M(this,function(Lr){switch(Lr.label){case 0:if(qt=(vt=vt||{}).batches!=null,Jt=Ue.testFunction,pt=[],vt.verbose>0)throw new F("Verbose mode is not implemented yet.");return g.util.assert(!qt||vt.batches>0&&Number.isInteger(vt.batches),function(){return"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(vt.batches)}),function(Hr){return typeof Hr.next=="function"}(Je)?(Pn=Je,[3,3]):[3,1];case 1:return[4,Je.iterator()];case 2:Pn=Lr.sent(),Lr.label=3;case 3:Nn=Pn,Vn=0,rr=0,Yn=function(){var Hr;return M(this,function(yi){switch(yi.label){case 0:return[4,Nn.next()];case 1:return Hr=yi.sent(),pt=Object(g.tidy)(function(){if(Hr.value){var zr=Sg(Ue,Hr.value),li=zr.xs,pi=zr.ys,Pi=li.concat(pi),qi=Object(g.tidy)(function(){return Jt(Pi)});if(Object(g.dispose)(Pi),rr===0)for(var bi=0;bi<qi.length;++bi)pt.push(Object(g.scalar)(0));var Oi=Pi[0].shape[0],Vo=function(qo){var Ia=qi[qo],Ao=pt[qo];pt[qo]=Object(g.tidy)(function(){return Object(g.add)(pt[qo],Object(g.mul)(Oi,Ia))}),rr>0&&Object(g.dispose)(Ao)};for(bi=0;bi<qi.length;++bi)Vo(bi);Object(g.dispose)(qi),Vn+=Oi,++rr}return pt}),Hr.done?(qt&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, "+vt.batches+" batches). You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},Lr.label=4;case 4:return!qt||rr<vt.batches?[5,Yn()]:[3,6];case 5:return Lr.sent()==="break"?[3,6]:[3,4];case 6:for(br=0;br<pt.length;++br)xr=pt[br],pt[br]=Object(g.div)(pt[br],Vn),Object(g.dispose)(xr);return[2,pe(pt)]}})})}(this,C,R)]})})},Q.prototype.checkNumSamples=function(C,R,oe,Ue){var Je;if(Ue===void 0&&(Ue="steps"),oe!=null){if(Je=null,R!=null)throw new te("If "+Ue+" is set, batchSize must be null or undefined.Got batchSize = "+R)}else{if(C==null)throw new te("Either the input data should have a defined shape, or "+Ue+" shoud be specified.");Je=Array.isArray(C)?C[0].shape[0]:C.shape[0]}return Je},Q.prototype.execute=function(C,R){if(Array.isArray(R)&&R.length===0)throw new te("`outputs` is an empty Array, which is not allowed.");var oe=Array.isArray(R),Ue=oe?R:[R],Je=this.retrieveSymbolicTensors(Ue),vt=new Oa;if(C instanceof g.Tensor&&(C=[C]),Array.isArray(C)){if(C.length!==this.inputs.length)throw new te("The number of inputs provided ("+C.length+") does not match the number of inputs of this model ("+this.inputs.length+").");for(var qt=0;qt<this.inputs.length;++qt)vt.add(this.inputs[qt],C[qt])}else for(var Jt=0,pt=this.inputs;Jt<pt.length;Jt++){var Nn=pt[Jt],Pn=C[Nn.name];if(Pn==null)throw new te("No value is provided for the model's input "+Nn.name);vt.add(Nn,Pn)}var Vn=Rh(Je,vt);return oe?Vn:Vn[0]},Q.prototype.retrieveSymbolicTensors=function(C){for(var R=se(null,C.length),oe=C.length,Ue=0,Je=this.layers;Ue<Je.length;Ue++){for(var vt=Je[Ue],qt=Array.isArray(vt.output)?vt.output:[vt.output],Jt=qt.map(function(Vn){return Vn.name}),pt=0;pt<C.length;++pt){var Nn=Jt.indexOf(C[pt]);if(Nn!==-1&&(R[pt]=qt[Nn],oe--),oe===0)break}if(oe===0)break}if(oe>0){var Pn=[];throw R.forEach(function(Vn,rr){Vn==null&&Pn.push(C[rr])}),new te("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(Pn))}return R},Q.prototype.predictLoop=function(C,R,oe){var Ue=this;return R===void 0&&(R=32),oe===void 0&&(oe=!1),Object(g.tidy)(function(){var Je=Ue.checkNumSamples(C);if(oe)throw new F("Verbose predictLoop() is not implemented yet.");for(var vt=es(Je,R),qt=Ue.outputs.map(function(Nn){return[]}),Jt=function(Nn){Object(g.tidy)(function(){var Pn=vt[Nn][0],Vn=vt[Nn][1],rr=Ze(C,Pn,Vn),Yn=[];if(Array.isArray(rr))for(var br=0;br<rr.length;++br)Yn.push({key:Ue.inputs[br],value:rr[br]});else Yn.push({key:Ue.inputs[0],value:rr});var xr=new Oa(Yn);return Rh(Ue.outputs,xr)}).forEach(function(Pn,Vn){return qt[Vn].push(Pn)})},pt=0;pt<vt.length;++pt)Jt(pt);return pe(qt.map(function(Nn){return Object(g.concat)(Nn,0)}))})},Q.prototype.predict=function(C,R){R===void 0&&(R={});var oe=pa(C);Rs(oe,this.inputNames,this.feedInputShapes,!1);try{var Ue=R.batchSize==null?32:R.batchSize;return gl(Ue),this.predictLoop(oe,Ue)}finally{Ea(oe,C)}},Q.prototype.predictOnBatch=function(C){Rs(C,this.inputNames,this.feedInputShapes,!0);var R=(Array.isArray(C)?C[0]:C).shape[0];return this.predictLoop(C,R)},Q.prototype.standardizeUserDataXY=function(C,R,oe,Ue){if(this.optimizer_==null)throw new W("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var Je=[],vt=0;vt<this.feedOutputShapes.length;++vt){var qt=this.feedOutputShapes[vt];this.feedLossFns[vt]===jc?Je.push(qt.slice(0,qt.length-1).concat([1])):Je.push(qt)}if(function(Jt,pt,Nn){var Pn=tn(Jt.map(function(rr){return rr.shape[0]}));Pn.sort();var Vn=tn(pt.map(function(rr){return rr.shape[0]}));if(Vn.sort(),Pn.length>1)throw new te("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(Jt.map(function(rr){return rr.shape})));if(Vn.length>1)throw new te("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(pt.map(function(rr){return rr.shape})));if(Pn.length>0&&Vn.length>0&&!g.util.arraysEqual(Pn,Vn))throw new te("Input Tensors should have the same number of samples as target Tensors. Found "+Pn[0]+" input sample(s) and "+Vn[0]+" target sample(s).")}(C=vl(C,this.feedInputNames,this.feedInputShapes,!1,"input"),R=vl(R,this.feedOutputNames,Je,!1,"target")),function(Jt,pt,Nn){for(var Pn=[Ga,ac,Ba],Vn=0;Vn<Jt.length;++Vn){var rr=Jt[Vn],Yn=pt[Vn],br=Nn[Vn];if(Yn!=null){if(Yn===Ba&&rr.shape[rr.shape.length-1]===1)throw new te("You are passing a target array of shape "+rr.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(Pn.indexOf(Yn)!==-1)for(var xr=rr.shape.slice(1),Lr=br.slice(1),Hr=0;Hr<xr.length;++Hr){var yi=xr[Hr],zr=Lr[Hr];if(zr!=null&&yi!==zr)throw new te("A target Tensor with shape "+rr.shape+" was passed for an output of shape "+br+", while using a loss function that expects targets to have the same shape as the output.")}}}}(R,this.feedLossFns,this.feedOutputShapes),this.stateful&&Ue!=null&&Ue>0&&C[0].shape[0]%Ue!=0)throw new te("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+Ue+". Found: "+C[0].shape[0]+" sample(s).");return[C,R]},Q.prototype.standardizeUserData=function(C,R,oe,Ue,Je,vt){return Je===void 0&&(Je=!0),K(this,void 0,void 0,function(){var qt,Jt,pt,Nn,Pn,Vn,rr,Yn;return M(this,function(br){switch(br.label){case 0:if(qt=this.standardizeUserDataXY(C,R,Je,vt),Jt=qt[0],pt=qt[1],oe!=null)throw new Error("sample weight is not supported yet.");if(Nn=null,Ue==null)return[3,4];Pn=Tl(Ue,this.outputNames),Nn=[],Vn=0,br.label=1;case 1:return Vn<Pn.length?(Yn=(rr=Nn).push,[4,Yd(pt[Vn],null,Pn[Vn])]):[3,4];case 2:Yn.apply(rr,[br.sent()]),br.label=3;case 3:return++Vn,[3,1];case 4:return[2,[Jt,pt,Nn]]}})})},Q.prototype.testLoop=function(C,R,oe,Ue,Je){var vt=this;return Ue===void 0&&(Ue=0),Object(g.tidy)(function(){var qt=vt.checkNumSamples(R,oe,Je,"steps"),Jt=[];if(Ue>0)throw new F("Verbose mode is not implemented yet.");if(Je!=null)throw new F("steps mode in testLoop() is not implemented yet");for(var pt=es(qt,oe),Nn=Object(g.tensor1d)(Fr(0,qt)),Pn=0;Pn<pt.length;++Pn){var Vn=pt[Pn][0],rr=pt[Pn][1],Yn=wi(Nn,Vn,rr-Vn),br=tl(R,Yn),xr=C(br);if(Pn===0)for(var Lr=0;Lr<xr.length;++Lr)Jt.push(Object(g.scalar)(0));for(Lr=0;Lr<xr.length;++Lr){var Hr=xr[Lr];Jt[Lr]=Object(g.add)(Jt[Lr],Object(g.mul)(rr-Vn,Hr))}}for(Lr=0;Lr<Jt.length;++Lr)Jt[Lr]=Object(g.div)(Jt[Lr],qt);return Jt})},Q.prototype.getDedupedMetricsNames=function(){for(var C=this.metricsNames,R=[],oe=0;oe<C.length;++oe){var Ue=C[oe],Je=Ue;me(C,Ue)>1&&(Je+="_"+me(C.slice(0,oe),Ue)),R.push(Je)}return R},Q.prototype.makeTrainFunction=function(){var C=this;return function(R){var oe=[],Ue=R.slice(0,C.inputs.length),Je=R.slice(C.inputs.length,C.inputs.length+C.outputs.length),vt=R.slice(C.inputs.length+C.outputs.length,C.inputs.length+2*C.outputs.length),qt=[],Jt=C.collectedTrainableWeights.map(function(pt){return pt.read()});return[C.optimizer_.minimize(function(){for(var pt=[],Nn=0;Nn<C.inputs.length;++Nn)pt.push({key:C.inputs[Nn],value:Ue[Nn]});var Pn,Vn=new Oa(pt),rr=Rh(C.outputs,Vn,{training:!0});for(Nn=0;Nn<C.lossFunctions.length;++Nn){var Yn=(0,C.lossFunctions[Nn])(Je[Nn],rr[Nn]);vt[Nn]!=null&&(Yn=Up(Yn,vt[Nn]));var br=Object(g.mean)(Yn);oe.push(br),Pn=Nn===0?Yn:Object(g.add)(Pn,Yn)}for(Nn=0;Nn<C.metricsTensors.length;++Nn){var xr=void 0;if(C.outputs.length>1&&Nn<C.outputs.length)xr=oe[Nn];else{var Lr=C.metricsTensors[Nn][0],Hr=C.metricsTensors[Nn][1];xr=Object(g.mean)(Lr(Je[Hr],rr[Hr]))}Object(g.keep)(xr),qt.push(xr)}return Pn=Object(g.mean)(Pn),C.calculateLosses().forEach(function(yi){Pn=Object(g.add)(Pn,yi)}),Pn},!0,Jt)].concat(qt)}},Q.prototype.makeTestFunction=function(){var C=this;this.testFunction=function(R){return Object(g.tidy)(function(){for(var oe,Ue=[],Je=R.slice(0,C.inputs.length),vt=R.slice(C.inputs.length,C.inputs.length+C.outputs.length),qt=[],Jt=0;Jt<C.inputs.length;++Jt)qt.push({key:C.inputs[Jt],value:Je[Jt]});var pt=new Oa(qt),Nn=Rh(C.outputs,pt);for(Jt=0;Jt<C.lossFunctions.length;++Jt){var Pn=C.lossFunctions[Jt],Vn=Object(g.mean)(Pn(vt[Jt],Nn[Jt]));oe=Jt===0?Vn:Object(g.add)(oe,Vn),Ue.push(oe)}for(Jt=0;Jt<C.metricsTensors.length;++Jt){var rr=C.metricsTensors[Jt][0],Yn=C.metricsTensors[Jt][1],br=Object(g.mean)(rr(vt[Yn],Nn[Yn]));Ue.push(br)}return Ue})}},Q.prototype.fit=function(C,R,oe){return oe===void 0&&(oe={}),K(this,void 0,void 0,function(){return M(this,function(Ue){return[2,Nl(this,C,R,oe)]})})},Q.prototype.fitDataset=function(C,R){return K(this,void 0,void 0,function(){return M(this,function(oe){return[2,Jf(this,C,R)]})})},Q.prototype.trainOnBatch=function(C,R){return K(this,void 0,void 0,function(){var oe,Ue,Je,vt,qt,Jt,pt,Nn,Pn;return M(this,function(Vn){switch(Vn.label){case 0:return[4,this.standardizeUserData(C,R)];case 1:oe=Vn.sent(),Ue=oe[0],Je=oe[1],vt=this.makeTrainFunction(),qt=vt(Ue.concat(Je)),Jt=[],pt=0,Nn=qt,Vn.label=2;case 2:return pt<Nn.length?[4,Nn[pt].data()]:[3,5];case 3:Pn=Vn.sent(),Jt.push(Pn[0]),Vn.label=4;case 4:return pt++,[3,2];case 5:return Object(g.dispose)(qt),[2,pe(Jt)]}})})},Q.prototype.getNamedWeights=function(C){for(var R=[],oe=C!=null&&C.trainableOnly,Ue=oe?this.trainableWeights:this.weights,Je=this.getWeights(oe),vt=0;vt<Ue.length;++vt)oe&&!Ue[vt].trainable||R.push({name:Ue[vt].originalName,tensor:Je[vt]});return R},Object.defineProperty(Q.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(C){this.stopTraining_=C},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(C){this.optimizer_!==C&&(this.optimizer_=C,this.isOptimizerOwned=!1)},enumerable:!0,configurable:!0}),Q.prototype.dispose=function(){var C=re.prototype.dispose.call(this);if(C.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){var R=Object(g.memory)().numTensors;this.optimizer_.dispose(),C.numDisposedVariables+=R-Object(g.memory)().numTensors}return C},Q.prototype.getLossIdentifiers=function(){var C;if(typeof this.loss=="string")C=Fe(this.loss);else if(Array.isArray(this.loss)){for(var R=0,oe=this.loss;R<oe.length;R++)if(typeof oe[R]!="string")throw new Error("Serialization of non-string loss is not supported.");C=this.loss.map(function(pt){return Fe(pt)})}else{var Ue=Object.keys(this.loss);C={};for(var Je=this.loss,vt=0,qt=Ue;vt<qt.length;vt++){var Jt=qt[vt];if(typeof Je[Jt]!="string")throw new Error("Serialization of non-string loss is not supported.");C[Jt]=Fe(Je[Jt])}}return C},Q.prototype.getMetricIdentifiers=function(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Fe(is(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(function(oe){return Fe(is(oe))});var C={};for(var R in this.metrics)C[R]=Fe(is(this.metrics[R]));return C},Q.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},Q.prototype.loadTrainingConfig=function(C){if(C.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(C.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(C.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");var R,oe,Ue=ha(so(C.optimizer_config));if(typeof C.loss=="string")R=Le(C.loss);else if(Array.isArray(C.loss))R=C.loss.map(function(vt){return Le(vt)});else if(C.loss!=null)for(var Je in R={},C.loss)R[Je]=Le(C.loss[Je]);if(Array.isArray(C.metrics))oe=C.metrics.map(function(vt){return Le(vt)});else if(C.metrics!=null)for(var Je in oe={},C.metrics)oe[Je]=Le(C.metrics[Je]);this.compile({loss:R,metrics:oe,optimizer:Ue})},Q.prototype.save=function(C,R){return K(this,void 0,void 0,function(){var oe,Ue,Je,vt,qt,Jt,pt,Nn,Pn,Vn,rr,Yn,br,xr;return M(this,function(Lr){switch(Lr.label){case 0:if(typeof C=="string"){if((oe=g.io.getSaveHandlers(C)).length===0)throw new te("Cannot find any save handlers for URL '"+C+"'");if(oe.length>1)throw new te("Found more than one ("+oe.length+") save handlers for URL '"+C+"'");C=oe[0]}if(C.save==null)throw new te("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,g.io.encodeWeights(this.getNamedWeights(R))];case 1:return Ue=Lr.sent(),Je=!1,vt=null,qt=this.toJSON(vt,Je),Jt={modelTopology:qt,format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v1.7.4",convertedBy:null},R!=null&&R.includeOptimizer&&this.optimizer!=null?(Jt.trainingConfig=this.getTrainingConfig(),pt="optimizer",Yn=(rr=g.io).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,Yn.apply(rr,[Lr.sent(),pt])];case 3:Nn=Lr.sent(),Pn=Nn.data,Vn=Nn.specs,(xr=Ue.specs).push.apply(xr,Vn),Ue.data=g.io.concatenateArrayBuffers([Ue.data,Pn]),Lr.label=4;case 4:return this.userDefinedMetadata!=null&&(br=!0,No(this.userDefinedMetadata,this.name,br),Jt.userDefinedMetadata=this.userDefinedMetadata),Jt.weightData=Ue.data,Jt.weightSpecs=Ue.specs,[2,C.save(Jt)]}})})},Q.prototype.setUserDefinedMetadata=function(C){No(C,this.name),this.userDefinedMetadata=C},Q.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},Q.className="Model",Q}(function(re){function Q(C){var R=re.call(this,{})||this;if(R.containerNodes=new Set,R.name=C.name,R.name==null){var oe=R.getClassName().toLowerCase();R.name=no(oe)}if(R.supportsMasking=!1,R.trainable_=!0,Array.isArray(C.inputs)?R.inputs=C.inputs.slice():R.inputs=[C.inputs],Array.isArray(C.outputs)?R.outputs=C.outputs.slice():R.outputs=[C.outputs],tn(R.inputs).length!==R.inputs.length)throw new te("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+R.inputs.map(function(Zo){return Zo.name}));tn(R.outputs).length!==R.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+R.outputs.map(function(Zo){return Zo.name})),R.inputLayers=[],R.inputLayersNodeIndices=[],R.inputLayersTensorIndices=[],R.outputLayers=[],R.outputLayersNodeIndices=[],R.outputLayersTensorIndices=[],R.layers=[],R.internalContainerRefs=[];for(var Ue=0,Je=R.outputs;Ue<Je.length;Ue++){var vt=(bi=Je[Ue]).sourceLayer,qt=bi.nodeIndex,Jt=bi.tensorIndex;R.outputLayers.push(vt),R.outputLayersNodeIndices.push(qt),R.outputLayersTensorIndices.push(Jt)}for(var pt=0,Nn=R.inputs;pt<Nn.length;pt++)vt=(bi=Nn[pt]).sourceLayer,qt=bi.nodeIndex,Jt=bi.tensorIndex,J(qt===0,"input layer has >1 nodes"),J(Jt===0,"input layer has >1 tensors"),R.inputLayers.push(vt),R.inputLayersNodeIndices.push(qt),R.inputLayersTensorIndices.push(Jt);R.inputNames=[],R.outputNames=[],R.feedInputShapes=[],R.feedInputNames=[],R.feedOutputNames=[];for(var Pn=0;Pn<R.inputLayers.length;Pn++){if(!((vt=R.inputLayers[Pn])instanceof wc))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: "+C.inputs+". Input "+Pn+" (0-based) originates from layer type "+vt.getClassName()+".");R.inputNames.push(vt.name),R.feedInputShapes.push(vt.batchInputShape),R.feedInputNames.push(vt.name)}for(var Vn=0,rr=R.outputLayers;Vn<rr.length;Vn++)vt=rr[Vn],R.outputNames.push(vt.name);R.internalInputShapes=R.inputs.map(function(Zo){return Zo.shape}),R.internalOutputShapes=R.outputs.map(function(Zo){return Zo.shape});for(var Yn={},br={},xr={},Lr={},Hr={},yi=[],zr=function(Zo,Lu,Qs,Dc,Ll,Va){Dc!=null&&Ll!=null&&Va!=null||(Dc=Zo.sourceLayer,Ll=Zo.nodeIndex,Va=Zo.tensorIndex);var hu=Dc.inboundNodes[Ll];if(Qs.indexOf(hu)!==-1)throw new W("The tensor "+Zo.name+' at layer "'+Dc.name+'" is part of a cycle.');if(Lu.indexOf(hu)===-1){R.containerNodes.add(Q.nodeKey(Dc,Ll)),Dc.id in Hr||(Hr[Dc.id]=Object.keys(Hr).length),Qs.indexOf(hu)===-1&&Qs.push(hu);for(var Ps=hu.inboundLayers.length,rl=0;rl<Ps;rl++){var ah=hu.inputTensors[rl],Wi=hu.inboundLayers[rl],rp=hu.nodeIndices[rl],sh=hu.tensorIndices[rl];zr(ah,Lu,Qs,Wi,rp,sh)}for(Lu.push(hu);Qs.indexOf(hu)>=0;)Qs.splice(Qs.indexOf(hu),1);yi.push(hu)}},li=[],pi=[],Pi=0,qi=R.outputs;Pi<qi.length;Pi++){var bi=qi[Pi];zr(bi,li,pi)}for(var Oi=0,Vo=yi.slice().reverse();Oi<Vo.length;Oi++){br[(Fa=Vo[Oi]).id]=Fa,Fa.id in Yn||(Yn[Fa.id]=0);var qo=Yn[Fa.id],Ia=xr[Fa.outboundLayer.id]==null?0:xr[Fa.outboundLayer.id];for(qo=Math.max(qo,Ia),xr[Fa.outboundLayer.id]=qo,Lr[Fa.outboundLayer.id]=Fa.outboundLayer,Yn[Fa.id]=qo,Pn=0;Pn<Fa.inboundLayers.length;Pn++){var Ao=Fa.inboundLayers[Pn],Ho=(qt=Fa.nodeIndices[Pn],Ao.inboundNodes[qt]),zo=Yn[Ho.id]==null?0:Yn[Ho.id];Yn[Ho.id]=Math.max(qo+1,zo),br[Ho.id]=Ho}}var Sa={};for(var Xa in Yn)(qo=Yn[Xa])in Sa||(Sa[qo]=[]),Sa[qo].push(br[Xa]);var Zi={};for(var co in xr)(qo=xr[co])in Zi||(Zi[qo]=[]),Zi[qo].push(Lr[co]);var Jo=Object.keys(Zi).map(function(Zo){return parseInt(Zo,10)}).sort(Xt);R.layers=[];for(var Pa=0,ks=Jo;Pa<ks.length;Pa++){var Qo=Zi[qo=ks[Pa]];Qo.sort(function(Zo,Lu){var Qs=Hr[Zo.id],Dc=Hr[Lu.id];return Qs<Dc?-1:Qs>Dc?1:0});for(var Wa=0,ku=Qo;Wa<ku.length;Wa++)(vt=ku[Wa])instanceof Q&&R.internalContainerRefs.push(vt),R.layers.push(vt)}R.layersByDepth=Zi,Jo=Object.keys(Sa).map(function(Zo){return parseInt(Zo,10)}).sort(Xt);for(var Cs=R.inputs.slice(),fa=[],_s=0,_l=Jo;_s<_l.length;_s++)for(var Js=0,Bs=Sa[qo=_l[_s]];Js<Bs.length;Js++){var Fa;if((vt=(Fa=Bs[Js]).outboundLayer)!=null){for(var ff=0,_u=Fa.inputTensors;ff<_u.length;ff++)if(bi=_u[ff],Cs.indexOf(bi)===-1)throw new W("Graph disconnected: cannot obtain value for tensor "+bi+' at layer "'+vt.name+'". The following previous layers were accessed without issue: '+fa);for(var dc=0,ns=Fa.outputTensors;dc<ns.length;dc++)bi=ns[dc],Cs.push(bi);fa.push(vt.name)}}R.nodesByDepth=Sa;for(var Bu=R.layers.map(function(Zo){return Zo.name}),Da=function(Zo){var Lu=Bu.filter(function(Qs){return Qs===Zo}).length;if(Lu!==1)throw new W('The name "'+Zo+'" is used '+Lu+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(Bu))},Qu=0,Pu=Bu;Qu<Pu.length;Qu++)Da(Pu[Qu]);return R.outboundNodes=[],R.inboundNodes=[],new As({outboundLayer:R,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:R.inputs,outputTensors:R.outputs,inputMasks:R.inputs.map(function(Zo){return null}),outputMasks:R.outputs.map(function(Zo){return null}),inputShapes:R.inputs.map(function(Zo){return Zo.shape}),outputShapes:R.outputs.map(function(Zo){return Zo.shape})}),R.built=!0,R._refCount=1,R}return I(Q,re),Q.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Container '"+this.name+"' is already disposed.")},Q.prototype.dispose=function(){this.assertNotDisposed();var C={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount==0){for(var R=0,oe=this.layers;R<oe.length;R++){var Ue=oe[R];C.numDisposedVariables+=Ue.dispose().numDisposedVariables}for(var Je=0,vt=this.internalContainerRefs;Je<vt.length;Je++){var qt=vt[Je];C.numDisposedVariables+=qt.dispose().numDisposedVariables}}return C.refCountAfterDispose=this._refCount,C},Object.defineProperty(Q.prototype,"trainable",{get:function(){return this.trainable_},set:function(C){this.layers.forEach(function(R){R._trainableWeights.forEach(function(oe){return oe.trainable=C})}),this.trainable_=C},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"trainableWeights",{get:function(){if(this._trainableWeights.length>0)throw new te("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];for(var C=[],R=0,oe=this.layers;R<oe.length;R++){var Ue=oe[R];C=C.concat(Ue.trainableWeights)}return C},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"nonTrainableWeights",{get:function(){for(var C=[],R=0,oe=this.layers;R<oe.length;R++){var Ue=oe[R];C.push.apply(C,Ue.nonTrainableWeights)}if(!this.trainable){for(var Je=[],vt=0,qt=this.layers;vt<qt.length;vt++)Ue=qt[vt],Je.push.apply(Je,Ue.trainableWeights);return Je.concat(C)}return C},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Q.prototype.loadWeights=function(C,R){R===void 0&&(R=!0);for(var oe={},Ue=0,Je=0,vt=this.layers;Je<vt.length;Je++)for(var qt=0,Jt=vt[Je].weights;qt<Jt.length;qt++){var pt=Jt[qt];if(oe[pt.originalName]!=null)throw new te("Duplicate weight name: "+pt.originalName);oe[pt.originalName]=pt,Ue++}var Nn=[];for(var Pn in C){if(oe[Pn]!=null)Nn.push([oe[Pn],C[Pn]]);else if(R)throw new te("Provided weight data has no target variable: "+Pn);delete oe[Pn]}if(R){var Vn=[];for(var rr in oe)Vn.push(rr);if(Vn.length>0)throw new te(Vn.length+" of "+Ue+" weights are not set: "+Vn)}Oo(Nn)},Q.prototype.updatedConfig=function(){var C=this.getConfig(),R={};return R.className=this.getClassName(),R.config=C,R.kerasVersion="tfjs-layers 1.7.4",R.backend="TensorFlow.js",R},Q.prototype.toJSON=function(C,R){R===void 0&&(R=!0);var oe=function Ue(Je,vt){if(Je==null)return null;if(typeof Je=="string")return Fe(Je);if(typeof Je=="number"||typeof Je=="boolean")return Je;if(Je instanceof Array){for(var qt=[],Jt=Je.length,pt=0;pt<Jt;++pt){var Nn=Je[pt];Ih(vt,pt,Nn)?qt.push(Nn):qt.push(Ue(Nn,vt))}return qt}for(var Pn={},Vn=0,rr=Object.keys(Je);Vn<rr.length;Vn++){var Yn=rr[Vn],br=Je[Yn];Pn[Fe(Yn)]=Yn!=="name"&&Yn!=="className"||typeof br!="string"?Ue(br,Yn):br}return Pn}(this.updatedConfig());return R?JSON.stringify(oe):oe},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){C=Oe(C);for(var Ue=new Oa,Je=0;Je<oe.inputs.length;++Je)Ue.add(oe.inputs[Je],C[Je]);return Rh(oe.outputs,Ue,R)})},Q.prototype.computeMask=function(C,R){var oe=this;return Object(g.tidy)(function(){var Ue;return C=Oe(C),Ue=R==null?se(null,C.length):Oe(R),oe.runInternalGraph(C,Ue)[1]})},Q.prototype.computeOutputShape=function(C){var R=mi(C);if(R.length!==this.inputLayers.length)throw new te("Invalid inputShape argument "+C+": model has "+this.inputLayers.length+" tensor inputs.");for(var oe={},Ue=0;Ue<R.length;Ue++){var Je=this.inputLayers[Ue],vt=R[Ue];oe[qi=Je.name+"_0_0"]=vt}var qt=Object.keys(this.nodesByDepth).map(function(Oi){return parseInt(Oi,10)}).sort(Xt);if(qt.length>1)for(var Jt=0,pt=qt;Jt<pt.length;Jt++)for(var Nn=pt[Jt],Pn=0,Vn=this.nodesByDepth[Nn];Pn<Vn.length;Pn++){var rr=Vn[Pn];if(Je=rr.outboundLayer,this.inputLayers.map(function(Oi){return Oi.id}).indexOf(Je.id)===-1){for(var Yn=[],br=0;br<rr.inboundLayers.length;br++){var xr=rr.inboundLayers[br],Lr=rr.nodeIndices[br],Hr=rr.tensorIndices[br],yi=oe[qi=xr.name+"_"+Lr+"_"+Hr];Yn.push(yi)}var zr=mi(Je.computeOutputShape(pe(Yn))),li=Je.inboundNodes.indexOf(rr);for(br=0;br<zr.length;br++)oe[qi=Je.name+"_"+li+"_"+br]=zr[br]}}var pi=[],Pi=[];for(Ue=0;Ue<this.outputLayers.length;Ue++){Je=this.outputLayers[Ue],li=this.outputLayersNodeIndices[Ue],Hr=this.outputLayersTensorIndices[Ue];var qi=Je.name+"_"+li+"_"+Hr;Pi.push(qi)}for(Ue=0;Ue<Pi.length;Ue++){var bi=Pi[Ue];J(bi in oe),pi.push(oe[bi])}return pe(pi)},Q.prototype.runInternalGraph=function(C,R){R==null&&(R=se(null,C.length));for(var oe={},Ue=0;Ue<this.inputs.length;++Ue){var Je=this.inputs[Ue],vt=C[Ue],qt=R[Ue];oe[Je.id]=[vt,qt]}for(var Jt=0,pt=Object.keys(this.nodesByDepth).map(function(Zi){return parseInt(Zi,10)}).sort(Xt);Jt<pt.length;Jt++)for(var Nn=pt[Jt],Pn=0,Vn=this.nodesByDepth[Nn];Pn<Vn.length;Pn++){for(var rr=Vn[Pn],Yn=rr.outboundLayer,br=rr.inputTensors,xr=rr.outputTensors,Lr=new Array,Hr=0,yi=br;Hr<yi.length;Hr++)(Je=yi[Hr]).id in oe&&Lr.push(oe[Je.id]);if(Lr.length===br.length){var zr={},li=void 0,pi=void 0,Pi=void 0,qi=void 0;if(rr.callArgs!=null&&(zr=rr.callArgs),Lr.length===1){var bi=Lr[0],Oi=bi[0],Vo=bi[1];zr.mask==null&&(zr.mask=Vo),Pi=Oe(Yn.call(Oi,zr)),qi=Oe(Yn.computeMask(Oi,Vo)),li=[Oi],pi=[Vo]}else li=Lr.map(function(Zi){return Zi[0]}),pi=Lr.map(function(Zi){return Zi[1]}),zr.mask==null&&(zr.mask=pi),Pi=Oe(Yn.call(li,zr)),qi=Oe(Yn.computeMask(li,pi));if(Yn.activityRegularizer)throw new F("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(Ue=0;Ue<xr.length;++Ue)Je=xr[Ue],vt=Pi[Ue],qt=qi[Ue],oe[Je.id]=[vt,qt]}}for(var qo=[],Ia=[],Ao=[],Ho=0,zo=this.outputs;Ho<zo.length;Ho++){J((Je=zo[Ho]).id in oe,"Could not compute output "+Je.name+" : "+Je.id);var Sa=oe[Je.id],Xa=Sa[0];qt=Sa[1],Ao.push(Xa.shape),qo.push(Xa),Ia.push(qt)}return[qo,Ia,Ao]},Q.prototype.buildNodeConversionMap=function(C){for(var R,oe={},Ue=0,Je=this.layers;Ue<Je.length;Ue++){var vt=Je[Ue];R=vt instanceof Q?1:0;for(var qt=0;qt<vt.inboundNodes.length;qt++){var Jt=Q.nodeKey(vt,qt);this.containerNodes.has(Jt)&&(oe[Jt]=R,R+=1)}}return oe},Q.prototype.getLayer=function(C,R){if(R!=null){if(this.layers.length<=R)throw new te("Was asked to retrieve layer at index "+R+", but model only has "+this.layers.length+" layer(s).");return this.layers[R]}if(C==null)throw new te("Provide either a layer name or layer index");for(var oe=0,Ue=this.layers;oe<Ue.length;oe++){var Je=Ue[oe];if(Je.name===C)return Je}throw new te("No such layer: "+C)},Q.prototype.calculateLosses=function(){var C=this;return Object(g.tidy)(function(){for(var R=[],oe=0,Ue=C.layers;oe<Ue.length;oe++)for(var Je=Ue[oe],vt=0;vt<Je.inboundNodes.length;++vt){var qt=Q.nodeKey(Je,vt);C.containerNodes.has(qt)&&R.push.apply(R,Je.calculateLosses())}return R})},Q.prototype.getConfig=function(){for(var C={name:this.name},R=this.buildNodeConversionMap(this.layers),oe=[],Ue=0,Je=this.layers;Ue<Je.length;Ue++){for(var vt=(zr=Je[Ue]).getClassName(),qt=zr.getConfig(),Jt=[],pt=0;pt<zr.inboundNodes.length;pt++){var Nn=zr.inboundNodes[pt],Pn=Q.nodeKey(zr,pt),Vn={};if(this.containerNodes.has(Pn)){if(Nn.callArgs)try{JSON.stringify(Nn.callArgs),Vn=Nn.callArgs}catch{console.warn("Layer "+zr.name+" was passed non-serializable keyword arguments: "+Nn.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),Vn={}}if(Nn.inboundLayers.length>0){for(var rr=[],Yn=0;Yn<Nn.inboundLayers.length;Yn++){var br=Nn.inboundLayers[Yn],xr=Nn.nodeIndices[Yn],Lr=Nn.tensorIndices[Yn];(pi=R[Q.nodeKey(br,xr)])==null&&(pi=0),rr.push([br.name,pi,Lr,Vn])}Jt.push(rr)}}}var Hr={};Hr.name=zr.name,Hr.className=vt,Hr.config=qt,Hr.inboundNodes=Jt,oe.push(Hr)}C.layers=oe;var yi=[];for(Yn=0;Yn<this.inputLayers.length;Yn++){var zr=this.inputLayers[Yn];xr=this.inputLayersNodeIndices[Yn],Pn=Q.nodeKey(zr,xr),this.containerNodes.has(Pn)&&((pi=R[Pn])!==null&&pi!==void 0||(pi=0),Lr=this.inputLayersTensorIndices[Yn],yi.push([zr.name,pi,Lr]))}C.inputLayers=yi;var li=[];for(Yn=0;Yn<this.outputLayers.length;Yn++){var pi;zr=this.outputLayers[Yn],xr=this.outputLayersNodeIndices[Yn],Pn=Q.nodeKey(zr,xr),this.containerNodes.has(Pn)&&((pi=R[Pn])!==null&&pi!==void 0||(pi=0),Lr=this.outputLayersTensorIndices[Yn],li.push([zr.name,pi,Lr]))}return C.outputLayers=li,C},Q.fromConfig=function(C,R,oe,Ue){Ue===void 0&&(Ue=!1);var Je={},vt={};function qt(Ho,zo){Ho.name in vt?vt[Ho.name].push(zo):vt[Ho.name]=[zo]}function Jt(Ho,zo){for(var Sa,Xa=[],Zi=0,co=zo;Zi<co.length;Zi++){var Jo=co[Zi],Pa=Jo[0],ks=Jo[1],Qo=Jo[2];if(Sa=Jo[3]==null?{}:Jo[3],!(Pa in Je))return void qt(Ho,zo);var Wa=Je[Pa];if(Wa.inboundNodes.length<=ks)return void qt(Ho,zo);var ku=Wa.inboundNodes[ks];Xa.push(ku.outputTensors[Qo])}Xa.length>0&&Ho.apply(pe(Xa),Sa)}function pt(Ho){var zo=Ho.name,Sa=ha(Ho,R.customObjects!=null?R.customObjects:{});Sa.setFastWeightInitDuringBuild(Ue),Je[zo]=Sa,Ho.inboundNodes.forEach(function(Xa){if(!(Xa instanceof Array))throw new te("Corrupted configuration, expected array for nodeData: "+Xa);qt(Sa,Xa)})}for(var Nn=R.name,Pn=R.layers,Vn=0,rr=Pn;Vn<rr.length;Vn++)pt(xr=rr[Vn]);for(;!Ce(vt);)for(var Yn=0,br=Pn;Yn<br.length;Yn++){var xr=br[Yn];if((Ao=Je[xr.name]).name in vt){var Lr=vt[Ao.name];delete vt[Ao.name];for(var Hr=0,yi=Lr;Hr<yi.length;Hr++)Jt(Ao,yi[Hr])}}for(var zr=[],li=[],pi=0,Pi=R.inputLayers;pi<Pi.length;pi++){var qi=(xr=Pi[pi])[0],bi=xr[1],Oi=xr[2];J(qi in Je);var Vo=(Ao=Je[qi]).inboundNodes[bi].outputTensors;zr.push(Vo[Oi])}for(var qo=0,Ia=R.outputLayers;qo<Ia.length;qo++){var Ao;qi=(xr=Ia[qo])[0],bi=xr[1],Oi=xr[2],J(qi in Je),Vo=(Ao=Je[qi]).inboundNodes[bi].outputTensors,li.push(Vo[Oi])}return new C({inputs:zr,outputs:li,name:Nn})},Object.defineProperty(Q.prototype,"stateful",{get:function(){if(this._stateful)throw new te("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(var C=0,R=this.layers;C<R.length;C++)if(R[C].stateful)return!0;return!1},enumerable:!0,configurable:!0}),Q.prototype.resetStates=function(){var C=this;Object(g.tidy)(function(){C.layers.forEach(function(R){R.stateful&&R.resetStates()})})},Q}(eo));function Ku(re,Q){return K(this,void 0,void 0,function(){var C;return M(this,function(R){if(Q==null&&(Q={}),typeof re=="string"){if((C=g.io.getLoadHandlers(re,Q.onProgress)).length===0)C.push(g.io.browserHTTPRequest(re,Q));else if(C.length>1)throw new te("Found more than one ("+C.length+") load handlers for URL '"+re+"'");re=C[0]}return[2,function(oe,Ue,Je){return K(this,void 0,void 0,function(){var vt,qt,Jt,pt,Nn,Pn,Vn,rr,Yn;return M(this,function(br){switch(br.label){case 0:if(Je==null&&(Je={}),oe.load==null)throw new te("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,oe.load()];case 1:if(vt=br.sent(),(qt=vt.modelTopology).model_config!=null&&(qt=qt.model_config),Jt=Je.strict==null||Je.strict,pt=vt.weightData!=null&&vt.weightSpecs!=null&&Jt,Nn=ha(so(qt),Ue,pt),(Pn=vt.trainingConfig)!=null&&Nn.loadTrainingConfig(Pn),vt.userDefinedMetadata!=null&&Nn.setUserDefinedMetadata(vt.userDefinedMetadata),vt.weightData==null)return[3,4];if(vt.weightSpecs==null)throw new te("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return Vn=function(xr,Lr){var Hr=g.io.decodeWeights(xr,Lr),yi={},zr=[];return Lr.forEach(function(li){li.group==="optimizer"?zr.push({name:li.name,tensor:Hr[li.name]}):yi[li.name]=Hr[li.name]}),{modelWeights:yi,optimizerWeights:zr}}(vt.weightData,vt.weightSpecs),rr=Vn.modelWeights,Yn=Vn.optimizerWeights,Nn.loadWeights(rr,Jt),Nn.optimizer!=null&&Yn.length>0?[4,Nn.optimizer.setWeights(Yn)]:[3,3];case 2:br.sent(),br.label=3;case 3:Object(g.dispose)(rr),Object(g.dispose)(Yn.map(function(xr){return xr.tensor})),br.label=4;case 4:return[2,Nn]}})})}(re,void 0,Q)]})})}g.serialization.registerClass(tf);var Tt=function(re){function Q(C){var R=re.call(this,{inputs:[],outputs:[]})||this;if(C=C||{},R.trainable=!0,R.built=!1,R.name=C.name!=null?C.name:no("sequential_"),C.layers!=null)for(var oe=0,Ue=C.layers;oe<Ue.length;oe++){var Je=Ue[oe];R.add(Je)}return R}return I(Q,re),Q.prototype.checkShape=function(C){if(C.inboundNodes[0].outputTensors[0].shape.some(function(R){return R<0}))throw new te("Negative dimension size caused by adding layer "+C.name+" with input shape ["+C.inboundNodes[0].inputTensors[0].shape+"]")},Q.prototype.add=function(C){var R,oe=C instanceof Q||C instanceof tf;if(oe){if((R=C).outputs.length!==1)throw new te("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(R.inputs.length!==1)throw new te("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(C.inboundNodes.length===0){if(C.batchInputShape==null)throw new te("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var Ue=kc({batchShape:C.batchInputShape,dtype:C.dtype,name:C.name+"_input"});C.apply(Ue)}if(oe)this.outputs=R.outputs,this.inputs=R.inputs;else{if(C.inboundNodes.length!==1)throw new te("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer "+C.name+" which has "+C.inboundNodes.length+" pre-existing inbound connections.");if(C.inboundNodes[0].outputTensors.length!==1)throw new te("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(C),this.outputs=[C.inboundNodes[0].outputTensors[0]],this.inputs=function vt(qt,Jt,pt){if((Jt==null||pt!=null&&pt>0)&&(Jt=qt.sourceLayer,pt=qt.nodeIndex),Jt.inboundNodes.length===0)return[qt];var Nn=Jt.inboundNodes[pt];if(Nn.inboundLayers.length===0)return Nn.inputTensors;for(var Pn=[],Vn=0;Vn<Nn.inboundLayers.length;Vn++)for(var rr=0,Yn=vt(Nn.inputTensors[Vn],Nn.inboundLayers[Vn],Nn.nodeIndices[Vn]);rr<Yn.length;rr++){var br=Yn[rr];Pn.indexOf(br)===-1&&Pn.push(br)}return Pn}(this.outputs[0])}this.inboundNodes=[],new As({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:se(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(vt){return vt.shape}),outputShapes:this.outputs[0].shape})}else{var Je=C.apply(this.outputs[0]);if(Array.isArray(Je))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(C),this.outputs=[Je],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(C),this.built=!1},Q.prototype.pop=function(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var C=this.layers.length-1;this.layers[C].outboundNodes=[],this.outputs=[this.layers[C].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},Q.prototype.call=function(C,R){return this.model==null&&this.build(),this.model.call(C,R)},Q.prototype.build=function(C){if(qn(C),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new tf({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},Q.prototype.countParams=function(){return this.built||this.build(),re.prototype.countParams.call(this)},Q.prototype.summary=function(C,R,oe){oe===void 0&&(oe=console.log),this.built||this.build(),re.prototype.summary.call(this,C,R,oe)},Q.prototype.setWeights=function(C){this.model==null&&this.build(),this.model.setWeights(C)},Q.prototype.evaluate=function(C,R,oe){if(oe===void 0&&(oe={}),!this.built)throw new W("The model needs to be compiled before being used.");return this.model.evaluate(C,R,oe)},Q.prototype.evaluateDataset=function(C,R){return K(this,void 0,void 0,function(){return M(this,function(oe){if(!this.built)throw new W("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(C,R)]})})},Q.prototype.predict=function(C,R){return R===void 0&&(R={}),this.model==null&&this.build(),this.model.predict(C,R)},Q.prototype.predictOnBatch=function(C){return this.model==null&&this.build(),this.model.predictOnBatch(C)},Q.prototype.compile=function(C){this.build(),this.model.compile(C),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(Q.prototype,"optimizer",{get:function(){return this.model==null?void 0:this.model.optimizer},set:function(C){this.model.optimizer=C},enumerable:!0,configurable:!0}),Q.prototype.fit=function(C,R,oe){return oe===void 0&&(oe={}),K(this,void 0,void 0,function(){return M(this,function(Ue){if(!this.built)throw new W("The model needs to be compiled before being used.");return[2,this.model.fit(C,R,oe)]})})},Q.prototype.fitDataset=function(C,R){return K(this,void 0,void 0,function(){return M(this,function(oe){if(!this.built)throw new W("The model needs to be compiled before being used.");return[2,this.model.fitDataset(C,R)]})})},Q.prototype.trainOnBatch=function(C,R){return K(this,void 0,void 0,function(){return M(this,function(oe){return[2,this.model.trainOnBatch(C,R)]})})},Q.fromConfig=function(C,R,oe,Ue){var Je;Ue===void 0&&(Ue=!1);var vt={};if(R instanceof Array){if(R[0].className==null||R[0].className==="Merge")throw new te("Legacy serialization format not supported yet.");Je=R}else g.util.assert(R.layers!=null,function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."}),Je=R.layers,delete R.layers,vt=R;var qt=new C(vt);if(!(qt instanceof Q))throw new F("Sequential.fromConfig called on non-Sequential input: "+qt);for(var Jt=0,pt=Je;Jt<pt.length;Jt++){var Nn=ha(pt[Jt],void 0,Ue);Ue&&Nn.setFastWeightInitDuringBuild(!0),qt.add(Nn)}return qt},Object.defineProperty(Q.prototype,"stopTraining",{get:function(){if(this.model==null)throw new te("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(C){if(this.model==null)throw new te("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=C},enumerable:!0,configurable:!0}),Q.prototype.getConfig=function(){for(var C=[],R=0,oe=this.layers;R<oe.length;R++){var Ue=oe[R],Je={};Je.className=Ue.getClassName(),Je.config=Ue.getConfig(),C.push(Je)}return{name:this.name,layers:C}},Q.className="Sequential",Q}(tf);function aa(re){return new tf(re)}function ms(re){return new Tt(re)}function Ks(re,Q){return Q==null&&(Q={}),Ku(re,Q)}function la(re){return kc(re)}function xu(re,Q){ml.registerCallbackConstructor(re,Q)}g.serialization.registerClass(Tt);var Mr=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.getConfig=function(){return{}},Q}(g.serialization.Serializable),Cc=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.apply=function(C,R){return R===void 0&&(R=1),function(oe,Ue){if(Ue===void 0&&(Ue=1),Ue!==1)throw new F("Support for alpha values other than 1 ("+Ue+") is not implemented yet.");return Object(g.elu)(oe)}(C,R)},Q.className="elu",Q}(Mr);g.serialization.registerClass(Cc);var sc=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.apply=function(C){return Object(g.selu)(C)},Q.className="selu",Q}(Mr);g.serialization.registerClass(sc);var nf=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.apply=function(C){return Object(g.relu)(C)},Q.className="relu",Q}(Mr);g.serialization.registerClass(nf);var Ac=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.apply=function(C){return Object(g.tidy)(function(){return Object(g.minimum)(6,Object(g.relu)(C))})},Q.className="relu6",Q}(Mr);g.serialization.registerClass(Ac);var yd=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.apply=function(C){return C},Q.className="linear",Q}(Mr);g.serialization.registerClass(yd);var uc=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.apply=function(C){return Object(g.sigmoid)(C)},Q.className="sigmoid",Q}(Mr);g.serialization.registerClass(uc);var bd=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.apply=function(C){return function(R){return Object(g.tidy)(function(){var oe=Object(g.add)(.5,Object(g.mul)(.2,R));return Object(g.clipByValue)(oe,0,1)})}(C)},Q.className="hardSigmoid",Q}(Mr);g.serialization.registerClass(bd);var Xu=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.apply=function(C){return Object(g.softplus)(C)},Q.className="softplus",Q}(Mr);g.serialization.registerClass(Xu);var Io=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.apply=function(C){return function(R){return Object(g.tidy)(function(){return Object(g.div)(R,Object(g.abs)(R).add(1))})}(C)},Q.className="softsign",Q}(Mr);g.serialization.registerClass(Io);var Nu=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.apply=function(C){return Object(g.tanh)(C)},Q.className="tanh",Q}(Mr);g.serialization.registerClass(Nu);var Jd=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.apply=function(C,R){return R===void 0&&(R=-1),Object(g.softmax)(C,R)},Q.className="softmax",Q}(Mr);g.serialization.registerClass(Jd);var rf=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.apply=function(C,R){return R===void 0&&(R=-1),Object(g.logSoftmax)(C,R)},Q.className="logSoftmax",Q}(Mr);function Iu(re){return re.getClassName()}function Ri(re,Q){return Q===void 0&&(Q={}),Mt(re,g.serialization.SerializationMap.getMap().classNameMap,Q,"activation")}function $a(re){var Q;return re==null?Ri(Q={className:"linear",config:{}}):typeof re=="string"?((Q={}).className=re,Q.config={},Ri(Q)):re instanceof Mr?re:Ri(re)}function of(re){if(re!=null&&typeof re!="object")throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: "+re)}g.serialization.registerClass(rf);var Wp=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q}(g.serialization.Serializable),Mh=function(re){function Q(C){var R=re.call(this)||this;return of(C),R.l1=C==null||C.l1==null?.01:C.l1,R.l2=C==null||C.l2==null?.01:C.l2,R.hasL1=R.l1!==0,R.hasL2=R.l2!==0,R}return I(Q,re),Q.prototype.apply=function(C){var R=this;return Object(g.tidy)(function(){var oe=Object(g.zeros)([1]);return R.hasL1&&(oe=Object(g.add)(oe,Object(g.sum)(Object(g.mul)(R.l1,Object(g.abs)(C))))),R.hasL2&&(oe=Object(g.add)(oe,Object(g.sum)(Object(g.mul)(R.l2,Gi(C))))),oe.asScalar()})},Q.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},Q.fromConfig=function(C,R){return new C({l1:R.l1,l2:R.l2})},Q.className="L1L2",Q}(Wp);g.serialization.registerClass(Mh);var jh={l1l2:"L1L2"};function _o(re){return ft(re)}function Ki(re,Q){return Q===void 0&&(Q={}),Mt(re,g.serialization.SerializationMap.getMap().classNameMap,Q,"regularizer")}function Ka(re){return re==null?null:typeof re=="string"?Ki({className:re in jh?jh[re]:re,config:{}}):re instanceof Wp?re:Ki(re)}var Vp=function(re){function Q(C){var R=re.call(this,C==null?{}:C)||this;return R.supportsMasking=!0,C!=null&&(R.maxValue=C.maxValue),R}return I(Q,re),Q.prototype.call=function(C,R){C=ai(C);var oe=Object(g.relu)(C);return this.maxValue!=null&&(oe=Object(g.clipByValue)(oe,0,this.maxValue)),oe},Q.prototype.computeOutputShape=function(C){return C},Q.prototype.getConfig=function(){var C={maxValue:this.maxValue},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="ReLU",Q}(eo);g.serialization.registerClass(Vp);var qp=function(re){function Q(C){var R=re.call(this,C==null?{}:C)||this;return R.DEFAULT_ALPHA=.3,C==null&&(C={}),R.alpha=C.alpha==null?R.DEFAULT_ALPHA:C.alpha,R}return I(Q,re),Q.prototype.call=function(C,R){var oe=ai(C);return Object(g.leakyRelu)(oe,this.alpha)},Q.prototype.computeOutputShape=function(C){return C},Q.prototype.getConfig=function(){var C={alpha:this.alpha},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="LeakyReLU",Q}(eo);g.serialization.registerClass(qp);var Hp=function(re){function Q(C){var R=re.call(this,C==null?{}:C)||this;if(R.DEFAULT_ALPHA_INITIALIZER="zeros",C==null&&(C={}),R.supportsMasking=!0,R.alphaInitializer=ui(C.alphaInitializer||R.DEFAULT_ALPHA_INITIALIZER),R.alphaRegularizer=Ka(C.alphaRegularizer),R.alphaConstraint=tr(C.alphaConstraint),C.sharedAxes==null)R.sharedAxes=null;else if(Array.isArray(C.sharedAxes))R.sharedAxes=C.sharedAxes;else{if(typeof C.sharedAxes!="number")throw new te("Expected sharedAxes to be a number or an array of numbers, but got "+C.sharedAxes);R.sharedAxes=[C.sharedAxes]}return R}return I(Q,re),Q.prototype.build=function(C){var R=(C=qn(C)).slice(1);if(this.sharedAxes!=null)for(var oe=0,Ue=this.sharedAxes;oe<Ue.length;oe++)R[(vt=Ue[oe])-1]=1;this.alpha=this.addWeight("alpha",R,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var Je={};if(this.sharedAxes!=null)for(var vt=1;vt<C.length;++vt)Je[vt]=C[vt];this.inputSpec=[new So({ndim:C.length,axes:Je})],this.built=!0},Q.prototype.call=function(C,R){return C=ai(C),Object(g.prelu)(C,this.alpha.read())},Q.prototype.getConfig=function(){var C={alphaInitializer:kr(this.alphaInitializer),alphaRegularizer:_o(this.alphaRegularizer),alphaConstraint:Tn(this.alphaConstraint),sharedAxes:this.sharedAxes},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="PReLU",Q}(eo);g.serialization.registerClass(Hp);var Qf=function(re){function Q(C){var R=re.call(this,C==null?{}:C)||this;if(R.DEFAULT_ALPHA=1,C==null&&(C={}),C.alpha!=null&&C.alpha!==R.DEFAULT_ALPHA)throw new F("Non-default alpha value ("+C.alpha+") is not supported by the ELU layer yet.");return R.alpha=C.alpha==null?R.DEFAULT_ALPHA:C.alpha,R}return I(Q,re),Q.prototype.call=function(C,R){var oe=ai(C);return Object(g.elu)(oe)},Q.prototype.computeOutputShape=function(C){return C},Q.prototype.getConfig=function(){var C={alpha:this.alpha},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="ELU",Q}(eo);g.serialization.registerClass(Qf);var nu=function(re){function Q(C){var R=re.call(this,C==null?{}:C)||this;return R.DEFAULT_THETA=1,C==null&&(C={}),R.theta=C.theta==null?R.DEFAULT_THETA:C.theta,R}return I(Q,re),Q.prototype.call=function(C,R){var oe=ai(C);return oe.mul(Pr(oe.greater(this.theta),"float32"))},Q.prototype.computeOutputShape=function(C){return C},Q.prototype.getConfig=function(){var C={theta:this.theta},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="ThresholdedReLU",Q}(eo);g.serialization.registerClass(nu);var Fu=function(re){function Q(C){var R=re.call(this,C==null?{}:C)||this;return R.DEFAULT_AXIS=1,C==null&&(C={}),R.softmax=new Jd().apply,R.axis=C.axis==null?R.DEFAULT_AXIS:C.axis,R}return I(Q,re),Q.prototype.call=function(C,R){var oe=ai(C);return this.softmax(oe,this.axis)},Q.prototype.computeOutputShape=function(C){return C},Q.prototype.getConfig=function(){var C={axis:this.axis},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="Softmax",Q}(eo);function Zf(re,Q,C){if(typeof re=="number")return se(re,Q);if(re.length!==Q)throw new te("The "+C+" argument must be an integer or tuple of "+Q+" integers. Received: "+re.length+" elements.");for(var R=0;R<Q;++R){var oe=re[R];if(!hn(oe))throw new te("The "+C+" argument must be an integer or tuple of "+Q+" integers. Received: "+JSON.stringify(re)+" including a non-integer number "+oe)}return re}function cc(re,Q,C,R,oe){return oe===void 0&&(oe=1),re==null?re:(Ue=C==="same"?re:re-(Q+(Q-1)*(oe-1))+1,Math.floor((Ue+R-1)/R));var Ue}function Bc(re,Q,C,R){if(re==null)return null;if(R==="valid")re=re*Q+jn([C-Q,0]);else{if(R!=="same")throw new te("Unsupport padding mode: "+R+".");re*=Q}return re}function Qd(re,Q){return Object(g.tidy)(function(){return Lt(Q),Q==="channelsFirst"?Object(g.transpose)(re,[0,2,3,1]):re})}function wo(re,Q){return Object(g.tidy)(function(){return Lt(Q),Q==="channelsFirst"?Object(g.transpose)(re,[0,2,3,4,1]):re})}function Il(re,Q,C,R,oe,Ue,Je,vt){return R===void 0&&(R=[1,1]),oe===void 0&&(oe="valid"),vt===void 0&&(vt=null),Object(g.tidy)(function(){if(Ue==null&&(Ue="channelsLast"),Lt(Ue),re.rank!==3&&re.rank!==4)throw new te("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received "+re.rank+".");if(Q.rank!==3&&Q.rank!==4)throw new te("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received "+re.rank+".");var qt=Qd(re,Ue);if(oe==="causal")throw new F("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return qt=g.fused.conv2d({x:qt,filter:Q,strides:R,pad:oe==="same"?"same":"valid",dilations:Je,dataFormat:"NHWC",bias:C,activation:vt}),Ue==="channelsFirst"&&(qt=Object(g.transpose)(qt,[0,3,1,2])),qt})}g.serialization.registerClass(Fu);var cr=function(re){function Q(C,R){var oe=re.call(this,R)||this;if(oe.bias=null,oe.DEFAULT_KERNEL_INITIALIZER="glorotNormal",oe.DEFAULT_BIAS_INITIALIZER="zeros",Q.verifyArgs(R),oe.rank=C,Ut(oe.rank,"rank"),oe.rank!==1&&oe.rank!==2&&oe.rank!==3)throw new F("Convolution layer for rank other than 1, 2, or 3 ("+oe.rank+") is not implemented yet.");if(oe.kernelSize=Zf(R.kernelSize,C,"kernelSize"),oe.strides=Zf(R.strides==null?1:R.strides,C,"strides"),oe.padding=R.padding==null?"valid":R.padding,zn(oe.padding),oe.dataFormat=R.dataFormat==null?"channelsLast":R.dataFormat,Lt(oe.dataFormat),oe.activation=$a(R.activation),oe.useBias=R.useBias==null||R.useBias,oe.biasInitializer=ui(R.biasInitializer||oe.DEFAULT_BIAS_INITIALIZER),oe.biasConstraint=tr(R.biasConstraint),oe.biasRegularizer=Ka(R.biasRegularizer),oe.activityRegularizer=Ka(R.activityRegularizer),oe.dilationRate=Zf(R.dilationRate==null?1:R.dilationRate,C,"dilationRate"),oe.rank===1&&Array.isArray(oe.dilationRate)&&oe.dilationRate.length!==1)throw new te("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(oe.dilationRate));if(oe.rank===2){if(typeof oe.dilationRate=="number")oe.dilationRate=[oe.dilationRate,oe.dilationRate];else if(oe.dilationRate.length!==2)throw new te("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(oe.dilationRate))}else if(oe.rank===3){if(typeof oe.dilationRate=="number")oe.dilationRate=[oe.dilationRate,oe.dilationRate,oe.dilationRate];else if(oe.dilationRate.length!==3)throw new te("dilationRate must be a number or array of three numbers for 3D convolution, but received "+JSON.stringify(oe.dilationRate))}return oe}return I(Q,re),Q.verifyArgs=function(C){if(J("kernelSize"in C,"required key 'kernelSize' not in config"),typeof C.kernelSize!="number"&&!en(C.kernelSize,"number",1,3))throw new te("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received "+JSON.stringify(C.kernelSize)+".")},Q.prototype.getConfig=function(){var C={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Iu(this.activation),useBias:this.useBias,biasInitializer:kr(this.biasInitializer),biasRegularizer:_o(this.biasRegularizer),activityRegularizer:_o(this.activityRegularizer),biasConstraint:Tn(this.biasConstraint)},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q}(eo),jr=function(re){function Q(C,R){var oe=re.call(this,C,R)||this;return oe.kernel=null,Q.verifyArgs(R),oe.filters=R.filters,Ut(oe.filters,"filters"),oe.kernelInitializer=ui(R.kernelInitializer||oe.DEFAULT_KERNEL_INITIALIZER),oe.kernelConstraint=tr(R.kernelConstraint),oe.kernelRegularizer=Ka(R.kernelRegularizer),oe}return I(Q,re),Q.prototype.build=function(C){var R;C=qn(C);var oe=this.dataFormat==="channelsFirst"?1:C.length-1;if(C[oe]==null)throw new te("The channel dimension of the input should be defined. Found "+C[oe]);var Ue=C[oe],Je=this.kernelSize.concat([Ue,this.filters]);this.kernel=this.addWeight("kernel",Je,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(R={},R[oe]=Ue,R)}],this.built=!0},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){var Ue;C=ai(C);var Je=oe.bias==null?null:oe.bias.read(),vt=Qe(oe.activation.getClassName());if(vt!=null&&oe.rank===2)Ue=Il(C,oe.kernel.read(),Je,oe.strides,oe.padding,oe.dataFormat,oe.dilationRate,vt);else{if(oe.rank===1)Ue=function(qt,Jt,pt,Nn,Pn,Vn,rr){return Nn===void 0&&(Nn=1),Pn===void 0&&(Pn="valid"),rr===void 0&&(rr=1),Object(g.tidy)(function(){if(Vn==null&&(Vn="channelsLast"),Lt(Vn),qt.shape.length!==3)throw new te("The input of a conv1dWithBias operation should be 3, but is "+qt.shape.length+" instead.");if(Jt.shape.length!==3)throw new te("The kernel for a conv1dWithBias operation should be 3, but is "+Jt.shape.length+" instead");if(pt!=null&&pt.shape.length!==1)throw new te("The bias for a conv1dWithBias operation should be 1, but is "+Jt.shape.length+" instead");if(Vn==="channelsFirst"&&(qt=Object(g.transpose)(qt,[0,2,1])),Pn==="causal")throw new F("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var Yn=Object(g.conv1d)(qt,Jt,Nn,Pn==="same"?"same":"valid","NWC",rr);return pt!=null&&(Yn=Ot(Yn,pt)),Yn})}(C,oe.kernel.read(),Je,oe.strides[0],oe.padding,oe.dataFormat,oe.dilationRate[0]);else if(oe.rank===2)Ue=Il(C,oe.kernel.read(),Je,oe.strides,oe.padding,oe.dataFormat,oe.dilationRate);else{if(oe.rank!==3)throw new F("convolutions greater than 3D are not implemented yet.");Ue=function(qt,Jt,pt,Nn,Pn,Vn,rr){return Nn===void 0&&(Nn=[1,1,1]),Pn===void 0&&(Pn="valid"),Object(g.tidy)(function(){if(Vn==null&&(Vn="channelsLast"),Lt(Vn),qt.rank!==4&&qt.rank!==5)throw new te("conv3dWithBias expects input to be of rank 4 or 5, but received "+qt.rank+".");if(Jt.rank!==4&&Jt.rank!==5)throw new te("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+qt.rank+".");var Yn=wo(qt,Vn);if(Pn==="causal")throw new F("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return Yn=Object(g.conv3d)(Yn,Jt,Nn,Pn==="same"?"same":"valid","NDHWC",rr),pt!=null&&(Yn=Ot(Yn,pt)),Vn==="channelsFirst"&&(Yn=Object(g.transpose)(Yn,[0,4,1,2,3])),Yn})}(C,oe.kernel.read(),Je,oe.strides,oe.padding,oe.dataFormat,oe.dilationRate)}oe.activation!=null&&(Ue=oe.activation.apply(Ue))}return Ue})},Q.prototype.computeOutputShape=function(C){C=qn(C);for(var R=[],oe=this.dataFormat==="channelsLast"?C.slice(1,C.length-1):C.slice(2),Ue=0;Ue<oe.length;++Ue){var Je=cc(oe[Ue],this.kernelSize[Ue],this.padding,this.strides[Ue],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[Ue]);R.push(Je)}var vt=[C[0]];return this.dataFormat==="channelsLast"?(vt=vt.concat(R)).push(this.filters):(vt.push(this.filters),vt=vt.concat(R)),vt},Q.prototype.getConfig=function(){var C={filters:this.filters,kernelInitializer:kr(this.kernelInitializer),kernelRegularizer:_o(this.kernelRegularizer),kernelConstraint:Tn(this.kernelConstraint)},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.verifyArgs=function(C){if(!("filters"in C)||typeof C.filters!="number"||C.filters<1)throw new te("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(C.filters))},Q}(cr),Or=function(re){function Q(C){var R=re.call(this,2,C)||this;return Q.verifyArgs(C),R}return I(Q,re),Q.prototype.getConfig=function(){var C=re.prototype.getConfig.call(this);return delete C.rank,C},Q.verifyArgs=function(C){if(typeof C.kernelSize!="number"&&!en(C.kernelSize,"number",1,2))throw new te("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(C.kernelSize)+".")},Q.className="Conv2D",Q}(jr);g.serialization.registerClass(Or);var Mi=function(re){function Q(C){var R=re.call(this,3,C)||this;return Q.verifyArgs(C),R}return I(Q,re),Q.prototype.getConfig=function(){var C=re.prototype.getConfig.call(this);return delete C.rank,C},Q.verifyArgs=function(C){if(typeof C.kernelSize!="number"&&(!Array.isArray(C.kernelSize)||C.kernelSize.length!==1&&C.kernelSize.length!==3))throw new te("Conv3D expects config.kernelSize to be number or [number, number, number], but received "+JSON.stringify(C.kernelSize)+".")},Q.className="Conv3D",Q}(jr);g.serialization.registerClass(Mi);var go=function(re){function Q(C){var R=re.call(this,C)||this;if(R.inputSpec=[new So({ndim:4})],R.padding!=="same"&&R.padding!=="valid")throw new te("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+R.padding);return R}return I(Q,re),Q.prototype.build=function(C){var R;if((C=qn(C)).length!==4)throw new te("Input should have rank 4; Received input shape: "+JSON.stringify(C));var oe=this.dataFormat==="channelsFirst"?1:C.length-1;if(C[oe]==null)throw new te("The channel dimension of the inputs should be defined. Found `None`.");var Ue=C[oe],Je=this.kernelSize.concat([this.filters,Ue]);this.kernel=this.addWeight("kernel",Je,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new So({ndim:4,axes:(R={},R[oe]=Ue,R)})],this.built=!0},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){var Ue=ai(C);if(Ue.shape.length!==4)throw new te("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+Ue.shape.length);var Je,vt,qt=Ue.shape,Jt=qt[0];oe.dataFormat==="channelsFirst"?(Je=2,vt=3):(Je=1,vt=2);var pt=qt[Je],Nn=qt[vt],Pn=oe.kernelSize[0],Vn=oe.kernelSize[1],rr=oe.strides[0],Yn=oe.strides[1],br=[Jt,Bc(pt,rr,Pn,oe.padding),Bc(Nn,Yn,Vn,oe.padding),oe.filters];oe.dataFormat!=="channelsLast"&&(Ue=Object(g.transpose)(Ue,[0,2,3,1]));var xr=Object(g.conv2dTranspose)(Ue,oe.kernel.read(),br,oe.strides,oe.padding);return oe.dataFormat!=="channelsLast"&&(xr=Object(g.transpose)(xr,[0,3,1,2])),oe.bias!=null&&(xr=Ot(xr,oe.bias.read(),oe.dataFormat)),oe.activation!=null&&(xr=oe.activation.apply(xr)),xr})},Q.prototype.computeOutputShape=function(C){var R,oe,Ue,Je=(C=qn(C)).slice();this.dataFormat==="channelsFirst"?(R=1,oe=2,Ue=3):(R=3,oe=1,Ue=2);var vt=this.kernelSize[0],qt=this.kernelSize[1],Jt=this.strides[0],pt=this.strides[1];return Je[R]=this.filters,Je[oe]=Bc(Je[oe],Jt,vt,this.padding),Je[Ue]=Bc(Je[Ue],pt,qt,this.padding),Je},Q.prototype.getConfig=function(){var C=re.prototype.getConfig.call(this);return delete C.dilationRate,C},Q.className="Conv2DTranspose",Q}(Or);g.serialization.registerClass(go);var Ca=function(re){function Q(C){return re.call(this,2,C)||this}return I(Q,re),Q.className="SeparableConv2D",Q}(function(re){function Q(C,R){var oe=re.call(this,C,R)||this;if(oe.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",oe.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",oe.depthwiseKernel=null,oe.pointwiseKernel=null,R.filters==null)throw new te("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(R.kernelInitializer!=null||R.kernelRegularizer!=null||R.kernelConstraint!=null)throw new te("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(R.padding!=null&&R.padding!=="same"&&R.padding!=="valid")throw new te("SeparableConv"+oe.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(R.padding));return oe.depthMultiplier=R.depthMultiplier==null?1:R.depthMultiplier,oe.depthwiseInitializer=ui(R.depthwiseInitializer||oe.DEFAULT_DEPTHWISE_INITIALIZER),oe.depthwiseRegularizer=Ka(R.depthwiseRegularizer),oe.depthwiseConstraint=tr(R.depthwiseConstraint),oe.pointwiseInitializer=ui(R.depthwiseInitializer||oe.DEFAULT_POINTWISE_INITIALIZER),oe.pointwiseRegularizer=Ka(R.pointwiseRegularizer),oe.pointwiseConstraint=tr(R.pointwiseConstraint),oe}return I(Q,re),Q.prototype.build=function(C){var R;if((C=qn(C)).length<this.rank+2)throw new te("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2)+", but received input shape: "+JSON.stringify(C));var oe=this.dataFormat==="channelsFirst"?1:C.length-1;if(C[oe]==null||C[oe]<0)throw new te("The channel dimension of the inputs should be defined, but found "+JSON.stringify(C[oe]));for(var Ue=C[oe],Je=this.kernelSize.concat([Ue,this.depthMultiplier]),vt=[],qt=0;qt<this.rank;++qt)vt.push(1);vt.push(Ue*this.depthMultiplier,this.filters),this.depthwiseKernel=this.addWeight("depthwise_kernel",Je,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",vt,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.inputSpec=[new So({ndim:this.rank+2,axes:(R={},R[oe]=Ue,R)})],this.built=!0},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){var Ue;if(C=ai(C),oe.rank===1)throw new F("1D separable convolution is not implemented yet.");return oe.rank===2&&(oe.dataFormat==="channelsFirst"&&(C=Object(g.transpose)(C,[0,2,3,1])),Ue=Object(g.separableConv2d)(C,oe.depthwiseKernel.read(),oe.pointwiseKernel.read(),oe.strides,oe.padding,oe.dilationRate,"NHWC")),oe.useBias&&(Ue=Ot(Ue,oe.bias.read(),oe.dataFormat)),oe.activation!=null&&(Ue=oe.activation.apply(Ue)),oe.dataFormat==="channelsFirst"&&(Ue=Object(g.transpose)(Ue,[0,3,1,2])),Ue})},Q.prototype.getConfig=function(){var C=re.prototype.getConfig.call(this);return delete C.rank,delete C.kernelInitializer,delete C.kernelRegularizer,delete C.kernelConstraint,C.depthwiseInitializer=kr(this.depthwiseInitializer),C.pointwiseInitializer=kr(this.pointwiseInitializer),C.depthwiseRegularizer=_o(this.depthwiseRegularizer),C.pointwiseRegularizer=_o(this.pointwiseRegularizer),C.depthwiseConstraint=Tn(this.depthwiseConstraint),C.pointwiseConstraint=Tn(this.pointwiseConstraint),C},Q.className="SeparableConv",Q}(jr));g.serialization.registerClass(Ca);var Eo=function(re){function Q(C){var R=re.call(this,1,C)||this;return Q.verifyArgs(C),R.inputSpec=[{ndim:3}],R}return I(Q,re),Q.prototype.getConfig=function(){var C=re.prototype.getConfig.call(this);return delete C.rank,delete C.dataFormat,C},Q.verifyArgs=function(C){if(typeof C.kernelSize!="number"&&!en(C.kernelSize,"number",1,1))throw new te("Conv1D expects config.kernelSize to be number or number[] with length 1, but received "+JSON.stringify(C.kernelSize)+".")},Q.className="Conv1D",Q}(jr);g.serialization.registerClass(Eo);var za=function(re){function Q(C){var R=re.call(this,C)||this;return typeof C.cropping=="number"?R.cropping=[[C.cropping,C.cropping],[C.cropping,C.cropping]]:typeof C.cropping[0]=="number"?R.cropping=[[C.cropping[0],C.cropping[0]],[C.cropping[1],C.cropping[1]]]:R.cropping=C.cropping,R.dataFormat=C.dataFormat===void 0?"channelsLast":C.dataFormat,R.inputSpec=[{ndim:4}],R}return I(Q,re),Q.prototype.computeOutputShape=function(C){return this.dataFormat==="channelsFirst"?[C[0],C[1],C[2]-this.cropping[0][0]-this.cropping[0][1],C[3]-this.cropping[1][0]-this.cropping[1][1]]:[C[0],C[1]-this.cropping[0][0]-this.cropping[0][1],C[2]-this.cropping[1][0]-this.cropping[1][1],C[3]]},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){return C=ai(C),oe.dataFormat==="channelsLast"?Jn(Jn(C,oe.cropping[0][0],C.shape[1]-oe.cropping[0][0]-oe.cropping[0][1],2),oe.cropping[1][0],C.shape[2]-oe.cropping[1][1]-oe.cropping[1][0],3):Jn(Jn(C,oe.cropping[0][0],C.shape[2]-oe.cropping[0][0]-oe.cropping[0][1],3),oe.cropping[1][0],C.shape[3]-oe.cropping[1][1]-oe.cropping[1][0],4)})},Q.prototype.getConfig=function(){var C={cropping:this.cropping,dataFormat:this.dataFormat},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="Cropping2D",Q}(eo);g.serialization.registerClass(za);var Sf=function(re){function Q(C){var R=re.call(this,C)||this;return R.DEFAULT_SIZE=[2,2],R.inputSpec=[{ndim:4}],R.size=C.size==null?R.DEFAULT_SIZE:C.size,R.dataFormat=C.dataFormat==null?"channelsLast":C.dataFormat,R}return I(Q,re),Q.prototype.computeOutputShape=function(C){if(this.dataFormat==="channelsFirst"){var R=C[2]==null?null:this.size[0]*C[2],oe=C[3]==null?null:this.size[1]*C[3];return[C[0],C[1],R,oe]}return R=C[1]==null?null:this.size[0]*C[1],oe=C[2]==null?null:this.size[1]*C[2],[C[0],R,oe,C[3]]},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){var Ue=ai(C),Je=Ue.shape;if(oe.dataFormat==="channelsFirst"){Ue=Object(g.transpose)(Ue,[0,2,3,1]);var vt=oe.size[0]*Je[2],qt=oe.size[1]*Je[3],Jt=Ue.resizeNearestNeighbor([vt,qt]);return Object(g.transpose)(Jt,[0,3,1,2])}return vt=oe.size[0]*Je[1],qt=oe.size[1]*Je[2],Ue.resizeNearestNeighbor([vt,qt])})},Q.prototype.getConfig=function(){var C={size:this.size,dataFormat:this.dataFormat},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="UpSampling2D",Q}(eo);g.serialization.registerClass(Sf);var Zd=function(re){function Q(C){var R=re.call(this,2,C)||this;return R.depthwiseKernel=null,R.depthMultiplier=C.depthMultiplier==null?1:C.depthMultiplier,R.depthwiseInitializer=ui(C.depthwiseInitializer||R.DEFAULT_KERNEL_INITIALIZER),R.depthwiseConstraint=tr(C.depthwiseConstraint),R.depthwiseRegularizer=Ka(C.depthwiseRegularizer),R}return I(Q,re),Q.prototype.build=function(C){if((C=qn(C)).length<4)throw new te("Inputs to DepthwiseConv2D should have rank 4. Received input shape: "+JSON.stringify(C)+".");var R=this.dataFormat==="channelsFirst"?1:3;if(C[R]==null||C[R]<0)throw new te("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not ("+C[R]+").");var oe=C[R],Ue=[this.kernelSize[0],this.kernelSize[1],oe,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",Ue,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[oe*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){var Ue=function(Je,vt,qt,Jt,pt,Nn){return qt===void 0&&(qt=[1,1]),Jt===void 0&&(Jt="valid"),Object(g.tidy)(function(){pt==null&&(pt="channelsLast"),Lt(pt);var Pn=Qd(Je,pt);if(Je.rank!==4)throw new te("Input for depthwiseConv2d is required to be 4-D, but is instead "+Je.rank+"-D");if(vt.rank!==4)throw new te("depthwiseKernel is required to be 4-D, but is instead "+vt.rank+"-D");return Pn=Object(g.depthwiseConv2d)(Pn,vt,qt,Jt==="same"?"same":"valid","NHWC",Nn),pt==="channelsFirst"&&(Pn=Object(g.transpose)(Pn,[0,3,1,2])),Pn})}(C=ai(C),oe.depthwiseKernel.read(),oe.strides,oe.padding,oe.dataFormat,null);return oe.useBias&&(Ue=Ot(Ue,oe.bias.read(),oe.dataFormat)),oe.activation!=null&&(Ue=oe.activation.apply(Ue)),Ue})},Q.prototype.computeOutputShape=function(C){C=qn(C);var R=this.dataFormat==="channelsFirst"?C[2]:C[1],oe=this.dataFormat==="channelsFirst"?C[3]:C[2],Ue=this.dataFormat==="channelsFirst"?C[1]*this.depthMultiplier:C[3]*this.depthMultiplier,Je=cc(R,this.kernelSize[0],this.padding,this.strides[0]),vt=cc(oe,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[C[0],Ue,Je,vt]:[C[0],Je,vt,Ue]},Q.prototype.getConfig=function(){var C=re.prototype.getConfig.call(this);return C.depthMultiplier=this.depthMultiplier,C.depthwiseInitializer=kr(this.depthwiseInitializer),C.depthwiseRegularizer=_o(this.depthwiseRegularizer),C.depthwiseConstraint=Tn(this.depthwiseRegularizer),C},Q.className="DepthwiseConv2D",Q}(cr);g.serialization.registerClass(Zd);var Ru=function(re){function Q(C){var R=re.call(this,C)||this;return R.rate=Math.max(Math.min(C.rate,1),0),R.noiseShape=C.noiseShape,R.seed=C.seed,R.supportsMasking=!0,R}return I(Q,re),Q.prototype.getNoiseShape=function(C){if(this.noiseShape==null)return this.noiseShape;for(var R=C.shape,oe=[],Ue=0;Ue<this.noiseShape.length;++Ue)oe.push(this.noiseShape[Ue]==null?R[Ue]:this.noiseShape[Ue]);return oe},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){oe.invokeCallHook(C,R);var Ue=ai(C);if(0<oe.rate&&oe.rate<1){var Je=R.training!=null&&R.training,vt=oe.getNoiseShape(Ue);return $t(function(){return $r(Ue,oe.rate,vt,oe.seed)},function(){return Ue},Je)}return C})},Q.prototype.getConfig=function(){var C={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.prototype.dispose=function(){return re.prototype.dispose.call(this)},Q.className="Dropout",Q}(eo);g.serialization.registerClass(Ru);var Fl=function(re){function Q(C){var R=re.call(this,C)||this;return R.inputSpec=[{ndim:3}],R}return I(Q,re),Q.prototype.getNoiseShape=function(C){var R=C.shape;return[R[0],1,R[2]]},Q.className="SpatialDropout1D",Q}(Ru);g.serialization.registerClass(Fl);var Df=function(re){function Q(C){var R=re.call(this,C)||this;if(R.activation=null,R.useBias=!0,R.kernel=null,R.bias=null,R.DEFAULT_KERNEL_INITIALIZER="glorotNormal",R.DEFAULT_BIAS_INITIALIZER="zeros",C.batchInputShape==null&&C.inputShape==null&&C.inputDim!=null){var oe=null;C.batchSize!=null&&(oe=C.batchSize),R.batchInputShape=[oe,C.inputDim]}return R.units=C.units,Ut(R.units,"units"),R.activation=$a(C.activation),C.useBias!=null&&(R.useBias=C.useBias),R.kernelInitializer=ui(C.kernelInitializer||R.DEFAULT_KERNEL_INITIALIZER),R.biasInitializer=ui(C.biasInitializer||R.DEFAULT_BIAS_INITIALIZER),R.kernelConstraint=tr(C.kernelConstraint),R.biasConstraint=tr(C.biasConstraint),R.kernelRegularizer=Ka(C.kernelRegularizer),R.biasRegularizer=Ka(C.biasRegularizer),R.activityRegularizer=Ka(C.activityRegularizer),R.supportsMasking=!0,R.inputSpec=[{minNDim:2}],R}return I(Q,re),Q.prototype.build=function(C){var R,oe=(C=qn(C))[C.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[oe,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(R={},R[-1]=oe,R)}],this.built=!0},Q.prototype.computeOutputShape=function(C){var R=(C=qn(C)).slice();return R[R.length-1]=this.units,R},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){oe.invokeCallHook(C,R);var Ue,Je=ai(C),vt=Qe(oe.activation.getClassName());return vt!=null?Ue=Ei(Je,oe.kernel.read(),vt,oe.bias?oe.bias.read():null):(Ue=Ei(Je,oe.kernel.read()),oe.bias!=null&&(Ue=Ot(Ue,oe.bias.read())),oe.activation!=null&&(Ue=oe.activation.apply(Ue))),Ue})},Q.prototype.getConfig=function(){var C={units:this.units,activation:Iu(this.activation),useBias:this.useBias,kernelInitializer:kr(this.kernelInitializer),biasInitializer:kr(this.biasInitializer),kernelRegularizer:_o(this.kernelRegularizer),biasRegularizer:_o(this.biasRegularizer),activityRegularizer:_o(this.activityRegularizer),kernelConstraint:Tn(this.kernelConstraint),biasConstraint:Tn(this.biasConstraint)},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="Dense",Q}(eo);g.serialization.registerClass(Df);var af=function(re){function Q(C){var R=this;return C=C||{},(R=re.call(this,C)||this).inputSpec=[{minNDim:3}],R.dataFormat=C.dataFormat,R}return I(Q,re),Q.prototype.computeOutputShape=function(C){for(var R=0,oe=(C=qn(C)).slice(1);R<oe.length;R++)if(oe[R]==null)throw new te('The shape of the input to "Flatten" is not fully defined (got '+C.slice(1)+'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.');return[C[0],nn(C,1)]},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){oe.invokeCallHook(C,R);var Ue=ai(C);if(oe.dataFormat==="channelsFirst"&&Ue.rank>1){for(var Je=[0],vt=2;vt<Ue.rank;++vt)Je.push(vt);Je.push(1),Ue=Ue.transpose(Je)}return function(qt){if(qt.rank<=1)throw new te("batchFlatten requires a minimum rank of 2. Got rank: "+qt.rank+".");var Jt=[qt.shape[0],nn(qt.shape,1)];return qt.reshape(Jt)}(Ue)})},Q.prototype.getConfig=function(){var C={};this.dataFormat!=null&&(C.dataFormat=this.dataFormat);var R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="Flatten",Q}(eo);g.serialization.registerClass(af);var Tf=function(re){function Q(C){var R=re.call(this,C)||this;return R.supportsMasking=!0,R.activation=$a(C.activation),R}return I(Q,re),Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){oe.invokeCallHook(C,R);var Ue=ai(C);return oe.activation.apply(Ue)})},Q.prototype.getConfig=function(){var C={activation:Iu(this.activation)},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="Activation",Q}(eo);g.serialization.registerClass(Tf);var sf=function(re){function Q(C){var R=re.call(this,C)||this;return R.n=C.n,R.inputSpec=[{ndim:2}],R}return I(Q,re),Q.prototype.computeOutputShape=function(C){return[C[0],this.n,C[1]]},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){return function(Ue,Je){return Object(g.tidy)(function(){if(Ue.shape.length!==2)throw new te("repeat() expects a rank-2 tensor, but received a rank-"+Ue.shape.length+" tensor.");return Dr(Br(Ue,1),[1,Je,1])})}(C=ai(C),oe.n)})},Q.prototype.getConfig=function(){var C={n:this.n},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="RepeatVector",Q}(eo);g.serialization.registerClass(sf);var ma=function(re){function Q(C){var R=re.call(this,C)||this;R.targetShape=C.targetShape;for(var oe=0;oe<R.targetShape.length;++oe)R.isUnknown(R.targetShape[oe])&&(R.targetShape[oe]=null);return R}return I(Q,re),Q.prototype.isUnknown=function(C){return C<0||C==null},Q.prototype.fixUnknownDimension=function(C,R){for(var oe="Total size of new array must be unchanged.",Ue=R.slice(),Je=1,vt=null,qt=0;qt<Ue.length;++qt){var Jt=Ue[qt];if(this.isUnknown(Jt)){if(vt!==null)throw new te("Can only specifiy one unknown dimension.");vt=qt}else Je*=Jt}var pt=nn(C);if(vt!==null){if(Je===0||pt%Je!=0)throw new te(oe);Ue[vt]=pt/Je}else if(pt!==Je)throw new te(oe);return Ue},Q.prototype.computeOutputShape=function(C){for(var R=!1,oe=0;oe<C.length;++oe)if(this.isUnknown(C[oe])){R=!0;break}return R?C.slice(0,1).concat(this.targetShape):C.slice(0,1).concat(this.fixUnknownDimension(C.slice(1),this.targetShape))},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){oe.invokeCallHook(C,R);var Ue=ai(C),Je=Ue.shape,vt=Je.slice(0,1).concat(oe.fixUnknownDimension(Je.slice(1),oe.targetShape));return Ue.reshape(vt)})},Q.prototype.getConfig=function(){var C={targetShape:this.targetShape},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="Reshape",Q}(eo);g.serialization.registerClass(ma);var Dg=function(re){function Q(C){var R=re.call(this,C)||this;if(C.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(C.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+C.dims+" instead.");var oe=Fr(1,C.dims.length+1);if(!g.util.arraysEqual(C.dims.slice().sort(),oe))throw new Error("Invalid permutation `dims`: "+JSON.stringify(C.dims)+" `dims` must contain consecutive integers starting from 1.");return R.dims=C.dims,R.dimsIncludingBatch=[0].concat(R.dims),R.inputSpec=[new So({ndim:R.dims.length+1})],R}return I(Q,re),Q.prototype.computeOutputShape=function(C){var R=(C=qn(C)).slice();return this.dims.forEach(function(oe,Ue){R[Ue+1]=C[oe]}),R},Q.prototype.call=function(C,R){return Object(g.transpose)(ai(C),this.dimsIncludingBatch)},Q.prototype.getConfig=function(){var C={dims:this.dims},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="Permute",Q}(eo);g.serialization.registerClass(Dg);var eh=function(re){function Q(C){var R=re.call(this,C==null?{}:C)||this;return R.supportsMasking=!0,R.maskValue=C!=null?C.maskValue==null?0:C.maskValue:0,R}return I(Q,re),Q.prototype.computeOutputShape=function(C){return C},Q.prototype.getConfig=function(){var C=re.prototype.getConfig.call(this),R={maskValue:this.maskValue};return Object.assign(R,C),R},Q.prototype.computeMask=function(C,R){var oe=ai(C);return Object(g.any)(Object(g.notEqual)(oe,this.maskValue),-1)},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){oe.invokeCallHook(C,R);var Ue=ai(C),Je=Object(g.any)(Object(g.notEqual)(Ue,oe.maskValue),-1,!0);return Ue.mul(Je.asType(Ue.dtype))})},Q.className="Masking",Q}(eo);g.serialization.registerClass(eh);var Ua=function(re){function Q(C){var R=re.call(this,C)||this;if(R.embeddings=null,R.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",C.batchInputShape==null&&C.inputShape==null){var oe=null;C.batchSize!=null&&(oe=C.batchSize),C.inputLength==null?R.batchInputShape=[oe,null]:R.batchInputShape=[oe].concat(Oe(C.inputLength))}return R.inputDim=C.inputDim,Ut(R.inputDim,"inputDim"),R.outputDim=C.outputDim,Ut(R.outputDim,"outputDim"),R.embeddingsInitializer=ui(C.embeddingsInitializer||R.DEFAULT_EMBEDDINGS_INITIALIZER),R.embeddingsRegularizer=Ka(C.embeddingsRegularizer),R.activityRegularizer=Ka(C.activityRegularizer),R.embeddingsConstraint=tr(C.embeddingsConstraint),R.maskZero=C.maskZero,R.supportsMasking=C.maskZero,R.inputLength=C.inputLength,R}return I(Q,re),Q.prototype.build=function(C){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},Q.prototype.warnOnIncompatibleInputShape=function(C){},Q.prototype.computeMask=function(C,R){var oe=this;return Object(g.tidy)(function(){return oe.maskZero?(C=ai(C),Object(g.notEqual)(C,Object(g.zerosLike)(C))):null})},Q.prototype.computeOutputShape=function(C){if(C=qn(C),this.inputLength==null)return C.concat([this.outputDim]);var R=Oe(this.inputLength);if(R.length!==C.length-1)throw new te('"inputLength" is '+this.inputLength+", but received input shape has shape "+C);for(var oe=0,Ue=0;Ue<R.length;++Ue){var Je=R[Ue],vt=C[Ue+1];if(Je!=null&&vt!=null&&Je!==vt)throw new te('"inputLength" is '+this.inputLength+", but received input shape has shape "+C);Je==null&&(R[oe]=vt),oe++}return[C[0]].concat(R,[this.outputDim])},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){oe.invokeCallHook(C,R);var Ue=ai(C);return Ue.dtype!=="int32"&&(Ue=Pr(Ue,"int32")),mo(oe.embeddings.read(),Ue.as1D()).reshape(qn(oe.computeOutputShape(Ue.shape)))})},Q.prototype.getConfig=function(){var C={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:kr(this.embeddingsInitializer),embeddingsRegularizer:_o(this.embeddingsRegularizer),activityRegularizer:_o(this.activityRegularizer),embeddingsConstraint:Tn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="Embedding",Q}(eo);g.serialization.registerClass(Ua);var Ms=function(re){function Q(C){var R=re.call(this,C||{})||this;return R.supportsMasking=!0,R}return I(Q,re),Q.prototype.mergeFunction=function(C){throw new F},Q.prototype.computeElementwiseOpOutputShape=function(C,R){if(C==null||R==null)return null;if(C.length<R.length)return this.computeElementwiseOpOutputShape(R,C);if(R.length===0)return C;for(var oe=C.slice(0,C.length-R.length),Ue=0;Ue<R.length;++Ue){var Je=C[C.length-R.length+Ue],vt=R[Ue];if(Je==null||vt==null||Je<0||vt<0)oe.push(null);else if(Je===1)oe.push(vt);else if(vt===1)oe.push(Je);else{if(Je!==vt)throw new te("Operands could not be broadcast together with shapes "+JSON.stringify(C)+" "+JSON.stringify(R));oe.push(Je)}}return oe},Q.prototype.build=function(C){if(Array.isArray(C)&&!Array.isArray(C[0])&&(C=[qn(C)]),(C=C).length<2)throw new te("A merge layer should be called on an Array of at least 2 inputs. Got "+C.length+" input(s).");for(var R=[],oe=0,Ue=C;oe<Ue.length;oe++)(qt=Ue[oe])!=null&&qt[0]!==null&&R.push(qt[0]);if((R=tn(R)).length>1)throw new te("Can not merge tensors with different batch sizes. Got tensors with shapes: "+JSON.stringify(C)+".");for(var Je=C[0]==null?null:C[0].slice(1),vt=1;vt<C.length;++vt){var qt=C[vt]==null?null:C[vt].slice(1);Je=this.computeElementwiseOpOutputShape(Je,qt)}var Jt=C.map(function(pt){return pt.length});C.indexOf(null)===-1&&tn(Jt).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){if(C=C,oe.reshapeRequired){var Ue=[],Je=C.map(function(Pi){return Pi.rank});if(Je.indexOf(null)===-1){for(var vt=jn(Je),qt=0,Jt=C;qt<Jt.length;qt++){for(var pt=(Yn=Jt[qt]).rank,Nn=0;Nn<vt-pt;++Nn)Yn=Br(Yn,1);Ue.push(Yn)}return oe.mergeFunction(Ue)}for(var Pn=!1,Vn=0,rr=C;Vn<rr.length;Vn++){var Yn;if((pt=(Yn=rr[Vn]).rank)==null){var br=Yn.shape,xr=br[0],Lr=br.slice(1).concat([xr]),Hr=Yn.reshape([xr].concat(nn(br.slice(1))));Hr=(Hr=Object(g.transpose)(Hr,[1,0])).reshape(Lr),Ue.push(Hr),Pn=!0}else if(pt>1){var yi=Fr(1,pt).concat([0]);Ue.push(Object(g.transpose)(Yn,yi)),Pn=!0}else Ue.push(Yn)}var zr=oe.mergeFunction(Ue),li=zr.rank;if(Pn)if(li==null){var pi=zr.shape;Lr=[xr=pi[pi.length-1]].concat(pi.slice(0,pi.length-1)),zr=Object(g.transpose)(zr.reshape([-1,xr]),[1,0]).reshape(Lr)}else li>1&&(yi=[li-1].concat(Fr(0,li-1)),zr=Object(g.transpose)(zr,yi));return zr}return oe.mergeFunction(C)})},Q.prototype.computeOutputShape=function(C){var R;R=(C=C)[0]==null?null:C[0].slice(1);for(var oe=1;oe<C.length;++oe){var Ue=C[oe]==null?null:C[oe].slice(1);R=this.computeElementwiseOpOutputShape(R,Ue)}for(var Je=[],vt=0,qt=C;vt<qt.length;vt++)(Ue=qt[vt])!=null&&Ue[0]!==null&&Je.push(Ue[0]);return(Je=tn(Je)).length===1?Je.concat(R):[null].concat(R)},Q.prototype.computeMask=function(C,R){return Object(g.tidy)(function(){if(R==null)return null;if(!Array.isArray(R))throw new te("`mask` should be an Array");if(!Array.isArray(C))throw new te("`inputs` should be an Array");if(R.length!==C.length)throw new te("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths ("+C.length+" vs "+R.length+")");if(R.every(function(Je){return Je==null}))return null;for(var oe=(R=R.map(function(Je){return Je==null?Je:Object(g.expandDims)(Je,0)}))[0],Ue=1;Ue<R.length-1;++Ue)oe=Object(g.logicalAnd)(oe,R[Ue]);return oe})},Q}(eo),Xs=function(re){function Q(C){return re.call(this,C)||this}return I(Q,re),Q.prototype.mergeFunction=function(C){return Object(g.tidy)(function(){for(var R=C[0].clone(),oe=1;oe<C.length;++oe)R=Object(g.add)(R,C[oe]);return R})},Q.className="Add",Q}(Ms);g.serialization.registerClass(Xs);var Co=function(re){function Q(C){return re.call(this,C)||this}return I(Q,re),Q.prototype.mergeFunction=function(C){return Object(g.tidy)(function(){for(var R=C[0].clone(),oe=1;oe<C.length;++oe)R=Object(g.mul)(R,C[oe]);return R})},Q.className="Multiply",Q}(Ms);g.serialization.registerClass(Co);var cu=function(re){function Q(C){return re.call(this,C)||this}return I(Q,re),Q.prototype.mergeFunction=function(C){return Object(g.tidy)(function(){for(var R=C[0].clone(),oe=1;oe<C.length;++oe)R=Object(g.add)(R,C[oe]);return Object(g.mul)(1/C.length,R)})},Q.className="Average",Q}(Ms);g.serialization.registerClass(cu);var lc=function(re){function Q(C){return re.call(this,C)||this}return I(Q,re),Q.prototype.mergeFunction=function(C){return Object(g.tidy)(function(){for(var R=C[0],oe=1;oe<C.length;++oe)R=Object(g.maximum)(R,C[oe]);return R})},Q.className="Maximum",Q}(Ms);g.serialization.registerClass(lc);var Es=function(re){function Q(C){return re.call(this,C)||this}return I(Q,re),Q.prototype.mergeFunction=function(C){return Object(g.tidy)(function(){for(var R=C[0],oe=1;oe<C.length;++oe)R=Object(g.minimum)(R,C[oe]);return R})},Q.className="Minimum",Q}(Ms);g.serialization.registerClass(Es);var uf=function(re){function Q(C){var R=re.call(this,C)||this;return R.DEFAULT_AXIS=-1,C==null&&(C={}),R.axis=C.axis==null?R.DEFAULT_AXIS:C.axis,R.supportsMasking=!0,R.reshapeRequired=!1,R}return I(Q,re),Q.prototype.build=function(C){if(!Array.isArray(C)||!Array.isArray(C[0])||C.length===1)throw new te("A `Concatenate` layer should be called on a list of at least 2 inputs");for(var R=!0,oe=0,Ue=C=C;oe<Ue.length;oe++)if((Pn=Ue[oe])!=null){R=!1;break}if(!R){for(var Je=[],vt=0;vt<C.length;++vt){var qt=C[vt].slice();qt.splice(this.axis,1);for(var Jt=!1,pt=0,Nn=Je;pt<Nn.length;pt++){var Pn=Nn[pt];if(g.util.arraysEqual(Pn,qt)){Jt=!0;break}}Jt||Je.push(qt)}if(Je.length>1)throw new te("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(C))}},Q.prototype.mergeFunction=function(C){var R=this;return Object(g.tidy)(function(){return di(C,R.axis)})},Q.prototype.computeOutputShape=function(C){if(!Array.isArray(C)||!Array.isArray(C[0]))throw new te("A `Concatenate` layer should be called on a list of inputs.");for(var R=C,oe=R[0].slice(),Ue=this.axis<0?oe.length+this.axis:this.axis,Je=0,vt=R.slice(1);Je<vt.length;Je++){var qt=vt[Je];if(oe[Ue]==null||qt[Ue]==null){oe[Ue]=null;break}oe[Ue]+=qt[Ue]}return oe},Q.prototype.computeMask=function(C,R){var oe=this;if(R==null)return null;if(!Array.isArray(R))throw new te("`mask` should be an array for Concatenate");if(!Array.isArray(C))throw new te("`inputs` should be an array for Concatenate");if(R.length!==C.length)throw new te("Mismatch in the length of mask ("+R.length+") and the legnth of inputs ("+C.length+")");return Object(g.tidy)(function(){var Ue=!0;if(R.forEach(function(Jt){Jt==null||(Ue=!1)}),Ue)return null;for(var Je=[],vt=0;vt<C.length;++vt)R[vt]==null?Je.push(Object(g.onesLike)(C[vt]).asType("bool")):R[vt].rank<C[vt].rank?Je.push(Object(g.expandDims)(R[vt],-1)):Je.push(R[vt]);var qt=Object(g.concat)(Je,oe.axis);return Object(g.all)(qt,-1,!1)})},Q.prototype.getConfig=function(){var C={axis:this.axis},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="Concatenate",Q}(Ms);function Pc(re,Q){for(;re<0;)re+=Q;return re}g.serialization.registerClass(uf);var Bh=function(re){function Q(C){var R=re.call(this,C)||this;return R.axes=C.axes,R.normalize=C.normalize!=null&&C.normalize,R.supportsMasking=!0,R.reshapeRequired=!1,R}return I(Q,re),Q.prototype.build=function(C){g.util.assert(Array.isArray(C)&&C.length===2&&Array.isArray(C[0])&&Array.isArray(C[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var R=C[0],oe=C[1];if(R.length>3||oe.length>3)throw new F("Dot layer does not support tensors of 4D or higher rank yet.");var Ue=this.interpretAxes(R,oe);if(R[Ue[0]]!==oe[Ue[1]])throw new te("Dimension incompatibility: "+R[Ue[0]]+" !== "+oe[Ue[1]])},Q.prototype.mergeFunction=function(C){if(C.length!==2)throw new te("A `Dot` layer must be called on exactly 2 inputs, but received "+C.length+" input(s).");var R,oe=C[0],Ue=C[1];return R=Array.isArray(this.axes)?this.axes.map(function(Je,vt){return Pc(Je,C[vt].shape.length)}):[Pc(this.axes,oe.shape.length),Pc(this.axes,Ue.shape.length)],this.normalize&&(oe=$c(oe,R[0]),Ue=$c(Ue,R[1])),function(Je,vt,qt){if(Je.shape.length>3||vt.shape.length>3)throw new F("batchDot is not implemented for tensors of 4D or higher rank yet");if(g.util.assert(Je.shape.length>=2,function(){return"batchDot requires the rank of x to be >= 2, but got "+Je.shape.length}),g.util.assert(Je.shape.length>=2,function(){return"batchDot requires the rank of y to be >= 2, but got "+vt.shape.length}),typeof qt=="number"&&(qt=[qt,qt]),Je.dtype==="complex64"||vt.dtype==="complex64")throw new F("batchDot is not implemented for complex64-type Tensors yet.");var Jt=Je.shape.length,pt=vt.shape.length;qt==null&&(qt=[Jt-1,pt-2]);var Nn=qt;return Object(g.tidy)(function(){var Pn,Vn;if(Jt>pt){Pn=Jt-pt;for(var rr=[],Yn=0;Yn<Pn;++Yn)rr.push(1);vt=vt.reshape(vt.shape.concat(rr))}else if(pt>Jt){for(Pn=pt-Jt,rr=[],Yn=0;Yn<Pn;++Yn)rr.push(1);Je=Je.reshape(Je.shape.concat(rr))}else Pn=0;if(Je.shape.length===2&&vt.shape.length===2)Vn=Nn[0]===Nn[1]?Je.mulStrict(vt).sum(Nn[0]):Je.transpose([1,0]).mulStrict(vt).sum(Nn[1]);else{var br=Nn[0]!==Je.shape.length-1,xr=Nn[1]===vt.shape.length-1;Vn=Je.matMul(vt,br,xr)}if(Pn>0){var Lr,Hr=[];for(Yn=Lr=Jt>pt?Jt+pt-3:Jt-1;Yn<Lr+Pn;++Yn)Hr.push(Yn);Vn=Vn.squeeze(Hr)}return Vn.shape.length===1&&(Vn=Vn.expandDims(1)),Vn})}(oe,Ue,R)},Q.prototype.interpretAxes=function(C,R){return Array.isArray(this.axes)?this.axes:[Pc(this.axes,C.length),Pc(this.axes,R.length)]},Q.prototype.computeOutputShape=function(C){g.util.assert(Array.isArray(C)&&C.length===2&&Array.isArray(C[0])&&Array.isArray(C[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var R=C[0].slice(),oe=C[1].slice();if(R.length>3||oe.length>3)throw new F("Dot layer does not support tensors of 4D or higher rank yet.");var Ue=this.interpretAxes(R,oe);R.splice(Ue[0],1),oe.splice(Ue[1],1),oe.splice(0,1);var Je=R.concat(oe);return Je.length===1&&Je.push(1),Je},Q.prototype.computeMask=function(C,R){return null},Q.prototype.getConfig=function(){var C={axes:this.axes,normalize:this.normalize},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="Dot",Q}(Ms);g.serialization.registerClass(Bh);var Ph=function(re){function Q(C){var R=re.call(this,C)||this;return R.supportsMasking=!0,R.stddev=C.stddev,R}return I(Q,re),Q.prototype.computeOutputShape=function(C){return C},Q.prototype.getConfig=function(){var C=re.prototype.getConfig.call(this),R={stddev:this.stddev};return Object.assign(R,C),R},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){oe.invokeCallHook(C,R);var Ue=ai(C);return $t(function(){return ki(Ue.shape,0,oe.stddev).add(Ue)},function(){return Ue},R.training||!1)})},Q.className="GaussianNoise",Q}(eo);g.serialization.registerClass(Ph);var Rl=function(re){function Q(C){var R=re.call(this,C)||this;return R.supportsMasking=!0,R.rate=C.rate,R}return I(Q,re),Q.prototype.computeOutputShape=function(C){return C},Q.prototype.getConfig=function(){var C=re.prototype.getConfig.call(this),R={rate:this.rate};return Object.assign(R,C),R},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){oe.invokeCallHook(C,R);var Ue=ai(C);return oe.rate>0&&oe.rate<1?$t(function(){var Je=Math.sqrt(oe.rate/(1-oe.rate));return Ue.mul(ki(Ue.shape,1,Je))},function(){return Ue},R.training||!1):Ue})},Q.className="GaussianDropout",Q}(eo);g.serialization.registerClass(Rl);var ep=function(re){function Q(C){var R=re.call(this,C)||this;return R.supportsMasking=!0,R.rate=C.rate,R.noiseShape=C.noiseShape,R}return I(Q,re),Q.prototype._getNoiseShape=function(C){return this.noiseShape||ai(C).shape},Q.prototype.computeOutputShape=function(C){return C},Q.prototype.getConfig=function(){var C=re.prototype.getConfig.call(this),R={rate:this.rate};return Object.assign(R,C),R},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){if(oe.rate<1&&oe.rate>0){var Ue=oe._getNoiseShape(C);return $t(function(){var Je=ai(C),vt=-1.7580993408473766,qt=Object(g.greaterEqual)(Object(g.randomUniform)(Ue),oe.rate);qt=Pr(qt,"float32");var Jt=Math.pow((1-oe.rate)*(1+oe.rate*Math.pow(vt,2)),-.5),pt=-Jt*vt*oe.rate;return Je.mul(qt).add(qt.add(-1).mul(vt)).mul(Jt).add(pt)},function(){return ai(C)},R.training||!1)}return C})},Q.className="AlphaDropout",Q}(eo);function Oc(re,Q,C,R,oe,Ue){var Je;if(Ue===void 0&&(Ue=.001),re.rank===2)Je=Object(g.batchNorm2d)(re,Q,C,R,oe,Ue);else if(re.rank===3)Je=Object(g.batchNorm3d)(re,Q,C,R,oe,Ue);else{if(re.rank!==4)throw new F("batchNormalization is not implemented for array of rank "+re.rank+" yet");Je=Object(g.batchNorm4d)(re,Q,C,R,oe,Ue)}return Je}function th(re,Q,C,R,oe){return oe===void 0&&(oe=.001),g.util.arraysEqual(R.slice().sort(),Fr(0,re.rank-1))?function(Ue,Je,vt,qt,Jt){return Jt===void 0&&(Jt=.001),Object(g.tidy)(function(){var pt=Object(g.moments)(Ue,qt),Nn=pt.mean,Pn=pt.variance;return[Oc(Ue,Nn,Pn,vt,Je,Jt),Nn,Pn]})}(re,Q,C,R,oe):function(Ue,Je,vt,qt,Jt){return Jt===void 0&&(Jt=.001),Object(g.tidy)(function(){for(var pt=Object(g.moments)(Ue,qt),Nn=pt.mean,Pn=pt.variance,Vn=[],rr=0,Yn=Fr(0,Ue.rank);rr<Yn.length;rr++){var br=Yn[rr];qt.indexOf(br)!==-1?Vn.push(1):Vn.push(Ue.shape[br])}var xr=Nn.reshape(Vn),Lr=Pn.reshape(Vn),Hr=Je==null?null:Je.reshape(Vn),yi=vt==null?null:vt.reshape(Vn);return[Oc(Ue,xr,Lr,yi,Hr,Jt),Nn,Pn]})}(re,Q,C,R,oe)}g.serialization.registerClass(ep);var Lh=function(re){function Q(C){var R=this;return C==null&&(C={}),(R=re.call(this,C)||this).supportsMasking=!0,R.axis=C.axis==null?-1:C.axis,R.momentum=C.momentum==null?.99:C.momentum,R.epsilon=C.epsilon==null?.001:C.epsilon,R.center=C.center==null||C.center,R.scale=C.scale==null||C.scale,R.betaInitializer=ui(C.betaInitializer||"zeros"),R.gammaInitializer=ui(C.gammaInitializer||"ones"),R.movingMeanInitializer=ui(C.movingMeanInitializer||"zeros"),R.movingVarianceInitializer=ui(C.movingVarianceInitializer||"ones"),R.betaConstraint=tr(C.betaConstraint),R.gammaConstraint=tr(C.gammaConstraint),R.betaRegularizer=Ka(C.betaRegularizer),R.gammaRegularizer=Ka(C.gammaRegularizer),R}return I(Q,re),Q.prototype.build=function(C){var R;C=qn(C);var oe=this.axis>=0?this.axis:this.axis+C.length,Ue=C[oe];if(Ue==null)throw new te("Axis "+oe+" of input tensor should have a defined dimension but the layer received an input with shape "+JSON.stringify(C)+".");this.inputSpec=[new So({ndim:C.length,axes:(R={},R[oe]=Ue,R)})];var Je=[Ue];this.scale&&(this.gamma=this.addWeight("gamma",Je,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",Je,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",Je,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",Je,null,this.movingVarianceInitializer,null,!1),this.built=!0},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){var Ue=R.training!=null&&R.training,Je=ai(C),vt=Je.shape,qt=vt.length,Jt=Fr(0,qt),pt=oe.axis>=0?oe.axis:oe.axis+qt;Jt.splice(pt,1);var Nn=se(1,qt);Nn[pt]=vt[pt];var Pn=Jt.slice();Pn.sort();var Vn=!g.util.arraysEqual(Pn,Fr(0,qt).slice(0,qt-1));if(!Ue)return function(){if(Vn){var Hr=oe.movingMean.read().reshape(Nn),yi=oe.movingVariance.read().reshape(Nn),zr=oe.center?oe.beta.read().reshape(Nn):null,li=oe.scale?oe.gamma.read().reshape(Nn):null;return Oc(Je,Hr,yi,zr,li,oe.epsilon)}return Oc(Je,oe.movingMean.read(),oe.movingVariance.read(),oe.beta==null?null:oe.beta.read(),oe.gamma==null?null:oe.gamma.read(),oe.epsilon)}();var rr=th(Je,oe.gamma.read(),oe.beta.read(),Jt,oe.epsilon),Yn=rr[0],br=rr[1],xr=rr[2],Lr=function(Hr,yi,zr){Object(g.tidy)(function(){var li=1-zr,pi=Hr.read(),Pi=pi.sub(yi).mul(li);Hr.write(pi.sub(Pi))})};return Lr(oe.movingMean,br,oe.momentum),Lr(oe.movingVariance,xr,oe.momentum),Yn})},Q.prototype.getConfig=function(){var C={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:kr(this.betaInitializer),gammaInitializer:kr(this.gammaInitializer),movingMeanInitializer:kr(this.movingMeanInitializer),movingVarianceInitializer:kr(this.movingVarianceInitializer),betaRegularizer:_o(this.betaRegularizer),gammaRegularizer:_o(this.gammaRegularizer),betaConstraint:Tn(this.betaConstraint),gammaConstraint:Tn(this.gammaConstraint)},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="BatchNormalization",Q}(eo);g.serialization.registerClass(Lh);var zh=function(re){function Q(C){var R=this;if(C==null&&(C={}),(R=re.call(this,C)||this).axis=C.axis==null?-1:C.axis,typeof R.axis=="number"){if(!Number.isInteger(R.axis))throw new Error("Expected axis to be an integer, but received "+R.axis)}else{if(!Array.isArray(R.axis))throw new Error("Expected axis to be an integer or an array of integers, but received "+JSON.stringify(R.axis));for(var oe=0,Ue=R.axis;oe<Ue.length;oe++){var Je=Ue[oe];if(!Number.isInteger(Je))throw new Error("Expected axis to be an array of integers, but received "+JSON.stringify(R.axis))}}return R.epsilon=C.epsilon==null?.001:C.epsilon,R.center=C.center==null||C.center,R.scale=C.scale==null||C.scale,R.betaInitializer=ui(C.betaInitializer||"zeros"),R.gammaInitializer=ui(C.gammaInitializer||"ones"),R.betaRegularizer=Ka(C.betaRegularizer),R.gammaRegularizer=Ka(C.gammaRegularizer),R.supportsMasking=!0,R}return I(Q,re),Q.prototype.build=function(C){var R=(C=qn(C)).length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(var oe=0;oe<this.axis.length;++oe)this.axis[oe]<0&&(this.axis[oe]+=R);for(var Ue=0,Je=this.axis;Ue<Je.length;Ue++){var vt=Je[Ue];if(vt<0||vt>=R)throw new Error("Invalid axis: "+vt)}if(this.axis.length!==tn(this.axis).length)throw new Error("Found duplicate axes in: "+this.axis);var qt=this.axis.map(function(Jt){return C[Jt]});this.scale?this.gamma=this.addWeight("gamma",qt,"float32",this.gammaInitializer,this.gammaRegularizer,!0):this.gamma=null,this.center?this.beta=this.addWeight("beta",qt,"float32",this.betaInitializer,this.betaRegularizer,!0):this.beta=null,this.built=!0},Q.prototype.call=function(C,R){var oe=this,Ue=ai(C),Je=Ue.shape,vt=Je.length;return Object(g.tidy)(function(){for(var qt=Object(g.moments)(Ue,oe.axis,!0),Jt=qt.mean,pt=qt.variance,Nn=se(1,vt),Pn=0,Vn=oe.axis;Pn<Vn.length;Pn++){var rr=Vn[Pn];Nn[rr]=Je[rr]}for(var Yn=function(zr){return zr!=null&&zr.shape.length!==vt&&oe.axis!==[vt-1]?zr.reshape(Nn):zr},br=Yn(oe.gamma.read()),xr=Yn(oe.beta.read()),Lr=[],Hr=[],yi=0;yi<vt;++yi)oe.axis.indexOf(yi)!==-1?(Lr.push(Je[yi]),Hr.push(1)):(Lr.push(1),Hr.push(Je[yi]));return Jt=Jt.tile(Lr),pt=pt.tile(Lr),br=br.tile(Hr),xr=xr.tile(Hr),Oc(Ue,Jt,pt,xr,br,oe.epsilon)})},Q.prototype.getConfig=function(){var C={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:kr(this.betaInitializer),gammaInitializer:kr(this.gammaInitializer),betaRegularizer:_o(this.betaRegularizer),gammaRegularizer:_o(this.gammaRegularizer)},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="LayerNormalization",Q}(eo);g.serialization.registerClass(zh);var jm=function(re){function Q(C){var R=this;if(C==null&&(C={}),(R=re.call(this,C)||this).dataFormat=C.dataFormat==null?"channelsLast":C.dataFormat,C.padding==null)R.padding=[[1,1],[1,1]];else if(typeof C.padding=="number")R.padding=[[C.padding,C.padding],[C.padding,C.padding]];else{if(C.padding=C.padding,C.padding.length!==2)throw new te("ZeroPadding2D expects padding to be a length-2 array, but received a length-"+C.padding.length+" array.");var oe=void 0,Ue=void 0;if(typeof C.padding[0]=="number")oe=[C.padding[0],C.padding[0]],Ue=[C.padding[1],C.padding[1]];else{if(C.padding=C.padding,C.padding[0].length!==2)throw new te("ZeroPadding2D expects height padding to be a length-2 array, but received a length-"+C.padding[0].length+" array.");if(oe=C.padding[0],C.padding[1].length!==2)throw new te("ZeroPadding2D expects width padding to be a length-2 array, but received a length-"+C.padding[1].length+" array.");Ue=C.padding[1]}R.padding=[oe,Ue]}return R.inputSpec=[new So({ndim:4})],R}return I(Q,re),Q.prototype.computeOutputShape=function(C){var R,oe;return C=qn(C),this.dataFormat==="channelsFirst"?(R=C[2]!=null&&C[2]>=0?C[2]+this.padding[0][0]+this.padding[0][1]:null,oe=C[3]!=null&&C[3]>=0?C[3]+this.padding[1][0]+this.padding[1][1]:null,[C[0],C[1],R,oe]):(R=C[1]!=null&&C[1]>=0?C[1]+this.padding[0][0]+this.padding[0][1]:null,oe=C[2]!=null&&C[2]>=0?C[2]+this.padding[1][0]+this.padding[1][1]:null,[C[0],R,oe,C[3]])},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){return function(Ue,Je,vt){return Object(g.tidy)(function(){if(Ue.rank!==4)throw new te("temporalPadding expects input tensor to be 4-D, but received a "+Ue.rank+"-D tensor.");if(Je==null&&(Je=[[1,1],[1,1]]),Je.length!==2||Je[0].length!==2||Je[1].length!==2)throw new te("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(vt==null&&(vt="channelsLast"),vt!=="channelsLast"&&vt!=="channelsFirst")throw new te("Unknown data format: "+vt+". Supported data formats are 'channelsLast' and 'channelsFirst.");var qt;return qt=vt==="channelsFirst"?[[0,0],[0,0],Je[0],Je[1]]:[[0,0],Je[0],Je[1],[0,0]],Object(g.pad)(Ue,qt)})}(ai(C),oe.padding,oe.dataFormat)})},Q.prototype.getConfig=function(){var C={padding:this.padding,dataFormat:this.dataFormat},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="ZeroPadding2D",Q}(eo);function xd(re,Q,C,R,oe,Ue){return Object(g.tidy)(function(){var Je;Lt(oe),Cn(Ue),zn(R),C==null&&(C=[1,1]),R==null&&(R="valid"),oe==null&&(oe="channelsLast"),Ue==null&&(Ue="max"),re=Qd(re,oe);var vt=R==="same"?"same":"valid";return Je=Ue==="max"?Object(g.maxPool)(re,Q,C,vt):Object(g.avgPool)(re,Q,C,vt),oe==="channelsFirst"&&(Je=Object(g.transpose)(Je,[0,3,1,2])),Je})}function Ml(re,Q,C,R,oe,Ue){return Object(g.tidy)(function(){var Je;Lt(oe),Cn(Ue),zn(R),C==null&&(C=[1,1,1]),R==null&&(R="valid"),oe==null&&(oe="channelsLast"),Ue==null&&(Ue="max"),re=wo(re,oe);var vt=R==="same"?"same":"valid";return Je=Ue==="max"?Object(g.maxPool3d)(re,Q,C,vt):Object(g.avgPool3d)(re,Q,C,vt),oe==="channelsFirst"&&(Je=Object(g.transpose)(Je,[0,4,1,2,3])),Je})}g.serialization.registerClass(jm);var Uh=function(re){function Q(C){var R=this;if(C.poolSize==null&&(C.poolSize=2),R=re.call(this,C)||this,typeof C.poolSize=="number")R.poolSize=[C.poolSize];else{if(!Array.isArray(C.poolSize)||C.poolSize.length!==1||typeof C.poolSize[0]!="number")throw new te("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(C.poolSize));R.poolSize=C.poolSize}if(Ut(R.poolSize,"poolSize"),C.strides==null)R.strides=R.poolSize;else if(typeof C.strides=="number")R.strides=[C.strides];else{if(!Array.isArray(C.strides)||C.strides.length!==1||typeof C.strides[0]!="number")throw new te("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(C.strides));R.strides=C.strides}return Ut(R.strides,"strides"),R.padding=C.padding==null?"valid":C.padding,zn(R.padding),R.inputSpec=[new So({ndim:3})],R}return I(Q,re),Q.prototype.computeOutputShape=function(C){var R=cc((C=qn(C))[1],this.poolSize[0],this.padding,this.strides[0]);return[C[0],R,C[2]]},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){oe.invokeCallHook(C,R),C=Br(ai(C),2);var Ue=oe.poolingFunction(ai(C),[oe.poolSize[0],1],[oe.strides[0],1],oe.padding,"channelsLast");return Object(g.squeeze)(Ue,[2])})},Q.prototype.getConfig=function(){var C={poolSize:this.poolSize,padding:this.padding,strides:this.strides},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q}(eo),Wh=function(re){function Q(C){return re.call(this,C)||this}return I(Q,re),Q.prototype.poolingFunction=function(C,R,oe,Ue,Je){return Lt(Je),zn(Ue),xd(C,R,oe,Ue,Je,"max")},Q.className="MaxPooling1D",Q}(Uh);g.serialization.registerClass(Wh);var Os=function(re){function Q(C){return re.call(this,C)||this}return I(Q,re),Q.prototype.poolingFunction=function(C,R,oe,Ue,Je){return Lt(Je),zn(Ue),xd(C,R,oe,Ue,Je,"avg")},Q.className="AveragePooling1D",Q}(Uh);g.serialization.registerClass(Os);var nh=function(re){function Q(C){var R=this;if(C.poolSize==null&&(C.poolSize=[2,2]),(R=re.call(this,C)||this).poolSize=Array.isArray(C.poolSize)?C.poolSize:[C.poolSize,C.poolSize],C.strides==null)R.strides=R.poolSize;else if(Array.isArray(C.strides)){if(C.strides.length!==2)throw new te("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+C.strides.length+".");R.strides=C.strides}else R.strides=[C.strides,C.strides];return Ut(R.poolSize,"poolSize"),Ut(R.strides,"strides"),R.padding=C.padding==null?"valid":C.padding,R.dataFormat=C.dataFormat==null?"channelsLast":C.dataFormat,Lt(R.dataFormat),zn(R.padding),R.inputSpec=[new So({ndim:4})],R}return I(Q,re),Q.prototype.computeOutputShape=function(C){C=qn(C);var R=this.dataFormat==="channelsFirst"?C[2]:C[1],oe=this.dataFormat==="channelsFirst"?C[3]:C[2];return R=cc(R,this.poolSize[0],this.padding,this.strides[0]),oe=cc(oe,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[C[0],C[1],R,oe]:[C[0],R,oe,C[3]]},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){return oe.invokeCallHook(C,R),oe.poolingFunction(ai(C),oe.poolSize,oe.strides,oe.padding,oe.dataFormat)})},Q.prototype.getConfig=function(){var C={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q}(eo),Yu=function(re){function Q(C){return re.call(this,C)||this}return I(Q,re),Q.prototype.poolingFunction=function(C,R,oe,Ue,Je){return Lt(Je),zn(Ue),xd(C,R,oe,Ue,Je,"max")},Q.className="MaxPooling2D",Q}(nh);g.serialization.registerClass(Yu);var Vh=function(re){function Q(C){return re.call(this,C)||this}return I(Q,re),Q.prototype.poolingFunction=function(C,R,oe,Ue,Je){return Lt(Je),zn(Ue),xd(C,R,oe,Ue,Je,"avg")},Q.className="AveragePooling2D",Q}(nh);g.serialization.registerClass(Vh);var Ss=function(re){function Q(C){var R=this;if(C.poolSize==null&&(C.poolSize=[2,2,2]),(R=re.call(this,C)||this).poolSize=Array.isArray(C.poolSize)?C.poolSize:[C.poolSize,C.poolSize,C.poolSize],C.strides==null)R.strides=R.poolSize;else if(Array.isArray(C.strides)){if(C.strides.length!==3)throw new te("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+C.strides.length+".");R.strides=C.strides}else R.strides=[C.strides,C.strides,C.strides];return Ut(R.poolSize,"poolSize"),Ut(R.strides,"strides"),R.padding=C.padding==null?"valid":C.padding,R.dataFormat=C.dataFormat==null?"channelsLast":C.dataFormat,Lt(R.dataFormat),zn(R.padding),R.inputSpec=[new So({ndim:5})],R}return I(Q,re),Q.prototype.computeOutputShape=function(C){C=qn(C);var R=this.dataFormat==="channelsFirst"?C[2]:C[1],oe=this.dataFormat==="channelsFirst"?C[3]:C[2],Ue=this.dataFormat==="channelsFirst"?C[4]:C[3];return R=cc(R,this.poolSize[0],this.padding,this.strides[0]),oe=cc(oe,this.poolSize[1],this.padding,this.strides[1]),Ue=cc(Ue,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[C[0],C[1],R,oe,Ue]:[C[0],R,oe,Ue,C[4]]},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){return oe.invokeCallHook(C,R),oe.poolingFunction(ai(C),oe.poolSize,oe.strides,oe.padding,oe.dataFormat)})},Q.prototype.getConfig=function(){var C={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q}(eo),lu=function(re){function Q(C){return re.call(this,C)||this}return I(Q,re),Q.prototype.poolingFunction=function(C,R,oe,Ue,Je){return Lt(Je),zn(Ue),Ml(C,R,oe,Ue,Je,"max")},Q.className="MaxPooling3D",Q}(Ss);g.serialization.registerClass(lu);var Gp=function(re){function Q(C){return re.call(this,C)||this}return I(Q,re),Q.prototype.poolingFunction=function(C,R,oe,Ue,Je){return Lt(Je),zn(Ue),Ml(C,R,oe,Ue,Je,"avg")},Q.className="AveragePooling3D",Q}(Ss);g.serialization.registerClass(Gp);var wd=function(re){function Q(C){var R=re.call(this,C)||this;return R.inputSpec=[new So({ndim:3})],R}return I(Q,re),Q.prototype.computeOutputShape=function(C){return[C[0],C[2]]},Q.prototype.call=function(C,R){throw new F},Q}(eo),rh=function(re){function Q(C){return re.call(this,C||{})||this}return I(Q,re),Q.prototype.call=function(C,R){return Object(g.tidy)(function(){var oe=ai(C);return Object(g.mean)(oe,1)})},Q.className="GlobalAveragePooling1D",Q}(wd);g.serialization.registerClass(rh);var $p=function(re){function Q(C){return re.call(this,C||{})||this}return I(Q,re),Q.prototype.call=function(C,R){return Object(g.tidy)(function(){var oe=ai(C);return Object(g.max)(oe,1)})},Q.className="GlobalMaxPooling1D",Q}(wd);g.serialization.registerClass($p);var kd=function(re){function Q(C){var R=re.call(this,C)||this;return R.dataFormat=C.dataFormat==null?"channelsLast":C.dataFormat,Lt(R.dataFormat),R.inputSpec=[new So({ndim:4})],R}return I(Q,re),Q.prototype.computeOutputShape=function(C){return C=C,this.dataFormat==="channelsLast"?[C[0],C[3]]:[C[0],C[1]]},Q.prototype.call=function(C,R){throw new F},Q.prototype.getConfig=function(){var C={dataFormat:this.dataFormat},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q}(eo),ln=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){var Ue=ai(C);return oe.dataFormat==="channelsLast"?Object(g.mean)(Ue,[1,2]):Object(g.mean)(Ue,[2,3])})},Q.className="GlobalAveragePooling2D",Q}(kd);g.serialization.registerClass(ln);var Ju=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){var Ue=ai(C);return oe.dataFormat==="channelsLast"?Object(g.max)(Ue,[1,2]):Object(g.max)(Ue,[2,3])})},Q.className="GlobalMaxPooling2D",Q}(kd);function er(re,Q,C,R){if(Array.isArray(re)){if(Q!=null||C!=null)throw new te("When inputs is an array, neither initialState or constants should be provided");R!=null&&(C=re.slice(re.length-R,re.length),re=re.slice(0,re.length-R)),re.length>1&&(Q=re.slice(1,re.length)),re=re[0]}function oe(Ue){return Ue==null||Array.isArray(Ue)?Ue:[Ue]}return{inputs:re,initialState:Q=oe(Q),constants:C=oe(C)}}function ru(re,Q,C,R,oe,Ue,Je,vt){return R===void 0&&(R=!1),Je===void 0&&(Je=!1),vt===void 0&&(vt=!1),Object(g.tidy)(function(){var qt=Q.shape.length;if(qt<3)throw new te("Input should be at least 3D, but is "+qt+"D.");var Jt=[1,0].concat(Fr(2,qt));if(Q=Object(g.transpose)(Q,Jt),Ue!=null)throw new F("The rnn() functoin of the deeplearn.js backend does not support constants yet.");Je&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),oe!=null&&((oe=oe.asType("bool").asType("float32")).rank===qt-1&&(oe=Object(g.expandDims)(oe,-1)),oe=Object(g.transpose)(oe,Jt)),R&&(Q=Object(g.reverse)(Q,0),oe!=null&&(oe=Object(g.reverse)(oe,0)));var pt,Nn,Pn=[],Vn=C,rr=Q.shape[0],Yn=Object(g.unstack)(Q);oe!=null&&(Nn=Object(g.unstack)(oe));for(var br,xr=function(Hr){var yi=Yn[Hr],zr=Object(g.tidy)(function(){return re(yi,Vn)});if(oe==null)pt=zr[0],Vn=zr[1];else{var li=Object(g.tidy)(function(){var pi=Nn[Hr],Pi=Object(g.onesLike)(pi).sub(pi);return{output:zr[0].mul(pi).addStrict(Vn[0].mul(Pi)),newStates:Vn.map(function(qi,bi){return zr[1][bi].mul(pi).addStrict(qi.mul(Pi))})}});pt=li.output,Vn=li.newStates}vt&&Pn.push(pt)},Lr=0;Lr<rr;++Lr)xr(Lr);return vt&&(br=Object(g.stack)(Pn,1)),[pt,br,Vn]})}g.serialization.registerClass(Ju);var Fo=function(re){function Q(C){var R,oe=re.call(this,C)||this;if(C.cell==null)throw new te("cell property is missing for the constructor of RNN.");if((R=Array.isArray(C.cell)?new nl({cells:C.cell}):C.cell).stateSize==null)throw new te("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return oe.cell=R,oe.returnSequences=C.returnSequences!=null&&C.returnSequences,oe.returnState=C.returnState!=null&&C.returnState,oe.goBackwards=C.goBackwards!=null&&C.goBackwards,oe._stateful=C.stateful!=null&&C.stateful,oe.unroll=C.unroll!=null&&C.unroll,oe.supportsMasking=!0,oe.inputSpec=[new So({ndim:3})],oe.stateSpec=null,oe.states_=null,oe.numConstants=null,oe.keptStates=[],oe}return I(Q,re),Q.prototype.getStates=function(){return this.states_==null?Fr(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(function(C){return null}):this.states_},Q.prototype.setStates=function(C){this.states_=C},Q.prototype.computeOutputShape=function(C){$i(C)&&(C=C[0]),C=C;var R=this.cell.stateSize;Array.isArray(R)||(R=[R]);var oe,Ue=R[0];if(oe=this.returnSequences?[C[0],C[1],Ue]:[C[0],Ue],this.returnState){for(var Je=[],vt=0,qt=R;vt<qt.length;vt++){var Jt=qt[vt];Je.push([C[0],Jt])}return[oe].concat(Je)}return oe},Q.prototype.computeMask=function(C,R){var oe=this;return Object(g.tidy)(function(){Array.isArray(R)&&(R=R[0]);var Ue=oe.returnSequences?R:null;if(oe.returnState){var Je=oe.states.map(function(vt){return null});return[Ue].concat(Je)}return Ue})},Object.defineProperty(Q.prototype,"states",{get:function(){if(this.states_==null){for(var C=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,R=[],oe=0;oe<C;++oe)R.push(null);return R}return this.states_},set:function(C){this.states_=C},enumerable:!0,configurable:!0}),Q.prototype.build=function(C){if(this.numConstants!=null)throw new F("Constants support is not implemented in RNN yet.");$i(C)&&(C=C[0]),C=C;var R=this.stateful?C[0]:null,oe=C[C.length-1];this.inputSpec[0]=new So({shape:[R,null,oe]});var Ue,Je=[C[0]].concat(C.slice(2));if(this.cell.build(Je),Ue=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],this.stateSpec!=null){if(!g.util.arraysEqual(this.stateSpec.map(function(vt){return vt.shape[vt.shape.length-1]}),Ue))throw new te("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec="+this.stateSpec+"; However cell.stateSize is "+this.cell.stateSize)}else this.stateSpec=Ue.map(function(vt){return new So({shape:[null,vt]})});this.stateful&&this.resetStates()},Q.prototype.resetStates=function(C,R){var oe=this;R===void 0&&(R=!1),Object(g.tidy)(function(){if(!oe.stateful)throw new $("Cannot call resetStates() on an RNN Layer that is not stateful.");var Ue=oe.inputSpec[0].shape[0];if(Ue==null)throw new te("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(oe.states_==null)Array.isArray(oe.cell.stateSize)?oe.states_=oe.cell.stateSize.map(function(pt){return Object(g.zeros)([Ue,pt])}):oe.states_=[Object(g.zeros)([Ue,oe.cell.stateSize])];else if(C==null)Object(g.dispose)(oe.states_),oe.keptStates!=null&&(Object(g.dispose)(oe.keptStates),oe.keptStates=[]),Array.isArray(oe.cell.stateSize)?oe.states_=oe.cell.stateSize.map(function(pt){return Object(g.zeros)([Ue,pt])}):oe.states_[0]=Object(g.zeros)([Ue,oe.cell.stateSize]);else{if(Array.isArray(C)||(C=[C]),C.length!==oe.states_.length)throw new te("Layer "+oe.name+" expects "+oe.states_.length+" state(s), but it received "+C.length+" state value(s). Input received: "+C);R===!0?oe.keptStates.push(oe.states_.slice()):Object(g.dispose)(oe.states_);for(var Je=0;Je<oe.states_.length;++Je){var vt=C[Je],qt=Array.isArray(oe.cell.stateSize)?oe.cell.stateSize[Je]:oe.cell.stateSize,Jt=[Ue,qt];if(!g.util.arraysEqual(vt.shape,Jt))throw new te("State "+Je+" is incompatible with layer "+oe.name+": expected shape="+Jt+", received shape="+vt.shape);oe.states_[Je]=vt}}oe.states_=oe.states_.map(function(pt){return Object(g.keep)(pt.clone())})})},Q.prototype.apply=function(C,R){var oe=R==null?null:R.initialState,Ue=R==null?null:R.constants;R==null&&(R={});var Je=er(C,oe,Ue,this.numConstants);C=Je.inputs,oe=Je.initialState,Ue=Je.constants;var vt=[],qt=[];if(oe!=null){R.initialState=oe,vt=vt.concat(oe),this.stateSpec=[];for(var Jt=0,pt=oe;Jt<pt.length;Jt++){var Nn=pt[Jt];this.stateSpec.push(new So({shape:Nn.shape}))}qt=qt.concat(this.stateSpec)}if(Ue!=null&&(R.constants=Ue,vt=vt.concat(Ue),this.numConstants=Ue.length),vt[0]instanceof To){var Pn=[C].concat(vt),Vn=this.inputSpec.concat(qt),rr=this.inputSpec;this.inputSpec=Vn;var Yn=re.prototype.apply.call(this,Pn,R);return this.inputSpec=rr,Yn}return re.prototype.apply.call(this,C,R)},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){var Ue=R==null?null:R.mask,Je=R==null?null:R.training,vt=R==null?null:R.initialState;C=ai(C),vt==null&&(vt=oe.stateful?oe.states_:oe.getInitialState(C));var qt=Array.isArray(oe.cell.stateSize)?oe.cell.stateSize.length:1;if(vt.length!==qt)throw new te("RNN Layer has "+qt+" state(s) but was passed "+vt.length+" initial state(s).");oe.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var Jt={training:Je},pt=ru(function(Yn,br){var xr=oe.cell.call([Yn].concat(br),Jt);return[xr[0],xr.slice(1)]},C,vt,oe.goBackwards,Ue,null,oe.unroll,oe.returnSequences),Nn=pt[0],Pn=pt[1],Vn=pt[2];oe.stateful&&oe.resetStates(Vn,Je);var rr=oe.returnSequences?Pn:Nn;return oe.returnState?[rr].concat(Vn):rr})},Q.prototype.getInitialState=function(C){var R=this;return Object(g.tidy)(function(){var oe=Object(g.zeros)(C.shape);return oe=Br(oe=Object(g.sum)(oe,[1,2])),Array.isArray(R.cell.stateSize)?R.cell.stateSize.map(function(Ue){return Ue>1?Dr(oe,[1,Ue]):oe}):R.cell.stateSize>1?[Dr(oe,[1,R.cell.stateSize])]:[oe]})},Object.defineProperty(Q.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),Q.prototype.setFastWeightInitDuringBuild=function(C){re.prototype.setFastWeightInitDuringBuild.call(this,C),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(C)},Q.prototype.getConfig=function(){var C={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(C.numConstants=this.numConstants);var R=this.cell.getConfig();C.cell={className:this.cell.getClassName(),config:R};var oe=re.prototype.getConfig.call(this);return Object.assign(C,oe),C},Q.fromConfig=function(C,R,oe){oe===void 0&&(oe={});var Ue=ha(R.cell,oe);return new C(Object.assign(R,{cell:Ue}))},Q.className="RNN",Q}(eo);g.serialization.registerClass(Fo);var cf=function(re){function Q(){return re!==null&&re.apply(this,arguments)||this}return I(Q,re),Q}(eo),jl=function(re){function Q(C){var R=re.call(this,C)||this;return R.DEFAULT_ACTIVATION="tanh",R.DEFAULT_KERNEL_INITIALIZER="glorotNormal",R.DEFAULT_RECURRENT_INITIALIZER="orthogonal",R.DEFAULT_BIAS_INITIALIZER="zeros",R.units=C.units,Ut(R.units,"units"),R.activation=$a(C.activation==null?R.DEFAULT_ACTIVATION:C.activation),R.useBias=C.useBias==null||C.useBias,R.kernelInitializer=ui(C.kernelInitializer||R.DEFAULT_KERNEL_INITIALIZER),R.recurrentInitializer=ui(C.recurrentInitializer||R.DEFAULT_RECURRENT_INITIALIZER),R.biasInitializer=ui(C.biasInitializer||R.DEFAULT_BIAS_INITIALIZER),R.kernelRegularizer=Ka(C.kernelRegularizer),R.recurrentRegularizer=Ka(C.recurrentRegularizer),R.biasRegularizer=Ka(C.biasRegularizer),R.kernelConstraint=tr(C.kernelConstraint),R.recurrentConstraint=tr(C.recurrentConstraint),R.biasConstraint=tr(C.biasConstraint),R.dropout=or([1,jn([0,C.dropout==null?0:C.dropout])]),R.recurrentDropout=or([1,jn([0,C.recurrentDropout==null?0:C.recurrentDropout])]),R.stateSize=R.units,R.dropoutMask=null,R.recurrentDropoutMask=null,R}return I(Q,re),Q.prototype.build=function(C){C=qn(C),this.kernel=this.addWeight("kernel",[C[C.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){if((C=C).length!==2)throw new te("SimpleRNNCell expects 2 input Tensors, got "+C.length+".");var Ue=C[1];C=C[0];var Je,vt=R.training!=null&&R.training;0<oe.dropout&&oe.dropout<1&&oe.dropoutMask==null&&(oe.dropoutMask=wu(function(){return Object(g.onesLike)(C)},oe.dropout,vt)),0<oe.recurrentDropout&&oe.recurrentDropout<1&&oe.recurrentDropoutMask==null&&(oe.recurrentDropoutMask=wu(function(){return Object(g.onesLike)(Ue)},oe.recurrentDropout,vt));var qt=oe.dropoutMask,Jt=oe.recurrentDropoutMask;Je=Ei(qt!=null?Object(g.mul)(C,qt):C,oe.kernel.read()),oe.bias!=null&&(Je=Ot(Je,oe.bias.read())),Jt!=null&&(Ue=Object(g.mul)(Ue,Jt));var pt=Object(g.add)(Je,Ei(Ue,oe.recurrentKernel.read()));return oe.activation!=null&&(pt=oe.activation.apply(pt)),[pt,pt]})},Q.prototype.getConfig=function(){var C={units:this.units,activation:Iu(this.activation),useBias:this.useBias,kernelInitializer:kr(this.kernelInitializer),recurrentInitializer:kr(this.recurrentInitializer),biasInitializer:kr(this.biasInitializer),kernelRegularizer:_o(this.kernelRegularizer),recurrentRegularizer:_o(this.recurrentRegularizer),biasRegularizer:_o(this.biasRegularizer),activityRegularizer:_o(this.activityRegularizer),kernelConstraint:Tn(this.kernelConstraint),recurrentConstraint:Tn(this.recurrentConstraint),biasConstraint:Tn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="SimpleRNNCell",Q}(cf);g.serialization.registerClass(jl);var wr=function(re){function Q(C){return C.cell=new jl(C),re.call(this,C)||this}return I(Q,re),Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){oe.cell.dropoutMask!=null&&(Object(g.dispose)(oe.cell.dropoutMask),oe.cell.dropoutMask=null),oe.cell.recurrentDropoutMask!=null&&(Object(g.dispose)(oe.cell.recurrentDropoutMask),oe.cell.recurrentDropoutMask=null);var Ue=R==null?null:R.mask,Je=R==null?null:R.training,vt=R==null?null:R.initialState;return re.prototype.call.call(oe,C,{mask:Ue,training:Je,initialState:vt})})},Object.defineProperty(Q.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Q.prototype.getConfig=function(){var C={units:this.units,activation:Iu(this.activation),useBias:this.useBias,kernelInitializer:kr(this.kernelInitializer),recurrentInitializer:kr(this.recurrentInitializer),biasInitializer:kr(this.biasInitializer),kernelRegularizer:_o(this.kernelRegularizer),recurrentRegularizer:_o(this.recurrentRegularizer),biasRegularizer:_o(this.biasRegularizer),activityRegularizer:_o(this.activityRegularizer),kernelConstraint:Tn(this.kernelConstraint),recurrentConstraint:Tn(this.recurrentConstraint),biasConstraint:Tn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},R=re.prototype.getConfig.call(this);return delete R.cell,Object.assign(C,R),C},Q.fromConfig=function(C,R){return new C(R)},Q.className="SimpleRNN",Q}(Fo);g.serialization.registerClass(wr);var fu=function(re){function Q(C){var R=re.call(this,C)||this;return R.DEFAULT_ACTIVATION="tanh",R.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",R.DEFAULT_KERNEL_INITIALIZER="glorotNormal",R.DEFAULT_RECURRENT_INITIALIZER="orthogonal",R.DEFAULT_BIAS_INITIALIZER="zeros",R.units=C.units,Ut(R.units,"units"),R.activation=$a(C.activation===void 0?R.DEFAULT_ACTIVATION:C.activation),R.recurrentActivation=$a(C.recurrentActivation===void 0?R.DEFAULT_RECURRENT_ACTIVATION:C.recurrentActivation),R.useBias=C.useBias==null||C.useBias,R.kernelInitializer=ui(C.kernelInitializer||R.DEFAULT_KERNEL_INITIALIZER),R.recurrentInitializer=ui(C.recurrentInitializer||R.DEFAULT_RECURRENT_INITIALIZER),R.biasInitializer=ui(C.biasInitializer||R.DEFAULT_BIAS_INITIALIZER),R.kernelRegularizer=Ka(C.kernelRegularizer),R.recurrentRegularizer=Ka(C.recurrentRegularizer),R.biasRegularizer=Ka(C.biasRegularizer),R.kernelConstraint=tr(C.kernelConstraint),R.recurrentConstraint=tr(C.recurrentConstraint),R.biasConstraint=tr(C.biasConstraint),R.dropout=or([1,jn([0,C.dropout==null?0:C.dropout])]),R.recurrentDropout=or([1,jn([0,C.recurrentDropout==null?0:C.recurrentDropout])]),R.implementation=C.implementation,R.stateSize=R.units,R.dropoutMask=null,R.recurrentDropoutMask=null,R}return I(Q,re),Q.prototype.build=function(C){var R=(C=qn(C))[C.length-1];this.kernel=this.addWeight("kernel",[R,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){if((C=C).length!==2)throw new te("GRUCell expects 2 input Tensors (inputs, h, c), got "+C.length+".");var Ue=R.training!=null&&R.training,Je=C[1];C=C[0],0<oe.dropout&&oe.dropout<1&&oe.dropoutMask==null&&(oe.dropoutMask=wu(function(){return Object(g.onesLike)(C)},oe.dropout,Ue,3)),0<oe.recurrentDropout&&oe.recurrentDropout<1&&oe.recurrentDropoutMask==null&&(oe.recurrentDropoutMask=wu(function(){return Object(g.onesLike)(Je)},oe.recurrentDropout,Ue,3));var vt,qt,Jt,pt=oe.dropoutMask,Nn=oe.recurrentDropoutMask;0<oe.dropout&&oe.dropout<1&&(C=Object(g.mul)(C,pt[0]));var Pn=Ei(C,oe.kernel.read());oe.useBias&&(Pn=Ot(Pn,oe.bias.read())),0<oe.recurrentDropout&&oe.recurrentDropout<1&&(Je=Object(g.mul)(Je,Nn[0]));var Vn=oe.recurrentKernel.read(),rr=Object(g.split)(Vn,[2*oe.units,oe.units],Vn.rank-1),Yn=rr[0],br=rr[1],xr=Ei(Je,Yn),Lr=Object(g.split)(Pn,3,Pn.rank-1),Hr=Lr[0],yi=Lr[1],zr=Lr[2],li=Object(g.split)(xr,2,xr.rank-1),pi=li[0],Pi=li[1];vt=oe.recurrentActivation.apply(Object(g.add)(Hr,pi)),qt=oe.recurrentActivation.apply(Object(g.add)(yi,Pi));var qi=Ei(Object(g.mul)(qt,Je),br);Jt=oe.activation.apply(Object(g.add)(zr,qi));var bi=Object(g.add)(Object(g.mul)(vt,Je),Object(g.mul)(Object(g.add)(1,Object(g.neg)(vt)),Jt));return[bi,bi]})},Q.prototype.getConfig=function(){var C={units:this.units,activation:Iu(this.activation),recurrentActivation:Iu(this.recurrentActivation),useBias:this.useBias,kernelInitializer:kr(this.kernelInitializer),recurrentInitializer:kr(this.recurrentInitializer),biasInitializer:kr(this.biasInitializer),kernelRegularizer:_o(this.kernelRegularizer),recurrentRegularizer:_o(this.recurrentRegularizer),biasRegularizer:_o(this.biasRegularizer),activityRegularizer:_o(this.activityRegularizer),kernelConstraint:Tn(this.kernelConstraint),recurrentConstraint:Tn(this.recurrentConstraint),biasConstraint:Tn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="GRUCell",Q}(cf);g.serialization.registerClass(fu);var Ds=function(re){function Q(C){return C.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),C.cell=new fu(C),re.call(this,C)||this}return I(Q,re),Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){oe.cell.dropoutMask!=null&&(Object(g.dispose)(oe.cell.dropoutMask),oe.cell.dropoutMask=null),oe.cell.recurrentDropoutMask!=null&&(Object(g.dispose)(oe.cell.recurrentDropoutMask),oe.cell.recurrentDropoutMask=null);var Ue=R==null?null:R.mask,Je=R==null?null:R.training,vt=R==null?null:R.initialState;return re.prototype.call.call(oe,C,{mask:Ue,training:Je,initialState:vt})})},Object.defineProperty(Q.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),Q.prototype.getConfig=function(){var C={units:this.units,activation:Iu(this.activation),recurrentActivation:Iu(this.recurrentActivation),useBias:this.useBias,kernelInitializer:kr(this.kernelInitializer),recurrentInitializer:kr(this.recurrentInitializer),biasInitializer:kr(this.biasInitializer),kernelRegularizer:_o(this.kernelRegularizer),recurrentRegularizer:_o(this.recurrentRegularizer),biasRegularizer:_o(this.biasRegularizer),activityRegularizer:_o(this.activityRegularizer),kernelConstraint:Tn(this.kernelConstraint),recurrentConstraint:Tn(this.recurrentConstraint),biasConstraint:Tn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},R=re.prototype.getConfig.call(this);return delete R.cell,Object.assign(C,R),C},Q.fromConfig=function(C,R){return R.implmentation===0&&(R.implementation=1),new C(R)},Q.className="GRU",Q}(Fo);g.serialization.registerClass(Ds);var Ro=function(re){function Q(C){var R=re.call(this,C)||this;return R.DEFAULT_ACTIVATION="tanh",R.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",R.DEFAULT_KERNEL_INITIALIZER="glorotNormal",R.DEFAULT_RECURRENT_INITIALIZER="orthogonal",R.DEFAULT_BIAS_INITIALIZER="zeros",R.units=C.units,Ut(R.units,"units"),R.activation=$a(C.activation===void 0?R.DEFAULT_ACTIVATION:C.activation),R.recurrentActivation=$a(C.recurrentActivation===void 0?R.DEFAULT_RECURRENT_ACTIVATION:C.recurrentActivation),R.useBias=C.useBias==null||C.useBias,R.kernelInitializer=ui(C.kernelInitializer||R.DEFAULT_KERNEL_INITIALIZER),R.recurrentInitializer=ui(C.recurrentInitializer||R.DEFAULT_RECURRENT_INITIALIZER),R.biasInitializer=ui(C.biasInitializer||R.DEFAULT_BIAS_INITIALIZER),R.unitForgetBias=C.unitForgetBias,R.kernelRegularizer=Ka(C.kernelRegularizer),R.recurrentRegularizer=Ka(C.recurrentRegularizer),R.biasRegularizer=Ka(C.biasRegularizer),R.kernelConstraint=tr(C.kernelConstraint),R.recurrentConstraint=tr(C.recurrentConstraint),R.biasConstraint=tr(C.biasConstraint),R.dropout=or([1,jn([0,C.dropout==null?0:C.dropout])]),R.recurrentDropout=or([1,jn([0,C.recurrentDropout==null?0:C.recurrentDropout])]),R.implementation=C.implementation,R.stateSize=[R.units,R.units],R.dropoutMask=null,R.recurrentDropoutMask=null,R}return I(Q,re),Q.prototype.build=function(C){var R,oe,Ue=(C=qn(C))[C.length-1];if(this.kernel=this.addWeight("kernel",[Ue,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var Je=this.biasInitializer,vt=this.units;oe=new((R=function(qt){function Jt(){return qt!==null&&qt.apply(this,arguments)||this}return I(Jt,qt),Jt.prototype.apply=function(pt,Nn){var Pn=Je.apply([vt]),Vn=new ot().apply([vt]),rr=Je.apply([2*vt]);return ri(ri(Pn,Vn),rr)},Jt}(ke)).className="CustomInit",R)}else oe=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,oe,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){var Ue=R.training!=null&&R.training;if((C=C).length!==3)throw new te("LSTMCell expects 3 input Tensors (inputs, h, c), got "+C.length+".");var Je=C[1],vt=C[2];C=C[0],0<oe.dropout&&oe.dropout<1&&oe.dropoutMask==null&&(oe.dropoutMask=wu(function(){return Object(g.onesLike)(C)},oe.dropout,Ue,4)),0<oe.recurrentDropout&&oe.recurrentDropout<1&&oe.recurrentDropoutMask==null&&(oe.recurrentDropoutMask=wu(function(){return Object(g.onesLike)(Je)},oe.recurrentDropout,Ue,4));var qt,Jt,pt,Nn,Pn=oe.dropoutMask,Vn=oe.recurrentDropoutMask;0<oe.dropout&&oe.dropout<1&&(C=Object(g.mul)(C,Pn[0]));var rr=Ei(C,oe.kernel.read());0<oe.recurrentDropout&&oe.recurrentDropout<1&&(Je=Object(g.mul)(Je,Vn[0])),rr=Object(g.add)(rr,Ei(Je,oe.recurrentKernel.read())),oe.useBias&&(rr=Ot(rr,oe.bias.read()));var Yn=Object(g.split)(rr,4,rr.rank-1),br=Yn[0],xr=Yn[1],Lr=Yn[2],Hr=Yn[3];qt=oe.recurrentActivation.apply(br),Jt=oe.recurrentActivation.apply(xr),pt=Object(g.add)(Object(g.mul)(Jt,vt),Object(g.mul)(qt,oe.activation.apply(Lr))),Nn=oe.recurrentActivation.apply(Hr);var yi=Object(g.mul)(Nn,oe.activation.apply(pt));return[yi,yi,pt]})},Q.prototype.getConfig=function(){var C={units:this.units,activation:Iu(this.activation),recurrentActivation:Iu(this.recurrentActivation),useBias:this.useBias,kernelInitializer:kr(this.kernelInitializer),recurrentInitializer:kr(this.recurrentInitializer),biasInitializer:kr(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:_o(this.kernelRegularizer),recurrentRegularizer:_o(this.recurrentRegularizer),biasRegularizer:_o(this.biasRegularizer),activityRegularizer:_o(this.activityRegularizer),kernelConstraint:Tn(this.kernelConstraint),recurrentConstraint:Tn(this.recurrentConstraint),biasConstraint:Tn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.className="LSTMCell",Q}(cf);g.serialization.registerClass(Ro);var yl=function(re){function Q(C){return C.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),C.cell=new Ro(C),re.call(this,C)||this}return I(Q,re),Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){oe.cell.dropoutMask!=null&&(Object(g.dispose)(oe.cell.dropoutMask),oe.cell.dropoutMask=null),oe.cell.recurrentDropoutMask!=null&&(Object(g.dispose)(oe.cell.recurrentDropoutMask),oe.cell.recurrentDropoutMask=null);var Ue=R==null?null:R.mask,Je=R==null?null:R.training,vt=R==null?null:R.initialState;return re.prototype.call.call(oe,C,{mask:Ue,training:Je,initialState:vt})})},Object.defineProperty(Q.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"unitForgetBias",{get:function(){return this.cell.unitForgetBias},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),Q.prototype.getConfig=function(){var C={units:this.units,activation:Iu(this.activation),recurrentActivation:Iu(this.recurrentActivation),useBias:this.useBias,kernelInitializer:kr(this.kernelInitializer),recurrentInitializer:kr(this.recurrentInitializer),biasInitializer:kr(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:_o(this.kernelRegularizer),recurrentRegularizer:_o(this.recurrentRegularizer),biasRegularizer:_o(this.biasRegularizer),activityRegularizer:_o(this.activityRegularizer),kernelConstraint:Tn(this.kernelConstraint),recurrentConstraint:Tn(this.recurrentConstraint),biasConstraint:Tn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},R=re.prototype.getConfig.call(this);return delete R.cell,Object.assign(C,R),C},Q.fromConfig=function(C,R){return R.implmentation===0&&(R.implementation=1),new C(R)},Q.className="LSTM",Q}(Fo);g.serialization.registerClass(yl);var nl=function(re){function Q(C){var R=re.call(this,C)||this;return R.cells=C.cells,R}return I(Q,re),Object.defineProperty(Q.prototype,"stateSize",{get:function(){for(var C=[],R=0,oe=this.cells.slice().reverse();R<oe.length;R++){var Ue=oe[R];Array.isArray(Ue.stateSize)?C.push.apply(C,Ue.stateSize):C.push(Ue.stateSize)}return C},enumerable:!0,configurable:!0}),Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){for(var Ue=(C=C).slice(1),Je=[],vt=0,qt=oe.cells.slice().reverse();vt<qt.length;vt++){var Jt=qt[vt];Array.isArray(Jt.stateSize)?Je.push(Ue.splice(0,Jt.stateSize.length)):Je.push(Ue.splice(0,1))}Je.reverse();for(var pt,Nn=[],Pn=0;Pn<oe.cells.length;++Pn)Jt=oe.cells[Pn],Ue=Je[Pn],pt=Pn===0?[C[0]].concat(Ue):[pt[0]].concat(Ue),pt=Jt.call(pt,R),Nn.push(pt.slice(1));Ue=[];for(var Vn=0,rr=Nn.slice().reverse();Vn<rr.length;Vn++){var Yn=rr[Vn];Ue.push.apply(Ue,Yn)}return[pt[0]].concat(Ue)})},Q.prototype.build=function(C){var R;$i(C)&&(C=C[0]),C=C,this.cells.forEach(function(oe,Ue){lr("RNNCell_"+Ue,function(){oe.build(C),R=Array.isArray(oe.stateSize)?oe.stateSize[0]:oe.stateSize,C=[C[0],R]})}),this.built=!0},Q.prototype.getConfig=function(){for(var C=[],R=0,oe=this.cells;R<oe.length;R++){var Ue=oe[R];C.push({className:Ue.getClassName(),config:Ue.getConfig()})}var Je={cells:C},vt=re.prototype.getConfig.call(this);return Object.assign(Je,vt),Je},Q.fromConfig=function(C,R,oe){oe===void 0&&(oe={});for(var Ue=[],Je=0,vt=R.cells;Je<vt.length;Je++){var qt=vt[Je];Ue.push(ha(qt,oe))}return new C({cells:Ue})},Object.defineProperty(Q.prototype,"trainableWeights",{get:function(){if(!this.trainable)return[];for(var C=[],R=0,oe=this.cells;R<oe.length;R++){var Ue=oe[R];C.push.apply(C,Ue.trainableWeights)}return C},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"nonTrainableWeights",{get:function(){for(var C=[],R=0,oe=this.cells;R<oe.length;R++){var Ue=oe[R];C.push.apply(C,Ue.nonTrainableWeights)}if(!this.trainable){for(var Je=[],vt=0,qt=this.cells;vt<qt.length;vt++)Ue=qt[vt],Je.push.apply(Je,Ue.trainableWeights);return Je.concat(C)}return C},enumerable:!0,configurable:!0}),Q.prototype.getWeights=function(){for(var C=[],R=0,oe=this.cells;R<oe.length;R++){var Ue=oe[R];C.push.apply(C,Ue.weights)}return Wo(C)},Q.prototype.setWeights=function(C){for(var R=[],oe=0,Ue=this.cells;oe<Ue.length;oe++)for(var Je=Ue[oe],vt=Je.weights.length,qt=C.splice(vt),Jt=0;Jt<Je.weights.length;++Jt)R.push([Je.weights[Jt],qt[Jt]]);Oo(R)},Q.className="StackedRNNCells",Q}(cf);function wu(re,Q,C,R){function oe(){return $r(re(),Q)}if(C===void 0&&(C=null),R===void 0&&(R=1),R>1){for(var Ue=[],Je=0;Je<R;Je++)Ue.push($t(oe,re,C));return Ue.map(function(vt){return Object(g.keep)(vt.clone())})}return Object(g.keep)($t(oe,re,C).clone())}g.serialization.registerClass(nl);var Bl=function(re){function Q(C){var R=re.call(this,C)||this;return R.layer=C.layer,R}return I(Q,re),Q.prototype.build=function(C){this.built=!0},Object.defineProperty(Q.prototype,"trainable",{get:function(){return this.layer!=null&&this.layer.trainable},set:function(C){this.layer!=null&&(this.layer.trainable=C)},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),Q.prototype.getWeights=function(){return this.layer.getWeights()},Q.prototype.setWeights=function(C){this.layer.setWeights(C)},Q.prototype.getConfig=function(){var C={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.prototype.setFastWeightInitDuringBuild=function(C){re.prototype.setFastWeightInitDuringBuild.call(this,C),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(C)},Q.fromConfig=function(C,R,oe){oe===void 0&&(oe={});var Ue=ha(R.layer,oe);delete R.layer;var Je={layer:Ue};return Object.assign(Je,R),new C(Je)},Q}(eo),Kt=function(re){function Q(C){var R=re.call(this,C)||this;return R.supportsMasking=!0,R}return I(Q,re),Q.prototype.build=function(C){if((C=qn(C)).length<3)throw new te("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(C));this.inputSpec=[{shape:C}];var R=[C[0]].concat(C.slice(2));this.layer.built||(this.layer.build(R),this.layer.built=!0),re.prototype.build.call(this,C)},Q.prototype.computeOutputShape=function(C){var R=[(C=qn(C))[0]].concat(C.slice(2)),oe=this.layer.computeOutputShape(R),Ue=C[1];return[oe[0],Ue].concat(oe.slice(1))},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){return ru(function(Ue,Je){return[ai(oe.layer.call(Ue,R)),[]]},C=ai(C),[],!1,null,null,!1,!0)[1]})},Q.className="TimeDistributed",Q}(Bl);g.serialization.registerClass(Kt);var fc="concat",Mu=function(re){function Q(C){var R=re.call(this,C)||this,oe=C.layer.getConfig(),Ue={};Ue.className=C.layer.getClassName(),Ue.config=oe,R.forwardLayer=ha(Ue),oe.goBackwards=oe.goBackwards!==!0;var Je={};if(Je.className=C.layer.getClassName(),Je.config=oe,R.backwardLayer=ha(Je),R.forwardLayer.name="forward_"+R.forwardLayer.name,R.backwardLayer.name="backward_"+R.backwardLayer.name,R.mergeMode=C.mergeMode===void 0?fc:C.mergeMode,function(vt){Wt(yt,"BidirectionalMergeMode",vt)}(R.mergeMode),C.weights)throw new F("weights support is not implemented for Bidirectional layer yet.");return R._stateful=C.layer.stateful,R.returnSequences=C.layer.returnSequences,R.returnState=C.layer.returnState,R.supportsMasking=!0,R._trainable=!0,R.inputSpec=C.layer.inputSpec,R.numConstants=null,R}return I(Q,re),Object.defineProperty(Q.prototype,"trainable",{get:function(){return this._trainable},set:function(C){this._trainable=C,this.forwardLayer!=null&&(this.forwardLayer.trainable=C),this.backwardLayer!=null&&(this.backwardLayer.trainable=C)},enumerable:!0,configurable:!0}),Q.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},Q.prototype.setWeights=function(C){var R=C.length,oe=Math.floor(R/2);this.forwardLayer.setWeights(C.slice(0,oe)),this.backwardLayer.setWeights(C.slice(oe))},Q.prototype.computeOutputShape=function(C){var R,oe,Ue,Je=this.forwardLayer.computeOutputShape(C);return Array.isArray(Je)&&Array.isArray(Je[0])||(Je=[Je]),Je=Je,this.returnState&&(Ue=Je.slice(1)),R=Je[0],R=R,this.mergeMode==="concat"?(R[R.length-1]*=2,oe=[R]):oe=this.mergeMode==null?[R,R.slice()]:[R],this.returnState?this.mergeMode==null?oe.concat(Ue).concat(Ue.slice()):[R].concat(Ue).concat(Ue.slice()):pe(oe)},Q.prototype.apply=function(C,R){var oe=R==null?null:R.initialState,Ue=R==null?null:R.constants;R==null&&(R={});var Je=er(C,oe,Ue,this.numConstants);if(C=Je.inputs,oe=Je.initialState,Ue=Je.constants,Array.isArray(C)&&(oe=C.slice(1),C=C[0]),(oe==null||oe.length===0)&&Ue==null)return re.prototype.apply.call(this,C,R);var vt=[],qt=[];if(oe!=null){var Jt=oe.length;if(Jt%2>0)throw new te("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");R.initialState=oe,vt.push.apply(vt,oe);var pt=oe.map(function(Lr){return new So({shape:Lr.shape})});this.forwardLayer.stateSpec=pt.slice(0,Jt/2),this.backwardLayer.stateSpec=pt.slice(Jt/2),qt.push.apply(qt,pt)}if(Ue!=null)throw new F("Support for constants in Bidirectional layers is not implemented yet.");for(var Nn=vt[0]instanceof To,Pn=0,Vn=vt;Pn<Vn.length;Pn++)if(Vn[Pn]instanceof To!==Nn)throw new te("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(Nn){var rr=[C].concat(vt),Yn=this.inputSpec.concat(qt),br=this.inputSpec;this.inputSpec=Yn;var xr=re.prototype.apply.call(this,rr,R);return this.inputSpec=br,xr}return re.prototype.apply.call(this,C,R)},Q.prototype.call=function(C,R){var oe=this;return Object(g.tidy)(function(){var Ue,Je,vt,qt,Jt=R.initialState;if(Jt==null)Ue=oe.forwardLayer.call(C,R),Je=oe.backwardLayer.call(C,R);else{var pt=Jt.slice(0,Jt.length/2),Nn=Jt.slice(Jt.length/2);Ue=oe.forwardLayer.call(C,Object.assign(R,{initialState:pt})),Je=oe.backwardLayer.call(C,Object.assign(R,{initialState:Nn}))}return oe.returnState&&(Array.isArray(Ue)&&(vt=Ue.slice(1).concat(Je.slice(1))),Ue=Ue[0],Je=Je[0]),oe.returnSequences&&(Je=Object(g.reverse)(Je,1)),oe.mergeMode==="concat"?qt=di([Ue,Je]):oe.mergeMode==="sum"?qt=Object(g.add)(Ue,Je):oe.mergeMode==="ave"?qt=Object(g.mul)(.5,Object(g.add)(Ue,Je)):oe.mergeMode==="mul"?qt=Object(g.mul)(Ue,Je):oe.mergeMode==null&&(qt=[Ue,Je]),oe.returnState?oe.mergeMode==null?qt.concat(vt):[qt].concat(vt):qt})},Q.prototype.resetStates=function(C){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},Q.prototype.build=function(C){var R=this;lr(this.forwardLayer.name,function(){R.forwardLayer.build(C)}),lr(this.backwardLayer.name,function(){R.backwardLayer.build(C)}),this.built=!0},Q.prototype.computeMask=function(C,R){var oe;if(Array.isArray(R)&&(R=R[0]),oe=this.returnSequences?this.mergeMode==null?[R,R]:R:this.mergeMode==null?[null,null]:null,this.returnState){var Ue=this.forwardLayer.states.map(function(Je){return null});return Array.isArray(oe)?oe.concat(Ue).concat(Ue):[oe].concat(Ue).concat(Ue)}return oe},Object.defineProperty(Q.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),Q.prototype.setFastWeightInitDuringBuild=function(C){re.prototype.setFastWeightInitDuringBuild.call(this,C),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(C),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(C)},Q.prototype.getConfig=function(){var C={mergeMode:this.mergeMode},R=re.prototype.getConfig.call(this);return Object.assign(C,R),C},Q.fromConfig=function(C,R){var oe=ha(R.layer);if(delete R.layer,R.numConstants!=null)throw new F("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var Ue=R;return Ue.layer=oe,new C(Ue)},Q.className="Bidirectional",Q}(Bl);function po(re){return new Os(re)}function uo(re){return new Vh(re)}function js(re){return new Gp(re)}function ju(re){return new $p(re)}function ts(re){return new Ju(re)}function iu(re){return new Wh(re)}function bl(re){return new Yu(re)}g.serialization.registerClass(Mu);var Pl=ju,lf=ts,xl=iu,ih=bl,hc=Object.freeze({inputLayer:function(re){return new wc(re)},elu:function(re){return new Qf(re)},reLU:function(re){return new Vp(re)},leakyReLU:function(re){return new qp(re)},prelu:function(re){return new Hp(re)},softmax:function(re){return new Fu(re)},thresholdedReLU:function(re){return new nu(re)},conv1d:function(re){return new Eo(re)},conv2d:function(re){return new Or(re)},conv2dTranspose:function(re){return new go(re)},conv3d:function(re){return new Mi(re)},separableConv2d:function(re){return new Ca(re)},cropping2D:function(re){return new za(re)},upSampling2d:function(re){return new Sf(re)},depthwiseConv2d:function(re){return new Zd(re)},activation:function(re){return new Tf(re)},dense:function(re){return new Df(re)},dropout:function(re){return new Ru(re)},spatialDropout1d:function(re){return new Fl(re)},flatten:function(re){return new af(re)},repeatVector:function(re){return new sf(re)},reshape:function(re){return new ma(re)},permute:function(re){return new Dg(re)},embedding:function(re){return new Ua(re)},add:function(re){return new Xs(re)},average:function(re){return new cu(re)},concatenate:function(re){return new uf(re)},maximum:function(re){return new lc(re)},minimum:function(re){return new Es(re)},multiply:function(re){return new Co(re)},dot:function(re){return new Bh(re)},batchNormalization:function(re){return new Lh(re)},layerNormalization:function(re){return new zh(re)},zeroPadding2d:function(re){return new jm(re)},averagePooling1d:po,avgPool1d:function(re){return po(re)},avgPooling1d:function(re){return po(re)},averagePooling2d:uo,avgPool2d:function(re){return uo(re)},avgPooling2d:function(re){return uo(re)},averagePooling3d:js,avgPool3d:function(re){return js(re)},avgPooling3d:function(re){return js(re)},globalAveragePooling1d:function(re){return new rh(re)},globalAveragePooling2d:function(re){return new ln(re)},globalMaxPooling1d:ju,globalMaxPooling2d:ts,maxPooling1d:iu,maxPooling2d:bl,maxPooling3d:function(re){return new lu(re)},gru:function(re){return new Ds(re)},gruCell:function(re){return new fu(re)},lstm:function(re){return new yl(re)},lstmCell:function(re){return new Ro(re)},simpleRNN:function(re){return new wr(re)},simpleRNNCell:function(re){return new jl(re)},rnn:function(re){return new Fo(re)},stackedRNNCells:function(re){return new nl(re)},bidirectional:function(re){return new Mu(re)},timeDistributed:function(re){return new Kt(re)},globalMaxPool1d:Pl,globalMaxPool2d:lf,maxPool1d:xl,maxPool2d:ih,Layer:eo,RNN:Fo,RNNCell:cf,input:la,gaussianNoise:function(re){return new Ph(re)},gaussianDropout:function(re){return new Rl(re)},alphaDropout:function(re){return new ep(re)},masking:function(re){return new eh(re)}}),tp=Object.freeze({binaryAccuracy:function(re,Q){return ef(re,Q)},binaryCrossentropy:function(re,Q){return Of(re,Q)},sparseCategoricalAccuracy:function(re,Q){return da(re,Q)},categoricalAccuracy:function(re,Q){return Yc(re,Q)},categoricalCrossentropy:function(re,Q){return Qi(re,Q)},precision:function(re,Q){return Xf(re,Q)},recall:function(re,Q){return Jc(re,Q)},cosineProximity:function(re,Q){return Xc(re,Q)},meanAbsoluteError:function(re,Q){return Kc(re,Q)},meanAbsolutePercentageError:function(re,Q){return Is(re,Q)},MAPE:function(re,Q){return Is(re,Q)},mape:function(re,Q){return Is(re,Q)},meanSquaredError:function(re,Q){return Ga(re,Q)},MSE:function(re,Q){return Ga(re,Q)},mse:function(re,Q){return Ga(re,Q)}}),oh=Object.freeze({modelFromJSON:function(re,Q){return K(this,void 0,void 0,function(){var C,R,oe,Ue,Je,vt,qt,Jt;return M(this,function(pt){switch(pt.label){case 0:return"modelTopology"in re||(re={modelTopology:re}),(C=(re=re).modelTopology).model_config!=null&&(C=C.model_config),R=so(C),oe=ha(R,Q),re.weightsManifest==null?[3,2]:[4,g.io.loadWeights(re.weightsManifest,re.pathPrefix,oe.weights.map(function(Nn){return Nn.originalName}))];case 1:for(Ue=pt.sent(),Je={},vt=0,qt=oe.weights;vt<qt.length;vt++)Jt=qt[vt],Je[Jt.originalName]=Ue[Jt.originalName];oe.loadWeights(Je),Object(g.dispose)(Ue),pt.label=2;case 2:return[2,oe]}})})}}),Sc=Object.freeze({l1l2:function(re){return new Mh(re)},l1:function(re){return function(Q){return of(Q),new Mh({l1:Q!=null?Q.l1:null,l2:0})}(re)},l2:function(re){return function(Q){return of(Q),new Mh({l2:Q!=null?Q.l2:null,l1:0})}(re)}}),wl=function(re){function Q(){var C=re!==null&&re.apply(this,arguments)||this;return C.model=null,C}return I(Q,re),Q.prototype.setModel=function(C){if(!(C instanceof tf))throw new Error("model must be a LayersModel, not some other Container");this.model=C},Q}(Hs);function kl(re,Q){return re<Q}function Ys(re,Q){return re>Q}var np=function(re){function Q(C){var R=re.call(this)||this;if(C==null&&(C={}),C.restoreBestWeights)throw new F("restoreBestWeights = True is not implemented in EarlyStopping yet.");return R.monitor=C.monitor||"val_loss",R.minDelta=Math.abs(C.minDelta||0),R.patience=C.patience||0,R.verbose=C.verbose||0,R.mode=C.mode||"auto",R.baseline=C.baseline,["auto","min","max"].indexOf(R.mode)===-1&&(console.warn("EarlyStopping mode '"+R.mode+"' is invalid. Falling back to mode 'auto'."),R.mode="auto"),R.mode==="min"?R.monitorFunc=kl:R.mode==="max"||R.monitor.indexOf("acc")!==-1?R.monitorFunc=Ys:R.monitorFunc=kl,R.monitorFunc===kl&&(R.minDelta*=-1),R}return I(Q,re),Q.prototype.onTrainBegin=function(C){return K(this,void 0,void 0,function(){return M(this,function(R){return this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===kl?1/0:-1/0,[2]})})},Q.prototype.onEpochEnd=function(C,R){return K(this,void 0,void 0,function(){var oe;return M(this,function(Ue){switch(Ue.label){case 0:return[4,_c(R)];case 1:return Ue.sent(),(oe=this.getMonitorValue(R))==null?[2]:(this.monitorFunc(oe-this.minDelta,this.best)?(this.best=oe,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=C,this.model.stopTraining=!0)),[2])}})})},Q.prototype.onTrainEnd=function(C){return K(this,void 0,void 0,function(){return M(this,function(R){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch "+this.stoppedEpoch+": early stopping."),[2]})})},Q.prototype.getMonitorValue=function(C){C==null&&(C={});var R=C[this.monitor];return R==null&&console.warn("Metric for EarlyStopping "+this.monitor+" is not available. Available metrics are: "+Object.keys(C)),R},Q}(wl),_d={earlyStopping:function(re){return new np(re)}},Ed=o(20),qh=o(130);o.d(m,"version",function(){return Cd}),o.d(m,"AdadeltaOptimizer",function(){return g.AdadeltaOptimizer}),o.d(m,"AdagradOptimizer",function(){return g.AdagradOptimizer}),o.d(m,"AdamOptimizer",function(){return g.AdamOptimizer}),o.d(m,"AdamaxOptimizer",function(){return g.AdamaxOptimizer}),o.d(m,"Add",function(){return g.Add}),o.d(m,"AddN",function(){return g.AddN}),o.d(m,"BroadcastTo",function(){return g.BroadcastTo}),o.d(m,"DataStorage",function(){return g.DataStorage}),o.d(m,"Div",function(){return g.Div}),o.d(m,"ENV",function(){return g.ENV}),o.d(m,"Environment",function(){return g.Environment}),o.d(m,"FromPixels",function(){return g.FromPixels}),o.d(m,"FusedBatchNorm",function(){return g.FusedBatchNorm}),o.d(m,"Identity",function(){return g.Identity}),o.d(m,"KernelBackend",function(){return g.KernelBackend}),o.d(m,"MaxPoolWithArgmax",function(){return g.MaxPoolWithArgmax}),o.d(m,"MomentumOptimizer",function(){return g.MomentumOptimizer}),o.d(m,"NonMaxSuppressionV5",function(){return g.NonMaxSuppressionV5}),o.d(m,"OneHot",function(){return g.OneHot}),o.d(m,"Optimizer",function(){return g.Optimizer}),o.d(m,"PadV2",function(){return g.PadV2}),o.d(m,"RMSPropOptimizer",function(){return g.RMSPropOptimizer}),o.d(m,"Rank",function(){return g.Rank}),o.d(m,"Reduction",function(){return g.Reduction}),o.d(m,"SGDOptimizer",function(){return g.SGDOptimizer}),o.d(m,"Square",function(){return g.Square}),o.d(m,"SquaredDifference",function(){return g.SquaredDifference}),o.d(m,"Tensor",function(){return g.Tensor}),o.d(m,"TensorBuffer",function(){return g.TensorBuffer}),o.d(m,"Tile",function(){return g.Tile}),o.d(m,"Transpose",function(){return g.Transpose}),o.d(m,"Variable",function(){return g.Variable}),o.d(m,"abs",function(){return g.abs}),o.d(m,"acos",function(){return g.acos}),o.d(m,"acosh",function(){return g.acosh}),o.d(m,"add",function(){return g.add}),o.d(m,"addN",function(){return g.addN}),o.d(m,"addStrict",function(){return g.addStrict}),o.d(m,"all",function(){return g.all}),o.d(m,"any",function(){return g.any}),o.d(m,"argMax",function(){return g.argMax}),o.d(m,"argMin",function(){return g.argMin}),o.d(m,"asin",function(){return g.asin}),o.d(m,"asinh",function(){return g.asinh}),o.d(m,"atan",function(){return g.atan}),o.d(m,"atan2",function(){return g.atan2}),o.d(m,"atanh",function(){return g.atanh}),o.d(m,"avgPool",function(){return g.avgPool}),o.d(m,"avgPool3d",function(){return g.avgPool3d}),o.d(m,"backend",function(){return g.backend}),o.d(m,"backend_util",function(){return g.backend_util}),o.d(m,"basicLSTMCell",function(){return g.basicLSTMCell}),o.d(m,"batchNorm",function(){return g.batchNorm}),o.d(m,"batchNorm2d",function(){return g.batchNorm2d}),o.d(m,"batchNorm3d",function(){return g.batchNorm3d}),o.d(m,"batchNorm4d",function(){return g.batchNorm4d}),o.d(m,"batchNormalization",function(){return g.batchNormalization}),o.d(m,"batchNormalization2d",function(){return g.batchNormalization2d}),o.d(m,"batchNormalization3d",function(){return g.batchNormalization3d}),o.d(m,"batchNormalization4d",function(){return g.batchNormalization4d}),o.d(m,"batchToSpaceND",function(){return g.batchToSpaceND}),o.d(m,"booleanMaskAsync",function(){return g.booleanMaskAsync}),o.d(m,"broadcastTo",function(){return g.broadcastTo}),o.d(m,"browser",function(){return g.browser}),o.d(m,"buffer",function(){return g.buffer}),o.d(m,"cast",function(){return g.cast}),o.d(m,"ceil",function(){return g.ceil}),o.d(m,"clipByValue",function(){return g.clipByValue}),o.d(m,"clone",function(){return g.clone}),o.d(m,"complex",function(){return g.complex}),o.d(m,"concat",function(){return g.concat}),o.d(m,"concat1d",function(){return g.concat1d}),o.d(m,"concat2d",function(){return g.concat2d}),o.d(m,"concat3d",function(){return g.concat3d}),o.d(m,"concat4d",function(){return g.concat4d}),o.d(m,"conv1d",function(){return g.conv1d}),o.d(m,"conv2d",function(){return g.conv2d}),o.d(m,"conv2dTranspose",function(){return g.conv2dTranspose}),o.d(m,"conv3d",function(){return g.conv3d}),o.d(m,"conv3dTranspose",function(){return g.conv3dTranspose}),o.d(m,"cos",function(){return g.cos}),o.d(m,"cosh",function(){return g.cosh}),o.d(m,"cumsum",function(){return g.cumsum}),o.d(m,"customGrad",function(){return g.customGrad}),o.d(m,"deprecationWarn",function(){return g.deprecationWarn}),o.d(m,"depthToSpace",function(){return g.depthToSpace}),o.d(m,"depthwiseConv2d",function(){return g.depthwiseConv2d}),o.d(m,"diag",function(){return g.diag}),o.d(m,"disableDeprecationWarnings",function(){return g.disableDeprecationWarnings}),o.d(m,"dispose",function(){return g.dispose}),o.d(m,"disposeVariables",function(){return g.disposeVariables}),o.d(m,"div",function(){return g.div}),o.d(m,"divNoNan",function(){return g.divNoNan}),o.d(m,"divStrict",function(){return g.divStrict}),o.d(m,"dot",function(){return g.dot}),o.d(m,"dropout",function(){return g.dropout}),o.d(m,"elu",function(){return g.elu}),o.d(m,"enableDebugMode",function(){return g.enableDebugMode}),o.d(m,"enableProdMode",function(){return g.enableProdMode}),o.d(m,"engine",function(){return g.engine}),o.d(m,"env",function(){return g.env}),o.d(m,"equal",function(){return g.equal}),o.d(m,"equalStrict",function(){return g.equalStrict}),o.d(m,"erf",function(){return g.erf}),o.d(m,"exp",function(){return g.exp}),o.d(m,"expandDims",function(){return g.expandDims}),o.d(m,"expm1",function(){return g.expm1}),o.d(m,"eye",function(){return g.eye}),o.d(m,"fft",function(){return g.fft}),o.d(m,"fill",function(){return g.fill}),o.d(m,"findBackend",function(){return g.findBackend}),o.d(m,"findBackendFactory",function(){return g.findBackendFactory}),o.d(m,"floor",function(){return g.floor}),o.d(m,"floorDiv",function(){return g.floorDiv}),o.d(m,"frame",function(){return g.frame}),o.d(m,"fused",function(){return g.fused}),o.d(m,"gather",function(){return g.gather}),o.d(m,"gatherND",function(){return g.gatherND}),o.d(m,"gather_util",function(){return g.gather_util}),o.d(m,"getBackend",function(){return g.getBackend}),o.d(m,"getGradient",function(){return g.getGradient}),o.d(m,"getKernel",function(){return g.getKernel}),o.d(m,"getKernelsForBackend",function(){return g.getKernelsForBackend}),o.d(m,"grad",function(){return g.grad}),o.d(m,"grads",function(){return g.grads}),o.d(m,"greater",function(){return g.greater}),o.d(m,"greaterEqual",function(){return g.greaterEqual}),o.d(m,"greaterEqualStrict",function(){return g.greaterEqualStrict}),o.d(m,"greaterStrict",function(){return g.greaterStrict}),o.d(m,"hammingWindow",function(){return g.hammingWindow}),o.d(m,"hannWindow",function(){return g.hannWindow}),o.d(m,"ifft",function(){return g.ifft}),o.d(m,"imag",function(){return g.imag}),o.d(m,"image",function(){return g.image}),o.d(m,"inTopKAsync",function(){return g.inTopKAsync}),o.d(m,"io",function(){return g.io}),o.d(m,"irfft",function(){return g.irfft}),o.d(m,"isFinite",function(){return g.isFinite}),o.d(m,"isInf",function(){return g.isInf}),o.d(m,"isNaN",function(){return g.isNaN}),o.d(m,"keep",function(){return g.keep}),o.d(m,"leakyRelu",function(){return g.leakyRelu}),o.d(m,"less",function(){return g.less}),o.d(m,"lessEqual",function(){return g.lessEqual}),o.d(m,"lessEqualStrict",function(){return g.lessEqualStrict}),o.d(m,"lessStrict",function(){return g.lessStrict}),o.d(m,"linalg",function(){return g.linalg}),o.d(m,"linspace",function(){return g.linspace}),o.d(m,"localResponseNormalization",function(){return g.localResponseNormalization}),o.d(m,"log",function(){return g.log}),o.d(m,"log1p",function(){return g.log1p}),o.d(m,"logSigmoid",function(){return g.logSigmoid}),o.d(m,"logSoftmax",function(){return g.logSoftmax}),o.d(m,"logSumExp",function(){return g.logSumExp}),o.d(m,"logicalAnd",function(){return g.logicalAnd}),o.d(m,"logicalNot",function(){return g.logicalNot}),o.d(m,"logicalOr",function(){return g.logicalOr}),o.d(m,"logicalXor",function(){return g.logicalXor}),o.d(m,"losses",function(){return g.losses}),o.d(m,"matMul",function(){return g.matMul}),o.d(m,"math",function(){return g.math}),o.d(m,"max",function(){return g.max}),o.d(m,"maxPool",function(){return g.maxPool}),o.d(m,"maxPool3d",function(){return g.maxPool3d}),o.d(m,"maxPoolWithArgmax",function(){return g.maxPoolWithArgmax}),o.d(m,"maximum",function(){return g.maximum}),o.d(m,"maximumStrict",function(){return g.maximumStrict}),o.d(m,"mean",function(){return g.mean}),o.d(m,"memory",function(){return g.memory}),o.d(m,"min",function(){return g.min}),o.d(m,"minimum",function(){return g.minimum}),o.d(m,"minimumStrict",function(){return g.minimumStrict}),o.d(m,"mod",function(){return g.mod}),o.d(m,"modStrict",function(){return g.modStrict}),o.d(m,"moments",function(){return g.moments}),o.d(m,"movingAverage",function(){return g.movingAverage}),o.d(m,"mul",function(){return g.mul}),o.d(m,"mulStrict",function(){return g.mulStrict}),o.d(m,"multiRNNCell",function(){return g.multiRNNCell}),o.d(m,"multinomial",function(){return g.multinomial}),o.d(m,"neg",function(){return g.neg}),o.d(m,"nextFrame",function(){return g.nextFrame}),o.d(m,"norm",function(){return g.norm}),o.d(m,"notEqual",function(){return g.notEqual}),o.d(m,"notEqualStrict",function(){return g.notEqualStrict}),o.d(m,"oneHot",function(){return g.oneHot}),o.d(m,"ones",function(){return g.ones}),o.d(m,"onesLike",function(){return g.onesLike}),o.d(m,"op",function(){return g.op}),o.d(m,"outerProduct",function(){return g.outerProduct}),o.d(m,"pad",function(){return g.pad}),o.d(m,"pad1d",function(){return g.pad1d}),o.d(m,"pad2d",function(){return g.pad2d}),o.d(m,"pad3d",function(){return g.pad3d}),o.d(m,"pad4d",function(){return g.pad4d}),o.d(m,"pool",function(){return g.pool}),o.d(m,"pow",function(){return g.pow}),o.d(m,"powStrict",function(){return g.powStrict}),o.d(m,"prelu",function(){return g.prelu}),o.d(m,"print",function(){return g.print}),o.d(m,"prod",function(){return g.prod}),o.d(m,"profile",function(){return g.profile}),o.d(m,"rand",function(){return g.rand}),o.d(m,"randomGamma",function(){return g.randomGamma}),o.d(m,"randomNormal",function(){return g.randomNormal}),o.d(m,"randomUniform",function(){return g.randomUniform}),o.d(m,"range",function(){return g.range}),o.d(m,"ready",function(){return g.ready}),o.d(m,"real",function(){return g.real}),o.d(m,"reciprocal",function(){return g.reciprocal}),o.d(m,"registerBackend",function(){return g.registerBackend}),o.d(m,"registerGradient",function(){return g.registerGradient}),o.d(m,"registerKernel",function(){return g.registerKernel}),o.d(m,"relu",function(){return g.relu}),o.d(m,"relu6",function(){return g.relu6}),o.d(m,"removeBackend",function(){return g.removeBackend}),o.d(m,"reshape",function(){return g.reshape}),o.d(m,"reverse",function(){return g.reverse}),o.d(m,"reverse1d",function(){return g.reverse1d}),o.d(m,"reverse2d",function(){return g.reverse2d}),o.d(m,"reverse3d",function(){return g.reverse3d}),o.d(m,"reverse4d",function(){return g.reverse4d}),o.d(m,"rfft",function(){return g.rfft}),o.d(m,"round",function(){return g.round}),o.d(m,"rsqrt",function(){return g.rsqrt}),o.d(m,"scalar",function(){return g.scalar}),o.d(m,"scatterND",function(){return g.scatterND}),o.d(m,"scatter_util",function(){return g.scatter_util}),o.d(m,"selu",function(){return g.selu}),o.d(m,"separableConv2d",function(){return g.separableConv2d}),o.d(m,"serialization",function(){return g.serialization}),o.d(m,"setBackend",function(){return g.setBackend}),o.d(m,"setPlatform",function(){return g.setPlatform}),o.d(m,"setdiff1dAsync",function(){return g.setdiff1dAsync}),o.d(m,"sigmoid",function(){return g.sigmoid}),o.d(m,"sign",function(){return g.sign}),o.d(m,"signal",function(){return g.signal}),o.d(m,"sin",function(){return g.sin}),o.d(m,"sinh",function(){return g.sinh}),o.d(m,"slice",function(){return g.slice}),o.d(m,"slice1d",function(){return g.slice1d}),o.d(m,"slice2d",function(){return g.slice2d}),o.d(m,"slice3d",function(){return g.slice3d}),o.d(m,"slice4d",function(){return g.slice4d}),o.d(m,"slice_util",function(){return g.slice_util}),o.d(m,"softmax",function(){return g.softmax}),o.d(m,"softplus",function(){return g.softplus}),o.d(m,"spaceToBatchND",function(){return g.spaceToBatchND}),o.d(m,"sparseToDense",function(){return g.sparseToDense}),o.d(m,"spectral",function(){return g.spectral}),o.d(m,"split",function(){return g.split}),o.d(m,"sqrt",function(){return g.sqrt}),o.d(m,"square",function(){return g.square}),o.d(m,"squaredDifference",function(){return g.squaredDifference}),o.d(m,"squaredDifferenceStrict",function(){return g.squaredDifferenceStrict}),o.d(m,"squeeze",function(){return g.squeeze}),o.d(m,"stack",function(){return g.stack}),o.d(m,"step",function(){return g.step}),o.d(m,"stft",function(){return g.stft}),o.d(m,"stridedSlice",function(){return g.stridedSlice}),o.d(m,"sub",function(){return g.sub}),o.d(m,"subStrict",function(){return g.subStrict}),o.d(m,"sum",function(){return g.sum}),o.d(m,"sumOutType",function(){return g.sumOutType}),o.d(m,"tan",function(){return g.tan}),o.d(m,"tanh",function(){return g.tanh}),o.d(m,"tensor",function(){return g.tensor}),o.d(m,"tensor1d",function(){return g.tensor1d}),o.d(m,"tensor2d",function(){return g.tensor2d}),o.d(m,"tensor3d",function(){return g.tensor3d}),o.d(m,"tensor4d",function(){return g.tensor4d}),o.d(m,"tensor5d",function(){return g.tensor5d}),o.d(m,"tensor6d",function(){return g.tensor6d}),o.d(m,"tensor_util",function(){return g.tensor_util}),o.d(m,"test_util",function(){return g.test_util}),o.d(m,"tidy",function(){return g.tidy}),o.d(m,"tile",function(){return g.tile}),o.d(m,"time",function(){return g.time}),o.d(m,"topk",function(){return g.topk}),o.d(m,"train",function(){return g.train}),o.d(m,"transpose",function(){return g.transpose}),o.d(m,"truncatedNormal",function(){return g.truncatedNormal}),o.d(m,"unregisterGradient",function(){return g.unregisterGradient}),o.d(m,"unregisterKernel",function(){return g.unregisterKernel}),o.d(m,"unsortedSegmentSum",function(){return g.unsortedSegmentSum}),o.d(m,"unstack",function(){return g.unstack}),o.d(m,"util",function(){return g.util}),o.d(m,"valueAndGrad",function(){return g.valueAndGrad}),o.d(m,"valueAndGrads",function(){return g.valueAndGrads}),o.d(m,"variable",function(){return g.variable}),o.d(m,"variableGrads",function(){return g.variableGrads}),o.d(m,"version_core",function(){return g.version_core}),o.d(m,"webgl",function(){return g.webgl}),o.d(m,"where",function(){return g.where}),o.d(m,"whereAsync",function(){return g.whereAsync}),o.d(m,"zeros",function(){return g.zeros}),o.d(m,"zerosLike",function(){return g.zerosLike}),o.d(m,"constraints",function(){return pn}),o.d(m,"initializers",function(){return Ir}),o.d(m,"layers",function(){return hc}),o.d(m,"metrics",function(){return tp}),o.d(m,"models",function(){return oh}),o.d(m,"regularizers",function(){return Sc}),o.d(m,"CallbackList",function(){return Mc}),o.d(m,"CustomCallback",function(){return Zl}),o.d(m,"History",function(){return Gs}),o.d(m,"Callback",function(){return wl}),o.d(m,"callbacks",function(){return _d}),o.d(m,"EarlyStopping",function(){return np}),o.d(m,"InputSpec",function(){return So}),o.d(m,"SymbolicTensor",function(){return To}),o.d(m,"LayersModel",function(){return tf}),o.d(m,"input",function(){return la}),o.d(m,"loadLayersModel",function(){return Ks}),o.d(m,"model",function(){return aa}),o.d(m,"registerCallbackConstructor",function(){return xu}),o.d(m,"sequential",function(){return ms}),o.d(m,"RNN",function(){return Fo}),o.d(m,"Sequential",function(){return Tt}),o.d(m,"LayerVariable",function(){return Zr}),o.d(m,"version_layers",function(){return"1.7.4"}),o.d(m,"GraphModel",function(){return Ed.GraphModel}),o.d(m,"loadGraphModel",function(){return Ed.loadGraphModel}),o.d(m,"deregisterOp",function(){return Ed.deregisterOp}),o.d(m,"registerOp",function(){return Ed.registerOp}),o.d(m,"version_converter",function(){return Ed.version_converter}),o.d(m,"data",function(){return qh});var Cd={"tfjs-core":g.version_core,"tfjs-data":qh.version_data,"tfjs-layers":"1.7.4","tfjs-converter":Ed.version_converter,tfjs:"1.7.4"}},function(j,m,o){o.r(m),function(g,z,I,A){o.d(m,"AdadeltaOptimizer",function(){return Q0}),o.d(m,"AdagradOptimizer",function(){return ld}),o.d(m,"AdamOptimizer",function(){return ua}),o.d(m,"AdamaxOptimizer",function(){return Qg}),o.d(m,"DataStorage",function(){return cf}),o.d(m,"ENV",function(){return te}),o.d(m,"Environment",function(){return $}),o.d(m,"KernelBackend",function(){return jl}),o.d(m,"MomentumOptimizer",function(){return Zg}),o.d(m,"Optimizer",function(){return _p}),o.d(m,"RMSPropOptimizer",function(){return Z0}),o.d(m,"Rank",function(){return xe}),o.d(m,"Reduction",function(){return Cu}),o.d(m,"SGDOptimizer",function(){return Kl}),o.d(m,"Tensor",function(){return $t}),o.d(m,"TensorBuffer",function(){return Gi}),o.d(m,"Variable",function(){return xt}),o.d(m,"abs",function(){return zl}),o.d(m,"acos",function(){return zm}),o.d(m,"acosh",function(){return ap}),o.d(m,"add",function(){return up}),o.d(m,"addN",function(){return $0}),o.d(m,"addStrict",function(){return dh}),o.d(m,"all",function(){return Hg}),o.d(m,"any",function(){return vf}),o.d(m,"argMax",function(){return Gg}),o.d(m,"argMin",function(){return w0}),o.d(m,"asin",function(){return ol}),o.d(m,"asinh",function(){return Zp}),o.d(m,"atan",function(){return Od}),o.d(m,"atan2",function(){return cp}),o.d(m,"atanh",function(){return Sd}),o.d(m,"avgPool",function(){return y0}),o.d(m,"avgPool3d",function(){return Vg}),o.d(m,"backend",function(){return Sg}),o.d(m,"backend_util",function(){return lf}),o.d(m,"basicLSTMCell",function(){return C0}),o.d(m,"batchNorm",function(){return qm}),o.d(m,"batchNorm2d",function(){return fh}),o.d(m,"batchNorm3d",function(){return $h}),o.d(m,"batchNorm4d",function(){return Nd}),o.d(m,"batchNormalization",function(){return G0}),o.d(m,"batchNormalization2d",function(){return Vm}),o.d(m,"batchNormalization3d",function(){return Gh}),o.d(m,"batchNormalization4d",function(){return Pg}),o.d(m,"batchToSpaceND",function(){return cr}),o.d(m,"booleanMaskAsync",function(){return Xm}),o.d(m,"broadcastTo",function(){return jr}),o.d(m,"browser",function(){return $l}),o.d(m,"buffer",function(){return wo}),o.d(m,"cast",function(){return Or}),o.d(m,"ceil",function(){return Ng}),o.d(m,"clipByValue",function(){return Ul}),o.d(m,"clone",function(){return Mi}),o.d(m,"complex",function(){return aa}),o.d(m,"concat",function(){return $a}),o.d(m,"concat1d",function(){return of}),o.d(m,"concat2d",function(){return Wp}),o.d(m,"concat3d",function(){return Mh}),o.d(m,"concat4d",function(){return jh}),o.d(m,"conv1d",function(){return fp}),o.d(m,"conv2d",function(){return Rd}),o.d(m,"conv2dTranspose",function(){return Uc}),o.d(m,"conv3d",function(){return td}),o.d(m,"conv3dTranspose",function(){return K0}),o.d(m,"cos",function(){return If}),o.d(m,"cosh",function(){return Wl}),o.d(m,"cumsum",function(){return go}),o.d(m,"customGrad",function(){return Ju}),o.d(m,"deprecationWarn",function(){return Qc}),o.d(m,"depthToSpace",function(){return Ca}),o.d(m,"depthwiseConv2d",function(){return hp}),o.d(m,"diag",function(){return lm}),o.d(m,"disableDeprecationWarnings",function(){return No}),o.d(m,"dispose",function(){return Oa}),o.d(m,"disposeVariables",function(){return Yf}),o.d(m,"div",function(){return Mf}),o.d(m,"divNoNan",function(){return hf}),o.d(m,"divStrict",function(){return Yh}),o.d(m,"dot",function(){return sm}),o.d(m,"dropout",function(){return xh}),o.d(m,"elu",function(){return yf}),o.d(m,"enableDebugMode",function(){return Nh}),o.d(m,"enableProdMode",function(){return is}),o.d(m,"engine",function(){return zp}),o.d(m,"env",function(){return W}),o.d(m,"equal",function(){return mf}),o.d(m,"equalStrict",function(){return El}),o.d(m,"erf",function(){return Ig}),o.d(m,"exp",function(){return Fg}),o.d(m,"expandDims",function(){return Eo}),o.d(m,"expm1",function(){return em}),o.d(m,"eye",function(){return za}),o.d(m,"fft",function(){return tg}),o.d(m,"fill",function(){return Nu}),o.d(m,"findBackend",function(){return Yd}),o.d(m,"findBackendFactory",function(){return Up}),o.d(m,"floor",function(){return yv}),o.d(m,"floorDiv",function(){return df}),o.d(m,"frame",function(){return fm}),o.d(m,"fused",function(){return Jg}),o.d(m,"gather",function(){return $m}),o.d(m,"gatherND",function(){return bh}),o.d(m,"gather_util",function(){return th}),o.d(m,"getBackend",function(){return Tu}),o.d(m,"getGradient",function(){return J}),o.d(m,"getKernel",function(){return se}),o.d(m,"getKernelsForBackend",function(){return me}),o.d(m,"grad",function(){return wd}),o.d(m,"grads",function(){return rh}),o.d(m,"greater",function(){return sl}),o.d(m,"greaterEqual",function(){return ul}),o.d(m,"greaterEqualStrict",function(){return rc}),o.d(m,"greaterStrict",function(){return tm}),o.d(m,"hammingWindow",function(){return Xg}),o.d(m,"hannWindow",function(){return ig}),o.d(m,"ifft",function(){return ng}),o.d(m,"imag",function(){return Ks}),o.d(m,"image",function(){return fg}),o.d(m,"inTopKAsync",function(){return S0}),o.d(m,"io",function(){return wp}),o.d(m,"irfft",function(){return Lf}),o.d(m,"isFinite",function(){return ch}),o.d(m,"isInf",function(){return h0}),o.d(m,"isNaN",function(){return f0}),o.d(m,"keep",function(){return Fh}),o.d(m,"leakyRelu",function(){return gp}),o.d(m,"less",function(){return Lg}),o.d(m,"lessEqual",function(){return Fd}),o.d(m,"lessEqualStrict",function(){return Ra}),o.d(m,"lessStrict",function(){return nm}),o.d(m,"linalg",function(){return ug}),o.d(m,"linspace",function(){return Jd}),o.d(m,"localResponseNormalization",function(){return E0}),o.d(m,"log",function(){return bv}),o.d(m,"log1p",function(){return ra}),o.d(m,"logSigmoid",function(){return Rg}),o.d(m,"logSoftmax",function(){return Fo}),o.d(m,"logSumExp",function(){return Uu}),o.d(m,"logicalAnd",function(){return Kh}),o.d(m,"logicalNot",function(){return Rf}),o.d(m,"logicalOr",function(){return Hm}),o.d(m,"logicalXor",function(){return Xh}),o.d(m,"losses",function(){return ag}),o.d(m,"matMul",function(){return Ug}),o.d(m,"math",function(){return Wf}),o.d(m,"max",function(){return X0}),o.d(m,"maxPool",function(){return v0}),o.d(m,"maxPool3d",function(){return b0}),o.d(m,"maximum",function(){return to}),o.d(m,"maximumStrict",function(){return pf}),o.d(m,"mean",function(){return pp}),o.d(m,"memory",function(){return tu}),o.d(m,"min",function(){return mp}),o.d(m,"minimum",function(){return jf}),o.d(m,"minimumStrict",function(){return zu}),o.d(m,"mod",function(){return lp}),o.d(m,"modStrict",function(){return ph}),o.d(m,"moments",function(){return vh}),o.d(m,"movingAverage",function(){return od}),o.d(m,"mul",function(){return Bf}),o.d(m,"mulStrict",function(){return Ts}),o.d(m,"multiRNNCell",function(){return eg}),o.d(m,"multinomial",function(){return Sf}),o.d(m,"neg",function(){return Mg}),o.d(m,"nextFrame",function(){return wf}),o.d(m,"norm",function(){return vp}),o.d(m,"notEqual",function(){return zc}),o.d(m,"notEqualStrict",function(){return Qh}),o.d(m,"oneHot",function(){return Zd}),o.d(m,"ones",function(){return Xu}),o.d(m,"onesLike",function(){return Iu}),o.d(m,"op",function(){return Tt}),o.d(m,"outerProduct",function(){return d0}),o.d(m,"pad",function(){return Ru}),o.d(m,"pad1d",function(){return Fl}),o.d(m,"pad2d",function(){return Df}),o.d(m,"pad3d",function(){return af}),o.d(m,"pad4d",function(){return Tf}),o.d(m,"pool",function(){return rd}),o.d(m,"pow",function(){return Id}),o.d(m,"powStrict",function(){return Gm}),o.d(m,"prelu",function(){return jd}),o.d(m,"print",function(){return Il}),o.d(m,"prod",function(){return Md}),o.d(m,"profile",function(){return Ih}),o.d(m,"rand",function(){return sf}),o.d(m,"randomGamma",function(){return Dg}),o.d(m,"randomNormal",function(){return ma}),o.d(m,"randomUniform",function(){return eh}),o.d(m,"range",function(){return rf}),o.d(m,"ready",function(){return Xd}),o.d(m,"real",function(){return ms}),o.d(m,"reciprocal",function(){return Um}),o.d(m,"registerBackend",function(){return Ec}),o.d(m,"registerGradient",function(){return Oe}),o.d(m,"registerKernel",function(){return pe}),o.d(m,"relu",function(){return Zm}),o.d(m,"relu6",function(){return $g}),o.d(m,"removeBackend",function(){return Tl}),o.d(m,"reshape",function(){return Ua}),o.d(m,"reverse",function(){return nd}),o.d(m,"reverse1d",function(){return p0}),o.d(m,"reverse2d",function(){return um}),o.d(m,"reverse3d",function(){return Jm}),o.d(m,"reverse4d",function(){return m0}),o.d(m,"rfft",function(){return Kg}),o.d(m,"round",function(){return jg}),o.d(m,"rsqrt",function(){return sp}),o.d(m,"scalar",function(){return Mr}),o.d(m,"scatterND",function(){return A0}),o.d(m,"scatter_util",function(){return Uh}),o.d(m,"selu",function(){return _0}),o.d(m,"separableConv2d",function(){return gf}),o.d(m,"serialization",function(){return Eh}),o.d(m,"setBackend",function(){return Rh}),o.d(m,"setPlatform",function(){return el}),o.d(m,"setdiff1dAsync",function(){return uf}),o.d(m,"sigmoid",function(){return ou}),o.d(m,"sign",function(){return tc}),o.d(m,"signal",function(){return Yg}),o.d(m,"sin",function(){return Vl}),o.d(m,"sinh",function(){return Dd}),o.d(m,"slice",function(){return mh}),o.d(m,"slice1d",function(){return qg}),o.d(m,"slice2d",function(){return x0}),o.d(m,"slice3d",function(){return id}),o.d(m,"slice4d",function(){return gh}),o.d(m,"slice_util",function(){return Gp}),o.d(m,"softmax",function(){return ru}),o.d(m,"softplus",function(){return H0}),o.d(m,"spaceToBatchND",function(){return Ms}),o.d(m,"sparseToDense",function(){return O0}),o.d(m,"spectral",function(){return rg}),o.d(m,"split",function(){return _o}),o.d(m,"sqrt",function(){return Wm}),o.d(m,"square",function(){return Lm}),o.d(m,"squaredDifference",function(){return il}),o.d(m,"squaredDifferenceStrict",function(){return Jh}),o.d(m,"squeeze",function(){return Xs}),o.d(m,"stack",function(){return Co}),o.d(m,"step",function(){return Ff}),o.d(m,"stft",function(){return hm}),o.d(m,"stridedSlice",function(){return cm}),o.d(m,"sub",function(){return Pf}),o.d(m,"subStrict",function(){return du}),o.d(m,"sum",function(){return k0}),o.d(m,"sumOutType",function(){return dr}),o.d(m,"tan",function(){return nc}),o.d(m,"tanh",function(){return ql}),o.d(m,"tensor",function(){return la}),o.d(m,"tensor1d",function(){return Cc}),o.d(m,"tensor2d",function(){return sc}),o.d(m,"tensor3d",function(){return nf}),o.d(m,"tensor4d",function(){return Ac}),o.d(m,"tensor5d",function(){return yd}),o.d(m,"tensor6d",function(){return uc}),o.d(m,"tensor_util",function(){return Ft}),o.d(m,"test_util",function(){return Wc}),o.d(m,"tidy",function(){return so}),o.d(m,"tile",function(){return cu}),o.d(m,"time",function(){return Zc}),o.d(m,"topk",function(){return yh}),o.d(m,"train",function(){return kv}),o.d(m,"transpose",function(){return Eu}),o.d(m,"truncatedNormal",function(){return lc}),o.d(m,"unregisterGradient",function(){return Le}),o.d(m,"unregisterKernel",function(){return Fe}),o.d(m,"unsortedSegmentSum",function(){return Km}),o.d(m,"unstack",function(){return Es}),o.d(m,"util",function(){return wi}),o.d(m,"valueAndGrad",function(){return $p}),o.d(m,"valueAndGrads",function(){return kd}),o.d(m,"variable",function(){return bd}),o.d(m,"variableGrads",function(){return ln}),o.d(m,"version_core",function(){return wv}),o.d(m,"webgl",function(){return Oh}),o.d(m,"where",function(){return Ko}),o.d(m,"whereAsync",function(){return hh}),o.d(m,"zeros",function(){return Io}),o.d(m,"zerosLike",function(){return Ri});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var X=function(b,h){return(X=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var x in d)d.hasOwnProperty(x)&&(u[x]=d[x])})(b,h)};function K(b,h){function u(){this.constructor=b}X(b,h),b.prototype=h===null?Object.create(h):(u.prototype=h.prototype,new u)}function M(b,h,u,d){return new(u||(u=Promise))(function(x,T){function H(ye){try{ce(d.next(ye))}catch(Ee){T(Ee)}}function Z(ye){try{ce(d.throw(ye))}catch(Ee){T(Ee)}}function ce(ye){ye.done?x(ye.value):new u(function(Ee){Ee(ye.value)}).then(H,Z)}ce((d=d.apply(b,h||[])).next())})}function V(b,h){var u,d,x,T,H={label:0,sent:function(){if(1&x[0])throw x[1];return x[1]},trys:[],ops:[]};return T={next:Z(0),throw:Z(1),return:Z(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function Z(ce){return function(ye){return function(Ee){if(u)throw new TypeError("Generator is already executing.");for(;H;)try{if(u=1,d&&(x=2&Ee[0]?d.return:Ee[0]?d.throw||((x=d.return)&&x.call(d),0):d.next)&&!(x=x.call(d,Ee[1])).done)return x;switch(d=0,x&&(Ee=[2&Ee[0],x.value]),Ee[0]){case 0:case 1:x=Ee;break;case 4:return H.label++,{value:Ee[1],done:!1};case 5:H.label++,d=Ee[1],Ee=[0];continue;case 7:Ee=H.ops.pop(),H.trys.pop();continue;default:if(!(x=(x=H.trys).length>0&&x[x.length-1])&&(Ee[0]===6||Ee[0]===2)){H=0;continue}if(Ee[0]===3&&(!x||Ee[1]>x[0]&&Ee[1]<x[3])){H.label=Ee[1];break}if(Ee[0]===6&&H.label<x[1]){H.label=x[1],x=Ee;break}if(x&&H.label<x[2]){H.label=x[2],H.ops.push(Ee);break}x[2]&&H.ops.pop(),H.trys.pop();continue}Ee=h.call(b,H)}catch(je){Ee=[6,je],d=0}finally{u=x=0}if(5&Ee[0])throw Ee[1];return{value:Ee[0]?Ee[1]:void 0,done:!0}}([ce,ye])}}}var $=function(){function b(h){this.global=h,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return b.prototype.setPlatform=function(h,u){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+u+"."),this.platformName=h,this.platform=u},b.prototype.registerFlag=function(h,u,d){if(this.flagRegistry[h]={evaluationFn:u,setHook:d},this.urlFlags[h]!=null){var x=this.urlFlags[h];console.warn("Setting feature override from URL "+h+": "+x+"."),this.set(h,x)}},b.prototype.get=function(h){return h in this.flags?this.flags[h]:(this.flags[h]=this.evaluateFlag(h),this.flags[h])},b.prototype.getNumber=function(h){return this.get(h)},b.prototype.getBool=function(h){return this.get(h)},b.prototype.getFlags=function(){return this.flags},Object.defineProperty(b.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),b.prototype.set=function(h,u){if(this.flagRegistry[h]==null)throw new Error("Cannot set flag "+h+" as it has not been registered.");this.flags[h]=u,this.flagRegistry[h].setHook!=null&&this.flagRegistry[h].setHook(u)},b.prototype.evaluateFlag=function(h){if(this.flagRegistry[h]==null)throw new Error("Cannot evaluate flag '"+h+"': no evaluation function found.");return this.flagRegistry[h].evaluationFn()},b.prototype.setFlags=function(h){this.flags=Object.assign({},h)},b.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},b.prototype.populateURLFlags=function(){var h=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var u,d,x=(u=this.global.location.search,d={},u.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(T){for(var H=[],Z=1;Z<arguments.length;Z++)H[Z-1]=arguments[Z];return function(ce,ye,Ee){ce[decodeURIComponent(ye)]=decodeURIComponent(Ee||"")}(d,H[0],H[1]),H.join("=")}),d);"tfjsflags"in x&&x.tfjsflags.split(",").forEach(function(T){var H=T.split(":"),Z=H[0],ce=H[1];h.urlFlags[Z]=function(ye,Ee){if((Ee=Ee.toLowerCase())==="true"||Ee==="false")return Ee==="true";if(""+ +Ee===Ee)return+Ee;throw new Error("Could not parse value flag value "+Ee+" for flag "+ye+".")}(Z,ce)})}},b}();function W(){return te}var te=null,F=new Map,ue=new Map;function se(b,h){var u=Ae(b,h);return F.get(u)}function J(b){return ue.get(b)}function me(b){for(var h=F.entries(),u=[];;){var d=h.next(),x=d.done,T=d.value;if(x)break;var H=T[0],Z=T[1];H.split("_")[0]===b&&u.push(Z)}return u}function pe(b){var h=b.kernelName,u=b.backendName,d=Ae(h,u);if(F.has(d))throw new Error("The kernel '"+h+"' for backend '"+u+"' is already registered");F.set(d,b)}function Oe(b){var h=b.kernelName;ue.has(h)&&console.warn("Overriding the gradient for '"+h+"'"),ue.set(h,b)}function Fe(b,h){var u=Ae(b,h);if(!F.has(u))throw new Error("The kernel '"+b+"' for backend '"+h+"' is not registered");F.delete(u)}function Le(b){if(!ue.has(b))throw new Error("The gradient '"+b+"' for backend is not registered");ue.delete(b)}function Ae(b,h){return h+"_"+b}function ft(b){for(var h=b.length,u=0,d=0;h>0;)d=Math.random()*h|0,u=b[--h],b[h]=b[d],b[d]=u}function Mt(b,h,u){return Math.max(b,Math.min(h,u))}function Xt(b){return b%2==0?b:b+1}function tn(b){for(var h=0,u=0;u<b.length;u++)h+=b[u];return h}function Ce(b,h){if(!b)throw new Error(typeof h=="string"?h:h())}function Wt(b,h,u){u===void 0&&(u=""),Ce(fn(b,h),function(){return u+" Shapes "+b+" and "+h+" must match"})}function en(b){Ce(b!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Ut(b,h,u){if(h===void 0&&(h=[]),u===void 0&&(u=!1),h==null&&(h=[]),Array.isArray(b)||yt(b)&&!u)for(var d=0;d<b.length;++d)Ut(b[d],h,u);else h.push(b);return h}function Qe(b){if(b.length===0)return 1;for(var h=b[0],u=1;u<b.length;u++)h*=b[u];return h}function fn(b,h){if(b===h)return!0;if(b==null||h==null||b.length!==h.length)return!1;for(var u=0;u<b.length;u++)if(b[u]!==h[u])return!1;return!0}function on(b){return b%1==0}function Ct(b){if(Math.tanh!=null)return Math.tanh(b);if(b===1/0)return 1;if(b===-1/0)return-1;var h=Math.exp(2*b);return(h-1)/(h+1)}function Vt(b){var h=Math.ceil(Math.sqrt(b));return[h,Math.ceil(b/h)]}function En(b,h){return h<=b.length?b:b+" ".repeat(h-b.length)}function Pt(b,h,u){return h===void 0&&(h=function(d){return 0}),new Promise(function(d,x){var T=0,H=function(){if(b())d();else{var Z=h(++T);u!=null&&T>=u?x():setTimeout(H,Z)}};H()})}function Rt(b,h){for(var u=1,d=-1,x=0;x<b.length;++x)if(b[x]>=0)u*=b[x];else if(b[x]===-1){if(d!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+d+" and dim "+x);d=x}else if(b[x]<0)throw Error("Shapes can not be < 0. Found "+b[x]+" at dim "+x);if(d===-1){if(h>0&&h!==u)throw Error("Size("+h+") must match the product of shape "+b);return b}if(u===0)throw Error("Cannot infer the missing size in ["+b+"] when there are 0 elements");if(h%u!=0)throw Error("The implicit shape can't be a fractional number. Got "+h+" / "+u);var T=b.slice();return T[d]=h/u,T}function Tn(b,h){var u=h.length;return Ce((b=b==null?h.map(function(d,x){return x}):[].concat(b)).every(function(d){return d>=-u&&d<u}),function(){return"All values in axis param must be in range [-"+u+", "+u+") but got axis "+b}),Ce(b.every(function(d){return on(d)}),function(){return"All values in axis param must be integers but got axis "+b}),b.map(function(d){return d<0?u+d:d})}function Hn(b,h){for(var u=[],d=[],x=h!=null&&Array.isArray(h)&&h.length===0,T=h==null||x?null:Tn(h,b).sort(),H=0,Z=0;Z<b.length;++Z){if(T!=null){if(T[H]===Z&&b[Z]!==1)throw new Error("Can't squeeze axis "+Z+" since its dim '"+b[Z]+"' is not 1");(T[H]==null||T[H]>Z)&&b[Z]===1&&(u.push(b[Z]),d.push(Z)),T[H]<=Z&&H++}b[Z]!==1&&(u.push(b[Z]),d.push(Z))}return{newShape:u,keptDims:d}}function tr(b,h){var u=null;if(b==null||b==="float32")u=new Float32Array(h);else if(b==="int32")u=new Int32Array(h);else{if(b!=="bool")throw new Error("Unknown data type "+b);u=new Uint8Array(h)}return u}function pn(b,h){var u=null;if(b==null||b==="float32")u=new Float32Array(h);else if(b==="int32")u=new Int32Array(h);else if(b==="bool")u=new Uint8Array(h);else{if(b!=="string")throw new Error("Unknown data type "+b);u=new Array(h)}return u}function $e(b,h){for(var u=0;u<b.length;u++){var d=b[u];if(isNaN(d)||!isFinite(d))throw Error("A tensor of type "+h+" being uploaded contains "+d+".")}}function et(b){return b==="bool"||b==="complex64"||b==="float32"||b==="int32"||b==="string"}function Ke(b,h){return!(h==="complex64"||h==="float32"&&b!=="complex64"||h==="int32"&&b!=="float32"&&b!=="complex64"||h==="bool"&&b==="bool")}function yt(b){return b instanceof Float32Array||b instanceof Int32Array||b instanceof Uint8Array}function Dt(b){if(b==="float32"||b==="int32")return 4;if(b==="complex64")return 8;if(b==="bool")return 1;throw new Error("Unknown dtype "+b)}function Lt(b){if(b==null)return 0;var h=0;return b.forEach(function(u){return h+=u.length}),h}function zn(b){return typeof b=="string"||b instanceof String}function Cn(b){return typeof b=="boolean"}function ar(b){return typeof b=="number"}function we(b){return Array.isArray(b)?we(b[0]):b instanceof Float32Array?"float32":b instanceof Int32Array||b instanceof Uint8Array?"int32":ar(b)?"float32":zn(b)?"string":Cn(b)?"bool":"float32"}function lr(b){return!!(b&&b.constructor&&b.call&&b.apply)}function Rr(b,h){for(var u=h;u<b;++u)if(b%u==0)return u;return b}function Tr(b){var h=b.length;if(h<2)return[];var u=new Array(h-1);u[h-2]=b[h-1];for(var d=h-3;d>=0;--d)u[d]=u[d+1]*b[d+1];return u}function qr(b,h,u){if(h==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(b)&&(b=Ut(b)),u&&$e(b,h),function(T,H){return T instanceof Float32Array&&H==="float32"||T instanceof Int32Array&&H==="int32"||T instanceof Uint8Array&&H==="bool"}(b,h))return b;if(h==null||h==="float32"||h==="complex64")return new Float32Array(b);if(h==="int32")return new Int32Array(b);if(h==="bool"){for(var d=new Uint8Array(b.length),x=0;x<d.length;++x)Math.round(b[x])!==0&&(d[x]=1);return d}throw new Error("Unknown data type "+h)}function Gr(b,h){if(b.length===0)return h[0];var u=b.reduce(function(d,x){return d*x});if(u===0)return[];if(u!==h.length)throw new Error("["+b+"] does not match the input size.");return function d(x,T,H){var Z=new Array;if(T.length===1)for(var ce=T[0],ye=0;ye<ce;ye++)Z[ye]=H[x+ye];else{ce=T[0];var Ee=T.slice(1),je=Ee.reduce(function(Pe,ze){return Pe*ze});for(ye=0;ye<ce;ye++)Z[ye]=d(x+ye*je,Ee,H)}return Z}(0,b,h)}function hn(b,h){for(var u=nn(b,h),d=0;d<u.length;d++)u[d]=1;return u}function nn(b,h){if(h==null||h==="float32"||h==="complex64")return new Float32Array(b);if(h==="int32")return new Int32Array(b);if(h==="bool")return new Uint8Array(b);throw new Error("Unknown data type "+h)}function an(){return W().platform.now()}function or(b){b.forEach(function(h){Ce(Number.isInteger(h)&&h>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+b+"]."})})}function jn(b,h){return h===void 0&&(h="utf-8"),h=h||"utf-8",W().platform.encode(b,h)}function Fr(b,h){return h===void 0&&(h="utf-8"),h=h||"utf-8",W().platform.decode(b,h)}function Pr(b,h,u){if(h===0)return 0;if(h===1)return b[0];for(var d=b[b.length-1],x=0;x<b.length-1;++x)d+=u[x]*b[x];return d}function Br(b,h,u){if(h===0)return[];if(h===1)return[b];for(var d=new Array(h),x=0;x<d.length-1;++x)d[x]=Math.floor(b/u[x]),b-=d[x]*u[x];return d[d.length-1]=b,d}var wi=Object.freeze({shuffle:ft,clamp:Mt,nearestLargerEven:Xt,sum:tn,randUniform:function(b,h){var u=Math.random();return h*u+(1-u)*b},distSquared:function(b,h){for(var u=0,d=0;d<b.length;d++){var x=Number(b[d])-Number(h[d]);u+=x*x}return u},assert:Ce,assertShapesMatch:Wt,assertNonNull:en,flatten:Ut,sizeFromShape:Qe,isScalarShape:function(b){return b.length===0},arraysEqual:fn,isInt:on,tanh:Ct,sizeToSquarishShape:Vt,createShuffledIndices:function(b){for(var h=new Uint32Array(b),u=0;u<b;++u)h[u]=u;return ft(h),h},rightPad:En,repeatedTry:Pt,inferFromImplicitShape:Rt,parseAxisParam:Tn,squeezeShape:Hn,getTypedArrayFromDType:tr,getArrayFromDType:pn,checkConversionForErrors:$e,isValidDtype:et,hasEncodingLoss:Ke,isTypedArray:yt,bytesPerElement:Dt,bytesFromStringArray:Lt,isString:zn,isBoolean:Cn,isNumber:ar,inferDtype:we,isFunction:lr,nearestDivisor:Rr,computeStrides:Tr,toTypedArray:qr,toNestedArray:Gr,makeOnesTypedArray:hn,makeZerosTypedArray:nn,now:an,assertNonNegativeIntegerDimensions:or,fetch:function(b,h){return W().platform.fetch(b,h)},encodeString:jn,decodeString:Fr,locToIndex:Pr,indexToLoc:Br}),Ai=function(){function b(h,u){this.backendTimer=h,this.logger=u,u==null&&(this.logger=new Jn)}return b.prototype.profileKernel=function(h,u,d){var x,T=this,H=this.backendTimer.time(function(){x=d()});return x.forEach(function(Z){Z.data().then(function(ce){(function(ye,Ee,je){if(Ee!=="float32")return!1;for(var Pe=0;Pe<ye.length;Pe++){var ze=ye[Pe];if(isNaN(ze)||!isFinite(ze))return console.warn("Found "+ze+" in the result of '"+je+"'"),!0}})(ce,Z.dtype,h),H.then(function(ye){var Ee="";ye.getExtraProfileInfo!=null&&(Ee=ye.getExtraProfileInfo()),T.logger.logKernelProfile(h,Z,ce,ye.kernelMs,u,Ee)})})}),x},b}(),Jn=function(){function b(){}return b.prototype.logKernelProfile=function(h,u,d,x,T,H){var Z=typeof x=="number"?En(x+"ms",9):x.error,ce=En(h,25),ye=u.rank,Ee=u.size,je=En(u.shape.toString(),14),Pe="";for(var ze in T){var Ge=T[ze].shape||u.shape,rt=Ge.length;Pe+=ze+": "+rt+"D "+(rt>0?Ge:"")+" "}console.log("%c"+ce+"	%c"+Z+"	%c"+ye+"D "+je+"	%c"+Ee+"	%c"+Pe+"	%c"+H,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},b}(),di=20,ri=3,Dr=7;function ki(b,h,u){return En(Array.isArray(b)?parseFloat(b[0].toFixed(Dr))+" + "+parseFloat(b[1].toFixed(Dr))+"j":zn(b)?"'"+b+"'":u==="bool"?Ei(b):parseFloat(b.toFixed(Dr)).toString(),h)}function Ei(b){return b===0?"false":"true"}function mo(b){for(var h=[],u=0;u<b.length;u+=2)h.push([b[u],b[u+1]]);return h}var Gi=function(){function b(h,u,d){var x=this;if(this.dtype=u,this.shape=h.slice(),this.size=Qe(h),d!=null){var T=d.length;Ce(T===this.size,function(){return"Length of values '"+T+"' does not match the size inferred by the shape '"+x.size+"'."})}if(u==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=d||pn(u,this.size),this.strides=Tr(h)}return b.prototype.set=function(h){for(var u=this,d=[],x=1;x<arguments.length;x++)d[x-1]=arguments[x];d.length===0&&(d=[0]),Ce(d.length===this.rank,function(){return"The number of provided coordinates ("+d.length+") must match the rank ("+u.rank+")"});var T=this.locToIndex(d);this.values[T]=h},b.prototype.get=function(){for(var h=[],u=0;u<arguments.length;u++)h[u]=arguments[u];h.length===0&&(h=[0]);for(var d=0,x=0,T=h;x<T.length;x++){var H=T[x];if(H<0||H>=this.shape[d]){var Z="Requested out of range element at "+h+".   Buffer shape="+this.shape;throw new Error(Z)}d++}for(var ce=h[h.length-1],ye=0;ye<h.length-1;++ye)ce+=this.strides[ye]*h[ye];return this.values[ce]},b.prototype.locToIndex=function(h){if(this.rank===0)return 0;if(this.rank===1)return h[0];for(var u=h[h.length-1],d=0;d<h.length-1;++d)u+=this.strides[d]*h[d];return u},b.prototype.indexToLoc=function(h){if(this.rank===0)return[];if(this.rank===1)return[h];for(var u=new Array(this.shape.length),d=0;d<u.length-1;++d)u[d]=Math.floor(h/this.strides[d]),h-=u[d]*this.strides[d];return u[u.length-1]=h,u},Object.defineProperty(b.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),b.prototype.toTensor=function(){return Ui().makeTensor(this.values,this.shape,this.dtype)},b}(),Ui=null,Ot=null,$r=null,$t=function(){function b(h,u,d,x){this.kept=!1,this.isDisposedInternal=!1,this.shape=h.slice(),this.dtype=u||"float32",this.size=Qe(h),this.strides=Tr(h),this.dataId=d,this.id=x,this.rankType=this.rank<5?this.rank.toString():"higher"}return b.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},b.prototype.asScalar=function(){return this.throwIfDisposed(),Ce(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},b.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},b.prototype.as2D=function(h,u){return this.throwIfDisposed(),this.reshape([h,u])},b.prototype.as3D=function(h,u,d){return this.throwIfDisposed(),this.reshape([h,u,d])},b.prototype.as4D=function(h,u,d,x){return this.throwIfDisposed(),this.reshape([h,u,d,x])},b.prototype.as5D=function(h,u,d,x,T){return this.throwIfDisposed(),this.reshape([h,u,d,x,T])},b.prototype.asType=function(h){return this.throwIfDisposed(),Ot.cast(this,h)},Object.defineProperty(b.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),b.prototype.buffer=function(){return M(this,void 0,void 0,function(){var h;return V(this,function(u){switch(u.label){case 0:return[4,this.data()];case 1:return h=u.sent(),[2,Ot.buffer(this.shape,this.dtype,h)]}})})},b.prototype.bufferSync=function(){return Ot.buffer(this.shape,this.dtype,this.dataSync())},b.prototype.array=function(){return M(this,void 0,void 0,function(){var h;return V(this,function(u){switch(u.label){case 0:return[4,this.data()];case 1:return h=u.sent(),[2,Gr(this.shape,h)]}})})},b.prototype.arraySync=function(){return Gr(this.shape,this.dataSync())},b.prototype.data=function(){return M(this,void 0,void 0,function(){var h,u;return V(this,function(d){switch(d.label){case 0:return this.throwIfDisposed(),h=Ui().read(this.dataId),this.dtype!=="string"?[3,2]:[4,h];case 1:u=d.sent();try{return[2,u.map(function(x){return Fr(x)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}d.label=2;case 2:return[2,h]}})})},b.prototype.dataSync=function(){this.throwIfDisposed();var h=Ui().readSync(this.dataId);if(this.dtype==="string")try{return h.map(function(u){return Fr(u)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return h},b.prototype.bytes=function(){return M(this,void 0,void 0,function(){var h;return V(this,function(u){switch(u.label){case 0:return this.throwIfDisposed(),[4,Ui().read(this.dataId)];case 1:return h=u.sent(),this.dtype==="string"?[2,h]:[2,new Uint8Array(h.buffer)]}})})},b.prototype.dispose=function(){this.isDisposed||(Ui().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(b.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),b.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},b.prototype.toFloat=function(){return this.asType("float32")},b.prototype.toInt=function(){return this.asType("int32")},b.prototype.toBool=function(){return this.asType("bool")},b.prototype.print=function(h){return h===void 0&&(h=!1),Ot.print(this,h)},b.prototype.reshape=function(h){return this.throwIfDisposed(),Ot.reshape(this,h)},b.prototype.reshapeAs=function(h){return this.throwIfDisposed(),this.reshape(h.shape)},b.prototype.expandDims=function(h){return h===void 0&&(h=0),Ot.expandDims(this,h)},b.prototype.cumsum=function(h,u,d){return h===void 0&&(h=0),u===void 0&&(u=!1),d===void 0&&(d=!1),Ot.cumsum(this,h,u,d)},b.prototype.squeeze=function(h){return this.throwIfDisposed(),Ot.squeeze(this,h)},b.prototype.clone=function(){return this.throwIfDisposed(),Ot.clone(this)},b.prototype.oneHot=function(h,u,d){return this.throwIfDisposed(),Ot.oneHot(this,h,u,d)},b.prototype.toString=function(h){return h===void 0&&(h=!1),function(u,d,x,T){var H=Tr(d),Z=function(je,Pe,ze,Ge){var rt=Qe(Pe),it=Ge[Ge.length-1],ht=new Array(it).fill(0),Et=Pe.length,At=ze==="complex64"?mo(je):je;if(Et>1)for(var St=0;St<rt/it;St++)for(var Gt=St*it,un=0;un<it;un++)ht[un]=Math.max(ht[un],ki(At[Gt+un],0,ze).length);return ht}(u,d,x,H),ce=d.length,ye=function je(Pe,ze,Ge,rt,it,ht){ht===void 0&&(ht=!0);var Et=Ge==="complex64"?2:1,At=ze[0],St=ze.length;if(St===0)return Ge==="complex64"?[ki(mo(Pe)[0],0,Ge)]:Ge==="bool"?[Ei(Pe[0])]:[Pe[0].toString()];if(St===1){if(At>di){var Gt=ri*Et,un=Array.from(Pe.slice(0,Gt)),vn=Array.from(Pe.slice((At-ri)*Et,At*Et));return Ge==="complex64"&&(un=mo(un),vn=mo(vn)),["["+un.map(function(U,G){return ki(U,it[G],Ge)}).join(", ")+", ..., "+vn.map(function(U,G){return ki(U,it[At-ri+G],Ge)}).join(", ")+"]"]}return["["+(Ge==="complex64"?mo(Pe):Array.from(Pe)).map(function(U,G){return ki(U,it[G],Ge)}).join(", ")+"]"]}var cn=ze.slice(1),kn=rt.slice(1),On=rt[0]*Et,p=[];if(At>di){for(var c=0;c<ri;c++){var a=(l=c*On)+On;p.push.apply(p,je(Pe.slice(l,a),cn,Ge,kn,it,!1))}for(p.push("..."),c=At-ri;c<At;c++)a=(l=c*On)+On,p.push.apply(p,je(Pe.slice(l,a),cn,Ge,kn,it,c===At-1))}else for(c=0;c<At;c++){var l;a=(l=c*On)+On,p.push.apply(p,je(Pe.slice(l,a),cn,Ge,kn,it,c===At-1))}var y=St===2?",":"";for(p[0]="["+p[0]+y,c=1;c<p.length-1;c++)p[c]=" "+p[c]+y;var S=`,
`;for(c=2;c<St;c++)S+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(ht?"":S),p}(u,d,x,H,Z),Ee=["Tensor"];return T&&(Ee.push("  dtype: "+x),Ee.push("  rank: "+ce),Ee.push("  shape: ["+d+"]"),Ee.push("  values:")),Ee.push(ye.map(function(je){return"    "+je}).join(`
`)),Ee.join(`
`)}(this.dataSync(),this.shape,this.dtype,h)},b.prototype.tile=function(h){return this.throwIfDisposed(),Ot.tile(this,h)},b.prototype.gather=function(h,u){return u===void 0&&(u=0),this.throwIfDisposed(),Ot.gather(this,h,u)},b.prototype.matMul=function(h,u,d){return u===void 0&&(u=!1),d===void 0&&(d=!1),this.throwIfDisposed(),Ot.matMul(this,h,u,d)},b.prototype.dot=function(h){return this.throwIfDisposed(),Ot.dot(this,h)},b.prototype.norm=function(h,u,d){return h===void 0&&(h="euclidean"),u===void 0&&(u=null),d===void 0&&(d=!1),this.throwIfDisposed(),Ot.norm(this,h,u,d)},b.prototype.slice=function(h,u){return this.throwIfDisposed(),Ot.slice(this,h,u)},b.prototype.reverse=function(h){return this.throwIfDisposed(),Ot.reverse(this,h)},b.prototype.concat=function(h,u){return u===void 0&&(u=0),this.throwIfDisposed(),h instanceof b&&(h=[h]),Ot.concat([this].concat(h),u)},b.prototype.split=function(h,u){return u===void 0&&(u=0),this.throwIfDisposed(),Ot.split(this,h,u)},b.prototype.stack=function(h,u){return u===void 0&&(u=0),Ot.stack([this,h],u)},b.prototype.unstack=function(h){return h===void 0&&(h=0),Ot.unstack(this,h)},b.prototype.pad=function(h,u){return u===void 0&&(u=0),Ot.pad(this,h,u)},b.prototype.batchNormalization=function(h,u,d,x,T){return d===void 0&&(d=.001),$r("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(h,u,T,x,d)},b.prototype.batchNorm=function(h,u,d,x,T){return T===void 0&&(T=.001),this.throwIfDisposed(),Ot.batchNorm(this,h,u,d,x,T)},b.prototype.all=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),Ot.all(this,h,u)},b.prototype.any=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),Ot.any(this,h,u)},b.prototype.logSumExp=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),Ot.logSumExp(this,h,u)},b.prototype.sum=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),Ot.sum(this,h,u)},b.prototype.prod=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),Ot.prod(this,h,u)},b.prototype.mean=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),Ot.mean(this,h,u)},b.prototype.min=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),Ot.min(this,h,u)},b.prototype.max=function(h,u){return h===void 0&&(h=null),u===void 0&&(u=!1),this.throwIfDisposed(),Ot.max(this,h,u)},b.prototype.argMin=function(h){return h===void 0&&(h=null),this.throwIfDisposed(),Ot.argMin(this,h)},b.prototype.argMax=function(h){return h===void 0&&(h=null),this.throwIfDisposed(),Ot.argMax(this,h)},b.prototype.cast=function(h){return this.throwIfDisposed(),Ot.cast(this,h)},b.prototype.add=function(h){return this.throwIfDisposed(),Ot.add(this,h)},b.prototype.addStrict=function(h){return this.throwIfDisposed(),Ot.addStrict(this,h)},b.prototype.atan2=function(h){return this.throwIfDisposed(),Ot.atan2(this,h)},b.prototype.sub=function(h){return this.throwIfDisposed(),Ot.sub(this,h)},b.prototype.subStrict=function(h){return this.throwIfDisposed(),Ot.subStrict(this,h)},b.prototype.pow=function(h){return this.throwIfDisposed(),Ot.pow(this,h)},b.prototype.powStrict=function(h){return this.throwIfDisposed(),Ot.powStrict(this,h)},b.prototype.mul=function(h){return this.throwIfDisposed(),Ot.mul(this,h)},b.prototype.mulStrict=function(h){return this.throwIfDisposed(),Ot.mulStrict(this,h)},b.prototype.div=function(h){return this.throwIfDisposed(),Ot.div(this,h)},b.prototype.divNoNan=function(h){return this.throwIfDisposed(),Ot.divNoNan(this,h)},b.prototype.floorDiv=function(h){return this.throwIfDisposed(),Ot.floorDiv(this,h)},b.prototype.divStrict=function(h){return this.throwIfDisposed(),Ot.divStrict(this,h)},b.prototype.minimum=function(h){return this.throwIfDisposed(),Ot.minimum(this,h)},b.prototype.minimumStrict=function(h){return this.throwIfDisposed(),Ot.minimumStrict(this,h)},b.prototype.maximum=function(h){return this.throwIfDisposed(),Ot.maximum(this,h)},b.prototype.maximumStrict=function(h){return this.throwIfDisposed(),Ot.maximumStrict(this,h)},b.prototype.mod=function(h){return this.throwIfDisposed(),Ot.mod(this,h)},b.prototype.modStrict=function(h){return this.throwIfDisposed(),Ot.modStrict(this,h)},b.prototype.squaredDifferenceStrict=function(h){return this.throwIfDisposed(),Ot.squaredDifferenceStrict(this,h)},b.prototype.transpose=function(h){return this.throwIfDisposed(),Ot.transpose(this,h)},b.prototype.notEqual=function(h){return this.throwIfDisposed(),Ot.notEqual(this,h)},b.prototype.notEqualStrict=function(h){return this.throwIfDisposed(),Ot.notEqualStrict(this,h)},b.prototype.less=function(h){return this.throwIfDisposed(),Ot.less(this,h)},b.prototype.lessStrict=function(h){return this.throwIfDisposed(),Ot.lessStrict(this,h)},b.prototype.equal=function(h){return this.throwIfDisposed(),Ot.equal(this,h)},b.prototype.equalStrict=function(h){return this.throwIfDisposed(),Ot.equalStrict(this,h)},b.prototype.lessEqual=function(h){return this.throwIfDisposed(),Ot.lessEqual(this,h)},b.prototype.lessEqualStrict=function(h){return this.throwIfDisposed(),Ot.lessEqualStrict(this,h)},b.prototype.greater=function(h){return this.throwIfDisposed(),Ot.greater(this,h)},b.prototype.greaterStrict=function(h){return this.throwIfDisposed(),Ot.greaterStrict(this,h)},b.prototype.greaterEqual=function(h){return this.throwIfDisposed(),Ot.greaterEqual(this,h)},b.prototype.greaterEqualStrict=function(h){return this.throwIfDisposed(),Ot.greaterEqualStrict(this,h)},b.prototype.logicalAnd=function(h){return this.throwIfDisposed(),Ot.logicalAnd(this,h)},b.prototype.logicalOr=function(h){return this.throwIfDisposed(),Ot.logicalOr(this,h)},b.prototype.logicalNot=function(){return this.throwIfDisposed(),Ot.logicalNot(this)},b.prototype.logicalXor=function(h){return this.throwIfDisposed(),Ot.logicalXor(this,h)},b.prototype.where=function(h,u){return this.throwIfDisposed(),Ot.where(h,this,u)},b.prototype.neg=function(){return this.throwIfDisposed(),Ot.neg(this)},b.prototype.ceil=function(){return this.throwIfDisposed(),Ot.ceil(this)},b.prototype.floor=function(){return this.throwIfDisposed(),Ot.floor(this)},b.prototype.sign=function(){return this.throwIfDisposed(),Ot.sign(this)},b.prototype.isNaN=function(){return this.throwIfDisposed(),Ot.isNaN(this)},b.prototype.isInf=function(){return this.throwIfDisposed(),Ot.isInf(this)},b.prototype.isFinite=function(){return this.throwIfDisposed(),Ot.isFinite(this)},b.prototype.exp=function(){return this.throwIfDisposed(),Ot.exp(this)},b.prototype.expm1=function(){return this.throwIfDisposed(),Ot.expm1(this)},b.prototype.log=function(){return this.throwIfDisposed(),Ot.log(this)},b.prototype.log1p=function(){return this.throwIfDisposed(),Ot.log1p(this)},b.prototype.sqrt=function(){return this.throwIfDisposed(),Ot.sqrt(this)},b.prototype.rsqrt=function(){return this.throwIfDisposed(),Ot.rsqrt(this)},b.prototype.square=function(){return this.throwIfDisposed(),Ot.square(this)},b.prototype.reciprocal=function(){return this.throwIfDisposed(),Ot.reciprocal(this)},b.prototype.abs=function(){return this.throwIfDisposed(),Ot.abs(this)},b.prototype.clipByValue=function(h,u){return this.throwIfDisposed(),Ot.clipByValue(this,h,u)},b.prototype.relu=function(){return this.throwIfDisposed(),Ot.relu(this)},b.prototype.relu6=function(){return this.throwIfDisposed(),Ot.relu6(this)},b.prototype.elu=function(){return this.throwIfDisposed(),Ot.elu(this)},b.prototype.selu=function(){return this.throwIfDisposed(),Ot.selu(this)},b.prototype.leakyRelu=function(h){return h===void 0&&(h=.2),this.throwIfDisposed(),Ot.leakyRelu(this,h)},b.prototype.prelu=function(h){return this.throwIfDisposed(),Ot.prelu(this,h)},b.prototype.sigmoid=function(){return this.throwIfDisposed(),Ot.sigmoid(this)},b.prototype.logSigmoid=function(){return this.throwIfDisposed(),Ot.logSigmoid(this)},b.prototype.softplus=function(){return this.throwIfDisposed(),Ot.softplus(this)},b.prototype.zerosLike=function(){return this.throwIfDisposed(),Ot.zerosLike(this)},b.prototype.onesLike=function(){return this.throwIfDisposed(),Ot.onesLike(this)},b.prototype.sin=function(){return this.throwIfDisposed(),Ot.sin(this)},b.prototype.cos=function(){return this.throwIfDisposed(),Ot.cos(this)},b.prototype.tan=function(){return this.throwIfDisposed(),Ot.tan(this)},b.prototype.asin=function(){return this.throwIfDisposed(),Ot.asin(this)},b.prototype.acos=function(){return this.throwIfDisposed(),Ot.acos(this)},b.prototype.atan=function(){return this.throwIfDisposed(),Ot.atan(this)},b.prototype.sinh=function(){return this.throwIfDisposed(),Ot.sinh(this)},b.prototype.cosh=function(){return this.throwIfDisposed(),Ot.cosh(this)},b.prototype.tanh=function(){return this.throwIfDisposed(),Ot.tanh(this)},b.prototype.asinh=function(){return this.throwIfDisposed(),Ot.asinh(this)},b.prototype.acosh=function(){return this.throwIfDisposed(),Ot.acosh(this)},b.prototype.atanh=function(){return this.throwIfDisposed(),Ot.atanh(this)},b.prototype.erf=function(){return this.throwIfDisposed(),Ot.erf(this)},b.prototype.round=function(){return this.throwIfDisposed(),Ot.round(this)},b.prototype.step=function(h){return h===void 0&&(h=0),this.throwIfDisposed(),Ot.step(this,h)},b.prototype.softmax=function(h){return h===void 0&&(h=-1),this.throwIfDisposed(),Ot.softmax(this,h)},b.prototype.logSoftmax=function(h){return h===void 0&&(h=-1),this.throwIfDisposed(),Ot.logSoftmax(this,h)},b.prototype.resizeBilinear=function(h,u){return u===void 0&&(u=!1),this.throwIfDisposed(),Ot.image.resizeBilinear(this,h,u)},b.prototype.resizeNearestNeighbor=function(h,u){return u===void 0&&(u=!1),this.throwIfDisposed(),Ot.image.resizeNearestNeighbor(this,h,u)},b.prototype.conv1d=function(h,u,d,x,T,H){return x===void 0&&(x="NWC"),T===void 0&&(T=1),this.throwIfDisposed(),Ot.conv1d(this,h,u,d,x,T,H)},b.prototype.conv2d=function(h,u,d,x,T,H){return x===void 0&&(x="NHWC"),T===void 0&&(T=[1,1]),this.throwIfDisposed(),Ot.conv2d(this,h,u,d,x,T,H)},b.prototype.conv2dTranspose=function(h,u,d,x,T){return this.throwIfDisposed(),Ot.conv2dTranspose(this,h,u,d,x,T)},b.prototype.depthwiseConv2D=function(h,u,d,x,T,H){return x===void 0&&(x="NHWC"),T===void 0&&(T=[1,1]),this.throwIfDisposed(),Ot.depthwiseConv2d(this,h,u,d,x,T,H)},b.prototype.separableConv2d=function(h,u,d,x,T,H){return T===void 0&&(T=[1,1]),H===void 0&&(H="NHWC"),this.throwIfDisposed(),Ot.separableConv2d(this,h,u,d,x,T,H)},b.prototype.avgPool=function(h,u,d,x){return this.throwIfDisposed(),Ot.avgPool(this,h,u,d,x)},b.prototype.maxPool=function(h,u,d,x){return this.throwIfDisposed(),Ot.maxPool(this,h,u,d,x)},b.prototype.localResponseNormalization=function(h,u,d,x){return h===void 0&&(h=5),u===void 0&&(u=1),d===void 0&&(d=1),x===void 0&&(x=.5),Ot.localResponseNormalization(this,h,u,d,x)},b.prototype.pool=function(h,u,d,x,T){return this.throwIfDisposed(),Ot.pool(this,h,u,d,x,T)},b.prototype.variable=function(h,u,d){return h===void 0&&(h=!0),this.throwIfDisposed(),Ui().makeVariable(this,h,u,d)},b.prototype.unsortedSegmentSum=function(h,u){return this.throwIfDisposed(),Ot.unsortedSegmentSum(this,h,u)},b.prototype.batchToSpaceND=function(h,u){return this.throwIfDisposed(),Ot.batchToSpaceND(this,h,u)},b.prototype.spaceToBatchND=function(h,u){return this.throwIfDisposed(),Ot.spaceToBatchND(this,h,u)},b.prototype.topk=function(h,u){return h===void 0&&(h=1),u===void 0&&(u=!0),this.throwIfDisposed(),Ot.topk(this,h,u)},b.prototype.stridedSlice=function(h,u,d,x,T,H,Z,ce){return x===void 0&&(x=0),T===void 0&&(T=0),H===void 0&&(H=0),Z===void 0&&(Z=0),ce===void 0&&(ce=0),this.throwIfDisposed(),Ot.stridedSlice(this,h,u,d,x,T,H,Z,ce)},b.prototype.depthToSpace=function(h,u){return this.throwIfDisposed(),Ot.depthToSpace(this,h,u)},b.prototype.fft=function(){return this.throwIfDisposed(),Ot.spectral.fft(this)},b.prototype.ifft=function(){return this.throwIfDisposed(),Ot.spectral.ifft(this)},b.prototype.rfft=function(){return this.throwIfDisposed(),Ot.spectral.rfft(this)},b.prototype.irfft=function(){return this.throwIfDisposed(),Ot.spectral.irfft(this)},b}();Object.defineProperty($t,Symbol.hasInstance,{value:function(b){return!!b&&b.dataId!=null&&b.shape!=null&&b.dtype!=null}});var xe,ge,ke,Ne,ot,xt=function(b){function h(u,d,x,T){var H=b.call(this,u.shape,u.dtype,u.dataId,T)||this;return H.trainable=d,H.name=x,H}return K(h,b),h.prototype.assign=function(u){if(u.dtype!==this.dtype)throw new Error("dtype of the new value ("+u.dtype+") and previous value ("+this.dtype+") must match");if(!fn(u.shape,this.shape))throw new Error("shape of the new value ("+u.shape+") and previous value ("+this.shape+") must match");Ui().disposeTensor(this),this.dataId=u.dataId,Ui().incRef(this,null)},h.prototype.dispose=function(){Ui().disposeVariable(this),this.isDisposedInternal=!0},h}($t);Object.defineProperty(xt,Symbol.hasInstance,{value:function(b){return b instanceof $t&&b.assign!=null&&b.assign instanceof Function}}),function(b){b.R0="R0",b.R1="R1",b.R2="R2",b.R3="R3",b.R4="R4",b.R5="R5",b.R6="R6"}(xe||(xe={})),function(b){b.float32="float32",b.int32="int32",b.bool="int32",b.complex64="complex64"}(ge||(ge={})),function(b){b.float32="float32",b.int32="int32",b.bool="bool",b.complex64="complex64"}(ke||(ke={})),function(b){b.float32="float32",b.int32="float32",b.bool="float32",b.complex64="complex64"}(Ne||(Ne={})),function(b){b.float32="complex64",b.int32="complex64",b.bool="complex64",b.complex64="complex64"}(ot||(ot={}));var Ht={float32:Ne,int32:ge,bool:ke,complex64:ot};function yn(b,h){if(b==="string"||h==="string"){if(b==="string"&&h==="string")return"string";throw new Error("Can not upcast "+b+" with "+h)}return Ht[b][h]}function dr(b){return yn(b,"int32")}function _n(b,h){if(b.dtype===h.dtype)return[b,h];var u=yn(b.dtype,h.dtype);return[b.cast(u),h.cast(u)]}function In(b,h){Ce(b.dtype===h.dtype,function(){return"The dtypes of the first("+b.dtype+") and second("+h.dtype+") input must match"})}function Gn(b){var h=[];return function u(d,x,T){if(d!=null){if(d instanceof $t)x.push(d);else if(H=d,Array.isArray(H)||typeof H=="object"){var H,Z=d;for(var ce in Z){var ye=Z[ce];T.has(ye)||(T.add(ye),u(ye,x,T))}}}}(b,h,new Set),h}var Nt,Ft=Object.freeze({makeTypesMatch:_n,assertTypesMatch:In,isTensorInList:function(b,h){return h.some(function(u){return u.id===b.id})},getTensorsInContainer:Gn}),bn=function(){function b(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return b.prototype.dispose=function(){for(var h in this.registeredVariables)this.registeredVariables[h].dispose()},b}(),Yt=function(){function b(h){this.ENV=h,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new bn}return b.prototype.ready=function(){return M(this,void 0,void 0,function(){var h,u,d;return V(this,function(x){switch(x.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];h=this.getSortedBackends(),u=0,x.label=1;case 1:return u<h.length?(d=h[u],[4,this.initializeBackend(d).success]):[3,5];case 2:return x.sent()?[4,this.setBackend(d)]:[3,4];case 3:return x.sent(),[2];case 4:return u++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(b.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var h=this.initializeBackendsAndReturnBest(),u=h.name;if(h.asyncInit)throw new Error("The highest priority backend '"+u+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(u)}return this.backendInstance},enumerable:!0,configurable:!0}),b.prototype.backendNames=function(){return Object.keys(this.registryFactory)},b.prototype.findBackend=function(h){return!(h in this.registry)&&(!(h in this.registryFactory)||this.initializeBackend(h).asyncInit)?null:this.registry[h]},b.prototype.findBackendFactory=function(h){return h in this.registryFactory?this.registryFactory[h].factory:null},b.prototype.registerBackend=function(h,u,d){return d===void 0&&(d=1),h in this.registryFactory?(console.warn(h+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[h]={factory:u,priority:d},!0)},b.prototype.setBackend=function(h){return M(this,void 0,void 0,function(){var u,d,x;return V(this,function(T){switch(T.label){case 0:if(this.registryFactory[h]==null)throw new Error("Backend name '"+h+"' not found in registry");return this.backendName=h,this.registry[h]!=null?[3,4]:(this.backendInstance=null,u=this.initializeBackend(h),d=u.success,u.asyncInit?[4,d]:[3,2]);case 1:return x=T.sent(),[3,3];case 2:x=d,T.label=3;case 3:if(!x)return[2,!1];T.label=4;case 4:return this.backendInstance=this.registry[h],this.setupRegisteredKernels(),this.profiler=new Ai(this.backendInstance),[2,!0]}})})},b.prototype.setupRegisteredKernels=function(){var h=this;me(this.backendName).forEach(function(u){u.setupFunc!=null&&u.setupFunc(h.backendInstance)})},b.prototype.disposeRegisteredKernels=function(h){var u=this;me(h).forEach(function(d){d.disposeFunc!=null&&d.disposeFunc(u.registry[h])})},b.prototype.initializeBackend=function(h){var u=this,d=this.registryFactory[h];if(d==null)throw new Error("Cannot initialize backend "+h+", no registration found.");try{var x=d.factory();if(Promise.resolve(x)===x){var T=++this.pendingBackendInitId,H=x.then(function(Z){return!(T<u.pendingBackendInitId||(u.registry[h]=Z,u.pendingBackendInit=null,0))}).catch(function(Z){return!(T<u.pendingBackendInitId||(u.pendingBackendInit=null,console.warn("Initialization of backend "+h+" failed"),console.warn(Z.stack||Z.message),1))});return this.pendingBackendInit=H,{success:H,asyncInit:!0}}return this.registry[h]=x,{success:!0,asyncInit:!1}}catch(Z){return console.warn("Initialization of backend "+h+" failed"),console.warn(Z.stack||Z.message),{success:!1,asyncInit:!1}}},b.prototype.removeBackend=function(h){if(!(h in this.registryFactory))throw new Error(h+" backend not found in registry");this.backendName===h&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,h in this.registry&&(this.disposeRegisteredKernels(h),this.registry[h].dispose(),delete this.registry[h]),delete this.registryFactory[h],this.backendName===h&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},b.prototype.getSortedBackends=function(){var h=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(u,d){return h.registryFactory[d].priority-h.registryFactory[u].priority})},b.prototype.initializeBackendsAndReturnBest=function(){for(var h=this.getSortedBackends(),u=0;u<h.length;u++){var d=h[u],x=this.initializeBackend(d),T=x.success,H=x.asyncInit;if(H||T)return{name:d,asyncInit:H}}throw new Error("Could not initialize any backends, all backend initializations failed.")},b.prototype.moveData=function(h,u){var d=this.state.tensorInfo.get(u),x=d.backend,T=this.readSync(u);x.disposeData(u),d.backend=h,h.move(u,T,d.shape,d.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},b.prototype.tidy=function(h,u){var d,x=this,T=null;if(u==null){if(typeof h!="function")throw new Error("Please provide a function to tidy()");u=h}else{if(typeof h!="string"&&!(h instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof u!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");T=h}return this.scopedRun(function(){return x.startScope(T)},function(){return x.endScope(d)},function(){return(d=u())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),d})},b.prototype.scopedRun=function(h,u,d){h();try{var x=d();return u(),x}catch(T){throw u(),T}},b.prototype.nextTensorId=function(){return b.nextTensorId++},b.prototype.nextVariableId=function(){return b.nextVariableId++},b.prototype.clone=function(h){var u=this.makeTensorFromDataId(h.dataId,h.shape,h.dtype),d={x:h};return this.addTapeNode(this.state.activeScope.name,d,[u],function(x){return{x:function(){return x.toFloat()}}},[]),u},b.prototype.runKernel=function(h,u,d,x,T){return this.runKernelFunc(null,u,null,h,d,x,T)},b.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},b.prototype.checkKernelForMemLeak=function(h,u,d){var x=this.backend.numDataIds(),T=0;d.forEach(function(ce){T+=ce.dtype==="complex64"?3:1});var H=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],Z=x-u-T-H;if(Z>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+Z+" data ids) after running '"+h+"'")},b.prototype.runKernelFunc=function(h,u,d,x,T,H,Z){var ce,ye=this;H===void 0&&(H=[]),Z===void 0&&(Z=[]);var Ee=[],je=this.isTapeOn();x==null&&(x=this.state.activeScope!=null?this.state.activeScope.name:"");var Pe,ze=function(Et){je&&(Ee=Et.map(function(At){return ye.keep(ye.clone(At))}))},Ge=this.state.numBytes,rt=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var it,ht=se(x,this.backendName);return Pe=ht!=null?function(){var Et=ye.backend.numDataIds();it=ht.kernelFunc({inputs:u,attrs:T,backend:ye.backend});var At=Array.isArray(it)?it:[it];ye.shouldCheckForMemLeaks()&&ye.checkKernelForMemLeak(x,Et,At);var St=At.map(function(un){var vn=un.dataId,cn=un.shape,kn=un.dtype;return ye.makeTensorFromDataId(vn,cn,kn)}),Gt=St.filter(function(un,vn){return Z[vn]});return ze((H||[]).slice().concat(Gt)),St}:function(){var Et=ye.backend.numDataIds();it=ye.tidy(function(){return h(ye.backend,ze)});var At=Array.isArray(it)?it:[it];return ye.shouldCheckForMemLeaks()&&ye.checkKernelForMemLeak(x,Et,At),At},this.scopedRun(function(){return ye.state.kernelDepth++},function(){return ye.state.kernelDepth--},function(){ce=ye.ENV.getBool("DEBUG")?ye.profiler.profileKernel(x,u,function(){return Pe()}):Pe()}),je&&this.addTapeNode(x,u,ce,d,Ee),this.state.profiling&&this.state.activeProfile.kernels.push({name:x,bytesAdded:this.state.numBytes-Ge,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-rt,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map(function(Et){return u[Et].shape}),outputShapes:ce.map(function(Et){return Et.shape})}),Array.isArray(it)?ce:ce[0]},b.prototype.makeTensor=function(h,u,d,x){if(h==null)throw new Error("Values passed to engine.makeTensor() are null");d=d||"float32",x=x||this.backend;var T=h;d==="string"&&zn(h[0])&&(T=h.map(function(Ee){return jn(Ee)}));var H=x.write(T,u,d),Z=new $t(u,d,H,this.nextTensorId());if(this.incRef(Z,x),d==="string"){var ce=this.state.tensorInfo.get(H),ye=Lt(T);this.state.numBytes+=ye-ce.bytes,ce.bytes=ye}return Z},b.prototype.makeTensorFromDataId=function(h,u,d,x){var T=new $t(u,d=d||"float32",h,this.nextTensorId());return this.incRef(T,x),T},b.prototype.makeVariable=function(h,u,d,x){u===void 0&&(u=!0),d=d||this.nextVariableId().toString(),x!=null&&x!==h.dtype&&(h=h.asType(x));var T=new xt(h,u,d,this.nextTensorId());if(this.state.registeredVariables[T.name]!=null)throw new Error("Variable with name "+T.name+" was already registered");return this.state.registeredVariables[T.name]=T,this.incRef(T,this.backend),T},b.prototype.incRef=function(h,u){var d=this.state.tensorInfo.has(h.dataId)?this.state.tensorInfo.get(h.dataId).refCount:0;if(this.state.numTensors++,h.dtype==="string"&&this.state.numStringTensors++,d===0){this.state.numDataBuffers++;var x=0;h.dtype!=="complex64"&&h.dtype!=="string"&&(x=h.size*Dt(h.dtype)),this.state.tensorInfo.set(h.dataId,{backend:u||this.backend,dtype:h.dtype,shape:h.shape,bytes:x,refCount:0}),this.state.numBytes+=x}this.state.tensorInfo.get(h.dataId).refCount++,h instanceof xt||this.track(h)},b.prototype.disposeTensor=function(h){if(this.state.tensorInfo.has(h.dataId)){this.state.numTensors--,h.dtype==="string"&&this.state.numStringTensors--;var u=this.state.tensorInfo.get(h.dataId);u.refCount<=1?(h.dtype!=="complex64"&&(this.state.numBytes-=u.bytes),this.state.numDataBuffers--,u.backend.disposeData(h.dataId),this.state.tensorInfo.delete(h.dataId)):this.state.tensorInfo.get(h.dataId).refCount--}},b.prototype.disposeVariables=function(){for(var h in this.state.registeredVariables){var u=this.state.registeredVariables[h];this.disposeVariable(u)}},b.prototype.disposeVariable=function(h){this.disposeTensor(h),this.state.registeredVariables[h.name]!=null&&delete this.state.registeredVariables[h.name]},b.prototype.memory=function(){var h=this.backend.memory();return h.numTensors=this.state.numTensors,h.numDataBuffers=this.state.numDataBuffers,h.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(h.unreliable=!0,h.reasons==null&&(h.reasons=[]),h.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),h},b.prototype.profile=function(h){return M(this,void 0,void 0,function(){var u,d;return V(this,function(x){return this.state.profiling=!0,u=this.state.numBytes,d=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=h(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(T){return T.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-u,this.state.activeProfile.newTensors=this.state.numTensors-d,[2,this.state.activeProfile]})})},b.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},b.prototype.addTapeNode=function(h,u,d,x,T){var H=this,Z={id:this.state.nextTapeNodeId++,kernelName:h,inputs:u,outputs:d,saved:T},ce=J(h);ce!=null&&(x=ce.gradFunc),x!=null&&(Z.gradient=function(ye){return ye=ye.map(function(Ee,je){if(Ee==null){var Pe=d[je],ze=nn(Pe.size,Pe.dtype);return H.makeTensor(ze,Pe.shape,Pe.dtype)}return Ee}),x(ye.length>1?ye:ye[0],T)}),this.state.activeTape.push(Z)},b.prototype.keep=function(h){return h.kept=!0,h},b.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},b.prototype.endTape=function(){this.state.gradientDepth--},b.prototype.startScope=function(h){var u={track:[],name:"unnamed scope",id:this.state.nextScopeId++};h&&(u.name=h),this.state.scopeStack.push(u),this.state.activeScope=u},b.prototype.endScope=function(h){for(var u=this,d=Gn(h),x=new Set(d.map(function(ce){return ce.id})),T=0;T<this.state.activeScope.track.length;T++){var H=this.state.activeScope.track[T];H.kept||x.has(H.id)||H.dispose()}var Z=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],d.forEach(function(ce){ce.kept||ce.scopeId!==Z.id||u.track(ce)})},b.prototype.gradients=function(h,u,d,x){var T=this;if(x===void 0&&(x=!1),Ce(u.length>0,function(){return"gradients() received an empty list of xs."}),d!=null&&d.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+d.dtype+"'");var H=this.scopedRun(function(){return T.startTape()},function(){return T.endTape()},function(){return T.tidy("forward",h)});Ce(H instanceof $t,function(){return"The result y returned by f() must be a tensor."});var Z=function(ce,ye,Ee){for(var je={},Pe={},ze=0;ze<ye.length;ze++)je[ye[ze].id]=!0;for(ze=0;ze<ce.length;ze++){var Ge=(un=ce[ze]).inputs;for(var rt in Ge){for(var it=Ge[rt],ht=!1,Et=0;Et<ye.length;Et++)if(je[it.id]){un.outputs.forEach(function(On){return je[On.id]=!0}),ht=!0,Pe[un.id]=!0;break}if(ht)break}}var At={};At[Ee.id]=!0;var St={};for(ze=ce.length-1;ze>=0;ze--)for(Ge=(un=ce[ze]).inputs,Et=0;Et<un.outputs.length;Et++)if(At[un.outputs[Et].id]){for(var rt in Ge)At[Ge[rt].id]=!0,St[un.id]=!0;break}var Gt=[];for(ze=0;ze<ce.length;ze++){var un;if(Pe[(un=ce[ze]).id]&&St[un.id]){var vn={};for(var rt in un.inputs){var cn=un.inputs[rt];je[cn.id]&&(vn[rt]=cn)}var kn=Object.assign({},un);kn.inputs=vn,kn.outputs=un.outputs,Gt.push(kn)}}return Gt}(this.state.activeTape,u,H);if(!x&&Z.length===0&&u.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var ce,ye,Ee={};Ee[H.id]=d==null?(ye=hn(Qe(ce=H.shape),"float32"),He.makeTensor(ye,ce,"float32")):d,function(Pe,ze,Ge){for(var rt=function(ht){var Et=ze[ht],At=[];if(Et.outputs.forEach(function(vn){var cn=Pe[vn.id];cn!=null?At.push(cn):At.push(null)}),Et.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+Et.kernelName+".");var St=Et.gradient(At),Gt=function(vn){if(!(vn in St))throw new Error("Cannot backprop through input "+vn+". Available gradients found: "+Object.keys(St)+".");var cn=Ge(function(){return St[vn]()});if(cn.dtype!=="float32")throw new Error("Error in gradient for op "+Et.kernelName+". The gradient of input "+vn+" must have 'float32' dtype, but has '"+cn.dtype+"'");var kn=Et.inputs[vn];if(!fn(cn.shape,kn.shape))throw new Error("Error in gradient for op "+Et.kernelName+". The gradient of input '"+vn+"' has shape '"+cn.shape+"', which does not match the shape of the input '"+kn.shape+"'");if(Pe[kn.id]==null)Pe[kn.id]=cn;else{var On=Pe[kn.id];Pe[kn.id]=On.add(cn),On.dispose()}};for(var un in Et.inputs)Gt(un)},it=ze.length-1;it>=0;it--)rt(it)}(Ee,Z,function(Pe){return T.tidy(Pe)});var je=u.map(function(Pe){return Ee[Pe.id]});return T.state.gradientDepth===0&&(T.state.activeTape.forEach(function(Pe){for(var ze=0,Ge=Pe.saved;ze<Ge.length;ze++)Ge[ze].dispose()}),T.state.activeTape=null),{value:H,grads:je}})},b.prototype.customGrad=function(h){var u=this;return Ce(lr(h),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var d,x=[],T=0;T<arguments.length;T++)x[T]=arguments[T];Ce(x.every(function(Z){return Z instanceof $t}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var H={};return x.forEach(function(Z,ce){H[ce]=Z}),u.runKernelFunc(function(Z,ce){return Ce((d=h.apply(void 0,x.concat([ce]))).value instanceof $t,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),Ce(lr(d.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),d.value},H,function(Z,ce){var ye=d.gradFunc(Z,ce),Ee=Array.isArray(ye)?ye:[ye];Ce(Ee.length===x.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),Ce(Ee.every(function(Pe){return Pe instanceof $t}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var je={};return Ee.forEach(function(Pe,ze){je[ze]=function(){return Pe}}),je})}},b.prototype.readSync=function(h){return this.state.tensorInfo.get(h).backend.readSync(h)},b.prototype.read=function(h){return this.state.tensorInfo.get(h).backend.read(h)},b.prototype.time=function(h){return M(this,void 0,void 0,function(){var u,d;return V(this,function(x){switch(x.label){case 0:return u=an(),[4,this.backend.time(h)];case 1:return(d=x.sent()).wallMs=an()-u,[2,d]}})})},b.prototype.track=function(h){return this.state.activeScope!=null&&(h.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(h)),h},Object.defineProperty(b.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),b.prototype.reset=function(){for(var h in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new bn,this.registry)this.disposeRegisteredKernels(h),this.registry[h].dispose(),delete this.registry[h];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},b.nextTensorId=0,b.nextVariableId=0,b}(),He=function(){var b=function(){if(Nt==null){var u=void 0;if(typeof window!="undefined")u=window;else if(g!==void 0)u=g;else if(z!==void 0)u=z;else{if(typeof self=="undefined")throw new Error("Could not find a global object");u=self}Nt=u}return Nt}();if(b._tfengine==null){var h=new $(b);b._tfengine=new Yt(h)}return function(u){te=u}(b._tfengine.ENV),Ui=function(){return b._tfengine},b._tfengine}();function $n(){return typeof window!="undefined"&&window.document!=null||typeof WorkerGlobalScope!="undefined"}var ur=W();ur.registerFlag("DEBUG",function(){return!1},function(b){b&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),ur.registerFlag("IS_BROWSER",function(){return $n()}),ur.registerFlag("IS_NODE",function(){return z!==void 0&&z.versions!==void 0&&z.versions.node!==void 0}),ur.registerFlag("IS_CHROME",function(){return typeof navigator!="undefined"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),ur.registerFlag("PROD",function(){return!1}),ur.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return ur.getBool("DEBUG")}),ur.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),ur.registerFlag("IS_TEST",function(){return!1});var pr,kr,ui,Ir={},ji={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Do(b,h){Ir[b]=h}function Bi(b){b in Ir||(Ir[b]=function(u){if(u!==1&&u!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var d=function(x){if(typeof OffscreenCanvas!="undefined"&&x===2)return new OffscreenCanvas(300,150);if(typeof document!="undefined")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(u);return d.addEventListener("webglcontextlost",function(x){x.preventDefault(),delete Ir[u]},!1),u===1?d.getContext("webgl",ji)||d.getContext("experimental-webgl",ji):d.getContext("webgl2",ji)}(b));var h=Ir[b];return h.isContextLost()?(delete Ir[b],Bi(b)):(h.disable(h.DEPTH_TEST),h.disable(h.STENCIL_TEST),h.disable(h.BLEND),h.disable(h.DITHER),h.disable(h.POLYGON_OFFSET_FILL),h.disable(h.SAMPLE_COVERAGE),h.enable(h.SCISSOR_TEST),h.enable(h.CULL_FACE),h.cullFace(h.BACK),Ir[b])}function no(b,h){return[h,b]}function $i(b){var h=Qe(b);return Vt(Math.ceil(h/4))}function mi(b,h){return[Math.max(1,Math.ceil(h/2)),Math.max(1,Math.ceil(b/2))]}function ai(b,h){var u,d,x,T,H,Z,ce,ye,Ee,je=b;return W().getNumber("WEBGL_VERSION")===2?(u=je.R32F,d=je.R16F,x=je.RGBA16F,T=je.RGBA32F,H=je.RED,Z=4,ce=1,ye=je.HALF_FLOAT,Ee=je.FLOAT):(u=b.RGBA,d=b.RGBA,x=b.RGBA,T=je.RGBA,H=b.RGBA,Z=4,ce=4,ye=h!=null?h.HALF_FLOAT_OES:null,Ee=b.FLOAT),{internalFormatFloat:u,internalFormatHalfFloat:d,internalFormatPackedHalfFloat:x,internalFormatPackedFloat:T,textureFormatFloat:H,downloadTextureFormat:b.RGBA,downloadUnpackNumChannels:Z,defaultNumChannels:ce,textureTypeHalfFloat:ye,textureTypeFloat:Ee}}function qn(b,h,u){var d=u();return h&&function(x){var T=x.getError();if(T!==x.NO_ERROR)throw new Error("WebGL Error: "+Wo(x,T))}(b),d}(function(b){b[b.DENSE=0]="DENSE",b[b.SHARED_BATCH=1]="SHARED_BATCH"})(pr||(pr={})),function(b){b[b.RENDER=0]="RENDER",b[b.UPLOAD=1]="UPLOAD",b[b.PIXELS=2]="PIXELS",b[b.DOWNLOAD=3]="DOWNLOAD"}(kr||(kr={})),function(b){b[b.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",b[b.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",b[b.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",b[b.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",b[b.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(ui||(ui={}));var Di=596e-10,ko=65504;function Zr(b){return!!(W().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||b===0||Di<Math.abs(b)&&Math.abs(b)<ko)}function Wo(b,h){switch(h){case b.NO_ERROR:return"NO_ERROR";case b.INVALID_ENUM:return"INVALID_ENUM";case b.INVALID_VALUE:return"INVALID_VALUE";case b.INVALID_OPERATION:return"INVALID_OPERATION";case b.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case b.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case b.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+h}}function Oo(b,h,u){return Ga(b,h,function(){return b.getExtension(u)},'Extension "'+u+'" not supported on this browser.')}function So(b,h,u){var d=Ga(b,h,function(){return b.createShader(b.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(qn(b,h,function(){return b.shaderSource(d,u)}),qn(b,h,function(){return b.compileShader(d)}),b.getShaderParameter(d,b.COMPILE_STATUS)===!1)throw console.log(b.getShaderInfoLog(d)),new Error("Failed to compile vertex shader.");return d}function To(b,h,u){var d=Ga(b,h,function(){return b.createShader(b.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(qn(b,h,function(){return b.shaderSource(d,u)}),qn(b,h,function(){return b.compileShader(d)}),b.getShaderParameter(d,b.COMPILE_STATUS)===!1)throw function(x,T){var H=Cf.exec(T);if(H==null)return console.log("Couldn't parse line number in error: "+T),void console.log(x);for(var Z=+H[1],ce=x.split(`
`),ye=ce.length.toString().length+2,Ee=ce.map(function(it,ht){return En((ht+1).toString(),ye)+it}),je=0,Pe=0;Pe<Ee.length;Pe++)je=Math.max(Ee[Pe].length,je);var ze=Ee.slice(0,Z-1),Ge=Ee.slice(Z-1,Z),rt=Ee.slice(Z);console.log(ze.join(`
`)),console.log(T.split(`
`)[0]),console.log("%c "+En(Ge[0],je),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(rt.join(`
`))}(u,b.getShaderInfoLog(d)),new Error("Failed to compile fragment shader.");return d}var ds,As,Cf=/ERROR: [0-9]+:([0-9]+):/g;function eo(b,h){return Ga(b,h,function(){return b.createProgram()},"Unable to create WebGLProgram.")}function bu(b,h,u){if(qn(b,h,function(){return b.linkProgram(u)}),b.getProgramParameter(u,b.LINK_STATUS)===!1)throw console.log(b.getProgramInfoLog(u)),new Error("Failed to link vertex and fragment shaders.")}function wc(b,h,u){if(qn(b,h,function(){return b.validateProgram(u)}),b.getProgramParameter(u,b.VALIDATE_STATUS)===!1)throw console.log(b.getProgramInfoLog(u)),new Error("Shader program validation failed.")}function kc(b,h,u){var d=Ga(b,h,function(){return b.createBuffer()},"Unable to create WebGLBuffer");return qn(b,h,function(){return b.bindBuffer(b.ARRAY_BUFFER,d)}),qn(b,h,function(){return b.bufferData(b.ARRAY_BUFFER,u,b.STATIC_DRAW)}),d}function _c(b,h,u){var d=Ga(b,h,function(){return b.createBuffer()},"Unable to create WebGLBuffer");return qn(b,h,function(){return b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,d)}),qn(b,h,function(){return b.bufferData(b.ELEMENT_ARRAY_BUFFER,u,b.STATIC_DRAW)}),d}function ws(b,h){return Ga(b,h,function(){return b.createTexture()},"Unable to create WebGLTexture.")}function Ql(b,h){var u=W().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(b<=0||h<=0){var d="["+b+"x"+h+"]";throw new Error("Requested texture size "+d+" is invalid.")}if(b>u||h>u)throw d="["+b+"x"+h+"]",new Error("Requested texture size "+d+" greater than WebGL maximum on this browser / GPU ["+u+"x"+u+"].")}function Hs(b,h){return Ga(b,h,function(){return b.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Mc(b,h,u,d,x,T,H,Z){var ce=b.getAttribLocation(u,d);return ce!==-1&&(qn(b,h,function(){return b.bindBuffer(b.ARRAY_BUFFER,x)}),qn(b,h,function(){return b.vertexAttribPointer(ce,T,b.FLOAT,!1,H,Z)}),qn(b,h,function(){return b.enableVertexAttribArray(ce)}),!0)}function Af(b,h,u,d){Kc(b,d),qn(b,h,function(){return b.activeTexture(b.TEXTURE0+d)}),qn(b,h,function(){return b.bindTexture(b.TEXTURE_2D,u)})}function Gs(b,h,u,d){return Ga(b,h,function(){return b.getUniformLocation(u,d)},'uniform "'+d+'" not present in program.')}function Zl(b,h,u){return b.getUniformLocation(h,u)}function pl(b,h,u,d,x,T){qn(b,h,function(){return Af(b,h,d,T)}),qn(b,h,function(){return b.uniform1i(x,T)})}function ml(b,h,u,d){qn(b,h,function(){return b.bindFramebuffer(b.FRAMEBUFFER,d)}),qn(b,h,function(){return b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,u,0)})}function Gc(b,h,u){qn(b,h,function(){return b.bindFramebuffer(b.FRAMEBUFFER,u)}),qn(b,h,function(){return b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0)})}function ha(b){var h=b.checkFramebufferStatus(b.FRAMEBUFFER);if(h!==b.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+$c(b,h))}function $c(b,h){switch(h){case b.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case b.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case b.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case b.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+h}}function Ga(b,h,u,d){var x=qn(b,h,function(){return u()});if(x==null)throw new Error(d);return x}function Kc(b,h){var u=b.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,d=h+b.TEXTURE0;if(d<b.TEXTURE0||d>u)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+u+"].")}function Is(b,h){return h===void 0&&(h=2),Qe(b.slice(0,b.length-h))}function Ba(b){if(b.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[b.length>1?b[b.length-2]:1,b[b.length-1]]}function jc(b){var h=[1,1,1];return b.length===0||b.length===1&&b[0]===1||(h=[Is(b)].concat(Ba(b))),h}function ac(b,h){var u;h===void 0&&(h=!1);var d=W().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(h&&(d*=2,(b=b.map(function(ye,Ee){return Ee>=b.length-2?Xt(b[Ee]):b[Ee]})).length===1&&(b=[2,b[0]])),b.length!==2){var x=Hn(b);b=x.newShape}var T=Qe(b);if(b.length<=1&&T<=d)return[1,T];if(b.length===2&&b[0]<=d&&b[1]<=d)return b;if(b.length===3&&b[0]*b[1]<=d&&b[2]<=d)return[b[0]*b[1],b[2]];if(b.length===3&&b[0]<=d&&b[1]*b[2]<=d)return[b[0],b[1]*b[2]];if(b.length===4&&b[0]*b[1]*b[2]<=d&&b[3]<=d)return[b[0]*b[1]*b[2],b[3]];if(b.length===4&&b[0]<=d&&b[1]*b[2]*b[3]<=d)return[b[0],b[1]*b[2]*b[3]];if(h){var H=Is(b),Z=2,ce=2;return b.length&&(Z=(u=Ba(b))[0],ce=u[1]),Vt(T=H*(Z/2)*(ce/2)).map(function(ye){return 2*ye})}return Vt(T)}function Xc(b){return b%2==0}function eu(b,h){if(fn(b=b.slice(-2),h=h.slice(-2))||!b.length||!h.length||b[0]===0||b[1]===0||h[0]===0||h[1]===0)return!0;if(b.length!==h.length){var u=b.slice(-1)[0],d=h.slice(-1)[0];if(u===d||Xc(u)&&Xc(d)&&(b[0]===1||h[0]===1))return!0}return b[1]===h[1]&&Xc(b[0])&&Xc(h[0])}function ps(b){if(ds==null){var h=Bi(b);ds=h.getParameter(h.MAX_TEXTURE_SIZE)}return ds}function ef(b){if(As==null){var h=Bi(b);As=h.getParameter(h.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,As)}function Yc(b){if(b===0)return 0;var h=Bi(b);return na(h,"EXT_disjoint_timer_query_webgl2")&&b===2?2:na(h,"EXT_disjoint_timer_query")?1:0}function na(b,h){return b.getExtension(h)!=null}function Xf(b){try{if(Bi(b)!=null)return!0}catch{return!1}return!1}function Jc(b){if(b===0)return!1;var h=Bi(b);if(b===1){if(!na(h,"OES_texture_float"))return!1}else if(!na(h,"EXT_color_buffer_float"))return!1;return da(h)}function Of(b){if(b===0)return!1;var h=Bi(b);return b!==1?na(h,"EXT_color_buffer_float")?da(h):!!na(h,"EXT_color_buffer_half_float")&&function(u,d){var x=ai(u,d),T=u.createTexture();u.bindTexture(u.TEXTURE_2D,T),u.texImage2D(u.TEXTURE_2D,0,x.internalFormatHalfFloat,1,1,0,x.textureFormatFloat,x.textureTypeHalfFloat,null);var H=u.createFramebuffer();u.bindFramebuffer(u.FRAMEBUFFER,H),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,T,0);var Z=u.checkFramebufferStatus(u.FRAMEBUFFER)===u.FRAMEBUFFER_COMPLETE;return u.bindTexture(u.TEXTURE_2D,null),u.bindFramebuffer(u.FRAMEBUFFER,null),u.deleteTexture(T),u.deleteFramebuffer(H),Z}(h,h.getExtension("EXT_color_buffer_half_float")):!!na(h,"OES_texture_float")&&!!na(h,"WEBGL_color_buffer_float")&&da(h)}function da(b){var h=ai(b),u=b.createTexture();b.bindTexture(b.TEXTURE_2D,u),b.texImage2D(b.TEXTURE_2D,0,h.internalFormatFloat,1,1,0,h.textureFormatFloat,h.textureTypeFloat,null);var d=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,d),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,u,0);var x=b.checkFramebufferStatus(b.FRAMEBUFFER)===b.FRAMEBUFFER_COMPLETE;return b.bindTexture(b.TEXTURE_2D,null),b.bindFramebuffer(b.FRAMEBUFFER,null),b.deleteTexture(u),b.deleteFramebuffer(d),x}function Qi(b){return b===2&&Bi(b).fenceSync!=null}var xi=Object.freeze({callAndCheck:qn,canBeRepresented:Zr,getWebGLErrorMessage:Wo,getExtensionOrThrow:Oo,createVertexShader:So,createFragmentShader:To,createProgram:eo,linkProgram:bu,validateProgram:wc,createStaticVertexBuffer:kc,createStaticIndexBuffer:_c,getNumChannels:function(){return W().getNumber("WEBGL_VERSION")===2?1:4},createTexture:ws,validateTextureSize:Ql,createFramebuffer:Hs,bindVertexBufferToProgramAttribute:Mc,bindTextureUnit:Af,unbindTextureUnit:function(b,h,u){Kc(b,u),qn(b,h,function(){return b.activeTexture(b.TEXTURE0+u)}),qn(b,h,function(){return b.bindTexture(b.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:Gs,getProgramUniformLocation:Zl,bindTextureToProgramUniformSampler:pl,bindCanvasToFramebuffer:function(b,h){qn(b,h,function(){return b.bindFramebuffer(b.FRAMEBUFFER,null)}),qn(b,h,function(){return b.viewport(0,0,b.canvas.width,b.canvas.height)}),qn(b,h,function(){return b.scissor(0,0,b.canvas.width,b.canvas.height)})},bindColorTextureToFramebuffer:ml,unbindColorTextureFromFramebuffer:Gc,validateFramebuffer:ha,getFramebufferErrorMessage:$c,getBatchDim:Is,getRowsCols:Ba,getShapeAs3D:jc,getTextureShapeFromLogicalShape:ac,isReshapeFree:eu,getWebGLMaxTextureSize:ps,resetMaxTextureSize:function(){ds=null},resetMaxTexturesInShader:function(){As=null},getMaxTexturesInShader:ef,getWebGLDisjointQueryTimerVersion:Yc,hasExtension:na,isWebGLVersionEnabled:Xf,isCapableOfRenderingToFloatTexture:Jc,isDownloadFloatTextureEnabled:Of,isWebGLFenceEnabled:Qi}),hr=W();function is(){W().set("PROD",!0)}function Nh(){W().set("DEBUG",!0)}function No(){W().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Qc(b){W().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(b+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Yf(){He.disposeVariables()}function zp(){return He}function tu(){return He.memory()}function Ih(b){return He.profile(b)}function so(b,h){return He.tidy(b,h)}function Oa(b){Gn(b).forEach(function(h){return h.dispose()})}function Fh(b){return He.keep(b)}function Zc(b){return He.time(b)}function Rh(b){return He.setBackend(b)}function Xd(){return He.ready()}function Tu(){return He.backendName}function Tl(b){He.removeBackend(b)}function Yd(b){return He.findBackend(b)}function Up(b){return He.findBackendFactory(b)}function Ec(b,h,u){return u===void 0&&(u=1),He.registerBackend(b,h,u)}function Sg(){return He.backend}function el(b,h){W().setPlatform(b,h)}function Jf(){for(var b=[],h=0;h<arguments.length;h++)b[h]=arguments[h];W().getBool("IS_TEST")||console.warn.apply(console,b)}function $s(b,h){var u=b;if(yt(b))return h==="string"?[]:[b.length];if(!Array.isArray(b))return[];for(var d=[];Array.isArray(u)||yt(u)&&h!=="string";)d.push(u.length),u=u[0];return Array.isArray(b)&&W().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function x(T,H,Z){if(Z=Z||[],Array.isArray(T)||yt(T)){Ce(H.length>0,function(){return"Element arr["+Z.join("][")+"] should be a primitive, but is an array of "+T.length+" elements"}),Ce(T.length===H[0],function(){return"Element arr["+Z.join("][")+"] should have "+H[0]+" elements, but has "+T.length+" elements"});for(var ce=H.slice(1),ye=0;ye<T.length;++ye)x(T[ye],ce,Z.concat(ye))}else Ce(H.length===0,function(){return"Element arr["+Z.join("][")+"] is a primitive, but should be an array/TypedArray of "+H[0]+" elements"})}(b,d,[]),d}function gl(b,h,u,d){if(b!=null&&(b!=="numeric"&&b!==h||b==="numeric"&&h==="string"))throw new Error("Argument '"+u+"' passed to '"+d+"' must be "+b+" tensor, but got "+h+" tensor")}function Ze(b,h,u,d){if(d===void 0&&(d="numeric"),b instanceof $t)return gl(d,b.dtype,h,u),b;var x=we(b);if(x!=="string"&&["bool","int32","float32"].indexOf(d)>=0&&(x=d),gl(d,x,h,u),b==null||!yt(b)&&!Array.isArray(b)&&typeof b!="number"&&typeof b!="boolean"&&typeof b!="string"){var T=b==null?"null":b.constructor.name;throw new Error("Argument '"+h+"' passed to '"+u+"' must be a Tensor or TensorLike, but got '"+T+"'")}var H=$s(b,x);yt(b)||Array.isArray(b)||(b=[b]);var Z=x!=="string"?qr(b,x,W().getBool("DEBUG")):Ut(b,[],!0);return He.makeTensor(Z,H,x)}function tl(b,h,u,d){if(d===void 0&&(d="numeric"),!Array.isArray(b))throw new Error("Argument "+h+" passed to "+u+" must be a `Tensor[]` or `TensorLike[]`");return b.map(function(x,T){return Ze(x,h+"["+T+"]",u)},d)}function es(b,h){for(var u=0;u<b.length;++u)if(b[b.length-u-1]!==h-1-u)return!1;return!0}function Nl(b,h,u){for(var d=b.length+h.length,x=[],T=0,H=0,Z=0;Z<d;Z++)u.indexOf(Z)===-1?x.push(b[T++]):x.push(h[H++]);return x}function pa(b,h){for(var u=[],d=b.length,x=0;x<d;x++)h.indexOf(x)===-1&&u.push(b[x]);return[u,h.map(function(T){return b[T]})]}function Ea(b,h){return Nl(b,h.map(function(u){return 1}),h)}function La(b,h,u){Ce(es(h,u),function(){return b+" supports only inner-most axes for now. Got axes "+h+" and rank-"+u+" input."})}function Fs(b,h){if(es(b,h))return null;for(var u=[],d=0;d<h;++d)b.indexOf(d)===-1&&u.push(d);return b.forEach(function(x){return u.push(x)}),u}function vl(b){return b.map(function(h,u){return[u,h]}).sort(function(h,u){return h[1]-u[1]}).map(function(h){return h[0]})}function Rs(b,h){for(var u=[],d=h-b;d<h;++d)u.push(d);return u}function tf(b,h){var u=b[0].length;b.forEach(function(x,T){Ce(x.length===u,function(){return"Error in concat"+u+"D: rank of tensors["+T+"] must be the same as the rank of the rest ("+u+")"})}),Ce(h>=0&&h<u,function(){return"Error in concat"+u+"D: axis must be between 0 and "+(u-1)+"."});var d=b[0];b.forEach(function(x,T){for(var H=0;H<u;H++)Ce(H===h||x[H]===d[H],function(){return"Error in concat"+u+"D: Shape of tensors["+T+"] ("+x+") does not match the shape of the rest ("+d+") along the non-concatenated axis "+T+"."})})}function Ku(b,h){for(var u=b[0].slice(),d=1;d<b.length;d++)u[h]+=b[d][h];return u}function Tt(b){var h=Object.keys(b);if(h.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+h.length+" keys.");var u=h[0],d=b[u];u.endsWith("_")&&(u=u.substring(0,u.length-1));var x=function(){for(var T=[],H=0;H<arguments.length;H++)T[H]=arguments[H];He.startScope(u);try{var Z=d.apply(void 0,T);return Z instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),He.endScope(Z),Z}catch(ce){throw He.endScope(null),ce}};return Object.defineProperty(x,"name",{value:u,configurable:!0}),x}hr.registerFlag("HAS_WEBGL",function(){return hr.getNumber("WEBGL_VERSION")>0}),hr.registerFlag("WEBGL_VERSION",function(){return Xf(2)?2:Xf(1)?1:0}),hr.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return hr.get("WEBGL_VERSION")===2}),hr.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),hr.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),hr.registerFlag("WEBGL_PACK",function(){return hr.getBool("HAS_WEBGL")}),hr.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return hr.getBool("WEBGL_PACK")}),hr.registerFlag("WEBGL_PACK_CLIP",function(){return hr.getBool("WEBGL_PACK")}),hr.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),hr.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return hr.getBool("WEBGL_PACK")}),hr.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return hr.getBool("WEBGL_PACK")}),hr.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return hr.getBool("WEBGL_PACK")}),hr.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return hr.getBool("WEBGL_PACK")}),hr.registerFlag("WEBGL_PACK_REDUCE",function(){return hr.getBool("WEBGL_PACK")}),hr.registerFlag("WEBGL_LAZILY_UNPACK",function(){return hr.getBool("WEBGL_PACK")}),hr.registerFlag("WEBGL_CONV_IM2COL",function(){return hr.getBool("WEBGL_PACK")}),hr.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return ps(hr.getNumber("WEBGL_VERSION"))}),hr.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return ef(hr.getNumber("WEBGL_VERSION"))}),hr.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var b=hr.getNumber("WEBGL_VERSION");return b===0?0:Yc(b)}),hr.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return hr.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(b=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4))));var b}),hr.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Jc(hr.getNumber("WEBGL_VERSION"))}),hr.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!hr.getBool("WEBGL_FORCE_F16_TEXTURES")&&hr.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),hr.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return Of(hr.getNumber("WEBGL_VERSION"))}),hr.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return Qi(hr.getNumber("WEBGL_VERSION"))}),hr.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return hr.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),$r=Qc;var aa=Tt({complex_:function(b,h){var u=Ze(b,"real","complex"),d=Ze(h,"imag","complex");return Wt(u.shape,d.shape,"real and imag shapes, "+u.shape+" and "+d.shape+", must match in call to tf.complex()."),He.runKernelFunc(function(x){return x.complex(u,d)},{$real:u,$imag:d})}}),ms=Tt({real_:function(b){var h=Ze(b,"input","real");return He.runKernelFunc(function(u){return u.real(h)},{$input:h})}}),Ks=Tt({imag_:function(b){var h=Ze(b,"input","imag");return He.runKernelFunc(function(u){return u.imag(h)},{$input:h})}});function la(b,h,u){return xu(b,h,$s(b,u),u)}function xu(b,h,u,d){if(d==null&&(d=we(b)),d==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!yt(b)&&!Array.isArray(b)&&typeof b!="number"&&typeof b!="boolean"&&typeof b!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(h!=null){or(h);var x=Qe(h),T=Qe(u);Ce(x===T,function(){return"Based on the provided shape, ["+h+"], the tensor should have "+x+" values but has "+T});for(var H=0;H<u.length;++H){var Z=u[H],ce=H!==u.length-1||Z!==Qe(h.slice(H));Ce(u[H]===h[H]||!ce,function(){return"Error creating a new Tensor. Inferred shape ("+u+") does not match the provided shape ("+h+"). "})}}return yt(b)||Array.isArray(b)||(b=[b]),h=h||u,b=d!=="string"?qr(b,d,W().getBool("DEBUG")):Ut(b,[],!0),He.makeTensor(b,h,d)}function Mr(b,h){if((yt(b)&&h!=="string"||Array.isArray(b))&&h!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(h==="string"&&yt(b)&&!(b instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return xu(b,[],[],h)}function Cc(b,h){en(b);var u=$s(b,h);if(u.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return xu(b,null,u,h)}function sc(b,h,u){if(en(b),h!=null&&h.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var d=$s(b,u);if(d.length!==2&&d.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(d.length===1&&h==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return xu(b,h,d,u)}function nf(b,h,u){if(en(b),h!=null&&h.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var d=$s(b,u);if(d.length!==3&&d.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(d.length===1&&h==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return xu(b,h,d,u)}function Ac(b,h,u){if(en(b),h!=null&&h.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var d=$s(b,u);if(d.length!==4&&d.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(d.length===1&&h==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return xu(b,h,d,u)}function yd(b,h,u){if(en(b),h!=null&&h.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var d=$s(b,u);if(d.length!==5&&d.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(d.length===1&&h==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return xu(b,h,d,u)}function uc(b,h,u){if(en(b),h!=null&&h.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var d=$s(b,u);if(d.length!==6&&d.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(d.length===1&&h==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return xu(b,h=h||d,d,u)}function bd(b,h,u,d){return h===void 0&&(h=!0),He.makeVariable(b,h,u,d)}function Xu(b,h){if(h===void 0&&(h="float32"),h==="complex64"){var u=Xu(b,"float32"),d=Io(b,"float32");return aa(u,d)}var x=hn(Qe(b),h);return He.makeTensor(x,b,h)}function Io(b,h){if(h===void 0&&(h="float32"),h==="complex64"){var u=Io(b,"float32"),d=Io(b,"float32");return aa(u,d)}var x=nn(Qe(b),h);return He.makeTensor(x,b,h)}function Nu(b,h,u){return He.runKernelFunc(function(d){return d.fill(b,h,u)},{})}function Jd(b,h,u){if(u<=0)throw new Error("The number of values should be positive.");return He.runKernelFunc(function(d){return d.linspace(b,h,u)},{})}function rf(b,h,u,d){if(u===void 0&&(u=1),d===void 0&&(d="float32"),u===0)throw new Error("Cannot have a step of zero");if(b===h||b<h&&u<0||h<b&&u>1)return Io([0],d);var x=nn(Math.abs(Math.ceil((h-b)/u)),d);h<b&&u===1&&(u=-1),x[0]=b;for(var T=1;T<x.length;T++)x[T]=x[T-1]+u;return Cc(x,d)}var Iu=Tt({onesLike_:function(b){var h=Ze(b,"x","onesLike");if(h.dtype==="complex64"){var u=Iu(ms(h)),d=Ri(Ks(h));return aa(u,d)}return He.runKernelFunc(function(x){return x.onesLike(h)},{$x:h},function(x,T){return{$x:function(){return Ri(x)}}})}}),Ri=Tt({zerosLike_:function(b){var h=Ze(b,"x","zerosLike");return He.runKernelFunc(function(u){return u.zerosLike(h)},{$x:h},function(u,d){return{$x:function(){return Ri(u)}}})}}),$a=Tt({concat_:function(b,h){h===void 0&&(h=0),Ce(b.length>=1,function(){return"Pass at least one tensor to concat"});var u=tl(b,"tensors","concat");u[0].dtype==="complex64"&&u.forEach(function(Z){if(Z.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+Z.dtype+". ")}),h=Tn(h,u[0].shape)[0];var d=Ku(u.map(function(Z){return Z.shape}),h);if(Qe(d)===0)return la([],d);if((u=u.filter(function(Z){return Z.size>0})).length===1)return u[0];var x=u.map(function(Z){return Z.shape});tf(x,h);var T=u,H={axis:h};return He.runKernelFunc(function(Z){return Z.concat(u,h)},T,function(Z){var ce=x.map(function(ye){return ye[h]});return _o(Z,ce,h).map(function(ye){return function(){return ye}})},"Concat",H)}}),of=Tt({concat1d_:function(b){return $a(b,0)}}),Wp=Tt({concat2d_:function(b,h){return $a(b,h)}}),Mh=Tt({concat3d_:function(b,h){return $a(b,h)}}),jh=Tt({concat4d_:function(b,h){return $a(b,h)}}),_o=Tt({split_:function(b,h,u){u===void 0&&(u=0);var d,x=Ze(b,"x","split");return u=Tn(u,x.shape)[0],typeof h=="number"?(Ce(x.shape[u]%h==0,function(){return"Number of splits must evenly divide the axis."}),d=new Array(h).fill(x.shape[u]/h)):(Ce(x.shape[u]===h.reduce(function(T,H){return T+H}),function(){return"The sum of sizes must match the size of the axis dimension."}),d=h),He.runKernelFunc(function(T){return T.split(x,d,u)},{$x:x},function(T){return{$x:function(){return $a(T,u)}}})}});function Ki(b,h){return b(h={exports:{}},h.exports),h.exports}var Ka=Ki(function(b){(function(h,u,d){function x(H,Z){return Z.c=H.c,Z.s0=H.s0,Z.s1=H.s1,Z.s2=H.s2,Z}function T(H,Z){var ce=new function(je){var Pe,ze=this,Ge=(Pe=4022871197,function(rt){rt=rt.toString();for(var it=0;it<rt.length;it++){var ht=.02519603282416938*(Pe+=rt.charCodeAt(it));ht-=Pe=ht>>>0,Pe=(ht*=Pe)>>>0,Pe+=4294967296*(ht-=Pe)}return 23283064365386963e-26*(Pe>>>0)});ze.next=function(){var rt=2091639*ze.s0+23283064365386963e-26*ze.c;return ze.s0=ze.s1,ze.s1=ze.s2,ze.s2=rt-(ze.c=0|rt)},ze.c=1,ze.s0=Ge(" "),ze.s1=Ge(" "),ze.s2=Ge(" "),ze.s0-=Ge(je),ze.s0<0&&(ze.s0+=1),ze.s1-=Ge(je),ze.s1<0&&(ze.s1+=1),ze.s2-=Ge(je),ze.s2<0&&(ze.s2+=1),Ge=null}(H),ye=Z&&Z.state,Ee=ce.next;return Ee.int32=function(){return 4294967296*ce.next()|0},Ee.double=function(){return Ee()+11102230246251565e-32*(2097152*Ee()|0)},Ee.quick=Ee,ye&&(typeof ye=="object"&&x(ye,ce),Ee.state=function(){return x(ce,{})}),Ee}u&&u.exports?u.exports=T:this.alea=T})(0,b)}),Vp=Ki(function(b){(function(h,u,d){function x(H,Z){return Z.x=H.x,Z.y=H.y,Z.z=H.z,Z.w=H.w,Z}function T(H,Z){var ce=new function(je){var Pe=this,ze="";Pe.x=0,Pe.y=0,Pe.z=0,Pe.w=0,Pe.next=function(){var rt=Pe.x^Pe.x<<11;return Pe.x=Pe.y,Pe.y=Pe.z,Pe.z=Pe.w,Pe.w^=Pe.w>>>19^rt^rt>>>8},je===(0|je)?Pe.x=je:ze+=je;for(var Ge=0;Ge<ze.length+64;Ge++)Pe.x^=0|ze.charCodeAt(Ge),Pe.next()}(H),ye=Z&&Z.state,Ee=function(){return(ce.next()>>>0)/4294967296};return Ee.double=function(){do var je=((ce.next()>>>11)+(ce.next()>>>0)/4294967296)/2097152;while(je===0);return je},Ee.int32=ce.next,Ee.quick=Ee,ye&&(typeof ye=="object"&&x(ye,ce),Ee.state=function(){return x(ce,{})}),Ee}u&&u.exports?u.exports=T:this.xor128=T})(0,b)}),qp=Ki(function(b){(function(h,u,d){function x(H,Z){return Z.x=H.x,Z.y=H.y,Z.z=H.z,Z.w=H.w,Z.v=H.v,Z.d=H.d,Z}function T(H,Z){var ce=new function(je){var Pe=this,ze="";Pe.next=function(){var rt=Pe.x^Pe.x>>>2;return Pe.x=Pe.y,Pe.y=Pe.z,Pe.z=Pe.w,Pe.w=Pe.v,(Pe.d=Pe.d+362437|0)+(Pe.v=Pe.v^Pe.v<<4^rt^rt<<1)|0},Pe.x=0,Pe.y=0,Pe.z=0,Pe.w=0,Pe.v=0,je===(0|je)?Pe.x=je:ze+=je;for(var Ge=0;Ge<ze.length+64;Ge++)Pe.x^=0|ze.charCodeAt(Ge),Ge==ze.length&&(Pe.d=Pe.x<<10^Pe.x>>>4),Pe.next()}(H),ye=Z&&Z.state,Ee=function(){return(ce.next()>>>0)/4294967296};return Ee.double=function(){do var je=((ce.next()>>>11)+(ce.next()>>>0)/4294967296)/2097152;while(je===0);return je},Ee.int32=ce.next,Ee.quick=Ee,ye&&(typeof ye=="object"&&x(ye,ce),Ee.state=function(){return x(ce,{})}),Ee}u&&u.exports?u.exports=T:this.xorwow=T})(0,b)}),Hp=Ki(function(b){(function(h,u,d){function x(H,Z){return Z.x=H.x.slice(),Z.i=H.i,Z}function T(H,Z){H==null&&(H=+new Date);var ce=new function(je){var Pe=this;Pe.next=function(){var ze,Ge,rt=Pe.x,it=Pe.i;return ze=rt[it],Ge=(ze^=ze>>>7)^ze<<24,Ge^=(ze=rt[it+1&7])^ze>>>10,Ge^=(ze=rt[it+3&7])^ze>>>3,Ge^=(ze=rt[it+4&7])^ze<<7,ze=rt[it+7&7],Ge^=(ze^=ze<<13)^ze<<9,rt[it]=Ge,Pe.i=it+1&7,Ge},function(ze,Ge){var rt,it=[];if(Ge===(0|Ge))it[0]=Ge;else for(Ge=""+Ge,rt=0;rt<Ge.length;++rt)it[7&rt]=it[7&rt]<<15^Ge.charCodeAt(rt)+it[rt+1&7]<<13;for(;it.length<8;)it.push(0);for(rt=0;rt<8&&it[rt]===0;++rt);for(rt==8?it[7]=-1:it[rt],ze.x=it,ze.i=0,rt=256;rt>0;--rt)ze.next()}(Pe,je)}(H),ye=Z&&Z.state,Ee=function(){return(ce.next()>>>0)/4294967296};return Ee.double=function(){do var je=((ce.next()>>>11)+(ce.next()>>>0)/4294967296)/2097152;while(je===0);return je},Ee.int32=ce.next,Ee.quick=Ee,ye&&(ye.x&&x(ye,ce),Ee.state=function(){return x(ce,{})}),Ee}u&&u.exports?u.exports=T:this.xorshift7=T})(0,b)}),Qf=Ki(function(b){(function(h,u,d){function x(H,Z){return Z.i=H.i,Z.w=H.w,Z.X=H.X.slice(),Z}function T(H,Z){H==null&&(H=+new Date);var ce=new function(je){var Pe=this;Pe.next=function(){var ze,Ge,rt=Pe.w,it=Pe.X,ht=Pe.i;return Pe.w=rt=rt+1640531527|0,Ge=it[ht+34&127],ze=it[ht=ht+1&127],Ge^=Ge<<13,ze^=ze<<17,Ge^=Ge>>>15,ze^=ze>>>12,Ge=it[ht]=Ge^ze,Pe.i=ht,Ge+(rt^rt>>>16)|0},function(ze,Ge){var rt,it,ht,Et,At,St=[],Gt=128;for(Ge===(0|Ge)?(it=Ge,Ge=null):(Ge+="\0",it=0,Gt=Math.max(Gt,Ge.length)),ht=0,Et=-32;Et<Gt;++Et)Ge&&(it^=Ge.charCodeAt((Et+32)%Ge.length)),Et===0&&(At=it),it^=it<<10,it^=it>>>15,it^=it<<4,it^=it>>>13,Et>=0&&(At=At+1640531527|0,ht=(rt=St[127&Et]^=it+At)==0?ht+1:0);for(ht>=128&&(St[127&(Ge&&Ge.length||0)]=-1),ht=127,Et=512;Et>0;--Et)it=St[ht+34&127],rt=St[ht=ht+1&127],it^=it<<13,rt^=rt<<17,it^=it>>>15,rt^=rt>>>12,St[ht]=it^rt;ze.w=At,ze.X=St,ze.i=ht}(Pe,je)}(H),ye=Z&&Z.state,Ee=function(){return(ce.next()>>>0)/4294967296};return Ee.double=function(){do var je=((ce.next()>>>11)+(ce.next()>>>0)/4294967296)/2097152;while(je===0);return je},Ee.int32=ce.next,Ee.quick=Ee,ye&&(ye.X&&x(ye,ce),Ee.state=function(){return x(ce,{})}),Ee}u&&u.exports?u.exports=T:this.xor4096=T})(0,b)}),nu=Ki(function(b){(function(h,u,d){function x(H,Z){return Z.a=H.a,Z.b=H.b,Z.c=H.c,Z.d=H.d,Z}function T(H,Z){var ce=new function(je){var Pe=this,ze="";Pe.next=function(){var rt=Pe.b,it=Pe.c,ht=Pe.d,Et=Pe.a;return rt=rt<<25^rt>>>7^it,it=it-ht|0,ht=ht<<24^ht>>>8^Et,Et=Et-rt|0,Pe.b=rt=rt<<20^rt>>>12^it,Pe.c=it=it-ht|0,Pe.d=ht<<16^it>>>16^Et,Pe.a=Et-rt|0},Pe.a=0,Pe.b=0,Pe.c=-1640531527,Pe.d=1367130551,je===Math.floor(je)?(Pe.a=je/4294967296|0,Pe.b=0|je):ze+=je;for(var Ge=0;Ge<ze.length+20;Ge++)Pe.b^=0|ze.charCodeAt(Ge),Pe.next()}(H),ye=Z&&Z.state,Ee=function(){return(ce.next()>>>0)/4294967296};return Ee.double=function(){do var je=((ce.next()>>>11)+(ce.next()>>>0)/4294967296)/2097152;while(je===0);return je},Ee.int32=ce.next,Ee.quick=Ee,ye&&(typeof ye=="object"&&x(ye,ce),Ee.state=function(){return x(ce,{})}),Ee}u&&u.exports?u.exports=T:this.tychei=T})(0,b)}),Fu=Ki(function(b){(function(h,u){var d,x=this,T=256,H=6,Z="random",ce=u.pow(T,H),ye=u.pow(2,52),Ee=2*ye,je=T-1;function Pe(ht,Et,At){var St=[],Gt=rt(function cn(kn,On){var p,c=[],a=typeof kn;if(On&&a=="object")for(p in kn)try{c.push(cn(kn[p],On-1))}catch{}return c.length?c:a=="string"?kn:kn+"\0"}((Et=Et==1?{entropy:!0}:Et||{}).entropy?[ht,it(h)]:ht==null?function(){try{var cn;return d&&(cn=d.randomBytes)?cn=cn(T):(cn=new Uint8Array(T),(x.crypto||x.msCrypto).getRandomValues(cn)),it(cn)}catch{var kn=x.navigator,On=kn&&kn.plugins;return[+new Date,x,On,x.screen,it(h)]}}():ht,3),St),un=new ze(St),vn=function(){for(var cn=un.g(H),kn=ce,On=0;cn<ye;)cn=(cn+On)*T,kn*=T,On=un.g(1);for(;cn>=Ee;)cn/=2,kn/=2,On>>>=1;return(cn+On)/kn};return vn.int32=function(){return 0|un.g(4)},vn.quick=function(){return un.g(4)/4294967296},vn.double=vn,rt(it(un.S),h),(Et.pass||At||function(cn,kn,On,p){return p&&(p.S&&Ge(p,un),cn.state=function(){return Ge(un,{})}),On?(u[Z]=cn,kn):cn})(vn,Gt,"global"in Et?Et.global:this==u,Et.state)}function ze(ht){var Et,At=ht.length,St=this,Gt=0,un=St.i=St.j=0,vn=St.S=[];for(At||(ht=[At++]);Gt<T;)vn[Gt]=Gt++;for(Gt=0;Gt<T;Gt++)vn[Gt]=vn[un=je&un+ht[Gt%At]+(Et=vn[Gt])],vn[un]=Et;(St.g=function(cn){for(var kn,On=0,p=St.i,c=St.j,a=St.S;cn--;)kn=a[p=je&p+1],On=On*T+a[je&(a[p]=a[c=je&c+kn])+(a[c]=kn)];return St.i=p,St.j=c,On})(T)}function Ge(ht,Et){return Et.i=ht.i,Et.j=ht.j,Et.S=ht.S.slice(),Et}function rt(ht,Et){for(var At,St=ht+"",Gt=0;Gt<St.length;)Et[je&Gt]=je&(At^=19*Et[je&Gt])+St.charCodeAt(Gt++);return it(Et)}function it(ht){return String.fromCharCode.apply(0,ht)}if(u["seed"+Z]=Pe,rt(u.random(),h),b.exports){b.exports=Pe;try{d=o(251)}catch{}}})([],Math)});Fu.alea=Ka,Fu.xor128=Vp,Fu.xorwow=qp,Fu.xorshift7=Hp,Fu.xor4096=Qf,Fu.tychei=nu;var Zf=Fu.alea,cc=function(){function b(h,u,d,x,T){this.mean=h,this.stdDev=u,this.dtype=d,this.nextVal=NaN,this.truncated=x,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var H=T||Math.random();this.random=Zf(H.toString())}return b.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var h=this.nextVal;return this.nextVal=NaN,h}for(var u,d,x=!1;!x;){var T=void 0,H=void 0,Z=void 0;do Z=(T=2*this.random()-1)*T+(H=2*this.random()-1)*H;while(Z>=1||Z===0);var ce=Math.sqrt(-2*Math.log(Z)/Z);u=this.mean+this.stdDev*T*ce,d=this.mean+this.stdDev*H*ce,this.truncated&&!this.isValidTruncated(u)||(x=!0)}return this.truncated&&!this.isValidTruncated(d)||(this.nextVal=this.convertValue(d)),this.convertValue(u)},b.prototype.convertValue=function(h){return this.dtype==null||this.dtype==="float32"?h:Math.round(h)},b.prototype.isValidTruncated=function(h){return h<=this.upper&&h>=this.lower},b}(),Bc=function(){function b(h,u,d,x){this.alpha=h,this.beta=1/u,this.dtype=d;var T=x||Math.random();this.randu=Zf(T.toString()),this.randn=new cc(0,1,d,!1,this.randu()),this.d=h<1?h+2/3:h-1/3,this.c=1/Math.sqrt(9*this.d)}return b.prototype.nextValue=function(){for(var h,u,d,x,T,H;;){do x=this.randn.nextValue(),H=1+this.c*x;while(H<=0);if(H*=H*H,u=1-.331*(h=x*x)*h,d=.5*h+this.d*(1-H+Math.log(H)),(T=this.randu())<u||Math.log(T)<d)break}return H=1/this.beta*this.d*H,this.alpha<1&&(H*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(H)},b.prototype.convertValue=function(h){return this.dtype==="float32"?h:Math.round(h)},b}(),Qd=function(){function b(h,u,d,x){var T=this;if(h===void 0&&(h=0),u===void 0&&(u=1),this.canReturnFloat=function(){return T.dtype==null||T.dtype==="float32"},this.min=h,this.range=u-h,this.dtype=d,x==null&&(x=Math.random()),typeof x=="number"&&(x=x.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+h+" - "+u+" <= 1 and dtype is not float");this.random=Zf(x)}return b.prototype.convertValue=function(h){return this.canReturnFloat()?h:Math.round(h)},b.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},b}();function wo(b,h,u){return h===void 0&&(h="float32"),h=h||"float32",or(b),new Gi(b,h,u)}function Il(b,h){h===void 0&&(h=!1),console.log(b.toString(h))}var cr=Tt({batchToSpaceND_:function(b,h,u){var d=Ze(b,"x","batchToSpaceND"),x=h.reduce(function(T,H){return T*H});return Ce(d.rank>=1+h.length,function(){return"input rank is "+d.rank+" but should be > than blockShape.length "+h.length}),Ce(u.length===h.length,function(){return"crops.length is "+u.length+" but should be equal to blockShape.length  "+h.length}),Ce(d.shape[0]%x==0,function(){return"input tensor batch is "+d.shape[0]+" but is not divisible by the product of the elements of blockShape "+h.join(" * ")+" === "+x}),He.runKernelFunc(function(T){return T.batchToSpaceND(d,h,u)},{$x:d},function(T){return{$x:function(){return T.spaceToBatchND(h,u)}}})}}),jr=Tt({broadcastTo_:function(b,h){var u=Ze(b,"broadcastTo","x"),d=u.shape;if(h.some(function(ce){return!(ce>0)||ce%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+h+"].");if(h.length<u.rank)throw new Error("broadcastTo(): shape.length="+h.length+" < input.rank="+u.rank+".");if(h.length>u.rank){for(var x=u.shape.slice();x.length<h.length;)x.unshift(1);u=u.reshape(x)}for(var T=Array.from(h),H=h.length-1;H>=0;H--)if(u.shape[H]===h[H])T[H]=1;else if(u.shape[H]!==1)throw new Error("broadcastTo(): ["+d+"] cannot be broadcast to ["+h+"].");var Z=T.map(function(ce,ye){return ce>1?ye:-1}).filter(function(ce){return ce>=0});return Z.length===0?u.clone():He.runKernelFunc(function(ce){return ce.tile(u,T)},{input:u},function(ce){return{input:function(){return ce.sum(Z,!0)}}})}}),Or=Tt({cast_:function(b,h){var u=Ze(b,"x","cast");if(!et(h))throw new Error("Failed to cast to unknown dtype "+h);if(h==="string"&&u.dtype!=="string"||h!=="string"&&u.dtype==="string")throw new Error("Only strings can be casted to strings");var d={dtype:h};return He.runKernelFunc(function(x){return x.cast(u,h)},{x:u},function(x){return{x:function(){return x.clone()}}},"Cast",d)}}),Mi=Tt({clone_:function(b){var h=Ze(b,"x","clone",null);return He.runKernelFunc(function(){return He.makeTensorFromDataId(h.dataId,h.shape,h.dtype)},{$x:h},function(u){return{$x:function(){return u.toFloat()}}})}}),go=Tt({cumsum_:function(b,h,u,d){h===void 0&&(h=0),u===void 0&&(u=!1),d===void 0&&(d=!1);var x=Ze(b,"x","cumsum"),T=Fs([h|=0],x.rank),H=x;T!=null&&(H=x.transpose(T));var Z=Rs(1,x.rank)[0],ce=He.runKernelFunc(function(ye){return ye.cumsum(H,Z,u,d)},{permutedX:H},function(ye){return{permutedX:function(){return ye.cumsum(h,u,!d)}}});return T!=null&&(ce=ce.transpose(T)),ce}}),Ca=Tt({depthToSpace_:function(b,h,u){u===void 0&&(u="NHWC");var d=Ze(b,"x","depthToSpace"),x=u==="NHWC"?d.shape[1]:d.shape[2],T=u==="NHWC"?d.shape[2]:d.shape[3],H=u==="NHWC"?d.shape[3]:d.shape[1];return Ce(x*h>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+x+" and "+h+`  for depthToSpace with input shape
      `+d.shape}),Ce(T*h>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+T+" and "+h+` for depthToSpace with input shape
          `+d.shape}),Ce(H%(h*h)==0,function(){return"Dimension size must be evenly divisible by "+h*h+" but is "+H+" for depthToSpace with input shape "+d.shape}),He.runKernelFunc(function(Z){return Z.depthToSpace(d,h,u)},{$x:d})}}),Eo=Tt({expandDims_:function(b,h){h===void 0&&(h=0);var u=Ze(b,"x","expandDims",null);Ce(h<=u.rank,function(){return"Axis must be <= rank of the tensor"});var d=u.shape.slice();return h<0&&(Ce(-(u.rank+1)<=h,function(){return"Axis must be in the interval ["+-(u.rank+1)+", "+u.rank+"]"}),h=u.rank+h+1),d.splice(h,0,1),Ua(u,d)}}),za=Tt({eye_:function(b,h,u,d){d===void 0&&(d="float32"),h==null&&(h=b);for(var x=wo([b,h],d),T=b<=h?b:h,H=0;H<T;++H)x.set(1,H,H);var Z=x.toTensor().as2D(b,h);if(u==null)return Z;if(u.length===1)return cu(Eo(Z,0),[u[0],1,1]);if(u.length===2)return cu(Eo(Eo(Z,0),0),[u[0],u[1],1,1]);if(u.length===3)return cu(Eo(Eo(Eo(Z,0),0),0),[u[0],u[1],u[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+u.length+"D.")}}),Sf=Tt({multinomial_:function(b,h,u,d){d===void 0&&(d=!1);var x=Ze(b,"logits","multinomial"),T=x.size,H=x.rank;if(T<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+T+".");if(H>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+H);u=u||Math.random();var Z=H===1?x.as2D(1,-1):x,ce=He.runKernelFunc(function(ye){return ye.multinomial(Z,d,h,u)},{logits2D:Z});return H===1?ce.as1D():ce}}),Zd=Tt({oneHot_:function(b,h,u,d){if(u===void 0&&(u=1),d===void 0&&(d=0),h<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+h);var x=Ze(b,"indices","oneHot","int32"),T=x.shape.concat([h]);return x=x.flatten(),He.runKernelFunc(function(H){return H.oneHot(x,h,u,d)},{$indices:x},function(H){return{$indices:function(){return Io(x.shape,"float32")}}}).reshape(T)}}),Ru=Tt({pad_:function(b,h,u){u===void 0&&(u=0);var d=Ze(b,"x","pad");if(d.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var x={paddings:h,constantValue:u};return He.runKernelFunc(function(T){return T.pad(d,h,u)},{x:d},function(T){var H=h.map(function(Z){return Z[0]});return{x:function(){return T.slice(H,d.shape)}}},"PadV2",x)}}),Fl=Tt({pad1d_:function(b,h,u){return u===void 0&&(u=0),Ce(h.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Ru(b,[h],u)}}),Df=Tt({pad2d_:function(b,h,u){return u===void 0&&(u=0),Ce(h.length===2&&h[0].length===2&&h[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ru(b,h,u)}}),af=Tt({pad3d_:function(b,h,u){return u===void 0&&(u=0),Ce(h.length===3&&h[0].length===2&&h[1].length===2&&h[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ru(b,h,u)}}),Tf=Tt({pad4d_:function(b,h,u){return u===void 0&&(u=0),Ce(h.length===4&&h[0].length===2&&h[1].length===2&&h[2].length===2&&h[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ru(b,h,u)}}),sf=Tt({rand_:function(b,h,u){var d=Qe(b),x=null;if(u==null||u==="float32")x=new Float32Array(d);else if(u==="int32")x=new Int32Array(d);else{if(u!=="bool")throw new Error("Unknown data type "+u);x=new Uint8Array(d)}for(var T=0;T<d;T++)x[T]=h();return He.makeTensor(x,b,u)}}),ma=Tt({randomNormal_:function(b,h,u,d,x){if(h===void 0&&(h=0),u===void 0&&(u=1),d!=null&&d==="bool")throw new Error("Unsupported data type "+d);for(var T=new cc(h,u,d,!1,x),H=wo(b,d),Z=0;Z<H.values.length;Z++)H.values[Z]=T.nextValue();return H.toTensor()}}),Dg=Tt({randomGamma_:function(b,h,u,d,x){if(u===void 0&&(u=1),d===void 0&&(d="float32"),u==null&&(u=1),d==null&&(d="float32"),d!=="float32"&&d!=="int32")throw new Error("Unsupported data type "+d);for(var T=new Bc(h,u,d,x),H=wo(b,d),Z=0;Z<H.values.length;Z++)H.values[Z]=T.nextValue();return H.toTensor()}}),eh=Tt({randomUniform_:function(b,h,u,d,x){h===void 0&&(h=0),u===void 0&&(u=1),d===void 0&&(d="float32");for(var T=wo(b,d),H=new Qd(h,u,null,x),Z=0;Z<T.values.length;Z++)T.values[Z]=H.nextValue();return T.toTensor()}}),Ua=Tt({reshape_:function(b,h){var u=Ze(b,"x","reshape",null);h=Rt(h,u.size),Ce(u.size===Qe(h),function(){return"new shape and old shape must have the same number of elements."});var d={shape:h};return He.runKernelFunc(function(x){return x.reshape(u,h)},{x:u},function(x){return{x:function(){return x.reshape(u.shape)}}},"Reshape",d)}}),Ms=Tt({spaceToBatchND_:function(b,h,u){var d=Ze(b,"x","spaceToBatchND");return Ce(d.rank>=1+h.length,function(){return"input rank "+d.rank+" should be > than [blockShape] "+h.length}),Ce(u.length===h.length,function(){return"paddings.shape[0] "+u.length+" must be equal to [blockShape] "+h.length}),Ce(d.shape.reduce(function(x,T,H){return H>0&&H<=h.length?x&&(T+u[H-1][0]+u[H-1][1])%h[H-1]==0:x},!0),function(){return"input spatial dimensions "+d.shape.slice(1)+" with paddings "+u.toString()+" must be divisible by blockShapes "+h.toString()}),He.runKernelFunc(function(x){return x.spaceToBatchND(d,h,u)},{$x:d},function(x){return{$x:function(){return x.batchToSpaceND(h,u)}}})}}),Xs=Tt({squeeze_:function(b,h){var u=Ze(b,"x","squeeze");return Ua(u,Hn(u.shape,h).newShape)}}),Co=Tt({stack_:function(b,h){h===void 0&&(h=0);var u=tl(b,"tensors","stack");if(Ce(u.length>=1,function(){return"Pass at least one tensor to tf.stack"}),u.length===1)return u[0].expandDims(h);var d=u[0].rank,x=u[0].shape,T=u[0].dtype;Ce(h<=d,function(){return"Axis must be <= rank of the tensor"}),u.forEach(function(Z){Wt(x,Z.shape,"All tensors passed to stack must have matching shapes")}),u.forEach(function(Z){Ce(T===Z.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var H=u.map(function(Z){return Z.expandDims(h)});return $a(H,h)}}),cu=Tt({tile_:function(b,h){var u=Ze(b,"x","tile",null);Ce(u.rank===h.length,function(){return"Error in transpose: rank of input "+u.rank+" must match length of reps "+h+"."});var d=[u],x={reps:h};return He.runKernelFunc(function(T,H){var Z=T.tile(u,h);return H([u]),Z},{x:u},function(T,H){var Z=H[0];return{x:function(){var ce=Ri(Z);if(Z.rank===1)for(var ye=0;ye<h[0];++ye)ce=ce.add(T.slice([ye*Z.shape[0]],[Z.shape[0]]));else if(Z.rank===2)for(ye=0;ye<h[0];++ye)for(var Ee=0;Ee<h[1];++Ee)ce=ce.add(T.slice([ye*Z.shape[0],Ee*Z.shape[1]],[Z.shape[0],Z.shape[1]]));else if(Z.rank===3)for(ye=0;ye<h[0];++ye)for(Ee=0;Ee<h[1];++Ee)for(var je=0;je<h[2];++je)ce=ce.add(T.slice([ye*Z.shape[0],Ee*Z.shape[1],je*Z.shape[2]],[Z.shape[0],Z.shape[1],Z.shape[2]]));else{if(Z.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+Z.rank+" tensors yet.");for(ye=0;ye<h[0];++ye)for(Ee=0;Ee<h[1];++Ee)for(je=0;je<h[2];++je)for(var Pe=0;Pe<h[3];++Pe)ce=ce.add(T.slice([ye*Z.shape[0],Ee*Z.shape[1],je*Z.shape[2],Pe*Z.shape[3]],[Z.shape[0],Z.shape[1],Z.shape[2],Z.shape[3]]))}return ce}}},"Tile",x,d)}}),lc=Tt({truncatedNormal_:function(b,h,u,d,x){if(h===void 0&&(h=0),u===void 0&&(u=1),d!=null&&d==="bool")throw new Error("Unsupported data type "+d);for(var T=new cc(h,u,d,!0,x),H=wo(b,d),Z=0;Z<H.values.length;Z++)H.values[Z]=T.nextValue();return H.toTensor()}}),Es=Tt({unstack_:function(b,h){h===void 0&&(h=0),h=h||0;var u=Ze(b,"x","unstack");Ce(h>=-u.shape.length&&h<u.shape.length,function(){return"Axis = "+h+" is not in [-"+u.shape.length+", "+u.shape.length+")"}),h<0&&(h+=u.shape.length);var d={axis:h};return He.runKernelFunc(function(x){return x.unstack(u,h)},{x:u},function(x){return{x:function(){return Co(x,h)}}},"Unpack",d)}}),uf=function(b,h){return M(this,void 0,void 0,function(){var u,d,x,T,H,Z,ce,ye,Ee,je;return V(this,function(Pe){switch(Pe.label){case 0:return u=Ze(b,"x","setdiff1d"),d=Ze(h,"y","setdiff1d"),Ce(u.dtype===d.dtype,function(){return"x and y should have the same dtype, but got x ("+u.dtype+") and y ("+d.dtype+")."}),Ce(u.rank===1,function(){return"x should be 1D tensor, but got x ("+u.shape+")."}),Ce(d.rank===1,function(){return"y should be 1D tensor, but got y ("+d.shape+")."}),[4,u.data()];case 1:return x=Pe.sent(),[4,d.data()];case 2:for(T=Pe.sent(),H=new Set(T),Z=0,Ee=0;Ee<x.length;Ee++)H.has(x[Ee])||Z++;for(ce=new Gi([Z],u.dtype),ye=new Gi([Z],"int32"),Ee=0,je=0;Ee<x.length;Ee++)H.has(x[Ee])||(ce.values[je]=x[Ee],ye.values[je]=Ee,je++);return[2,[ce.toTensor(),ye.toTensor()]]}})})};function Pc(b,h,u,d){d===void 0&&(d=!0);var x=[];if(d)(x=x.concat(h.slice(0))).push(b[0]/u),x=x.concat(b.slice(1));else{x=x.concat(b[0]);for(var T=h.length,H=0;H<T;++H)x=x.concat([b[H+1]/h[H],h[H]]);x=x.concat(b.slice(T+1))}return x}function Bh(b,h,u){u===void 0&&(u=!0);var d=[];if(u){d.push(h);for(var x=h+1;x<b;++x)x<=2*h?(d.push(x),d.push(x-(h+1))):d.push(x)}else{var T=[],H=[];for(x=1;x<b;++x)x>=2*h+1||x%2==1?H.push(x):T.push(x);d.push.apply(d,T),d.push(0),d.push.apply(d,H)}return d}function Ph(b,h,u,d){d===void 0&&(d=!0);var x=[];d?x.push(b[0]/u):x.push(b[0]*u);for(var T=1;T<b.length;++T)T<=h.length?d?x.push(h[T-1]*b[T]):x.push(b[T]/h[T-1]):x.push(b[T]);return x}function Rl(b,h){for(var u=[0],d=0;d<h;++d)u.push(b[d][0]);return u}function ep(b,h,u){for(var d=b.slice(0,1),x=0;x<u;++x)d.push(b[x+1]-h[x][0]-h[x][1]);return d}function Oc(b,h){if(b.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+b.rank+".");if(h.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+h.rank+".");if(h.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+h.dtype+".");if(h.shape[h.rank-1]>b.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+h.shape[h.rank-1]+" vs. "+b.rank);if(b.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+b.shape+".");for(var u=h.shape,d=u[u.length-1],x=1,T=0;T<u.length-1;++T)x*=u[T];var H=b.shape,Z=u.slice();Z.pop();var ce=1;for(T=d;T<b.rank;++T)ce*=H[T],Z.push(H[T]);var ye=Tr(b.shape).map(function(Ee){return Ee/ce}).concat([1]).slice(0,d);return[Z,x,ce,ye]}var th=Object.freeze({prepareAndValidate:Oc}),Lh=30;function zh(b){return b<=Lh?b:Rr(b,Math.floor(Math.sqrt(b)))}function jm(b,h,u){var d=h.rank>1?h.shape[h.rank-1]:1,x=h.rank>1?h.rank-1:1,T="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+u.shape+", indices.shape: "+h.shape+", shape: "+b+", sliceDim: "+d+", and batchDim: "+x+".";if(u.rank<x)throw new Error(T+" update.rank < "+x+". ");if(b.length<d+(u.rank-x))throw new Error(T+" Output shape length < "+(d+(u.rank-x)));if(u.rank!==x+b.length-d)throw new Error(T+" update.rank != "+(x+b.length-d));for(var H=0;H<x;++H)if(u.shape[H]!==h.shape[H])throw new Error(T+" updates.shape["+H+"] ("+u.shape[H]+") != indices.shape["+H+"] ("+h.shape[H]+").");for(H=0;H<u.rank-x;++H)if(u.shape[H+x]!==b[H+d])throw new Error(T+" updates.shape["+(H+x)+"] ("+u.shape[H+x]+") != shape["+(H+x)+"] ("+b[H+x]+")")}function xd(b,h,u){if(h.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+h.rank+".");if(b.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+b.rank+".");if(h.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+h.dtype);if(u.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+u);if(u.length===0){if(h.size===0)throw new Error("Indices specified for empty output. indices shape: "+h.shape);if(b.size===0)throw new Error("Updates specified for empty output. updates shape: "+b.shape)}jm(u,h,b)}function Ml(b,h,u){for(var d=h.shape.length,x=d>1?h.shape[d-1]:1,T=u.length,H=1,Z=x;Z<T;++Z)H*=u[Z];var ce=x<1?1:x;return{sliceRank:x,numUpdates:Qe(h.shape)/ce,sliceSize:H,strides:Tr(u.slice(0,x)).concat([1]),outputSize:Qe(u)}}var Uh=Object.freeze({validateUpdateShape:jm,validateInput:xd,calculateShapes:Ml});function Wh(b,h,u){Ce(b.rank===h.length,function(){return"Error in slice"+b.rank+"D: Length of begin "+h+" must match the rank of the array ("+b.rank+")."}),Ce(b.rank===u.length,function(){return"Error in slice"+b.rank+"D: Length of size "+u+" must match the rank of the array ("+b.rank+")."});for(var d=function(T){Ce(h[T]+u[T]<=b.shape[T],function(){return"Error in slice"+b.rank+"D: begin["+T+"] + size["+T+"] ("+(h[T]+u[T])+") would overflow input.shape["+T+"] ("+b.shape[T]+")"})},x=0;x<b.rank;++x)d(x)}function Os(b){for(var h=[],u=0;b>0;)1&b&&h.push(u),b/=2,u++;return h}function nh(b,h,u){for(var d=[],x=0;x<b.length;x++)d[x]=Math.ceil((h[x]-b[x])/u[x]);return d}function Yu(b,h,u,d,x){var T=h[x],H=u[x]||1;(b&1<<x||T==null)&&(T=H>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var Z=d[x];return T<0&&(T+=Z),Mt(0,T,Z-1)}function Vh(b,h,u,d,x){var T=h[x],H=u[x]||1;(b&1<<x||T==null)&&(T=H>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var Z=d[x];return T<0&&(T+=Z),H>0?Mt(0,T,Z):Mt(-1,T,Z-1)}function Ss(b,h,u){for(var d=u.length,x=0;x<u.length;x++)if(u[x]>1){d=x;break}for(x=d+1;x<u.length;x++)if(h[x]>0||u[x]!==b[x])return!1;return!0}function lu(b,h){for(var u=b.length>0?b[b.length-1]:1,d=0;d<b.length-1;d++)u+=b[d]*h[d];return u}var Gp=Object.freeze({assertParamsValid:Wh,maskToAxes:Os,computeOutShape:nh,startForAxis:Yu,stopForAxis:Vh,isSliceContinous:Ss,computeFlatOffset:lu});function wd(b){return Ce(lr(b),function(){return"The f passed in grad(f) must be a function"}),function(h,u){var d=Ze(h,"x","tf.grad",null),x=u!=null?Ze(u,"dy","tf.grad"):null;return He.tidy(function(){var T=He.gradients(function(){return b(d)},[d],x),H=T.value,Z=T.grads;return x!=null&&Wt(H.shape,x.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),er(Z),Z[0]})}}function rh(b){return Ce(lr(b),function(){return"The f passed in grads(f) must be a function"}),function(h,u){Ce(Array.isArray(h),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var d=tl(h,"args","tf.grads",null),x=u!=null?Ze(u,"dy","tf.grads"):null;return He.tidy(function(){var T=He.gradients(function(){return b.apply(void 0,d)},d,x),H=T.value,Z=T.grads;return x!=null&&Wt(H.shape,x.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),er(Z),Z})}}function $p(b){return Ce(lr(b),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(h,u){Ce(h instanceof $t,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),Ce(u==null||u instanceof $t,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var d=He.gradients(function(){return b(h)},[h],u),x=d.grads,T=d.value;return er(x),{grad:x[0],value:T}}}function kd(b){return Ce(lr(b),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(h,u){Ce(Array.isArray(h)&&h.every(function(x){return x instanceof $t}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),Ce(u==null||u instanceof $t,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var d=He.gradients(function(){return b.apply(void 0,h)},h,u);return u!=null&&Wt(d.value.shape,u.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),er(d.grads),d}}function ln(b,h){Ce(lr(b),function(){return"The f passed in variableGrads(f) must be a function"}),Ce(h==null||Array.isArray(h)&&h.every(function(Ee){return Ee instanceof xt}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var u=h!=null;if(!u)for(var d in h=[],He.registeredVariables)h.push(He.registeredVariables[d]);var x=u?h.filter(function(Ee){return!Ee.trainable}):null,T=h.length;Ce((h=h.filter(function(Ee){return Ee.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+T+" variables is trainable."});var H=He.gradients(b,h,null,!0),Z=H.value,ce=H.grads;Ce(ce.some(function(Ee){return Ee!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),Ce(Z.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+Z.rank+" tensor"});var ye={};return h.forEach(function(Ee,je){ce[je]!=null&&(ye[Ee.name]=ce[je])}),x!=null&&x.forEach(function(Ee){return ye[Ee.name]=null}),{value:Z,grads:ye}}function Ju(b){return He.customGrad(b)}function er(b){if(b.filter(function(h){return h==null}).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}var ru=Tt({softmax_:function(b,h){h===void 0&&(h=-1);var u=Ze(b,"logits","softmax","float32");if(h===-1&&(h=u.rank-1),h!==u.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+u.rank+" and dim was "+h);return He.runKernelFunc(function(d,x){var T=d.softmax(u,h);return x([T]),T},{logits:u},function(d,x){var T=x[0],H=d.mul(T);return{logits:function(){return H.sub(H.sum([h],!0).mul(T))}}},"Softmax",{dim:h},[],[!0])}}),Fo=Tt({logSoftmax_:function(b,h){h===void 0&&(h=-1);var u=Ze(b,"logits","logSoftmax");if(h===-1&&(h=u.rank-1),h!==u.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+u.rank+" and axis was "+h);return Ju(function(d,x){var T=d.max(h,!0),H=d.sub(T),Z=H.toFloat().sub(H.exp().sum(h,!0).log());return x([Z]),{value:Z,gradFunc:function(ce,ye){var Ee=ye[0].exp();return ce.sub(ce.sum(h,!0).mul(Ee))}}})(u)}}),cf=function(){function b(h,u){this.backend=h,this.dataMover=u,this.data=new WeakMap,this.dataIdsCount=0}return b.prototype.get=function(h){return this.data.has(h)||this.dataMover.moveData(this.backend,h),this.data.get(h)},b.prototype.set=function(h,u){this.dataIdsCount++,this.data.set(h,u)},b.prototype.has=function(h){return this.data.has(h)},b.prototype.delete=function(h){return this.dataIdsCount--,this.data.delete(h)},b.prototype.numDataIds=function(){return this.dataIdsCount},b}(),jl=function(){function b(){}return b.prototype.time=function(h){return wr("time")},b.prototype.read=function(h){return wr("read")},b.prototype.readSync=function(h){return wr("readSync")},b.prototype.numDataIds=function(){return wr("numDataIds")},b.prototype.disposeData=function(h){return wr("disposeData")},b.prototype.write=function(h,u,d){return wr("write")},b.prototype.move=function(h,u,d,x){return wr("move")},b.prototype.memory=function(){return wr("memory")},b.prototype.floatPrecision=function(){return wr("floatPrecision")},b.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},b.prototype.batchMatMul=function(h,u,d,x){return wr("batchMatMul")},b.prototype.fusedBatchMatMul=function(h){return h.a,h.b,h.transposeA,h.transposeB,h.bias,h.activation,h.preluActivationWeights,wr("fusedBatchMatMul")},b.prototype.slice=function(h,u,d){return wr("slice")},b.prototype.stridedSlice=function(h,u,d,x){return wr("stridedSlice")},b.prototype.unstack=function(h,u){return wr("unstack")},b.prototype.reverse=function(h,u){return wr("reverse")},b.prototype.concat=function(h,u){return wr("concat")},b.prototype.neg=function(h){return wr("neg")},b.prototype.add=function(h,u){return wr("add")},b.prototype.addN=function(h){return wr("addN")},b.prototype.subtract=function(h,u){return wr("subtract")},b.prototype.multiply=function(h,u){return wr("multiply")},b.prototype.realDivide=function(h,u){return wr("realDivide")},b.prototype.floorDiv=function(h,u){return wr("floorDiv")},b.prototype.sum=function(h,u){return wr("sum")},b.prototype.prod=function(h,u){return wr("prod")},b.prototype.unsortedSegmentSum=function(h,u,d){return wr("unsortedSegmentSum")},b.prototype.argMin=function(h,u){return wr("argMin")},b.prototype.argMax=function(h,u){return wr("argMax")},b.prototype.equal=function(h,u){return wr("equal")},b.prototype.notEqual=function(h,u){return wr("notEqual")},b.prototype.less=function(h,u){return wr("less")},b.prototype.lessEqual=function(h,u){return wr("lessEqual")},b.prototype.greater=function(h,u){return wr("greater")},b.prototype.greaterEqual=function(h,u){return wr("greaterEqual")},b.prototype.logicalNot=function(h){return wr("logicalNot")},b.prototype.logicalAnd=function(h,u){return wr("logicalAnd")},b.prototype.logicalOr=function(h,u){return wr("logicalOr")},b.prototype.where=function(h){return wr("where")},b.prototype.select=function(h,u,d){return wr("select")},b.prototype.topk=function(h,u,d){return wr("topk")},b.prototype.min=function(h,u){return wr("min")},b.prototype.minimum=function(h,u){return wr("minimum")},b.prototype.mod=function(h,u){return wr("mod")},b.prototype.max=function(h,u){return wr("max")},b.prototype.maximum=function(h,u){return wr("maximum")},b.prototype.all=function(h,u){return wr("all")},b.prototype.any=function(h,u){return wr("any")},b.prototype.squaredDifference=function(h,u){return wr("squaredDifference")},b.prototype.ceil=function(h){return wr("ceil")},b.prototype.floor=function(h){return wr("floor")},b.prototype.round=function(h){return wr("round")},b.prototype.sign=function(h){return wr("sign")},b.prototype.isNaN=function(h){return wr("isNaN")},b.prototype.isInf=function(h){return wr("isInf")},b.prototype.isFinite=function(h){return wr("isFinite")},b.prototype.pow=function(h,u){return wr("pow")},b.prototype.exp=function(h){return wr("exp")},b.prototype.expm1=function(h){return wr("expm1")},b.prototype.softmax=function(h,u){return wr("softmax")},b.prototype.log=function(h){return wr("log")},b.prototype.log1p=function(h){return wr("log1p")},b.prototype.sqrt=function(h){return wr("sqrt")},b.prototype.rsqrt=function(h){return wr("rsqrt")},b.prototype.square=function(h){return wr("square")},b.prototype.reciprocal=function(h){return wr("reciprocal")},b.prototype.relu=function(h){return wr("relu")},b.prototype.relu6=function(h){return wr("relu6")},b.prototype.prelu=function(h,u){return wr("prelu")},b.prototype.elu=function(h){return wr("elu")},b.prototype.eluDer=function(h,u){return wr("eluDer")},b.prototype.selu=function(h){return wr("selu")},b.prototype.int=function(h){return wr("int")},b.prototype.clip=function(h,u,d){return wr("clip")},b.prototype.abs=function(h){return wr("abs")},b.prototype.complexAbs=function(h){return wr("complexAbs")},b.prototype.sigmoid=function(h){return wr("sigmoid")},b.prototype.softplus=function(h){return wr("softplus")},b.prototype.sin=function(h){return wr("sin")},b.prototype.cos=function(h){return wr("cos")},b.prototype.tan=function(h){return wr("tan")},b.prototype.asin=function(h){return wr("asin")},b.prototype.acos=function(h){return wr("acos")},b.prototype.atan=function(h){return wr("atan")},b.prototype.atan2=function(h,u){return wr("atan2")},b.prototype.sinh=function(h){return wr("sinh")},b.prototype.cosh=function(h){return wr("cosh")},b.prototype.tanh=function(h){return wr("tanh")},b.prototype.asinh=function(h){return wr("asinh")},b.prototype.acosh=function(h){return wr("acosh")},b.prototype.atanh=function(h){return wr("atanh")},b.prototype.erf=function(h){return wr("erf")},b.prototype.step=function(h,u){return wr("step")},b.prototype.fusedConv2d=function(h){return h.input,h.filter,h.convInfo,h.bias,h.activation,h.preluActivationWeights,wr("fusedConv2d")},b.prototype.conv2d=function(h,u,d){return wr("conv2d")},b.prototype.conv2dDerInput=function(h,u,d){return wr("conv2dDerInput")},b.prototype.conv2dDerFilter=function(h,u,d){return wr("conv2dDerFilter")},b.prototype.fusedDepthwiseConv2D=function(h){return h.input,h.filter,h.convInfo,h.bias,h.activation,h.preluActivationWeights,wr("fusedDepthwiseConv2D")},b.prototype.depthwiseConv2D=function(h,u,d){return wr("depthwiseConv2D")},b.prototype.depthwiseConv2DDerInput=function(h,u,d){return wr("depthwiseConv2DDerInput")},b.prototype.depthwiseConv2DDerFilter=function(h,u,d){return wr("depthwiseConv2DDerFilter")},b.prototype.conv3d=function(h,u,d){return wr("conv3d")},b.prototype.conv3dDerInput=function(h,u,d){return wr("conv3dDerInput")},b.prototype.conv3dDerFilter=function(h,u,d){return wr("conv3dDerFilter")},b.prototype.maxPool=function(h,u){return wr("maxPool")},b.prototype.maxPoolBackprop=function(h,u,d,x){return wr("maxPoolBackprop")},b.prototype.avgPool=function(h,u){return wr("avgPool")},b.prototype.avgPoolBackprop=function(h,u,d){return wr("avgPoolBackprop")},b.prototype.avgPool3d=function(h,u){return wr("avgPool3d")},b.prototype.avgPool3dBackprop=function(h,u,d){return wr("avgPool3dBackprop")},b.prototype.maxPool3d=function(h,u){return wr("maxPool3d")},b.prototype.maxPool3dBackprop=function(h,u,d,x){return wr("maxPool3dBackprop")},b.prototype.reshape=function(h,u){return wr("reshape")},b.prototype.cast=function(h,u){return wr("cast")},b.prototype.tile=function(h,u){return wr("tile")},b.prototype.pad=function(h,u,d){return wr("pad")},b.prototype.transpose=function(h,u){return wr("transpose")},b.prototype.gather=function(h,u,d){return wr("gather")},b.prototype.gatherND=function(h,u){return wr("gatherND")},b.prototype.scatterND=function(h,u,d){return wr("scatterND")},b.prototype.batchToSpaceND=function(h,u,d){return wr("batchToSpaceND")},b.prototype.spaceToBatchND=function(h,u,d){return wr("spaceToBatchND")},b.prototype.resizeBilinear=function(h,u,d,x){return wr("resizeBilinear")},b.prototype.resizeBilinearBackprop=function(h,u,d){return wr("resizeBilinearBackprop")},b.prototype.resizeNearestNeighbor=function(h,u,d,x){return wr("resizeNearestNeighbor")},b.prototype.resizeNearestNeighborBackprop=function(h,u,d){return wr("resizeNearestNeighborBackprop")},b.prototype.batchNormalization=function(h,u,d,x,T,H){return wr("batchNormalization")},b.prototype.localResponseNormalization4D=function(h,u,d,x,T){return wr("localResponseNormalization4D")},b.prototype.LRNGrad=function(h,u,d,x,T,H,Z){return wr("LRNGrad")},b.prototype.multinomial=function(h,u,d,x){return wr("multinomial")},b.prototype.oneHot=function(h,u,d,x){return wr("oneHot")},b.prototype.cumsum=function(h,u,d,x){return wr("cumsum")},b.prototype.nonMaxSuppression=function(h,u,d,x,T){return wr("nonMaxSuppression")},b.prototype.fft=function(h){return wr("fft")},b.prototype.ifft=function(h){return wr("ifft")},b.prototype.complex=function(h,u){return wr("complex")},b.prototype.real=function(h){return wr("real")},b.prototype.imag=function(h){return wr("imag")},b.prototype.cropAndResize=function(h,u,d,x,T,H){return wr("cropAndResize")},b.prototype.depthToSpace=function(h,u,d){return wr("depthToSpace")},b.prototype.split=function(h,u,d){return wr("split")},b.prototype.sparseToDense=function(h,u,d,x){return wr("sparseToDense")},b.prototype.diag=function(h){return wr("diag")},b.prototype.fill=function(h,u,d){return wr("fill")},b.prototype.onesLike=function(h){return wr("onesLike")},b.prototype.zerosLike=function(h){return wr("zerosLike")},b.prototype.linspace=function(h,u,d){return wr("linspace")},b.prototype.dispose=function(){return wr("dispose")},b}();function wr(b){throw new Error("'"+b+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function fu(b,h){for(var u=b.length,d=[],x=0;x<u;x++){var T=u-1-x,H=b[T]||1;(h[h.length-1-x]||1)>1&&H===1&&d.unshift(T)}return d}function Ds(b,h){for(var u=[],d=0;d<h.length;d++){var x=b[b.length-d-1],T=h.length-d-1,H=h[T];(x==null||x===1&&H>1)&&u.unshift(T)}return u}function Ro(b,h){for(var u=[],d=Math.max(b.length,h.length),x=0;x<d;x++){var T=b[b.length-x-1];T==null&&(T=1);var H=h[h.length-x-1];if(H==null&&(H=1),T===1)u.unshift(H);else if(H===1)u.unshift(T);else{if(T!==H)throw Error("Operands could not be broadcast together with shapes "+b+" and "+h+".");u.unshift(T)}}return u}function yl(b,h,u,d,x,T,H){H===void 0&&(H="channelsLast");var Z,ce=fc(h),ye=ce[0],Ee=ce[1];if(H==="channelsLast")Z=[ye,Ee,b[3],b[3]];else{if(H!=="channelsFirst")throw new Error("Unknown dataFormat "+H);Z=[ye,Ee,b[1],b[1]]}return wu(b,Z,u,d,x,T,!1,H)}function nl(b,h,u,d,x,T,H){H===void 0&&(H="NDHWC");var Z,ce,ye=Mu(h),Ee=ye[0],je=ye[1],Pe=ye[2];if(H==="NDHWC")ce="channelsLast",Z=[Ee,je,Pe,b[4],b[4]];else{if(H!=="NCDHW")throw new Error("Unknown dataFormat "+H);ce="channelsFirst",Z=[Ee,je,Pe,b[1],b[1]]}return Bl(b,Z,u,d,x,!1,ce,T)}function wu(b,h,u,d,x,T,H,Z){H===void 0&&(H=!1),Z===void 0&&(Z="channelsLast");var ce=[-1,-1,-1,-1],ye=ce[0],Ee=ce[1],je=ce[2],Pe=ce[3];if(Z==="channelsLast")ye=b[0],Ee=b[1],je=b[2],Pe=b[3];else{if(Z!=="channelsFirst")throw new Error("Unknown dataFormat "+Z);ye=b[0],Pe=b[1],Ee=b[2],je=b[3]}var ze,Ge=h[0],rt=h[1],it=h[3],ht=fc(u),Et=ht[0],At=ht[1],St=fc(d),Gt=St[0],un=St[1],vn=po(Ge,Gt),cn=po(rt,un),kn=function(l,y,S,U,G,ae,le,be){var Se,Ie,Me;if(typeof l=="number"){Se={top:l,bottom:l,left:l,right:l,type:l===0?"VALID":"NUMBER"};var qe=function(_t,jt,Qt,sn,Zt){sn==null&&(sn=Kt(_t,jt,Qt));var rn=_t[1],Sn=uo((_t[0]-jt+2*sn)/Qt+1,Zt);Ce(on(Sn),function(){return"The output # of rows ("+Sn+") must be an integer. Change the stride and/or zero pad parameters"});var Bn=uo((rn-jt+2*sn)/Qt+1,Zt);return Ce(on(Bn),function(){return"The output # of columns ("+Bn+") must be an integer. Change the stride and/or zero pad parameters"}),[Sn,Bn]}([y,S],ae,U,l,be);Ie=qe[0],Me=qe[1]}else if(l==="same"){Ie=Math.ceil(y/U),Me=Math.ceil(S/G);var Ye=Math.max(0,(Ie-1)*U+ae-y),Xe=Math.max(0,(Me-1)*G+le-S),at=Math.floor(Ye/2),gt=Ye-at,bt=Math.floor(Xe/2);Se={top:at,bottom:gt,left:bt,right:Xe-bt,type:"SAME"}}else{if(l!=="valid")throw Error("Unknown padding parameter: "+l);Se={top:0,bottom:0,left:0,right:0,type:"VALID"},Ie=Math.ceil((y-ae+1)/U),Me=Math.ceil((S-le+1)/G)}return{padInfo:Se,outHeight:Ie,outWidth:Me}}(x,Ee,je,Et,At,vn,cn,T),On=kn.padInfo,p=kn.outHeight,c=kn.outWidth,a=H?it*Pe:it;return Z==="channelsFirst"?ze=[ye,a,p,c]:Z==="channelsLast"&&(ze=[ye,p,c,a]),{batchSize:ye,dataFormat:Z,inHeight:Ee,inWidth:je,inChannels:Pe,outHeight:p,outWidth:c,outChannels:a,padInfo:On,strideHeight:Et,strideWidth:At,filterHeight:Ge,filterWidth:rt,effectiveFilterHeight:vn,effectiveFilterWidth:cn,dilationHeight:Gt,dilationWidth:un,inShape:b,outShape:ze,filterShape:h}}function Bl(b,h,u,d,x,T,H,Z){T===void 0&&(T=!1),H===void 0&&(H="channelsLast");var ce=[-1,-1,-1,-1,-1],ye=ce[0],Ee=ce[1],je=ce[2],Pe=ce[3],ze=ce[4];if(H==="channelsLast")ye=b[0],Ee=b[1],je=b[2],Pe=b[3],ze=b[4];else{if(H!=="channelsFirst")throw new Error("Unknown dataFormat "+H);ye=b[0],ze=b[1],Ee=b[2],je=b[3],Pe=b[4]}var Ge,rt=h[0],it=h[1],ht=h[2],Et=h[4],At=Mu(u),St=At[0],Gt=At[1],un=At[2],vn=Mu(d),cn=vn[0],kn=vn[1],On=vn[2],p=po(rt,cn),c=po(it,kn),a=po(ht,On),l=function(le,be,Se,Ie,Me,qe,Ye,Xe,at,gt,bt){var _t,jt,Qt,sn;if(typeof le=="number"){_t={top:le,bottom:le,left:le,right:le,front:le,back:le,type:le===0?"VALID":"NUMBER"};var Zt=function(Ar,_r,Yr,Kr,fi,Ti){fi==null&&(fi=Kt(Ar,_r,Kr));var Yi=Ar[1],ia=Ar[2],oa=uo((Ar[0]-_r+2*fi)/Kr+1,Ti);Ce(on(oa),function(){return"The output # of depths ("+oa+") must be an integer. Change the stride and/or zero pad parameters"});var wa=uo((Yi-_r+2*fi)/Kr+1,Ti);Ce(on(wa),function(){return"The output # of rows ("+wa+") must be an integer. Change the stride and/or zero pad parameters"});var ba=uo((ia-_r+2*fi)/Kr+1,Ti);return Ce(on(ba),function(){return"The output # of columns ("+ba+") must be an integer. Change the stride and/or zero pad parameters"}),[oa,wa,ba,1]}([be,Se,Ie,1],Xe,0,Me,le,bt);jt=Zt[0],Qt=Zt[1],sn=Zt[2]}else if(le==="same"){var rn=((jt=Math.ceil(be/Me))-1)*Me+Xe-be,Sn=((Qt=Math.ceil(Se/qe))-1)*qe+at-Se,Bn=((sn=Math.ceil(Ie/Ye))-1)*Ye+gt-Ie,Mn=Math.floor(rn/2),fr=rn-Mn,yr=Math.floor(Sn/2),Cr=Sn-yr,Nr=Math.floor(Bn/2);_t={top:yr,bottom:Cr,left:Nr,right:Bn-Nr,front:Mn,back:fr,type:"SAME"}}else{if(le!=="valid")throw Error("Unknown padding parameter: "+le);_t={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},jt=Math.ceil((be-Xe+1)/Me),Qt=Math.ceil((Se-at+1)/qe),sn=Math.ceil((Ie-gt+1)/Ye)}return{padInfo:_t,outDepth:jt,outHeight:Qt,outWidth:sn}}(x,Ee,je,Pe,St,Gt,un,p,c,a,Z),y=l.padInfo,S=l.outDepth,U=l.outHeight,G=l.outWidth,ae=T?Et*ze:Et;return H==="channelsFirst"?Ge=[ye,ae,S,U,G]:H==="channelsLast"&&(Ge=[ye,S,U,G,ae]),{batchSize:ye,dataFormat:H,inDepth:Ee,inHeight:je,inWidth:Pe,inChannels:ze,outDepth:S,outHeight:U,outWidth:G,outChannels:ae,padInfo:y,strideDepth:St,strideHeight:Gt,strideWidth:un,filterDepth:rt,filterHeight:it,filterWidth:ht,effectiveFilterDepth:p,effectiveFilterHeight:c,effectiveFilterWidth:a,dilationDepth:cn,dilationHeight:kn,dilationWidth:On,inShape:b,outShape:Ge,filterShape:h}}function Kt(b,h,u,d){d===void 0&&(d=1);var x=po(h,d);return Math.floor((b[0]*(u-1)-u+x)/2)}function fc(b){return typeof b=="number"?[b,b,b]:b.length===2?[b[0],b[1],1]:b}function Mu(b){return typeof b=="number"?[b,b,b]:b}function po(b,h){return h<=1?b:b+(b-1)*(h-1)}function uo(b,h){if(!h)return b;switch(h){case"round":return Math.round(b);case"ceil":return Math.ceil(b);case"floor":return Math.floor(b);default:throw new Error("Unknown roundingMode "+h)}}function js(b){var h=fc(b),u=h[0],d=h[1],x=h[2];return u===1&&d===1&&x===1}function ju(b,h){return js(b)||js(h)}function ts(b){if(b==="NHWC")return"channelsLast";if(b==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+b)}function iu(b,h,u){if(h==="complex64"){if(b.dtype==="complex64")return b.clone();var d=Io(b.shape),x=b.toFloat(),T=u.complex(x,d);return d.dispose(),x.dispose(),T}if(!Ke(b.dtype,h))return He.makeTensorFromDataId(b.dataId,b.shape,h);if(b.dtype==="complex64"){var H=u.real(b);return T=H.cast(h),H.dispose(),T}if(h==="int32")return u.int(b);if(h==="bool"){var Z=Mr(0,b.dtype);return T=u.notEqual(b,Z),Z.dispose(),T}throw new Error("Error in Cast: failed to cast "+b.dtype+" to "+h)}function bl(b,h){return He.makeTensorFromDataId(b.dataId,h,b.dtype)}function Pl(b,h,u){var d=(h-b)/(u-1),x=nn(u,"float32");x[0]=b;for(var T=1;T<x.length;T++)x[T]=x[T-1]+d;return Cc(x,"float32")}var lf=Object.freeze({castTensor:iu,reshapeTensor:bl,linspaceImpl:Pl,upcastType:yn,axesAreInnerMostDims:es,combineLocations:Nl,computeOutAndReduceShapes:pa,expandShapeToKeepDim:Ea,assertAxesAreInnerMostDims:La,getAxesPermutation:Fs,getUndoAxesPermutation:vl,getInnerMostAxes:Rs,getBroadcastDims:fu,getReductionAxes:Ds,assertAndGetBroadcastShape:Ro,assertParamsConsistent:tf,computeOutShape:Ku,computePool2DInfo:yl,computePool3DInfo:nl,computeConv2DInfo:wu,computeConv3DInfo:Bl,computeDefaultPad:Kt,tupleValuesAreOne:js,eitherStridesOrDilationsAreOne:ju,convertConv2DDataFormat:ts,PARALLELIZE_THRESHOLD:Lh,computeOptimalWindowSize:zh});function xl(b,h){if(b.length!==h.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+b.length+", imag: "+h.length+".");for(var u=new Float32Array(2*b.length),d=0;d<u.length;d+=2)u[d]=b[d/2],u[d+1]=h[d/2];return u}function ih(b,h){return{real:b[2*h],imag:b[2*h+1]}}function hc(b,h,u,d){b[2*d]=h,b[2*d+1]=u}function tp(b,h,u){var d=(u?2:-2)*Math.PI*(b/h);return{real:Math.cos(d),imag:Math.sin(d)}}function oh(b,h,u){var d=function(T,H,Z){return function(ce,ye,Ee){for(var je=0,Pe=ce.length,ze=0,Ge=!1;je<Pe;){var rt=Ee(ye,ce[ze=je+(Pe-je>>>1)]);rt>0?je=ze+1:(Pe=ze,Ge=!rt)}return Ge?je:-je-1}(T,H,Z||Sc)}(b,h,u),x=d<0?-(d+1):d;b.splice(x,0,h)}function Sc(b,h){return b>h?1:b<h?-1:0}function wl(b,h,u,d,x){return Ys(b,h,u,d,x,0).selectedIndices}function kl(b,h,u,d,x,T){var H=Ys(b,h,u,d,x,T);return H.numValidOutputs.dispose(),{selectedIndices:H.selectedIndices,selectedScores:H.selectedScores}}function Ys(b,h,u,d,x,T,H,Z){Z===void 0&&(Z=!1);for(var ce=Array.from(h).map(function(St,Gt){return{score:St,boxIndex:Gt,suppressBeginIndex:0}}).filter(function(St){return St.score>x}).sort(Ed),ye=T>0?-.5/T:0,Ee=[],je=[];Ee.length<u&&ce.length>0;){var Pe=ce.pop(),ze=Pe.score,Ge=Pe.boxIndex,rt=Pe.suppressBeginIndex;if(ze<x)break;for(var it=!1,ht=Ee.length-1;ht>=rt;--ht){var Et=np(b,Ge,Ee[ht]);if(Et>=d){it=!0;break}if(Pe.score=Pe.score*_d(d,ye,Et),Pe.score<=x)break}Pe.suppressBeginIndex=Ee.length,it||(Pe.score===ze?(Ee.push(Ge),je.push(Pe.score)):Pe.score>x&&oh(ce,Pe,Ed))}var At=Ee.length;return Z&&(Ee.fill(0,At),je.fill(0,At)),{selectedIndices:Cc(Ee,"int32"),selectedScores:Cc(je,"float32"),numValidOutputs:Mr(At,"int32")}}function np(b,h,u){var d=b.subarray(4*h,4*h+4),x=b.subarray(4*u,4*u+4),T=Math.min(d[0],d[2]),H=Math.min(d[1],d[3]),Z=Math.max(d[0],d[2]),ce=Math.max(d[1],d[3]),ye=Math.min(x[0],x[2]),Ee=Math.min(x[1],x[3]),je=Math.max(x[0],x[2]),Pe=Math.max(x[1],x[3]),ze=(Z-T)*(ce-H),Ge=(je-ye)*(Pe-Ee);if(ze<=0||Ge<=0)return 0;var rt=Math.max(T,ye),it=Math.max(H,Ee),ht=Math.min(Z,je),Et=Math.min(ce,Pe),At=Math.max(ht-rt,0)*Math.max(Et-it,0);return At/(ze+Ge-At)}function _d(b,h,u){var d=Math.exp(h*u*u);return u<=b?d:0}function Ed(b,h){return b.score-h.score||b.score===h.score&&h.boxIndex-b.boxIndex}function qh(b,h,u){var d=new Array(b.rank).fill(0),x=b.shape.slice();return h.map(function(T){x[u]=T;var H=b.slice(d,x);return d[u]+=T,H})}function Cd(b,h){for(var u=new Array(b.rank),d=0;d<u.length;d++)u[d]=b.shape[d]*h[d];var x=wo(u,b.dtype);for(d=0;d<x.values.length;++d){for(var T=x.indexToLoc(d),H=new Array(b.rank),Z=0;Z<H.length;Z++)H[Z]=T[Z]%b.shape[Z];var ce=b.locToIndex(H);x.values[d]=b.values[ce]}return x.toTensor()}function re(b,h,u,d,x){for(var T=h[h.length-1],H=[b.length/T,T],Z=H[0],ce=H[1],ye=tr(u,Z*d),Ee=tr("int32",Z*d),je=0;je<Z;je++){for(var Pe=je*ce,ze=b.subarray(Pe,Pe+ce),Ge=[],rt=0;rt<ze.length;rt++)Ge.push({value:ze[rt],index:rt});Ge.sort(function(St,Gt){return Gt.value-St.value});var it=je*d,ht=ye.subarray(it,it+d),Et=Ee.subarray(it,it+d);for(rt=0;rt<d;rt++)ht[rt]=Ge[rt].value,Et[rt]=Ge[rt].index}var At=h.slice();return At[At.length-1]=d,[la(ye,At,u),la(Ee,At,"int32")]}function Q(b,h){for(var u=[],d=0;d<h.length;d++)h[d]&&u.push(d);var x=wo(b,"int32"),T=wo([u.length,b.length],"int32");for(d=0;d<u.length;d++){var H=x.indexToLoc(u[d]),Z=d*b.length;T.values.set(H,Z)}return T.toTensor()}function C(b,h){return["x","y","z","w","u","v"].slice(0,h).map(function(u){return b+"."+u})}function R(b,h){return h===1?[b]:C(b,h)}function oe(){var b,h,u,d,x,T,H,Z,ce,ye;return W().getNumber("WEBGL_VERSION")===2?(b="#version 300 es",h="in",u="out",d="in",x="texture",T="outputColor",H="out vec4 outputColor;",Z=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,ce="",ye=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(b="",h="attribute",u="varying",d="varying",x="texture2D",T="gl_FragColor",H="",Z=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,ce=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,ye=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:b,attribute:h,varyingVs:u,varyingFs:d,texture2D:x,output:T,defineOutput:H,defineSpecialNaN:Z,defineSpecialInf:ce,defineRound:ye}}function Ue(b,h,u){u===void 0&&(u="index");var d=Tr(h);return d.map(function(x,T){return"int "+b[T]+" = "+u+" / "+x+"; "+(T===d.length-1?"int "+b[T+1]+" = "+u+" - "+b[T]+" * "+x:"index -= "+b[T]+" * "+x)+";"}).join("")}function Je(b){var h=Tr(b).map(function(u){return u.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+h[0]+" + coords.y * "+h[1]+` + coords.z;
  }
`}var vt=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function qt(b,h,u,d){var x=[];b.forEach(function(ze){var Ge=Qe(ze.shapeInfo.logicalShape);ze.shapeInfo.isUniform?x.push("uniform float "+ze.name+(Ge>1?"["+Ge+"]":"")+";"):(x.push("uniform sampler2D "+ze.name+";"),x.push("uniform int offset"+ze.name+";"))});var T,H,Z=x.join(`
`),ce=b.map(function(ze){return function(Ge,rt,it){it===void 0&&(it=!1);var ht="";ht+=it?function St(Gt){var un,vn,cn;switch(Gt.shapeInfo.logicalShape.length){case 0:return un=Gt.name,vn="get"+un.charAt(0).toUpperCase()+un.slice(1),cn=oe(),`
    vec4 `+vn+`() {
      return `+cn.texture2D+"("+un+`, halfCR);
    }
  `;case 1:return function(kn){var On=kn.name,p="get"+On.charAt(0).toUpperCase()+On.slice(1),c=kn.shapeInfo.texShape,a=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],l=oe();return`
    vec4 `+p+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+a[0]+", "+a[1]+`, index);
      return `+l.texture2D+"("+On+`, uv);
    }
  `}(Gt);case 2:return function(kn){var On=kn.shapeInfo.logicalShape,p=kn.name,c="get"+p.charAt(0).toUpperCase()+p.slice(1),a=kn.shapeInfo.texShape,l=a[0],y=a[1],S=oe();if(a!=null&&fn(On,a))return`
      vec4 `+c+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+y+".0, "+l+`.0);

        return `+S.texture2D+"("+p+`, uv);
      }
    `;var U=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],G=Math.ceil(On[1]/2);return`
    vec4 `+c+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+G+", "+U[0]+", "+U[1]+`, row, col);
      return `+S.texture2D+"("+p+`, uv);
    }
  `}(Gt);case 3:return function(kn){var On=kn.shapeInfo.logicalShape,p=kn.name,c="get"+p.charAt(0).toUpperCase()+p.slice(1),a=kn.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(On[0]===1){var y=On.slice(1),S=br(kn,y);return`
        `+St(S)+`
        vec4 `+c+`(int b, int row, int col) {
          return `+c+"("+xr(["b","row","col"],[1,2])+`);
        }
      `}var U=l[0],G=l[1],ae=Math.ceil(On[2]/2),le=ae*Math.ceil(On[1]/2),be=oe();return`
    vec4 `+c+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+U+", "+G+", "+le+", "+ae+`, b, row, col);
      return `+be.texture2D+"("+p+`, uv);
    }
  `}(Gt);default:return function(kn){for(var On=kn.shapeInfo.logicalShape,p=On.length,c=kn.name,a="get"+c.charAt(0).toUpperCase()+c.slice(1),l=kn.shapeInfo.texShape,y=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],S=y[0],U=y[1],G=Math.ceil(On[p-1]/2),ae=G*Math.ceil(On[p-2]/2),le="int b, int row, int col",be="b * "+ae+" + (row / 2) * "+G+" + (col / 2)",Se=2;Se<p-1;Se++)le="int b"+Se+", "+le,ae*=On[p-Se-1],be="b"+Se+" * "+ae+" + "+be;var Ie=oe();return`
    vec4 `+a+"("+le+`) {
      int index = `+be+`;
      int texR = index / `+U+`;
      int texC = index - texR * `+U+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+U+", "+S+`);
      return `+Ie.texture2D+"("+c+`, uv);
    }
  `}(Gt)}}(Ge):function St(Gt){var un=Gt.shapeInfo.logicalShape;switch(un.length){case 0:return function(vn){var cn=vn.name,kn="get"+cn.charAt(0).toUpperCase()+cn.slice(1);if(vn.shapeInfo.isUniform)return"float "+kn+"() {return "+cn+";}";var On=vn.shapeInfo.texShape,p=On[0],c=On[1];if(p===1&&c===1)return`
      float `+kn+`() {
        return sampleTexture(`+cn+`, halfCR);
      }
    `;var a=vn.shapeInfo.texShape,l=a[0],y=a[1],S=Vn(cn);return`
    float `+kn+`() {
      vec2 uv = uvFromFlat(`+l+", "+y+", "+S+`);
      return sampleTexture(`+cn+`, uv);
    }
  `}(Gt);case 1:return function(vn){var cn=vn.name,kn="get"+cn.charAt(0).toUpperCase()+cn.slice(1);if(vn.shapeInfo.isUniform)return`
      float `+kn+`(int index) {
        `+rr(vn)+`
      }
    `;var On=vn.shapeInfo.texShape,p=On[0],c=On[1];if(c===1&&p===1)return`
      float `+kn+`(int index) {
        return sampleTexture(`+cn+`, halfCR);
      }
    `;var a=Vn(cn);return c===1?`
      float `+kn+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+a+") + 0.5) / "+p+`.0);
        return sampleTexture(`+cn+`, uv);
      }
    `:p===1?`
      float `+kn+`(int index) {
        vec2 uv = vec2((float(index + `+a+") + 0.5) / "+c+`.0, 0.5);
        return sampleTexture(`+cn+`, uv);
      }
    `:`
    float `+kn+`(int index) {
      vec2 uv = uvFromFlat(`+p+", "+c+", index + "+a+`);
      return sampleTexture(`+cn+`, uv);
    }
  `}(Gt);case 2:return function(vn){var cn=vn.shapeInfo.logicalShape,kn=vn.name,On="get"+kn.charAt(0).toUpperCase()+kn.slice(1),p=vn.shapeInfo.texShape;if(p!=null&&fn(cn,p)){var c=p[0],a=p[1];return`
    float `+On+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+a+".0, "+c+`.0);
      return sampleTexture(`+kn+`, uv);
    }
  `}var l=Hn(cn),y=l.newShape,S=l.keptDims,U=y;if(U.length<cn.length){var G=br(vn,U);return`
      `+St(G)+`
      float `+On+`(int row, int col) {
        return `+On+"("+xr(["row","col"],S)+`);
      }
    `}if(vn.shapeInfo.isUniform)return`
      float `+On+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+cn[1]+`, 1)));
        `+rr(vn)+`
      }
    `;var ae=p[0],le=p[1],be=Vn(kn);return le===1?`
    float `+On+`(int row, int col) {
      float index = dot(vec3(row, col, `+be+"), vec3("+cn[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+ae+`.0);
      return sampleTexture(`+kn+`, uv);
    }
  `:ae===1?`
    float `+On+`(int row, int col) {
      float index = dot(vec3(row, col, `+be+"), vec3("+cn[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+le+`.0, 0.5);
      return sampleTexture(`+kn+`, uv);
    }
  `:`
  float `+On+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+cn[1]+" + col + "+be+`;
    vec2 uv = uvFromFlat(`+ae+", "+le+`, index);
    return sampleTexture(`+kn+`, uv);
  }
`}(Gt);case 3:return function(vn){var cn=vn.shapeInfo.logicalShape,kn=vn.name,On="get"+kn.charAt(0).toUpperCase()+kn.slice(1),p=cn[1]*cn[2],c=cn[2],a=Hn(cn),l=a.newShape,y=a.keptDims,S=l;if(S.length<cn.length){var U=br(vn,S);return`
        `+St(U)+`
        float `+On+`(int row, int col, int depth) {
          return `+On+"("+xr(["row","col","depth"],y)+`);
        }
      `}if(vn.shapeInfo.isUniform)return`
      float `+On+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+p+", "+c+`, 1)));
        `+rr(vn)+`
      }
    `;var G=vn.shapeInfo.texShape,ae=G[0],le=G[1],be=vn.shapeInfo.flatOffset;if(le===p&&be==null)return`
        float `+On+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+c+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+le+".0, "+ae+`.0);
          return sampleTexture(`+kn+`, uv);
        }
      `;if(le===c&&be==null)return`
    float `+On+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+cn[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+le+".0, "+ae+`.0);
      return sampleTexture(`+kn+`, uv);
    }
  `;var Se=Vn(kn);return`
      float `+On+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+p+" + col * "+c+" + depth + "+Se+`;
        vec2 uv = uvFromFlat(`+ae+", "+le+`, index);
        return sampleTexture(`+kn+`, uv);
      }
  `}(Gt);case 4:return function(vn){var cn=vn.shapeInfo.logicalShape,kn=vn.name,On="get"+kn.charAt(0).toUpperCase()+kn.slice(1),p=cn[3],c=cn[2]*p,a=cn[1]*c,l=Hn(cn),y=l.newShape,S=l.keptDims;if(y.length<cn.length){var U=br(vn,y);return`
      `+St(U)+`
      float `+On+`(int row, int col, int depth, int depth2) {
        return `+On+"("+xr(["row","col","depth","depth2"],S)+`);
      }
    `}if(vn.shapeInfo.isUniform)return`
      float `+On+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+a+", "+c+", "+p+`, 1)));
        `+rr(vn)+`
      }
    `;var G=vn.shapeInfo.flatOffset,ae=vn.shapeInfo.texShape,le=ae[0],be=ae[1];if(be===a&&G==null)return`
      float `+On+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+c+", "+p+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+be+".0, "+le+`.0);
        return sampleTexture(`+kn+`, uv);
      }
    `;if(be===p&&G==null)return`
      float `+On+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+cn[1]*cn[2]+", "+cn[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+be+".0, "+le+`.0);
        return sampleTexture(`+kn+`, uv);
      }
    `;var Se=Vn(kn);return`
    float `+On+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+a+" + col * "+c+` +
          depth * `+p+` + depth2;
      vec2 uv = uvFromFlat(`+le+", "+be+", index + "+Se+`);
      return sampleTexture(`+kn+`, uv);
    }
  `}(Gt);case 5:return function(vn){var cn=vn.shapeInfo.logicalShape,kn=vn.name,On="get"+kn.charAt(0).toUpperCase()+kn.slice(1),p=cn[4],c=cn[3]*p,a=cn[2]*c,l=cn[1]*a,y=Hn(cn),S=y.newShape,U=y.keptDims;if(S.length<cn.length){var G=br(vn,S);return`
      `+St(G)+`
      float `+On+`(int row, int col, int depth, int depth2, int depth3) {
        return `+On+"("+xr(["row","col","depth","depth2","depth3"],U)+`);
      }
    `}if(vn.shapeInfo.isUniform)return`
      float `+On+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+a+", "+c+", "+p+`)) +
          depth3;
        `+rr(vn)+`
      }
    `;var ae=vn.shapeInfo.flatOffset,le=vn.shapeInfo.texShape,be=le[0],Se=le[1];if(Se===l&&ae==null)return`
      float `+On+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+a+", "+c+", "+p+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+Se+".0, "+be+`.0);
        return sampleTexture(`+kn+`, uv);
      }
    `;if(Se===p&&ae==null)return`
      float `+On+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+cn[1]*cn[2]*cn[3]+`,
               `+cn[2]*cn[3]+", "+cn[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+Se+".0, "+be+`.0);
        return sampleTexture(`+kn+`, uv);
      }
    `;var Ie=Vn(kn);return`
    float `+On+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+a+" + depth * "+c+` +
          depth2 * `+p+" + depth3 + "+Ie+`;
      vec2 uv = uvFromFlat(`+be+", "+Se+`, index);
      return sampleTexture(`+kn+`, uv);
    }
  `}(Gt);case 6:return function(vn){var cn=vn.shapeInfo.logicalShape,kn=vn.name,On="get"+kn.charAt(0).toUpperCase()+kn.slice(1),p=Hn(cn),c=p.newShape,a=p.keptDims;if(c.length<cn.length){var l=br(vn,c);return`
      `+St(l)+`
      float `+On+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+On+"("+xr(["row","col","depth","depth2","depth3","depth4"],a)+`);
      }
    `}var y=cn[5],S=cn[4]*y,U=cn[3]*S,G=cn[2]*U,ae=cn[1]*G;if(vn.shapeInfo.isUniform)return`
      float `+On+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+ae+", "+G+", "+U+", "+S+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+y+`, 1)));
        `+rr(vn)+`
      }
    `;var le=vn.shapeInfo.flatOffset,be=vn.shapeInfo.texShape,Se=be[0],Ie=be[1];if(Ie===ae&&le==null)return`
      float `+On+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+G+", "+U+", "+S+", "+y+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+Ie+".0, "+Se+`.0);
        return sampleTexture(`+kn+`, uv);
      }
    `;if(Ie===y&&le==null)return`
      float `+On+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+cn[1]*cn[2]*cn[3]*cn[4]+`,
               `+cn[2]*cn[3]*cn[4]+`,
               `+cn[3]*cn[4]+`,
               `+cn[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+Ie+".0, "+Se+`.0);
        return sampleTexture(`+kn+`, uv);
      }
    `;var Me=Vn(kn);return`
    float `+On+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+ae+" + col * "+G+" + depth * "+U+` +
          depth2 * `+S+" + depth3 * "+y+" + depth4 + "+Me+`;
      vec2 uv = uvFromFlat(`+Se+", "+Ie+`, index);
      return sampleTexture(`+kn+`, uv);
    }
  `}(Gt);default:throw new Error(un.length+"-D input sampling is not yet supported")}}(Ge);var Et=Ge.shapeInfo.logicalShape,At=rt.logicalShape;return Et.length<=At.length&&(ht+=it?function(St,Gt){var un,vn=St.name,cn=vn.charAt(0).toUpperCase()+vn.slice(1),kn="get"+cn+"AtOutCoords",On=St.shapeInfo.logicalShape.length,p=Gt.logicalShape.length,c=fu(St.shapeInfo.logicalShape,Gt.logicalShape),a=Yn(p),l=p-On,y=["x","y","z","w","u","v"];un=On===0?"":p<2&&c.length>=1?"coords = 0;":c.map(function(Se){return"coords."+y[Se+l]+" = 0;"}).join(`
`);var S;S=p<2&&On>0?"coords":St.shapeInfo.logicalShape.map(function(Se,Ie){return"coords."+y[Ie+l]}).join(", ");var U="return outputValue;",G=Qe(St.shapeInfo.logicalShape)===1,ae=Qe(Gt.logicalShape)===1;if(On!==1||G||ae){if(G&&!ae)U=p===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(c.length){var le=On-2,be=On-1;c.indexOf(le)>-1&&c.indexOf(be)>-1?U="return vec4(outputValue.x);":c.indexOf(le)>-1?U="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(be)>-1&&(U="return vec4(outputValue.xx, outputValue.zz);")}}else U=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+kn+`() {
      `+a+` coords = getOutputCoords();
      `+un+`
      vec4 outputValue = get`+cn+"("+S+`);
      `+U+`
    }
  `}(Ge,rt):function(St,Gt){var un=St.name,vn=un.charAt(0).toUpperCase()+un.slice(1),cn="get"+vn+"AtOutCoords",kn=Gt.texShape,On=St.shapeInfo.texShape,p=St.shapeInfo.logicalShape.length,c=Gt.logicalShape.length;if(!St.shapeInfo.isUniform&&p===c&&St.shapeInfo.flatOffset==null&&fn(On,kn))return`
      float `+cn+`() {
        return sampleTexture(`+un+`, resultUV);
      }
    `;var a=Yn(c),l=fu(St.shapeInfo.logicalShape,Gt.logicalShape),y=c-p,S=["x","y","z","w","u","v"];return`
    float `+cn+`() {
      `+a+` coords = getOutputCoords();
      `+(p===0?"":c<2&&l.length>=1?"coords = 0;":l.map(function(U){return"coords."+S[U+y]+" = 0;"}).join(`
`))+`
      return get`+vn+"("+(c<2&&p>0?"coords":St.shapeInfo.logicalShape.map(function(U,G){return"coords."+S[G+y]}).join(", "))+`);
    }
  `}(Ge,rt)),ht}(ze,h,d)}).join(`
`),ye=h.texShape,Ee=oe(),je=`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+Ee.texture2D+`(textureSampler, uv).r;
    }
  `,Pe=function(ze){return ze.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+ze.varyingFs+` vec2 resultUV;
    `+ze.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+ze.defineSpecialNaN+`
    `+ze.defineSpecialInf+`
    `+ze.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+Jt+`
    `+pt+`
    `+Nn+`
  `}(Ee);return h.isPacked?(T=function(ze,Ge){switch(ze.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(St,Gt){var un=[Math.ceil(Gt[0]/2),Math.ceil(Gt[1]/2)];return un[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+un[1]+`.0);
      }
    `:un[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+un[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+un[0]+", "+un[1]+`));
      return 2 * (resTexRC.x * `+un[1]+` + resTexRC.y);
    }
  `}(0,Ge);case 2:return function(St,Gt){var un=[Math.ceil(Gt[0]/2),Math.ceil(Gt[1]/2)];if(fn(St,Gt))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+un[0]+", "+un[1]+`));
      }
    `;var vn=Math.ceil(St[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+un[0]+", "+un[1]+`));

      int index = resTexRC.x * `+un[1]+` + resTexRC.y;
      int r = 2 * (index / `+vn+`);
      int c = imod(index, `+vn+`) * 2;

      return ivec2(r, c);
    }
  `}(ze,Ge);case 3:return rt=ze,it=Ge,ht=[Math.ceil(it[0]/2),Math.ceil(it[1]/2)],At=(Et=Math.ceil(rt[2]/2))*Math.ceil(rt[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+ht[0]+", "+ht[1]+`));
      int index = resTexRC.x * `+ht[1]+` + resTexRC.y;

      int b = index / `+At+`;
      index -= b * `+At+`;

      int r = 2 * (index / `+Et+`);
      int c = imod(index, `+Et+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(St,Gt){for(var un=[Math.ceil(Gt[0]/2),Math.ceil(Gt[1]/2)],vn=Math.ceil(St[St.length-1]/2),cn=vn*Math.ceil(St[St.length-2]/2),kn=cn,On="",p="b, r, c",c=2;c<St.length-1;c++)On=`
      int b`+c+" = index / "+(kn*=St[St.length-c-1])+`;
      index -= b`+c+" * "+kn+`;
    `+On,p="b"+c+", "+p;return`
    ivec`+St.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+un[0]+", "+un[1]+`));
      int index = resTexRC.x * `+un[1]+` + resTexRC.y;

      `+On+`

      int b = index / `+cn+`;
      index -= b * `+cn+`;

      int r = 2 * (index / `+vn+`);
      int c = imod(index, `+vn+`) * 2;

      return ivec`+St.length+"("+p+`);
    }
  `}(ze,Ge)}var rt,it,ht,Et,At}(h.logicalShape,ye),H=`
    void setOutput(vec4 val) {
      `+Ee.output+` = val;
    }
  `):(T=function(ze,Ge){switch(ze.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(ht,Et){return Et[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+Et[1]+`.0);
      }
    `:Et[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+Et[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Et[0]+", "+Et[1]+`));
      return resTexRC.x * `+Et[1]+` + resTexRC.y;
    }
  `}(0,Ge);case 2:return function(ht,Et){return fn(ht,Et)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+Et[0]+", "+Et[1]+`));
      }
    `:ht[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+Et[0]+", "+Et[1]+`));
        int index = resTexRC.x * `+Et[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:ht[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+Et[0]+", "+Et[1]+`));
        int index = resTexRC.x * `+Et[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Et[0]+", "+Et[1]+`));
      int index = resTexRC.x * `+Et[1]+` + resTexRC.y;
      int r = index / `+ht[1]+`;
      int c = index - r * `+ht[1]+`;
      return ivec2(r, c);
    }
  `}(ze,Ge);case 3:return rt=Ge,it=Ue(["r","c","d"],ze),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+rt[0]+", "+rt[1]+`));
      int index = resTexRC.x * `+rt[1]+` + resTexRC.y;
      `+it+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(ht,Et){var At=Ue(["r","c","d","d2"],ht);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+Et[0]+", "+Et[1]+`));
      int index = resTexRC.x * `+Et[1]+` + resTexRC.y;
      `+At+`
      return ivec4(r, c, d, d2);
    }
  `}(ze,Ge);case 5:return function(ht,Et){var At=Ue(["r","c","d","d2","d3"],ht);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+Et[0]+`,
                             `+Et[1]+`));

      int index = resTexRC.x * `+Et[1]+` + resTexRC.y;

      `+At+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(ze,Ge);case 6:return function(ht,Et){var At=Ue(["r","c","d","d2","d3","d4"],ht);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+Et[0]+", "+Et[1]+`));
      int index = resTexRC.x * `+Et[1]+` + resTexRC.y;

      `+At+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(ze,Ge);default:throw new Error(ze.length+"-D output sampling is not yet supported")}var rt,it}(h.logicalShape,ye),H=`
    void setOutput(float val) {
      `+Ee.output+` = vec4(val, 0, 0, 0);
    }
  `),d&&(Pe+=Pn),[Pe,je,H,Z,T,ce,u].join(`
`)}var Jt=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,pt=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Nn=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Pn=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Vn(b){return"offset"+b}function rr(b){var h=b.name,u=Qe(b.shapeInfo.logicalShape);return u<2?"return "+h+";":`
    for (int i = 0; i < `+u+`; i++) {
      if (i == index) {
        return `+h+`[i];
      }
    }
  `}function Yn(b){if(b<=1)return"int";if(b===2)return"ivec2";if(b===3)return"ivec3";if(b===4)return"ivec4";if(b===5)return"ivec5";if(b===6)return"ivec6";throw Error("GPU for rank "+b+" is not yet supported")}function br(b,h){var u=JSON.parse(JSON.stringify(b));return u.shapeInfo.logicalShape=h,u}function xr(b,h){return h.map(function(u){return b[u]}).join(", ")}var Lr=function(b,h,u){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ro(h,u),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+b+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Hr="return a + b;",yi="return a - b;",zr="return a * b;",li="return (a < 0.) ? b * a : a;",pi=function(b,h,u){this.variableNames=["A","B"],this.outputShape=Ro(h,u),this.userCode=`
      float binaryOperation(float a, float b) {
        `+b+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},Pi=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,qi=function(b,h,u,d){d===void 0&&(d=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ro(h,u);var x=this.outputShape.length,T="";if(d)if(x===0||Qe(this.outputShape)===1)T=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(T=`
          `+Yn(x)+` coords = getOutputCoords();
        `,x===1)T+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var H=R("coords",x);T+=`
            bool nextRowOutOfBounds =
              (`+H[x-2]+" + 1) >= "+this.outputShape[x-2]+`;
            bool nextColOutOfBounds =
              (`+H[x-1]+" + 1) >= "+this.outputShape[x-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+b+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+T+`

        setOutput(result);
      }
    `},bi=function(){function b(h){this.variableNames=["A"],this.outputShape=h,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return b.prototype.getCustomSetupFunc=function(h,u){var d=this;return function(x,T){d.minLoc==null&&(d.minLoc=x.getUniformLocationNoThrow(T,"minVal"),d.maxLoc=x.getUniformLocationNoThrow(T,"maxVal")),x.gl.uniform1f(d.minLoc,h),x.gl.uniform1f(d.maxLoc,u)}},b}(),Oi=function(){function b(h){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=h,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return b.prototype.getCustomSetupFunc=function(h,u){var d=this;return function(x,T){d.minLoc==null&&(d.minLoc=x.getUniformLocationNoThrow(T,"minVal"),d.maxLoc=x.getUniformLocationNoThrow(T,"maxVal")),x.gl.uniform1f(d.minLoc,h),x.gl.uniform1f(d.maxLoc,u)}},b}();function Vo(b,h,u){var d=b.indexOf(h);return b.map(function(x,T){return T===d?x+" - "+u:x}).join()}var qo=function(b,h,u,d){h===void 0&&(h=!1),u===void 0&&(u=null),d===void 0&&(d=!1),this.variableNames=["x","W"],this.outputShape=b.outShape;var x=b.padInfo.top,T=b.padInfo.left,H=b.strideHeight,Z=b.strideWidth,ce=b.dilationHeight,ye=b.dilationWidth,Ee=b.filterHeight,je=b.filterWidth,Pe=4*Math.floor(b.inChannels/4),ze=b.inChannels%4,Ge=b.dataFormat==="channelsLast",rt=Ge?1:2,it=Ge?2:3,ht=Ge?3:1,Et="",At="";u&&(Et=d?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+u+`
        }`:`
          float activation(float x) {
            `+u+`
          }
        `,At="result = activation(result);");var St=h?"result += getBiasAtOutCoords();":"";h&&this.variableNames.push("bias"),d&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+Et+`

      const ivec2 strides = ivec2(`+H+", "+Z+`);
      const ivec2 pads = ivec2(`+x+", "+T+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+ht+`];

        ivec2 xRCCorner =
            ivec2(coords[`+rt+"], coords["+it+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+Ee+`; wR++) {
          int xR = xRCorner + wR * `+ce+`;

          if (xR < 0 || xR >= `+b.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+je+`; wC++) {
            int xC = xCCorner + wC * `+ye+`;

            if (xC < 0 || xC >= `+b.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+Pe+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+Ge+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(ze===1)+`) {

              if (`+Ge+`) {
                dotProd +=
                    getX(batch, xR, xC, `+Pe+`) *
                    getW(wR, wC, `+Pe+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+Pe+`, xR, xC) *
                    getW(wR, wC, `+Pe+`, d2);
              }

            } else if (`+(ze===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+Pe+`, d2),
                getW(wR, wC, `+Pe+` + 1, d2)
              );

              if (`+Ge+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+Pe+`),
                  getX(batch, xR, xC, `+Pe+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+Pe+`, xR, xC),
                  getX(batch, `+Pe+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(ze===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+Pe+`, d2),
                getW(wR, wC, `+Pe+` + 1, d2),
                getW(wR, wC, `+Pe+` + 2, d2)
              );

              if (`+Ge+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+Pe+`),
                  getX(batch, xR, xC, `+Pe+` + 1),
                  getX(batch, xR, xC, `+Pe+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+Pe+`, xR, xC),
                  getX(batch, `+Pe+` + 1, xR, xC),
                  getX(batch, `+Pe+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+St+`
        `+At+`
        setOutput(result);
      }
    `},Ia=function(b,h,u,d){h===void 0&&(h=!1),u===void 0&&(u=null),d===void 0&&(d=!1),this.variableNames=["x","W"],this.outputShape=b.outShape;var x=b.inHeight,T=b.inWidth,H=b.padInfo.top,Z=b.padInfo.left,ce=b.strideHeight,ye=b.strideWidth,Ee=b.dilationHeight,je=b.dilationWidth,Pe=b.filterHeight,ze=b.filterWidth,Ge=b.outChannels/b.inChannels,rt="",it="";u&&(rt=d?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+u+`
        }`:`
          float activation(float x) {
            `+u+`
          }
        `,it="result = activation(result);");var ht=h?"result += getBiasAtOutCoords();":"";h&&this.variableNames.push("bias"),d&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+rt+`

      const ivec2 strides = ivec2(`+ce+", "+ye+`);
      const ivec2 pads = ivec2(`+H+", "+Z+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+Ge+`;
        int q = d2 - d1 * `+Ge+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+Pe+`; wR++) {
          int xR = xRCorner + wR * `+Ee+`;

          if (xR < 0 || xR >= `+x+`) {
            continue;
          }

          for (int wC = 0; wC < `+ze+`; wC++) {
            int xC = xCCorner + wC * `+je+`;

            if (xC < 0 || xC >= `+T+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+ht+`
        `+it+`
        setOutput(result);
      }
    `},Ao=function(b,h,u,d){h===void 0&&(h=!1),u===void 0&&(u=null),d===void 0&&(d=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=b.outShape;for(var x=b.inHeight,T=b.inWidth,H=b.padInfo.top,Z=b.padInfo.left,ce=b.strideHeight,ye=b.strideWidth,Ee=b.dilationHeight,je=b.dilationWidth,Pe=b.filterHeight,ze=b.filterWidth,Ge=ze,rt="int xR; int xC; int xCOffset;",it=0;it<Pe;it++)for(var ht=0;ht<ze;ht++)rt+=`
          vec4 xTexelR`+it+"C"+2*ht+` = vec4(0.);
          vec4 wR`+it+"C"+ht+` = vec4(0.);
          vec4 xR`+it+"C"+ht+" = vec4(0.);";for(it=0;it<Pe;it++)for(var Et=0;Et<Ge;Et++){if(rt+=`
          xR = xRCorner + `+it*Ee+`;
          xC = xCCorner + `+(ht=2*Et)*je+`;
        `,ye===1){if(ht<ze&&(rt+=Z%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+x+" && xCOffset >= 0 && xCOffset < "+T+`) {
                  xTexelR`+it+"C"+ht+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+T+`) {
                    xTexelR`+it+"C"+ht+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+it+"C"+ht+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+x+" && xCOffset >= 0 && xCOffset < "+T+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+T+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+it+"C"+ht+" = vec4(previous.zw, xTexelR"+it+"C"+ht+`.xy);
                } else {
                  xR`+it+"C"+ht+" = vec4(0, 0, xTexelR"+it+"C"+ht+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+x+" && xC >= 0 && xC < "+T+`) {
                  xTexelR`+it+"C"+ht+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+it+"C"+ht+` = vec4(0.);
                }

                xR`+it+"C"+ht+" = xTexelR"+it+"C"+ht+`;
              `,ht+1<ze)){var At=Z%2==0?Xt(je):je;je%2==0&&Z%2==1||je%2!=0&&Z%2!=1?(rt+=`
                  xCOffset = xC + `+Z%2+" + "+At+`;

                  if(xR >= 0 && xR < `+x+` &&
                    xCOffset >= 0 && xCOffset < `+T+`) {
                    xTexelR`+it+"C"+(ht+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,je>1&&(rt+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+x+` &&
                      xCOffset >= 0 && xCOffset < `+T+`) {
                      xTexelR`+it+"C"+ht+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+it+"C"+ht+` = vec4(0.);
                    }
                  `),rt+=`
                  xR`+it+"C"+(ht+1)+` = vec4(
                    xTexelR`+it+"C"+ht+".zw, xTexelR"+it+"C"+(ht+2)+`.xy);
                `):rt+=`
                  xCOffset = xC + `+At+`;

                  if(xR >= 0 && xR < `+x+` &&
                    xCOffset >= 0 && xCOffset < `+T+`) {
                    xTexelR`+it+"C"+(ht+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+it+"C"+(ht+1)+" = xTexelR"+it+"C"+(ht+2)+`;
                `}}else ht<ze&&(rt+=`
              if(xR >= 0 && xR < `+x+`) {
            `,Z%2==1?(rt+=`
                xCOffset = xC + 1 - `+ye+`;
                if(xCOffset >= 0 && xCOffset < `+T+`) {
                  xTexelR`+it+"C"+ht+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+it+"C"+ht+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+T+`) {
                  xTexelR`+it+"C"+(ht+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+it+"C"+(ht+2)+` = vec4(0.);
                }

                xR`+it+"C"+ht+` = vec4(
                  xTexelR`+it+"C"+ht+".zw, xTexelR"+it+"C"+(ht+2)+`.zw);
              `,ht+1<ze&&(rt+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+ye+`;
                  if(xCOffset >= 0 && xCOffset < `+T+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+it+"C"+(ht+1)+" = vec4(xTexelR"+it+"C"+(ht+2)+`.xy, final.xy);
                `)):(rt+=`
                if(xC >= 0 && xC < `+T+`) {
                  xTexelR`+it+"C"+ht+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+it+"C"+ht+` = vec4(0.);
                }

                xCOffset = xC + `+ye+`;
                if(xCOffset >= 0 && xCOffset < `+T+`) {
                  xTexelR`+it+"C"+(ht+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+it+"C"+(ht+2)+` = vec4(0.);
                }

                xR`+it+"C"+ht+` = vec4(
                  xTexelR`+it+"C"+ht+".xy, xTexelR"+it+"C"+(ht+2)+`.xy);
              `,ht+1<ze&&(rt+=`
                  xR`+it+"C"+(ht+1)+` = vec4(
                    xTexelR`+it+"C"+ht+".zw, xTexelR"+it+"C"+(ht+2)+`.zw);
                `)),rt+="}");ht<ze&&(rt+=`
            vec4 wTexelR`+it+"C"+ht+" = getW("+it+", "+ht+`, d1, q);
            wR`+it+"C"+ht+" = vec4(wTexelR"+it+"C"+ht+".xz, wTexelR"+it+"C"+ht+`.xz);
          `,ht+1<ze&&(rt+=`
              vec4 wTexelR`+it+"C"+(ht+1)+" = getW("+it+", "+(ht+1)+`, d1, q);
              wR`+it+"C"+(ht+1)+` =
                vec4(wTexelR`+it+"C"+(ht+1)+".xz, wTexelR"+it+"C"+(ht+1)+".xz);"))}for(it=0;it<Pe;it++)for(ht=0;ht<ze;ht++)rt+="dotProd += xR"+it+"C"+ht+" * wR"+it+"C"+ht+";";var St="",Gt="";u&&(St=d?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+u+`
        }`:`vec4 activation(vec4 x) {
          `+u+`
        }`,Gt="result = activation(result);");var un=h?"result += getBiasAtOutCoords();":"";h&&this.variableNames.push("bias"),d&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+St+`

      const ivec2 strides = ivec2(`+ce+", "+ye+`);
      const ivec2 pads = ivec2(`+H+", "+Z+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+rt+`

        vec4 result = dotProd;
        `+un+`
        `+Gt+`
        setOutput(result);
      }
    `};function Ho(b,h){if(b===1)return""+h;if(b===2)return h+".y";if(b===3)return h+".z";if(b===4)return h+".w";throw Error("Cumulative sum for rank "+b+" is not yet supported")}var zo=function(){function b(h,u,d){this.variableNames=["x"],this.outputShape=[],this.outputShape=h,this.blockSize=u,this.dataFormat=d,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+u+`;
      int offset_h = imod(h, `+u+`);
      int in_w = w / `+u+`;
      int offset_w = imod(w, `+u+`);
      int offset_d = (offset_h * `+u+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return b.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},b.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},b.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},b.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},b.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},b}(),Sa=function(b,h,u){this.variableNames=["real","imag"];var d=h[1];this.outputShape=h;var x=u?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,T=u?d+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+x+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+b+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+d+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+d+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+T+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},Xa=function(){function b(h,u){this.outputShape=[],this.variableNames=["x"],this.outputShape=h,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return b.prototype.getCustomSetupFunc=function(h){var u=this;return function(d,x){u.valueLoc==null&&(u.valueLoc=d.getUniformLocationNoThrow(x,"value")),d.gl.uniform1f(u.valueLoc,h)}},b}();function Zi(b,h){var u=oe();return So(b,h,u.version+`
    precision highp float;
    `+u.attribute+` vec3 clipSpacePos;
    `+u.attribute+` vec2 uv;
    `+u.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function co(b,h){return kc(b,h,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Jo(b,h){return _c(b,h,new Uint16Array([0,1,2,2,1,3]))}function Pa(b,h,u,d,x,T,H){Ql(u,d);var Z=ws(b,h),ce=b.TEXTURE_2D;return qn(b,h,function(){return b.bindTexture(ce,Z)}),qn(b,h,function(){return b.texParameteri(ce,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE)}),qn(b,h,function(){return b.texParameteri(ce,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE)}),qn(b,h,function(){return b.texParameteri(ce,b.TEXTURE_MIN_FILTER,b.NEAREST)}),qn(b,h,function(){return b.texParameteri(ce,b.TEXTURE_MAG_FILTER,b.NEAREST)}),qn(b,h,function(){return b.texImage2D(ce,0,x,u,d,0,T,H,null)}),qn(b,h,function(){return b.bindTexture(b.TEXTURE_2D,null)}),Z}function ks(b,h,u,d,x){var T=no(u,d);return Pa(b,h,T[0],T[1],x.internalFormatFloat,x.textureFormatFloat,b.FLOAT)}function Qo(b,h,u,d,x){var T=no(u,d);return Pa(b,h,T[0],T[1],x.internalFormatHalfFloat,x.textureFormatFloat,x.textureTypeHalfFloat)}function Wa(b,h,u,d,x){var T=no(u,d);return Pa(b,h,T[0],T[1],b.RGBA,b.RGBA,b.UNSIGNED_BYTE)}function ku(b,h,u,d,x){var T=mi(u,d);return Pa(b,h,T[0],T[1],x.internalFormatPackedFloat,b.RGBA,b.FLOAT)}function Cs(b,h,u,d,x){var T=mi(u,d);return Pa(b,h,T[0],T[1],x.internalFormatPackedHalfFloat,b.RGBA,x.textureTypeHalfFloat)}function fa(b,h,u,d){return qn(b,h,function(){return b.bindBuffer(b.ARRAY_BUFFER,d)}),Mc(b,h,u,"clipSpacePos",d,3,20,0)&&Mc(b,h,u,"uv",d,2,20,12)}function _s(b,h,u,d,x,T,H){var Z,ce,ye;qn(b,h,function(){return b.bindTexture(b.TEXTURE_2D,u)}),T instanceof Uint8Array?(Z=new Uint8Array(d*x*4),ce=b.UNSIGNED_BYTE,ye=b.RGBA):(Z=new Float32Array(d*x*4),ce=b.FLOAT,ye=H.internalFormatPackedFloat),Z.set(T),qn(b,h,function(){return b.texImage2D(b.TEXTURE_2D,0,ye,d,x,0,b.RGBA,ce,Z)}),qn(b,h,function(){return b.bindTexture(b.TEXTURE_2D,null)})}function _l(b,h,u,d){qn(b,h,function(){return b.bindTexture(b.TEXTURE_2D,u)}),d.data instanceof Uint8Array?qn(b,h,function(){return b.texImage2D(b.TEXTURE_2D,0,b.RGBA,d.width,d.height,0,b.RGBA,b.UNSIGNED_BYTE,d.data)}):qn(b,h,function(){return b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,d)}),qn(b,h,function(){return b.bindTexture(b.TEXTURE_2D,null)})}function Js(b,h,u,d,x){var T=b.createBuffer();qn(b,h,function(){return b.bindBuffer(b.PIXEL_PACK_BUFFER,T)});var H=16*u*d;return qn(b,h,function(){return b.bufferData(b.PIXEL_PACK_BUFFER,H,b.STREAM_READ)}),qn(b,h,function(){return b.readPixels(0,0,d,u,b.RGBA,b.FLOAT,0)}),qn(b,h,function(){return b.bindBuffer(b.PIXEL_PACK_BUFFER,null)}),T}function Bs(b,h,u){var d=b,x=new Float32Array(u);return d.bindBuffer(d.PIXEL_PACK_BUFFER,h),d.getBufferSubData(d.PIXEL_PACK_BUFFER,0,x),d.bindBuffer(d.PIXEL_PACK_BUFFER,null),x}function Fa(b,h,u,d,x){var T=no(u,d),H=T[0],Z=T[1],ce=new Uint8Array(u*d*4);return qn(b,h,function(){return b.readPixels(0,0,H,Z,x.downloadTextureFormat,b.UNSIGNED_BYTE,ce)}),new Float32Array(ce.buffer)}function ff(b,h,u,d,x,T,H,Z){var ce=b,ye=new Float32Array(function(Ee,je){var Pe=mi(T,H);return Pe[0]*Pe[1]*4}());return ce.bindBuffer(ce.PIXEL_PACK_BUFFER,h),ce.getBufferSubData(ce.PIXEL_PACK_BUFFER,0,ye),ce.bindBuffer(ce.PIXEL_PACK_BUFFER,null),ye}function _u(b,h,u,d){var x=new Float32Array(u*d*4);return qn(b,h,function(){return b.readPixels(0,0,d,u,b.RGBA,b.FLOAT,x)}),x}var dc=Object.freeze({createVertexShader:Zi,createVertexBuffer:co,createIndexBuffer:Jo,createFloat32MatrixTexture:ks,createFloat16MatrixTexture:Qo,createUnsignedBytesMatrixTexture:Wa,createPackedMatrixTexture:ku,createFloat16PackedMatrixTexture:Cs,bindVertexProgramAttributeStreams:fa,uploadDenseMatrixToTexture:_s,uploadPixelDataToTexture:_l,createBufferFromOutputTexture:Js,downloadFloat32MatrixFromBuffer:Bs,downloadByteEncodedFloatMatrixFromOutputTexture:Fa,downloadPackedMatrixFromBuffer:ff,downloadMatrixFromPackedOutputTexture:_u}),ns=function(){function b(h){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var u=W().getNumber("WEBGL_VERSION");h!=null?(this.gl=h,Do(u,h)):this.gl=Bi(u);var d="WEBGL_color_buffer_float";if(W().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=Oo(this.gl,this.debug,"OES_texture_float"),na(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Oo(this.gl,this.debug,"OES_texture_half_float");else if(W().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(d),na(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Oo(this.gl,this.debug,"EXT_color_buffer_half_float");else if(W().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(d="EXT_color_buffer_float",na(this.gl,d))this.colorBufferFloatExtension=this.gl.getExtension(d);else{if(!na(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=co(this.gl,this.debug),this.indexBuffer=Jo(this.gl,this.debug),this.framebuffer=Hs(this.gl,this.debug),this.textureConfig=ai(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(b.prototype,"debug",{get:function(){return W().getBool("DEBUG")},enumerable:!0,configurable:!0}),b.prototype.dispose=function(){var h=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var u=this.gl;qn(u,this.debug,function(){return u.finish()}),qn(u,this.debug,function(){return u.bindFramebuffer(u.FRAMEBUFFER,null)}),qn(u,this.debug,function(){return u.deleteFramebuffer(h.framebuffer)}),qn(u,this.debug,function(){return u.bindBuffer(u.ARRAY_BUFFER,null)}),qn(u,this.debug,function(){return u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,null)}),qn(u,this.debug,function(){return u.deleteBuffer(h.indexBuffer)}),this.disposed=!0}},b.prototype.createFloat32MatrixTexture=function(h,u){return this.throwIfDisposed(),ks(this.gl,this.debug,h,u,this.textureConfig)},b.prototype.createFloat16MatrixTexture=function(h,u){return this.throwIfDisposed(),Qo(this.gl,this.debug,h,u,this.textureConfig)},b.prototype.createUnsignedBytesMatrixTexture=function(h,u){return this.throwIfDisposed(),Wa(this.gl,this.debug,h,u,this.textureConfig)},b.prototype.uploadPixelDataToTexture=function(h,u){this.throwIfDisposed(),_l(this.gl,this.debug,h,u)},b.prototype.uploadDenseMatrixToTexture=function(h,u,d,x){this.throwIfDisposed(),_s(this.gl,this.debug,h,u,d,x,this.textureConfig)},b.prototype.createFloat16PackedMatrixTexture=function(h,u){return this.throwIfDisposed(),Cs(this.gl,this.debug,h,u,this.textureConfig)},b.prototype.createPackedMatrixTexture=function(h,u){return this.throwIfDisposed(),ku(this.gl,this.debug,h,u,this.textureConfig)},b.prototype.deleteMatrixTexture=function(h){var u=this;this.throwIfDisposed(),this.outputTexture===h&&(Gc(this.gl,this.debug,this.framebuffer),this.outputTexture=null),qn(this.gl,this.debug,function(){return u.gl.deleteTexture(h)})},b.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(h,u,d){var x=this;return this.downloadMatrixDriver(h,function(){return Fa(x.gl,x.debug,u,d,x.textureConfig)})},b.prototype.downloadPackedMatrixFromBuffer=function(h,u,d,x,T,H){return ff(this.gl,h,0,0,0,T,H,this.textureConfig)},b.prototype.downloadFloat32MatrixFromBuffer=function(h,u){return Bs(this.gl,h,u)},b.prototype.createBufferFromTexture=function(h,u,d){this.bindTextureToFrameBuffer(h);var x=Js(this.gl,this.debug,u,d,this.textureConfig);return this.unbindTextureToFrameBuffer(),x},b.prototype.createAndWaitForFence=function(){var h=this.createFence(this.gl);return this.pollFence(h)},b.prototype.createFence=function(h){var u,d,x=this;if(W().getBool("WEBGL_FENCE_API_ENABLED")){var T=h,H=T.fenceSync(T.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),d=function(){var Z=T.clientWaitSync(H,0,0);return Z===T.ALREADY_SIGNALED||Z===T.CONDITION_SATISFIED},u=H}else W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(u=this.beginQuery(),this.endQuery(),d=function(){return x.isQueryAvailable(u,W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):d=function(){return!0};return{query:u,isFencePassed:d}},b.prototype.downloadMatrixFromPackedTexture=function(h,u,d){var x=this;return this.downloadMatrixDriver(h,function(){return _u(x.gl,x.debug,u,d)})},b.prototype.createProgram=function(h){this.throwIfDisposed();var u=this.gl,d=To(u,this.debug,h),x=Zi(u,this.debug),T=eo(u,this.debug);return qn(u,this.debug,function(){return u.attachShader(T,x)}),qn(u,this.debug,function(){return u.attachShader(T,d)}),bu(u,this.debug,T),this.debug&&wc(u,this.debug,T),this.vertexAttrsAreBound||(this.setProgram(T),this.vertexAttrsAreBound=fa(u,this.debug,this.program,this.vertexBuffer)),T},b.prototype.deleteProgram=function(h){var u=this;this.throwIfDisposed(),h===this.program&&(this.program=null),h!=null&&qn(this.gl,this.debug,function(){return u.gl.deleteProgram(h)})},b.prototype.setProgram=function(h){var u=this;this.throwIfDisposed(),this.program=h,this.program!=null&&this.debug&&wc(this.gl,this.debug,this.program),qn(this.gl,this.debug,function(){return u.gl.useProgram(h)})},b.prototype.getUniformLocation=function(h,u,d){return d===void 0&&(d=!0),this.throwIfDisposed(),d?Gs(this.gl,this.debug,h,u):Zl(this.gl,h,u)},b.prototype.getAttributeLocation=function(h,u){var d=this;return this.throwIfDisposed(),qn(this.gl,this.debug,function(){return d.gl.getAttribLocation(h,u)})},b.prototype.getUniformLocationNoThrow=function(h,u){return this.throwIfDisposed(),this.gl.getUniformLocation(h,u)},b.prototype.setInputMatrixTexture=function(h,u,d){this.throwIfDisposed(),this.throwIfNoProgram(),pl(this.gl,this.debug,this.program,h,u,d)},b.prototype.setOutputMatrixTexture=function(h,u,d){this.setOutputMatrixTextureDriver(h,d,u)},b.prototype.setOutputPackedMatrixTexture=function(h,u,d){this.throwIfDisposed();var x=mi(u,d),T=x[0],H=x[1];this.setOutputMatrixTextureDriver(h,T,H)},b.prototype.setOutputMatrixWriteRegion=function(h,u,d,x){this.setOutputMatrixWriteRegionDriver(d,h,x,u)},b.prototype.setOutputPackedMatrixWriteRegion=function(h,u,d,x){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},b.prototype.debugValidate=function(){this.program!=null&&wc(this.gl,this.debug,this.program),ha(this.gl)},b.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var h=this.gl;this.debug&&this.debugValidate(),qn(h,this.debug,function(){return h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0)})},b.prototype.blockUntilAllProgramsCompleted=function(){var h=this;this.throwIfDisposed(),qn(this.gl,this.debug,function(){return h.gl.finish()})},b.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Oo(this.gl,this.debug,W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},b.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},b.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},b.prototype.beginQuery=function(){if(W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var h=this.gl,u=this.getQueryTimerExtensionWebGL2(),d=h.createQuery();return h.beginQuery(u.TIME_ELAPSED_EXT,d),d}var x=this.getQueryTimerExtensionWebGL1(),T=x.createQueryEXT();return x.beginQueryEXT(x.TIME_ELAPSED_EXT,T),T},b.prototype.endQuery=function(){if(W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var h=this.getQueryTimerExtensionWebGL1();h.endQueryEXT(h.TIME_ELAPSED_EXT)}else{var u=this.gl,d=this.getQueryTimerExtensionWebGL2();u.endQuery(d.TIME_ELAPSED_EXT)}},b.prototype.waitForQueryAndGetTime=function(h){return M(this,void 0,void 0,function(){var u=this;return V(this,function(d){switch(d.label){case 0:return[4,Pt(function(){return u.disposed||u.isQueryAvailable(h,W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return d.sent(),[2,this.getQueryTime(h,W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},b.prototype.getQueryTime=function(h,u){if(u===0)return null;if(u===2){var d=this.gl;return d.getQueryParameter(h,d.QUERY_RESULT)/1e6}var x=this.getQueryTimerExtensionWebGL1();return x.getQueryObjectEXT(h,x.QUERY_RESULT_EXT)/1e6},b.prototype.isQueryAvailable=function(h,u){if(u===0)return!0;if(u===2){var d=this.gl,x=this.getQueryTimerExtensionWebGL2(),T=d.getQueryParameter(h,d.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(x.GPU_DISJOINT_EXT)),T&&!this.disjoint}return T=(x=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(h,x.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(x.GPU_DISJOINT_EXT)),T&&!this.disjoint},b.prototype.pollFence=function(h){var u=this;return new Promise(function(d){u.addItemToPoll(function(){return h.isFencePassed()},function(){return d()})})},b.prototype.pollItems=function(){for(var h=function(d){for(var x=0;x<d.length&&d[x]();++x);return x-1}(this.itemsToPoll.map(function(d){return d.isDoneFn})),u=0;u<=h;++u)(0,this.itemsToPoll[u].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(h+1)},b.prototype.addItemToPoll=function(h,u){var d=this;this.itemsToPoll.push({isDoneFn:h,resolveFn:u}),this.itemsToPoll.length>1||Pt(function(){return d.pollItems(),d.itemsToPoll.length===0})},b.prototype.bindTextureToFrameBuffer=function(h){this.throwIfDisposed(),ml(this.gl,this.debug,h,this.framebuffer),this.debug&&ha(this.gl)},b.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(ml(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&ha(this.gl)):Gc(this.gl,this.debug,this.framebuffer)},b.prototype.downloadMatrixDriver=function(h,u){this.bindTextureToFrameBuffer(h);var d=u();return this.unbindTextureToFrameBuffer(),d},b.prototype.setOutputMatrixTextureDriver=function(h,u,d){this.throwIfDisposed();var x=this.gl;ml(x,this.debug,h,this.framebuffer),this.debug&&ha(x),this.outputTexture=h,qn(x,this.debug,function(){return x.viewport(0,0,u,d)}),qn(x,this.debug,function(){return x.scissor(0,0,u,d)})},b.prototype.setOutputMatrixWriteRegionDriver=function(h,u,d,x){var T=this;this.throwIfDisposed(),qn(this.gl,this.debug,function(){return T.gl.scissor(h,u,d,x)})},b.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},b.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},b}();function Bu(b,h){if(b.length!==h.length)throw Error("Binary was compiled with "+b.length+" inputs, but was executed with "+h.length+" inputs");b.forEach(function(u,d){var x=u.logicalShape,T=h[d],H=T.shape;if(!fn(x,H))throw Error("Binary was compiled with different shapes than the current args. Shapes "+x+" and "+H+" must match");if(!u.isUniform||!T.isUniform){var Z=u.texShape,ce=T.isUniform?null:T.texData.texShape;if(!fn(Z,ce))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+Z+" and "+ce+" must match")}})}var Da=function(b,h,u,d,x,T,H){u===void 0&&(u=!1),d===void 0&&(d=!1),x===void 0&&(x=!1),T===void 0&&(T=null),H===void 0&&(H=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=h;var Z=u?b[1]:b[2],ce=Math.ceil(Z/2),ye=u?"i * 2, rc.y":"rc.y, i * 2",Ee=d?"rc.z, i * 2":"i * 2, rc.z",je=u?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],Pe=d?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],ze="",Ge="";T&&(ze=H?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+T+`
        }`:`vec4 activation(vec4 x) {
          `+T+`
        }`,Ge="result = activation(result);");var rt=x?"result += getBiasAtOutCoords();":"";x&&this.variableNames.push("bias"),H&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+ze+`

      const float sharedDimension = `+ce+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+ce+`; i++) {
          vec4 a = getMatrixA(rc.x, `+ye+`);
          vec4 b = getMatrixB(rc.x, `+Ee+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+je[0]+" * "+Pe[0]+`);
          result += (`+je[1]+" * "+Pe[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+rt+`

        `+Ge+`

        setOutput(result);
      }
    `},Qu=function(){function b(h,u,d){this.variableNames=["probs"],this.outputShape=[h,d],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(u-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(u-1)+`));
      }
    `}return b.prototype.getCustomSetupFunc=function(h){var u=this;return function(d,x){u.seedLoc==null&&(u.seedLoc=d.getUniformLocation(x,"seed")),d.gl.uniform1f(u.seedLoc,h)}},b}(),Pu=function(b,h,u){if(this.variableNames=["x"],h==="avg"&&u)throw new Error("Cannot compute positions for average pool.");var d=b.filterWidth,x=b.strideHeight,T=b.strideWidth,H=b.dilationHeight,Z=b.dilationWidth,ce=b.effectiveFilterHeight,ye=b.effectiveFilterWidth,Ee=b.padInfo.top,je=b.padInfo.left;this.outputShape=b.outShape;var Pe=h==="avg",ze="0.0";if(Pe||(ze="-1.0 / 1e-20"),u)this.userCode=`
        const ivec2 strides = ivec2(`+x+", "+T+`);
        const ivec2 pads = ivec2(`+Ee+", "+je+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+ce+`;
              wR += `+H+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+b.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+ye+`;
                wC += `+Z+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+b.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+ye+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var Ge=h+"("+h+"("+h+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";h==="avg"&&(Ge="avgValue / count");var rt=4*Math.floor(d/4),it=d%4,ht=`
      if (`+Pe+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+x+", "+T+`);
      const ivec2 pads = ivec2(`+Ee+", "+je+`);
      const float initializationValue = `+ze+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+b.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+ze+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+ce+`;
            wR += `+H+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+b.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+rt+`; wC += 4) {
            int xC = xCCorner + wC * `+Z+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+Z+`, d),
              getValue(batch, xR, xC + 2 * `+Z+`, d),
              getValue(batch, xR, xC + 3 * `+Z+`, d)
            );

            `+ht+`
          }

          int xC = xCCorner + `+rt+`;
          if (`+(it===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+ht+`
          } else if (`+(it===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+Z+`, d),
              initializationValue,
              initializationValue
            );

            `+ht+`
          } else if (`+(it===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+Z+`, d),
              getValue(batch, xR, xC + 2 * `+Z+`, d),
              initializationValue
            );

            `+ht+`
          }
        }
        setOutput(`+Ge+`);
      }
    `}},Zo=function(b,h,u){if(this.variableNames=["x"],h==="avg"&&u)throw new Error("Cannot compute positions for average pool.");var d=b.filterWidth,x=b.strideDepth,T=b.strideHeight,H=b.strideWidth,Z=b.dilationDepth,ce=b.dilationHeight,ye=b.dilationWidth,Ee=b.effectiveFilterDepth,je=b.effectiveFilterHeight,Pe=b.effectiveFilterWidth,ze=b.padInfo.front,Ge=b.padInfo.top,rt=b.padInfo.left;this.outputShape=b.outShape;var it=h==="avg",ht="0.0";if(it||(ht="-1.0 / 1e-20"),u)this.userCode=`
        const ivec3 strides =
            ivec3(`+x+", "+T+", "+H+`);
        const ivec3 pads = ivec3(`+ze+", "+Ge+", "+rt+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+Ee+`;
              wD += `+Z+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+b.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+je+`;
                wR += `+ce+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+b.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+Pe+`;
                  wC += `+ye+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+b.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+je+" * "+Pe+` +
                      wR * `+Pe+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var Et=h+"("+h+"("+h+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";h==="avg"&&(Et="avgValue / count");var At=4*Math.floor(d/4),St=d%4,Gt=`
      if (`+it+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+x+", "+T+", "+H+`);
      const ivec3 pads = ivec3(`+ze+", "+Ge+", "+rt+`);
      const float initializationValue = `+ht+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+b.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+ht+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+Ee+`;
            wD += `+Z+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+b.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+je+`;
            wR += `+ce+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+b.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+At+`; wC += 4) {
              int xC = xCCorner + wC * `+ye+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+ye+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+ye+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+ye+`, ch)
              );

              `+Gt+`
            }

            int xC = xCCorner + `+At+`;
            if (`+(St===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+Gt+`
            } else if (`+(St===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+ye+`, ch),
                initializationValue,
                initializationValue
              );

              `+Gt+`
            } else if (`+(St===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+ye+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+ye+`, ch),
                initializationValue
              );

              `+Gt+`
            }
          }
          setOutput(`+Et+`);
        }
      }
    `}},Lu=function(b,h,u,d,x,T,H){this.variableNames=["updates","indices","defaultValue"],this.outputShape=T;var Z=Yn(x.length),ce=Yn(T.length),ye="";u===1?ye="i":u===2&&(ye="i, j");var Ee="getIndices("+ye+")",je="";d===1?je="i":d===2&&(je="i, coords[1]");var Pe="getUpdates("+je+")",ze=h>1?"strides[j]":"strides";this.userCode=`
        `+Z+" strides = "+Z+"("+x+`);

        void main() {
          `+ce+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+b+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+h+`; j++) {
              int index = round(`+Ee+`);
              flattenedIndex += index * `+ze+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+Pe+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},Qs=function(){function b(h){this.variableNames=["source"],this.outputShape=h,this.rank=h.length;var u,d=Yn(this.rank),x="uniform int start["+this.rank+"];",T=function(H){if(H===1)return"sourceLoc";if(H<=6)return Dc.slice(0,H).map(function(Z){return"sourceLoc."+Z}).join(",");throw Error("Slicing for rank "+H+" is not yet supported")}(this.rank);u=`
        `+d+` sourceLoc;
        `+d+` coords = getOutputCoords();
        `+h.map(function(H,Z){return"sourceLoc."+Dc[Z]+" = start["+Z+"] + coords."+Dc[Z]+";"}).join(`
`)+`
      `,this.userCode=`
      `+x+`
      void main() {
        `+u+`
        setOutput(getSource(`+T+`));
      }
    `}return b.prototype.getCustomSetupFunc=function(h){var u=this;if(h.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+h.length+")");return function(d,x){u.startLoc==null&&(u.startLoc=d.getUniformLocationNoThrow(x,"start"),u.startLoc==null)||d.gl.uniform1iv(u.startLoc,h)}},b}(),Dc=["x","y","z","w","u","v"],Ll=function(){function b(h){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=h,this.rank=h.length;var u=Yn(this.rank),d=R("coords",this.rank),x=R("sourceLoc",this.rank),T=this.rank===1?"sourceLoc":"vec2("+x.slice(-2).join()+")",H="getChannel(getSource("+x.join()+"), "+T+")",Z=`
      result.x = `+H+`;
      if (++`+d[this.rank-1]+" < "+h[this.rank-1]+`) {
        ++`+x[this.rank-1]+`;
        result.y = `+H+`;
        --`+x[this.rank-1]+`;
      }
    `,ce=this.rank===1?"":`
      --`+d[this.rank-1]+`;
      if (++`+d[this.rank-2]+" < "+h[this.rank-2]+`) {
        ++`+x[this.rank-2]+`;
        result.z = `+H+`;
        if (++`+d[this.rank-1]+" < "+h[this.rank-1]+`) {
          ++`+x[this.rank-1]+`;
          result.w = `+H+`;
        }
      }
    `,ye=this.rank<=4?`sourceLoc = coords +
            `+u+"("+h.map(function(Ee,je){return"start["+je+"]"}).join()+");":h.map(function(Ee,je){return x[je]+" = "+d[je]+" + start["+je+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+u+` coords = getOutputCoords();
        `+u+` sourceLoc;
        `+ye+`
        vec4 result = vec4(0.);
        `+Z+`
        `+ce+`
        setOutput(result);
      }
    `}return b.prototype.getCustomSetupFunc=function(h){var u=this;if(h.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+h.length+")");return function(d,x){u.startLoc==null&&(u.startLoc=d.getUniformLocationNoThrow(x,"start"),u.startLoc==null)||d.gl.uniform1iv(u.startLoc,h)}},b}(),Va=function(){function b(h){this.gpgpu=h,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return b.prototype.acquireTexture=function(h,u,d){var x,T=hu(u,d),H=Ps(h,T,d);if(H in this.freeTextures||(this.freeTextures[H]=[]),H in this.usedTextures||(this.usedTextures[H]=[]),this.freeTextures[H].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var Z=this.freeTextures[H].shift();return this.usedTextures[H].push(Z),Z}return this.numUsedTextures++,this.log(),T===ui.PACKED_2X2_FLOAT32?x=this.gpgpu.createPackedMatrixTexture(h[0],h[1]):T===ui.PACKED_2X2_FLOAT16?x=this.gpgpu.createFloat16PackedMatrixTexture(h[0],h[1]):T===ui.UNPACKED_FLOAT32?x=this.gpgpu.createFloat32MatrixTexture(h[0],h[1]):T===ui.UNPACKED_FLOAT16?x=this.gpgpu.createFloat16MatrixTexture(h[0],h[1]):T===ui.PACKED_4X1_UNSIGNED_BYTE&&(x=this.gpgpu.createUnsignedBytesMatrixTexture(h[0],h[1])),this.usedTextures[H].push(x),x},b.prototype.releaseTexture=function(h,u,d,x){if(this.freeTextures!=null){var T=Ps(u,hu(d,x),x);T in this.freeTextures||(this.freeTextures[T]=[]),this.freeTextures[T].push(h),this.numFreeTextures++,this.numUsedTextures--;var H=this.usedTextures[T],Z=H.indexOf(h);if(Z<0)throw new Error("Cannot release a texture that was never provided by this texture manager");H.splice(Z,1),this.log()}},b.prototype.log=function(){if(this.logEnabled){var h=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+h+")")}},b.prototype.getNumUsedTextures=function(){return this.numUsedTextures},b.prototype.getNumFreeTextures=function(){return this.numFreeTextures},b.prototype.dispose=function(){var h=this;if(this.freeTextures!=null){for(var u in this.freeTextures)this.freeTextures[u].forEach(function(d){h.gpgpu.deleteMatrixTexture(d)});for(var u in this.usedTextures)this.usedTextures[u].forEach(function(x){h.gpgpu.deleteMatrixTexture(x)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},b}();function hu(b,h){if(b===kr.UPLOAD)return ui.PACKED_2X2_FLOAT32;if(b===kr.RENDER||b==null)return function(u){return W().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?u?ui.PACKED_2X2_FLOAT32:ui.UNPACKED_FLOAT32:u?ui.PACKED_2X2_FLOAT16:ui.UNPACKED_FLOAT16}(h);if(b===kr.DOWNLOAD||b===kr.PIXELS)return ui.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+b)}function Ps(b,h,u){return b[0]+"_"+b[1]+"_"+h+"_"+u}var rl=1.7580993408473768,ah=1.0507009873554805,Wi=function(b,h){this.variableNames=["A"],this.outputShape=b,this.userCode=`
      float unaryOperation(float x) {
        `+h+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},rp="if (isnan(x)) return x;",sh="return x;",uh="return abs(x);",s0=rp+`
  return (x < 0.0) ? 0.0 : x;
`,Bm=rp+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Pm="return (x >= 0.0) ? x : (exp(x) - 1.0);",Kp="return -x;",u0="return ceil(x);",Xp="return floor(x);",sa="return exp(x);",Ad="return exp(x) - 1.0;",Yp="return x;",ip="return x;",Tg=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,c0=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Nf=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Zu=function(b,h){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=b,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+h+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},Jp={};function op(b,h){if(h===void 0&&(h=!1),b==="linear")return h?ip:sh;if(b==="relu")return h?Tg:s0;if(b==="elu")return h?Nf:Pm;if(b==="relu6")return h?c0:Bm;if(b==="prelu")return h?Pi:li;throw new Error("Activation "+b+" has not been implemented for the WebGL backend.")}var Qp=600,l0=function(b){function h(u){var d,x=b.call(this)||this;if(x.pendingRead=new WeakMap,x.pendingDisposal=new WeakSet,x.dataRefCount=new WeakMap,x.numBytesInGPU=0,x.uploadWaitMs=0,x.downloadWaitMs=0,x.warnedAboutMemory=!1,x.pendingDeletes=0,x.disposed=!1,!W().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(u==null){var T=Bi(W().getNumber("WEBGL_VERSION"));x.binaryCache=((d=W().getNumber("WEBGL_VERSION"))in Jp||(Jp[d]={}),Jp[d]),x.gpgpu=new ns(T),x.canvas=T.canvas,x.gpgpuCreatedLocally=!0}else x.gpgpu=u,x.binaryCache={},x.gpgpuCreatedLocally=!1,x.canvas=u.gl.canvas;return x.textureManager=new Va(x.gpgpu),x.numMBBeforeWarning=W().global.screen==null?1024:W().global.screen.height*W().global.screen.width*window.devicePixelRatio*Qp/1024/1024,x.texData=new cf(x,He),x}return K(h,b),h.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},h.prototype.write=function(u,d,x){if(W().getBool("DEBUG")&&this.checkNumericalProblems(u),x==="complex64"&&u!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var T={};return this.texData.set(T,{shape:d,dtype:x,values:u,usage:kr.UPLOAD}),T},h.prototype.move=function(u,d,x,T){if(W().getBool("DEBUG")&&this.checkNumericalProblems(d),T==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(u,{shape:x,dtype:T,values:d,usage:kr.UPLOAD})},h.prototype.readSync=function(u){var d=this.texData.get(u),x=d.values,T=d.dtype,H=d.complexTensors,Z=d.slice,ce=d.shape,ye=d.isPacked;if(Z!=null){var Ee;Ee=ye?new Zu(ce,Yp):new Wi(ce,Yp);var je=this.runWebGLProgram(Ee,[{dataId:u,shape:ce,dtype:T}],T),Pe=this.readSync(je.dataId);return this.disposeData(je.dataId),Pe}if(x!=null)return this.convertAndCacheOnCPU(u);if(T==="string")return x;var ze,Ge,rt=this.activeTimers!=null;return rt&&(ze=an()),Ge=T==="complex64"?xl(H.real.dataSync(),H.imag.dataSync()):this.getValuesFromTexture(u),rt&&(this.downloadWaitMs+=an()-ze),this.convertAndCacheOnCPU(u,Ge)},h.prototype.read=function(u){return M(this,void 0,void 0,function(){var d,x,T,H,Z,ce,ye,Ee,je,Pe,ze,Ge,rt,it,ht,Et,At,St,Gt,un,vn,cn;return V(this,function(kn){switch(kn.label){case 0:if(this.pendingRead.has(u))return d=this.pendingRead.get(u),[2,new Promise(function(On){return d.push(On)})];if(x=this.texData.get(u),T=x.values,H=x.shape,Z=x.slice,ce=x.dtype,ye=x.complexTensors,Ee=x.isPacked,Z!=null)return je=void 0,je=Ee?new Zu(H,Yp):new Wi(H,Yp),Pe=this.runWebGLProgram(je,[{dataId:u,shape:H,dtype:ce}],ce),ze=this.read(Pe.dataId),this.disposeData(Pe.dataId),[2,ze];if(T!=null)return[2,this.convertAndCacheOnCPU(u)];if(!W().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&W().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return Ge=null,ce!=="complex64"&&W().get("WEBGL_BUFFER_SUPPORTED")&&(rt=this.decode(u),it=this.texData.get(rt.dataId),Ge=(cn=this.gpgpu).createBufferFromTexture.apply(cn,[it.texture].concat($i(H)))),this.pendingRead.set(u,[]),ce==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:kn.sent(),kn.label=2;case 2:return ce!=="complex64"?[3,4]:[4,Promise.all([ye.real.data(),ye.imag.data()])];case 3:return Et=kn.sent(),At=Et[0],St=Et[1],ht=xl(At,St),[3,5];case 4:Ge==null?ht=this.getValuesFromTexture(u):(Gt=Qe(H),ht=this.gpgpu.downloadFloat32MatrixFromBuffer(Ge,Gt)),kn.label=5;case 5:return rt!=null&&this.disposeData(rt.dataId),un=this.convertAndCacheOnCPU(u,ht),vn=this.pendingRead.get(u),this.pendingRead.delete(u),vn.forEach(function(On){return On(un)}),this.pendingDisposal.has(u)&&(this.pendingDisposal.delete(u),this.disposeData(u),this.pendingDeletes--),[2,un]}})})},h.prototype.checkNumericalProblems=function(u){if(u!=null)for(var d=0;d<u.length;d++){var x=u[d];if(!Zr(x))throw W().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+x+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+x+" cannot be represented on this device.")}},h.prototype.getValuesFromTexture=function(u){var d,x=this.texData.get(u),T=x.shape,H=x.dtype,Z=x.isPacked,ce=Qe(T);if(W().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var ye=this.decode(u),Ee=this.texData.get(ye.dataId),je=(d=this.gpgpu).downloadMatrixFromPackedTexture.apply(d,[Ee.texture].concat($i(T))).subarray(0,ce);return this.disposeData(ye.dataId),je}var Pe=W().getBool("WEBGL_PACK")&&Z===!0,ze=Pe?jc(T):T,Ge=Pe?new function(Et){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=kr.DOWNLOAD;var At=oe();this.outputShape=Et,this.userCode=`
      `+vt+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+At.output+` = encode_float(x);
      }
    `}(ze):new function(Et){this.variableNames=["A"],this.outTexUsage=kr.DOWNLOAD;var At=oe();this.outputShape=Et,this.userCode=`
      `+vt+`

      void main() {
        float x = getAAtOutCoords();
        `+At.output+` = encode_float(x);
      }
    `}(ze),rt=this.runWebGLProgram(Ge,[{shape:ze,dtype:H,dataId:u}],"float32"),it=this.texData.get(rt.dataId),ht=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(it.texture,it.texShape[0],it.texShape[1]).subarray(0,ce);return this.disposeData(rt.dataId),ht},h.prototype.time=function(u){return M(this,void 0,void 0,function(){var d,x,T,H,Z,ce,ye;return V(this,function(Ee){switch(Ee.label){case 0:return d=this.activeTimers,x=[],T=!1,this.programTimersStack==null?(this.programTimersStack=x,T=!0):this.activeTimers.push(x),this.activeTimers=x,u(),H=Ut(this.activeTimers.map(function(je){return je.query})).filter(function(je){return je!=null}),Z=Ut(this.activeTimers.map(function(je){return je.name})).filter(function(je){return je!=null}),this.activeTimers=d,T&&(this.programTimersStack=null),ce={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(H)]:[3,2];case 1:return ye=Ee.sent(),ce.kernelMs=tn(ye),ce.getExtraProfileInfo=function(){return ye.map(function(je,Pe){return{name:Z[Pe],ms:je}}).map(function(je){return je.name+": "+je.ms}).join(", ")},[3,3];case 2:ce.kernelMs={error:"WebGL query timers are not supported in this environment."},Ee.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,ce]}})})},h.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},h.prototype.startTimer=function(){return W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:an(),endMs:null}},h.prototype.endTimer=function(u){return W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),u):(u.endMs=an(),u)},h.prototype.getQueryTime=function(u){return M(this,void 0,void 0,function(){var d;return V(this,function(x){return W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(u)]:[2,(d=u).endMs-d.startMs]})})},h.prototype.disposeData=function(u){if(!this.pendingDisposal.has(u)){if(this.pendingRead.has(u))return this.pendingDisposal.add(u),void this.pendingDeletes++;if(this.texData.has(u)){this.releaseGPUData(u);var d=this.texData.get(u).complexTensors;d!=null&&(d.real.dispose(),d.imag.dispose()),this.texData.delete(u)}}},h.prototype.releaseGPUData=function(u){var d=this.texData.get(u),x=d.texture,T=d.dtype,H=d.texShape,Z=d.usage,ce=d.isPacked,ye=d.slice,Ee=ye&&ye.origDataId||u,je=this.dataRefCount.get(Ee);je>1?this.dataRefCount.set(Ee,je-1):(this.dataRefCount.delete(Ee),x!=null&&(this.numBytesInGPU-=this.computeBytes(H,T),this.textureManager.releaseTexture(x,H,Z,ce)));var Pe=this.texData.get(u);Pe.texture=null,Pe.texShape=null,Pe.isPacked=!1,Pe.slice=null},h.prototype.getTexture=function(u){return this.uploadToGPU(u),this.texData.get(u).texture},h.prototype.getDataInfo=function(u){return this.texData.get(u)},h.prototype.getCPUBackend=function(){return W().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=He.findBackend("cpu")),this.cpuBackend):null},h.prototype.shouldExecuteOnCPU=function(u,d){var x=this;return d===void 0&&(d=128),this.getCPUBackend()!=null&&u.every(function(T){return x.texData.get(T.dataId).texture==null&&T.size<d})},h.prototype.getGPGPUContext=function(){return this.gpgpu},h.prototype.complex=function(u,d){var x=this.makeOutput(u.shape,"complex64");return this.texData.get(x.dataId).complexTensors={real:He.keep(u.clone()),imag:He.keep(d.clone())},x},h.prototype.real=function(u){return this.texData.get(u.dataId).complexTensors.real.clone()},h.prototype.imag=function(u){return this.texData.get(u.dataId).complexTensors.imag.clone()},h.prototype.slice=function(u,d,x){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.slice(u,d,x);if(Qe(x)===0)return la([],x,u.dtype);var T=this.texData.get(u.dataId).isPacked,H=Ss(u.shape,d,x);if(T||!H){var Z=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ll(x):new Qs(x),ce=Z.getCustomSetupFunc(d);return this.compileAndRun(Z,[u],null,ce)}return this.uploadToGPU(u.dataId),this.shallowSlice(u,d,x)},h.prototype.shallowSlice=function(u,d,x){var T=this.texData.get(u.dataId),H=this.makeOutput(x,u.dtype),Z=this.texData.get(H.dataId);Object.assign(Z,T),Z.shape=x,Z.dtype=u.dtype;var ce=lu(d,u.strides);T.slice&&(ce+=T.slice.flatOffset),Z.slice={flatOffset:ce,origDataId:T.slice&&T.slice.origDataId||u.dataId};var ye=this.dataRefCount.get(Z.slice.origDataId)||1;return this.dataRefCount.set(Z.slice.origDataId,ye+1),H},h.prototype.stridedSlice=function(u,d,x,T){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.stridedSlice(u,d,x,T);var H=nh(d,x,T);if(H.some(function(ce){return ce===0}))return la([],H);var Z=new function(ce,ye,Ee){this.variableNames=["x"],this.outputShape=Ee;var je=Ee.length,Pe=Yn(Ee.length),ze=Yn(Ee.length),Ge="";if(je===1)Ge="coords * strides + begin";else{var rt=0;Ge=Ee.map(function(it,ht){return rt++,Ee.length===1?"coords * strides["+ht+"] + begin["+ht+"]":"coords["+(rt-1)+"] * strides["+ht+"] + begin["+ht+"]"}).join(",")}this.userCode=`
      `+Pe+" begin = "+Pe+"("+ce+`);
      `+Pe+" strides = "+Pe+"("+ye+`);

      void main() {
        `+ze+` coords = getOutputCoords();
        setOutput(getX(`+Ge+`));
      }
    `}(d,T,H);return this.compileAndRun(Z,[u])},h.prototype.reverse=function(u,d){var x=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(T,H){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var Z=T.length;if(Z>4)throw new Error("WebGL backend: Reverse of rank-"+Z+" tensor is not yet supported");this.outputShape=T;var ce=R("rc",Z),ye=ce[Z-1]+" + 1 < "+this.outputShape[Z-1],Ee=ce[Z-2]+" + 1 < "+this.outputShape[Z-2],je=Yn(Z);function Pe(ze){var Ge=T.map(function(rt,it){return function(ht,Et){return H.indexOf(ht)!==-1&&T[ht]!==1?T[ht]+" - "+Et[ht]+" - 1":""+Et[ht]}(it,ze)});return"getChannel(getX("+Ge.join(",")+"), vec2("+Ge.slice(-2).join(",")+"))"}this.userCode=Z===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+T[0]+` - rc - 1),
            `+T[0]+` - rc - 1);
          if(`+ye+`){
              result.g = getChannel(getX(`+T[0]+` - (rc  + 1) - 1),
                `+T[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+je+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+Pe(ce.slice())+`;
          if(`+ye+`){
            result.g = `+function(ze){return ze[Z-1]="("+ze[Z-1]+" + 1)",Pe(ze)}(ce.slice())+`;
          }
          if(`+Ee+`) {
            result.b = `+function(ze){return ze[Z-2]="("+ze[Z-2]+" + 1)",Pe(ze)}(ce.slice())+`;
            if(`+ye+`) {
              result.a = `+function(ze){return ze[Z-1]="("+ze[Z-1]+" + 1)",ze[Z-2]="("+ze[Z-2]+" + 1)",Pe(ze)}(ce.slice())+`;
            }
          }
          setOutput(result);
        }
    `}(u.shape,d):new function(T,H){this.variableNames=["x"];var Z=T.length;if(Z>4)throw new Error("WebGL backend: Reverse of rank-"+Z+" tensor is not yet supported");if(this.outputShape=T,Z!==1){var ce=T.map(function(Ee,je){return function(Pe){return H.indexOf(Pe)!==-1&&T[Pe]!==1?T[Pe]+" - coords["+Pe+"] - 1":"coords["+Pe+"]"}(je)}).join(","),ye=Yn(Z);this.userCode=`
      void main() {
        `+ye+` coords = getOutputCoords();
        setOutput(getX(`+ce+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+T[0]+` - coord - 1));
        }
      `}(u.shape,d);return this.compileAndRun(x,[u])},h.prototype.concat=function(u,d){if(u[0].dtype==="complex64"){var x=u.map(function(ze){return ms(ze)}),T=u.map(function(ze){return Ks(ze)});return aa(this.concat(x,d),this.concat(T,d))}if(this.shouldExecuteOnCPU(u))return this.cpuBackend.concat(u,d);if(u.length===1)return u[0];if(u.length>W().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var H=Math.floor(u.length/2),Z=this.concat(u.slice(0,H),d),ce=this.concat(u.slice(H),d);return this.concat([Z,ce],d)}if(W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&u[0].rank>1){var ye=new function(ze,Ge){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Ku(ze,Ge);var rt=this.outputShape,it=rt.length,ht=Yn(it),Et=R("coords",it),At=["x","y","z","w","u","v"].slice(0,it);this.variableNames=ze.map(function(a,l){return"T"+l});var St=new Array(ze.length-1);St[0]=ze[0][Ge];for(var Gt=1;Gt<St.length;Gt++)St[Gt]=St[Gt-1]+ze[Gt][Ge];var un=At[Ge],vn=At.slice(-2),cn=At.join(),kn="if ("+un+" < "+St[0]+`) {
        return getChannel(
            getT0(`+cn+"), vec2("+vn.join()+`));
        }`;for(Gt=1;Gt<St.length;Gt++){var On=St[Gt-1];kn+=`
        if (`+un+" < "+St[Gt]+"  && "+un+" >= "+St[Gt-1]+`) {
          return getChannel(
            getT`+Gt+"("+Vo(At,un,On)+`),
            vec2(`+Vo(vn,un,On)+`));
        }`}var p=St.length,c=St[St.length-1];kn+=`
        return getChannel(
          getT`+p+"("+Vo(At,un,c)+`),
          vec2(`+Vo(vn,un,c)+"));",this.userCode=`
      float getValue(`+At.map(function(a){return"int "+a})+`) {
        `+kn+`
      }

      void main() {
        `+ht+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+Et+`), 0., 0., 0.);

        `+Et[it-1]+" = "+Et[it-1]+` + 1;
        if (`+Et[it-1]+" < "+rt[it-1]+`) {
          result.g = getValue(`+Et+`);
        }

        `+Et[it-2]+" = "+Et[it-2]+` + 1;
        if (`+Et[it-2]+" < "+rt[it-2]+`) {
          result.a = getValue(`+Et+`);
        }

        `+Et[it-1]+" = "+Et[it-1]+` - 1;
        if (`+Et[it-2]+" < "+rt[it-2]+` &&
            `+Et[it-1]+" < "+rt[it-1]+`) {
          result.b = getValue(`+Et+`);
        }
        setOutput(result);
      }
    `}(u.map(function(ze){return ze.shape}),d);return this.compileAndRun(ye,u)}var Ee=Ku(u.map(function(ze){return ze.shape}),d),je=u.map(function(ze){return ze.as2D(-1,Qe(ze.shape.slice(d)))}),Pe=new function(ze){this.outputShape=[],this.outputShape=Ku(ze,1),this.variableNames=ze.map(function(St,Gt){return"T"+Gt});var Ge=new Array(ze.length-1);Ge[0]=ze[0][1];for(var rt=1;rt<Ge.length;rt++)Ge[rt]=Ge[rt-1]+ze[rt][1];var it=["if (yC < "+Ge[0]+") setOutput(getT0(yR, yC));"];for(rt=1;rt<Ge.length;rt++){var ht=Ge[rt-1];it.push("else if (yC < "+Ge[rt]+") setOutput(getT"+rt+"(yR, yC-"+ht+"));")}var Et=Ge.length,At=Ge[Ge.length-1];it.push("else setOutput(getT"+Et+"(yR, yC-"+At+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+it.join(`
        `)+`
      }
    `}(je.map(function(ze){return ze.shape}));return this.compileAndRun(Pe,je).reshape(Ee)},h.prototype.neg=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.neg(u);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,Kp,u.dtype);var d=new Wi(u.shape,Kp);return this.compileAndRun(d,[u])},h.prototype.batchMatMul=function(u,d,x,T){var H=x?u.shape[2]:u.shape[1],Z=T?d.shape[1]:d.shape[2],ce=x?u.shape[1]:u.shape[2],ye=u.shape[0];if((H===1||Z===1)&&ce>1e3){x&&(u=u.transpose([0,2,1])),T&&(d=d.transpose([0,2,1]));var Ee=Z===1?u:u.as3D(ye,ce,1),je=Z===1?2:1,Pe=Z===1?d.as3D(ye,1,ce):d;return this.multiply(Ee,Pe).sum(je,!0)}var ze=yn(u.dtype,d.dtype),Ge=new Da(u.shape,[ye,H,Z],x,T);return this.compileAndRun(Ge,[u,d],ze)},h.prototype.fusedBatchMatMul=function(u){var d=u.a,x=u.b,T=u.transposeA,H=u.transposeB,Z=u.bias,ce=u.activation,ye=u.preluActivationWeights,Ee=T?d.shape[2]:d.shape[1],je=H?x.shape[1]:x.shape[2],Pe=d.shape[0],ze=yn(d.dtype,x.dtype),Ge=Z!=null,rt=ye!=null,it=ce?op(ce,!0):null,ht=new Da(d.shape,[Pe,Ee,je],T,H,Ge,it,rt),Et=[d,x];return Z&&Et.push(Z),ye&&Et.push(ye),this.compileAndRun(ht,Et,ze)},h.prototype.multiply=function(u,d){if(u.dtype==="complex64"){var x=this.texData.get(u.dataId),T=this.texData.get(d.dataId),H=new Lr("return areal * breal - aimag * bimag;",u.shape,d.shape),Z=new Lr("return areal * bimag + aimag * breal;",u.shape,d.shape),ce=[this.makeComplexComponentTensorInfo(u,x.complexTensors.real),this.makeComplexComponentTensorInfo(u,x.complexTensors.imag),this.makeComplexComponentTensorInfo(d,T.complexTensors.real),this.makeComplexComponentTensorInfo(d,T.complexTensors.imag)],ye=this.compileAndRun(H,ce),Ee=this.compileAndRun(Z,ce),je=this.complex(ye,Ee);return ye.dispose(),Ee.dispose(),je}if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.multiply(u,d);if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,zr,u.dtype);var Pe=new pi(zr,u.shape,d.shape);return this.compileAndRun(Pe,[u,d],u.dtype)},h.prototype.batchNormalization=function(u,d,x,T,H,Z){var ce=[u,d,x],ye=null;Z!=null&&(ye=Z.shape,ce.push(Z));var Ee=null;if(H!=null&&(Ee=H.shape,ce.push(H)),W().getBool("WEBGL_PACK_NORMALIZATION")){var je=new function(ze,Ge,rt,it,ht,Et){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ro(ze,Ge),Ro(ze,rt);var At="vec4(0.0)";it!=null&&(Ro(ze,it),this.variableNames.push("offset"),At="getOffsetAtOutCoords()");var St="vec4(1.0)";ht!=null&&(Ro(ze,ht),this.variableNames.push("scale"),St="getScaleAtOutCoords()"),this.outputShape=ze,this.userCode=`
      void main() {
        vec4 offset = `+At+`;
        vec4 scale = `+St+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+Et+`));

        setOutput((x - mean) * inv + offset);
      }
    `}(u.shape,d.shape,x.shape,ye,Ee,T);return this.compileAndRun(je,ce)}var Pe=new function(ze,Ge,rt,it,ht,Et){this.outputShape=[],this.variableNames=["x","mean","variance"],Ro(ze,Ge),Ro(ze,rt);var At="0.0";it!=null&&(Ro(ze,it),this.variableNames.push("offset"),At="getOffsetAtOutCoords()");var St="1.0";ht!=null&&(Ro(ze,ht),this.variableNames.push("scale"),St="getScaleAtOutCoords()"),this.outputShape=ze,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+At+`;
        float scale = `+St+`;
        float inv = scale * inversesqrt(variance + float(`+Et+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}(u.shape,d.shape,x.shape,ye,Ee,T);return this.compileAndRun(Pe,ce)},h.prototype.localResponseNormalization4D=function(u,d,x,T,H){var Z=W().getBool("WEBGL_PACK_NORMALIZATION")?new function(ce,ye,Ee,je,Pe){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var ze,Ge=ye,rt=ce[3]-1;this.outputShape=ce;var it="float("+Ee+") + float("+je+") * sum";ze=Pe===.5?"inversesqrt("+it+")":Pe===1?"1.0/("+it+")":"exp(log("+it+") * float(-"+Pe+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+Ge+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+Ge+"; j <= "+Ge+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+rt+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+ze+`;
        setOutput(result);
      }
    `}(u.shape,d,x,T,H):new function(ce,ye,Ee,je,Pe){this.variableNames=["x"],this.outputShape=[];var ze,Ge=ye,rt=ce[3]-1;this.outputShape=ce;var it="float("+Ee+") + float("+je+") * sum";ze=Pe===.5?"inversesqrt("+it+")":Pe===1?"1.0/("+it+")":"exp(log("+it+") * float(-"+Pe+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+Ge+"; j <= "+Ge+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+rt+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+ze+`;
        setOutput(val);
      }
    `}(u.shape,d,x,T,H);return this.compileAndRun(Z,[u])},h.prototype.LRNGrad=function(u,d,x,T,H,Z,ce){var ye=new function(Ee,je,Pe,ze,Ge){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=Ee,this.depth=Ee[3],this.depthRadius=je,this.bias=Pe,this.alpha=ze,this.beta=Ge,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+je+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+je+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+ze+") * norm + float("+Pe+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+ze+`)
                * float(`+Ge+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+Ge+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}(d.shape,T,H,Z,ce);return this.compileAndRun(ye,[d,x,u])},h.prototype.tile=function(u,d){if(u.dtype==="string"){var x=this.readSync(u.dataId).map(function(H){return Fr(H)});return Cd(wo(u.shape,u.dtype,x),d)}var T=new function(H,Z){this.variableNames=["A"];for(var ce=new Array(H.length),ye=0;ye<ce.length;ye++)ce[ye]=H[ye]*Z[ye];this.outputShape=ce,this.rank=ce.length;var Ee=Yn(this.rank),je=function(Pe){var ze=Pe.length;if(ze>5)throw Error("Tile for rank "+ze+" is not yet supported");if(ze===1)return"imod(resRC, "+Pe[0]+")";for(var Ge=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],rt=[],it=0;it<Pe.length;it++)rt.push("imod("+Ge[it]+", "+Pe[it]+")");return rt.join()}(H);this.userCode=`
      void main() {
        `+Ee+` resRC = getOutputCoords();
        setOutput(getA(`+je+`));
      }
    `}(u.shape,d);return this.compileAndRun(T,[u])},h.prototype.pad=function(u,d,x){var T=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(H,Z,ce){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Z.map(function(un,vn){return un[0]+H[vn]+un[1]});for(var ye=H.length,Ee=Yn(ye),je=Z.map(function(un){return un[0]}).join(","),Pe=Z.map(function(un,vn){return un[0]+H[vn]}).join(","),ze=R("rc",ye),Ge=R("source",ye),rt=ze[ye-1]+" < "+this.outputShape[ye-1],it=ye===1?"source":"vec2("+Ge.slice(-2).join()+")",ht=[Ee+" rc = outputLoc;",ze[ye-1]+` += 1;
       if(`+rt+`) {
      `,ye===1?"":`}
       rc = outputLoc;
       `+ze[ye-2]+` += 1;
       if(`+ze[ye-2]+" < "+this.outputShape[ye-2]+") {",ye===1?"":"  "+ze[ye-1]+` += 1;
         if(`+rt+") {"],Et=ye===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",At="",St=0,Gt=ye===1?2:4;St<Gt;St++)At+=`
        `+ht[St]+`
        if (`+Et+`) {
          result[`+St+"] = float("+ce+`);
        } else {
          `+Ee+` source = rc - start;
          result[`+St+"] = getChannel(getX("+Ge.join()+"), "+it+`);
        }
      `;At+=ye===1?"} ":"}}",this.userCode=`
      const `+Ee+" start = "+Ee+"("+je+`);
      const `+Ee+" end = "+Ee+"("+Pe+`);

      void main() {
        `+Ee+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+At+`
        setOutput(result);
      }
    `}(u.shape,d,x):new function(H,Z,ce){this.variableNames=["x"],this.outputShape=Z.map(function(Ge,rt){return Ge[0]+H[rt]+Ge[1]});var ye=H.length,Ee=Yn(ye),je=Z.map(function(Ge){return Ge[0]}).join(","),Pe=Z.map(function(Ge,rt){return Ge[0]+H[rt]}).join(","),ze=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,ye);this.userCode=ye!==1?`
      `+Ee+" start = "+Ee+"("+je+`);
      `+Ee+" end = "+Ee+"("+Pe+`);

      void main() {
        `+Ee+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+ce+`));
        } else {
          `+Ee+` coords = outC - start;
          setOutput(getX(`+ze+`));
        }
      }
    `:`
        int start = `+je+`;
        int end = `+Pe+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+ce+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}(u.shape,d,x);return this.compileAndRun(T,[u])},h.prototype.transpose=function(u,d){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.transpose(u,d);var x=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(T,H){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var Z=new Array(T.length),ce=0;ce<Z.length;ce++)Z[ce]=T[H[ce]];if(this.outputShape=Z,this.rank=Z.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var ye=Yn(this.rank),Ee=C("rc",this.rank),je=new Array(this.rank);for(ce=0;ce<H.length;ce++)je[H[ce]]=Ee[ce];var Pe="vec2("+je.slice(-2).join()+")",ze="++"+Ee[this.rank-1]+" < "+Z[this.rank-1],Ge="getChannel(getA("+je.join()+"), "+Pe+")";this.userCode=`
    void main() {
      `+ye+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+Ge+`;
      if(`+ze+`) {
        result[1] = `+Ge+`;
      }
      --`+Ee[this.rank-1]+`;
      if(++`+Ee[this.rank-2]+" < "+Z[this.rank-2]+`) {
        result[2] = `+Ge+`;
        if(`+ze+`) {
          result[3] = `+Ge+`;
        }
      }
      setOutput(result);
    }
    `}(u.shape,d):new function(T,H){this.variableNames=["A"];for(var Z=new Array(T.length),ce=0;ce<Z.length;ce++)Z[ce]=T[H[ce]];this.outputShape=Z,this.rank=Z.length;var ye=Yn(this.rank),Ee=function(je){var Pe=je.length;if(Pe>6)throw Error("Transpose for rank "+Pe+" is not yet supported");for(var ze=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],Ge=new Array(Pe),rt=0;rt<je.length;rt++)Ge[je[rt]]=ze[rt];return Ge.join()}(H);this.userCode=`
    void main() {
      `+ye+` resRC = getOutputCoords();
      setOutput(getA(`+Ee+`));
    }
    `}(u.shape,d);return this.compileAndRun(x,[u])},h.prototype.gather=function(u,d,x){if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.gather(u,d,x);var T=new function(H,Z,ce){this.variableNames=["A","indices"];var ye=H.slice();ye[ce]=Z,this.outputShape=ye,this.rank=ye.length;var Ee=Yn(this.rank),je=function(Pe,ze){var Ge=Pe.length;if(Ge>4)throw Error("Gather for rank "+Ge+" is not yet supported");if(Ge===1)return"int(getIndices(resRC))";for(var rt=["resRC.x","resRC.y","resRC.z","resRC.w"],it=[],ht=0;ht<Pe.length;ht++)ht===ze?it.push("int(getIndices("+rt[ht]+"))"):it.push(""+rt[ht]);return it.join()}(H,ce);this.userCode=`
      void main() {
        `+Ee+` resRC = getOutputCoords();
        setOutput(getA(`+je+`));
      }
    `}(u.shape,d.size,x);return this.compileAndRun(T,[u,d])},h.prototype.batchToSpaceND=function(u,d,x){Ce(u.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var T=d.reduce(function(je,Pe){return je*Pe}),H=Pc(u.shape,d,T),Z=Bh(H.length,d.length),ce=Ph(u.shape,d,T),ye=Rl(x,d.length),Ee=ep(ce,x,d.length);return u.reshape(H).transpose(Z).reshape(ce).slice(ye,Ee)},h.prototype.spaceToBatchND=function(u,d,x){Ce(u.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var T=d.reduce(function(Pe,ze){return Pe*ze}),H=[[0,0]];H.push.apply(H,x);for(var Z=1+d.length;Z<u.shape.length;++Z)H.push([0,0]);var ce=u.pad(H),ye=Pc(ce.shape,d,T,!1),Ee=Bh(ye.length,d.length,!1),je=Ph(ce.shape,d,T,!1);return ce.reshape(ye).transpose(Ee).reshape(je)},h.prototype.reduce=function(u,d,x){var T=u.shape[0],H=u.shape[1],Z=new function(ye,Ee){this.variableNames=["x"];var je=ye.windowSize,Pe=ye.batchSize,ze=ye.inSize,Ge=Math.ceil(ze/je);this.outputShape=[Pe,Ge];var rt="0.0",it="";Ee==="prod"?rt="1.0":Ee==="min"?(rt="1.0 / 1e-20",it="min"):Ee==="max"&&(rt="-1.0 / 1e-20",it="max");var ht=Ee+"("+Ee+"("+Ee+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";Ee==="sum"?ht="sumValue":Ee==="prod"?ht="prodValue":Ee==="all"?ht="allValue":Ee==="any"&&(ht="anyValue");var Et=4*Math.floor(je/4),At=je%4,St=`
      if (`+(Ee==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(Ee==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+it+`(values, minMaxValue);
      }
    `,Gt="vec4";Ee==="all"?(rt="1.0",St=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,Gt="bvec4"):Ee==="any"&&(rt="0.0",St=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,Gt="bvec4");var un="";ze%je>0&&(un=`
        if (inIdx < 0 || inIdx >= `+ze+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+rt+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+un+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+je+`;

        vec4 minMaxValue = vec4(`+rt+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+Et+`; i += 4) {
          int inIdx = inOffset + i;
          `+Gt+" values = "+Gt+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+St+`
        }

        int inIdx = inOffset + `+Et+`;
        if (`+(At===1)+`) {
          `+Gt+" values = "+Gt+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+St+`
        } else if (`+(At===2)+`) {
          `+Gt+" values = "+Gt+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+St+`
        } else if (`+(At===3)+`) {
          `+Gt+" values = "+Gt+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+St+`
        }
        setOutput(`+ht+`);
      }
    `}({windowSize:zh(H),inSize:H,batchSize:T},d),ce=this.compileAndRun(Z,[u],x);return ce.shape[1]===1?ce:this.reduce(ce,d,x)},h.prototype.argReduce=function(u,d,x){x===void 0&&(x=null);var T=u.shape[0],H=u.shape[1];x!=null&&(T=x.shape[0],H=x.shape[1]);var Z=new function(Ee,je,Pe){this.variableNames=["A"];var ze=Ee.windowSize,Ge=Ee.batchSize,rt=Ee.inSize,it=Math.ceil(rt/ze);Pe||this.variableNames.push("bestIndicesA"),this.outputShape=[Ge,it];var ht=je==="max"?">":"<",Et=Pe?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+ze+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+ze+`; i++) {
          int inIdx = `+Et+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+ht+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}({windowSize:zh(H),inSize:H,batchSize:T},d,x==null),ce=[u];x!=null&&ce.push(x);var ye=this.compileAndRun(Z,ce,"int32");return ye.shape[1]===1?ye:this.argReduce(u,d,ye)},h.prototype.argReducePacked=function(u,d,x){x===void 0&&(x=null);var T=x!=null?x.shape:u.shape,H=new function(ye,Ee,je,Pe){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Ce(ye.length>2,function(){return"Packed arg"+(je.charAt(0).toUpperCase()+je.slice(1))+" supports only inputs with rank above 2."});var ze=ye[ye.length-1],Ge=Math.ceil(ze/Ee);this.outputShape=ye.slice(0,-1),Ge>1&&this.outputShape.push(Ge),Pe||this.variableNames.push("bestIndicesA");var rt,it,ht=this.outputShape,Et=ht.length,At=Yn(Et),St=R("coords",Et);if(Ge===1){var Gt=Yn(it=Et+1);rt=`
        `+Gt+" sourceLocR = "+Gt+"("+St.join()+`, 0);
        ++`+St[Et-1]+`;
        `+Gt+" sourceLocG = "+Gt+"("+St.join()+`, 0);
        ++`+St[Et-2]+`;
        `+Gt+" sourceLocA = "+Gt+"("+St.join()+`, 0);
        --`+St[Et-1]+`;
        `+Gt+" sourceLocB = "+Gt+"("+St.join()+`, 0);
        --`+St[Et-2]+";"}else it=Et,rt=`
        `+At+` sourceLocR = coords;
        ++`+St[Et-1]+`;
        `+At+` sourceLocG = coords;
        ++`+St[Et-2]+`;
        `+At+` sourceLocA = coords;
        --`+St[Et-1]+`;
        `+At+` sourceLocB = coords;
        --`+St[Et-2]+";";var un=["x","y","z","w","u","v"].slice(0,it),vn="."+un[it-1],cn=un.map(function(U){return"int "+U}),kn=R("sourceLocR",it-1).concat("inIdx.r"),On=R("sourceLocG",it-1).concat("inIdx.g"),p=R("sourceLocB",it-1).concat("inIdx.b"),c=R("sourceLocA",it-1).concat("inIdx.a"),a=je==="max"?"greaterThan":"lessThan",l=Pe?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+kn.join()+`),
                             getBestIndicesAChannel(`+On.join()+`),
                             getBestIndicesAChannel(`+p.join()+`),
                             getBestIndicesAChannel(`+c.join()+")));",y=`vec4(
            getAChannel(`+kn.join()+`),
            hasNextCol ? getAChannel(`+On.join()+`) : 0.,
            hasNextRow ? getAChannel(`+p.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+c.join()+") : 0.)",S=Pe?"":`
      float getBestIndicesAChannel(`+cn.join()+`) {
        return getChannel(getBestIndicesA(`+un.join()+`),
                                          vec2(`+un.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+cn.join()+`) {
        return getChannel(getA(`+un.join()+`),
                               vec2(`+un.slice(-2).join()+`));
      }
      `+S+`
      void main() {
        `+At+` coords = getOutputCoords();
        bool hasNextCol = `+St[Et-1]+" < "+(ht[Et-1]-1)+`;
        bool hasNextRow = `+St[Et-2]+" < "+(ht[Et-2]-1)+`;
        `+rt+`
        ivec4 srcIdx = ivec4(sourceLocR`+vn+", sourceLocG"+vn+`,
          sourceLocB`+vn+", sourceLocA"+vn+") * "+Ee+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+y+`;

        for (int i = 0; i < `+Ee+`; i++) {
          inIdx = srcIdx;
          `+l+`
          vec4 candidate = `+y+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+a+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}(T,zh(T[T.length-1]),d,x==null),Z=x==null?[u]:[u,x],ce=this.compileAndRun(H,Z,"int32");return ce.rank===u.rank?this.argReducePacked(u,d,ce):ce},h.prototype.sum=function(u,d){La("sum",d,u.rank);var x=pa(u.shape,d),T=x[0],H=Qe(x[1]),Z=u.as2D(-1,H),ce=dr(u.dtype);return this.reduce(Z,"sum",ce).reshape(T)},h.prototype.prod=function(u,d){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.prod(u,d);var x=pa(u.shape,d),T=x[0],H=Qe(x[1]),Z=u.as2D(-1,H),ce=dr(u.dtype);return this.reduce(Z,"prod",ce).reshape(T)},h.prototype.unsortedSegmentSum=function(u,d,x){var T=0,H=Fs([T],u.rank),Z=u;H!=null&&(Z=u.transpose(H),T=Rs(1,u.rank)[0]);var ce=function(ze,Ge,rt){for(var it=[],ht=ze.length,Et=0;Et<ht;Et++)Et!==Ge?it.push(ze[Et]):it.push(rt);return it}(Z.shape,T,x),ye=Qe([Z.shape[T]]),Ee=Z.as2D(-1,ye),je=dr(u.dtype),Pe=this.segOpCompute(Ee,"unsortedSegmentSum",d,je,x).reshape(ce);return H!=null&&(Pe=Pe.transpose(vl(H))),Pe},h.prototype.segOpCompute=function(u,d,x,T,H){var Z=u.shape[0],ce=u.shape[1],ye=function(Pe,ze){var Ge,rt=!1;for(Pe<=Lh?(Ge=Pe,rt=!0):Ge=Rr(Pe,Math.floor(Math.sqrt(Pe)));!rt;)Ge>ze||Ge===Pe?rt=!0:Ge=Rr(Pe,Ge+1);return Ge}(ce,H),Ee=new function(Pe,ze){this.variableNames=["x","segmentIds"];var Ge=Pe.windowSize,rt=Pe.batchSize,it=Pe.inSize,ht=Pe.numSegments,Et=ht*Math.ceil(it/Ge);this.outputShape=[rt,Et];var At=4*Math.floor(Ge/4),St=Ge%4,Gt=`
        sumValue += dot(values, segFilter);
    `,un="";it%Ge>0&&(un=`
        if (inIdx < 0 || inIdx >= `+it+`) {
          return initializationValue;
        }
      `);var vn="";it%Ge>0&&(vn=`
        if (inIdx < 0 || inIdx >= `+it+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+un+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+vn+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+ht+")) * float("+Ge+`));
        int currentSeg = int(mod(float(outIdx), float(`+ht+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+At+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+Gt+`
        }

        int inIdx = inOffset + `+At+`;
        if (`+(St===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+Gt+`
        } else if (`+(St===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+Gt+`
        } else if (`+(St===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+Gt+`
        }
        setOutput(sumValue);
      }
    `}({windowSize:ye,inSize:ce,batchSize:Z,numSegments:H}),je=this.compileAndRun(Ee,[u,x],T);return je.shape[1]===H?je:(x=rf(0,H).tile([ce/ye]),this.segOpCompute(je,d,x,T,H))},h.prototype.argMinMaxReduce=function(u,d,x){var T=[d];if(La("arg"+x.charAt(0).toUpperCase()+x.slice(1),T,u.rank),!W().getBool("WEBGL_PACK_REDUCE")||u.rank<=2){var H=pa(u.shape,T),Z=H[0],ce=Qe(H[1]),ye=u.as2D(-1,ce);return this.argReduce(ye,x).reshape(Z)}return this.argReducePacked(u,x)},h.prototype.argMin=function(u,d){return this.argMinMaxReduce(u,d,"min")},h.prototype.argMax=function(u,d){return this.argMinMaxReduce(u,d,"max")},h.prototype.cumsum=function(u,d,x,T){if(d!==u.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(u.rank-1)+" but got axis="+d);var H=new function(Z,ce,ye){this.variableNames=["x"],this.outputShape=Z;var Ee=Z.length,je=Z[Z.length-1],Pe=ye?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(ye?"return "+je+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Yn(Ee)+` coords = getOutputCoords();
        int end = `+Ho(Ee,"coords")+`;
        float val = 0.0;
        for (int i = `+je+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+Pe+` end) {
            continue;
          }
          if (idx == end && `+ce+`) {
            continue;
          }
          `+Ho(Ee,"coords")+` = idx;
          val += getX(`+function(ze,Ge){if(ze===1)return""+Ge;if(ze===2)return Ge+".x, "+Ge+".y";if(ze===3)return Ge+".x, "+Ge+".y, "+Ge+".z";if(ze===4)return Ge+".x, "+Ge+".y, "+Ge+".z, "+Ge+".w";throw Error("Cumulative sum for rank "+ze+" is not yet supported")}(Ee,"coords")+`);
        }
        setOutput(val);
      }
    `}(u.shape,x,T);return this.compileAndRun(H,[u])},h.prototype.equal=function(u,d){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(equal(a, b));
`,"bool");var x=new pi("return float(a == b);",u.shape,d.shape);return this.compileAndRun(x,[u,d],"bool")},h.prototype.notEqual=function(u,d){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(notEqual(a, b));
`,"bool");var x=new pi("return float(a != b);",u.shape,d.shape);return this.compileAndRun(x,[u,d],"bool")},h.prototype.less=function(u,d){if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.less(u,d);if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(lessThan(a, b));
`,"bool");var x=new pi("return float(a < b);",u.shape,d.shape);return this.compileAndRun(x,[u,d],"bool")},h.prototype.lessEqual=function(u,d){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(lessThanEqual(a, b));
`,"bool");var x=new pi("return float(a <= b);",u.shape,d.shape);return this.compileAndRun(x,[u,d],"bool")},h.prototype.greater=function(u,d){if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.greater(u,d);if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(greaterThan(a, b));
`,"bool");var x=new pi("return float(a > b);",u.shape,d.shape);return this.compileAndRun(x,[u,d],"bool")},h.prototype.greaterEqual=function(u,d){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var x=new pi("return float(a >= b);",u.shape,d.shape);return this.compileAndRun(x,[u,d],"bool")},h.prototype.logicalNot=function(u){var d=new Wi(u.shape,"return float(!(x >= 1.0));");return this.compileAndRun(d,[u])},h.prototype.logicalAnd=function(u,d){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var x=new pi("return float(a >= 1.0 && b >= 1.0);",u.shape,d.shape);return this.compileAndRun(x,[u,d],"bool")},h.prototype.logicalOr=function(u,d){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var x=new pi("return float(a >= 1.0 || b >= 1.0);",u.shape,d.shape);return this.compileAndRun(x,[u,d],"bool")},h.prototype.select=function(u,d,x){var T=new function(H,Z,ce){var ye,Ee;if(this.variableNames=["c","a","b"],this.outputShape=Z,ce>4)throw Error("Where for rank "+ce+" is not yet supported");if(ce===1)Ee="resRC",ye="resRC";else{for(var je=["resRC.x","resRC.y","resRC.z","resRC.w"],Pe=[],ze=[],Ge=0;Ge<Z.length;Ge++)ze.push(""+je[Ge]),Ge<H&&Pe.push(""+je[Ge]);ye=Pe.join(),Ee=ze.join()}var rt=Yn(ce);this.userCode=`
      void main() {
        `+rt+` resRC = getOutputCoords();
        float cVal = getC(`+ye+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+Ee+`));
        } else {
          setOutput(getB(`+Ee+`));
        }
      }
    `}(u.rank,d.shape,d.rank);return this.compileAndRun(T,[u,d,x],yn(d.dtype,x.dtype))},h.prototype.where=function(u){Jf("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var d=u.dataSync();return Q(u.shape,d)},h.prototype.topk=function(u,d,x){return re(u.dataSync(),u.shape,u.dtype,d)},h.prototype.min=function(u,d){La("min",d,u.rank);var x=pa(u.shape,d),T=x[0],H=Qe(x[1]),Z=u.as2D(-1,H);return this.reduce(Z,"min",Z.dtype).reshape(T)},h.prototype.minimum=function(u,d){if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.minimum(u,d);var x=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new qi(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,u.shape,d.shape):new pi(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,u.shape,d.shape);return this.compileAndRun(x,[u,d])},h.prototype.mod=function(u,d){var x=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new qi(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,u.shape,d.shape):new pi(`if (b == 0.0) return NAN;
  return mod(a, b);`,u.shape,d.shape);return this.compileAndRun(x,[u,d])},h.prototype.max=function(u,d){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.max(u,d);La("max",d,u.rank);var x=pa(u.shape,d),T=x[0],H=Qe(x[1]),Z=u.as2D(-1,H);return this.reduce(Z,"max",Z.dtype).reshape(T)},h.prototype.maximum=function(u,d){if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.maximum(u,d);var x=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new qi(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,u.shape,d.shape):new pi(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,u.shape,d.shape);return this.compileAndRun(x,[u,d])},h.prototype.all=function(u,d){La("all",d,u.rank);var x=pa(u.shape,d),T=x[0],H=Qe(x[1]),Z=u.as2D(-1,H);return this.reduce(Z,"all",Z.dtype).reshape(T)},h.prototype.any=function(u,d){La("any",d,u.rank);var x=pa(u.shape,d),T=x[0],H=Qe(x[1]),Z=u.as2D(-1,H);return this.reduce(Z,"any",Z.dtype).reshape(T)},h.prototype.realDivide=function(u,d){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var x=new pi(`
if (a == b) {
  return 1.0;
};
return a / b;`,u.shape,d.shape);return this.compileAndRun(x,[u,d],"float32")},h.prototype.floorDiv=function(u,d){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var x=new pi(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,u.shape,d.shape);return this.compileAndRun(x,[u,d],"int32")},h.prototype.add=function(u,d){if(u.dtype==="complex64"&&d.dtype==="complex64")return this.complexSeparableBinaryOp(u,d,Hr);if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.add(u,d);var x=yn(u.dtype,d.dtype);if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,Hr,x);var T=new pi(Hr,u.shape,d.shape);return this.compileAndRun(T,[u,d],x)},h.prototype.packedUnaryOp=function(u,d,x){var T=new Zu(u.shape,d);return this.compileAndRun(T,[u],x)},h.prototype.packedBinaryOp=function(u,d,x,T,H){H===void 0&&(H=!1);var Z=new qi(x,u.shape,d.shape,H);return this.compileAndRun(Z,[u,d],T)},h.prototype.complexSeparableBinaryOp=function(u,d,x){var T=this,H=this.texData.get(u.dataId),Z=this.texData.get(d.dataId),ce=[[H.complexTensors.real,Z.complexTensors.real],[H.complexTensors.imag,Z.complexTensors.imag]].map(function(Pe){var ze=Pe[0],Ge=Pe[1],rt=T.makeComplexComponentTensorInfo(u,ze),it=T.makeComplexComponentTensorInfo(d,Ge),ht=new pi(x,u.shape,d.shape);return T.compileAndRun(ht,[rt,it],yn(ze.dtype,Ge.dtype))}),ye=ce[0],Ee=ce[1],je=this.complex(ye,Ee);return ye.dispose(),Ee.dispose(),je},h.prototype.makeComplexComponentTensorInfo=function(u,d){return{dataId:d.dataId,dtype:d.dtype,shape:u.shape}},h.prototype.addN=function(u){if(u.length===1)return u[0];if(u.length>W().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var d=Math.floor(u.length/2),x=this.addN(u.slice(0,d)),T=this.addN(u.slice(d));return this.addN([x,T])}var H=u.map(function(ye){return ye.dtype}).reduce(function(ye,Ee){return yn(ye,Ee)}),Z=u.map(function(ye){return ye.shape}),ce=W().getBool("WEBGL_PACK")?new function(ye,Ee){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ye,this.variableNames=Ee.map(function(ze,Ge){return"T"+Ge});var je=[];this.variableNames.forEach(function(ze){je.push("vec4 v"+ze+" = get"+ze+"AtOutCoords();")});var Pe=this.variableNames.map(function(ze){return"v"+ze}).join(" + ");this.userCode=`
      void main() {
        `+je.join(`
        `)+`

        vec4 result = `+Pe+`;
        setOutput(result);
      }
    `}(u[0].shape,Z):new function(ye,Ee){this.outputShape=[],this.outputShape=ye,this.variableNames=Ee.map(function(ze,Ge){return"T"+Ge});var je=[];this.variableNames.forEach(function(ze){je.push("float v"+ze+" = get"+ze+"AtOutCoords();")});var Pe=this.variableNames.map(function(ze){return"v"+ze}).join(" + ");this.userCode=`
      void main() {
        `+je.join(`
        `)+`

        float result = `+Pe+`;
        setOutput(result);
      }
    `}(u[0].shape,Z);return this.compileAndRun(ce,u,H)},h.prototype.subtract=function(u,d){if(u.dtype==="complex64"&&d.dtype==="complex64")return this.complexSeparableBinaryOp(u,d,yi);if(this.shouldExecuteOnCPU([u,d]))return this.cpuBackend.subtract(u,d);var x=yn(u.dtype,d.dtype);if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(u,d,yi,u.dtype);var T=new pi(yi,u.shape,d.shape);return this.compileAndRun(T,[u,d],x)},h.prototype.pow=function(u,d){var x=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new qi(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,u.shape,d.shape):new pi(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,u.shape,d.shape),T=yn(u.dtype,d.dtype);return this.compileAndRun(x,[u,d],T)},h.prototype.ceil=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.ceil(u);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,u0,u.dtype);var d=new Wi(u.shape,u0);return this.compileAndRun(d,[u])},h.prototype.floor=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.floor(u);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,Xp,u.dtype);var d=new Wi(u.shape,Xp);return this.compileAndRun(d,[u])},h.prototype.sign=function(u){var d=new Wi(u.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(d,[u])},h.prototype.isNaN=function(u){var d=new Wi(u.shape,"return float(isnan(x));");return this.compileAndRun(d,[u],"bool")},h.prototype.isInf=function(u){var d=new Wi(u.shape,"return float(isinf(x));");return this.compileAndRun(d,[u],"bool")},h.prototype.isFinite=function(u){var d=new Wi(u.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(d,[u],"bool")},h.prototype.round=function(u){var d=new Wi(u.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(d,[u])},h.prototype.exp=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.exp(u);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,sa,u.dtype);var d=new Wi(u.shape,sa);return this.compileAndRun(d,[u])},h.prototype.expm1=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.expm1(u);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,Ad,u.dtype);var d=new Wi(u.shape,Ad);return this.compileAndRun(d,[u])},h.prototype.softmax=function(u,d){var x=Tn([d],u.shape),T=this.max(u,x),H=Ea(T.shape,x),Z=this.subtract(u,T.reshape(H)),ce=this.exp(Z),ye=this.sum(ce,x).reshape(H);return this.realDivide(ce,ye)},h.prototype.log=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.log(u);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,u.dtype);var d=new Wi(u.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(d,[u])},h.prototype.log1p=function(u){var d=new Wi(u.shape,"return log(1.0 + x);");return this.compileAndRun(d,[u])},h.prototype.sqrt=function(u){var d=new Wi(u.shape,"return sqrt(x);");return this.compileAndRun(d,[u])},h.prototype.rsqrt=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.rsqrt(u);var d=new Wi(u.shape,"return inversesqrt(x);");return this.compileAndRun(d,[u])},h.prototype.reciprocal=function(u){var d=new Wi(u.shape,"return 1.0 / x;");return this.compileAndRun(d,[u])},h.prototype.relu=function(u){var d;return d=W().getBool("WEBGL_PACK")?new Zu(u.shape,Tg):new Wi(u.shape,s0),this.compileAndRun(d,[u])},h.prototype.relu6=function(u){var d;return d=W().getBool("WEBGL_PACK")?new Zu(u.shape,c0):new Wi(u.shape,Bm),this.compileAndRun(d,[u])},h.prototype.prelu=function(u,d){var x=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new qi(Pi,u.shape,d.shape):new pi(li,u.shape,d.shape);return this.compileAndRun(x,[u,d])},h.prototype.elu=function(u){if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,Nf,u.dtype);var d=new Wi(u.shape,Pm);return this.compileAndRun(d,[u])},h.prototype.eluDer=function(u,d){var x=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new qi(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,u.shape,d.shape):new pi("return (b >= 1.0) ? a : a * (b + 1.0);",u.shape,d.shape);return this.compileAndRun(x,[u,d])},h.prototype.selu=function(u){var d=new Wi(u.shape,`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = 1.7580993408473768;
  float scale = 1.0507009873554805;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`);return this.compileAndRun(d,[u])},h.prototype.int=function(u){var d=new Wi(u.shape,"return float(int(x));");return this.compileAndRun(d,[u],"int32")},h.prototype.clip=function(u,d,x){var T,H=(T=W().getBool("WEBGL_PACK_CLIP")?new Oi(u.shape):new bi(u.shape)).getCustomSetupFunc(d,x);return this.compileAndRun(T,[u],null,H)},h.prototype.abs=function(u){if(this.shouldExecuteOnCPU([u]))return this.cpuBackend.abs(u);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(u,uh,u.dtype);var d=new Wi(u.shape,uh);return this.compileAndRun(d,[u])},h.prototype.complexAbs=function(u){var d=this.texData.get(u.dataId),x=new function(H){this.variableNames=["real","imag"],this.outputShape=H,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}(u.shape),T=[this.makeComplexComponentTensorInfo(u,d.complexTensors.real),this.makeComplexComponentTensorInfo(u,d.complexTensors.imag)];return this.compileAndRun(x,T)},h.prototype.sigmoid=function(u){var d=new Wi(u.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(d,[u])},h.prototype.softplus=function(u){var d=new Wi(u.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(d,[u])},h.prototype.sin=function(u){var d=new Wi(u.shape,`if (isnan(x)) return x;
  return sin(x);
`);return this.compileAndRun(d,[u])},h.prototype.cos=function(u){var d=new Wi(u.shape,`if (isnan(x)) return x;
  return cos(x);
`);return this.compileAndRun(d,[u])},h.prototype.tan=function(u){var d=new Wi(u.shape,"return tan(x);");return this.compileAndRun(d,[u])},h.prototype.asin=function(u){var d=new Wi(u.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`);return this.compileAndRun(d,[u])},h.prototype.acos=function(u){var d=new Wi(u.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`);return this.compileAndRun(d,[u])},h.prototype.atan=function(u){var d=new Wi(u.shape,`if (isnan(x)) return x;
  return atan(x);
`);return this.compileAndRun(d,[u])},h.prototype.atan2=function(u,d){var x=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new qi(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,u.shape,d.shape):new pi(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,u.shape,d.shape);return this.compileAndRun(x,[u,d])},h.prototype.sinh=function(u){var d=new Wi(u.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(d,[u])},h.prototype.cosh=function(u){var d=new Wi(u.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(d,[u])},h.prototype.tanh=function(u){var d=new Wi(u.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(d,[u])},h.prototype.asinh=function(u){var d=new Wi(u.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(d,[u])},h.prototype.acosh=function(u){var d=new Wi(u.shape,`if (isnan(x)) return x;
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`);return this.compileAndRun(d,[u])},h.prototype.atanh=function(u){var d=new Wi(u.shape,`if (isnan(x)) return x;
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`);return this.compileAndRun(d,[u])},h.prototype.erf=function(u){var d=new Wi(u.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(d,[u])},h.prototype.step=function(u,d){var x=new Wi(u.shape,function(T){return T===void 0&&(T=0),rp+`
    return x > 0.0 ? 1.0 : float(`+T+`);
  `}(d));return this.compileAndRun(x,[u])},h.prototype.conv2dByMatMul=function(u,d,x,T,H,Z){var ce=u.shape,ye=this.texData.get(u.dataId),Ee=x.inChannels,je=ce[0]*ce[1]*ce[2],Pe=x.outChannels,ze=x.dataFormat==="channelsLast",Ge=(je===1||Pe===1)&&Ee>1e3,rt=ce[2]%2!=0&&!!ye.isPacked;if(Ge||!W().getBool("WEBGL_LAZILY_UNPACK")||!W().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!rt){var it=ze?ce[0]*ce[1]*ce[2]:ce[0]*ce[2]*ce[3],ht=this.reshape(u,[1,it,x.inChannels]),Et=this.reshape(d,[1,x.inChannels,x.outChannels]);return this.reshape(this.fusedBatchMatMul({a:ht,b:Et,transposeA:!1,transposeB:!1,bias:T,activation:H,preluActivationWeights:Z}),x.outShape)}var At=ze?ce[0]*ce[1]*(ce[2]+1):ce[0]*ce[2]*(ce[3]+1),St={dataId:u.dataId,shape:[1,At,x.inChannels],dtype:u.dtype},Gt=ye.shape;ye.shape=ye.shape.slice(),ye.shape[ye.shape.length-2]++,Ce(eu(ye.shape,St.shape),function(){return"packed reshape "+ye.shape+" to "+St.shape+" isn't free"});var un=this.reshape(d,[1,x.inChannels,x.outChannels]),vn=this.fusedBatchMatMul({a:St,b:un,transposeA:!1,transposeB:!1,bias:T,activation:H,preluActivationWeights:Z}),cn=this.texData.get(vn.dataId);return Ce(cn.isPacked,function(){return"batchMatMul result is expected to be packed"}),ye.shape=Gt,cn.shape=x.outShape,He.makeTensorFromDataId(vn.dataId,x.outShape,vn.dtype)},h.prototype.conv2dWithIm2Row=function(u,d,x,T,H,Z){var ce=x.filterWidth,ye=x.filterHeight,Ee=x.inChannels,je=x.outWidth,Pe=x.outHeight,ze=x.dataFormat==="channelsLast",Ge=ce*ye*Ee,rt=Pe*je,it=[Ge,rt],ht=u.squeeze([0]),Et=d.reshape([1,Ge,-1]),At=new function(p,c,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=p;for(var l=a.filterWidth,y=a.inChannels,S=a.strideWidth,U=a.strideHeight,G=a.padInfo,ae=a.outWidth,le=a.dilationWidth,be=a.dilationHeight,Se=a.dataFormat,Ie=G.left,Me=G.top,qe=y*l,Ye=oe(),Xe=Se==="channelsLast",at=Xe?0:1,gt=Xe?1:2,bt="",_t=0;_t<=1;_t++)for(var jt=0;jt<=1;jt++)bt+=`
          blockIndex = rc.y + `+jt+`;
          pos = rc.x + `+_t+`;

          if(blockIndex < `+p[1]+" && pos < "+p[0]+`) {
            offsetY = int(blockIndex / (`+ae+")) * "+U+" - "+Me+`;
            d0 = offsetY + `+be+" * (pos / "+qe+`);

            if(d0 < `+c[at]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+ae+".) * "+S+". - "+Ie+`.);
              d1 = offsetX + `+le+" * (int(mod(float(pos), "+qe+".) / "+y+`.));

              if(d1 < `+c[gt]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+y+`.));

                if (`+Xe+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*_t+jt)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*_t+jt)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+bt+`

        `+Ye.output+` = result;
      }
    `}(it,ht.shape,x),St=this.compileAndRun(At,[ht]).reshape([1,it[0],it[1]]),Gt=T!=null,un=Z!=null,vn=H?op(H,!0):null,cn=new Da(St.shape,[1,rt,x.outChannels],!0,!1,Gt,vn,un),kn=[St,Et];T&&kn.push(T),un&&kn.push(Z);var On=this.compileAndRun(cn,kn);return ze?On.reshape([1,Pe,je,x.outChannels]):On.reshape([1,x.outChannels,Pe,je])},h.prototype.fusedConv2d=function(u){var d=u.input,x=u.filter,T=u.convInfo,H=u.bias,Z=u.activation,ce=u.preluActivationWeights;if(T.filterHeight===1&&T.filterWidth===1&&T.dilationHeight===1&&T.dilationWidth===1&&T.strideHeight===1&&T.strideWidth===1&&(T.padInfo.type==="SAME"||T.padInfo.type==="VALID"))return this.conv2dByMatMul(d,x,T,H,Z,ce);if(W().getBool("WEBGL_CONV_IM2COL")&&d.shape[0]===1)return this.conv2dWithIm2Row(d,x,T,H,Z,ce);var ye=H!=null,Ee=ce!=null,je=Z?op(Z,!1):null,Pe=new qo(T,ye,je,Ee),ze=[d,x];return H&&ze.push(H),ce&&ze.push(ce),this.compileAndRun(Pe,ze)},h.prototype.conv2d=function(u,d,x){if(x.filterHeight===1&&x.filterWidth===1&&x.dilationHeight===1&&x.dilationWidth===1&&x.strideHeight===1&&x.strideWidth===1&&(x.padInfo.type==="SAME"||x.padInfo.type==="VALID"))return this.conv2dByMatMul(u,d,x);if(W().getBool("WEBGL_CONV_IM2COL")&&u.shape[0]===1)return this.conv2dWithIm2Row(u,d,x);var T=new qo(x);return this.compileAndRun(T,[u,d])},h.prototype.conv2dDerInput=function(u,d,x){var T=new function(H){this.variableNames=["dy","W"],this.outputShape=H.inShape;var Z=H.filterHeight,ce=H.filterWidth,ye=H.strideHeight,Ee=H.strideWidth,je=H.dataFormat==="channelsLast",Pe=Z-1-H.padInfo.top,ze=ce-1-H.padInfo.left,Ge=je?1:2,rt=je?2:3,it=je?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+Pe+", "+ze+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+it+`];

        ivec2 dyCorner = ivec2(coords[`+Ge+"], coords["+rt+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+Z+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+ye+`.0;

          if (dyR < 0.0 || dyR >= `+H.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+Z+` - 1 - wR;

          for (int wC = 0; wC < `+ce+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+Ee+`.0;

            if (dyC < 0.0 || dyC >= `+H.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+ce+` - 1 - wC;

            for (int d2 = 0; d2 < `+H.outChannels+`; d2++) {

              if (`+je+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}(x);return this.compileAndRun(T,[u,d])},h.prototype.conv2dDerFilter=function(u,d,x){var T=new function(H){this.variableNames=["x","dy"],this.outputShape=H.filterShape;var Z=H.strideHeight,ce=H.strideWidth,ye=H.padInfo.top,Ee=H.padInfo.left,je=H.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+H.batchSize+`; b++) {
          for (int yR = 0; yR < `+H.outHeight+`; yR++) {
            int xR = wR + yR * `+Z+" - "+ye+`;

            if (xR < 0 || xR >= `+H.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+H.outWidth+`; yC++) {
              int xC = wC + yC * `+ce+" - "+Ee+`;

              if (xC < 0 || xC >= `+H.inWidth+`) {
                continue;
              }

              if (`+je+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}(x);return this.compileAndRun(T,[u,d])},h.prototype.fusedDepthwiseConv2D=function(u){var d,x=u.input,T=u.filter,H=u.convInfo,Z=u.bias,ce=u.activation,ye=u.preluActivationWeights,Ee=W().getBool("WEBGL_PACK_DEPTHWISECONV")&&H.strideWidth<=2&&H.outChannels/H.inChannels==1,je=ce?op(ce,Ee):null,Pe=[x,T],ze=Z!=null,Ge=ye!=null;return ze&&Pe.push(Z),Ge&&Pe.push(ye),Ee?(d=new Ao(H,ze,je,Ge),this.compileAndRun(d,Pe)):(d=new Ia(H,ze,je,Ge),this.compileAndRun(d,Pe))},h.prototype.depthwiseConv2D=function(u,d,x){var T;return W().getBool("WEBGL_PACK_DEPTHWISECONV")&&x.strideWidth<=2&&x.outChannels/x.inChannels==1?(T=new Ao(x),this.compileAndRun(T,[u,d])):(T=new Ia(x),this.compileAndRun(T,[u,d]))},h.prototype.depthwiseConv2DDerInput=function(u,d,x){var T=new function(H){this.variableNames=["dy","W"],this.outputShape=H.inShape;var Z=H.filterHeight,ce=H.filterWidth,ye=H.strideHeight,Ee=H.strideWidth,je=Z-1-H.padInfo.top,Pe=ce-1-H.padInfo.left,ze=H.outChannels/H.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+je+", "+Pe+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+Z+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+ye+`.0;

          if (dyR < 0.0 || dyR >= `+H.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+Z+` - 1 - wR;

          for (int wC = 0; wC < `+ce+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+Ee+`.0;

            if (dyC < 0.0 || dyC >= `+H.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+ce+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+ze+`; dm++) {
              int d2 = d1 * `+ze+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(x);return this.compileAndRun(T,[u,d])},h.prototype.depthwiseConv2DDerFilter=function(u,d,x){var T=new function(H){this.variableNames=["x","dy"],this.outputShape=H.filterShape;var Z=H.strideHeight,ce=H.strideWidth,ye=H.padInfo.top,Ee=H.padInfo.left,je=H.outChannels/H.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+je+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+H.batchSize+`; b++) {
          for (int yR = 0; yR < `+H.outHeight+`; yR++) {
            int xR = wR + yR * `+Z+" - "+ye+`;

            if (xR < 0 || xR >= `+H.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+H.outWidth+`; yC++) {
              int xC = wC + yC * `+ce+" - "+Ee+`;

              if (xC < 0 || xC >= `+H.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}(x);return this.compileAndRun(T,[u,d])},h.prototype.conv3d=function(u,d,x){var T=new function(H){this.variableNames=["x","W"],this.outputShape=H.outShape;var Z=H.padInfo.front,ce=H.padInfo.top,ye=H.padInfo.left,Ee=H.strideDepth,je=H.strideHeight,Pe=H.strideWidth,ze=H.dilationDepth,Ge=H.dilationHeight,rt=H.dilationWidth,it=H.filterDepth,ht=H.filterHeight,Et=H.filterWidth,At=4*Math.floor(H.inChannels/4),St=H.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+Ee+", "+je+", "+Pe+`);
      const ivec3 pads = ivec3(`+Z+", "+ce+", "+ye+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+it+`; wF++) {
          int xF = xFCorner + wF * `+ze+`;

          if (xF < 0 || xF >= `+H.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+ht+`; wR++) {
            int xR = xRCorner + wR * `+Ge+`;

            if (xR < 0 || xR >= `+H.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+Et+`; wC++) {
              int xC = xCCorner + wC * `+rt+`;

              if (xC < 0 || xC >= `+H.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+At+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(St===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+At+`) *
                  getW(wF, wR, wC, `+At+`, d2);
              } else if (`+(St===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+At+`),
                  getX(batch, xF, xR, xC, `+At+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+At+`, d2),
                  getW(wF, wR, wC, `+At+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(St===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+At+`),
                  getX(batch, xF, xR, xC, `+At+` + 1),
                  getX(batch, xF, xR, xC, `+At+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+At+`, d2),
                  getW(wF, wR, wC, `+At+` + 1, d2),
                  getW(wF, wR, wC, `+At+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(x);return this.compileAndRun(T,[u,d])},h.prototype.conv3dDerInput=function(u,d,x){var T=new function(H){this.variableNames=["dy","W"],this.outputShape=H.inShape;var Z=H.filterDepth,ce=H.filterHeight,ye=H.filterWidth,Ee=H.strideDepth,je=H.strideHeight,Pe=H.strideWidth,ze=Z-1-H.padInfo.front,Ge=ce-1-H.padInfo.top,rt=ye-1-H.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+ze+", "+Ge+", "+rt+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+Z+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+Ee+`.0;

          if (dyF < 0.0 || dyF >= `+H.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+Z+` - 1 - wF;

          for (int wR = 0; wR < `+ce+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+je+`.0;

            if (dyR < 0.0 || dyR >= `+H.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+ce+` - 1 - wR;

            for (int wC = 0; wC < `+ye+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+Pe+`.0;

              if (dyC < 0.0 || dyC >= `+H.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+ye+` - 1 - wC;

              for (int d2 = 0; d2 < `+H.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(x);return this.compileAndRun(T,[u,d])},h.prototype.conv3dDerFilter=function(u,d,x){var T=new function(H){this.variableNames=["x","dy"],this.outputShape=H.filterShape;var Z=H.strideDepth,ce=H.strideHeight,ye=H.strideWidth,Ee=H.padInfo.front,je=H.padInfo.top,Pe=H.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+H.batchSize+`; b++) {
          for (int yF = 0; yF < `+H.outDepth+`; yF++) {
            int xF = wF + yF * `+Z+" - "+Ee+`;

            if (xF < 0 || xF >= `+H.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+H.outHeight+`; yR++) {
              int xR = wR + yR * `+ce+" - "+je+`;

              if (xR < 0 || xR >= `+H.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+H.outWidth+`; yC++) {
                int xC = wC + yC * `+ye+" - "+Pe+`;

                if (xC < 0 || xC >= `+H.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(x);return this.compileAndRun(T,[u,d])},h.prototype.maxPool=function(u,d){var x=new Pu(d,"max",!1);return this.compileAndRun(x,[u])},h.prototype.avgPool=function(u,d){var x=new Pu(d,"avg",!1);return this.compileAndRun(x,[u],"float32")},h.prototype.maxPoolBackprop=function(u,d,x,T){var H=new Pu(T,"max",!0),Z=this.compileAndRun(H,[d]),ce=new function(Ee){this.variableNames=["dy","maxPos"],this.outputShape=Ee.inShape;var je=Ee.strideHeight,Pe=Ee.strideWidth,ze=Ee.dilationHeight,Ge=Ee.effectiveFilterHeight,rt=Ee.effectiveFilterWidth,it=Ge-1-Ee.padInfo.top,ht=rt-1-Ee.padInfo.left,Et=Ge*rt-1;this.userCode=`
      const ivec2 pads = ivec2(`+it+", "+ht+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+Ge+`;
          wR += `+ze+`) {
          float dyR = float(dyRCorner + wR) / `+je+`.0;

          if (dyR < 0.0 || dyR >= `+Ee.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+rt+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+Pe+`.0;

            if (dyC < 0.0 || dyC >= `+Ee.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+Et+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+rt+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}(T),ye=this.compileAndRun(ce,[u,Z],d.dtype);return Z.dispose(),ye},h.prototype.avgPoolBackprop=function(u,d,x){var T=new function(H){this.variableNames=["dy"],this.outputShape=H.inShape;var Z=H.filterHeight,ce=H.filterWidth,ye=H.strideHeight,Ee=H.strideWidth,je=H.dilationHeight,Pe=H.dilationWidth,ze=H.effectiveFilterHeight,Ge=H.effectiveFilterWidth,rt=ze-1-H.padInfo.top,it=Ge-1-H.padInfo.left,ht=1/(Z*ce);this.userCode=`
      const ivec2 pads = ivec2(`+rt+", "+it+`);
      const float avgMultiplier = float(`+ht+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+ze+`;
            wR += `+je+`) {
          float dyR = float(dyRCorner + wR) / `+ye+`.0;

          if (dyR < 0.0 || dyR >= `+H.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+Ge+`;
            wC+= `+Pe+`) {
            float dyC = float(dyCCorner + wC) / `+Ee+`.0;

            if (dyC < 0.0 || dyC >= `+H.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}(x);return this.compileAndRun(T,[u],d.dtype)},h.prototype.cast=function(u,d){return iu(u,d,this)},h.prototype.unstack=function(u,d){for(var x=u.shape[d],T=new Array(u.rank-1),H=0,Z=0;Z<u.rank;Z++)Z!==d&&(T[H++]=u.shape[Z]);var ce=new Array(u.rank).fill(0),ye=u.shape.slice();ye[d]=1;var Ee=new Array(x);for(Z=0;Z<Ee.length;Z++)ce[d]=Z,Ee[Z]=this.slice(u,ce,ye).reshape(T);return Ee},h.prototype.avgPool3d=function(u,d){var x=new Zo(d,"avg",!1);return this.compileAndRun(x,[u],"float32")},h.prototype.avgPool3dBackprop=function(u,d,x){var T=new function(H){this.variableNames=["dy"],this.outputShape=H.inShape;var Z=H.filterDepth,ce=H.filterHeight,ye=H.filterWidth,Ee=H.strideDepth,je=H.strideHeight,Pe=H.strideWidth,ze=H.dilationDepth,Ge=H.dilationHeight,rt=H.dilationWidth,it=H.effectiveFilterDepth,ht=H.effectiveFilterHeight,Et=H.effectiveFilterWidth,At=it-1-H.padInfo.front,St=ht-1-H.padInfo.top,Gt=Et-1-H.padInfo.left,un=1/(Z*ce*ye);this.userCode=`
      const ivec3 pads = ivec3(`+At+", "+St+", "+Gt+`);
      const float avgMultiplier = float(`+un+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+it+`;
            wD += `+ze+`) {
          float dyD = float(dyDCorner + wD) / `+Ee+`.0;

          if (dyD < 0.0 || dyD >= `+H.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+ht+`;
              wR += `+Ge+`) {
            float dyR = float(dyRCorner + wR) / `+je+`.0;

            if (dyR < 0.0 || dyR >= `+H.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+Et+`;
                wC += `+rt+`) {
              float dyC = float(dyCCorner + wC) / `+Pe+`.0;

              if (dyC < 0.0 || dyC >= `+H.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(x);return this.compileAndRun(T,[u],d.dtype)},h.prototype.maxPool3d=function(u,d){var x=new Zo(d,"max",!1);return this.compileAndRun(x,[u],"float32")},h.prototype.maxPool3dBackprop=function(u,d,x,T){var H=new Zo(T,"max",!0),Z=this.compileAndRun(H,[d]),ce=new function(Ee){this.variableNames=["dy","maxPos"],this.outputShape=Ee.inShape;var je=Ee.strideDepth,Pe=Ee.strideHeight,ze=Ee.strideWidth,Ge=Ee.dilationDepth,rt=Ee.dilationHeight,it=Ee.dilationWidth,ht=Ee.effectiveFilterDepth,Et=Ee.effectiveFilterHeight,At=Ee.effectiveFilterWidth,St=ht-1-Ee.padInfo.front,Gt=Et-1-Ee.padInfo.top,un=At-1-Ee.padInfo.left,vn=ht*Et*At-1;this.userCode=`
      const ivec3 pads = ivec3(`+St+", "+Gt+", "+un+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+ht+`;
           wD += `+Ge+`) {
          float dyD = float(dyDCorner + wD) / `+je+`.0;

          if (dyD < 0.0 || dyD >= `+Ee.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+Et+`;
              wR += `+rt+`) {
            float dyR = float(dyRCorner + wR) / `+Pe+`.0;

            if (dyR < 0.0 || dyR >= `+Ee.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+At+`;
                wC += `+it+`) {
              float dyC = float(dyCCorner + wC) / `+ze+`.0;

              if (dyC < 0.0 || dyC >= `+Ee.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+vn+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+Et+" * "+At+` +
                  wR * `+At+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(T),ye=this.compileAndRun(ce,[u,Z],d.dtype);return Z.dispose(),ye},h.prototype.reshape=function(u,d){var x=this.texData.get(u.dataId);if(x.isPacked&&!eu(u.shape,d)&&(x.texture===null||!eu(x.shape,d))){var T=this.packedReshape(u,d);return He.makeTensorFromDataId(T.dataId,T.shape,T.dtype)}return bl(u,d)},h.prototype.resizeBilinear=function(u,d,x,T){var H=W().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new function(Z,ce,ye,Ee){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var je=Z[0],Pe=Z[1],ze=Z[2],Ge=Z[3];this.outputShape=[je,ce,ye,Ge];var rt=[Ee&&ce>1?Pe-1:Pe,Ee&&ye>1?ze-1:ze],it=[Ee&&ce>1?ce-1:ce,Ee&&ye>1?ye-1:ye];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+rt[0]/it[0]+`,
          `+rt[1]/it[1]+`,
          `+rt[1]/it[1]+`);
      const vec3 inputShapeRC = vec3(`+Pe+".0, "+ze+`.0,
                                     `+ze+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(Ge-1)+`;
        bool hasNextRow = coords.z < `+(ye-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}(u.shape,d,x,T):new function(Z,ce,ye,Ee){this.variableNames=["A"],this.outputShape=[];var je=Z[0],Pe=Z[1],ze=Z[2],Ge=Z[3];this.outputShape=[je,ce,ye,Ge];var rt=[Ee&&ce>1?Pe-1:Pe,Ee&&ye>1?ze-1:ze],it=[Ee&&ce>1?ce-1:ce,Ee&&ye>1?ye-1:ye];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+rt[0]/it[0]+`,
          `+rt[1]/it[1]+`);
      const vec2 inputShapeRC = vec2(`+Pe+".0, "+ze+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}(u.shape,d,x,T);return this.compileAndRun(H,[u],"float32")},h.prototype.resizeBilinearBackprop=function(u,d,x){var T=new function(H,Z,ce){this.variableNames=["dy"],this.outputShape=[],this.outputShape=Z.shape;var ye=Z.shape,Ee=ye[1],je=ye[2],Pe=H.shape,ze=Pe[1],Ge=Pe[2],rt=[ce&&ze>1?Ee-1:Ee,ce&&Ge>1?je-1:je],it=[ce&&ze>1?ze-1:ze,ce&&Ge>1?Ge-1:Ge],ht=rt[0]/it[0],Et=rt[1]/it[1],At=1/ht,St=1/Et,Gt=2*Math.ceil(At)+2,un=2*Math.ceil(St)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+ht+`);
        const float widthScale = float(`+Et+`);

        const float invHeightScale = float(`+At+`);
        const float invWidthScale = float(`+St+`);

        const int winHeight = int(`+Gt+`);
        const int winWidth = int(`+un+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+ze+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+Ge+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(Ee-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(je-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}(u,d,x);return this.compileAndRun(T,[u])},h.prototype.resizeNearestNeighbor=function(u,d,x,T){var H=new function(Z,ce,ye,Ee){this.variableNames=["A"],this.outputShape=[];var je=Z[0],Pe=Z[1],ze=Z[2],Ge=Z[3];this.outputShape=[je,ce,ye,Ge];var rt=[Ee&&ce>1?Pe-1:Pe,Ee&&ye>1?ze-1:ze],it=[Ee&&ce>1?ce-1:ce,Ee&&ye>1?ye-1:ye],ht=Ee?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+rt[0]/it[0]+`,
          `+rt[1]/it[1]+`);
      const vec2 inputShapeRC = vec2(`+Pe+".0, "+ze+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+ht+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}(u.shape,d,x,T);return this.compileAndRun(H,[u])},h.prototype.resizeNearestNeighborBackprop=function(u,d,x){var T=new function(H,Z,ce){this.variableNames=["dy"],this.outputShape=[],this.outputShape=Z.shape;var ye=Z.shape,Ee=ye[1],je=ye[2],Pe=H.shape,ze=Pe[1],Ge=Pe[2],rt=[ce&&ze>1?Ee-1:Ee,ce&&Ge>1?je-1:je],it=[ce&&ze>1?ze-1:ze,ce&&Ge>1?Ge-1:Ge],ht=rt[0]/it[0],Et=rt[1]/it[1],At=1/ht,St=1/Et,Gt=2*Math.ceil(At)+2,un=2*Math.ceil(St)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+ht+`);
        const float widthScale = float(`+Et+`);

        const float invHeightScale = float(`+At+`);
        const float invWidthScale = float(`+St+`);

        const int winHeight = int(`+Gt+`);
        const int winWidth = int(`+un+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+ze+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+Ge+`) {
              continue;
            }

            float sourceFracRow =
              float(`+rt[0]+`) *
                (float(dyR) / float(`+it[0]+`));

            float sourceFracCol =
                float(`+rt[1]+`) *
                  (float(dyC) / float(`+it[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+Ee+`) - 1),
                `+ce+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+je+`) - 1),
                `+ce+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}(u,d,x);return this.compileAndRun(T,[u])},h.prototype.multinomial=function(u,d,x,T){var H=d?u:ru(u),Z=H.shape[0],ce=H.shape[1],ye=new Qu(Z,ce,x),Ee=ye.getCustomSetupFunc(T);return this.compileAndRun(ye,[H],"int32",Ee)},h.prototype.oneHot=function(u,d,x,T){var H=new function(Z,ce,ye,Ee){this.variableNames=["indices"],this.outputShape=[Z,ce],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+Ee+"), float("+ye+`),
                      float(index == coords.y)));
      }
    `}(u.size,d,x,T);return this.compileAndRun(H,[u])},h.prototype.diag=function(u){var d=new function(x){this.variableNames=["X"],this.outputShape=[x,x],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}(u.size);return this.compileAndRun(d,[u])},h.prototype.nonMaxSuppression=function(u,d,x,T,H){return Jf("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),wl(u.dataSync(),d.dataSync(),x,T,H)},h.prototype.cropAndResize=function(u,d,x,T,H,Z){var ce=new function(ye,Ee,je,Pe,ze){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var Ge=ye[0],rt=ye[1],it=ye[2],ht=ye[3],Et=Ee[0],At=je[0],St=je[1];this.outputShape=[Et,At,St,ht];var Gt=Pe==="bilinear"?1:0,un=[rt-1+".0",it-1+".0"],vn=un[0],cn=un[1],kn=At>1?[""+(rt-1)/(At-1),"(y2-y1) * height_ratio","y1*"+vn+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+vn],On=kn[0],p=kn[1],c=kn[2],a=St>1?[""+(it-1)/(St-1),"(x2-x1) * width_ratio","x1*"+cn+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+cn],l=a[0],y=a[1],S=a[2];this.userCode=`
      const float height_ratio = float(`+On+`);
      const float width_ratio = float(`+l+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+Ge+`) {
          return;
        }

        float height_scale = `+p+`;
        float width_scale = `+y+`;

        float in_y = `+c+`;
        if( in_y < 0.0 || in_y > `+vn+` ) {
          setOutput(float(`+ze+`));
          return;
        }
        float in_x = `+S+`;
        if( in_x < 0.0 || in_x > `+cn+` ) {
          setOutput(float(`+ze+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+Gt+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}(u.shape,d.shape,T,H,Z);return this.compileAndRun(ce,[u,d,x],"float32")},h.prototype.depthToSpace=function(u,d,x){Ce(d>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+d});var T=u.shape[0],H=x==="NHWC"?u.shape[1]:u.shape[2],Z=x==="NHWC"?u.shape[2]:u.shape[3],ce=x==="NHWC"?u.shape[3]:u.shape[1],ye=H*d,Ee=Z*d,je=ce/(d*d),Pe=new zo(x==="NHWC"?[T,ye,Ee,je]:[T,je,ye,Ee],d,x);return this.compileAndRun(Pe,[u])},h.prototype.split=function(u,d,x){return qh(u,d,x)},h.prototype.scatterND=function(u,d,x){var T=Ml(0,u,x),H=T.sliceRank,Z=T.numUpdates,ce=T.sliceSize,ye=T.strides,Ee=T.outputSize,je=[Ee/ce,ce],Pe=u.reshape([Z,H]),ze=d.reshape([Z,ce]);if(Ee===0)return bl(la([]),x);var Ge=Mr(0),rt=new Lu(Z,H,Pe.rank,ze.rank,ye,je);return this.compileAndRun(rt,[ze,Pe,Ge]).reshape(x)},h.prototype.sparseToDense=function(u,d,x,T){var H=Ml(0,u,x),Z=H.sliceRank,ce=H.numUpdates,ye=H.strides,Ee=H.outputSize,je=new Lu(ce,Z,u.rank,d.rank,ye,[Ee,1]);return this.compileAndRun(je,[d,u,T]).reshape(x)},h.prototype.fft=function(u){return this.fftImpl(u,!1)},h.prototype.ifft=function(u){return this.fftImpl(u,!0)},h.prototype.fftImpl=function(u,d){var x=this.texData.get(u.dataId),T=new Sa("return real * expR - imag * expI;",u.shape,d),H=new Sa("return real * expI + imag * expR;",u.shape,d),Z=[this.makeComplexComponentTensorInfo(u,x.complexTensors.real),this.makeComplexComponentTensorInfo(u,x.complexTensors.imag)],ce=this.compileAndRun(T,Z),ye=this.compileAndRun(H,Z),Ee=this.complex(ce,ye).as2D(u.shape[0],u.shape[1]);return ce.dispose(),ye.dispose(),Ee},h.prototype.gatherND=function(u,d){var x=d.shape,T=x[x.length-1],H=Oc(u,d),Z=H[0],ce=H[1],ye=H[2],Ee=H[3],je=d.reshape([ce,T]),Pe=u.reshape([u.size/ye,ye]),ze=new function(Ge,rt,it){this.sliceDim=Ge,this.strides=rt,this.variableNames=["x","indices"],this.outputShape=it;var ht=Yn(rt.length),Et=Yn(it.length),At=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+ht+" strides = "+ht+"("+this.strides+`);
         void main() {
          `+Et+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+At+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}(T,Ee,[ce,ye]);return this.compileAndRun(ze,[Pe,je]).reshape(Z)},h.prototype.fill=function(u,d,x){if((x=x||we(d))==="string"){var T=pn(x,Qe(u));return T.fill(d),He.makeTensor(T,u,x,this)}var H=new Xa(u,d),Z=H.getCustomSetupFunc(d);return this.compileAndRun(H,[],x,Z)},h.prototype.onesLike=function(u){if(u.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(u.shape,1,u.dtype)},h.prototype.zerosLike=function(u){return this.fill(u.shape,u.dtype==="string"?"":0,u.dtype)},h.prototype.linspace=function(u,d,x){return Pl(u,d,x)},h.prototype.makeTensorInfo=function(u,d){var x=this.write(null,u,d);return this.texData.get(x).usage=null,{dataId:x,shape:u,dtype:d}},h.prototype.makeOutput=function(u,d){var x=this.makeTensorInfo(u,d).dataId;return He.makeTensorFromDataId(x,u,d,this)},h.prototype.unpackTensor=function(u){var d=new function(x){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=x;var T=x.length,H=R("rc",T),Z=Yn(T),ce=function(je,Pe){if(je===1)return"rc";for(var ze="",Ge=0;Ge<je;Ge++)ze+=Pe[Ge],Ge<je-1&&(ze+=",");return ze}(T,H),ye=H.slice(-2),Ee=T<=1?"rc":"vec2("+ye.join(",")+")";this.userCode=`
      void main() {
        `+Z+` rc = getOutputCoords();
        vec4 packedInput = getA(`+ce+`);

        setOutput(getChannel(packedInput, `+Ee+`));
      }
    `}(u.shape);return this.runWebGLProgram(d,[u],u.dtype)},h.prototype.packTensor=function(u){var d=new function(x){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=x;var T=x.length;if(T===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var H=R("rc",T),Z=Yn(T),ce=function(je,Pe,ze){if(je===1)return"rc > "+Pe[0];for(var Ge="",rt=je-2;rt<je;rt++)Ge+=ze[rt]+" >= "+Pe[rt],rt<je-1&&(Ge+="||");return Ge}(T,x,H),ye=function(je,Pe,ze,Ge){if(je===1)return"";var rt=Ge.slice(-2);return`
    int r = `+rt[0]+`;
    int c = `+rt[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+Pe+`;
    bool rEdge = rp1 >= `+ze+`;
  `}(T,x[x.length-1],x[x.length-2],H),Ee=function(je,Pe){var ze=je.length,Ge=function(rt,it){for(var ht=[],Et=0;Et<=1;Et++)for(var At=0;At<=1;At++){for(var St=(Et===0?"r":"rp1")+", "+(At===0?"c":"cp1"),Gt=2;Gt<rt;Gt++)St=it[it.length-1-Gt]+","+St;ht.push(St)}return ht}(ze,Pe);return ze===1?`getA(rc),
            rc + 1 >= `+je[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+Ge[0]+`),
          cEdge ? 0. : getA(`+Ge[1]+`),
          rEdge ? 0. : getA(`+Ge[2]+`),
          rEdge || cEdge ? 0. : getA(`+Ge[3]+")"}(x,H);this.userCode=`
        void main() {
          `+Z+` rc = getOutputCoords();

          if(`+ce+`) {
            setOutput(vec4(0));
          } else {
            `+ye+`

            setOutput(vec4(`+Ee+`));
          }
        }
      `}}(u.shape);return this.runWebGLProgram(d,[u],u.dtype,null,!0)},h.prototype.packedReshape=function(u,d){var x=[Is(u.shape)].concat(Ba(u.shape)),T={dtype:u.dtype,shape:x,dataId:u.dataId},H=new function(ce,ye){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ce;for(var Ee="",je=0;je<4;je++){var Pe="thisRC = rc;";je%2==1&&(Pe+="thisRC.z += 1;"),je>1&&(Pe+="thisRC.y += 1;"),Ee+=`
        `+Pe+`
        `+(je>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+je+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(je>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Ue(["r","c","d"],ye)+`
      return ivec3(r, c, d);
    }
  
      `+Je(ce)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+ce[1]+`;
        int cols = `+ce[2]+`;

        `+Ee+`

        setOutput(result);
      }
    `}([Is(d)].concat(Ba(d)),x),Z=this.runWebGLProgram(H,[T],u.dtype,null,!0);return{dataId:Z.dataId,shape:d,dtype:Z.dtype}},h.prototype.decode=function(u){var d,x=this.texData.get(u),T=x.isPacked,H=x.shape,Z=x.dtype,ce=jc(H);return d=T?new function(ye){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=pr.DENSE;var Ee=$i(ye),je=oe();this.outputShape=ye,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Ue(["r","c","d"],ye)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+Ee[0]+", "+Ee[1]+`));
        int index = 4 * (resTexRC.x * `+Ee[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+je.output+` = result;
      }
    `}(ce):new function(ye){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=pr.DENSE;var Ee=$i(ye),je=oe();this.outputShape=ye,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Ue(["r","c","d"],ye)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+Ee[0]+", "+Ee[1]+`));
        int index = 4 * (resTexRC.x * `+Ee[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+je.output+` = result;
      }
    `}(ce),{dtype:Z,shape:H,dataId:this.runWebGLProgram(d,[{shape:ce,dtype:Z,dataId:u}],Z,null,!0).dataId}},h.prototype.runWebGLProgram=function(u,d,x,T,H){var Z=this;H===void 0&&(H=!1);var ce=this.makeTensorInfo(u.outputShape,x),ye=this.texData.get(ce.dataId);if(u.packedOutput&&(ye.isPacked=!0),u.outPackingScheme===pr.DENSE){var Ee=$i(u.outputShape);ye.texShape=Ee.map(function(At){return 2*At})}if(u.outTexUsage!=null&&(ye.usage=u.outTexUsage),Qe(ce.shape)===0)return ye.values=tr(ce.dtype,0),ce;var je=[],Pe=d.map(function(At){if(At.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var St=Z.texData.get(At.dataId);if(St.texture==null){if(!u.packedInputs&&Qe(At.shape)<=W().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:At.shape,texData:null,isUniform:!0,uniformValues:St.values};u.packedInputs&&(St.isPacked=!0,St.shape=At.shape)}else if(!!St.isPacked!=!!u.packedInputs)At=St.isPacked?Z.unpackTensor(At):Z.packTensor(At),je.push(At),St=Z.texData.get(At.dataId);else if(St.isPacked&&!eu(St.shape,At.shape)){var Gt=At,un=At.shape;At.shape=St.shape,At=Z.packedReshape(At,un),je.push(At),St=Z.texData.get(At.dataId),Gt.shape=un}return Z.uploadToGPU(At.dataId),{shape:At.shape,texData:St,isUniform:!1}});this.uploadToGPU(ce.dataId);var ze,Ge={shape:ce.shape,texData:ye,isUniform:!1},rt=function(At,St,Gt){var un="";Pe.concat(Gt).forEach(function(cn){var kn=cn.texData!=null&&cn.texData.slice!=null&&cn.texData.slice.flatOffset>0,On=cn.isUniform?"uniform":cn.texData.texShape;un+=cn.shape+"_"+On+"_"+kn});var vn=At.userCode;return At.constructor.name+"_"+un+"_"+vn}(u,0,Ge),it=this.getAndSaveBinary(rt,function(){return function(At,St,Gt,un){var vn=St.userCode,cn=Gt.map(function(G,ae){var le={logicalShape:G.shape,texShape:G.isUniform?null:G.texData.texShape,isUniform:G.isUniform,isPacked:!G.isUniform&&G.texData.isPacked,flatOffset:null};return G.texData!=null&&G.texData.slice!=null&&G.texData.slice.flatOffset>0&&(le.flatOffset=G.texData.slice.flatOffset),{name:St.variableNames[ae],shapeInfo:le}}),kn=cn.map(function(G){return G.shapeInfo}),On={logicalShape:un.shape,texShape:un.texData.texShape,isUniform:!1,isPacked:un.texData.isPacked,flatOffset:null},p=qt(cn,On,vn,St.packedInputs),c=At.createProgram(p),a=null,l=At.getUniformLocation(c,"NAN",!1);W().getNumber("WEBGL_VERSION")===1&&(a=At.getUniformLocation(c,"INFINITY",!1));for(var y={},S=0;S<St.variableNames.length;S++){var U=St.variableNames[S];y[U]=At.getUniformLocation(c,U,!1),y["offset"+U]=At.getUniformLocation(c,"offset"+U,!1)}return{program:St,source:p,webGLProgram:c,uniformLocations:y,inShapeInfos:kn,outShapeInfo:On,infLoc:a,nanLoc:l}}(Z.gpgpu,u,Pe,Ge)}),ht=this.activeTimers!=null;if(ht&&(ze=this.startTimer()),function(At,St,Gt,un,vn){Bu(St.inShapeInfos,Gt),Bu([St.outShapeInfo],[un]);var cn=un.texData.texture,kn=un.texData.texShape;un.texData.isPacked?At.setOutputPackedMatrixTexture(cn,kn[0],kn[1]):At.setOutputMatrixTexture(cn,kn[0],kn[1]),At.setProgram(St.webGLProgram),W().getNumber("WEBGL_VERSION")===1&&St.infLoc!==null&&At.gl.uniform1f(St.infLoc,1/0),St.nanLoc!==null&&At.gl.uniform1f(St.nanLoc,NaN),Gt.forEach(function(On,p){var c=St.program.variableNames[p],a=St.uniformLocations[c],l=St.uniformLocations["offset"+c];if(a!=null)if(On.isUniform)if(Qe(On.shape)<2)At.gl.uniform1f(a,On.uniformValues[0]);else{var y=On.uniformValues;y instanceof Float32Array||(y=new Float32Array(y)),At.gl.uniform1fv(a,y)}else On.texData.slice!=null&&l!=null&&At.gl.uniform1i(l,On.texData.slice.flatOffset),At.setInputMatrixTexture(On.texData.texture,a,p)}),vn!=null&&vn(At,St.webGLProgram),At.executeProgram()}(this.gpgpu,it,Pe,Ge,T),je.forEach(function(At){return Z.disposeData(At.dataId)}),ht&&(ze=this.endTimer(ze),this.activeTimers.push({name:u.constructor.name,query:this.getQueryTime(ze)})),!W().getBool("WEBGL_LAZILY_UNPACK")&&ye.isPacked&&H===!1){var Et=this.unpackTensor(ce);return this.disposeData(ce.dataId),Et}return ce},h.prototype.compileAndRun=function(u,d,x,T,H){H===void 0&&(H=!1),x=x||d[0].dtype;var Z=this.runWebGLProgram(u,d,x,T,H);return He.makeTensorFromDataId(Z.dataId,Z.shape,Z.dtype)},h.prototype.getAndSaveBinary=function(u,d){return u in this.binaryCache||(this.binaryCache[u]=d()),this.binaryCache[u]},h.prototype.getTextureManager=function(){return this.textureManager},h.prototype.dispose=function(){var u=this;this.disposed||(W().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(d){u.gpgpu.deleteProgram(u.binaryCache[d].webGLProgram),delete u.binaryCache[d]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement!="undefined"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},h.prototype.floatPrecision=function(){var u=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=so(function(){if(!W().get("WEBGL_RENDER_FLOAT32_ENABLED")){var d=W().getBool("DEBUG");W().set("DEBUG",!1);var x=u.abs(Mr(1e-8)).dataSync()[0];if(W().set("DEBUG",d),x>0)return 32}return 16})),this.floatPrecisionValue},h.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},h.prototype.uploadToGPU=function(u){var d,x=this.texData.get(u),T=x.shape,H=x.dtype,Z=x.values,ce=x.texture,ye=x.usage,Ee=x.isPacked;if(ce==null){var je,Pe=this.activeTimers!=null;Pe&&(je=an());var ze=x.texShape;if(ze==null&&(ze=ac(T,Ee),x.texShape=ze),Z!=null){var Ge=jc(T),rt=void 0,it=ze[1],ht=ze[0],Et=Z instanceof Uint8Array;Ee?(it=(d=mi(ze[0],ze[1]))[0],rt=new function(vn,cn,kn){kn===void 0&&(kn=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var On=oe(),p=cn[0],c=cn[1];this.outputShape=vn;var a="",l="result";kn&&(l="floor(result * 255. + 0.5)");for(var y=0;y<=1;y++)for(var S=0;S<=1;S++){var U=2*y+S;a+=`
          localCoords = coords;
          if(localCoords[2] + `+S+" < "+vn[2]+`) {
            localCoords[2] += `+S+`;
            if(localCoords[1] + `+y+" < "+vn[1]+`) {
              localCoords[1] += `+y+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+c+`;
              c = imod(flatIndex, `+c+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+c+".0, "+p+`.0);
              values = `+On.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+U+`] = values[0];
              } else if(offset == 1) {
                result[`+U+`] = values[1];
              } else if(offset == 2) {
                result[`+U+`] = values[2];
              } else {
                result[`+U+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Je(vn)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+a+`

        `+On.output+" = "+l+`;
      }
    `}(Ge,[ht=d[1],it],Et)):rt=new function(vn,cn,kn){kn===void 0&&(kn=!1),this.variableNames=["A"];var On=oe(),p=cn[0],c=cn[1];this.outputShape=vn;var a="result";kn&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+Je(vn)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+c+`;
        int c = imod(flatIndex, `+c+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+c+".0, "+p+`.0);
        vec4 values = `+On.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+On.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `}(Ge,[ht,it],Et);var At=this.makeTensorInfo([ht,it],H);this.texData.get(At.dataId).usage=Et?kr.PIXELS:kr.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(At.dataId),it,ht,Z);var St=this.runWebGLProgram(rt,[At],H,null,!0),Gt=this.texData.get(St.dataId);x.texture=Gt.texture,x.texShape=Gt.texShape,x.isPacked=Gt.isPacked,x.usage=Gt.usage,this.disposeData(At.dataId),this.texData.delete(St.dataId),x.values=null,Pe&&(this.uploadWaitMs+=an()-je)}else{var un=this.acquireTexture(ze,ye,H,Ee);x.texture=un}}},h.prototype.convertAndCacheOnCPU=function(u,d){var x=this.texData.get(u),T=x.dtype;return this.releaseGPUData(u),d!=null&&(x.values=function(H,Z){if(Z==="float32"||Z==="complex64")return H;if(Z==="int32"||Z==="bool"){for(var ce=Z==="int32"?new Int32Array(H.length):new Uint8Array(H.length),ye=0;ye<ce.length;++ye)ce[ye]=Math.round(H[ye]);return ce}throw new Error("Unknown dtype "+Z)}(d,T)),x.values},h.prototype.acquireTexture=function(u,d,x,T){if(this.numBytesInGPU+=this.computeBytes(u,x),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var H=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+H+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(u,d,T)},h.prototype.computeBytes=function(u,d){return u[0]*u[1]*Dt(d)},h}(jl);$n()&&He.registerBackend("webgl",function(){return new l0},2);var Lm=Tt({square_:function(b){var h=Ze(b,"x","square"),u=[h];return He.runKernelFunc(function(d,x){return x([h]),d.square(h)},{x:h},null,"Square",{},u,[])}}),ec="SquaredDifference",il=Tt({squaredDifference_:function(b,h){var u,d=Ze(b,"a","squaredDifference"),x=Ze(h,"b","squaredDifference");u=_n(d,x),d=u[0],x=u[1],Ro(d.shape,x.shape);var T={a:d,b:x},H=[d,x];return He.runKernelFunc(function(Z,ce){var ye=Z.squaredDifference(d,x);return ce([d,x]),ye},T,function(Z,ce){var ye=ce[0],Ee=ce[1],je=Mr(2);return{a:function(){return Z.mul(ye.sub(Ee).mul(je))},b:function(){return Z.mul(Ee.sub(ye).mul(je))}}},ec,{},H,[])}}),zl=Tt({abs_:function(b){var h=Ze(b,"x","abs");return h.dtype==="complex64"?He.runKernelFunc(function(u){return u.complexAbs(h)},{$x:h}):He.runKernelFunc(function(u,d){var x=u.abs(h);return d([h]),x},{x:h},function(u,d){var x=d[0];return{x:function(){return u.mul(x.toFloat().step(-1))}}},"Abs")}}),zm=Tt({acos_:function(b){var h=Ze(b,"x","acos");return He.runKernelFunc(function(u,d){var x=u.acos(h);return d([h]),x},{$x:h},function(u,d){var x=d[0];return{$x:function(){return u.divStrict(Mr(1).sub(x.toFloat().square()).sqrt()).neg()}}})}}),ap=Tt({acosh_:function(b){var h=Ze(b,"x","acosh");return He.runKernelFunc(function(u,d){var x=u.acosh(h);return d([h]),x},{$x:h},function(u,d){var x=d[0];return{$x:function(){return u.divStrict(x.toFloat().square().sub(1).sqrt())}}})}}),ol=Tt({asin_:function(b){var h=Ze(b,"x","asin");return He.runKernelFunc(function(u,d){var x=u.asin(h);return d([h]),x},{$x:h},function(u,d){var x=d[0];return{$x:function(){return u.divStrict(Mr(1).sub(x.toFloat().square()).sqrt())}}})}}),Zp=Tt({asinh_:function(b){var h=Ze(b,"x","asinh");return He.runKernelFunc(function(u,d){var x=u.asinh(h);return d([h]),x},{$x:h},function(u,d){var x=d[0];return{$x:function(){return u.divStrict(Mr(1).add(x.toFloat().square()).sqrt())}}})}}),Od=Tt({atan_:function(b){var h=Ze(b,"x","atan");return He.runKernelFunc(function(u,d){var x=u.atan(h);return d([h]),x},{$x:h},function(u,d){var x=d[0];return{$x:function(){return u.div(x.toFloat().square().add(1))}}})}}),Sd=Tt({atanh_:function(b){var h=Ze(b,"x","atanh");return He.runKernelFunc(function(u,d){var x=u.atanh(h);return d([h]),x},{$x:h},function(u,d){var x=d[0];return{$x:function(){return u.div(Mr(1).sub(x.toFloat().square()))}}})}}),Ng=Tt({ceil_:function(b){var h=Ze(b,"x","ceil");return He.runKernelFunc(function(u){return u.ceil(h)},{$x:h},function(u){return{$x:function(){return Ri(u)}}})}}),Ul=Tt({clipByValue_:function(b,h,u){var d=Ze(b,"x","clipByValue");Ce(h<=u,function(){return"Error in clip: min ("+h+") must be less than or equal to max ("+u+")."});var x=[d],T={min:h,max:u};return He.runKernelFunc(function(H,Z){var ce=H.clip(d,h,u);return Z([d]),ce},{x:d},function(H,Z){var ce=Z[0];return{x:function(){return H.where(ce.greaterEqual(h).logicalAnd(ce.lessEqual(u)),Ri(H))}}},"ClipByValue",T,x)}}),If=Tt({cos_:function(b){var h=Ze(b,"x","cos"),u=[h];return He.runKernelFunc(function(d,x){var T=d.cos(h);return x([h]),T},{x:h},function(d,x){var T=x[0];return{x:function(){return T.toFloat().sin().neg().mul(d)}}},"Cos",{},u)}}),Wl=Tt({cosh_:function(b){var h=Ze(b,"x","cosh");return He.runKernelFunc(function(u,d){var x=u.cosh(h);return d([h]),x},{$x:h},function(u,d){var x=d[0];return{$x:function(){return x.toFloat().sinh().mulStrict(u)}}})}}),Ig=Tt({erf_:function(b){var h=Ze(b,"x","erf");return Ce(h.dtype==="int32"||h.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),h.dtype==="int32"&&(h=h.toFloat()),He.runKernelFunc(function(u,d){var x=u.erf(h);return d([h]),x},{$x:h},function(u,d){var x=d[0];return{$x:function(){return u.mul(x.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Fg=Tt({exp_:function(b){var h=Ze(b,"x","exp");return He.runKernelFunc(function(u,d){var x=u.exp(h);return d([x]),x},{x:h},function(u,d){return{x:function(){return u.mulStrict(d[0])}}},"Exp",{},[],[!0])}}),em=Tt({expm1_:function(b){var h=Ze(b,"x","expm1");return He.runKernelFunc(function(u,d){var x=u.expm1(h);return d([h]),x},{$x:h},function(u,d){var x=d[0];return{$x:function(){return u.mul(x.exp())}}})}}),yv=Tt({floor_:function(b){var h=Ze(b,"x","floor");return He.runKernelFunc(function(u){return u.floor(h)},{$x:h},function(u){return{$x:function(){return Ri(u)}}})}}),bv=Tt({log_:function(b){var h=Ze(b,"x","log"),u=[h];return He.runKernelFunc(function(d,x){var T=d.log(h);return x([h]),T},{x:h},function(d,x){var T=x[0];return{x:function(){return d.div(T.toFloat())}}},"Log",{},u)}}),ra=Tt({log1p_:function(b){var h=Ze(b,"x","log1p");return He.runKernelFunc(function(u,d){var x=u.log1p(h);return d([h]),x},{$x:h},function(u,d){var x=d[0];return{$x:function(){return u.div(x.add(1))}}})}}),Rg=Tt({logSigmoid_:function(b){var h=Ze(b,"x","logSigmoid");return He.runKernelFunc(function(u,d){var x=u.softplus(h.neg()).neg();return d([h]),x},{$x:h},function(u,d){var x=d[0];return{$x:function(){return u.mul(x.neg().sigmoid())}}})}}),Mg=Tt({neg_:function(b){var h=Ze(b,"x","neg"),u=[h];return He.runKernelFunc(function(d){return d.neg(h)},{x:h},function(d){return{x:function(){return d.neg()}}},"Neg",{},u)}}),Um=Tt({reciprocal_:function(b){var h=Ze(b,"x","reciprocal");return He.runKernelFunc(function(u,d){var x=u.reciprocal(h);return d([h]),x},{$x:h},function(u,d){var x=d[0];return{$x:function(){return u.div(x.square().neg())}}})}}),jg=Tt({round_:function(b){var h=Ze(b,"x","round");return He.runKernelFunc(function(u){return u.round(h)},{$x:h},function(u){return{$x:function(){return Ri(u)}}})}}),sp=Tt({rsqrt_:function(b){var h=Ze(b,"x","rsqrt"),u=[h];return He.runKernelFunc(function(d,x){var T=d.rsqrt(h);return x([h]),T},{x:h},function(d,x){var T=x[0];return{x:function(){return d.div(T.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},u)}}),ou=Tt({sigmoid_:function(b){var h=Ze(b,"x","sigmoid");return He.runKernelFunc(function(u,d){var x=u.sigmoid(h);return d([x]),x},{x:h},function(u,d){var x=d[0];return{x:function(){return u.mul(x.mul(Mr(1).sub(x)))}}},"Sigmoid")}}),tc=Tt({sign_:function(b){var h=Ze(b,"x","sign");return He.runKernelFunc(function(u){return u.sign(h)},{$x:h},function(u){return{$x:function(){return Ri(u)}}})}}),f0=Tt({isNaN_:function(b){var h=Ze(b,"x","isNaN");return He.runKernelFunc(function(u){return u.isNaN(h)},{$x:h},function(u){return{$x:function(){return Ri(u)}}})}}),h0=Tt({isInf_:function(b){var h=Ze(b,"x","isInf");return He.runKernelFunc(function(u){return u.isInf(h)},{$x:h},function(u){return{$x:function(){return Ri(u)}}})}}),ch=Tt({isFinite_:function(b){var h=Ze(b,"x","isFinite");return He.runKernelFunc(function(u){return u.isFinite(h)},{$x:h},function(u){return{$x:function(){return Ri(u)}}})}}),Vl=Tt({sin_:function(b){var h=Ze(b,"x","sin"),u=[h];return He.runKernelFunc(function(d,x){var T=d.sin(h);return x([h]),T},{x:h},function(d,x){var T=x[0];return{x:function(){return T.toFloat().cos().mul(d)}}},"Sin",{},u)}}),Dd=Tt({sinh_:function(b){var h=Ze(b,"x","sinh");return He.runKernelFunc(function(u,d){var x=u.sinh(h);return d([h]),x},{$x:h},function(u,d){var x=d[0];return{$x:function(){return x.toFloat().cosh().mulStrict(u)}}})}}),H0=Tt({softplus_:function(b){var h=Ze(b,"x","softplus");return He.runKernelFunc(function(u,d){var x=u.softplus(h);return d([h]),x},{$x:h},function(u,d){var x=d[0];return{$x:function(){return u.mul(x.sigmoid())}}})}}),Wm=Tt({sqrt_:function(b){var h=Ze(b,"x","sqrt");return He.runKernelFunc(function(u,d){var x=u.sqrt(h);return d([h]),x},{$x:h},function(u,d){var x=d[0];return{$x:function(){return u.div(x.toFloat().sqrt().mul(2))}}})}}),Ff=Tt({step_:function(b,h){h===void 0&&(h=0);var u=Ze(b,"x","step");return He.runKernelFunc(function(d){return d.step(u,h)},{$x:u},function(d){return{$x:function(){return Ri(d)}}})}}),nc=Tt({tan_:function(b){var h=Ze(b,"x","tan");return He.runKernelFunc(function(u,d){var x=u.tan(h);return d([h]),x},{$x:h},function(u,d){var x=d[0];return{$x:function(){return u.div(x.cos().square())}}})}}),ql=Tt({tanh_:function(b){var h=Ze(b,"x","tanh");return He.runKernelFunc(function(u,d){var x=u.tanh(h);return d([x]),x},{x:h},function(u,d){var x=d[0];return{x:function(){return Mr(1).sub(x.square()).mulStrict(u)}}},"Tanh",{},null,[!0])}});function Hh(b,h,u,d,x,T){var H,Z,ce=Ze(b,"x","batchNorm"),ye=Ze(h,"mean","batchNorm"),Ee=Ze(u,"variance","batchNorm");return x!=null&&(H=Ze(x,"scale","batchNorm")),d!=null&&(Z=Ze(d,"offset","batchNorm")),Ce(ce.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+ce.rank+"."}),Ce(ye.rank===2||ye.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+ye.rank+"."}),Ce(Ee.rank===2||Ee.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+Ee.rank+"."}),H!=null&&Ce(H.rank===2||H.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+H.rank+"."}),Z!=null&&Ce(Z.rank===2||Z.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+Z.rank+"."}),Td(ce,ye,Ee,Z,H,T)}function lh(b,h,u,d,x,T){var H,Z,ce=Ze(b,"x","batchNorm"),ye=Ze(h,"mean","batchNorm"),Ee=Ze(u,"variance","batchNorm");return x!=null&&(H=Ze(x,"scale","batchNorm")),d!=null&&(Z=Ze(d,"offset","batchNorm")),Ce(ce.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+ce.rank+"."}),Ce(ye.rank===3||ye.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+ye.rank+"."}),Ce(Ee.rank===3||Ee.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+Ee.rank+"."}),H!=null&&Ce(H.rank===3||H.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+H.rank+"."}),Z!=null&&Ce(Z.rank===3||Z.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+Z.rank+"."}),Td(ce,ye,Ee,Z,H,T)}function Bg(b,h,u,d,x,T){var H,Z,ce=Ze(b,"x","batchNorm"),ye=Ze(h,"mean","batchNorm"),Ee=Ze(u,"variance","batchNorm");return x!=null&&(H=Ze(x,"scale","batchNorm")),d!=null&&(Z=Ze(d,"offset","batchNorm")),Ce(ce.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+ce.rank+"."}),Ce(ye.rank===4||ye.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+ye.rank+"."}),Ce(Ee.rank===4||Ee.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+Ee.rank+"."}),H!=null&&Ce(H.rank===4||H.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+H.rank+"."}),Z!=null&&Ce(Z.rank===4||Z.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+Z.rank+"."}),Td(ce,ye,Ee,Z,H,T)}function Td(b,h,u,d,x,T){T==null&&(T=.001);var H,Z,ce,ye=Ze(b,"x","batchNorm"),Ee=Ze(h,"mean","batchNorm"),je=Ze(u,"variance","batchNorm");x!=null&&(H=Ze(x,"scale","batchNorm")),d!=null&&(Z=Ze(d,"offset","batchNorm")),Ce(Ee.rank===je.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),Ce(Z==null||Ee.rank===Z.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),Ce(H==null||Ee.rank===H.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),ce=ye.rank===0||ye.rank===1?ye.as4D(1,1,1,ye.size):ye.rank===2?ye.as4D(1,1,ye.shape[0],ye.shape[1]):ye.rank===3?ye.as4D(1,ye.shape[0],ye.shape[1],ye.shape[2]):ye;var Pe=[ye,Ee,je,H];return He.runKernelFunc(function(ze,Ge){var rt=ze.batchNormalization(ce,al(Ee),al(je),T,al(H),al(Z));return Ge([ye,Ee,je,H]),rt},{x:ye,mean:Ee,variance:je,scale:H,offset:Z},function(ze,Ge){var rt=Ge,it=rt[0],ht=rt[1],Et=rt[2],At=rt[3],St=At==null?Mr(1):At,Gt=Ds(ht.shape,ce.shape),un=[];if(ht.rank===1){for(var vn=0;vn<ce.shape.length-1;++vn)un.push(ce.shape[vn]);un.push(1)}var cn=it.sub(ht),kn=ze.mul(St),On=sp(Et.add(Mr(T))),p=On.mul(On).mul(On).mul(Mr(-.5));return{x:function(){return ht.rank===1?ze.mul(cu(On.as4D(1,1,1,ht.shape[0]),un)).mul(St).reshape(it.shape):ze.mul(On).mul(St).reshape(it.shape)},mean:function(){var c=On.mul(Mr(-1)).mul(kn);return ht.rank===1&&(c=c.sum(Gt)),c.reshape(ht.shape)},variance:function(){var c=p.mul(cn).mul(kn);return ht.rank===1&&(c=c.sum(Gt)),c.reshape(ht.shape)},scale:function(){var c=cn.mul(On),a=ze.mul(c);return ht.rank===1&&(a=a.sum(Gt)),a.reshape(ht.shape)},offset:function(){var c=ze;return ht.rank===1&&(c=c.sum(Gt)),c.reshape(ht.shape)}}},"BatchNormalization",{varianceEpsilon:T},Pe).reshape(ye.shape)}function al(b){return b==null?null:b.rank===0?b.as1D():b.rank===1?b:b.rank===2?b.as4D(1,1,b.shape[0],b.shape[1]):b.rank===3?b.as4D(1,b.shape[0],b.shape[1],b.shape[2]):b}function Lc(){Qc("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Vm=Tt({batchNormalization2d_:function(b,h,u,d,x,T){return d===void 0&&(d=.001),Lc(),Hh(b,h,u,T,x,d)}}),Gh=Tt({batchNormalization3d_:function(b,h,u,d,x,T){return d===void 0&&(d=.001),Lc(),lh(b,h,u,T,x,d)}}),Pg=Tt({batchNormalization4d_:function(b,h,u,d,x,T){return d===void 0&&(d=.001),Lc(),Bg(b,h,u,T,x,d)}}),G0=Tt({batchNormalization_:function(b,h,u,d,x,T){return d===void 0&&(d=.001),Lc(),Td(b,h,u,T,x,d)}}),qm=Tt({batchNorm_:Td}),fh=Tt({batchNorm2d_:Hh}),$h=Tt({batchNorm3d_:lh}),Nd=Tt({batchNorm4d_:Bg}),Kh=Tt({logicalAnd_:function(b,h){var u=Ze(b,"a","logicalAnd","bool"),d=Ze(h,"b","logicalAnd","bool");return Ro(u.shape,d.shape),He.runKernelFunc(function(x){return x.logicalAnd(u,d)},{a:u,b:d},null,"LogicalAnd")}}),Rf=Tt({logicalNot_:function(b){var h=Ze(b,"x","logicalNot","bool");return He.runKernelFunc(function(u){return u.logicalNot(h)},{$x:h})}}),Hm=Tt({logicalOr_:function(b,h){var u=Ze(b,"a","logicalOr","bool"),d=Ze(h,"b","logicalOr","bool");return Ro(u.shape,d.shape),He.runKernelFunc(function(x){return x.logicalOr(u,d)},{$a:u,$b:d})}}),Xh=Tt({logicalXor_:function(b,h){var u=Ze(b,"a","logicalXor","bool"),d=Ze(h,"b","logicalXor","bool");return Ro(u.shape,d.shape),Hm(b,h).logicalAnd(Kh(b,h).logicalNot())}}),Ko=Tt({where_:function(b,h,u){var d=Ze(h,"a","where"),x=Ze(u,"b","where"),T=Ze(b,"condition","where","bool");return Wt(d.shape,x.shape,"Error in where: "),T.rank===1?Ce(T.shape[0]===d.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Wt(T.shape,x.shape,"Error in where: "),He.runKernelFunc(function(H,Z){var ce=H.select(T,d,x);return Z([T]),ce},{$condition:T,$a:d,$b:x},function(H,Z){var ce=Z[0];return{$condition:function(){return Ri(ce).toFloat()},$a:function(){return H.mul(ce.cast(H.dtype))},$b:function(){return H.mul(ce.logicalNot().cast(H.dtype))}}})}}),hh=function(b){return M(this,void 0,void 0,function(){var h,u,d;return V(this,function(x){switch(x.label){case 0:return[4,(h=Ze(b,"condition","whereAsync","bool")).data()];case 1:return u=x.sent(),d=Q(h.shape,u),b!==h&&h.dispose(),[2,d]}})})},up=Tt({add_:function(b,h){var u,d=Ze(b,"a","add"),x=Ze(h,"b","add");u=_n(d,x),d=u[0],x=u[1];var T=Ro(d.shape,x.shape);return He.runKernelFunc(function(H){return H.add(d,x)},{a:d,b:x},function(H){return{a:function(){var Z=H,ce=Ds(d.shape,T);return ce.length>0&&(Z=Z.sum(ce)),Z.reshape(d.shape)},b:function(){var Z=H,ce=Ds(x.shape,T);return ce.length>0&&(Z=Z.sum(ce)),Z.reshape(x.shape)}}},"Add")}}),$0=Tt({addN_:function(b){Ce(Array.isArray(b),function(){return"The argument passed to tf.addN() must be a list of tensors"}),Ce(b.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+b.length});var h=b.map(function(x,T){return Ze(x,"tensors"+T,"addN")}),u=h[0];h.forEach(function(x){if(x.dtype!==u.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),h.forEach(function(x){if(!fn(x.shape,u.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var d=h;return He.runKernelFunc(function(x){return x.addN(h)},d,function(x){var T={};return h.forEach(function(H,Z){T[Z]=function(){return x.clone()}}),T},"AddN")}}),dh=Tt({addStrict_:function(b,h){var u=Ze(b,"a","addStrict"),d=Ze(h,"b","addStrict");return Wt(u.shape,d.shape,"Error in addStrict: "),u.add(d)}}),cp=Tt({atan2_:function(b,h){var u,d=Ze(b,"a","atan2"),x=Ze(h,"b","atan2");u=_n(d,x),d=u[0],x=u[1];var T=Ro(d.shape,x.shape);return He.runKernelFunc(function(H,Z){var ce=H.atan2(d,x);return Z([d,x]),ce},{$a:d,$b:x},function(H,Z){var ce=Z[0],ye=Z[1];return{$a:function(){var Ee=up(ce.square(),ye.square()),je=H.mul(ye.div(Ee)),Pe=Ds(ce.shape,T);return Pe.length>0&&(je=je.sum(Pe)),je.reshape(ce.shape)},$b:function(){var Ee=up(ce.square(),ye.square()),je=Mg(H.mul(ce.div(Ee))),Pe=Ds(ye.shape,T);return Pe.length>0&&(je=je.sum(Pe)),je.reshape(ye.shape)}}})}}),Mf=Tt({div_:function(b,h){var u,d=Ze(b,"a","div"),x=Ze(h,"b","div");if(u=_n(d,x),d=u[0],x=u[1],d.dtype==="int32"&&x.dtype==="int32")return df(d,x);var T=Ro(d.shape,x.shape);return He.runKernelFunc(function(H,Z){var ce=H.realDivide(d,x);return Z([d,x]),ce},{a:d,b:x},function(H,Z){var ce=Z[0],ye=Z[1];return{a:function(){var Ee=H.div(ye.toFloat()),je=Ds(ce.shape,T);return je.length>0?Ee.sum(je).reshape(ce.shape):Ee},b:function(){var Ee=H.mul(ce.toFloat()),je=Ds(ye.shape,T);je.length>0&&(Ee=Ee.sum(je).reshape(ye.shape));var Pe=ye.square();return Ee.div(Pe.toFloat()).neg()}}},"Div")}}),hf=Tt({divNoNan_:function(b,h){var u,d=Ze(b,"a","div"),x=Ze(h,"b","div");d=(u=_n(d,x))[0],x=u[1];var T=Mf(d,x),H=Ri(T),Z=x.equal(H);return Ko(Z,H,T)}}),Yh=Tt({divStrict_:function(b,h){var u=Ze(b,"a","div"),d=Ze(h,"b","div");return Wt(u.shape,d.shape,"Error in divideStrict: "),u.div(d)}}),df=Tt({floorDiv_:function(b,h){var u,d=Ze(b,"a","floorDiv"),x=Ze(h,"b","floorDiv");u=_n(d,x),d=u[0],x=u[1];var T=Ro(d.shape,x.shape);return He.runKernelFunc(function(H,Z){var ce=H.floorDiv(d,x);return Z([d,x]),ce},{a:d,b:x},function(H,Z){var ce=Z[0],ye=Z[1];return{a:function(){var Ee=H.div(ye.toFloat()),je=Ds(ce.shape,T);return je.length>0?Ee.sum(je).reshape(ce.shape):Ee},b:function(){var Ee=H.mul(ce.toFloat()),je=Ds(ye.shape,T);je.length>0&&(Ee=Ee.sum(je).reshape(ye.shape));var Pe=ye.square();return Ee.div(Pe.toFloat()).neg()}}},"FloorDiv")}}),to=Tt({maximum_:function(b,h){var u,d=Ze(b,"a","maximum"),x=Ze(h,"b","maximum");return u=_n(d,x),d=u[0],x=u[1],d.dtype==="bool"&&(d=d.toInt(),x=x.toInt()),Ro(d.shape,x.shape),He.runKernelFunc(function(T,H){var Z=T.maximum(d,x);return H([d,x]),Z},{a:d,b:x},function(T,H){var Z=H[0],ce=H[1];return{a:function(){return T.mul(Z.greaterEqual(ce).toFloat())},b:function(){return T.mul(Z.less(ce).toFloat())}}},"Maximum")}}),pf=Tt({maximumStrict_:function(b,h){var u=Ze(b,"a","maximumStrict"),d=Ze(h,"b","maximumStrict");return Wt(u.shape,d.shape,"Error in maximumStrict: "),u.maximum(d)}}),jf=Tt({minimum_:function(b,h){var u,d=Ze(b,"a","minimum"),x=Ze(h,"b","minimum");return u=_n(d,x),d=u[0],x=u[1],d.dtype==="bool"&&(d=d.toInt(),x=x.toInt()),Ro(d.shape,x.shape),He.runKernelFunc(function(T,H){var Z=T.minimum(d,x);return H([d,x]),Z},{a:d,b:x},function(T,H){var Z=H[0],ce=H[1];return{a:function(){return T.mul(Z.lessEqual(ce).toFloat())},b:function(){return T.mul(Z.greater(ce).toFloat())}}},"Minimum")}}),zu=Tt({minimumStrict_:function(b,h){var u=Ze(b,"a","minimumStrict"),d=Ze(h,"b","minimumStrict");return Wt(u.shape,d.shape,"Error in minimumStrict: "),u.minimum(d)}}),lp=Tt({mod_:function(b,h){var u,d=Ze(b,"a","mod"),x=Ze(h,"b","mod");u=_n(d,x),d=u[0],x=u[1];var T=Ro(d.shape,x.shape);return He.runKernelFunc(function(H,Z){var ce=H.mod(d,x);return Z([d,x]),ce},{$a:d,$b:x},function(H,Z){var ce=Z[0],ye=Z[1];return{$a:function(){var Ee=Ds(ce.shape,T);return Ee.length>0?H.sum(Ee).reshape(ce.shape):H},$b:function(){var Ee=H.mul(ce.div(ye).floor().neg()),je=Ds(ye.shape,T);return je.length>0?Ee.sum(je).reshape(ye.shape):Ee}}})}}),ph=Tt({modStrict_:function(b,h){var u=Ze(b,"a","modStrict"),d=Ze(h,"b","modStrict");return Wt(u.shape,d.shape,"Error in modStrict: "),u.mod(d)}}),Bf=Tt({mul_:function(b,h){var u,d=Ze(b,"a","mul"),x=Ze(h,"b","mul");u=_n(d,x),d=u[0],x=u[1];var T=Ro(d.shape,x.shape);return He.runKernelFunc(function(H,Z){var ce=H.multiply(d,x);return Z([d,x]),ce},{a:d,b:x},function(H,Z){var ce=Z[0],ye=Z[1];return{a:function(){var Ee=H.mul(ye.toFloat()),je=Ds(ce.shape,T);return je.length>0?Ee.sum(je).reshape(ce.shape):Ee},b:function(){var Ee=H.mul(ce.toFloat()),je=Ds(ye.shape,T);return je.length>0?Ee.sum(je).reshape(ye.shape):Ee}}},"Mul")}}),Ts=Tt({mulStrict_:function(b,h){var u=Ze(b,"a","mul"),d=Ze(h,"b","mul");return Wt(u.shape,d.shape,"Error in multiplyStrict: "),u.mul(d)}}),Id=Tt({pow_:function(b,h){var u,d=Ze(b,"base","pow"),x=Ze(h,"exp","pow");u=_n(d,x),d=u[0],x=u[1];var T=Ro(d.shape,x.shape),H=[d,x];return He.runKernelFunc(function(Z,ce){var ye=Z.pow(d,x);return ce([d,x,ye]),ye},{a:d,b:x},function(Z,ce){var ye=ce[0],Ee=ce[1],je=ce[2];return{a:function(){var Pe=Ee.toFloat(),ze=Z.mul(Pe.mul(ye.pow(Pe.sub(Mr(1))))),Ge=Ds(ye.shape,T);return Ge.length>0&&(ze=ze.sum(Ge)),ze.reshape(ye.shape)},b:function(){var Pe=ye.greater(0),ze=ye.log().where(Pe,Ri(ye)),Ge=Z.mul(je.mul(ze)),rt=Ds(Ee.shape,T);return rt.length>0&&(Ge=Ge.sum(rt)),Ge.reshape(Ee.shape)}}},"Pow",{},H,[!0])}}),Gm=Tt({powStrict_:function(b,h){return Wt(b.shape,h.shape,"Error in powStrict: "),b.pow(h)}}),Jh=Tt({squaredDifferenceStrict_:function(b,h){var u=Ze(b,"a","squaredDifferenceStrict"),d=Ze(h,"b","squaredDifferenceStrict");return Wt(u.shape,d.shape,"Error in squaredDifferenceStrict: "),u.squaredDifference(d)}}),Pf=Tt({sub_:function(b,h){var u,d=Ze(b,"a","sub"),x=Ze(h,"b","sub");u=_n(d,x),d=u[0],x=u[1];var T=Ro(d.shape,x.shape);return He.runKernelFunc(function(H){return H.subtract(d,x)},{a:d,b:x},function(H){return{a:function(){var Z=H,ce=Ds(d.shape,T);return ce.length>0&&(Z=Z.sum(ce)),Z.reshape(d.shape)},b:function(){var Z=H,ce=Ds(x.shape,T);return ce.length>0&&(Z=Z.sum(ce)),Z.neg().reshape(x.shape)}}},"Sub")}}),du=Tt({subStrict_:function(b,h){var u=Ze(b,"a","subStrict"),d=Ze(h,"b","subStrict");return Wt(u.shape,d.shape,"Error in subStrict: "),u.sub(d)}}),mf=Tt({equal_:function(b,h){var u,d=Ze(b,"a","equal"),x=Ze(h,"b","equal");return u=_n(d,x),d=u[0],x=u[1],Ro(d.shape,x.shape),He.runKernelFunc(function(T){return T.equal(d,x)},{$a:d,$b:x})}}),El=Tt({equalStrict_:function(b,h){var u=Ze(b,"a","equalStrict"),d=Ze(h,"b","equalStrict");return Wt(u.shape,d.shape,"Error in equalStrict: "),u.equal(d)}}),sl=Tt({greater_:function(b,h){var u,d=Ze(b,"a","greater"),x=Ze(h,"b","greater");return u=_n(d,x),d=u[0],x=u[1],Ro(d.shape,x.shape),He.runKernelFunc(function(T){return T.greater(d,x)},{a:d,b:x},null,"Greater")}}),ul=Tt({greaterEqual_:function(b,h){var u,d=Ze(b,"a","greaterEqual"),x=Ze(h,"b","greaterEqual");return u=_n(d,x),d=u[0],x=u[1],Ro(d.shape,x.shape),He.runKernelFunc(function(T,H){var Z=T.greaterEqual(d,x);return H([d,x]),Z},{a:d,b:x},function(T,H){var Z=H[0],ce=H[1];return{a:function(){return Ri(Z)},b:function(){return Ri(ce)}}},"GreaterEqual")}}),rc=Tt({greaterEqualStrict_:function(b,h){var u=Ze(b,"a","greaterEqualStrict"),d=Ze(h,"b","greaterEqualStrict");return Wt(u.shape,d.shape,"Error in greaterEqualStrict: "),u.greaterEqual(d)}}),tm=Tt({greaterStrict_:function(b,h){var u=Ze(b,"a","greaterStrict"),d=Ze(h,"b","greaterStrict");return Wt(u.shape,d.shape,"Error in greaterStrict: "),u.greater(d)}}),Lg=Tt({less_:function(b,h){var u,d=Ze(b,"a","less"),x=Ze(h,"b","less");return u=_n(d,x),d=u[0],x=u[1],Ro(d.shape,x.shape),He.runKernelFunc(function(T){return T.less(d,x)},{a:d,b:x},null,"Less")}}),Fd=Tt({lessEqual_:function(b,h){var u,d=Ze(b,"a","lessEqual"),x=Ze(h,"b","lessEqual");return u=_n(d,x),d=u[0],x=u[1],Ro(d.shape,x.shape),He.runKernelFunc(function(T,H){var Z=T.lessEqual(d,x);return H([d,x]),Z},{a:d,b:x},null,"LessEqual")}}),Ra=Tt({lessEqualStrict_:function(b,h){var u=Ze(b,"a","lessEqualStrict"),d=Ze(h,"b","lessEqualStrict");return Wt(u.shape,d.shape,"Error in lessEqualStrict: "),u.lessEqual(d)}}),nm=Tt({lessStrict_:function(b,h){var u=Ze(b,"a","lessStrict"),d=Ze(h,"b","lessStrict");return Wt(u.shape,d.shape,"Error in lessStrict: "),u.less(d)}}),zc=Tt({notEqual_:function(b,h){var u,d=Ze(b,"a","notEqual"),x=Ze(h,"b","notEqual");return u=_n(d,x),d=u[0],x=u[1],Ro(d.shape,x.shape),He.runKernelFunc(function(T){return T.notEqual(d,x)},{a:d,b:x},null,"NotEqual")}}),Qh=Tt({notEqualStrict_:function(b,h){var u=Ze(b,"a","notEqualStrict"),d=Ze(h,"b","notEqualStrict");return Wt(u.shape,d.shape,"Error in notEqualStrict: "),u.notEqual(d)}});function Zh(b,h){for(var u=[],d=b;d<h;++d)u.push(d);return u}function rm(b){for(var h=[],u=0;u<b.length;++u)for(var d=0;d<b[u].length;++d)h.push(b[u][d]);return h}var $m=Tt({gather_:function(b,h,u){u===void 0&&(u=0);var d=Ze(b,"x","gather"),x=Ze(h,"indices","gather","int32");u=Tn(u,d.shape)[0];var T=function(H,Z,ce){for(var ye=H.shape[ce],Ee=[],je=1,Pe=1,ze=0;ze<ce;ze++)Ee.push(H.shape[ze]),je*=H.shape[ze];for(ze=0;ze<Z.rank;ze++)Ee.push(Z.shape[ze]);for(ze=ce+1;ze<H.rank;ze++)Ee.push(H.shape[ze]),Pe*=H.shape[ze];return{batchSize:je,sliceSize:Pe,dimSize:ye,outputShape:Ee}}(d,x,u);return He.runKernelFunc(function(H,Z){var ce=H.gather(d,x.flatten(),u);return Z([x]),ce},{x:d,indices:x},function(H,Z){var ce=Z[0];return{x:function(){var ye=d.shape,Ee=ce.size,je=ye.slice(0,u),Pe=je.length,ze=ye.slice(u,ye.length).slice(1),Ge=ze.length,rt=Zh(0,Pe),it=Zh(Pe+1,Pe+1+Ge),ht=rm([je,[Ee],ze]),Et=H.reshape(ht),At=ce.reshape([Ee]),St=rm([[Pe],rt,it]),Gt=Et.transpose(St),un=Km(Gt,At,d.shape[u]),vn=vl(St);return un.transpose(vn)},indices:function(){return ce}}},"Gather",{axis:u}).reshape(T.outputShape)}}),Km=Tt({unsortedSegmentSum_:function(b,h,u){var d=Ze(b,"x","unsortedSegmentSum"),x=Ze(h,"segmentIds","unsortedSegmentSum","int32");return Ce(on(u),function(){return"numSegments must be of dtype int"}),He.runKernelFunc(function(T,H){var Z=T.unsortedSegmentSum(d,x,u);return H([x]),Z},{$x:d},function(T,H){var Z=H[0];return{$x:function(){return function(ce,ye){for(var Ee=to(ye,Ri(ye)),je=$m(ce,Ee),Pe=ul(ye,Mr(0,"int32")),ze=je.rank-Pe.rank,Ge=0;Ge<ze;++Ge)Pe=Eo(Pe,Ge+1);Pe=Kh(Pe,Xu(je.shape,"bool"));var rt=Ri(je);return Ko(Pe,je,rt)}(T,Z)}}})}}),Xm=function(b,h,u){return M(this,void 0,void 0,function(){var d,x,T,H,Z,ce,ye,Ee,je,Pe,ze,Ge,rt;return V(this,function(it){switch(it.label){case 0:for(d=Ze(b,"tensor","boolMask"),x=Ze(h,"mask","boolMask","bool"),T=u==null?0:u,H=x.rank,Z=d.shape,Ce(H>0,function(){return"mask cannot be scalar"}),Wt(Z.slice(T,T+H),x.shape,"mask's shape must match the first K dimensions of tensor's shape,"),ce=1,ye=T;ye<T+H;ye++)ce*=Z[ye];return Ee=Z.slice(0,T).concat([ce],Z.slice(T+H)),je=d.reshape(Ee),Pe=x.reshape([-1]),[4,hh(Pe)];case 1:return ze=it.sent(),Ge=ze.squeeze([1]),rt=$m(je,Ge,T),b!==d&&d.dispose(),h!==x&&x.dispose(),Ge.dispose(),je.dispose(),Pe.dispose(),ze.dispose(),[2,rt]}})})};function zg(b,h,u,d,x,T,H){T===void 0&&(T="NHWC"),Ce(b.length===h.rank,function(){return"Length of inShape ("+b.length+") and rank of dy ("+h.rank+") must match"});var Z=b,ce=h,ye=!1;h.rank===3&&(ye=!0,ce=h.as4D(1,h.shape[0],h.shape[1],h.shape[2]),Z=[1,b[0],b[1],b[2]]),Ce(Z.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+Z.length+"."}),Ce(ce.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+ce.rank}),Ce(u.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+u.rank});var Ee=T==="NHWC"?Z[3]:Z[1],je=T==="NHWC"?ce.shape[3]:ce.shape[1];Ce(Ee===u.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+Ee+") must match input depth for filter "+u.shape[2]+"."}),Ce(je===u.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+je+") must match output depth for filter "+u.shape[3]+"."}),H!=null&&Ce(on(x),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+H+" but got pad "+x+"."});var Pe=ts(T),ze=wu(Z,u.shape,d,1,x,H,!1,Pe),Ge=He.runKernelFunc(function(rt,it){var ht=rt.conv2dDerInput(ce,u,ze);return it([u,ce]),ht},{dy4D:ce,filter:u},function(rt,it){var ht=it[0],Et=it[1];return{dy4D:function(){return Rd(rt,ht,d,x,T,1,H)},filter:function(){return om(rt,Et,ht.shape,d,x,T,H)}}});return ye?Ge.as3D(Ge.shape[1],Ge.shape[2],Ge.shape[3]):Ge}function im(b){var h=function(T){return typeof T=="number"?[T,T,T]:T.length===2?[T[0],T[1],1]:T}(b),u=h[0],d=h[1],x=h[2];return u===1&&d===1&&x===1}function ed(b,h,u,d,x){Ce(b.length===h.rank,function(){return"Length of inShape ("+b.length+") and rank of dy ("+h.rank+") must match"});var T=b,H=h,Z=!1;h.rank===4&&(Z=!0,H=h.as5D(1,h.shape[0],h.shape[1],h.shape[2],h.shape[3]),T=[1,b[0],b[1],b[2],b[3]]);var ce=T[4],ye=H.shape[4];Ce(T.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+T.length+"."}),Ce(H.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+H.rank}),Ce(u.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+u.rank}),Ce(ce===u.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+ce+") must match input depth for filter "+u.shape[3]+"."}),Ce(ye===u.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+ye+") must match output depth for filter "+u.shape[4]+"."});var Ee=Bl(T,u.shape,d,1,x),je=He.runKernelFunc(function(Pe){return Pe.conv3dDerInput(H,u,Ee)},{dy5D:H});return Z?je.as4D(je.shape[1],je.shape[2],je.shape[3],je.shape[4]):je}var fp=Tt({conv1d_:function(b,h,u,d,x,T,H){x===void 0&&(x="NWC"),T===void 0&&(T=1);var Z=Ze(b,"x","conv1d"),ce=Ze(h,"filter","conv1d"),ye=Z,Ee=!1;Z.rank===2&&(Ee=!0,ye=Z.as3D(1,Z.shape[0],Z.shape[1])),Ce(ye.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+ye.rank+"."}),Ce(ce.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+ce.rank+"."}),H!=null&&Ce(on(d),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+H+" but got pad "+d+"."}),Ce(ye.shape[2]===ce.shape[1],function(){return"Error in conv1d: depth of input ("+ye.shape[2]+") must match input depth for filter "+ce.shape[1]+"."}),Ce(ju(u,T),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+u+" and dilation '"+T+"'"}),Ce(x==="NWC",function(){return"Error in conv1d: got dataFormat of "+x+" but only NWC is currently supported."});var je=ce.as4D(1,ce.shape[0],ce.shape[1],ce.shape[2]),Pe=ye.as4D(ye.shape[0],1,ye.shape[1],ye.shape[2]),ze=Rd(Pe,je,[1,u],d,"NHWC",[1,T],H);return Ee?ze.as2D(ze.shape[2],ze.shape[3]):ze.as3D(ze.shape[0],ze.shape[2],ze.shape[3])}}),Rd=Tt({conv2d_:function(b,h,u,d,x,T,H){x===void 0&&(x="NHWC"),T===void 0&&(T=[1,1]);var Z=Ze(b,"x","conv2d"),ce=Ze(h,"filter","conv2d"),ye=Z,Ee=!1;Z.rank===3&&(Ee=!0,ye=Z.as4D(1,Z.shape[0],Z.shape[1],Z.shape[2])),Ce(ye.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+ye.rank+"."}),Ce(ce.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+ce.rank+"."}),H!=null&&Ce(on(d),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+H+" but got pad "+d+"."});var je=x==="NHWC"?ye.shape[3]:ye.shape[1];Ce(je===ce.shape[2],function(){return"Error in conv2d: depth of input ("+je+") must match input depth for filter "+ce.shape[2]+"."}),Ce(ju(u,T),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+T+"'"});var Pe=ts(x),ze=wu(ye.shape,ce.shape,u,T,d,H,!1,Pe),Ge=[ce,ye],rt=He.runKernelFunc(function(it,ht){var Et=it.conv2d(ye,ce,ze);return ht([ce,ye]),Et},{x:ye,filter:ce},function(it,ht){var Et=ht,At=Et[0],St=Et[1];return Ce(js(T),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+T+"'"}),{x:function(){return Ym(St.shape,it,At,u,d,x)},filter:function(){return om(St,it,At.shape,u,d,x)}}},"Conv2D",ze,Ge);return Ee?rt.as3D(rt.shape[1],rt.shape[2],rt.shape[3]):rt}}),td=Tt({conv3d_:function(b,h,u,d,x,T){x===void 0&&(x="NDHWC"),T===void 0&&(T=[1,1,1]);var H=Ze(b,"x","conv3d"),Z=Ze(h,"filter","conv3d"),ce=H,ye=!1;H.rank===4&&(ye=!0,ce=H.as5D(1,H.shape[0],H.shape[1],H.shape[2],H.shape[3])),Ce(ce.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+ce.rank+"."}),Ce(Z.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+Z.rank+"."}),Ce(ce.shape[4]===Z.shape[3],function(){return"Error in conv3d: depth of input ("+ce.shape[4]+") must match input depth for filter "+Z.shape[3]+"."}),Ce(function(Pe,ze){return im(u)||im(ze)}(0,T),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+T+"'"}),Ce(x==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+x+" but only NDHWC is currently supported."});var Ee=Bl(ce.shape,Z.shape,u,T,d),je=He.runKernelFunc(function(Pe,ze){var Ge=Pe.conv3d(ce,Z,Ee);return ze([ce,Z]),Ge},{x:ce,$filter:Z},function(Pe,ze){Ce(im(T),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+T+"'"});var Ge=ze[0],rt=ze[1];return{x:function(){return ed(Ge.shape,Pe,rt,u,d)},$filter:function(){return function(it,ht,Et,At,St){var Gt=it;it.rank===4&&(Gt=it.as5D(1,it.shape[0],it.shape[1],it.shape[2],it.shape[3]));var un=ht;un.rank===4&&(un=ht.as5D(1,ht.shape[0],ht.shape[1],ht.shape[2],ht.shape[3])),Ce(Gt.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+Gt.shape+"."}),Ce(un.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+un.shape+"."}),Ce(Et.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+Et+"."}),Ce(Gt.shape[4]===Et[3],function(){return"Error in conv3dDerFilter: depth of input "+Gt.shape[4]+") must match input depth in filter ("+Et[3]+"."}),Ce(un.shape[4]===Et[4],function(){return"Error in conv3dDerFilter: depth of dy ("+un.shape[4]+") must match output depth for filter ("+Et[4]+")."});var vn=Bl(Gt.shape,Et,At,1,St);return He.runKernelFunc(function(cn){return cn.conv3dDerFilter(Gt,un,vn)},{x5D:Gt,dy5D:un})}(Ge,Pe,rt.shape,u,d)}}});return ye?je.as4D(je.shape[1],je.shape[2],je.shape[3],je.shape[4]):je}}),om=Tt({conv2dDerFilter_:function(b,h,u,d,x,T,H){T===void 0&&(T="NHWC");var Z=b;b.rank===3&&(Z=b.as4D(1,b.shape[0],b.shape[1],b.shape[2]));var ce=h;ce.rank===3&&(ce=h.as4D(1,h.shape[0],h.shape[1],h.shape[2])),Ce(Z.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+Z.shape+"."}),Ce(ce.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+ce.shape+"."}),Ce(u.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+u+"."});var ye=T==="NHWC"?Z.shape[3]:Z.shape[1],Ee=T==="NHWC"?ce.shape[3]:ce.shape[1];Ce(ye===u[2],function(){return"Error in conv2dDerFilter: depth of input "+ye+") must match input depth in filter ("+u[2]+"."}),Ce(Ee===u[3],function(){return"Error in conv2dDerFilter: depth of dy ("+Ee+") must match output depth for filter ("+u[3]+")."}),H!=null&&Ce(on(x),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+H+" but got pad "+x+"."});var je=ts(T),Pe=wu(Z.shape,u,d,1,x,H,!1,je);return He.runKernelFunc(function(ze){return ze.conv2dDerFilter(Z,ce,Pe)},{x4D:Z,dy4D:ce})}}),Ym=Tt({conv2dDerInput_:zg}),hp=Tt({depthwiseConv2d_:function(b,h,u,d,x,T,H){T===void 0&&(T=[1,1]);var Z=Ze(b,"x","depthwiseConv2d"),ce=Ze(h,"filter","depthwiseConv2d"),ye=Z,Ee=!1;Z.rank===3&&(Ee=!0,ye=Z.as4D(1,Z.shape[0],Z.shape[1],Z.shape[2])),Ce(ye.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+ye.rank+"."}),Ce(ce.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+ce.rank+"."}),Ce(ye.shape[3]===ce.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+ye.shape[3]+") must match the inChannels dimension in filter "+ce.shape[2]+"."}),T==null&&(T=[1,1]),Ce(ju(u,T),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+T+"'"}),H!=null&&Ce(on(d),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+H+" but got pad "+d+"."});var je=wu(ye.shape,ce.shape,u,T,d,H,!0),Pe=[ye,ce],ze=He.runKernelFunc(function(Ge,rt){var it=Ge.depthwiseConv2D(ye,ce,je);return rt([ye,ce]),it},{x:ye,filter:ce},function(Ge,rt){Ce(js(T),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+T+"'"});var it=rt[0],ht=rt[1];return{x:function(){return dp(it.shape,Ge,ht,je)},filter:function(){return am(it,Ge,ht.shape,je)}}},"DepthwiseConv2dNative",je,Pe);return Ee?ze.as3D(ze.shape[1],ze.shape[2],ze.shape[3]):ze}}),dp=Tt({depthwiseConv2dDerInput_:function(b,h,u,d){var x=h,T=!1;h.rank===3&&(T=!0,x=h.as4D(1,h.shape[0],h.shape[1],h.shape[2]));var H=He.runKernelFunc(function(Z){return Z.depthwiseConv2DDerInput(x,u,d)},{dy4D:x});return T?H.as3D(H.shape[1],H.shape[2],H.shape[3]):H}}),am=Tt({depthwiseConv2dDerFilter_:function(b,h,u,d){var x=b;b.rank===3&&(x=b.as4D(1,b.shape[0],b.shape[1],b.shape[2]));var T=h;return T.rank===3&&(T=h.as4D(1,h.shape[0],h.shape[1],h.shape[2])),He.runKernelFunc(function(H){return H.depthwiseConv2DDerFilter(x,T,d)},{x4D:x,dy4D:T})}}),gf=Tt({separableConv2d_:function(b,h,u,d,x,T,H){T===void 0&&(T=[1,1]),H===void 0&&(H="NHWC");var Z=Ze(b,"x","separableConv2d"),ce=Ze(h,"depthwiseFilter","separableConv2d"),ye=Ze(u,"pointwiseFilter","separableConv2d"),Ee=Z,je=!1;if(Z.rank===3&&(je=!0,Ee=Z.as4D(1,Z.shape[0],Z.shape[1],Z.shape[2])),H==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Ce(Ee.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+Ee.rank+"."}),Ce(ce.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+ce.rank+"."}),Ce(ye.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+ce.rank+"."}),Ce(ye.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+ye.shape[0]+"."}),Ce(ye.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+ye.shape[1]+"."});var Pe=ce.shape[2],ze=ce.shape[3];Ce(ye.shape[2]===Pe*ze,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+Pe*ze+", but got "+ye.shape[2]+"."});var Ge=hp(Ee,ce,d,x,H,T),rt=Rd(Ge,ye,1,"valid",H);return je?rt.as3D(rt.shape[1],rt.shape[2],rt.shape[3]):rt}}),Uc=Tt({conv2dTranspose_:function(b,h,u,d,x,T){return zg(u,Ze(b,"x","conv2dTranspose"),Ze(h,"filter","conv2dTranspose"),d,x,"NHWC",T)}}),K0=Tt({conv3dTranspose_:function(b,h,u,d,x){return ed(u,Ze(b,"x","conv3dTranspose"),Ze(h,"filter","conv3dTranspose"),d,x)}}),Ug=Tt({matMul_:function(b,h,u,d){var x;u===void 0&&(u=!1),d===void 0&&(d=!1);var T=Ze(b,"a","matMul"),H=Ze(h,"b","matMul");x=_n(T,H),T=x[0],H=x[1];var Z=u?T.shape[T.rank-2]:T.shape[T.rank-1],ce=d?H.shape[H.rank-1]:H.shape[H.rank-2],ye=u?T.shape[T.rank-1]:T.shape[T.rank-2],Ee=d?H.shape[H.rank-2]:H.shape[H.rank-1],je=T.shape.slice(0,-2),Pe=H.shape.slice(0,-2),ze=Qe(je),Ge=Qe(Pe);Ce(T.rank>=2&&H.rank>=2&&T.rank===H.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+T.rank+" and "+H.rank+"."}),Ce(fn(je,Pe),function(){return"Error in matMul: outer dimensions ("+je+") and ("+Pe+") of Tensors with shapes "+T.shape+" and "+H.shape+" must match."}),Ce(Z===ce,function(){return"Error in matMul: inner shapes ("+Z+") and ("+ce+") of Tensors with shapes "+T.shape+" and "+H.shape+" and transposeA="+u+" and transposeB="+d+" must match."});var rt=T.shape.slice(0,-2).concat([ye,Ee]),it=u?T.as3D(ze,Z,ye):T.as3D(ze,ye,Z),ht=d?H.as3D(Ge,Ee,ce):H.as3D(Ge,ce,Ee),Et={transposeA:u,transposeB:d};return He.runKernelFunc(function(At,St){var Gt=At.batchMatMul(it,ht,u,d);return St([it,ht]),Gt},{a:it,b:ht},function(At,St){var Gt=St,un=Gt[0],vn=Gt[1];return u||d?!u&&d?{a:function(){return At.matMul(vn,!1,!1)},b:function(){return At.matMul(un,!0,!1)}}:u&&!d?{a:function(){return vn.matMul(At,!1,!0)},b:function(){return un.matMul(At,!1,!1)}}:{a:function(){return vn.matMul(At,!0,!0)},b:function(){return At.matMul(un,!0,!0)}}:{a:function(){return At.matMul(vn,!1,!0)},b:function(){return un.matMul(At,!0,!1)}}},"BatchMatMul",Et).reshape(rt)}}),sm=Tt({dot_:function(b,h){var u=Ze(b,"t1","dot"),d=Ze(h,"t2","dot");Ce(!(u.rank!==1&&u.rank!==2||d.rank!==1&&d.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+u.rank+" and "+d.rank+"."});var x=u.rank===1?u.size:u.shape[1],T=d.rank===1?d.size:d.shape[0];return Ce(x===T,function(){return"Error in dot: inner dimensions of inputs must match, but got "+x+" and "+T+"."}),u.rank===1&&d.rank===1?u.as2D(1,-1).matMul(d.as2D(-1,1)).asScalar():u.rank===1&&d.rank===2?u.as2D(1,-1).matMul(d.as2D(d.shape[0],d.shape[1])).as1D():u.rank===2&&d.rank===1?u.matMul(d.as2D(-1,1)).as1D():u.matMul(d.as2D(d.shape[0],d.shape[1]))}}),d0=Tt({outerProduct_:function(b,h){var u=Ze(b,"v1","outerProduct"),d=Ze(h,"v2","outerProduct");return Ce(u.rank===1&&d.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+u.rank+" and "+d.rank+"."}),u.as2D(-1,1).matMul(d.as2D(1,-1))}}),nd=Tt({reverse_:function(b,h){var u=Ze(b,"x","reverse");if(u.rank===0)return u.clone();var d=Tn(h,u.shape);return He.runKernelFunc(function(x){return x.reverse(u,d)},{$x:u},function(x){return{$x:function(){return x.reverse(d)}}}).reshapeAs(u)}}),p0=Tt({reverse1d_:function(b){var h=Ze(b,"x","reverse");return Ce(h.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+h.rank+"."}),nd(h,0)}}),um=Tt({reverse2d_:function(b,h){var u=Ze(b,"x","reverse");return Ce(u.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+u.rank+"."}),nd(u,h)}}),Jm=Tt({reverse3d_:function(b,h){var u=Ze(b,"x","reverse");return Ce(u.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+u.rank+"."}),nd(u,h)}}),m0=Tt({reverse4d_:function(b,h){var u=Ze(b,"x","reverse");return Ce(u.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+u.rank+"."}),nd(u,h)}});function g0(b,h,u,d,x,T){var H=Ze(b,"x","maxPool"),Z=H,ce=!1;H.rank===3&&(ce=!0,Z=H.as4D(1,H.shape[0],H.shape[1],H.shape[2])),d==null&&(d=[1,1]),Ce(Z.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+Z.rank+"."}),Ce(ju(u,d),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+d+"'"}),T!=null&&Ce(on(x),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+T+" but got pad "+x+"."});var ye=yl(Z.shape,h,u,d,x,T);if(ye.filterWidth===1&&ye.filterHeight===1&&fn(ye.inShape,ye.outShape))return H.clone();var Ee=[Z],je=He.runKernelFunc(function(Pe,ze){var Ge=Pe.maxPool(Z,ye);return ze([Z,Ge]),Ge},{x:Z},function(Pe,ze){var Ge=ze[0],rt=ze[1];return{x:function(){return function(it,ht,Et,At,St,Gt,un,vn){var cn=Ze(it,"dy","maxPoolBackprop"),kn=Ze(ht,"input","maxPoolBackprop"),On=Ze(Et,"output","maxPoolBackprop");Ce(kn.rank===cn.rank,function(){return"Rank of input ("+kn.rank+") does not match rank of dy ("+cn.rank+")"}),Gt==null&&(Gt=[1,1]),Ce(ju(St,Gt),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+St+" and dilations '"+Gt+"'"}),Ce(cn.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+cn.rank+"."}),Ce(kn.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+kn.rank+"."});var p=yl(kn.shape,At,St,Gt,un,vn);return He.runKernelFunc(function(c){return c.maxPoolBackprop(cn,kn,On,p)},{$dy:cn,$input:kn})}(Pe,Ge,rt,h,u,d,x)}}},"MaxPool",ye,Ee);return ce?je.as3D(je.shape[1],je.shape[2],je.shape[3]):je}function Wg(b,h,u,d,x,T){var H=Ze(b,"x","avgPool","float32");d==null&&(d=[1,1]),Ce(ju(u,d),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+d+"'"});var Z=H,ce=!1;H.rank===3&&(ce=!0,Z=H.as4D(1,H.shape[0],H.shape[1],H.shape[2])),Ce(Z.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+Z.rank+"."}),T!=null&&Ce(on(x),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+T+" but got pad "+x+"."});var ye=yl(Z.shape,h,u,d,x,T);if(ye.filterWidth===1&&ye.filterHeight===1&&fn(ye.inShape,ye.outShape))return H.clone();var Ee=He.runKernelFunc(function(je){return je.avgPool(Z,ye)},{x:Z},function(je){return{x:function(){return function(Pe,ze,Ge,rt,it,ht){var Et=Ze(Pe,"dy","avgPoolBackprop"),At=Ze(ze,"input","avgPoolBackprop");Ce(At.rank===Et.rank,function(){return"Rank of input ("+At.rank+") does not match rank of dy ("+Et.rank+")"}),it==null&&(it=[1,1]),Ce(ju(rt,it),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+rt+" and dilations '"+it+"'"});var St=At,Gt=Et,un=!1;At.rank===3&&(un=!0,St=At.as4D(1,At.shape[0],At.shape[1],At.shape[2]),Gt=Et.as4D(1,Et.shape[0],Et.shape[1],Et.shape[2])),Ce(Gt.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+Gt.rank+"."}),Ce(St.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+St.rank+"."});var vn=yl(St.shape,Ge,rt,it,ht),cn=He.runKernelFunc(function(kn){return kn.avgPoolBackprop(Gt,St,vn)},{dy4D:Gt,input4D:St});return un?cn.as3D(cn.shape[1],cn.shape[2],cn.shape[3]):cn}(je,Z,h,u,d,x)}}},"AvgPool",ye);return Ee=Ee.cast(H.dtype),ce?Ee.as3D(Ee.shape[1],Ee.shape[2],Ee.shape[3]):Ee}var v0=Tt({maxPool_:function(b,h,u,d,x){return g0(b,h,u,1,d,x)}}),y0=Tt({avgPool_:function(b,h,u,d,x){return Wg(b,h,u,1,d,x)}}),rd=Tt({pool_:function(b,h,u,d,x,T){x==null&&(x=[1,1]),T==null&&(T=1),d===0&&(d="valid");var H=Ze(b,"x","maxPool"),Z=H,ce=!1;H.rank===3&&(ce=!0,Z=H.as4D(1,H.shape[0],H.shape[1],H.shape[2])),Ce(ju(T,x),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+T+" and dilations '"+x+"'"});var ye,Ee=yl(Z.shape,h,T,x,d),je=[Ee.dilationHeight,Ee.dilationWidth];ye=d==="same"?function(St,Gt){var un=St.map(function(kn,On){return kn+(kn-1)*(Gt[On]-1)}).map(function(kn){return kn-1}),vn=un.map(function(kn){return Math.floor(kn/2)}),cn=un.map(function(kn,On){return kn-vn[On]});return un.map(function(kn,On){return[vn[On],cn[On]]})}([Ee.filterHeight,Ee.filterWidth],je):[[0,0],[0,0]];var Pe=je[0]===1&&je[1]===1,ze=function(St,Gt,un){var vn=un.map(function(c){return c[0]}),cn=un.map(function(c){return c[1]}),kn=St.concat(vn,cn),On=Gt.map(function(c,a){return(c-kn[a]%c)%c}),p=cn.map(function(c,a){return c+On[a]});return[Gt.map(function(c,a){return[vn[a],p[a]]}),Gt.map(function(c,a){return[0,On[a]]})]}([Ee.inHeight,Ee.inWidth],je,ye),Ge=ze[0],rt=ze[1],it=Pe?d:"valid",ht=Pe?Z:Ms(Z,je,Ge),Et=(u==="avg"?function(){return Wg(ht,h,T,1,it)}:function(){return g0(ht,h,T,1,it)})(),At=Pe?Et:cr(Et,je,rt);return ce?At.as3D(At.shape[1],At.shape[2],At.shape[3]):At}}),b0=Tt({maxPool3d_:function(b,h,u,d,x,T,H){T===void 0&&(T="NDHWC");var Z=Ze(b,"x","maxPool3d"),ce=Z,ye=!1;Z.rank===4&&(ye=!0,ce=Z.as5D(1,Z.shape[0],Z.shape[1],Z.shape[2],Z.shape[3])),H==null&&(H=[1,1,1]),Ce(ce.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+ce.rank+"."}),Ce(T==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+T}),Ce(ju(u,H),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+H+"'"}),x!=null&&Ce(on(d),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+x+" but got pad "+d+"."});var Ee=nl(ce.shape,h,u,H,d,x,T),je=He.runKernelFunc(function(Pe,ze){var Ge=Pe.maxPool3d(ce,Ee);return ze([ce,Ge]),Ge},{x:ce},function(Pe,ze){var Ge=ze[0],rt=ze[1];return{x:function(){return function(it,ht,Et,At,St,Gt,un,vn){var cn=Ze(it,"dy","maxPool3dBackprop"),kn=Ze(ht,"input","maxPool3dBackprop"),On=Ze(Et,"output","maxPool3dBackprop"),p=cn,c=kn,a=On,l=!1;kn.rank===4&&(l=!0,p=cn.as5D(1,cn.shape[0],cn.shape[1],cn.shape[2],cn.shape[3]),c=kn.as5D(1,kn.shape[0],kn.shape[1],kn.shape[2],kn.shape[3]),a=On.as5D(1,On.shape[0],On.shape[1],On.shape[2],On.shape[3])),Ce(p.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+p.rank+"."}),Ce(c.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+c.rank+"."}),Ce(a.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+a.rank+"."}),Gt==null&&(Gt=[1,1,1]),Ce(ju(St,Gt),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+St+" and dilations '"+Gt+"'"}),vn!=null&&Ce(on(un),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+vn+" but got pad "+un+"."});var y=nl(c.shape,At,St,Gt,un,vn),S=He.runKernelFunc(function(U){return U.maxPool3dBackprop(p,c,a,y)},{dy5D:p,input5D:c});return l?S.as4D(S.shape[1],S.shape[2],S.shape[3],S.shape[4]):S}(Pe,Ge,rt,h,u,H,d,x)}}});return ye?je.as4D(je.shape[1],je.shape[2],je.shape[3],je.shape[4]):je}}),Vg=Tt({avgPool3d_:function(b,h,u,d,x,T,H){T===void 0&&(T="NDHWC");var Z=Ze(b,"x","avgPool3d","float32"),ce=Z,ye=!1;Z.rank===4&&(ye=!0,ce=Z.as5D(1,Z.shape[0],Z.shape[1],Z.shape[2],Z.shape[3])),H==null&&(H=[1,1,1]),Ce(ce.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+ce.rank+"."}),Ce(T==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+T}),Ce(ju(u,H),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+H+"'"}),x!=null&&Ce(on(d),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+x+" but got pad "+d+"."});var Ee=nl(ce.shape,h,u,H,d,x,T),je=He.runKernelFunc(function(Pe){return Pe.avgPool3d(ce,Ee)},{x:ce},function(Pe){return{x:function(){return function(ze,Ge,rt,it,ht,Et,At){var St=Ze(ze,"dy","avgPool3dBackprop"),Gt=Ze(Ge,"input","avgPool3dBackprop"),un=St,vn=Gt,cn=!1;Gt.rank===4&&(cn=!0,un=St.as5D(1,St.shape[0],St.shape[1],St.shape[2],St.shape[3]),vn=Gt.as5D(1,Gt.shape[0],Gt.shape[1],Gt.shape[2],Gt.shape[3])),Ce(un.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+un.rank+"."}),Ce(vn.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+vn.rank+"."}),ht==null&&(ht=[1,1,1]),Ce(ju(it,ht),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+it+" and dilations '"+ht+"'"}),At!=null&&Ce(on(Et),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+At+" but got pad "+Et+"."});var kn=nl(vn.shape,rt,it,ht,Et,At),On=He.runKernelFunc(function(p){return p.avgPool3dBackprop(un,vn,kn)},{dy5D:un,input5D:vn});return cn?On.as4D(On.shape[1],On.shape[2],On.shape[3],On.shape[4]):On}(Pe,ce,h,u,H,d,x)}}});return je=je.cast(ce.dtype),ye?je.as4D(je.shape[1],je.shape[2],je.shape[3],je.shape[4]):je}}),mh=Tt({slice_:function(b,h,u){var d,x,T=Ze(b,"x","slice");if(T.rank===0)throw new Error("Slicing scalar is not possible");(d=typeof h=="number"?[h].concat(new Array(T.rank-1).fill(0)):h.length<T.rank?h.concat(new Array(T.rank-h.length).fill(0)):h.slice()).forEach(function(ce){Ce(ce!==-1,function(){return"slice() does not support negative begin indexing."})}),x=(x=u==null?new Array(T.rank).fill(-1):typeof u=="number"?[u].concat(new Array(T.rank-1).fill(-1)):u.length<T.rank?u.concat(new Array(T.rank-u.length).fill(-1)):u).map(function(ce,ye){return ce>=0?ce:(Ce(ce===-1,function(){return"Negative size values should be exactly -1 but got "+ce+" for the slice() size at index "+ye+"."}),T.shape[ye]-d[ye])}),Wh(T,d,x);var H=T.shape,Z={begin:d,size:x};return He.runKernelFunc(function(ce){return ce.slice(T,d,x)},{x:T},function(ce){for(var ye=[],Ee=0;Ee<ce.rank;Ee++)ye.push([d[Ee],H[Ee]-d[Ee]-x[Ee]]);return{x:function(){return ce.pad(ye)}}},"Slice",Z)}}),qg=Tt({slice1d_:function(b,h,u){var d=Ze(b,"x","slice1d");return Ce(d.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+d.rank+" tensor"}),mh(d,[h],[u])}}),x0=Tt({slice2d_:function(b,h,u){var d=Ze(b,"x","slice2d");return Ce(d.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+d.rank+" tensor"}),mh(d,h,u)}}),id=Tt({slice3d_:function(b,h,u){var d=Ze(b,"x","slice3d");return Ce(d.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+d.rank+" tensor"}),mh(d,h,u)}}),gh=Tt({slice4d_:function(b,h,u){var d=Ze(b,"x","slice4d");return Ce(d.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+d.rank+" tensor"}),mh(d,h,u)}});function Qm(b,h,u,d,x){return h.rank<u.rank&&(h=h.reshape(Ea(h.shape,d))),b.rank<u.rank&&(b=b.reshape(Ea(b.shape,d))),{x:function(){var T=b.mul(u.equal(h).cast(b.dtype));return x==null?T:T.transpose(x)}}}var Hg=Tt({all_:function(b,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ze(b,"x","all","bool"),x=Tn(h,d.shape),T=x,H=Fs(T,d.rank);H!=null&&(d=d.transpose(H),T=Rs(T.length,d.rank));var Z=He.runKernelFunc(function(ye){return ye.all(d,T)},{$x:d});if(u){var ce=Ea(Z.shape,x);return Z.reshape(ce)}return Z}}),vf=Tt({any_:function(b,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ze(b,"x","any","bool"),x=Tn(h,d.shape),T=x,H=Fs(T,d.rank);H!=null&&(d=d.transpose(H),T=Rs(T.length,d.rank));var Z=He.runKernelFunc(function(ye){return ye.any(d,T)},{$x:d});if(u){var ce=Ea(Z.shape,x);return Z.reshape(ce)}return Z}}),Gg=Tt({argMax_:function(b,h){h===void 0&&(h=0);var u=Ze(b,"x","argMax");h==null&&(h=0);var d=Tn(h,u.shape),x=Fs(d,u.rank);x!=null&&(u=u.transpose(x),d=Rs(d.length,u.rank));var T={axis:d[0]},H=[u];return He.runKernelFunc(function(Z,ce){var ye=Z.argMax(u,d[0]);return ce([u]),ye},{x:u},function(Z,ce){var ye=ce[0];return{x:function(){return Ri(ye)}}},"ArgMax",T,H)}}),w0=Tt({argMin_:function(b,h){h===void 0&&(h=0);var u=Ze(b,"x","argMin");h==null&&(h=0);var d=Tn(h,u.shape),x=Fs(d,u.rank);return x!=null&&(u=u.transpose(x),d=Rs(d.length,u.rank)),He.runKernelFunc(function(T,H){var Z=T.argMin(u,d[0]);return H([u]),Z},{$x:u},function(T,H){var Z=H[0];return{$x:function(){return Ri(Z)}}})}}),Uu=Tt({logSumExp_:function(b,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ze(b,"x","logSumExp"),x=Tn(h,d.shape),T=d.max(x,!0),H=d.sub(T).exp().sum(x).log(),Z=T.reshape(H.shape).add(H);if(u){var ce=Ea(Z.shape,x);return Z.reshape(ce)}return Z}}),X0=Tt({max_:function(b,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ze(b,"x","max"),x=d,T=Tn(h,d.shape),H=T,Z=Fs(H,d.rank);Z!=null&&(d=d.transpose(Z),H=Rs(H.length,d.rank));var ce=[d],ye=He.runKernelFunc(function(je,Pe){var ze=je.max(d,H);return Pe([x,ze]),ze},{x:d},function(je,Pe){return Qm(je,Pe[1],Pe[0],T,Z)},"Max",{axes:H},ce,[!0]);if(u){var Ee=Ea(ye.shape,T);ye=ye.reshape(Ee)}return ye}}),pp=Tt({mean_:function(b,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ze(b,"x","mean"),x=Tn(h,d.shape),T=Qe(pa(d.shape,x)[1]);return Ju(function(H){var Z=Mr(T);return{value:(Z.dtype===H.dtype?H:H.cast(Z.dtype)).div(Z).sum(h,u),gradFunc:function(ce){var ye=H.shape.slice();return x.forEach(function(Ee){ye[Ee]=1}),ce.reshape(ye).mul(Xu(H.shape,"float32")).div(T)}}})(d)}}),mp=Tt({min_:function(b,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ze(b,"x","min"),x=d,T=Tn(h,d.shape),H=T,Z=Fs(H,d.rank);Z!=null&&(d=d.transpose(Z),H=Rs(H.length,d.rank));var ce=[d],ye=He.runKernelFunc(function(je,Pe){var ze=je.min(d,H);return Pe([x,ze]),ze},{x:d},function(je,Pe){return Qm(je,Pe[1],Pe[0],T,Z)},"Min",{axes:H},ce,[!0]);if(u){var Ee=Ea(ye.shape,T);ye=ye.reshape(Ee)}return ye}}),vh=Tt({moments_:function(b,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Tn(h,(b=Ze(b,"x","moments")).shape),x=b.mean(d,u),T=x.shape;return u||(T=Ea(x.shape,d)),{mean:x,variance:b.toFloat().sub(x.reshape(T)).square().mean(d,u)}}}),k0=Tt({sum_:function(b,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ze(b,"x","sum");d.dtype==="bool"&&(d=d.toInt());var x=Tn(h,d.shape);return Ju(function(T){var H=Fs(x,T.rank),Z=x,ce=T;H!=null&&(ce=T.transpose(H),Z=Rs(Z.length,T.rank));var ye=function(ze){var Ge=T.shape.slice();return x.forEach(function(rt){Ge[rt]=1}),ze.reshape(Ge).mul(Xu(T.shape,"float32"))},Ee={axes:Z},je=He.runKernelFunc(function(ze){return ze.sum(ce,Z)},{x:ce},function(ze){return{x:function(){return ye(ze)}}},"Sum",Ee);if(u){var Pe=Ea(je.shape,x);je=je.reshape(Pe)}return{value:je,gradFunc:ye}})(d)}}),Md=Tt({prod_:function(b,h,u){h===void 0&&(h=null),u===void 0&&(u=!1);var d=Ze(b,"x","prod");d.dtype==="bool"&&(d=d.toInt());var x=Tn(h,d.shape),T=Fs(x,d.rank),H=x,Z=d;T!=null&&(Z=d.transpose(T),H=Rs(H.length,d.rank));var ce=He.runKernelFunc(function(Ee){return Ee.prod(Z,H)},{permutedX:Z});if(u){var ye=Ea(ce.shape,x);ce=ce.reshape(ye)}return ce}}),yf=Tt({elu_:function(b){var h=Ze(b,"x","elu");return He.runKernelFunc(function(u,d){var x=u.elu(h);return d([x]),x},{$x:h},function(u,d){var x=d[0];return{$x:function(){return He.runKernelFunc(function(T){return T.eluDer(u,x)},{dy:u,y:x})}}})}}),gp=Tt({leakyRelu_:function(b,h){h===void 0&&(h=.2);var u=Ze(b,"x","leakyRelu");return to(Mr(h).mul(u),u)}}),jd=Tt({prelu_:function(b,h){var u=Ze(b,"x","prelu"),d=Ze(h,"alpha","prelu");return He.runKernelFunc(function(x,T){var H=x.prelu(u,d);return T([u,d]),H},{x:u,alpha:d},function(x,T){var H=T[0],Z=T[1],ce=H.greater(0);return{x:function(){return Ko(ce,x,x.mul(Z))},alpha:function(){var ye=Ko(ce,Ri(x),x.mul(H)),Ee=Ds(Z.shape,x.shape);return Ee.length>0&&(ye=ye.sum(Ee)),ye.reshape(Z.shape)}}},"Prelu")}}),Zm=Tt({relu_:function(b){var h=Ze(b,"x","relu");return h.dtype==="bool"?h.toInt():He.runKernelFunc(function(u,d){var x=u.relu(h);return d([h]),x},{x:h},function(u,d){var x=d[0];return{x:function(){return u.mulStrict(x.step().toFloat())}}},"Relu")}}),$g=Tt({relu6_:function(b){var h=Ze(b,"x","relu6");return h.dtype==="bool"?h.toInt():He.runKernelFunc(function(u,d){var x=u.relu6(h);return d([h]),x},{x:h},function(u,d){var x=d[0],T=x.lessEqual(6).mul(x.step());return{x:function(){return u.mulStrict(T.toFloat())}}},"Relu6")}}),_0=Tt({selu_:function(b){var h=Ze(b,"x","selu");return He.runKernelFunc(function(u,d){var x=u.selu(h);return d([h]),x},{$x:h},function(u,d){var x=d[0];return{$x:function(){var T=x.greater(Mr(0)),H=Mr(rl),Z=Mr(ah),ce=u.mul(Z),ye=u.mul(H).mul(x.toFloat().exp());return Ko(T,ce,ye)}}})}}),Eu=Tt({transpose_:function(b,h){var u=Ze(b,"x","transpose");if(h==null&&(h=u.shape.map(function(x,T){return T}).reverse()),Ce(u.rank===h.length,function(){return"Error in transpose: rank of input "+u.rank+" must match length of perm "+h+"."}),h.forEach(function(x){Ce(x>=0&&x<u.rank,function(){return"All entries in 'perm' must be between 0 and "+(u.rank-1)+" but got "+h})}),u.rank<=1)return u.clone();var d={perm:h};return He.runKernelFunc(function(x){return x.transpose(u,h)},{x:u},function(x){var T=vl(h);return{x:function(){return x.transpose(T)}}},"Transpose",d)}}),E0=Tt({localResponseNormalization_:function(b,h,u,d,x){h===void 0&&(h=5),u===void 0&&(u=1),d===void 0&&(d=1),x===void 0&&(x=.5);var T=Ze(b,"x","localResponseNormalization");Ce(T.rank===4||T.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+T.rank+"."}),Ce(on(h),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+h+"."});var H=T,Z=!1;T.rank===3&&(Z=!0,H=T.as4D(1,T.shape[0],T.shape[1],T.shape[2]));var ce=He.runKernelFunc(function(ye,Ee){var je=ye.localResponseNormalization4D(H,h,u,d,x);return Ee([H,je]),je},{x4D:H},function(ye,Ee){var je=Ee[0],Pe=Ee[1];return{x4D:function(){return He.runKernelFunc(function(ze){return ze.LRNGrad(ye,je,Pe,h,u,d,x)},{})}}});return Z?ce.as3D(ce.shape[1],ce.shape[2],ce.shape[3]):ce}}),vp=Tt({norm_:function(b,h,u,d){h===void 0&&(h="euclidean"),u===void 0&&(u=null),d===void 0&&(d=!1);var x=function Z(ce,ye,Ee){if(Ee===void 0&&(Ee=null),ce.rank===0)return ce.abs();if(ce.rank!==1&&Ee===null)return Z(ce.reshape([-1]),ye,Ee);if(ce.rank===1||typeof Ee=="number"||Array.isArray(Ee)&&Ee.length===1){if(ye===1)return ce.abs().sum(Ee);if(ye===1/0)return ce.abs().max(Ee);if(ye===-1/0)return ce.abs().min(Ee);if(ye==="euclidean"||ye===2)return ce.abs().pow(Mr(2,"int32")).sum(Ee).sqrt();throw new Error("Error in norm: invalid ord value: "+ye)}if(Array.isArray(Ee)&&Ee.length===2){if(ye===1)return ce.abs().sum(Ee[0]).max(Ee[1]-1);if(ye===1/0)return ce.abs().sum(Ee[1]).max(Ee[0]);if(ye===-1/0)return ce.abs().sum(Ee[1]).min(Ee[0]);if(ye==="fro"||ye==="euclidean")return ce.square().sum(Ee).sqrt();throw new Error("Error in norm: invalid ord value: "+ye)}throw new Error("Error in norm: invalid axis: "+Ee)}(b=Ze(b,"x","norm"),h,u),T=x.shape;if(d){var H=Tn(u,b.shape);T=Ea(x.shape,H)}return x.reshape(T)}}),C0=Tt({basicLSTMCell_:function(b,h,u,d,x,T){var H=Ze(b,"forgetBias","basicLSTMCell"),Z=Ze(h,"lstmKernel","basicLSTMCell"),ce=Ze(u,"lstmBias","basicLSTMCell"),ye=Ze(d,"data","basicLSTMCell"),Ee=Ze(x,"c","basicLSTMCell"),je=Ze(T,"h","basicLSTMCell"),Pe=ye.concat(je,1).matMul(Z).add(ce),ze=Pe.shape[0],Ge=Pe.shape[1]/4,rt=[ze,Ge],it=Pe.slice([0,0],rt),ht=Pe.slice([0,Ge],rt),Et=Pe.slice([0,2*Ge],rt),At=Pe.slice([0,3*Ge],rt),St=it.sigmoid().mulStrict(ht.tanh()).addStrict(Ee.mulStrict(H.add(Et).sigmoid()));return[St,St.tanh().mulStrict(At.sigmoid())]}}),eg=Tt({multiRNNCell_:function(b,h,u,d){for(var x=Ze(h,"data","multiRNNCell"),T=tl(u,"c","multiRNNCell"),H=tl(d,"h","multiRNNCell"),Z=x,ce=[],ye=0;ye<b.length;ye++){var Ee=b[ye](Z,T[ye],H[ye]);ce.push(Ee[0]),ce.push(Ee[1]),Z=Ee[1]}var je=[],Pe=[];for(ye=0;ye<ce.length;ye+=2)je.push(ce[ye]),Pe.push(ce[ye+1]);return[je,Pe]}}),od=Tt({movingAverage_:function(b,h,u,d,x){x===void 0&&(x=!0);var T=Ze(b,"v","movingAverage"),H=Ze(h,"x","movingAverage"),Z=Ze(u,"decay","movingAverage");In(T,H),Ce(fn(T.shape,H.shape),function(){return"Shape mismatch in v and x"});var ce=Mr(1),ye=ce.sub(Z),Ee=H.sub(T).mul(ye);if(x){Ce(d!=null,function(){return"When using zeroDebias: true, step is required."});var je=Ze(d,"step","movingAverage");Ee=Ee.div(ce.sub(Id(Z,je)))}return T.add(Ee)}}),cm=Tt({stridedSlice_:function(b,h,u,d,x,T,H,Z,ce){if(x===void 0&&(x=0),T===void 0&&(T=0),H===void 0&&(H=0),Z===void 0&&(Z=0),ce===void 0&&(ce=0),d==null&&(d=new Array(h.length)),H!==0)throw new Error("ellipsis mask is not yet supported");var ye=Ze(b,"x","stridedSlice"),Ee=Os(Z),je=ye.shape.slice();Ee.forEach(function(it){h[it]=0,u[it]=1,je.splice(it,0,1)}),ye=ye.reshape(je);for(var Pe=0;Pe<ye.rank;Pe++)h[Pe]=Yu(x,h,d,ye.shape,Pe),u[Pe]=Vh(T,u,d,ye.shape,Pe),d[Pe]=d[Pe]||1;var ze=Os(ce);ze.forEach(function(it){u[it]=h[it]+1,d[it]=1});var Ge=nh(h,u,d),rt=Ge.filter(function(it,ht){return ze.indexOf(ht)===-1});return d.every(function(it){return it===1})?mh(ye,h,Ge).reshape(rt):He.runKernelFunc(function(it){return it.stridedSlice(ye,h,u,d)},{$x:ye}).reshape(rt)}}),yh=Tt({topk_:function(b,h,u){h===void 0&&(h=1),u===void 0&&(u=!0);var d=Ze(b,"x","topk");if(d.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var x=d.shape[d.shape.length-1];if(h>x)throw new Error("'k' passed to topk() must be <= the last dimension ("+x+") but got "+h);var T=He.runKernelFunc(function(H){return H.topk(d,h,u)},{$x:d});return{values:T[0],indices:T[1]}}}),A0=Tt({scatterND_:function(b,h,u){var d=Ze(b,"indices","scatterND","int32"),x=Ze(h,"updates","scatterND");return xd(x,d,u),He.runKernelFunc(function(T){return T.scatterND(d,x,u)},{indices:d,updates:x},null,"ScatterNd",{shape:u})}}),tg=Tt({fft_:function(b){Ce(b.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+b.dtype+"."});var h=b.shape[b.shape.length-1],u=b.size/h,d=b.as2D(u,h);return He.runKernelFunc(function(x){return x.fft(d)},{input:b}).reshape(b.shape)}}),ng=Tt({ifft_:function(b){Ce(b.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+b.dtype+"."});var h=b.shape[b.shape.length-1],u=b.size/h,d=b.as2D(u,h);return He.runKernelFunc(function(x){return x.ifft(d)},{input:b}).reshape(b.shape)}}),Kg=Tt({rfft_:function(b,h){Ce(b.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+b.dtype});var u,d=b.shape[b.shape.length-1],x=b.size/d;if(h!=null&&h<d){var T=b.shape.map(function(ht){return 0}),H=b.shape.map(function(ht){return ht});H[b.shape.length-1]=h,u=b.slice(T,H),d=h}else if(h!=null&&h>d){var Z=b.shape.map(function(ht){return ht});Z[b.shape.length-1]=h-d,u=b.concat(Io(Z),b.shape.length-1),d=h}else u=b;var ce=u.zerosLike(),ye=aa(u,ce).as2D(x,d),Ee=tg(ye),je=Math.floor(d/2)+1,Pe=ms(Ee),ze=Ks(Ee),Ge=Pe.split([je,d-je],Pe.shape.length-1),rt=ze.split([je,d-je],ze.shape.length-1),it=u.shape.slice();return it[u.shape.length-1]=je,aa(Ge[0],rt[0]).reshape(it)}}),Lf=Tt({irfft_:function(b){var h=b.shape[b.shape.length-1],u=b.size/h;if(h<=2){var d=b.as2D(u,h),x=ng(d);return ms(x)}var T=[u,2*(h-1)],H=ms(b).as2D(u,h),Z=Ks(b).as2D(u,h),ce=H.slice([0,1],[u,h-2]).reverse(1),ye=Z.slice([0,1],[u,h-2]).reverse(1).mul(Mr(-1)),Ee=H.concat(ce,1),je=Z.concat(ye,1);return d=aa(Ee,je).as2D(T[0],T[1]),x=ng(d),ms(x)}}),rg=Object.freeze({fft:tg,ifft:ng,rfft:Kg,irfft:Lf}),O0=Tt({sparseToDense_:function(b,h,u,d){d===void 0&&(d=0);var x=Ze(b,"sparseIndices","sparseToDense","int32"),T=Ze(h,"sparseValues","sparseToDense"),H=Ze(d,"defaultValue","sparseToDense",T.dtype);return function(Z,ce,ye,Ee){if(Z.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+Z.dtype+".");if(Z.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+Z.shape+".");var je=Z.rank>0?Z.shape[0]:1,Pe=Z.rank>1?Z.shape[1]:1;if(ye.length!==Pe)throw new Error("outputShape has incorrect number of elements:, "+ye.length+", should be: "+Pe+".");var ze=ce.size;if(ce.rank!==0&&(ce.rank!==1||ze!==je))throw new Error("sparseValues has incorrect shape "+ce.shape+", should be [] or ["+je+"]");if(ce.dtype!==Ee.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(x,T,u,H),He.runKernelFunc(function(Z){return Z.sparseToDense(x,T,u,H)},{$sparseIndices:x,$sparseValues:T,$defaultValue:H})}}),bh=Tt({gatherND_:function(b,h){var u=Ze(h,"indices","gatherND","int32"),d=Ze(b,"x","gatherND");return He.runKernelFunc(function(x){return x.gatherND(d,u)},{x:d,indices:u},null,"GatherNd")}}),lm=Tt({diag_:function(b){var h=Ze(b,"x","diag").flatten(),u=b.shape.concat(b.shape);return He.runKernelFunc(function(d){return d.diag(h)},{$x:h}).reshape(u)}}),xh=Tt({dropout_:function(b,h,u,d){var x=Ze(b,"x","dropout");if(Ce(x.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+x.dtype+" tensor instead."}),Ce(h>=0&&h<1,function(){return"rate must be a float in the range [0, 1), but got "+h+"."}),h===0)return b instanceof $t?x.clone():x;var T=function(ce,ye){if(ye==null)return ce.shape.slice();if(fn(ce.shape,ye))return ye;if(ce.shape.length===ye.length){for(var Ee=[],je=0;je<ce.shape.length;je++)ye[je]==null&&ce.shape[je]!=null?Ee.push(ce.shape[je]):Ee.push(ye[je]);return Ee}return ye}(x,u),H=1-h,Z=eh(T,0,1,"float32",d).add(H).floor().div(H);return x.mul(Z)}});function yp(b,h,u){for(var d=1-b%2,x=new Float32Array(b),T=0;T<b;++T){var H=2*Math.PI*T/(b+d-1);x[T]=h-u*Math.cos(H)}return Cc(x,"float32")}var Cu,ig=Tt({hannWindow_:function(b){return yp(b,.5,.5)}}),Xg=Tt({hammingWindow_:function(b){return yp(b,.54,.46)}}),fm=Tt({frame_:function(b,h,u,d,x){d===void 0&&(d=!1),x===void 0&&(x=0);for(var T=0,H=[];T+h<=b.size;)H.push(mh(b,T,h)),T+=u;if(d)for(;T<b.size;){var Z=T+h-b.size,ce=$a([mh(b,T,h-Z),Nu([Z],x)]);H.push(ce),T+=u}return H.length===0?sc([],[0,h]):$a(H).as2D(H.length,h)}}),hm=Tt({stft_:function(b,h,u,d,x){var T;x===void 0&&(x=ig),d==null&&(T=h,d=Math.floor(Math.pow(2,Math.ceil(Math.log(T)/Math.log(2)))));for(var H=fm(b,h,u),Z=Bf(H,x(h)),ce=[],ye=0;ye<H.shape[0];ye++)ce.push(Kg(Z.slice([ye,0],[1,h]),d));return $a(ce)}}),Yg=Object.freeze({hannWindow:ig,hammingWindow:Xg,frame:fm,stft:hm}),S0=function(b,h,u){return u===void 0&&(u=1),M(this,void 0,void 0,function(){var d,x,T,H,Z,ce,ye,Ee,je,Pe,ze,Ge,rt,it;return V(this,function(ht){switch(ht.label){case 0:return d=Ze(b,"predictions","inTopK"),x=Ze(h,"targets","inTopK"),Ce(d.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+d.rank}),Ce(d.rank-1===x.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+d.rank+" and targets rank "+x.rank}),Wt(d.shape.slice(0,d.shape.length-1),x.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),T=d.shape[d.shape.length-1],Ce(u>0&&u<=T,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+T+"), but got "+u}),[4,d.data()];case 1:return H=ht.sent(),[4,x.data()];case 2:for(Z=ht.sent(),ce=[H.length/T,T],Ee=ce[1],je=tr("bool",ye=ce[0]),Pe=0;Pe<ye;Pe++){for(ze=Pe*Ee,Ge=H.subarray(ze,ze+Ee),rt=[],it=0;it<Ge.length;it++)rt.push({value:Ge[it],index:it});for(rt.sort(function(Et,At){return At.value-Et.value}),je[Pe]=0,it=0;it<u;it++)if(rt[it].index===Z[Pe]){je[Pe]=1;break}}return b!==d&&d.dispose(),h!==x&&x.dispose(),[2,la(je,x.shape,"bool")]}})})};(function(b){b[b.NONE=0]="NONE",b[b.MEAN=1]="MEAN",b[b.SUM=2]="SUM",b[b.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Cu||(Cu={}));var Y0=Tt({absoluteDifference_:function(b,h,u,d){d===void 0&&(d=Cu.SUM_BY_NONZERO_WEIGHTS);var x=Ze(b,"labels","absoluteDifference"),T=Ze(h,"predictions","absoluteDifference"),H=null;u!=null&&(H=Ze(u,"weights","absoluteDifference")),Wt(x.shape,T.shape,"Error in absoluteDifference: ");var Z=x.sub(T).abs();return bf(Z,H,d)}}),bf=Tt({computeWeightedLoss_:function(b,h,u){u===void 0&&(u=Cu.SUM_BY_NONZERO_WEIGHTS);var d=Ze(b,"losses","computeWeightedLoss"),x=null;h!=null&&(x=Ze(h,"weights","computeWeightedLoss"));var T=x==null?d:d.mul(x);if(u===Cu.NONE)return T;if(u===Cu.SUM)return T.sum();if(u===Cu.MEAN){if(x==null)return T.mean();var H=d.size/x.size,Z=T.sum().div(x.sum());return H>1?Z.div(Mr(H)):Z}if(u===Cu.SUM_BY_NONZERO_WEIGHTS){if(x==null)return T.sum().div(Mr(d.size));var ce=x.mul(Xu(d.shape)).notEqual(Mr(0)).sum().toFloat();return T.sum().div(ce)}throw Error("Unknown reduction: "+u)}}),Bd=Tt({cosineDistance_:function(b,h,u,d,x){x===void 0&&(x=Cu.SUM_BY_NONZERO_WEIGHTS);var T=Ze(b,"labels","cosineDistance"),H=Ze(h,"predictions","cosineDistance"),Z=null;d!=null&&(Z=Ze(d,"weights","cosineDistance")),Wt(T.shape,H.shape,"Error in cosineDistance: ");var ce=Mr(1).sub(T.mul(H).sum(u,!0));return bf(ce,Z,x)}}),og=Tt({hingeLoss_:function(b,h,u,d){d===void 0&&(d=Cu.SUM_BY_NONZERO_WEIGHTS);var x=Ze(b,"labels","hingeLoss"),T=Ze(h,"predictions","hingeLoss"),H=null;u!=null&&(H=Ze(u,"weights","hingeLoss")),Wt(x.shape,T.shape,"Error in hingeLoss: ");var Z=Mr(1);x=Mr(2).mul(x).sub(Z);var ce=Z.sub(x.mul(T)).relu();return bf(ce,H,d)}}),D0=Tt({huberLoss_:function(b,h,u,d,x){d===void 0&&(d=1),x===void 0&&(x=Cu.SUM_BY_NONZERO_WEIGHTS);var T=Ze(b,"labels","huberLoss"),H=Ze(h,"predictions","huberLoss"),Z=null;u!=null&&(Z=Ze(u,"weights","huberLoss")),Wt(T.shape,H.shape,"Error in huberLoss: ");var ce=Mr(d),ye=H.sub(T).abs(),Ee=jf(ye,ce),je=ye.sub(Ee),Pe=Mr(.5).mul(Ee.square()).add(ce.mul(je));return bf(Pe,Z,x)}}),zf=Tt({logLoss_:function(b,h,u,d,x){d===void 0&&(d=1e-7),x===void 0&&(x=Cu.SUM_BY_NONZERO_WEIGHTS);var T=Ze(b,"labels","logLoss"),H=Ze(h,"predictions","logLoss"),Z=null;u!=null&&(Z=Ze(u,"weights","logLoss")),Wt(T.shape,H.shape,"Error in logLoss: ");var ce=Mr(1),ye=Mr(d),Ee=T.mul(H.add(ye).log()).neg().sub(ce.sub(T).mul(ce.sub(H).add(ye).log()));return bf(Ee,Z,x)}}),pu=Tt({meanSquaredError_:function(b,h,u,d){d===void 0&&(d=Cu.SUM_BY_NONZERO_WEIGHTS);var x=Ze(b,"labels","meanSquaredError"),T=Ze(h,"predictions","meanSquaredError"),H=null;u!=null&&(H=Ze(u,"weights","meanSquaredError")),Wt(x.shape,T.shape,"Error in meanSquaredError: ");var Z=x.squaredDifference(T);return bf(Z,H,d)}}),bp=Tt({sigmoidCrossEntropy_:function(b,h,u,d,x){d===void 0&&(d=0),x===void 0&&(x=Cu.SUM_BY_NONZERO_WEIGHTS);var T=Ze(b,"multiClassLabels","sigmoidCrossEntropy"),H=Ze(h,"logits","sigmoidCrossEntropy"),Z=null;if(u!=null&&(Z=Ze(u,"weights","sigmoidCrossEntropy")),Wt(T.shape,H.shape,"Error in sigmoidCrossEntropy: "),d>0){var ce=Mr(d),ye=Mr(1),Ee=Mr(.5);T=T.mul(ye.sub(ce)).add(Ee.mul(ce))}var je=function(Pe,ze){var Ge=Ze(Pe,"labels","sigmoidCrossEntropyWithLogits"),rt=Ze(ze,"logits","sigmoidCrossEntropyWithLogits");Wt(Ge.shape,rt.shape,"Error in sigmoidCrossEntropyWithLogits: ");var it=rt.relu(),ht=rt.mul(Ge),Et=rt.abs().neg().exp().log1p();return it.sub(ht).add(Et)}(T,H);return bf(je,Z,x)}}),dm=Tt({softmaxCrossEntropy_:function(b,h,u,d,x){d===void 0&&(d=0),x===void 0&&(x=Cu.SUM_BY_NONZERO_WEIGHTS);var T=Ze(b,"onehotLabels","softmaxCrossEntropy"),H=Ze(h,"logits","softmaxCrossEntropy"),Z=null;if(u!=null&&(Z=Ze(u,"weights","softmaxCrossEntropy")),Wt(T.shape,H.shape,"Error in softmaxCrossEntropy: "),d>0){var ce=Mr(d),ye=Mr(1),Ee=Mr(T.shape[1]);T=T.mul(ye.sub(ce)).add(ce.div(Ee))}var je=function(Pe,ze,Ge){if(Ge===void 0&&(Ge=-1),Ge===-1&&(Ge=ze.rank-1),Ge!==ze.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+ze.rank+" and dim was "+Ge);return Ju(function(rt,it,ht){var Et=it.logSumExp([Ge],!0),At=it.toFloat().sub(Et);return ht([rt,At]),{value:At.mul(rt).neg().sum([Ge]),gradFunc:function(St,Gt){var un=Gt[0],vn=Gt[1],cn=Ea(St.shape,[Ge]);return[St.reshape(cn).mul(un.toFloat().sub(vn.exp())),St.reshape(cn).mul(vn.exp().sub(un.toFloat()))]}}})(Pe,ze)}(T,H);return bf(je,Z,x)}}),ag=Object.freeze({get Reduction(){return Cu},absoluteDifference:Y0,computeWeightedLoss:bf,cosineDistance:Bd,hingeLoss:og,huberLoss:D0,logLoss:zf,meanSquaredError:pu,sigmoidCrossEntropy:bp,softmaxCrossEntropy:dm});function T0(b,h){return h===void 0&&(h=!1),He.tidy(function(){if(b.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+b.shape.length+"D Tensor.");for(var u=b.shape[0],d=b.shape[1],x=za(u),T=b.clone(),H=sc([[1]],[1,1]),Z=H.clone(),ce=u>=d?d:u,ye=function(je){var Pe,ze=T,Ge=Z,rt=x;Pe=He.tidy(function(){var it=T.slice([je,je],[u-je,1]),ht=it.norm(),Et=T.slice([je,je],[1,1]),At=sc([[-1]]).where(Et.greater(0),sc([[1]])),St=Et.sub(At.mul(ht)),Gt=it.div(St);Z=Gt.shape[0]===1?H.clone():H.concat(Gt.slice([1,0],[Gt.shape[0]-1,Gt.shape[1]]),0);var un=At.matMul(St).div(ht).neg(),vn=T.slice([je,0],[u-je,d]),cn=un.mul(Z);if(je===0)T=vn.sub(cn.matMul(Z.transpose().matMul(vn)));else{var kn=vn.sub(cn.matMul(Z.transpose().matMul(vn)));T=T.slice([0,0],[je,d]).concat(kn,0)}var On=x.slice([0,je],[u,x.shape[1]-je]);if(je===0)x=On.sub(On.matMul(Z).matMul(cn.transpose()));else{var p=On.sub(On.matMul(Z).matMul(cn.transpose()));x=x.slice([0,0],[u,je]).concat(p,1)}return[Z,T,x]}),Z=Pe[0],T=Pe[1],x=Pe[2],Oa([ze,Ge,rt])},Ee=0;Ee<ce;++Ee)ye(Ee);return!h&&u>d&&(x=x.slice([0,0],[u,d]),T=T.slice([0,0],[d,d])),[x,T]})}var sg=Tt({bandPart_:function(b,h,u){if(h%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+h+".");if(u%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+u+".");var d=Ze(b,"a","bandPart");if(d.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+d.rank+".");var x=d.shape,T=d.shape.slice(-2),H=T[0],Z=T[1];if(!(h<=H))throw new Error("bandPart(): numLower ("+h+") must not be greater than the number of rows ("+H+").");if(!(u<=Z))throw new Error("bandPart(): numUpper ("+u+") must not be greater than the number of columns ("+Z+").");h<0&&(h=H),u<0&&(u=Z);var ce=rf(0,H,1,"int32").reshape([-1,1]),ye=rf(0,Z,1,"int32"),Ee=Pf(ce,ye),je=Kh(Ee.lessEqual(Mr(+h,"int32")),Ee.greaterEqual(Mr(-u,"int32"))),Pe=Io([H,Z],d.dtype);return Co(Es(d.reshape([-1,H,Z])).map(function(ze){return Ko(je,ze,Pe)})).reshape(x)}}),ad=Tt({gramSchmidt_:function(b){var h;if(Array.isArray(b)){h=!1,Ce(b!=null&&b.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var u=b[0].shape[0],d=function(ce){Ce(b[ce].shape[0]===u,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+b[ce].shape[0]+" vs. "+u+")"})},x=1;x<b.length;++x)d(x)}else h=!0,b=_o(b,b.shape[0],0).map(function(ce){return Xs(ce,[0])});Ce(b.length<=b[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+b.length+") exceeds number of dimensions ("+b[0].shape[0]+")."});var T=[],H=b,Z=function(ce){T.push(He.tidy(function(){var ye=H[ce];if(ce>0)for(var Ee=0;Ee<ce;++Ee){var je=k0(T[Ee].mulStrict(ye)).mul(T[Ee]);ye=ye.sub(je)}return ye.div(vp(ye,"euclidean"))}))};for(x=0;x<b.length;++x)Z(x);return h?Co(T,0):T}}),xv=Tt({qr_:function(b,h){if(h===void 0&&(h=!1),b.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+b.rank);if(b.rank===2)return T0(b,h);var u=b.shape.slice(0,b.shape.length-2).reduce(function(T,H){return T*H}),d=[],x=[];return Es(b.reshape([u,b.shape[b.shape.length-2],b.shape[b.shape.length-1]]),0).forEach(function(T){var H=T0(T,h),Z=H[0],ce=H[1];d.push(Z),x.push(ce)}),[Co(d,0).reshape(b.shape),Co(x,0).reshape(b.shape)]}}),ug=Object.freeze({bandPart:sg,gramSchmidt:ad,qr:xv});function au(b,h,u,d,x,T){d==null&&(d=.5),x==null&&(x=Number.NEGATIVE_INFINITY),T==null&&(T=0);var H=b.shape[0];return u=Math.min(u,H),Ce(0<=d&&d<=1,function(){return"iouThreshold must be in [0, 1], but was '"+d+"'"}),Ce(b.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+b.rank+"'"}),Ce(b.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+b.shape[1]}),Ce(h.rank===1,function(){return"scores must be a 1D tensor"}),Ce(h.shape[0]===H,function(){return"scores has incompatible shape with boxes. Expected "+H+", but was "+h.shape[0]}),Ce(0<=T&&T<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+T+"'"}),{maxOutputSize:u,iouThreshold:d,scoreThreshold:x,softNmsSigma:T}}var pm=Tt({resizeBilinear_:function(b,h,u){u===void 0&&(u=!1);var d=Ze(b,"images","resizeBilinear");Ce(d.rank===3||d.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+d.rank+"."}),Ce(h.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+h+"."});var x=d,T=!1;d.rank===3&&(T=!0,x=d.as4D(1,d.shape[0],d.shape[1],d.shape[2]));var H=h[0],Z=h[1],ce=He.runKernelFunc(function(ye,Ee){return Ee([x]),ye.resizeBilinear(x,H,Z,u)},{x},function(ye,Ee){return{x:function(){return He.runKernelFunc(function(je){return je.resizeBilinearBackprop(ye,Ee[0],u)},{})}}},"ResizeBilinear",{alignCorners:u,newHeight:H,newWidth:Z});return T?ce.as3D(ce.shape[1],ce.shape[2],ce.shape[3]):ce}}),Pd=Tt({resizeNearestNeighbor_:function(b,h,u){u===void 0&&(u=!1);var d=Ze(b,"images","resizeNearestNeighbor");Ce(d.rank===3||d.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+d.rank+"."}),Ce(h.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+h+"."}),Ce(d.dtype==="float32"||d.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var x=d,T=!1;d.rank===3&&(T=!0,x=d.as4D(1,d.shape[0],d.shape[1],d.shape[2]));var H=h[0],Z=h[1],ce=He.runKernelFunc(function(ye,Ee){return Ee([x]),ye.resizeNearestNeighbor(x,H,Z,u)},{batchImages:x},function(ye,Ee){return{batchImages:function(){return He.runKernelFunc(function(je){return je.resizeNearestNeighborBackprop(ye,Ee[0],u)},{})}}});return T?ce.as3D(ce.shape[1],ce.shape[2],ce.shape[3]):ce}}),cg=Tt({nonMaxSuppression_:function(b,h,u,d,x){d===void 0&&(d=.5),x===void 0&&(x=Number.NEGATIVE_INFINITY);var T=Ze(b,"boxes","nonMaxSuppression"),H=Ze(h,"scores","nonMaxSuppression"),Z=au(T,H,u,d,x);u=Z.maxOutputSize,d=Z.iouThreshold,x=Z.scoreThreshold;var ce={maxOutputSize:u,iouThreshold:d,scoreThreshold:x};return He.runKernelFunc(function(ye){return ye.nonMaxSuppression(T,H,u,d,x)},{boxes:T,scores:H},null,"NonMaxSuppressionV3",ce)}}),mm=Tt({nonMaxSuppressionWithScore_:function(b,h,u,d,x,T){d===void 0&&(d=.5),x===void 0&&(x=Number.NEGATIVE_INFINITY),T===void 0&&(T=0);var H=Ze(b,"boxes","nonMaxSuppression"),Z=Ze(h,"scores","nonMaxSuppression"),ce=au(H,Z,u,d,x,T),ye={maxOutputSize:u=ce.maxOutputSize,iouThreshold:d=ce.iouThreshold,scoreThreshold:x=ce.scoreThreshold,softNmsSigma:T=ce.softNmsSigma},Ee=He.runKernel("NonMaxSuppressionV5",{boxes:H,scores:Z},ye);return{selectedIndices:Ee[0],selectedScores:Ee[1]}}}),lg=Tt({cropAndResize_:function(b,h,u,d,x,T){var H=Ze(b,"image","cropAndResize"),Z=Ze(h,"boxes","cropAndResize","float32"),ce=Ze(u,"boxInd","cropAndResize","int32");x=x||"bilinear",T=T||0;var ye=Z.shape[0];return Ce(H.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+H.rank+"."}),Ce(Z.rank===2&&Z.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+ye+",4] but had shape "+Z.shape+"."}),Ce(ce.rank===1&&ce.shape[0]===ye,function(){return"Error in cropAndResize: boxInd must be have size ["+ye+"] but had shape "+Z.shape+"."}),Ce(d.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+d.length+"."}),Ce(d[0]>=1&&d[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+d}),Ce(x==="bilinear"||x==="nearest",function(){return"method must be bilinear or nearest, but was "+x}),He.runKernelFunc(function(Ee,je){return Ee.cropAndResize(H,Z,ce,d,x,T)},{images:H,boxes:Z,boxInd:ce},null,"CropAndResize",{method:x,extrapolationValue:T,cropSize:d})}}),fg=Object.freeze({resizeBilinear:pm,resizeNearestNeighbor:Pd,nonMaxSuppression:cg,nonMaxSuppressionAsync:function(b,h,u,d,x){return d===void 0&&(d=.5),x===void 0&&(x=Number.NEGATIVE_INFINITY),M(this,void 0,void 0,function(){var T,H,Z,ce,ye,Ee,je;return V(this,function(Pe){switch(Pe.label){case 0:return T=Ze(b,"boxes","nonMaxSuppressionAsync"),H=Ze(h,"scores","nonMaxSuppressionAsync"),Z=au(T,H,u,d,x),u=Z.maxOutputSize,d=Z.iouThreshold,x=Z.scoreThreshold,[4,Promise.all([T.data(),H.data()])];case 1:return ce=Pe.sent(),ye=ce[0],Ee=ce[1],je=wl(ye,Ee,u,d,x),T!==b&&T.dispose(),H!==h&&H.dispose(),[2,je]}})})},nonMaxSuppressionWithScore:mm,nonMaxSuppressionWithScoreAsync:function(b,h,u,d,x,T){return d===void 0&&(d=.5),x===void 0&&(x=Number.NEGATIVE_INFINITY),T===void 0&&(T=0),M(this,void 0,void 0,function(){var H,Z,ce,ye,Ee,je,Pe;return V(this,function(ze){switch(ze.label){case 0:return H=Ze(b,"boxes","nonMaxSuppressionAsync"),Z=Ze(h,"scores","nonMaxSuppressionAsync"),ce=au(H,Z,u,d,x,T),u=ce.maxOutputSize,d=ce.iouThreshold,x=ce.scoreThreshold,T=ce.softNmsSigma,[4,Promise.all([H.data(),Z.data()])];case 1:return ye=ze.sent(),Ee=ye[0],je=ye[1],Pe=kl(Ee,je,u,d,x,T),H!==b&&H.dispose(),Z!==h&&Z.dispose(),[2,Pe]}})})},cropAndResize:lg}),sd=function(b,h){return!(b>0)||h==="linear"},Hl=function(b,h,u){if(u==null||u==="linear")return b;if(u==="relu")return b.mul(h.step());throw new Error("Gradient for activation "+u+" has not been implemented yet.")},N0=function(b,h){var u=h,d=Ds(b.shape,h.shape);return d.length>0&&(u=u.sum(d)),u.reshape(b.shape)},I0=function(b,h,u){if(h==="linear")return b;if(h==="relu")return Zm(b);if(h==="elu")return yf(b);if(h==="relu6")return $g(b);if(h==="prelu")return jd(b,u);throw new Error("Unknown fused activation "+h+".")},wh=Tt({fusedMatMul_:function(b){var h,u=b.a,d=b.b,x=b.transposeA,T=x!==void 0&&x,H=b.transposeB,Z=H!==void 0&&H,ce=b.bias,ye=b.activation,Ee=ye===void 0?"linear":ye,je=b.preluActivationWeights;if(sd(He.state.gradientDepth,Ee)===!1){var Pe=Ug(u,d,T,Z);return ce!=null&&(Pe=up(Pe,ce)),I0(Pe,Ee,je)}var ze=Ze(u,"a","fused matMul"),Ge=Ze(d,"b","fused matMul");h=_n(ze,Ge),ze=h[0],Ge=h[1];var rt=T?ze.shape[ze.rank-2]:ze.shape[ze.rank-1],it=Z?Ge.shape[Ge.rank-1]:Ge.shape[Ge.rank-2],ht=T?ze.shape[ze.rank-1]:ze.shape[ze.rank-2],Et=Z?Ge.shape[Ge.rank-2]:Ge.shape[Ge.rank-1],At=ze.shape.slice(0,-2),St=Ge.shape.slice(0,-2),Gt=Qe(At),un=Qe(St);Ce(ze.rank>=2&&Ge.rank>=2&&ze.rank===Ge.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+ze.rank+" and "+Ge.rank+"."}),Ce(fn(At,St),function(){return"Error in fused matMul: outer dimensions ("+At+") and ("+St+") of Tensors with shapes "+ze.shape+" and "+Ge.shape+" must match."}),Ce(rt===it,function(){return"Error in fused matMul: inner shapes ("+rt+") and ("+it+") of Tensors with shapes "+ze.shape+" and "+Ge.shape+" and transposeA="+T+" and transposeB="+Z+" must match."});var vn,cn,kn=ze.shape.slice(0,-2).concat([ht,Et]),On=T?ze.as3D(Gt,rt,ht):ze.as3D(Gt,ht,rt),p=Z?Ge.as3D(un,Et,it):Ge.as3D(un,it,Et);ce!=null&&Ro(kn,(vn=_n(vn=Ze(ce,"bias","fused matMul"),ze)[0]).shape),je!=null&&(cn=Ze(je,"prelu weights","fused matMul"));var c={a:On,b:p};ce!=null&&(c.bias=vn),je!=null&&(c.preluActivationWeights=cn);var a=[On,p];return He.runKernelFunc(function(l,y){var S=l.fusedBatchMatMul({a:On,b:p,transposeA:T,transposeB:Z,bias:vn,activation:Ee,preluActivationWeights:cn});return y([On,p,S]),S},c,function(l,y){var S=y[0],U=y[1],G=y[2],ae=Hl(l,G,Ee),le={};return ce!=null&&(le={bias:function(){return N0(vn,ae)}}),Object.assign(T||Z?!T&&Z?{a:function(){return ae.matMul(U,!1,!1)},b:function(){return ae.matMul(S,!0,!1)}}:T&&!Z?{a:function(){return U.matMul(ae,!1,!0)},b:function(){return S.matMul(ae,!1,!1)}}:{a:function(){return U.matMul(ae,!0,!0)},b:function(){return ae.matMul(S,!0,!0)}}:{a:function(){return ae.matMul(U,!1,!0)},b:function(){return S.matMul(ae,!0,!1)}},le)},"_FusedMatMul",{transposeA:T,transposeB:Z,activation:Ee},a,[!0]).reshape(kn)}}),gm=Tt({fusedConv2d_:function(b){var h=b.x,u=b.filter,d=b.strides,x=b.pad,T=b.dataFormat,H=T===void 0?"NHWC":T,Z=b.dilations,ce=Z===void 0?[1,1]:Z,ye=b.dimRoundingMode,Ee=b.bias,je=b.activation,Pe=je===void 0?"linear":je,ze=b.preluActivationWeights;if(Pe=Pe||"linear",sd(He.state.gradientDepth,Pe)===!1){var Ge=Rd(h,u,d,x,H,ce,ye);return Ee!=null&&(Ge=up(Ge,Ee)),I0(Ge,Pe,ze)}var rt=Ze(h,"x","conv2d"),it=Ze(u,"filter","conv2d"),ht=rt,Et=!1;rt.rank===3&&(Et=!0,ht=rt.as4D(1,rt.shape[0],rt.shape[1],rt.shape[2])),Ce(ht.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+ht.rank+"."}),Ce(it.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+it.rank+"."}),ye!=null&&Ce(on(x),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+ye+" but got pad "+x+"."}),Ce(ht.shape[3]===it.shape[2],function(){return"Error in conv2d: depth of input ("+ht.shape[3]+") must match input depth for filter "+it.shape[2]+"."}),Ce(ju(d,ce),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+ce+"'"}),Ce(H==="NHWC",function(){return"Error in conv2d: got dataFormat of "+H+" but only NHWC is currently supported."});var At,St,Gt=wu(ht.shape,it.shape,d,ce,x,ye);Ee!=null&&(At=_n(At=Ze(Ee,"bias","fused conv2d"),rt)[0],Ro(Gt.outShape,At.shape)),ze!=null&&(St=Ze(ze,"prelu weights","fused conv2d"));var un={x:ht,filter:it};Ee!=null&&(un.bias=At),ze!=null&&(un.preluActivationWeights=St);var vn=[it,ht],cn=He.runKernelFunc(function(kn,On){var p=kn.fusedConv2d({input:ht,filter:it,convInfo:Gt,bias:At,activation:Pe,preluActivationWeights:St});return On([it,ht,p]),p},un,function(kn,On){var p=On,c=p[0],a=p[1],l=p[2],y=Hl(kn,l,Pe);Ce(js(ce),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+ce+"'"});var S={};return Ee!=null&&(S={bias:function(){return N0(At,y)}}),Object.assign({x:function(){return Ym(a.shape,y,c,d,x)},filter:function(){return om(a,y,c.shape,d,x)}},S)},"FusedConv2D",{convInfo:Gt,activation:Pe},vn,[!0]);return Et?cn.as3D(cn.shape[1],cn.shape[2],cn.shape[3]):cn}}),J0=Tt({fusedDepthwiseConv2d_:function(b){var h=b.x,u=b.filter,d=b.strides,x=b.pad,T=b.dataFormat,H=T===void 0?"NHWC":T,Z=b.dilations,ce=Z===void 0?[1,1]:Z,ye=b.dimRoundingMode,Ee=b.bias,je=b.activation,Pe=je===void 0?"linear":je,ze=b.preluActivationWeights;if(sd(He.state.gradientDepth,Pe)===!1){var Ge=hp(h,u,d,x,H,ce,ye);return Ee!=null&&(Ge=up(Ge,Ee)),I0(Ge,Pe,ze)}var rt=Ze(h,"x","depthwiseConv2d"),it=Ze(u,"filter","depthwiseConv2d"),ht=rt,Et=!1;rt.rank===3&&(Et=!0,ht=rt.as4D(1,rt.shape[0],rt.shape[1],rt.shape[2])),Ce(ht.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+ht.rank+"."}),Ce(it.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+it.rank+"."}),Ce(ht.shape[3]===it.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+ht.shape[3]+") must match the inChannels dimension in filter "+it.shape[2]+"."}),ce==null&&(ce=[1,1]),Ce(ju(d,ce),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+ce+"'"}),ye!=null&&Ce(on(x),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+ye+" but got pad "+x+"."});var At,St,Gt=wu(ht.shape,it.shape,d,ce,x,ye,!0);Ee!=null&&(At=_n(At=Ze(Ee,"bias","fused conv2d"),rt)[0],Ro(Gt.outShape,At.shape)),ze!=null&&(St=Ze(ze,"prelu weights","fused depthwiseConv2d"));var un={x:ht,filter:it};Ee!=null&&(un.bias=At),ze!=null&&(un.preluActivationWeights=St);var vn=[it,ht],cn=He.runKernelFunc(function(kn,On){var p=kn.fusedDepthwiseConv2D({input:ht,filter:it,convInfo:Gt,bias:At,activation:Pe,preluActivationWeights:St});return On([it,ht,p]),p},un,function(kn,On){Ce(js(ce),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+ce+"'"});var p=On[0],c=On[1],a=On[2],l=Hl(kn,a,Pe),y={};return Ee!=null&&(y={bias:function(){return N0(At,l)}}),Object.assign({x:function(){return dp(c.shape,l,p,Gt)},filter:function(){return am(c,l,p.shape,Gt)}},y)},"FusedDepthwiseConv2D",{convInfo:Gt,activation:Pe},vn,[!0]);return Et?cn.as3D(cn.shape[1],cn.shape[2],cn.shape[3]):cn}}),Jg=Object.freeze({matMul:wh,conv2d:gm,depthwiseConv2d:J0}),hg=Object.freeze({image:fg,linalg:ug,losses:ag,spectral:rg,fused:Jg,signal:Yg,square:Lm,squaredDifference:il,conv1d:fp,conv2d:Rd,conv3d:td,depthwiseConv2d:hp,separableConv2d:gf,conv2dTranspose:Uc,conv3dTranspose:K0,op:Tt,batchNormalization2d:Vm,batchNormalization3d:Gh,batchNormalization4d:Pg,batchNormalization:G0,batchNorm:qm,batchNorm2d:fh,batchNorm3d:$h,batchNorm4d:Nd,booleanMaskAsync:Xm,complex:aa,real:ms,imag:Ks,concat:$a,concat1d:of,concat2d:Wp,concat3d:Mh,concat4d:jh,split:_o,matMul:Ug,dot:sm,outerProduct:d0,reverse:nd,reverse1d:p0,reverse2d:um,reverse3d:Jm,reverse4d:m0,maxPool:v0,avgPool:y0,pool:rd,maxPool3d:b0,avgPool3d:Vg,slice:mh,slice1d:qg,slice2d:x0,slice3d:id,slice4d:gh,abs:zl,acos:zm,acosh:ap,asin:ol,asinh:Zp,atan:Od,atanh:Sd,ceil:Ng,clipByValue:Ul,cos:If,cosh:Wl,erf:Ig,exp:Fg,expm1:em,floor:yv,log:bv,log1p:ra,logSigmoid:Rg,neg:Mg,reciprocal:Um,round:jg,rsqrt:sp,sigmoid:ou,sign:tc,isNaN:f0,isInf:h0,isFinite:ch,sin:Vl,sinh:Dd,softplus:H0,sqrt:Wm,step:Ff,tan:nc,tanh:ql,all:Hg,any:vf,argMax:Gg,argMin:w0,logSumExp:Uu,max:X0,mean:pp,min:mp,moments:vh,sum:k0,prod:Md,equal:mf,equalStrict:El,greater:sl,greaterEqual:ul,greaterEqualStrict:rc,greaterStrict:tm,less:Lg,lessEqual:Fd,lessEqualStrict:Ra,lessStrict:nm,notEqual:zc,notEqualStrict:Qh,add:up,addN:$0,addStrict:dh,atan2:cp,div:Mf,divNoNan:hf,divStrict:Yh,floorDiv:df,maximum:to,maximumStrict:pf,minimum:jf,minimumStrict:zu,mod:lp,modStrict:ph,mul:Bf,mulStrict:Ts,pow:Id,powStrict:Gm,squaredDifferenceStrict:Jh,sub:Pf,subStrict:du,elu:yf,leakyRelu:gp,prelu:jd,relu:Zm,relu6:$g,selu:_0,logicalAnd:Kh,logicalNot:Rf,logicalOr:Hm,logicalXor:Xh,where:Ko,whereAsync:hh,buffer:wo,print:Il,batchToSpaceND:cr,broadcastTo:jr,cast:Or,clone:Mi,cumsum:go,depthToSpace:Ca,expandDims:Eo,eye:za,multinomial:Sf,oneHot:Zd,pad:Ru,pad1d:Fl,pad2d:Df,pad3d:af,pad4d:Tf,rand:sf,randomNormal:ma,randomGamma:Dg,randomUniform:eh,reshape:Ua,spaceToBatchND:Ms,squeeze:Xs,stack:Co,tile:cu,truncatedNormal:lc,unstack:Es,setdiff1dAsync:uf,fill:Nu,linspace:Jd,ones:Xu,range:rf,scalar:Mr,tensor:la,tensor1d:Cc,tensor2d:sc,tensor3d:nf,tensor4d:Ac,tensor5d:yd,tensor6d:uc,variable:bd,zeros:Io,onesLike:Iu,zerosLike:Ri,transpose:Eu,softmax:ru,logSoftmax:Fo,localResponseNormalization:E0,norm:vp,gather:$m,unsortedSegmentSum:Km,basicLSTMCell:C0,multiRNNCell:eg,movingAverage:od,stridedSlice:cm,topk:yh,scatterND:A0,fft:tg,ifft:ng,rfft:Kg,irfft:Lf,sparseToDense:O0,gatherND:bh,diag:lm,dropout:xh,hannWindow:ig,hammingWindow:Xg,frame:fm,stft:hm,inTopKAsync:S0});function ii(b,h){Array.isArray(b)||(b=[b]),b.forEach(function(u){u!=null&&Ce(u.dtype!=="complex64",function(){return h+" does not support complex64 tensors."})})}function P(b,h,u,d){if(u==="linear")return b.linear(h);if(u==="relu")return b.relu(h);if(u==="elu")return b.elu(h);if(u==="relu6")return b.relu6(h);if(u==="prelu")return b.prelu(h,d);throw new Error("Activation "+u+" has not been implemented for the CPU backend.")}var E=function(b){function h(){var u=b.call(this)||this;return u.blockSize=48,u.firstUse=!0,u.data=new cf(u,He),u}return K(h,b),h.prototype.write=function(u,d,x){this.firstUse&&(this.firstUse=!1,W().get("IS_NODE")&&Jf(`
============================
Hi there \u{1F44B}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var T={};return this.data.set(T,{values:u,dtype:x}),T},h.prototype.move=function(u,d,x,T){this.data.set(u,{values:d,dtype:T})},h.prototype.numDataIds=function(){return this.data.numDataIds()},h.prototype.read=function(u){return M(this,void 0,void 0,function(){return V(this,function(d){return[2,this.readSync(u)]})})},h.prototype.readSync=function(u){var d=this.data.get(u),x=d.dtype,T=d.complexTensors;return x==="complex64"?xl(this.readSync(T.real.dataId),this.readSync(T.imag.dataId)):this.data.get(u).values},h.prototype.bufferSync=function(u){var d=this.readSync(u.dataId),x=d;if(u.dtype==="string")try{x=d.map(function(T){return Fr(T)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return wo(u.shape,u.dtype,x)},h.prototype.makeOutput=function(u,d,x){var T=this.write(u,d,x);return He.makeTensorFromDataId(T,d,x,this)},h.prototype.disposeData=function(u){if(this.data.has(u)){var d=this.data.get(u).complexTensors;d!=null&&(d.real.dispose(),d.imag.dispose()),this.data.delete(u)}},h.prototype.time=function(u){return M(this,void 0,void 0,function(){var d;return V(this,function(x){return d=an(),u(),[2,{kernelMs:an()-d}]})})},h.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},h.prototype.complex=function(u,d){var x=this.makeOutput(null,u.shape,"complex64");return this.data.get(x.dataId).complexTensors={real:He.keep(u.clone()),imag:He.keep(d.clone())},x},h.prototype.real=function(u){return this.data.get(u.dataId).complexTensors.real.clone()},h.prototype.imag=function(u){return this.data.get(u.dataId).complexTensors.imag.clone()},h.prototype.slice=function(u,d,x){if(ii(u,"slice"),Ss(u.shape,d,x)){var T=lu(d,u.strides),H=Qe(x);return la(this.readSync(u.dataId).subarray(T,T+H),x,u.dtype)}for(var Z=wo(x,u.dtype),ce=this.bufferSync(u),ye=0;ye<Z.size;++ye){var Ee=Z.indexToLoc(ye).map(function(je,Pe){return je+d[Pe]});Z.values[ye]=ce.get.apply(ce,Ee)}return Z.toTensor()},h.prototype.stridedSlice=function(u,d,x,T){ii(u,"stridedSlice");var H=nh(d,x,T);if(H.some(function(ze){return ze===0}))return la([],H);for(var Z=wo(H,u.dtype),ce=this.bufferSync(u),ye=0;ye<Z.size;ye++){for(var Ee=Z.indexToLoc(ye),je=new Array(Ee.length),Pe=0;Pe<je.length;Pe++)je[Pe]=Ee[Pe]*T[Pe]+d[Pe];Z.set.apply(Z,[ce.get.apply(ce,je)].concat(Ee))}return Z.toTensor()},h.prototype.diag=function(u){for(var d=this.readSync(u.dataId),x=wo([u.size,u.size],u.dtype),T=x.values,H=0;H<d.length;H++)T[H*u.size+H]=d[H];return x.toTensor()},h.prototype.unstack=function(u,d){for(var x=u.shape[d],T=new Array(u.rank-1),H=0,Z=0;Z<u.rank;Z++)Z!==d&&(T[H++]=u.shape[Z]);var ce=new Array(u.rank).fill(0),ye=u.shape.slice();ye[d]=1;var Ee=new Array(x);for(Z=0;Z<Ee.length;Z++)ce[d]=Z,Ee[Z]=this.slice(u,ce,ye).reshape(T);return Ee},h.prototype.reverse=function(u,d){ii(u,"reverse");for(var x=wo(u.shape,u.dtype),T=this.bufferSync(u),H=function(ce){var ye=x.indexToLoc(ce),Ee=ye.slice();d.forEach(function(je){return Ee[je]=u.shape[je]-1-Ee[je]}),x.set.apply(x,[T.get.apply(T,Ee)].concat(ye))},Z=0;Z<x.size;Z++)H(Z);return x.toTensor()},h.prototype.concat=function(u,d){var x=this;if(u[0].dtype==="complex64"){var T=u.map(function(ze){return ms(ze)}),H=u.map(function(ze){return Ks(ze)});return aa(this.concat(T,d),this.concat(H,d))}var Z=u.map(function(ze){var Ge=Qe(ze.shape.slice(d));return ze.as2D(-1,Ge)}),ce=Ku(Z.map(function(ze){return ze.shape}),1),ye=wo(ce,u[0].dtype).values;if(Z[0].shape[0]===1){var Ee=0;Z.forEach(function(ze){ye.set(x.readSync(ze.dataId),Ee),Ee+=ze.size})}else{var je=0;Z.forEach(function(ze){for(var Ge=x.readSync(ze.dataId),rt=0,it=0;it<ze.shape[0];++it)for(var ht=it*ce[1]+je,Et=0;Et<ze.shape[1];++Et)ye[ht+Et]=Ge[rt++];je+=ze.shape[1]})}var Pe=Ku(u.map(function(ze){return ze.shape}),d);return la(ye,Pe,u[0].dtype)},h.prototype.neg=function(u){return ii(u,"neg"),this.multiply(Mr(-1),u)},h.prototype.add=function(u,d){return u.dtype==="complex64"||d.dtype==="complex64"?this.broadcastedBinaryComplexOp(u.cast("complex64"),d.cast("complex64"),function(x,T,H,Z){return{real:x+H,imag:T+Z}}):this.broadcastedBinaryOp(u,d,yn(u.dtype,d.dtype),function(x,T){return x+T})},h.prototype.addN=function(u){var d=this;ii(u,"addN");for(var x=u.map(function(Ee){return d.readSync(Ee.dataId)}),T=wo(u[0].shape,u[0].dtype),H=T.values,Z=0;Z<u.length;Z++)for(var ce=x[Z],ye=0;ye<H.length;ye++)H[ye]+=ce[ye];return T.toTensor()},h.prototype.softmax=function(u,d){var x=Tn([d],u.shape),T=this.max(u,x),H=Ea(T.shape,x),Z=this.subtract(u,T.reshape(H)),ce=this.exp(Z),ye=this.sum(ce,x).reshape(H);return this.realDivide(ce,ye)},h.prototype.subtract=function(u,d){return u.dtype==="complex64"||d.dtype==="complex64"?this.broadcastedBinaryComplexOp(u.cast("complex64"),d.cast("complex64"),function(x,T,H,Z){return{real:x-H,imag:T-Z}}):this.broadcastedBinaryOp(u,d,yn(u.dtype,d.dtype),function(x,T){return x-T})},h.prototype.pow=function(u,d){return ii([u,d],"pow"),this.broadcastedBinaryOp(u,d,u.dtype,function(x,T){return Math.pow(x,T)})},h.prototype.batchMatMul=function(u,d,x,T){ii([u,d],"matMul");for(var H=x?u.shape[1]:u.shape[2],Z=x?u.shape[2]:u.shape[1],ce=T?d.shape[1]:d.shape[2],ye=u.shape[0],Ee=this.readSync(u.dataId),je=this.readSync(d.dataId),Pe=x?[u.strides[0],1,u.strides[1]]:[u.strides[0],u.strides[1],1],ze=Pe[0],Ge=Pe[1],rt=Pe[2],it=T?[1,d.strides[1],d.strides[0]]:[d.strides[1],1,d.strides[0]],ht=it[0],Et=it[1],At=it[2],St=Z*ce,Gt=wo([ye,Z,ce],u.dtype),un=Gt.values,vn=this.blockSize,cn=0;cn<ye;cn++)for(var kn=0;kn<Z;kn+=vn)for(var On=0;On<ce;On+=vn)for(var p=0;p<H;p+=vn)for(var c=Math.min(kn+vn,Z),a=Math.min(On+vn,ce),l=Math.min(p+vn,H),y=kn;y<c;y++)for(var S=On;S<a;S++){for(var U=0,G=p;G<l;G++)U+=Ee[cn*ze+y*Ge+G*rt]*je[G*ht+S*Et+cn*At];un[cn*St+(y*ce+S)]+=U}return Gt.toTensor()},h.prototype.fusedBatchMatMul=function(u){var d=u.a,x=u.b,T=u.transposeA,H=u.transposeB,Z=u.bias,ce=u.activation,ye=u.preluActivationWeights,Ee=this.batchMatMul(d,x,T,H);return Z&&(Ee=this.add(Ee,Z)),ce&&(Ee=P(this,Ee,ce,ye)),Ee},h.prototype.multiply=function(u,d){return u.dtype==="complex64"||d.dtype==="complex64"?this.broadcastedBinaryComplexOp(u.cast("complex64"),d.cast("complex64"),function(x,T,H,Z){return{real:x*H-T*Z,imag:x*Z+T*H}}):this.broadcastedBinaryOp(u,d,yn(u.dtype,d.dtype),function(x,T){return x*T})},h.prototype.realDivide=function(u,d){return ii([u,d],"realDivide"),this.broadcastedBinaryOp(u,d,"float32",function(x,T){return x/T})},h.prototype.floorDiv=function(u,d){return ii([u,d],"floorDiv"),this.broadcastedBinaryOp(u,d,"int32",function(x,T){return Math.floor(x/T)})},h.prototype.sum=function(u,d){ii(u,"sum"),La("sum",d,u.rank);for(var x=pa(u.shape,d),T=x[0],H=x[1],Z=Io(T,yn(u.dtype,"int32")),ce=Qe(H),ye=this.readSync(Z.dataId),Ee=this.readSync(u.dataId),je=0;je<ye.length;++je){for(var Pe=je*ce,ze=0,Ge=0;Ge<ce;++Ge)ze+=Ee[Pe+Ge];ye[je]=ze}return Z},h.prototype.prod=function(u,d){ii(u,"sum");for(var x=pa(u.shape,d),T=x[0],H=x[1],Z=Io(T,yn(u.dtype,"int32")),ce=Qe(H),ye=this.readSync(Z.dataId),Ee=this.readSync(u.dataId),je=0;je<ye.length;++je){for(var Pe=je*ce,ze=1,Ge=0;Ge<ce;++Ge)ze*=Ee[Pe+Ge];ye[je]=ze}return Z},h.prototype.unsortedSegmentSum=function(u,d,x){ii(u,"unsortedSegmentSum");for(var T=[],H=u.rank-d.rank,Z=0;Z<H;++Z)d=d.expandDims(Z+1);for(Z=0;Z<x;++Z){var ce=Mr(Z,"int32"),ye=mf(ce,d).asType("float32").mul(u).sum(0);T.push(ye)}return Co(T)},h.prototype.argMin=function(u,d){ii(u,"argMin");var x=[d];La("argMin",x,u.rank);for(var T=pa(u.shape,x),H=T[0],Z=T[1],ce=Io(H,"int32"),ye=Qe(Z),Ee=this.readSync(ce.dataId),je=this.readSync(u.dataId),Pe=0;Pe<Ee.length;++Pe){for(var ze=Pe*ye,Ge=je[ze],rt=0,it=0;it<ye;++it){var ht=je[ze+it];ht<Ge&&(Ge=ht,rt=it)}Ee[Pe]=rt}return ce},h.prototype.argMax=function(u,d){ii(u,"argMax");var x=[d];La("argMax",x,u.rank);for(var T=pa(u.shape,x),H=T[0],Z=T[1],ce=Io(H,"int32"),ye=Qe(Z),Ee=this.readSync(ce.dataId),je=this.readSync(u.dataId),Pe=0;Pe<Ee.length;++Pe){for(var ze=Pe*ye,Ge=je[ze],rt=0,it=0;it<ye;++it){var ht=je[ze+it];ht>Ge&&(Ge=ht,rt=it)}Ee[Pe]=rt}return ce},h.prototype.cumsum=function(u,d,x,T){if(ii(u,"cumsum"),d!==u.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(u.rank-1)+" but got axis="+d);for(var H=yn(u.dtype,"int32"),Z=Io(u.shape,H),ce=this.readSync(Z.dataId),ye=this.readSync(u.dataId),Ee=u.shape[u.rank-1],je=T?function(it,ht){return it+Ee-ht-1}:function(it,ht){return it+ht},Pe=0;Pe<ye.length;Pe+=Ee)for(var ze=0;ze<Ee;ze++){var Ge=je(Pe,ze);if(ze===0)ce[Ge]=x?0:ye[Ge];else{var rt=je(Pe,ze-1);ce[Ge]=x?ye[rt]+ce[rt]:ye[Ge]+ce[rt]}}return Z},h.prototype.equal=function(u,d){return ii([u,d],"equal"),this.broadcastedBinaryOp(u,d,"bool",function(x,T){return x===T?1:0})},h.prototype.notEqual=function(u,d){return ii([u,d],"notEqual"),this.broadcastedBinaryOp(u,d,"bool",function(x,T){return x!==T?1:0})},h.prototype.less=function(u,d){return ii([u,d],"less"),this.broadcastedBinaryOp(u,d,"bool",function(x,T){return x<T?1:0})},h.prototype.lessEqual=function(u,d){return ii([u,d],"lessEqual"),this.broadcastedBinaryOp(u,d,"bool",function(x,T){return x<=T?1:0})},h.prototype.greater=function(u,d){return ii([u,d],"greater"),this.broadcastedBinaryOp(u,d,"bool",function(x,T){return x>T?1:0})},h.prototype.greaterEqual=function(u,d){return ii([u,d],"greaterEqual"),this.broadcastedBinaryOp(u,d,"bool",function(x,T){return x>=T?1:0})},h.prototype.logicalNot=function(u){ii(u,"logicalNot");for(var d=this.readSync(u.dataId),x=new Uint8Array(d.length),T=0;T<d.length;++T)x[T]=d[T]?0:1;return this.makeOutput(x,u.shape,"bool")},h.prototype.logicalAnd=function(u,d){return ii([u,d],"logicalAnd"),this.broadcastedBinaryOp(u,d,"bool",function(x,T){return x&&T})},h.prototype.logicalOr=function(u,d){return ii([u,d],"logicalOr"),this.broadcastedBinaryOp(u,d,"bool",function(x,T){return x||T})},h.prototype.select=function(u,d,x){ii([u,d,x],"select");for(var T=this.readSync(u.dataId),H=this.readSync(d.dataId),Z=this.readSync(x.dataId),ce=Io(d.shape,yn(d.dtype,x.dtype)),ye=this.readSync(ce.dataId),Ee=0,je=u.rank===0||u.rank>1||d.rank===1?1:Qe(d.shape.slice(1)),Pe=0;Pe<T.length;Pe++)for(var ze=0;ze<je;ze++)T[Pe]===1?ye[Ee++]=H[Pe]:ye[Ee++]=Z[Pe];return ce},h.prototype.where=function(u){ii([u],"where");var d=this.readSync(u.dataId);return Q(u.shape,d)},h.prototype.topk=function(u,d,x){return ii(u,"topk"),re(this.readSync(u.dataId),u.shape,u.dtype,d)},h.prototype.min=function(u,d){ii(u,"min"),La("min",d,u.rank);for(var x=pa(u.shape,d),T=x[0],H=x[1],Z=Io(T,u.dtype),ce=Qe(H),ye=this.readSync(Z.dataId),Ee=this.readSync(u.dataId),je=0;je<ye.length;++je){for(var Pe=je*ce,ze=Ee[Pe],Ge=0;Ge<ce;++Ge){var rt=Ee[Pe+Ge];rt<ze&&(ze=rt)}ye[je]=ze}return Z},h.prototype.minimum=function(u,d){return ii([u,d],"minimum"),this.broadcastedBinaryOp(u,d,u.dtype,function(x,T){return Math.min(x,T)})},h.prototype.mod=function(u,d){return ii([u,d],"mod"),this.broadcastedBinaryOp(u,d,u.dtype,function(x,T){var H=x%T;return x<0&&T<0||x>=0&&T>=0?H:(H+T)%T})},h.prototype.max=function(u,d){ii(u,"max"),La("max",d,u.rank);for(var x=pa(u.shape,d),T=x[0],H=x[1],Z=Io(T,u.dtype),ce=Qe(H),ye=this.readSync(Z.dataId),Ee=this.readSync(u.dataId),je=0;je<ye.length;++je){for(var Pe=je*ce,ze=Ee[Pe],Ge=0;Ge<ce;++Ge){var rt=Ee[Pe+Ge];rt>ze&&(ze=rt)}ye[je]=ze}return Z},h.prototype.maximum=function(u,d){return ii([u,d],"maximum"),this.broadcastedBinaryOp(u,d,u.dtype,function(x,T){return Math.max(x,T)})},h.prototype.all=function(u,d){ii(u,"all"),La("all",d,u.rank);for(var x=pa(u.shape,d),T=x[0],H=x[1],Z=Io(T,u.dtype),ce=Qe(H),ye=this.readSync(Z.dataId),Ee=this.readSync(u.dataId),je=0;je<ye.length;++je){for(var Pe=je*ce,ze=Ee[Pe],Ge=0;Ge<ce;++Ge){var rt=Ee[Pe+Ge];ze=ze&&rt}ye[je]=ze}return Z},h.prototype.any=function(u,d){ii(u,"any"),La("any",d,u.rank);for(var x=pa(u.shape,d),T=x[0],H=x[1],Z=Io(T,u.dtype),ce=Qe(H),ye=this.readSync(Z.dataId),Ee=this.readSync(u.dataId),je=0;je<ye.length;++je){for(var Pe=je*ce,ze=Ee[Pe],Ge=0;Ge<ce;++Ge){var rt=Ee[Pe+Ge];ze=ze||rt}ye[je]=ze}return Z},h.prototype.squaredDifference=function(u,d){return ii([u,d],"squaredDifference"),this.broadcastedBinaryOp(u,d,u.dtype,function(x,T){var H=x-T;return H*H})},h.prototype.ceil=function(u){ii(u,"ceil");for(var d=this.readSync(u.dataId),x=new Float32Array(d.length),T=0;T<d.length;++T)x[T]=Math.ceil(d[T]);return this.makeOutput(x,u.shape,"float32")},h.prototype.floor=function(u){ii(u,"floor");for(var d=this.readSync(u.dataId),x=new Float32Array(d.length),T=0;T<d.length;++T)x[T]=Math.floor(d[T]);return this.makeOutput(x,u.shape,"float32")},h.prototype.sign=function(u){ii(u,"x");for(var d=this.readSync(u.dataId),x=new Float32Array(d.length),T=0;T<d.length;++T)d[T]<0?x[T]=-1:d[T]>0?x[T]=1:x[T]=0;return this.makeOutput(x,u.shape,"float32")},h.prototype.isNaN=function(u){ii(u,"x");for(var d=this.readSync(u.dataId),x=new Uint8Array(d.length),T=0;T<d.length;++T)Number.isNaN(d[T])&&(x[T]=1);return this.makeOutput(x,u.shape,"bool")},h.prototype.isInf=function(u){ii(u,"x");for(var d=this.readSync(u.dataId),x=new Uint8Array(d.length),T=0;T<d.length;++T)Math.abs(d[T])===1/0&&(x[T]=1);return this.makeOutput(x,u.shape,"bool")},h.prototype.isFinite=function(u){ii(u,"x");for(var d=this.readSync(u.dataId),x=new Uint8Array(d.length),T=0;T<d.length;++T)Number.isFinite(d[T])&&(x[T]=1);return this.makeOutput(x,u.shape,"bool")},h.prototype.round=function(u){ii(u,"round");for(var d=this.readSync(u.dataId),x=new Float32Array(d.length),T=0;T<d.length;++T){var H=Math.floor(d[T]);d[T]-H<.5?x[T]=Math.floor(d[T]):d[T]-H>.5?x[T]=Math.ceil(d[T]):x[T]=H%2==0?H:H+1}return this.makeOutput(x,u.shape,"float32")},h.prototype.exp=function(u){ii(u,"exp");for(var d=this.readSync(u.dataId),x=new Float32Array(d.length),T=0;T<d.length;++T)x[T]=Math.exp(d[T]);return this.makeOutput(x,u.shape,"float32")},h.prototype.expm1=function(u){ii(u,"expm1");for(var d=this.readSync(u.dataId),x=new Float32Array(d.length),T=0;T<d.length;++T)x[T]=Math.expm1(d[T]);return this.makeOutput(x,u.shape,"float32")},h.prototype.log=function(u){ii(u,"log");for(var d=this.readSync(u.dataId),x=new Float32Array(d.length),T=0;T<d.length;++T){var H=d[T];x[T]=Math.log(H)}return this.makeOutput(x,u.shape,"float32")},h.prototype.log1p=function(u){ii(u,"log1p");for(var d=this.readSync(u.dataId),x=new Float32Array(d.length),T=0;T<d.length;++T){var H=d[T];x[T]=Math.log1p(H)}return this.makeOutput(x,u.shape,"float32")},h.prototype.sqrt=function(u){ii(u,"sqrt");for(var d=this.readSync(u.dataId),x=new Float32Array(d.length),T=0;T<d.length;++T){var H=d[T];x[T]=Math.sqrt(H)}return this.makeOutput(x,u.shape,"float32")},h.prototype.rsqrt=function(u){ii(u,"rsqrt");for(var d=this.readSync(u.dataId),x=new Float32Array(d.length),T=0;T<d.length;++T){var H=d[T];x[T]=1/Math.sqrt(H)}return this.makeOutput(x,u.shape,"float32")},h.prototype.reciprocal=function(u){ii(u,"reciprocal");for(var d=this.readSync(u.dataId),x=new Float32Array(d.length),T=0;T<d.length;++T)x[T]=1/d[T];return this.makeOutput(x,u.shape,"float32")},h.prototype.linear=function(u){return u},h.prototype.relu=function(u){ii(u,"relu");for(var d=Io(u.shape,u.dtype),x=this.readSync(d.dataId),T=this.readSync(u.dataId),H=0;H<T.length;++H)x[H]=Math.max(0,T[H]);return d},h.prototype.relu6=function(u){ii(u,"relu");for(var d=Io(u.shape,u.dtype),x=this.readSync(d.dataId),T=this.readSync(u.dataId),H=0;H<T.length;++H)x[H]=Math.min(Math.max(0,T[H]),6);return d},h.prototype.prelu=function(u,d){return ii([u,d],"prelu"),this.broadcastedBinaryOp(u,d,u.dtype,function(x,T){return x<0?T*x:x})},h.prototype.elu=function(u){ii(u,"elu");for(var d=new Float32Array(u.size),x=this.readSync(u.dataId),T=0;T<x.length;++T){var H=x[T];d[T]=H>=0?H:Math.exp(H)-1}return this.makeOutput(d,u.shape,"float32")},h.prototype.eluDer=function(u,d){ii([u,d],"eluDer");for(var x=new Float32Array(d.size),T=this.readSync(d.dataId),H=this.readSync(u.dataId),Z=0;Z<T.length;++Z){var ce=T[Z];x[Z]=ce>=1?H[Z]:H[Z]*(ce+1)}return this.makeOutput(x,d.shape,"float32")},h.prototype.selu=function(u){ii(u,"selu");for(var d=new Float32Array(u.size),x=this.readSync(u.dataId),T=0;T<x.length;++T){var H=x[T];d[T]=H>=0?1.0507009873554805*H:1.7580993408473768*(Math.exp(H)-1)}return this.makeOutput(d,u.shape,"float32")},h.prototype.clip=function(u,d,x){ii(u,"clip");for(var T=new Float32Array(u.size),H=this.readSync(u.dataId),Z=0;Z<H.length;++Z){var ce=H[Z];T[Z]=ce>x?x:ce<d?d:ce}return this.makeOutput(T,u.shape,"float32")},h.prototype.abs=function(u){for(var d=new Float32Array(u.size),x=this.readSync(u.dataId),T=0;T<x.length;++T)d[T]=Math.abs(x[T]);return this.makeOutput(d,u.shape,"float32")},h.prototype.complexAbs=function(u){for(var d=new Float32Array(u.size),x=this.readSync(u.dataId),T=0;T<u.size;++T){var H=x[2*T],Z=x[2*T+1];d[T]=Math.hypot(H,Z)}return this.makeOutput(d,u.shape,"float32")},h.prototype.int=function(u){ii(u,"int");for(var d=new Int32Array(u.size),x=this.readSync(u.dataId),T=0;T<x.length;++T)d[T]=x[T];return this.makeOutput(d,u.shape,"int32")},h.prototype.sigmoid=function(u){ii(u,"sigmoid");for(var d=new Float32Array(u.size),x=this.readSync(u.dataId),T=0;T<x.length;++T)d[T]=1/(1+Math.exp(-x[T]));return this.makeOutput(d,u.shape,"float32")},h.prototype.softplus=function(u){ii(u,"softplus");for(var d=Math.log(11920928955078125e-23)+2,x=new Float32Array(u.size),T=this.readSync(u.dataId),H=0;H<T.length;++H){var Z,ce=T[H]>-d,ye=T[H]<d,Ee=Math.exp(T[H]);Z=ye?Ee:ce?T[H]:Math.log(1+Ee),x[H]=Z}return this.makeOutput(x,u.shape,"float32")},h.prototype.sin=function(u){ii(u,"sin");for(var d=new Float32Array(u.size),x=this.readSync(u.dataId),T=0;T<x.length;++T)d[T]=Math.sin(x[T]);return this.makeOutput(d,u.shape,"float32")},h.prototype.cos=function(u){ii(u,"cos");for(var d=new Float32Array(u.size),x=this.readSync(u.dataId),T=0;T<x.length;++T)d[T]=Math.cos(x[T]);return this.makeOutput(d,u.shape,"float32")},h.prototype.tan=function(u){ii(u,"tan");for(var d=new Float32Array(u.size),x=this.readSync(u.dataId),T=0;T<x.length;++T)d[T]=Math.tan(x[T]);return this.makeOutput(d,u.shape,"float32")},h.prototype.asin=function(u){ii(u,"asin");for(var d=new Float32Array(u.size),x=this.readSync(u.dataId),T=0;T<x.length;++T)d[T]=Math.asin(x[T]);return this.makeOutput(d,u.shape,"float32")},h.prototype.acos=function(u){ii(u,"acos");for(var d=new Float32Array(u.size),x=this.readSync(u.dataId),T=0;T<x.length;++T)d[T]=Math.acos(x[T]);return this.makeOutput(d,u.shape,"float32")},h.prototype.atan=function(u){ii(u,"atan");for(var d=new Float32Array(u.size),x=this.readSync(u.dataId),T=0;T<x.length;++T)d[T]=Math.atan(x[T]);return this.makeOutput(d,u.shape,"float32")},h.prototype.atan2=function(u,d){return ii([u,d],"atan2"),this.broadcastedBinaryOp(u,d,u.dtype,function(x,T){return Math.atan2(x,T)})},h.prototype.sinh=function(u){ii(u,"sinh");for(var d=new Float32Array(u.size),x=this.readSync(u.dataId),T=0;T<x.length;++T)d[T]=Math.sinh(x[T]);return this.makeOutput(d,u.shape,"float32")},h.prototype.cosh=function(u){ii(u,"cosh");for(var d=new Float32Array(u.size),x=this.readSync(u.dataId),T=0;T<x.length;++T)d[T]=Math.cosh(x[T]);return this.makeOutput(d,u.shape,"float32")},h.prototype.tanh=function(u){ii(u,"tanh");for(var d=new Float32Array(u.size),x=this.readSync(u.dataId),T=0;T<x.length;++T)d[T]=Ct(x[T]);return this.makeOutput(d,u.shape,"float32")},h.prototype.asinh=function(u){ii(u,"asinh");for(var d=new Float32Array(u.size),x=this.readSync(u.dataId),T=0;T<x.length;++T)d[T]=Math.asinh(x[T]);return this.makeOutput(d,u.shape,"float32")},h.prototype.acosh=function(u){ii(u,"acosh");for(var d=new Float32Array(u.size),x=this.readSync(u.dataId),T=0;T<x.length;++T)d[T]=Math.acosh(x[T]);return this.makeOutput(d,u.shape,"float32")},h.prototype.atanh=function(u){ii(u,"atanh");for(var d=new Float32Array(u.size),x=this.readSync(u.dataId),T=0;T<x.length;++T)d[T]=Math.atanh(x[T]);return this.makeOutput(d,u.shape,"float32")},h.prototype.erf=function(u){ii(u,"erf");for(var d=new Float32Array(u.size),x=this.readSync(u.dataId),T=0;T<x.length;++T){var H=Math.sign(x[T]),Z=Math.abs(x[T]),ce=1/(1+.3275911*Z);d[T]=H*(1-((((1.061405429*ce-1.453152027)*ce+1.421413741)*ce-.284496736)*ce+.254829592)*ce*Math.exp(-Z*Z))}return this.makeOutput(d,u.shape,"float32")},h.prototype.step=function(u,d){d===void 0&&(d=0),ii(u,"step");for(var x=new Float32Array(u.size),T=this.readSync(u.dataId),H=0;H<T.length;++H){var Z=T[H];isNaN(Z)?x[H]=NaN:x[H]=Z>0?1:d}return this.makeOutput(x,u.shape,"float32")},h.prototype.fusedConv2d=function(u){var d=u.input,x=u.filter,T=u.convInfo,H=u.bias,Z=u.activation,ce=u.preluActivationWeights,ye=this.conv2d(d,x,T);return H&&(ye=this.add(ye,H)),Z&&(ye=P(this,ye,Z,ce)),ye},h.prototype.conv2d=function(u,d,x){ii([u,d],"conv2d");for(var T=x.filterHeight,H=x.filterWidth,Z=x.dilationHeight,ce=x.dilationWidth,ye=x.padInfo.left,Ee=x.padInfo.top,je=x.dataFormat==="channelsLast",Pe=wo(x.outShape,u.dtype),ze=u.strides[0],Ge=je?u.strides[1]:u.strides[2],rt=je?u.strides[2]:1,it=je?1:u.strides[1],ht=Pe.strides[0],Et=je?Pe.strides[1]:Pe.strides[2],At=je?Pe.strides[2]:1,St=je?1:Pe.strides[1],Gt=this.readSync(u.dataId),un=this.readSync(d.dataId),vn=Pe.values,cn=0;cn<x.batchSize;++cn)for(var kn=cn*ze,On=cn*ht,p=0;p<x.outHeight;++p)for(var c=On+p*Et,a=p*x.strideHeight-Ee,l=0;l<T;l++){var y=a+l*Z;if(!(y<0||y>=x.inHeight))for(var S=l*d.strides[0],U=kn+y*Ge,G=0;G<x.outWidth;++G)for(var ae=c+G*At,le=G*x.strideWidth-ye,be=0;be<H;be++){var Se=le+be*ce;if(!(Se<0||Se>=x.inWidth))for(var Ie=U+Se*rt,Me=S+be*d.strides[1],qe=0;qe<x.inChannels;++qe){for(var Ye=Gt[Ie+qe*it],Xe=0;Xe<x.outChannels;++Xe)vn[ae+Xe*St]+=Ye*un[Me+Xe];Me+=x.outChannels}}}return Pe.toTensor()},h.prototype.conv3d=function(u,d,x){for(var T=x.filterDepth,H=x.filterHeight,Z=x.filterWidth,ce=x.dilationDepth,ye=x.dilationHeight,Ee=x.dilationWidth,je=x.padInfo.front,Pe=x.padInfo.left,ze=x.padInfo.top,Ge=wo(x.outShape,u.dtype),rt=this.readSync(u.dataId),it=this.readSync(d.dataId),ht=Ge.values,Et=0;Et<x.batchSize;++Et)for(var At=Et*u.strides[0],St=Et*Ge.strides[0],Gt=0;Gt<x.outDepth;++Gt)for(var un=St+Gt*Ge.strides[1],vn=Gt*x.strideDepth-je,cn=0;cn<T;cn++){var kn=vn+cn*ce;if(!(kn<0||kn>=x.inDepth))for(var On=cn*d.strides[0],p=At+kn*u.strides[1],c=0;c<x.outHeight;++c)for(var a=un+c*Ge.strides[2],l=c*x.strideHeight-ze,y=0;y<H;y++){var S=l+y*ye;if(!(S<0||S>=x.inHeight))for(var U=On+y*d.strides[1],G=p+S*u.strides[2],ae=0;ae<x.outWidth;++ae)for(var le=a+ae*x.outChannels,be=ae*x.strideWidth-Pe,Se=0;Se<Z;Se++){var Ie=be+Se*Ee;if(!(Ie<0||Ie>=x.inWidth))for(var Me=U+Se*d.strides[2],qe=G+Ie*x.inChannels,Ye=Me,Xe=0;Xe<x.inChannels;++Xe){for(var at=rt[qe+Xe],gt=0;gt<x.outChannels;++gt)ht[le+gt]+=at*it[Ye+gt];Ye+=x.outChannels}}}}return Ge.toTensor()},h.prototype.conv2dDerInput=function(u,d,x){ii([u,d],"conv2dDerInput");for(var T=wo(x.inShape,"float32"),H=T.values,Z=this.readSync(u.dataId),ce=this.readSync(d.dataId),ye=d.strides,Ee=ye[0],je=ye[1],Pe=ye[2],ze=x.batchSize,Ge=x.filterHeight,rt=x.filterWidth,it=x.inChannels,ht=x.inHeight,Et=x.inWidth,At=x.outChannels,St=x.outHeight,Gt=x.outWidth,un=x.strideHeight,vn=x.strideWidth,cn=x.dataFormat,kn=Ge-1-x.padInfo.top,On=rt-1-x.padInfo.left,p=cn==="channelsLast",c=T.strides[0],a=p?T.strides[1]:T.strides[2],l=p?T.strides[2]:1,y=p?1:T.strides[1],S=u.strides[0],U=p?u.strides[1]:u.strides[2],G=p?u.strides[2]:1,ae=p?1:u.strides[1],le=0;le<ze;++le)for(var be=0;be<it;++be)for(var Se=0;Se<ht;++Se)for(var Ie=Se-kn,Me=Math.max(0,Math.ceil(Ie/un)),qe=Math.min(St,(Ge+Ie)/un),Ye=0;Ye<Et;++Ye){for(var Xe=Ye-On,at=Math.max(0,Math.ceil(Xe/vn)),gt=Math.min(Gt,(rt+Xe)/vn),bt=0,_t=Me;_t<qe;++_t)for(var jt=_t*un-Ie,Qt=at;Qt<gt;++Qt)for(var sn=S*le+U*_t+G*Qt,Zt=Ee*(Ge-1-jt)+je*(rt-1-(Qt*vn-Xe))+Pe*be,rn=0;rn<At;++rn)bt+=Z[sn+ae*rn]*ce[Zt+rn];H[c*le+a*Se+l*Ye+y*be]=bt}return T.toTensor()},h.prototype.conv3dDerInput=function(u,d,x){for(var T=wo(x.inShape,"float32"),H=T.values,Z=T.strides,ce=Z[0],ye=Z[1],Ee=Z[2],je=Z[3],Pe=this.readSync(u.dataId),ze=u.strides,Ge=ze[0],rt=ze[1],it=ze[2],ht=ze[3],Et=this.readSync(d.dataId),At=d.strides,St=At[0],Gt=At[1],un=At[2],vn=At[3],cn=x.batchSize,kn=x.filterDepth,On=x.filterHeight,p=x.filterWidth,c=x.inChannels,a=x.inDepth,l=x.inHeight,y=x.inWidth,S=x.outChannels,U=x.outDepth,G=x.outHeight,ae=x.outWidth,le=x.strideDepth,be=x.strideHeight,Se=x.strideWidth,Ie=kn-1-x.padInfo.front,Me=On-1-x.padInfo.top,qe=p-1-x.padInfo.left,Ye=0;Ye<cn;++Ye)for(var Xe=0;Xe<c;++Xe)for(var at=0;at<a;++at)for(var gt=at-Ie,bt=Math.max(0,Math.ceil(gt/le)),_t=Math.min(U,(kn+gt)/le),jt=0;jt<l;++jt)for(var Qt=jt-Me,sn=Math.max(0,Math.ceil(Qt/be)),Zt=Math.min(G,(On+Qt)/be),rn=0;rn<y;++rn){for(var Sn=rn-qe,Bn=Math.max(0,Math.ceil(Sn/Se)),Mn=Math.min(ae,(p+Sn)/Se),fr=0,yr=bt;yr<_t;++yr)for(var Cr=yr*le-gt,Nr=sn;Nr<Zt;++Nr)for(var Ar=Nr*be-Qt,_r=Bn;_r<Mn;++_r)for(var Yr=Ge*Ye+rt*yr+it*Nr+ht*_r,Kr=St*(kn-1-Cr)+Gt*(On-1-Ar)+un*(p-1-(_r*Se-Sn))+vn*Xe,fi=0;fi<S;++fi)fr+=Pe[Yr+fi]*Et[Kr+fi];H[ce*Ye+ye*at+Ee*jt+je*rn+Xe]=fr}return T.toTensor()},h.prototype.conv2dDerFilter=function(u,d,x){ii([u,d],"conv2dDerFilter");for(var T=x.strideHeight,H=x.strideWidth,Z=x.filterHeight,ce=x.filterWidth,ye=x.dataFormat==="channelsLast",Ee=wo(x.filterShape,"float32"),je=x.padInfo.left,Pe=x.padInfo.top,ze=this.bufferSync(u),Ge=this.bufferSync(d),rt=0;rt<Z;++rt)for(var it=Math.max(0,Math.ceil((Pe-rt)/T)),ht=Math.min(x.outHeight,(x.inHeight+Pe-rt)/T),Et=0;Et<ce;++Et)for(var At=Math.max(0,Math.ceil((je-Et)/H)),St=Math.min(x.outWidth,(x.inWidth+je-Et)/H),Gt=0;Gt<x.inChannels;++Gt)for(var un=0;un<x.outChannels;++un){for(var vn=0,cn=0;cn<x.batchSize;++cn)for(var kn=it;kn<ht;++kn)for(var On=rt+kn*T-Pe,p=At;p<St;++p){var c=Et+p*H-je;vn+=ye?ze.get(cn,On,c,Gt)*Ge.get(cn,kn,p,un):ze.get(cn,Gt,On,c)*Ge.get(cn,un,kn,p)}Ee.set(vn,rt,Et,Gt,un)}return Ee.toTensor()},h.prototype.conv3dDerFilter=function(u,d,x){for(var T=x.strideDepth,H=x.strideHeight,Z=x.strideWidth,ce=x.filterDepth,ye=x.filterHeight,Ee=x.filterWidth,je=wo(x.filterShape,"float32"),Pe=je.values,ze=je.strides,Ge=ze[0],rt=ze[1],it=ze[2],ht=ze[3],Et=this.readSync(d.dataId),At=d.strides,St=At[0],Gt=At[1],un=At[2],vn=At[3],cn=this.readSync(u.dataId),kn=u.strides,On=kn[0],p=kn[1],c=kn[2],a=kn[3],l=x.padInfo.front,y=x.padInfo.left,S=x.padInfo.top,U=0;U<ce;++U)for(var G=Math.max(0,Math.ceil((l-U)/T)),ae=Math.min(x.outDepth,(x.inDepth+l-U)/T),le=U*Ge,be=0;be<ye;++be)for(var Se=Math.max(0,Math.ceil((S-be)/H)),Ie=Math.min(x.outHeight,(x.inHeight+S-be)/H),Me=be*rt+le,qe=0;qe<Ee;++qe)for(var Ye=Math.max(0,Math.ceil((y-qe)/Z)),Xe=Math.min(x.outWidth,(x.inWidth+y-qe)/Z),at=qe*it+Me,gt=0;gt<x.inChannels;++gt)for(var bt=gt*ht+at,_t=0;_t<x.outChannels;++_t){for(var jt=0,Qt=0;Qt<x.batchSize;++Qt)for(var sn=Qt*On,Zt=Qt*St,rn=G;rn<ae;++rn)for(var Sn=(U+rn*T-l)*p+sn,Bn=rn*Gt+Zt,Mn=Se;Mn<Ie;++Mn)for(var fr=(be+Mn*H-S)*c+Sn,yr=Mn*un+Bn,Cr=Ye;Cr<Xe;++Cr){var Nr=Cr*vn+yr;jt+=cn[(qe+Cr*Z-y)*a+fr+gt]*Et[Nr+_t]}Pe[bt+_t]=jt}return je.toTensor()},h.prototype.fusedDepthwiseConv2D=function(u){var d=u.input,x=u.filter,T=u.convInfo,H=u.bias,Z=u.activation,ce=u.preluActivationWeights,ye=this.depthwiseConv2D(d,x,T);return H&&(ye=this.add(ye,H)),Z&&(ye=P(this,ye,Z,ce)),ye},h.prototype.depthwiseConv2D=function(u,d,x){ii([u,d],"depthwiseConv2D");for(var T=x.filterHeight,H=x.filterWidth,Z=x.dilationHeight,ce=x.dilationWidth,ye=x.padInfo.left,Ee=x.padInfo.top,je=x.outChannels/x.inChannels,Pe=wo(x.outShape,u.dtype),ze=this.readSync(u.dataId),Ge=this.readSync(d.dataId),rt=Pe.values,it=0;it<x.batchSize;++it)for(var ht=it*u.strides[0],Et=it*Pe.strides[0],At=0;At<x.outHeight;++At)for(var St=Et+At*Pe.strides[1],Gt=At*x.strideHeight-ye,un=0;un<T;++un){var vn=Gt+un*Z;if(!(vn<0||vn>=x.inHeight))for(var cn=un*d.strides[0],kn=ht+vn*u.strides[1],On=0;On<x.outWidth;++On)for(var p=St+On*Pe.strides[2],c=On*x.strideWidth-Ee,a=0;a<H;++a){var l=c+a*ce;if(!(l<0||l>=x.inWidth))for(var y=cn+a*d.strides[1],S=kn+l*x.inChannels,U=p,G=y,ae=0;ae<x.inChannels;++ae){for(var le=ze[S+ae],be=0;be<je;++be)rt[U+be]+=le*Ge[G+be];U+=je,G+=je}}}return Pe.toTensor()},h.prototype.depthwiseConv2DDerInput=function(u,d,x){ii([u,d],"depthwiseConv2DDerInput");for(var T=wo(x.inShape,"float32"),H=T.values,Z=T.strides,ce=Z[0],ye=Z[1],Ee=Z[2],je=this.readSync(u.dataId),Pe=u.strides,ze=Pe[0],Ge=Pe[1],rt=Pe[2],it=this.readSync(d.dataId),ht=d.strides,Et=ht[0],At=ht[1],St=ht[2],Gt=x.batchSize,un=x.filterHeight,vn=x.filterWidth,cn=x.inChannels,kn=x.inHeight,On=x.inWidth,p=x.outChannels,c=x.outHeight,a=x.outWidth,l=x.strideHeight,y=x.strideWidth,S=un-1-x.padInfo.top,U=vn-1-x.padInfo.left,G=p/cn,ae=0;ae<Gt;++ae)for(var le=0;le<cn;++le)for(var be=0;be<kn;++be)for(var Se=be-S,Ie=Math.max(0,Math.ceil(Se/l)),Me=Math.min(c,(un+Se)/l),qe=0;qe<On;++qe){for(var Ye=qe-U,Xe=Math.max(0,Math.ceil(Ye/y)),at=Math.min(a,(vn+Ye)/y),gt=0,bt=Ie;bt<Me;++bt)for(var _t=bt*l-Se,jt=Xe;jt<at;++jt)for(var Qt=ze*ae+Ge*bt+rt*jt,sn=Et*(un-1-_t)+At*(vn-1-(jt*y-Ye))+St*le,Zt=0;Zt<G;++Zt)gt+=je[Qt+(le*G+Zt)]*it[sn+Zt];H[ce*ae+ye*be+Ee*qe+le]=gt}return T.toTensor()},h.prototype.depthwiseConv2DDerFilter=function(u,d,x){ii([u,d],"depthwiseConv2DDerFilter");for(var T=x.strideHeight,H=x.strideWidth,Z=x.filterHeight,ce=x.filterWidth,ye=wo(x.filterShape,"float32"),Ee=x.padInfo.left,je=x.padInfo.top,Pe=x.outChannels/x.inChannels,ze=this.bufferSync(u),Ge=this.bufferSync(d),rt=0;rt<Z;++rt)for(var it=Math.max(0,Math.ceil((je-rt)/T)),ht=Math.min(x.outHeight,(x.inHeight+je-rt)/T),Et=0;Et<ce;++Et)for(var At=Math.max(0,Math.ceil((Ee-Et)/H)),St=Math.min(x.outWidth,(x.inWidth+Ee-Et)/H),Gt=0;Gt<x.outChannels;++Gt){for(var un=Math.trunc(Gt/Pe),vn=Gt%Pe,cn=0,kn=0;kn<x.batchSize;++kn)for(var On=it;On<ht;++On)for(var p=rt+On*T-je,c=At;c<St;++c){var a=Et+c*H-Ee;cn+=ze.get(kn,p,a,un)*Ge.get(kn,On,c,Gt)}ye.set(cn,rt,Et,un,vn)}return ye.toTensor()},h.prototype.tile=function(u,d){return ii(u,"tile"),Cd(this.bufferSync(u),d)},h.prototype.pad=function(u,d,x){ii(u,"pad");var T=d.map(function(Pe,ze){return Pe[0]+u.shape[ze]+Pe[1]}),H=d.map(function(Pe){return Pe[0]}),Z=this.bufferSync(u),ce=wo(T,u.dtype);x!==0&&ce.values.fill(x);for(var ye=0;ye<u.size;ye++){var Ee=Z.indexToLoc(ye),je=Ee.map(function(Pe,ze){return Pe+H[ze]});ce.set.apply(ce,[Z.get.apply(Z,Ee)].concat(je))}return ce.toTensor()},h.prototype.transpose=function(u,d){ii(u,"transpose");for(var x=new Array(u.rank),T=0;T<x.length;T++)x[T]=u.shape[d[T]];var H=this.readSync(u.dataId),Z=wo(x,u.dtype),ce=this.bufferSync(u);for(T=0;T<u.size;++T){for(var ye=ce.indexToLoc(T),Ee=new Array(ye.length),je=0;je<Ee.length;je++)Ee[je]=ye[d[je]];var Pe=Z.locToIndex(Ee);Z.values[Pe]=H[T]}return Z.toTensor()},h.prototype.gather=function(u,d,x){ii([u,d],"gather");var T=u.shape.slice(),H=this.readSync(d.dataId);T[x]=H.length;for(var Z=wo(T,u.dtype),ce=this.bufferSync(u),ye=0;ye<Z.size;++ye){var Ee=Z.indexToLoc(ye),je=Ee.slice();je[x]=H[Ee[x]];var Pe=ce.locToIndex(je);Z.values[ye]=ce.values[Pe]}return Z.toTensor()},h.prototype.batchToSpaceND=function(u,d,x){ii([u],"batchToSpaceND");var T=d.reduce(function(je,Pe){return je*Pe}),H=Pc(u.shape,d,T),Z=Bh(H.length,d.length),ce=Ph(u.shape,d,T),ye=Rl(x,d.length),Ee=ep(ce,x,d.length);return u.reshape(H).transpose(Z).reshape(ce).slice(ye,Ee)},h.prototype.spaceToBatchND=function(u,d,x){ii([u],"spaceToBatchND");var T=d.reduce(function(Pe,ze){return Pe*ze}),H=[[0,0]];H.push.apply(H,x);for(var Z=1+d.length;Z<u.shape.length;++Z)H.push([0,0]);var ce=u.pad(H),ye=Pc(ce.shape,d,T,!1),Ee=Bh(ye.length,d.length,!1),je=Ph(ce.shape,d,T,!1);return ce.reshape(ye).transpose(Ee).reshape(je)},h.prototype.pool=function(u,d,x){ii(u,"pool");for(var T=d.strideHeight,H=d.strideWidth,Z=d.dilationHeight,ce=d.dilationWidth,ye=d.effectiveFilterHeight,Ee=d.effectiveFilterWidth,je=d.padInfo.top,Pe=d.padInfo.left,ze=x==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,Ge=this.readSync(u.dataId),rt=wo(d.outShape,u.dtype),it=rt.values,ht=d.outShape[1]*d.outShape[2]*d.outShape[3],Et=d.outShape[2]*d.outShape[3],At=d.outShape[3],St=0;St<d.batchSize;++St)for(var Gt=St*ht,un=St*u.strides[0],vn=0;vn<d.inChannels;++vn)for(var cn=0;cn<d.outHeight;++cn)for(var kn=cn*T-je,On=Math.max(0,kn),p=Math.min(d.inHeight,ye+kn),c=Gt+cn*Et,a=0;a<d.outWidth;++a){for(var l=a*H-Pe,y=Math.max(0,l),S=Math.min(d.inWidth,Ee+l),U=ze,G=0,ae=0,le=On;le<p;le+=Z){for(var be=un+le*u.strides[1],Se=y;Se<S;Se+=ce){var Ie=Ge[be+Se*u.strides[2]+vn];x==="max"&&Ie>U?U=Ie:x==="avg"&&(G+=Ie,ae++)}if(isNaN(U))break}it[c+a*At+vn]=x==="avg"?G/ae:U}return rt.toTensor()},h.prototype.maxPool=function(u,d){return this.pool(u,d,"max")},h.prototype.maxPoolPositions=function(u,d){for(var x=wo(d.outShape,"int32"),T=d.strideHeight,H=d.strideWidth,Z=d.dilationHeight,ce=d.dilationWidth,ye=d.effectiveFilterHeight,Ee=d.effectiveFilterWidth,je=d.padInfo.top,Pe=d.padInfo.left,ze=this.bufferSync(u),Ge=0;Ge<d.batchSize;++Ge)for(var rt=0;rt<d.inChannels;++rt)for(var it=0;it<d.outHeight;++it){for(var ht=it*T-je,Et=ht;Et<0;)Et+=Z;for(var At=Math.min(d.inHeight,ye+ht),St=0;St<d.outWidth;++St){for(var Gt=St*H-Pe,un=Gt;un<0;)un+=ce;for(var vn=Math.min(d.inWidth,Ee+Gt),cn=Number.NEGATIVE_INFINITY,kn=-1,On=Et;On<At;On+=Z)for(var p=On-ht,c=un;c<vn;c+=ce){var a=c-Gt,l=ze.get(Ge,On,c,rt);l>cn&&(cn=l,kn=p*Ee+a)}x.set(kn,Ge,it,St,rt)}}return x.toTensor()},h.prototype.maxPoolBackprop=function(u,d,x,T){ii([d,x],"maxPoolBackprop");for(var H=this.maxPoolPositions(d,T),Z=T.strideHeight,ce=T.strideWidth,ye=T.dilationHeight,Ee=T.dilationWidth,je=T.effectiveFilterHeight,Pe=T.effectiveFilterWidth,ze=Pe-1-T.padInfo.left,Ge=je-1-T.padInfo.top,rt=wo(d.shape,"float32"),it=this.bufferSync(H),ht=this.bufferSync(u),Et=0;Et<T.batchSize;++Et)for(var At=0;At<T.inChannels;++At)for(var St=0;St<T.inHeight;++St)for(var Gt=0;Gt<T.inWidth;++Gt){for(var un=St-Ge,vn=Gt-ze,cn=0,kn=0;kn<je;kn+=ye){var On=(un+kn)/Z;if(!(On<0||On>=T.outHeight||Math.floor(On)!==On))for(var p=0;p<Pe;p+=Ee){var c=(vn+p)/ce;if(!(c<0||c>=T.outWidth||Math.floor(c)!==c)){var a=je*Pe-1-it.get(Et,On,c,At)===kn*Pe+p?1:0;a!==0&&(cn+=ht.get(Et,On,c,At)*a)}}}rt.set(cn,Et,St,Gt,At)}return rt.toTensor()},h.prototype.avgPoolBackprop=function(u,d,x){ii([u,d],"avgPoolBackprop");for(var T=x.strideHeight,H=x.strideWidth,Z=x.filterHeight,ce=x.filterWidth,ye=x.dilationHeight,Ee=x.dilationWidth,je=x.effectiveFilterHeight,Pe=x.effectiveFilterWidth,ze=Pe-1-x.padInfo.left,Ge=je-1-x.padInfo.top,rt=wo(d.shape,"float32"),it=1/(Z*ce),ht=this.bufferSync(u),Et=0;Et<x.batchSize;++Et)for(var At=0;At<x.inChannels;++At)for(var St=0;St<x.inHeight;++St)for(var Gt=0;Gt<x.inWidth;++Gt){for(var un=St-Ge,vn=Gt-ze,cn=0,kn=0;kn<je;kn+=ye){var On=(un+kn)/T;if(!(On<0||On>=x.outHeight||Math.floor(On)!==On))for(var p=0;p<Pe;p+=Ee){var c=(vn+p)/H;c<0||c>=x.outWidth||Math.floor(c)!==c||(cn+=ht.get(Et,On,c,At))}}rt.set(cn*it,Et,St,Gt,At)}return rt.toTensor()},h.prototype.pool3d=function(u,d,x){ii(u,"pool3d");for(var T=d.strideDepth,H=d.strideHeight,Z=d.strideWidth,ce=d.dilationDepth,ye=d.dilationHeight,Ee=d.dilationWidth,je=d.effectiveFilterDepth,Pe=d.effectiveFilterHeight,ze=d.effectiveFilterWidth,Ge=d.padInfo.front,rt=d.padInfo.top,it=d.padInfo.left,ht=x==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,Et=this.readSync(u.dataId),At=wo(d.outShape,u.dtype),St=At.values,Gt=d.outShape[1]*d.outShape[2]*d.outShape[3]*d.outShape[4],un=d.outShape[2]*d.outShape[3]*d.outShape[4],vn=d.outShape[3]*d.outShape[4],cn=d.outShape[4],kn=0;kn<d.batchSize;++kn)for(var On=kn*Gt,p=kn*u.strides[0],c=0;c<d.inChannels;++c)for(var a=0;a<d.outDepth;++a){for(var l=a*T-Ge,y=l;y<0;)y+=ce;for(var S=Math.min(d.inDepth,je+l),U=On+a*un,G=0;G<d.outHeight;++G){for(var ae=G*H-rt,le=ae;le<0;)le+=ye;for(var be=Math.min(d.inHeight,Pe+ae),Se=U+G*vn,Ie=0;Ie<d.outWidth;++Ie){for(var Me=Ie*Z-it,qe=Me;qe<0;)qe+=Ee;for(var Ye=Math.min(d.inWidth,ze+Me),Xe=Se+Ie*cn,at=ht,gt=0,bt=0,_t=y;_t<S;_t+=ce){for(var jt=p+_t*u.strides[1],Qt=le;Qt<be;Qt+=ye){for(var sn=jt+Qt*u.strides[2],Zt=qe;Zt<Ye;Zt+=Ee){var rn=Et[sn+Zt*u.strides[3]+c];if(x==="max"&&rn>at?at=rn:x==="avg"&&(gt+=rn,bt++),isNaN(at))break}if(isNaN(at))break}if(isNaN(at))break}St[Xe+c]=x==="avg"?gt/bt:at}}}return At.toTensor()},h.prototype.avgPool3d=function(u,d){return ii(u,"avgPool3d"),this.pool3d(u,d,"avg").toFloat()},h.prototype.avgPool3dBackprop=function(u,d,x){ii([u,d],"avgPool3dBackprop");for(var T=x.strideDepth,H=x.strideHeight,Z=x.strideWidth,ce=x.filterDepth,ye=x.filterHeight,Ee=x.filterWidth,je=x.dilationDepth,Pe=x.dilationHeight,ze=x.dilationWidth,Ge=x.effectiveFilterDepth,rt=x.effectiveFilterHeight,it=x.effectiveFilterWidth,ht=Ge-1-x.padInfo.front,Et=it-1-x.padInfo.left,At=rt-1-x.padInfo.top,St=wo(d.shape,"float32"),Gt=1/(ce*ye*Ee),un=this.bufferSync(u),vn=0;vn<x.batchSize;++vn)for(var cn=0;cn<x.inChannels;++cn)for(var kn=0;kn<x.inDepth;++kn)for(var On=0;On<x.inHeight;++On)for(var p=0;p<x.inWidth;++p){for(var c=kn-ht,a=On-At,l=p-Et,y=0,S=0;S<Ge;S+=je){var U=(c+S)/T;if(!(U<0||U>=x.outDepth||Math.floor(U)!==U))for(var G=0;G<rt;G+=Pe){var ae=(a+G)/H;if(!(ae<0||ae>=x.outHeight||Math.floor(ae)!==ae))for(var le=0;le<it;le+=ze){var be=(l+le)/Z;be<0||be>=x.outWidth||Math.floor(be)!==be||(y+=un.get(vn,U,ae,be,cn))}}}St.set(y*Gt,vn,kn,On,p,cn)}return St.toTensor()},h.prototype.maxPool3d=function(u,d){return ii(u,"maxPool3d"),this.pool3d(u,d,"max").toFloat()},h.prototype.maxPool3dPositions=function(u,d){for(var x=wo(d.outShape,"int32"),T=d.strideDepth,H=d.strideHeight,Z=d.strideWidth,ce=d.dilationDepth,ye=d.dilationHeight,Ee=d.dilationWidth,je=d.effectiveFilterDepth,Pe=d.effectiveFilterHeight,ze=d.effectiveFilterWidth,Ge=d.padInfo.front,rt=d.padInfo.top,it=d.padInfo.left,ht=this.bufferSync(u),Et=0;Et<d.batchSize;++Et)for(var At=0;At<d.inChannels;++At)for(var St=0;St<d.outDepth;++St){for(var Gt=St*T-Ge,un=Gt;un<0;)un+=ce;for(var vn=Math.min(d.inDepth,je+Gt),cn=0;cn<d.outHeight;++cn){for(var kn=cn*H-rt,On=kn;On<0;)On+=ye;for(var p=Math.min(d.inHeight,Pe+kn),c=0;c<d.outWidth;++c){for(var a=c*Z-it,l=a;l<0;)l+=Ee;for(var y=Math.min(d.inWidth,ze+a),S=Number.NEGATIVE_INFINITY,U=-1,G=un;G<vn;G+=ce)for(var ae=G-Gt,le=On;le<p;le+=ye)for(var be=le-kn,Se=l;Se<y;Se+=Ee){var Ie=Se-a,Me=ht.get(Et,G,le,Se,At);Me>=S&&(S=Me,U=ae*Pe*ze+be*Pe+Ie)}x.set(U,Et,St,cn,c,At)}}}return x.toTensor()},h.prototype.maxPool3dBackprop=function(u,d,x,T){ii([d,x],"maxPool3dBackprop");for(var H=this.maxPool3dPositions(d,T),Z=T.strideDepth,ce=T.strideHeight,ye=T.strideWidth,Ee=T.dilationDepth,je=T.dilationHeight,Pe=T.dilationWidth,ze=T.effectiveFilterDepth,Ge=T.effectiveFilterHeight,rt=T.effectiveFilterWidth,it=ze-1-T.padInfo.front,ht=rt-1-T.padInfo.left,Et=Ge-1-T.padInfo.top,At=wo(d.shape,"float32"),St=this.bufferSync(H),Gt=this.bufferSync(u),un=0;un<T.batchSize;++un)for(var vn=0;vn<T.inChannels;++vn)for(var cn=0;cn<T.inDepth;++cn)for(var kn=0;kn<T.inHeight;++kn)for(var On=0;On<T.inWidth;++On){for(var p=cn-it,c=kn-Et,a=On-ht,l=0,y=0;y<ze;y+=Ee){var S=(p+y)/Z;if(!(S<0||S>=T.outDepth||Math.floor(S)!==S))for(var U=0;U<Ge;U+=je){var G=(c+U)/ce;if(!(G<0||G>=T.outHeight||Math.floor(G)!==G))for(var ae=0;ae<rt;ae+=Pe){var le=(a+ae)/ye;if(!(le<0||le>=T.outWidth||Math.floor(le)!==le)){var be=ze*Ge*rt-1-St.get(un,S,G,le,vn)===y*Ge*rt+U*rt+ae?1:0;be!==0&&(l+=Gt.get(un,S,G,le,vn)*be)}}}}At.set(l,un,cn,kn,On,vn)}return At.toTensor()},h.prototype.cast=function(u,d){return iu(u,d,this)},h.prototype.reshape=function(u,d){return bl(u,d)},h.prototype.avgPool=function(u,d){return ii(u,"avgPool"),this.pool(u,d,"avg").toFloat()},h.prototype.resizeBilinear=function(u,d,x,T){ii(u,"resizeBilinear");for(var H=u.shape,Z=H[0],ce=H[1],ye=H[2],Ee=H[3],je=this.readSync(u.dataId),Pe=new Float32Array(Qe([Z,d,x,Ee])),ze=[T&&d>1?ce-1:ce,T&&x>1?ye-1:ye],Ge=[T&&d>1?d-1:d,T&&x>1?x-1:x],rt=0,it=ze[0]/Ge[0],ht=ze[1]/Ge[1],Et=0;Et<Z;Et++)for(var At=0;At<d;At++)for(var St=it*At,Gt=Math.floor(St),un=St-Gt,vn=Math.min(ce-1,Math.ceil(St)),cn=Et*u.strides[0]+Gt*u.strides[1],kn=Et*u.strides[0]+vn*u.strides[1],On=0;On<x;On++)for(var p=ht*On,c=Math.floor(p),a=p-c,l=Math.min(ye-1,Math.ceil(p)),y=cn+c*u.strides[2],S=kn+c*u.strides[2],U=cn+l*u.strides[2],G=kn+l*u.strides[2],ae=0;ae<Ee;ae++){var le=je[y+ae],be=je[S+ae],Se=le+(je[U+ae]-le)*a,Ie=Se+(be+(je[G+ae]-be)*a-Se)*un;Pe[rt++]=Ie}return la(Pe,[Z,d,x,Ee])},h.prototype.resizeBilinearBackprop=function(u,d,x){ii([u,d],"resizeBilinearBackprop");for(var T=d.shape,H=T[0],Z=T[1],ce=T[2],ye=T[3],Ee=u.shape,je=Ee[1],Pe=Ee[2],ze=new Float32Array(H*Z*ce*ye),Ge=[x&&je>1?Z-1:Z,x&&Pe>1?ce-1:ce],rt=[x&&je>1?je-1:je,x&&Pe>1?Pe-1:Pe],it=Ge[0]/rt[0],ht=Ge[1]/rt[1],Et=this.readSync(u.dataId),At=0,St=0;St<H;St++)for(var Gt=St*d.strides[0],un=0;un<je;un++)for(var vn=un*it,cn=Math.floor(vn),kn=Math.min(Math.ceil(vn),Z-1),On=Gt+cn*d.strides[1],p=Gt+kn*d.strides[1],c=vn-cn,a=1-c,l=0;l<Pe;l++)for(var y=l*ht,S=Math.floor(y),U=Math.min(Math.ceil(y),ce-1),G=y-S,ae=1-G,le=On+S*d.strides[2],be=On+U*d.strides[2],Se=p+S*d.strides[2],Ie=p+U*d.strides[2],Me=a*ae,qe=a*G,Ye=c*ae,Xe=c*G,at=0;at<ye;at++){var gt=Et[At++];ze[le+at]+=gt*Me,ze[be+at]+=gt*qe,ze[Se+at]+=gt*Ye,ze[Ie+at]+=gt*Xe}return Ac(ze,[H,ce,Z,ye],d.dtype)},h.prototype.resizeNearestNeighbor=function(u,d,x,T){ii(u,"resizeNearestNeighbor");for(var H=u.shape,Z=H[0],ce=H[1],ye=H[2],Ee=H[3],je=this.readSync(u.dataId),Pe=new Float32Array(Z*d*x*Ee),ze=[T&&d>1?ce-1:ce,T&&x>1?ye-1:ye],Ge=[T&&d>1?d-1:d,T&&x>1?x-1:x],rt=ze[0]/Ge[0],it=ze[1]/Ge[1],ht=0,Et=0;Et<Z;Et++)for(var At=Et*u.strides[0],St=0;St<d;St++)for(var Gt=rt*St,un=At+Math.min(ce-1,T?Math.round(Gt):Math.floor(Gt))*u.strides[1],vn=0;vn<x;vn++)for(var cn=it*vn,kn=un+Math.min(ye-1,T?Math.round(cn):Math.floor(cn))*u.strides[2],On=0;On<Ee;On++){var p=je[kn+On];Pe[ht++]=p}return la(Pe,[Z,d,x,Ee],u.dtype)},h.prototype.resizeNearestNeighborBackprop=function(u,d,x){ii([u,d],"resizeNearestNeighborBackprop");for(var T=d.shape,H=T[0],Z=T[1],ce=T[2],ye=T[3],Ee=u.shape,je=Ee[1],Pe=Ee[2],ze=new Float32Array(H*Z*ce*ye),Ge=this.readSync(u.dataId),rt=[x&&je>1?Z-1:Z,x&&Pe>1?ce-1:ce],it=[x&&je>1?je-1:je,x&&Pe>1?Pe-1:Pe],ht=rt[0]/it[0],Et=rt[1]/it[1],At=1/ht,St=1/Et,Gt=2*Math.ceil(At)+2,un=2*Math.ceil(St)+2,vn=0;vn<H;vn++)for(var cn=vn*d.strides[0],kn=0;kn<Z;kn++)for(var On=cn+kn*d.strides[1],p=Math.floor(kn*At),c=Math.floor(p-Gt/2),a=0;a<ce;a++)for(var l=On+a*d.strides[2],y=Math.floor(a*St),S=Math.floor(y-un/2),U=0;U<ye;U++){for(var G=0,ae=0;ae<Gt;ae++){var le=ae+c;if(!(le<0||le>=je)){var be=cn+le*u.strides[1],Se=le*ht;if(kn===Math.min(Z-1,x?Math.round(Se):Math.floor(Se)))for(var Ie=0;Ie<un;Ie++){var Me=Ie+S;if(!(Me<0||Me>=Pe)){var qe=be+Me*u.strides[2],Ye=Me*Et;a===Math.min(ce-1,x?Math.round(Ye):Math.floor(Ye))&&(G+=Ge[qe+U])}}}}ze[l+U]=G}return Ac(ze,d.shape,d.dtype)},h.prototype.batchNormalization=function(u,d,x,T,H,Z){ii([u,d,x,H,Z],"batchNorm");for(var ce=this.readSync(u.dataId),ye=this.readSync(d.dataId),Ee=this.readSync(x.dataId),je=H?this.readSync(H.dataId):new Float32Array([1]),Pe=Z?this.readSync(Z.dataId):new Float32Array([0]),ze=new Float32Array(ce.length),Ge=Pe.length,rt=je.length,it=Ee.length,ht=ye.length,Et=0,At=0,St=0,Gt=0,un=0;un<ce.length;++un)ze[un]=Pe[Et++]+(ce[un]-ye[At++])*je[St++]/Math.sqrt(Ee[Gt++]+T),Et>=Ge&&(Et=0),At>=ht&&(At=0),St>=rt&&(St=0),Gt>=it&&(Gt=0);return Ac(ze,u.shape)},h.prototype.localResponseNormalization4D=function(u,d,x,T,H){ii(u,"localResponseNormalization4D");var Z=u.shape[3],ce=Z-1,ye=this.readSync(u.dataId),Ee=u.size,je=new Float32Array(Ee);function Pe(it){for(var ht=it%Z,Et=it-ht+Math.max(0,ht-d),At=it-ht+Math.min(ht+d,ce),St=0;Et<=At;Et++){var Gt=ye[Et];St+=Gt*Gt}return St}for(var ze=0;ze<Ee;ze++){var Ge=Pe(ze),rt=ye[ze]*Math.pow(x+T*Ge,-H);je[ze]=rt}return Ac(je,u.shape)},h.prototype.LRNGrad=function(u,d,x,T,H,Z,ce){ii(u,"LRNGrad");for(var ye=u.shape[3],Ee=this.readSync(u.dataId),je=this.readSync(d.dataId),Pe=this.readSync(x.dataId),ze=new Float32Array(u.size),Ge=u.size,rt=0;rt<Ge;rt++){for(var it=rt%ye,ht=rt-it+Math.max(0,it-T),Et=rt-it+Math.min(ye,it+T+1),At=0,St=ht;St<Et;St++)At+=Math.pow(je[St],2);for(At=Z*At+H,St=ht;St<Et;St++){var Gt=-2*Z*ce*je[St]*Pe[rt]/At;rt===St&&(Gt+=Math.pow(At,-ce)),Gt*=Ee[rt],ze[St]+=Gt}}return Ac(ze,u.shape)},h.prototype.multinomial=function(u,d,x,T){ii(u,"multinomial");for(var H=d?u:ru(u),Z=H.shape[0],ce=H.shape[1],ye=Io([Z,x],"int32"),Ee=this.readSync(ye.dataId),je=this.readSync(H.dataId),Pe=0;Pe<Z;++Pe){var ze=Pe*ce,Ge=new Float32Array(ce-1);Ge[0]=je[ze];for(var rt=1;rt<Ge.length;++rt)Ge[rt]=Ge[rt-1]+je[ze+rt];for(var it=Zf(T.toString()),ht=Pe*x,Et=0;Et<x;++Et){var At=it();Ee[ht+Et]=Ge.length;for(var St=0;St<Ge.length;St++)if(At<Ge[St]){Ee[ht+Et]=St;break}}}return ye},h.prototype.oneHot=function(u,d,x,T){ii(u,"oneHot");var H=new Float32Array(u.size*d);H.fill(T);for(var Z=this.readSync(u.dataId),ce=0;ce<u.size;++ce)Z[ce]>=0&&Z[ce]<d&&(H[ce*d+Z[ce]]=x);return sc(H,[u.size,d],"int32")},h.prototype.nonMaxSuppression=function(u,d,x,T,H){return ii(u,"nonMaxSuppression"),wl(this.readSync(u.dataId),this.readSync(d.dataId),x,T,H)},h.prototype.fft=function(u){return this.fftBatch(u,!1)},h.prototype.ifft=function(u){return this.fftBatch(u,!0)},h.prototype.fftBatch=function(u,d){for(var x=u.shape[0],T=u.shape[1],H=wo(u.shape,"float32"),Z=wo(u.shape,"float32"),ce=ms(u).as2D(x,T),ye=Ks(u).as2D(x,T),Ee=0;Ee<x;Ee++)for(var je=ce.slice([Ee,0],[1,T]),Pe=ye.slice([Ee,0],[1,T]),ze=aa(je,Pe),Ge=this.readSync(this.fftImpl(ze,d).dataId),rt=0;rt<T;rt++){var it=ih(Ge,rt);H.values[Ee*T+rt]=it.real,Z.values[Ee*T+rt]=it.imag}return aa(H.toTensor(),Z.toTensor()).as2D(x,T)},h.prototype.fftImpl=function(u,d){var x=u.as1D(),T=x.size;if(this.isExponentOf2(T)){var H=this.fftRadix2(x,T,d).as2D(u.shape[0],u.shape[1]);return d&&(H=aa(ms(H).div(Mr(T)),Ks(H).div(Mr(T)))),H}var Z=this.readSync(u.dataId),ce=function(ye){for(var Ee=new Float32Array(ye.length/2),je=new Float32Array(ye.length/2),Pe=0;Pe<ye.length;Pe+=2)Ee[Pe/2]=ye[Pe],je[Pe/2]=ye[Pe+1];return{real:Ee,imag:je}}(this.fourierTransformByMatmul(Z,T,d));return aa(ce.real,ce.imag).as2D(u.shape[0],u.shape[1])},h.prototype.isExponentOf2=function(u){return(u&u-1)==0},h.prototype.fftRadix2=function(u,d,x){if(d===1)return u;var T=this.readSync(u.dataId),H=d/2,Z=function(ht){for(var Et=Math.ceil(ht.length/4),At=new Float32Array(Et),St=new Float32Array(Et),Gt=0;Gt<ht.length;Gt+=4)At[Math.floor(Gt/4)]=ht[Gt],St[Math.floor(Gt/4)]=ht[Gt+1];return{real:At,imag:St}}(T),ce=aa(Z.real,Z.imag).as1D(),ye=function(ht){for(var Et=Math.floor(ht.length/4),At=new Float32Array(Et),St=new Float32Array(Et),Gt=2;Gt<ht.length;Gt+=4)At[Math.floor(Gt/4)]=ht[Gt],St[Math.floor(Gt/4)]=ht[Gt+1];return{real:At,imag:St}}(T),Ee=aa(ye.real,ye.imag).as1D();ce=this.fftRadix2(ce,H,x),Ee=this.fftRadix2(Ee,H,x);var je=function(ht,Et){for(var At=new Float32Array(ht/2),St=new Float32Array(ht/2),Gt=0;Gt<Math.ceil(ht/2);Gt++){var un=(Et?2:-2)*Math.PI*(Gt/ht);At[Gt]=Math.cos(un),St[Gt]=Math.sin(un)}return{real:At,imag:St}}(d,x),Pe=aa(je.real,je.imag).mul(Ee),ze=ce.add(Pe),Ge=ce.sub(Pe),rt=ms(ze).concat(ms(Ge)),it=Ks(ze).concat(Ks(Ge));return aa(rt,it).as1D()},h.prototype.fourierTransformByMatmul=function(u,d,x){for(var T=new Float32Array(2*d),H=0;H<d;H++){for(var Z=0,ce=0,ye=0;ye<d;ye++){var Ee=tp(H*ye,d,x),je=ih(u,ye);Z+=je.real*Ee.real-je.imag*Ee.imag,ce+=je.real*Ee.imag+je.imag*Ee.real}x&&(Z/=d,ce/=d),hc(T,Z,ce,H)}return T},h.prototype.depthToSpace=function(u,d,x){Ce(x==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+x}),Ce(d>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+d});for(var T=u.shape[0],H=u.shape[1],Z=u.shape[2],ce=u.shape[3],ye=H*d,Ee=Z*d,je=ce/(d*d),Pe=this.readSync(u.dataId),ze=new Float32Array(T*ye*Ee*je),Ge=0,rt=0;rt<T;++rt)for(var it=0;it<ye;++it)for(var ht=Math.floor(it/d),Et=it%d,At=0;At<Ee;++At)for(var St=Math.floor(At/d),Gt=(Et*d+At%d)*je,un=0;un<je;++un){var vn=un+Gt+ce*(St+Z*(ht+H*rt));ze[Ge++]=Pe[vn]}return Ac(ze,[T,ye,Ee,je])},h.prototype.broadcastedBinaryOp=function(u,d,x,T){var H=Ro(u.shape,d.shape),Z=wo(H,x),ce=this.readSync(u.dataId),ye=this.readSync(d.dataId),Ee=fu(u.shape,H),je=fu(d.shape,H),Pe=Z.values;if(Ee.length+je.length===0)for(var ze=0;ze<Pe.length;++ze)Pe[ze]=T(ce[ze%ce.length],ye[ze%ye.length]);else{var Ge=this.bufferSync(u),rt=this.bufferSync(d),it=function(ht){var Et=Z.indexToLoc(ht),At=Et.slice(-u.rank);Ee.forEach(function(vn){return At[vn]=0});var St=Ge.locToIndex(At),Gt=Et.slice(-d.rank);je.forEach(function(vn){return Gt[vn]=0});var un=rt.locToIndex(Gt);Pe[ht]=T(ce[St],ye[un])};for(ze=0;ze<Pe.length;++ze)it(ze)}return Z.toTensor()},h.prototype.broadcastedBinaryComplexOp=function(u,d,x){var T=Ro(u.shape,d.shape),H=wo(T,"float32"),Z=wo(T,"float32"),ce=this.readSync(u.dataId),ye=this.readSync(d.dataId),Ee=fu(u.shape,T),je=fu(d.shape,T),Pe=H.values,ze=Z.values;if(Ee.length+je.length===0)for(var Ge=0;Ge<Pe.length;Ge++){var rt=Ge%ce.length,it=Ge%ye.length,ht=x(ce[2*rt],ce[2*rt+1],ye[2*it],ye[2*it+1]);Pe[Ge]=ht.real,ze[Ge]=ht.imag}else{var Et=this.bufferSync(this.data.get(u.dataId).complexTensors.real),At=this.bufferSync(this.data.get(d.dataId).complexTensors.real),St=function(Gt){var un=H.indexToLoc(Gt),vn=un.slice(-u.rank);Ee.forEach(function(c){return vn[c]=0});var cn=Et.locToIndex(vn),kn=un.slice(-d.rank);je.forEach(function(c){return kn[c]=0});var On=At.locToIndex(kn),p=x(ce[2*cn],ce[2*cn+1],ye[2*On],ye[2*On+1]);Pe[Gt]=p.real,ze[Gt]=p.imag};for(Ge=0;Ge<Pe.length;Ge++)St(Ge)}return this.complex(H.toTensor(),Z.toTensor())},h.prototype.split=function(u,d,x){return qh(u,d,x)},h.prototype.dispose=function(){},h.prototype.floatPrecision=function(){return 32},h.prototype.epsilon=function(){return 1e-7},h.prototype.cropAndResize=function(u,d,x,T,H,Z){for(var ce=u.shape,ye=ce[0],Ee=ce[1],je=ce[2],Pe=ce[3],ze=d.shape[0],Ge=T[0],rt=T[1],it=wo([ze,Ge,rt,Pe],"float32"),ht=this.readSync(d.dataId),Et=this.readSync(x.dataId),At=this.readSync(u.dataId),St=u.strides,Gt=it.strides,un=0;un<ze;un++){var vn=4*un,cn=ht[vn],kn=ht[vn+1],On=ht[vn+2],p=ht[vn+3],c=Et[un];if(!(c>=ye))for(var a=Ge>1?(On-cn)*(Ee-1)/(Ge-1):0,l=rt>1?(p-kn)*(je-1)/(rt-1):0,y=0;y<Ge;y++){var S=Ge>1?cn*(Ee-1)+y*a:.5*(cn+On)*(Ee-1);if(S<0||S>Ee-1)for(var U=0;U<rt;U++)for(var G=0;G<Pe;G++){var ae=G+U*Gt[2]+y*Gt[1]+un*Gt[0];it.values[ae]=Z}else if(H==="bilinear"){var le=Math.floor(S),be=Math.ceil(S),Se=S-le;for(U=0;U<rt;U++)if((_t=rt>1?kn*(je-1)+U*l:.5*(kn+p)*(je-1))<0||_t>je-1)for(G=0;G<Pe;G++)ae=G+U*Gt[2]+y*Gt[1]+un*Gt[0],it.values[ae]=Z;else{var Ie=Math.floor(_t),Me=Math.ceil(_t),qe=_t-Ie;for(G=0;G<Pe;G++){var Ye=At[ae=G+Ie*St[2]+le*St[1]+c*St[0]],Xe=At[ae=G+Me*St[2]+le*St[1]+c*St[0]],at=At[ae=G+Ie*St[2]+be*St[1]+c*St[0]],gt=Ye+(Xe-Ye)*qe,bt=at+(At[ae=G+Me*St[2]+be*St[1]+c*St[0]]-at)*qe;ae=G+U*Gt[2]+y*Gt[1]+un*Gt[0],it.values[ae]=gt+(bt-gt)*Se}}}else for(U=0;U<rt;++U){var _t;if((_t=rt>1?kn*(je-1)+U*l:.5*(kn+p)*(je-1))<0||_t>je-1)for(G=0;G<Pe;G++)ae=G+U*Gt[2]+y*Gt[1]+un*Gt[0],it.values[ae]=Z;else{var jt=Math.round(_t),Qt=Math.round(S);for(G=0;G<Pe;G++){var sn=G+jt*St[2]+Qt*St[1]+c*St[0],Zt=G+U*Gt[2]+y*Gt[1]+un*Gt[0];it.values[Zt]=At[sn]}}}}}return it.toTensor()},h.prototype.sparseToDense=function(u,d,x,T){var H=Ml(0,u,x),Z=H.sliceRank,ce=H.numUpdates,ye=H.sliceSize,Ee=H.strides,je=H.outputSize;return this.scatter(u,d,x,je,ye,ce,Z,Ee,T,!1)},h.prototype.gatherND=function(u,d){var x=d.shape,T=x[x.length-1],H=Oc(u,d),Z=H[0],ce=H[1],ye=H[2],Ee=H[3];if(ce===0)return la([],Z,u.dtype);for(var je=new Gi([ce,ye],u.dtype),Pe=this.readSync(d.dataId),ze=this.readSync(u.dataId),Ge=0;Ge<ce;Ge++){for(var rt=[],it=0,ht=0;ht<T;ht++){var Et=Pe[Ge*T+ht];it+=Et*Ee[ht],rt.push(Et)}if(it<0||it>=u.size/ye)throw new Error("Invalid indices: "+rt+" does not index into "+u.shape);for(var At=0;At<ye;At++)je.values[Ge*ye+At]=ze[it*ye+At]}return je.toTensor().reshape(Z)},h.prototype.scatterND=function(u,d,x){var T=Ml(0,u,x),H=T.sliceRank,Z=T.numUpdates,ce=T.sliceSize,ye=T.strides,Ee=T.outputSize,je=Mr(0);return this.scatter(u,d,x,Ee,ce,Z,H,ye,je,!0)},h.prototype.fill=function(u,d,x){var T=pn(x=x||we(d),Qe(u));return T.fill(d),He.makeTensor(T,u,x,this)},h.prototype.onesLike=function(u){if(u.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(u.shape,1,u.dtype)},h.prototype.zerosLike=function(u){var d=pn(u.dtype,Qe(u.shape));return this.makeOutput(d,u.shape,u.dtype)},h.prototype.linspace=function(u,d,x){return Pl(u,d,x)},h.prototype.scatter=function(u,d,x,T,H,Z,ce,ye,Ee,je){var Pe=[T/H,H],ze=this.readSync(u.dataId),Ge=this.readSync(d.dataId);if(T===0)return la([],x,d.dtype);var rt=new Gi(Pe,d.dtype);rt.values.fill(this.readSync(Ee.dataId)[0]);for(var it=0;it<Z;it++){for(var ht=[],Et=0,At=0;At<ce;At++){var St=ze[it*ce+At];ht.push(St),Et+=St*ye[At]}if(Et<0||Et>=T/H)throw new Error("Invalid indices: "+ht+" does not index into "+x);for(var Gt=0;Gt<H;Gt++)je?rt.values[Et*H+Gt]+=Ge[it*H+Gt]:rt.values[Et*H+Gt]=d.rank===0?Ge[0]:Ge[it*H+Gt]}return rt.toTensor().reshape(x)},h}(jl);He.registerBackend("cpu",function(){return new E},1);for(var _=0,k=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(b){var h=b.inputs,u=b.backend,d=b.attrs,x=h,T=x.boxes,H=x.scores,Z=d,ce=Z.maxOutputSize,ye=Z.iouThreshold,Ee=Z.scoreThreshold,je=Z.softNmsSigma,Pe=u;ii(T,"NonMaxSuppressionWithScore");var ze=kl(Pe.data.get(T.dataId).values,Pe.data.get(H.dataId).values,ce,ye,Ee,je);return[ze.selectedIndices,ze.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(b){var h=b.inputs,u=b.backend,d=h.x,x=u;ii(d,"square");for(var T=x.data.get(d.dataId).values,H=new Float32Array(T.length),Z=0;Z<T.length;++Z){var ce=T[Z];H[Z]=ce*ce}return{dataId:x.write(H,d.shape,d.dtype),shape:d.shape,dtype:d.dtype}}},{kernelName:ec,backendName:"cpu",kernelFunc:function(b){var h=b.inputs,u=b.backend,d=h,x=d.a,T=d.b,H=u;ii([x,T],ec);var Z=H.data.get(x.dataId).values,ce=H.data.get(T.dataId).values,ye=function(Pe,ze,Ge,rt,it,ht){var Et=Ro(Pe,ze),At=Et.length,St=Tr(Et),Gt=tr(it,Qe(Et)),un=Pe.length,vn=ze.length,cn=Tr(Pe),kn=Tr(ze),On=fu(Pe,Et),p=fu(ze,Et);if(On.length+p.length===0)for(var c=0;c<Gt.length;++c)Gt[c]=ht(Ge[c%Ge.length],rt[c%rt.length]);else{var a=function(l){var y=Br(l,At,St),S=y.slice(-un);On.forEach(function(le){return S[le]=0});var U=Pr(S,un,cn),G=y.slice(-vn);p.forEach(function(le){return G[le]=0});var ae=Pr(G,vn,kn);Gt[l]=ht(Ge[U],rt[ae])};for(c=0;c<Gt.length;++c)a(c)}return[Gt,Et]}(x.shape,T.shape,Z,ce,x.dtype,function(Pe,ze){var Ge=Pe-ze;return Ge*Ge}),Ee=ye[0],je=ye[1];return{dataId:H.write(Ee,je,x.dtype),shape:je,dtype:x.dtype}}}];_<k.length;_++)pe(k[_]);for(var D,q=0,ee=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(b){var h=b.inputs,u=b.backend,d=b.attrs,x=h.pixels,T=d.numChannels,H=typeof HTMLVideoElement!="undefined"&&x instanceof HTMLVideoElement,Z=typeof HTMLImageElement!="undefined"&&x instanceof HTMLImageElement,ce=H?[x.videoWidth,x.videoHeight]:[x.width,x.height],ye=ce[0],Ee=ce[1],je=[Ee,ye],Pe=[Ee,ye,T];(Z||H)&&(D==null&&(D=document.createElement("canvas").getContext("2d")),D.canvas.width=ye,D.canvas.height=Ee,D.drawImage(x,0,0,ye,Ee),x=D.canvas);var ze=u.makeTensorInfo(je,"int32");u.texData.get(ze.dataId).usage=kr.PIXELS,u.gpgpu.uploadPixelDataToTexture(u.getTexture(ze.dataId),x);var Ge=W().getBool("WEBGL_PACK")?new function(it){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var ht=oe(),Et=it[0],At=it[1];this.outputShape=it,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+At+".0, "+Et+`.0);
            vec4 values = `+ht.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+ht.output+` = result;
      }
    `}(Pe):new function(it){this.variableNames=["A"];var ht=oe(),Et=it[0],At=it[1];this.outputShape=it,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+At+".0, "+Et+`.0);

        vec4 values = `+ht.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}(Pe),rt=u.runWebGLProgram(Ge,[ze],"int32");return u.disposeData(ze.dataId),rt}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(b){var h=b.inputs,u=b.backend,d=b.attrs;Jf("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var x=h,T=x.boxes,H=x.scores,Z=d,ce=Z.maxOutputSize,ye=Z.iouThreshold,Ee=Z.scoreThreshold,je=Z.softNmsSigma,Pe=u,ze=kl(Pe.readSync(T.dataId),Pe.readSync(H.dataId),ce,ye,Ee,je);return[ze.selectedIndices,ze.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(b){var h=b.inputs,u=b.backend,d=h.x,x=u,T=new Wi(d.shape,"return x * x;");return x.runWebGLProgram(T,[d],d.dtype)}},{kernelName:ec,backendName:"webgl",kernelFunc:function(b){var h=b.inputs,u=b.backend,d=h,x=d.a,T=d.b,H=u,Z=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new qi("return (a - b) * (a - b);",x.shape,T.shape):new pi("return (a - b) * (a - b);",x.shape,T.shape);return H.compileAndRun(Z,[x,T])}}];q<ee.length;q++)pe(ee[q]);for(var de=0,_e=[{kernelName:"Square",gradFunc:function(b,h){var u=h[0];return{x:function(){return b.mul(u.toFloat().mul(2))}}}},{kernelName:ec,gradFunc:function(b,h){var u=h[0],d=h[1],x=Mr(2);return{a:function(){return Bf(b,Bf(x,Pf(u,d)))},b:function(){return Bf(b,Bf(x,Pf(d,u)))}}}}];de<_e.length;de++)Oe(_e[de]);var Re=function(){function b(){}return b.prototype.fetch=function(h,u){return fetch(h,u)},b.prototype.now=function(){return performance.now()},b.prototype.encode=function(h,u){if(u!=="utf-8"&&u!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+u);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(h)},b.prototype.decode=function(h,u){return new TextDecoder(u).decode(h)},b}();W().get("IS_BROWSER")&&W().setPlatform("browser",new Re);var De,tt=function(){function b(){this.util=o(249),this.textEncoder=new this.util.TextEncoder}return b.prototype.fetch=function(h,u){return W().global.fetch!=null?W().global.fetch(h,u):(De==null&&(De=o(250)),De(h,u))},b.prototype.now=function(){var h=z.hrtime();return 1e3*h[0]+h[1]/1e6},b.prototype.encode=function(h,u){if(u!=="utf-8"&&u!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+u);return this.textEncoder.encode(h)},b.prototype.decode=function(h,u){return h.length===0?"":new this.util.TextDecoder(u).decode(h)},b}();W().get("IS_NODE")&&W().setPlatform("node",new tt);var st={float32:4,int32:4,uint16:2,uint8:1,bool:1},It=4;function Bt(b,h){for(var u={},d=0,x=function(Z){var ce=Z.name,ye=Z.dtype,Ee=Z.shape,je=Qe(Ee),Pe=void 0;if("quantization"in Z){var ze=Z.quantization;if(ze.dtype!=="uint8"&&ze.dtype!=="uint16")throw new Error("Weight "+Z.name+" has unknown quantization dtype "+ze.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var Ge=st[ze.dtype],rt=b.slice(d,d+je*Ge),it=ze.dtype==="uint8"?new Uint8Array(rt):new Uint16Array(rt);if(ye==="float32")Pe=Float32Array.from(it,function(un){return un*ze.scale+ze.min});else{if(ye!=="int32")throw new Error("Unsupported dtype in weight '"+ce+"': "+ye);Pe=Int32Array.from(it,function(un){return Math.round(un*ze.scale+ze.min)})}d+=je*Ge}else if(ye==="string"){var ht=Qe(Z.shape);Pe=[];for(var Et=0;Et<ht;Et++){var At=new Uint32Array(b.slice(d,d+It))[0];d+=It;var St=new Uint8Array(b.slice(d,d+At));Pe.push(St),d+=At}}else{var Gt=st[ye];if(rt=b.slice(d,d+je*Gt),ye==="float32")Pe=new Float32Array(rt);else if(ye==="int32")Pe=new Int32Array(rt);else{if(ye!=="bool")throw new Error("Unsupported dtype in weight '"+ce+"': "+ye);Pe=new Uint8Array(rt)}d+=je*Gt}u[ce]=la(Pe,Ee,ye)},T=0,H=h;T<H.length;T++)x(H[T]);return u}var mn=I!==void 0&&(typeof Blob=="undefined"||typeof atob=="undefined"||typeof btoa=="undefined");function xn(b){return mn?I.byteLength(b):new Blob([b]).size}function Fn(b){var h=0;b.forEach(function(x){h+=x.byteLength});var u=new Uint8Array(h),d=0;return b.forEach(function(x){u.set(new Uint8Array(x),d),d+=x.byteLength}),u.buffer}function Rn(b){for(b=b.trim();b.endsWith("/");)b=b.slice(0,b.length-1);var h=b.split("/");return h[h.length-1]}function Ln(b){if(b.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:b.modelTopology==null?0:xn(JSON.stringify(b.modelTopology)),weightSpecsBytes:b.weightSpecs==null?0:xn(JSON.stringify(b.weightSpecs)),weightDataBytes:b.weightData==null?0:b.weightData.byteLength}}var Zn=function(){function b(){this.saveRouters=[],this.loadRouters=[]}return b.getInstance=function(){return b.instance==null&&(b.instance=new b),b.instance},b.registerSaveRouter=function(h){b.getInstance().saveRouters.push(h)},b.registerLoadRouter=function(h){b.getInstance().loadRouters.push(h)},b.getSaveHandlers=function(h){return b.getHandlers(h,"save")},b.getLoadHandlers=function(h,u){return b.getHandlers(h,"load",u)},b.getHandlers=function(h,u,d){var x=[];return(u==="load"?b.getInstance().loadRouters:b.getInstance().saveRouters).forEach(function(T){var H=T(h,d);H!==null&&x.push(H)}),x},b}(),An="://",Sr=function(){function b(){this.managers={}}return b.getInstance=function(){return b.instance==null&&(b.instance=new b),b.instance},b.registerManager=function(h,u){Ce(h!=null,function(){return"scheme must not be undefined or null."}),h.endsWith(An)&&(h=h.slice(0,h.indexOf(An))),Ce(h.length>0,function(){return"scheme must not be an empty string."});var d=b.getInstance();Ce(d.managers[h]==null,function(){return"A model store manager is already registered for scheme '"+h+"'."}),d.managers[h]=u},b.getManager=function(h){var u=this.getInstance().managers[h];if(u==null)throw new Error("Cannot find model manager for scheme '"+h+"'");return u},b.getSchemes=function(){return Object.keys(this.getInstance().managers)},b}();function Ur(b){if(b.indexOf(An)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Sr.getSchemes().join(","));return{scheme:b.split(An)[0],path:b.split(An)[1]}}function Wr(b,h,u){return u===void 0&&(u=!1),M(this,void 0,void 0,function(){var d,x,T,H,Z,ce,ye,Ee,je;return V(this,function(Pe){switch(Pe.label){case 0:return Ce(b!==h,function(){return"Old path and new path are the same: '"+b+"'"}),Ce((d=Zn.getLoadHandlers(b)).length>0,function(){return"Copying failed because no load handler is found for source URL "+b+"."}),Ce(d.length<2,function(){return"Copying failed because more than one ("+d.length+") load handlers for source URL "+b+"."}),x=d[0],Ce((T=Zn.getSaveHandlers(h)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+h+"."}),Ce(T.length<2,function(){return"Copying failed because more than one ("+d.length+") save handlers for destination URL "+h+"."}),H=T[0],Z=Ur(b).scheme,ce=Ur(b).path,ye=Z===Ur(b).scheme,[4,x.load()];case 1:return Ee=Pe.sent(),u&&ye?[4,Sr.getManager(Z).removeModel(ce)]:[3,3];case 2:Pe.sent(),Pe.label=3;case 3:return[4,H.save(Ee)];case 4:return je=Pe.sent(),!u||ye?[3,6]:[4,Sr.getManager(Z).removeModel(ce)];case 5:Pe.sent(),Pe.label=6;case 6:return[2,je.modelArtifactsInfo]}})})}var ci="models_store",Jr="model_info_store";function Xi(){if(!W().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var b=window||self,h=b.indexedDB||b.mozIndexedDB||b.webkitIndexedDB||b.msIndexedDB||b.shimIndexedDB;if(h==null)throw new Error("The current browser does not appear to support IndexedDB.");return h}function lo(b){var h=b.result;h.createObjectStore(ci,{keyPath:"modelPath"}),h.createObjectStore(Jr,{keyPath:"modelPath"})}var io=function(){function b(h){if(this.indexedDB=Xi(),h==null||!h)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=h}return b.prototype.save=function(h){return M(this,void 0,void 0,function(){return V(this,function(u){if(h.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,h)]})})},b.prototype.load=function(){return M(this,void 0,void 0,function(){return V(this,function(h){return[2,this.databaseAction(this.modelPath)]})})},b.prototype.databaseAction=function(h,u){var d=this;return new Promise(function(x,T){var H=d.indexedDB.open("tensorflowjs",1);H.onupgradeneeded=function(){return lo(H)},H.onsuccess=function(){var Z=H.result;if(u==null){var ce=Z.transaction(ci,"readonly"),ye=ce.objectStore(ci).get(d.modelPath);ye.onsuccess=function(){if(ye.result==null)return Z.close(),T(new Error("Cannot find model with path '"+d.modelPath+"' in IndexedDB."));x(ye.result.modelArtifacts)},ye.onerror=function(rt){return Z.close(),T(ye.error)},ce.oncomplete=function(){return Z.close()}}else{var Ee,je=Ln(u),Pe=Z.transaction(Jr,"readwrite"),ze=Pe.objectStore(Jr),Ge=ze.put({modelPath:d.modelPath,modelArtifactsInfo:je});Ge.onsuccess=function(){var rt=(Ee=Z.transaction(ci,"readwrite")).objectStore(ci).put({modelPath:d.modelPath,modelArtifacts:u,modelArtifactsInfo:je});rt.onsuccess=function(){return x({modelArtifactsInfo:je})},rt.onerror=function(it){var ht=(ze=Pe.objectStore(Jr)).delete(d.modelPath);ht.onsuccess=function(){return Z.close(),T(rt.error)},ht.onerror=function(Et){return Z.close(),T(rt.error)}}},Ge.onerror=function(rt){return Z.close(),T(Ge.error)},Pe.oncomplete=function(){Ee==null?Z.close():Ee.oncomplete=function(){return Z.close()}}}},H.onerror=function(Z){return T(H.error)}})},b.URL_SCHEME="indexeddb://",b}(),ga=function(b){return W().getBool("IS_BROWSER")&&!Array.isArray(b)&&b.startsWith(io.URL_SCHEME)?(h=b.slice(io.URL_SCHEME.length),new io(h)):null;var h};Zn.registerSaveRouter(ga),Zn.registerLoadRouter(ga);var Ya=function(){function b(){this.indexedDB=Xi()}return b.prototype.listModels=function(){return M(this,void 0,void 0,function(){var h=this;return V(this,function(u){return[2,new Promise(function(d,x){var T=h.indexedDB.open("tensorflowjs",1);T.onupgradeneeded=function(){return lo(T)},T.onsuccess=function(){var H=T.result,Z=H.transaction(Jr,"readonly"),ce=Z.objectStore(Jr).getAll();ce.onsuccess=function(){for(var ye={},Ee=0,je=ce.result;Ee<je.length;Ee++){var Pe=je[Ee];ye[Pe.modelPath]=Pe.modelArtifactsInfo}d(ye)},ce.onerror=function(ye){return H.close(),x(ce.error)},Z.oncomplete=function(){return H.close()}},T.onerror=function(H){return x(T.error)}})]})})},b.prototype.removeModel=function(h){return M(this,void 0,void 0,function(){var u=this;return V(this,function(d){var x;return h=(x=h).startsWith(io.URL_SCHEME)?x.slice(io.URL_SCHEME.length):x,[2,new Promise(function(T,H){var Z=u.indexedDB.open("tensorflowjs",1);Z.onupgradeneeded=function(){return lo(Z)},Z.onsuccess=function(){var ce,ye=Z.result,Ee=ye.transaction(Jr,"readwrite"),je=Ee.objectStore(Jr),Pe=je.get(h);Pe.onsuccess=function(){if(Pe.result==null)return ye.close(),H(new Error("Cannot find model with path '"+h+"' in IndexedDB."));var ze=je.delete(h),Ge=function(){var rt=(ce=ye.transaction(ci,"readwrite")).objectStore(ci).delete(h);rt.onsuccess=function(){return T(Pe.result.modelArtifactsInfo)},rt.onerror=function(it){return H(Pe.error)}};ze.onsuccess=Ge,ze.onerror=function(rt){return Ge(),ye.close(),H(Pe.error)}},Pe.onerror=function(ze){return ye.close(),H(Pe.error)},Ee.oncomplete=function(){ce==null?ye.close():ce.oncomplete=function(){return ye.close()}}},Z.onerror=function(ce){return H(Z.error)}})]})})},b}();if(W().getBool("IS_BROWSER"))try{Sr.registerManager(io.URL_SCHEME,new Ya)}catch{}var Ta="/",Aa="tensorflowjs_models",Ma="info",rs="model_topology",va="weight_specs",Ns="weight_data",Tc="model_metadata";function Ji(b){return{info:[Aa,b,Ma].join(Ta),topology:[Aa,b,rs].join(Ta),weightSpecs:[Aa,b,va].join(Ta),weightData:[Aa,b,Ns].join(Ta),modelMetadata:[Aa,b,Tc].join(Ta)}}function Hi(b){var h=b.split(Ta);if(h.length<3)throw new Error("Invalid key format: "+b);return h.slice(1,h.length-1).join(Ta)}var mu=function(){function b(h){if(!W().getBool("IS_BROWSER")||typeof window=="undefined"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,h==null||!h)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=h,this.keys=Ji(this.modelPath)}return b.prototype.save=function(h){return M(this,void 0,void 0,function(){var u,d,x;return V(this,function(T){if(h.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");u=JSON.stringify(h.modelTopology),d=JSON.stringify(h.weightSpecs),x=Ln(h);try{return this.LS.setItem(this.keys.info,JSON.stringify(x)),this.LS.setItem(this.keys.topology,u),this.LS.setItem(this.keys.weightSpecs,d),this.LS.setItem(this.keys.weightData,function(H){if(mn)return I.from(H).toString("base64");for(var Z=new Uint8Array(H),ce="",ye=0,Ee=Z.length;ye<Ee;ye++)ce+=String.fromCharCode(Z[ye]);return btoa(ce)}(h.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:h.format,generatedBy:h.generatedBy,convertedBy:h.convertedBy,userDefinedMetadata:h.userDefinedMetadata})),[2,{modelArtifactsInfo:x}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+x.modelTopologyBytes+", weightSpecsBytes="+x.weightSpecsBytes+", weightDataBytes="+x.weightDataBytes+".")}return[2]})})},b.prototype.load=function(){return M(this,void 0,void 0,function(){var h,u,d,x,T,H,Z;return V(this,function(ce){if((h=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(h.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(u={},(d=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(u.modelTopology=d,(x=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(u.weightSpecs=x,(T=this.LS.getItem(this.keys.modelMetadata))!=null&&(H=JSON.parse(T),u.format=H.format,u.generatedBy=H.generatedBy,u.convertedBy=H.convertedBy,u.userDefinedMetadata=H.userDefinedMetadata),(Z=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return u.weightData=function(ye){if(mn){var Ee=I.from(ye,"base64");return Ee.buffer.slice(Ee.byteOffset,Ee.byteOffset+Ee.byteLength)}for(var je=atob(ye),Pe=new Uint8Array(je.length),ze=0;ze<je.length;++ze)Pe.set([je.charCodeAt(ze)],ze);return Pe.buffer}(Z),[2,u]})})},b.URL_SCHEME="localstorage://",b}(),os=function(b){return W().getBool("IS_BROWSER")&&!Array.isArray(b)&&b.startsWith(mu.URL_SCHEME)?(h=b.slice(mu.URL_SCHEME.length),new mu(h)):null;var h};Zn.registerSaveRouter(os),Zn.registerLoadRouter(os);var ya=function(){function b(){Ce(W().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),Ce(typeof window=="undefined"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return b.prototype.listModels=function(){return M(this,void 0,void 0,function(){var h,u,d,x,T,H;return V(this,function(Z){for(h={},u=Aa+Ta,d=Ta+Ma,x=0;x<this.LS.length;++x)(T=this.LS.key(x)).startsWith(u)&&T.endsWith(d)&&(H=Hi(T),h[H]=JSON.parse(this.LS.getItem(T)));return[2,h]})})},b.prototype.removeModel=function(h){return M(this,void 0,void 0,function(){var u,d;return V(this,function(x){var T;if(h=(T=h).startsWith(mu.URL_SCHEME)?T.slice(mu.URL_SCHEME.length):T,u=Ji(h),this.LS.getItem(u.info)==null)throw new Error("Cannot find model at path '"+h+"'");return d=JSON.parse(this.LS.getItem(u.info)),this.LS.removeItem(u.info),this.LS.removeItem(u.topology),this.LS.removeItem(u.weightSpecs),this.LS.removeItem(u.weightData),[2,d]})})},b}();if(W().getBool("IS_BROWSER"))try{Sr.registerManager(mu.URL_SCHEME,new ya)}catch{}var cl="model",gu=".json",ll=".weights.bin";function xp(b){return new Promise(function(h){return setTimeout(h)}).then(b)}var Ld=function(){function b(h){if(!W().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");h.startsWith(b.URL_SCHEME)&&(h=h.slice(b.URL_SCHEME.length)),h!=null&&h.length!==0||(h=cl),this.modelTopologyFileName=h+gu,this.weightDataFileName=h+ll}return b.prototype.save=function(h){return M(this,void 0,void 0,function(){var u,d,x,T,H,Z;return V(this,function(ce){switch(ce.label){case 0:if(typeof document=="undefined")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(u=window.URL.createObjectURL(new Blob([h.weightData],{type:"application/octet-stream"})),!(h.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return d=[{paths:["./"+this.weightDataFileName],weights:h.weightSpecs}],x={modelTopology:h.modelTopology,format:h.format,generatedBy:h.generatedBy,convertedBy:h.convertedBy,weightsManifest:d},T=window.URL.createObjectURL(new Blob([JSON.stringify(x)],{type:"application/json"})),(H=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,H.href=T,[4,xp(function(){return H.dispatchEvent(new MouseEvent("click"))})];case 2:return ce.sent(),h.weightData==null?[3,4]:((Z=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,Z.href=u,[4,xp(function(){return Z.dispatchEvent(new MouseEvent("click"))})]);case 3:ce.sent(),ce.label=4;case 4:return[2,{modelArtifactsInfo:Ln(h)}]}})})},b.URL_SCHEME="downloads://",b}(),kh=function(){function b(h){if(h==null||h.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+h);this.files=h}return b.prototype.load=function(){return M(this,void 0,void 0,function(){var h,u,d=this;return V(this,function(x){return h=this.files[0],u=this.files.slice(1),[2,new Promise(function(T,H){var Z=new FileReader;Z.onload=function(ce){var ye=JSON.parse(ce.target.result),Ee=ye.modelTopology;if(Ee!=null){u.length===0&&T({modelTopology:Ee});var je=ye.weightsManifest;if(je!=null){var Pe;try{Pe=d.checkManifestAndWeightFiles(je,u)}catch(it){return void H(it)}var ze=[],Ge=[],rt=[];je.forEach(function(it){it.paths.forEach(function(ht){Ge.push(ht),rt.push(null)}),ze.push.apply(ze,it.weights)}),je.forEach(function(it){it.paths.forEach(function(ht){var Et=new FileReader;Et.onload=function(At){var St=At.target.result,Gt=Ge.indexOf(ht);rt[Gt]=St,rt.indexOf(null)===-1&&T({modelTopology:Ee,weightSpecs:ze,weightData:Fn(rt),format:ye.format,generatedBy:ye.generatedBy,convertedBy:ye.convertedBy,userDefinedMetadata:ye.userDefinedMetadata})},Et.onerror=function(At){return H("Failed to weights data from file of path '"+ht+"'.")},Et.readAsArrayBuffer(Pe[ht])})})}else H(new Error("weightManifest field is missing from file "+h.name))}else H(new Error("modelTopology field is missing from file "+h.name))},Z.onerror=function(ce){return H("Failed to read model topology and weights manifest JSON from file '"+h.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},Z.readAsText(h)})]})})},b.prototype.checkManifestAndWeightFiles=function(h,u){for(var d=[],x=u.map(function(ce){return Rn(ce.name)}),T={},H=0,Z=h;H<Z.length;H++)Z[H].paths.forEach(function(ce){var ye=Rn(ce);if(d.indexOf(ye)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+ye+"'");if(d.push(ye),x.indexOf(ye)===-1)throw new Error("Weight file with basename '"+ye+"' is not provided.");T[ce]=u[x.indexOf(ye)]});if(d.length!==u.length)throw new Error("Mismatch in the number of files in weights manifest ("+d.length+") and the number of weight files provided ("+u.length+").");return T},b}();function ud(b,h,u,d){(function(T){Ce(T!=null&&Array.isArray(T)&&T.length>0,function(){return"promises must be a none empty array"})})(b),function(T,H){Ce(T>=0&&T<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+T}),Ce(H>=0&&H<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+H}),Ce(H>=T,function(){return"startFraction must be no more than endFraction, but got startFraction "+T+" and endFraction "+H})}(u=u==null?0:u,d=d==null?1:d);var x=0;return Promise.all(b.map(function(T){return T.then(function(H){var Z=u+ ++x/b.length*(d-u);return h(Z),H}),T}))}function xf(b,h){return M(this,void 0,void 0,function(){var u,d,x,T,H,Z,ce,ye,Ee;return V(this,function(je){switch(je.label){case 0:return h==null&&(h={}),u=h.fetchFunc==null?W().platform.fetch:h.fetchFunc,d=b.map(function(Pe){return u(Pe,h.requestInit,{isBinary:!0})}),x=0,T=.5,h.onProgress!=null?[3,2]:[4,Promise.all(d)];case 1:return H=je.sent(),[3,4];case 2:return[4,ud(d,h.onProgress,x,T)];case 3:H=je.sent(),je.label=4;case 4:return Z=H.map(function(Pe){return Pe.arrayBuffer()}),ce=.5,ye=1,h.onProgress!=null?[3,6]:[4,Promise.all(Z)];case 5:return Ee=je.sent(),[3,8];case 6:return[4,ud(Z,h.onProgress,ce,ye)];case 7:Ee=je.sent(),je.label=8;case 8:return[2,Ee]}})})}function Gl(b){var h=this;return function(u,d,x){return d===void 0&&(d=""),M(h,void 0,void 0,function(){var T,H,Z,ce,ye,Ee,je,Pe,ze,Ge;return V(this,function(rt){switch(rt.label){case 0:if(T=u.map(function(){return!1}),H={},Z=x!=null?x.map(function(){return!1}):[],ce=[],u.forEach(function(it,ht){var Et=0;it.weights.forEach(function(At){var St="quantization"in At?At.quantization.dtype:At.dtype,Gt=st[St]*Qe(At.shape),un=function(){T[ht]=!0,H[ht]==null&&(H[ht]=[]),H[ht].push({manifestEntry:At,groupOffset:Et,sizeBytes:Gt})};x!=null?x.forEach(function(vn,cn){vn===At.name&&(un(),Z[cn]=!0)}):un(),ce.push(At.name),Et+=Gt})}),!Z.every(function(it){return it}))throw ye=x.filter(function(it,ht){return!Z[ht]}),new Error("Could not find weights in manifest with names: "+ye.join(", ")+`. 
Manifest JSON has weights with names: `+ce.join(", ")+".");return Ee=T.reduce(function(it,ht,Et){return ht&&it.push(Et),it},[]),je=[],Ee.forEach(function(it){u[it].paths.forEach(function(ht){var Et=d+(d.endsWith("/")?"":"/")+ht;je.push(Et)})}),[4,b(je)];case 1:return Pe=rt.sent(),ze={},Ge=0,Ee.forEach(function(it){for(var ht=u[it].paths.length,Et=0,At=0;At<ht;At++)Et+=Pe[Ge+At].byteLength;for(var St=new ArrayBuffer(Et),Gt=new Uint8Array(St),un=0,vn=0;vn<ht;vn++){var cn=new Uint8Array(Pe[Ge+vn]);Gt.set(cn,un),un+=cn.byteLength}H[it].forEach(function(kn){var On=Bt(St.slice(kn.groupOffset,kn.groupOffset+kn.sizeBytes),[kn.manifestEntry]);for(var p in On)ze[p]=On[p]}),Ge+=ht}),[2,ze]}})})}}Zn.registerSaveRouter(function(b){return W().getBool("IS_BROWSER")&&!Array.isArray(b)&&b.startsWith(Ld.URL_SCHEME)?function(h){return h===void 0&&(h="model"),new Ld(h)}(b.slice(Ld.URL_SCHEME.length)):null});var Ja=function(){function b(h,u){if(this.DEFAULT_METHOD="POST",u==null&&(u={}),this.weightPathPrefix=u.weightPathPrefix,this.onProgress=u.onProgress,u.fetchFunc!=null?(Ce(typeof u.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=u.fetchFunc):this.fetch=W().platform.fetch,Ce(h!=null&&h.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(h)&&Ce(h.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+h.length+")."}),this.path=h,u.requestInit!=null&&u.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=u.requestInit||{}}return b.prototype.save=function(h){return M(this,void 0,void 0,function(){var u,d,x,T;return V(this,function(H){switch(H.label){case 0:if(h.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(u=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,d=[{paths:["./model.weights.bin"],weights:h.weightSpecs}],x={modelTopology:h.modelTopology,format:h.format,generatedBy:h.generatedBy,convertedBy:h.convertedBy,userDefinedMetadata:h.userDefinedMetadata,weightsManifest:d},u.body.append("model.json",new Blob([JSON.stringify(x)],{type:"application/json"}),"model.json"),h.weightData!=null&&u.body.append("model.weights.bin",new Blob([h.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,u)];case 1:if((T=H.sent()).ok)return[2,{modelArtifactsInfo:Ln(h),responses:[T]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+T.status+".")}})})},b.prototype.load=function(){return M(this,void 0,void 0,function(){var h,u,d,x,T,H,Z,ce,ye,Ee,je,Pe;return V(this,function(ze){switch(ze.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(h=ze.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+h.status+". Please verify this URL points to the model JSON of the model to load.");ze.label=2;case 2:return ze.trys.push([2,4,,5]),[4,h.json()];case 3:return u=ze.sent(),[3,5];case 4:throw ze.sent(),d="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?d+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":d+=" Please make sure the server is serving valid JSON for this request.",new Error(d);case 5:if(x=u.modelTopology,T=u.weightsManifest,H=u.generatedBy,Z=u.convertedBy,ce=u.format,ye=u.userDefinedMetadata,x==null&&T==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return T==null?[3,7]:[4,this.loadWeights(T)];case 6:Pe=ze.sent(),Ee=Pe[0],je=Pe[1],ze.label=7;case 7:return[2,{modelTopology:x,weightSpecs:Ee,weightData:je,userDefinedMetadata:ye,generatedBy:H,convertedBy:Z,format:ce}]}})})},b.prototype.loadWeights=function(h){return M(this,void 0,void 0,function(){var u,d,x,T,H,Z,ce,ye,Ee,je,Pe;return V(this,function(ze){switch(ze.label){case 0:for(u=Array.isArray(this.path)?this.path[1]:this.path,d=function(Ge){var rt=Ge.lastIndexOf("/"),it=Ge.lastIndexOf("?");return[Ge.substring(0,rt)+"/",it>rt?Ge.substring(it):""]}(u),x=d[0],T=d[1],H=this.weightPathPrefix||x,Z=[],ce=0,ye=h;ce<ye.length;ce++)Ee=ye[ce],Z.push.apply(Z,Ee.weights);return je=[],h.forEach(function(Ge){Ge.paths.forEach(function(rt){je.push(H+rt+T)})}),[4,xf(je,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return Pe=ze.sent(),[2,[Z,Fn(Pe)]]}})})},b.URL_SCHEME_REGEX=/^https?:\/\//,b}();function _h(b){return b.match(Ja.URL_SCHEME_REGEX)!=null}var Uf=function(b,h){return typeof fetch=="undefined"?null:(Array.isArray(b)?b.every(function(u){return _h(u)}):_h(b))?gs(b,{onProgress:h}):null};function gs(b,h){return new Ja(b,h)}Zn.registerSaveRouter(Uf),Zn.registerLoadRouter(Uf);var as,Au=function(){function b(h){this.modelArtifacts=h}return b.prototype.load=function(){return M(this,void 0,void 0,function(){return V(this,function(h){return[2,this.modelArtifacts]})})},b}(),zd=function(){function b(h){this.saveHandler=h}return b.prototype.save=function(h){return M(this,void 0,void 0,function(){return V(this,function(u){return[2,this.saveHandler(h)]})})},b}(),wp=Object.freeze({browserFiles:function(b){return new kh(b)},browserHTTPRequest:function(b,h){return gs(b,h)},concatenateArrayBuffers:Fn,decodeWeights:Bt,encodeWeights:function(b,h){return M(this,void 0,void 0,function(){var u,d,x,T,H,Z=this;return V(this,function(ce){switch(ce.label){case 0:for(u=[],d=[],x=Array.isArray(b)?b.map(function(ye){return ye.name}):Object.keys(b),T=function(ye){var Ee=x[ye],je=Array.isArray(b)?b[ye].tensor:b[Ee];if(je.dtype!=="float32"&&je.dtype!=="int32"&&je.dtype!=="bool"&&je.dtype!=="string")throw new Error("Unsupported dtype in weight '"+Ee+"': "+je.dtype);var Pe={name:Ee,shape:je.shape,dtype:je.dtype};if(je.dtype==="string"){var ze=new Promise(function(Ge){return M(Z,void 0,void 0,function(){var rt,it,ht,Et,At,St,Gt;return V(this,function(un){switch(un.label){case 0:return[4,je.bytes()];case 1:for(rt=un.sent(),it=rt.reduce(function(vn,cn){return vn+cn.length},0)+It*rt.length,ht=new Uint8Array(it),Et=0,At=0;At<rt.length;At++)St=rt[At],Gt=new Uint8Array(new Uint32Array([St.length]).buffer),ht.set(Gt,Et),Et+=It,ht.set(St,Et),Et+=St.length;return Ge(ht),[2]}})})});d.push(ze)}else d.push(je.data());h!=null&&(Pe.group=h),u.push(Pe)},H=0;H<x.length;++H)T(H);return[4,Promise.all(d)];case 1:return[2,{data:function(ye){if(ye===null)throw new Error("Invalid input value: "+JSON.stringify(ye));var Ee=0,je=[];ye.forEach(function(Ge){if(Ee+=Ge.byteLength,je.push(Ge.byteLength===Ge.buffer.byteLength?Ge:new Ge.constructor(Ge)),!(Ge instanceof Float32Array||Ge instanceof Int32Array||Ge instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+Ge.constructor.name)});var Pe=new Uint8Array(Ee),ze=0;return je.forEach(function(Ge){Pe.set(new Uint8Array(Ge.buffer),ze),ze+=Ge.byteLength}),Pe.buffer}(ce.sent()),specs:u}]}})})},fromMemory:function(b,h,u,d){return arguments.length===1?b.modelTopology!=null||b.weightSpecs!=null?new Au(b):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Au({modelTopology:b})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Au({modelTopology:b,weightSpecs:h,weightData:u,trainingConfig:d}))},getLoadHandlers:function(b,h){return Zn.getLoadHandlers(b,h)},getModelArtifactsInfoForJSON:Ln,getSaveHandlers:function(b){return Zn.getSaveHandlers(b)},http:gs,isHTTPScheme:_h,loadWeights:function(b,h,u,d){return h===void 0&&(h=""),M(this,void 0,void 0,function(){return V(this,function(x){return[2,Gl(function(T){return xf(T,{requestInit:d})})(b,h,u)]})})},registerLoadRouter:function(b){return Zn.registerLoadRouter(b)},registerSaveRouter:function(b){return Zn.registerSaveRouter(b)},weightsLoaderFactory:Gl,withSaveHandler:function(b){return new zd(b)},copyModel:function(b,h){return M(this,void 0,void 0,function(){return V(this,function(u){return[2,Wr(b,h,!1)]})})},listModels:function(){return M(this,void 0,void 0,function(){var b,h,u,d,x,T,H;return V(this,function(Z){switch(Z.label){case 0:b=Sr.getSchemes(),h={},u=0,d=b,Z.label=1;case 1:return u<d.length?(x=d[u],[4,Sr.getManager(x).listModels()]):[3,4];case 2:for(H in T=Z.sent())h[x+An+H]=T[H];Z.label=3;case 3:return u++,[3,1];case 4:return[2,h]}})})},moveModel:function(b,h){return M(this,void 0,void 0,function(){return V(this,function(u){return[2,Wr(b,h,!0)]})})},removeModel:function(b){return M(this,void 0,void 0,function(){var h;return V(this,function(u){return h=Ur(b),[2,Sr.getManager(h.scheme).removeModel(h.path)]})})}}),kp=Tt({confusionMatrix_:function(b,h,u){var d=Ze(b,"labels","confusionMatrix"),x=Ze(h,"predictions","confusionMatrix");Ce(u==null||u>0&&Number.isInteger(u),function(){return"If provided, numClasses must be a positive integer, but got "+u}),Ce(d.rank===1,function(){return"Expected the rank of labels to be 1, but got "+d.rank}),Ce(x.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+x.rank}),Ce(d.shape[0]===x.shape[0],function(){return"Mismatch in the number of examples: "+d.shape[0]+" vs. "+x.shape[0]+". Labels and predictions should have the same number of elements."}),Ce(u>0&&Number.isInteger(u),function(){return"numClasses is required to be a positive integer, but got "+u});var T=Zd(d.asType("int32"),u),H=Zd(x.asType("int32"),u);return T.transpose().matMul(H).asType("int32")}}),Wf=Object.freeze({confusionMatrix:kp}),vm=Tt({fromPixels_:function(b,h){if(h===void 0&&(h=3),h>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(b==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var u=!1,d=!1,x=!1,T=!1,H=!1;if(b.data instanceof Uint8Array)u=!0;else if(typeof ImageData!="undefined"&&b instanceof ImageData)d=!0;else if(typeof HTMLVideoElement!="undefined"&&b instanceof HTMLVideoElement)x=!0;else if(typeof HTMLImageElement!="undefined"&&b instanceof HTMLImageElement)T=!0;else{if(b.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+b.constructor.name);H=!0}if(x&&x&&b.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(se("FromPixels",He.backendName)!=null)return He.runKernel("FromPixels",{pixels:b},{numChannels:h});var Z,ce,ye=x?[b.videoWidth,b.videoHeight]:[b.width,b.height],Ee=ye[0],je=ye[1];if(H?Z=b.getContext("2d").getImageData(0,0,Ee,je).data:d||u?Z=b.data:(T||x)&&(as==null&&(as=document.createElement("canvas").getContext("2d")),as.canvas.width=Ee,as.canvas.height=je,as.drawImage(b,0,0,Ee,je),Z=as.getImageData(0,0,Ee,je).data),h===4)ce=new Int32Array(Z);else{var Pe=Ee*je;ce=new Int32Array(Pe*h);for(var ze=0;ze<Pe;ze++)for(var Ge=0;Ge<h;++Ge)ce[ze*h+Ge]=Z[4*ze+Ge]}return nf(ce,[je,Ee,h],"int32")}}),$l=Object.freeze({toPixels:function(b,h){return M(this,void 0,void 0,function(){var u,d,x,T,H,Z,ce,ye,Ee,je,Pe,ze,Ge,rt,it,ht,Et,At,St,Gt,un,vn,cn;return V(this,function(kn){switch(kn.label){case 0:if(u=Ze(b,"img","toPixels"),b instanceof $t||(u=u.toInt()),u.rank!==2&&u.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+u.rank+".");if(d=u.shape.slice(0,2),x=d[0],T=d[1],(H=u.rank===2?1:u.shape[2])>4||H===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+H);return[4,u.data()];case 1:return Z=kn.sent(),ce=u.min(),ye=u.max(),[4,Promise.all([ce.data(),ye.data()])];case 2:if(Ee=kn.sent(),je=Ee[0],Pe=Ee[1],ze=je[0],Ge=Pe[0],ce.dispose(),ye.dispose(),u.dtype==="float32"){if(ze<0||Ge>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+ze+" - "+Ge+"].")}else{if(u.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+u.dtype+". Please use float32 or int32 tensors.");if(ze<0||Ge>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+ze+" - "+Ge+"].")}for(rt=u.dtype==="float32"?255:1,it=new Uint8ClampedArray(T*x*4),ht=0;ht<x*T;++ht)Et=void 0,At=void 0,St=void 0,Gt=void 0,H===1?(Et=Z[ht]*rt,At=Z[ht]*rt,St=Z[ht]*rt,Gt=255):H===3?(Et=Z[3*ht]*rt,At=Z[3*ht+1]*rt,St=Z[3*ht+2]*rt,Gt=255):H===4&&(Et=Z[4*ht]*rt,At=Z[4*ht+1]*rt,St=Z[4*ht+2]*rt,Gt=Z[4*ht+3]*rt),it[0+(un=4*ht)]=Math.round(Et),it[un+1]=Math.round(At),it[un+2]=Math.round(St),it[un+3]=Math.round(Gt);return h!=null&&(h.width=T,h.height=x,vn=h.getContext("2d"),cn=new ImageData(it,T,x),vn.putImageData(cn,0,0)),u!==b&&u.dispose(),[2,it]}})})},fromPixels:vm}),Wu=function(){function b(){}return b.prototype.getClassName=function(){return this.constructor.className},b.fromConfig=function(h,u){return new h(u)},b}(),pc=function(){function b(){this.classNameMap={}}return b.getMap=function(){return b.instance==null&&(b.instance=new b),b.instance},b.register=function(h){b.getMap().classNameMap[h.className]=[h,h.fromConfig]},b}();function vu(b){Ce(b.className!=null,function(){return"Class being registered does not have the static className property defined."}),Ce(typeof b.className=="string",function(){return"className is required to be a string, but got type "+typeof b.className}),Ce(b.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),pc.register(b)}var Eh=Object.freeze({Serializable:Wu,SerializationMap:pc,registerClass:vu}),cd=.001,Ch=.1;function Vu(){return He.backend.floatPrecision()===32?cd:Ch}function Vf(b,h,u){var d=!0;if((yt(b)||yt(h))&&(d=!1),yt(b)&&yt(h)&&(d=!0),d){var x=b.constructor.name,T=h.constructor.name;if(x!==T)throw new Error("Arrays are of different type. Actual: "+x+". Expected: "+T)}if(Array.isArray(b)&&Array.isArray(h)){var H=$s(b),Z=$s(h);if(!fn(H,Z))throw new Error("Arrays have different shapes. Actual: ["+H+"]. Expected: ["+Z+"]")}var ce=yt(b)?b:Ut(b),ye=yt(h)?h:Ut(h);if(ce.length!==ye.length)throw new Error("Arrays have different lengths actual: "+ce.length+" vs expected: "+ye.length+`.
Actual:   `+ce+`.
Expected: `+ye+".");for(var Ee=0;Ee<ye.length;++Ee){var je=ce[Ee],Pe=ye[Ee];if(!u(je,Pe))throw new Error("Arrays differ: actual["+Ee+"] = "+je+", expected["+Ee+"] = "+Pe+`.
Actual:   `+ce+`.
Expected: `+ye+".")}}function Ah(b,h,u){return!isFinite(b)&&!isFinite(h)||!(isNaN(b)||isNaN(h)||Math.abs(b-h)>u)}var Wc=Object.freeze({TEST_EPSILON_FLOAT16:Ch,expectArraysClose:function(b,h,u){return u==null&&(u=Vu()),Vf(b,h,function(d,x){return Ah(d,x,u)})},testEpsilon:Vu,expectPromiseToFail:function(b,h){b().then(function(){return h.fail()},function(){return h()})},expectArraysEqual:function(b,h){var u=typeof h=="string"||typeof h=="number"||typeof h=="boolean"?[h]:h;return zn(b)||zn(b[0])||zn(h)||zn(h[0])?Vf(b,u,function(d,x){return d==x}):Vf(b,h,function(d,x){return Ah(d,x,0)})},expectNumbersClose:function(b,h,u){if(u==null&&(u=Vu()),!Ah(b,h,u))throw new Error("Numbers differ: actual === "+b+", expected === "+h)},expectValuesInRange:function(b,h,u){for(var d=0;d<b.length;d++)if(b[d]<h||b[d]>u)throw new Error("Value out of range:"+b[d]+" low: "+h+", high: "+u)},expectArrayBuffersEqual:function(b,h){expect(new Float32Array(b)).toEqual(new Float32Array(h))}}),wv="1.7.0",Oh=Object.freeze({gpgpu_util:dc,webgl_util:xi,forceHalfFloat:function(){W().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:l0,setWebGLContext:Do,GPGPUContext:ns}),_p=function(b){function h(){return b!==null&&b.apply(this,arguments)||this}return K(h,b),h.prototype.minimize=function(u,d,x){d===void 0&&(d=!1);var T=this.computeGradients(u,x),H=T.value,Z=T.grads;if(x!=null){var ce=x.map(function(ye){return{name:ye.name,tensor:Z[ye.name]}});this.applyGradients(ce)}else this.applyGradients(Z);return Oa(Z),d?H:(H.dispose(),null)},Object.defineProperty(h.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),h.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},h.prototype.computeGradients=function(u,d){return ln(u,d)},h.prototype.dispose=function(){this.iterations_!=null&&Oa(this.iterations_)},h.prototype.saveIterations=function(){return M(this,void 0,void 0,function(){return V(this,function(u){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Mr(this.iterations_,"int32")}]})})},h.prototype.getWeights=function(){return M(this,void 0,void 0,function(){return V(this,function(u){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},h.prototype.setWeights=function(u){return M(this,void 0,void 0,function(){return V(this,function(d){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},h.prototype.extractIterations=function(u){return M(this,void 0,void 0,function(){var d;return V(this,function(x){switch(x.label){case 0:return d=this,[4,u[0].tensor.data()];case 1:return d.iterations_=x.sent()[0],[2,u.slice(1)]}})})},h}(Wu);Object.defineProperty(_p,Symbol.hasInstance,{value:function(b){return b.minimize!=null&&b.computeGradients!=null&&b.applyGradients!=null}});var Q0=function(b){function h(u,d,x){x===void 0&&(x=null);var T=b.call(this)||this;return T.learningRate=u,T.rho=d,T.epsilon=x,T.accumulatedGrads=[],T.accumulatedUpdates=[],x==null&&(T.epsilon=He.backend.epsilon()),T}return K(h,b),h.prototype.applyGradients=function(u){var d=this;(Array.isArray(u)?u.map(function(x){return x.name}):Object.keys(u)).forEach(function(x,T){var H=He.registeredVariables[x];d.accumulatedGrads[T]==null&&(d.accumulatedGrads[T]={originalName:x+"/accum_grad",variable:so(function(){return Ri(H).variable(!1)})}),d.accumulatedUpdates[T]==null&&(d.accumulatedUpdates[T]={originalName:x+"/accum_var",variable:so(function(){return Ri(H).variable(!1)})});var Z=Array.isArray(u)?u[T].tensor:u[x];if(Z!=null){var ce=d.accumulatedGrads[T].variable,ye=d.accumulatedUpdates[T].variable;so(function(){var Ee=ce.mul(d.rho).add(Z.square().mul(1-d.rho)),je=ye.add(d.epsilon).sqrt().div(ce.add(d.epsilon).sqrt()).mul(Z),Pe=ye.mul(d.rho).add(je.square().mul(1-d.rho));ce.assign(Ee),ye.assign(Pe);var ze=je.mul(-d.learningRate).add(H);H.assign(ze)})}}),this.incrementIterations()},h.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Oa(this.accumulatedGrads.map(function(u){return u.variable})),Oa(this.accumulatedUpdates.map(function(u){return u.variable})))},h.prototype.getWeights=function(){return M(this,void 0,void 0,function(){var u;return V(this,function(d){switch(d.label){case 0:return u=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[d.sent()].concat(u.map(function(x){return{name:x.originalName,tensor:x.variable}}))]}})})},h.prototype.setWeights=function(u){return M(this,void 0,void 0,function(){var d;return V(this,function(x){switch(x.label){case 0:return[4,this.extractIterations(u)];case 1:return u=x.sent(),d=u.length/2,this.accumulatedGrads=u.slice(0,d).map(function(T){return{originalName:T.name,variable:T.tensor.variable(!1)}}),this.accumulatedUpdates=u.slice(d,2*d).map(function(T){return{originalName:T.name,variable:T.tensor.variable(!1)}}),[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},h.fromConfig=function(u,d){return new u(d.learningRate,d.rho,d.epsilon)},h.className="Adadelta",h}(_p);vu(Q0);var ld=function(b){function h(u,d){d===void 0&&(d=.1);var x=b.call(this)||this;return x.learningRate=u,x.initialAccumulatorValue=d,x.accumulatedGrads=[],x}return K(h,b),h.prototype.applyGradients=function(u){var d=this;(Array.isArray(u)?u.map(function(x){return x.name}):Object.keys(u)).forEach(function(x,T){var H=He.registeredVariables[x];d.accumulatedGrads[T]==null&&(d.accumulatedGrads[T]={originalName:x+"/accumulator",variable:so(function(){return Nu(H.shape,d.initialAccumulatorValue).variable(!1)})});var Z=Array.isArray(u)?u[T].tensor:u[x];if(Z!=null){var ce=d.accumulatedGrads[T].variable;so(function(){var ye=ce.add(Z.square());ce.assign(ye);var Ee=Z.div(ye.add(He.backend.epsilon()).sqrt()).mul(-d.learningRate).add(H);H.assign(Ee)})}}),this.incrementIterations()},h.prototype.dispose=function(){this.accumulatedGrads!=null&&Oa(this.accumulatedGrads.map(function(u){return u.variable}))},h.prototype.getWeights=function(){return M(this,void 0,void 0,function(){return V(this,function(u){switch(u.label){case 0:return[4,this.saveIterations()];case 1:return[2,[u.sent()].concat(this.accumulatedGrads.map(function(d){return{name:d.originalName,tensor:d.variable}}))]}})})},h.prototype.setWeights=function(u){return M(this,void 0,void 0,function(){return V(this,function(d){switch(d.label){case 0:return[4,this.extractIterations(u)];case 1:return u=d.sent(),this.accumulatedGrads=u.map(function(x){return{originalName:x.name,variable:x.tensor.variable(!1)}}),[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},h.fromConfig=function(u,d){return new u(d.learningRate,d.initialAccumulatorValue)},h.className="Adagrad",h}(_p);vu(ld);var ua=function(b){function h(u,d,x,T){T===void 0&&(T=null);var H=b.call(this)||this;return H.learningRate=u,H.beta1=d,H.beta2=x,H.epsilon=T,H.accumulatedFirstMoment=[],H.accumulatedSecondMoment=[],so(function(){H.accBeta1=Mr(d).variable(),H.accBeta2=Mr(x).variable()}),T==null&&(H.epsilon=He.backend.epsilon()),H}return K(h,b),h.prototype.applyGradients=function(u){var d=this,x=Array.isArray(u)?u.map(function(T){return T.name}):Object.keys(u);so(function(){var T=Pf(1,d.accBeta1),H=Pf(1,d.accBeta2);x.forEach(function(Z,ce){var ye=He.registeredVariables[Z];d.accumulatedFirstMoment[ce]==null&&(d.accumulatedFirstMoment[ce]={originalName:Z+"/m",variable:so(function(){return Ri(ye).variable(!1)})}),d.accumulatedSecondMoment[ce]==null&&(d.accumulatedSecondMoment[ce]={originalName:Z+"/v",variable:so(function(){return Ri(ye).variable(!1)})});var Ee=Array.isArray(u)?u[ce].tensor:u[Z];if(Ee!=null){var je=d.accumulatedFirstMoment[ce].variable,Pe=d.accumulatedSecondMoment[ce].variable,ze=je.mul(d.beta1).add(Ee.mul(1-d.beta1)),Ge=Pe.mul(d.beta2).add(Ee.square().mul(1-d.beta2)),rt=ze.div(T),it=Ge.div(H);je.assign(ze),Pe.assign(Ge);var ht=rt.div(it.sqrt().add(d.epsilon)).mul(-d.learningRate).add(ye);ye.assign(ht)}}),d.accBeta1.assign(d.accBeta1.mul(d.beta1)),d.accBeta2.assign(d.accBeta2.mul(d.beta2))}),this.incrementIterations()},h.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Oa(this.accumulatedFirstMoment.map(function(u){return u.variable})),this.accumulatedSecondMoment!=null&&Oa(this.accumulatedSecondMoment.map(function(u){return u.variable}))},h.prototype.getWeights=function(){return M(this,void 0,void 0,function(){var u;return V(this,function(d){switch(d.label){case 0:return u=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[d.sent()].concat(u.map(function(x){return{name:x.originalName,tensor:x.variable}}))]}})})},h.prototype.setWeights=function(u){return M(this,void 0,void 0,function(){var d,x=this;return V(this,function(T){switch(T.label){case 0:return[4,this.extractIterations(u)];case 1:return u=T.sent(),so(function(){x.accBeta1.assign(Id(x.beta1,x.iterations_+1)),x.accBeta2.assign(Id(x.beta2,x.iterations_+1))}),d=u.length/2,this.accumulatedFirstMoment=u.slice(0,d).map(function(H){return{originalName:H.name,variable:H.tensor.variable(!1)}}),this.accumulatedSecondMoment=u.slice(d,2*d).map(function(H){return{originalName:H.name,variable:H.tensor.variable(!1)}}),[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},h.fromConfig=function(u,d){return new u(d.learningRate,d.beta1,d.beta2,d.epsilon)},h.className="Adam",h}(_p);vu(ua);var Qg=function(b){function h(u,d,x,T,H){T===void 0&&(T=null),H===void 0&&(H=0);var Z=b.call(this)||this;return Z.learningRate=u,Z.beta1=d,Z.beta2=x,Z.epsilon=T,Z.decay=H,Z.accumulatedFirstMoment=[],Z.accumulatedWeightedInfNorm=[],so(function(){Z.iteration=Mr(0).variable(),Z.accBeta1=Mr(d).variable()}),T==null&&(Z.epsilon=He.backend.epsilon()),Z}return K(h,b),h.prototype.applyGradients=function(u){var d=this,x=Array.isArray(u)?u.map(function(T){return T.name}):Object.keys(u);so(function(){var T=Pf(1,d.accBeta1),H=Mf(-d.learningRate,d.iteration.mul(d.decay).add(1));x.forEach(function(Z,ce){var ye=He.registeredVariables[Z];d.accumulatedFirstMoment[ce]==null&&(d.accumulatedFirstMoment[ce]={originalName:Z+"/m",variable:Ri(ye).variable(!1)}),d.accumulatedWeightedInfNorm[ce]==null&&(d.accumulatedWeightedInfNorm[ce]={originalName:Z+"/v",variable:Ri(ye).variable(!1)});var Ee=Array.isArray(u)?u[ce].tensor:u[Z];if(Ee!=null){var je=d.accumulatedFirstMoment[ce].variable,Pe=d.accumulatedWeightedInfNorm[ce].variable,ze=je.mul(d.beta1).add(Ee.mul(1-d.beta1)),Ge=Pe.mul(d.beta2),rt=Ee.abs(),it=Ge.maximum(rt);je.assign(ze),Pe.assign(it);var ht=H.div(T).mul(ze.div(it.add(d.epsilon))).add(ye);ye.assign(ht)}}),d.iteration.assign(d.iteration.add(1)),d.accBeta1.assign(d.accBeta1.mul(d.beta1))}),this.incrementIterations()},h.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Oa(this.accumulatedFirstMoment.map(function(u){return u.variable})),this.accumulatedWeightedInfNorm!=null&&Oa(this.accumulatedWeightedInfNorm.map(function(u){return u.variable}))},h.prototype.getWeights=function(){return M(this,void 0,void 0,function(){return V(this,function(u){throw new Error("getWeights() is not implemented for Adamax yet.")})})},h.prototype.setWeights=function(u){return M(this,void 0,void 0,function(){return V(this,function(d){throw new Error("setWeights() is not implemented for Adamax yet.")})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},h.fromConfig=function(u,d){return new u(d.learningRate,d.beta1,d.beta2,d.epsilon,d.decay)},h.className="Adamax",h}(_p);vu(Qg);var Kl=function(b){function h(u){var d=b.call(this)||this;return d.learningRate=u,d.setLearningRate(u),d}return K(h,b),h.prototype.applyGradients=function(u){var d=this;(Array.isArray(u)?u.map(function(x){return x.name}):Object.keys(u)).forEach(function(x,T){var H=Array.isArray(u)?u[T].tensor:u[x];if(H!=null){var Z=He.registeredVariables[x];so(function(){var ce=d.c.mul(H).add(Z);Z.assign(ce)})}}),this.incrementIterations()},h.prototype.setLearningRate=function(u){this.learningRate=u,this.c!=null&&this.c.dispose(),this.c=Fh(Mr(-u))},h.prototype.dispose=function(){this.c.dispose()},h.prototype.getWeights=function(){return M(this,void 0,void 0,function(){return V(this,function(u){switch(u.label){case 0:return[4,this.saveIterations()];case 1:return[2,[u.sent()]]}})})},h.prototype.setWeights=function(u){return M(this,void 0,void 0,function(){return V(this,function(d){switch(d.label){case 0:return[4,this.extractIterations(u)];case 1:if((u=d.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate}},h.fromConfig=function(u,d){return new u(d.learningRate)},h.className="SGD",h}(_p);vu(Kl);var Zg=function(b){function h(u,d,x){x===void 0&&(x=!1);var T=b.call(this,u)||this;return T.learningRate=u,T.momentum=d,T.useNesterov=x,T.accumulations=[],T.m=Mr(T.momentum),T}return K(h,b),h.prototype.applyGradients=function(u){var d=this;(Array.isArray(u)?u.map(function(x){return x.name}):Object.keys(u)).forEach(function(x,T){var H=He.registeredVariables[x];d.accumulations[T]==null&&(d.accumulations[T]={originalName:x+"/momentum",variable:so(function(){return Ri(H).variable(!1)})});var Z=d.accumulations[T].variable,ce=Array.isArray(u)?u[T].tensor:u[x];ce!=null&&so(function(){var ye,Ee=d.m.mul(Z).add(ce);ye=d.useNesterov?d.c.mul(ce.add(Ee.mul(d.m))).add(H):d.c.mul(Ee).add(H),Z.assign(Ee),H.assign(ye)})}),this.incrementIterations()},h.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Oa(this.accumulations.map(function(u){return u.variable}))},h.prototype.setMomentum=function(u){this.momentum=u},h.prototype.getWeights=function(){return M(this,void 0,void 0,function(){return V(this,function(u){switch(u.label){case 0:return[4,this.saveIterations()];case 1:return[2,[u.sent()].concat(this.accumulations.map(function(d){return{name:d.originalName,tensor:d.variable}}))]}})})},h.prototype.setWeights=function(u){return M(this,void 0,void 0,function(){return V(this,function(d){switch(d.label){case 0:return[4,this.extractIterations(u)];case 1:return u=d.sent(),this.accumulations=u.map(function(x){return{originalName:x.name,variable:x.tensor.variable(!1)}}),[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},h.fromConfig=function(u,d){return new u(d.learningRate,d.momentum,d.useNesterov)},h.className="Momentum",h}(Kl);vu(Zg);var Z0=function(b){function h(u,d,x,T,H){d===void 0&&(d=.9),x===void 0&&(x=0),T===void 0&&(T=null),H===void 0&&(H=!1);var Z=b.call(this)||this;if(Z.learningRate=u,Z.decay=d,Z.momentum=x,Z.epsilon=T,Z.accumulatedMeanSquares=[],Z.accumulatedMoments=[],Z.accumulatedMeanGrads=[],Z.centered=H,T==null&&(Z.epsilon=He.backend.epsilon()),u==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return Z}return K(h,b),h.prototype.applyGradients=function(u){var d=this;(Array.isArray(u)?u.map(function(x){return x.name}):Object.keys(u)).forEach(function(x,T){var H=He.registeredVariables[x];d.accumulatedMeanSquares[T]==null&&(d.accumulatedMeanSquares[T]={originalName:x+"/rms",variable:so(function(){return Ri(H).variable(!1)})}),d.accumulatedMoments[T]==null&&(d.accumulatedMoments[T]={originalName:x+"/momentum",variable:so(function(){return Ri(H).variable(!1)})}),d.accumulatedMeanGrads[T]==null&&d.centered&&(d.accumulatedMeanGrads[T]={originalName:x+"/mg",variable:so(function(){return Ri(H).variable(!1)})});var Z=Array.isArray(u)?u[T].tensor:u[x];if(Z!=null){var ce=d.accumulatedMeanSquares[T].variable,ye=d.accumulatedMoments[T].variable;so(function(){var Ee=ce.mul(d.decay).add(Z.square().mul(1-d.decay));if(d.centered){var je=d.accumulatedMeanGrads[T].variable,Pe=je.mul(d.decay).add(Z.mul(1-d.decay)),ze=ye.mul(d.momentum).add(Z.mul(d.learningRate).div(Ee.sub(Pe.square().add(d.epsilon)).sqrt()));ce.assign(Ee),je.assign(Pe),ye.assign(ze);var Ge=H.sub(ze);H.assign(Ge)}else{var rt=ce.mul(d.decay).add(Z.square().mul(1-d.decay));ze=ye.mul(d.momentum).add(Z.mul(d.learningRate).div(rt.add(d.epsilon).sqrt())),ce.assign(rt),ye.assign(ze),Ge=H.sub(ze),H.assign(Ge)}})}}),this.incrementIterations()},h.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Oa(this.accumulatedMeanSquares.map(function(u){return u.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Oa(this.accumulatedMeanGrads.map(function(u){return u.variable})),this.accumulatedMoments!=null&&Oa(this.accumulatedMoments.map(function(u){return u.variable}))},h.prototype.getWeights=function(){return M(this,void 0,void 0,function(){var u;return V(this,function(d){switch(d.label){case 0:return u=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&u.push.apply(u,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[d.sent()].concat(u.map(function(x){return{name:x.originalName,tensor:x.variable}}))]}})})},h.prototype.setWeights=function(u){return M(this,void 0,void 0,function(){var d;return V(this,function(x){switch(x.label){case 0:return[4,this.extractIterations(u)];case 1:return u=x.sent(),d=this.centered?u.length/3:u.length/2,this.accumulatedMeanSquares=u.slice(0,d).map(function(T){return{originalName:T.name,variable:T.tensor.variable(!1)}}),this.accumulatedMoments=u.slice(d,2*d).map(function(T){return{originalName:T.name,variable:T.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=u.slice(2*d,3*d).map(function(T){return{originalName:T.name,variable:T.tensor.variable(!1)}})),[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},h.fromConfig=function(u,d){return new u(d.learningRate,d.decay,d.momentum,d.epsilon,d.centered)},h.className="RMSProp",h}(_p);vu(Z0);var ca=function(){function b(){}return b.sgd=function(h){return new Kl(h)},b.momentum=function(h,u,d){return d===void 0&&(d=!1),new Zg(h,u,d)},b.rmsprop=function(h,u,d,x,T){return u===void 0&&(u=.9),d===void 0&&(d=0),x===void 0&&(x=null),T===void 0&&(T=!1),new Z0(h,u,d,x,T)},b.adam=function(h,u,d,x){return h===void 0&&(h=.001),u===void 0&&(u=.9),d===void 0&&(d=.999),x===void 0&&(x=null),new ua(h,u,d,x)},b.adadelta=function(h,u,d){return h===void 0&&(h=.001),u===void 0&&(u=.95),d===void 0&&(d=null),new Q0(h,u,d)},b.adamax=function(h,u,d,x,T){return h===void 0&&(h=.002),u===void 0&&(u=.9),d===void 0&&(d=.999),x===void 0&&(x=null),T===void 0&&(T=0),new Qg(h,u,d,x,T)},b.adagrad=function(h,u){return u===void 0&&(u=.1),new ld(h,u)},b}(),kv={sgd:ca.sgd,momentum:ca.momentum,adadelta:ca.adadelta,adagrad:ca.adagrad,rmsprop:ca.rmsprop,adamax:ca.adamax,adam:ca.adam},Cl=typeof requestAnimationFrame!="undefined"?requestAnimationFrame:A!==void 0?A:function(b){return b()};function wf(){return new Promise(function(b){return Cl(function(){return b()})})}$t.prototype.squaredDifference=function(b){return il(this,b)},Ot=hg}.call(this,o(59),o(75),o(92).Buffer,o(207).setImmediate)},function(j,m,o){j.exports=o(281)},function(j,m,o){o.d(m,"c",function(){return z}),o.d(m,"a",function(){return I}),o.d(m,"b",function(){return A}),o.d(m,"d",function(){return X}),o.d(m,"e",function(){return K});/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var g=function(M,V){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function($,W){$.__proto__=W}||function($,W){for(var te in W)W.hasOwnProperty(te)&&($[te]=W[te])})(M,V)};function z(M,V){function $(){this.constructor=M}g(M,V),M.prototype=V===null?Object.create(V):($.prototype=V.prototype,new $)}var I=function(){return(I=Object.assign||function(M){for(var V,$=1,W=arguments.length;$<W;$++)for(var te in V=arguments[$])Object.prototype.hasOwnProperty.call(V,te)&&(M[te]=V[te]);return M}).apply(this,arguments)};function A(M,V,$,W){return new($||($=Promise))(function(te,F){function ue(me){try{J(W.next(me))}catch(pe){F(pe)}}function se(me){try{J(W.throw(me))}catch(pe){F(pe)}}function J(me){me.done?te(me.value):function(pe){return pe instanceof $?pe:new $(function(Oe){Oe(pe)})}(me.value).then(ue,se)}J((W=W.apply(M,V||[])).next())})}function X(M,V){var $,W,te,F,ue={label:0,sent:function(){if(1&te[0])throw te[1];return te[1]},trys:[],ops:[]};return F={next:se(0),throw:se(1),return:se(2)},typeof Symbol=="function"&&(F[Symbol.iterator]=function(){return this}),F;function se(J){return function(me){return function(pe){if($)throw new TypeError("Generator is already executing.");for(;ue;)try{if($=1,W&&(te=2&pe[0]?W.return:pe[0]?W.throw||((te=W.return)&&te.call(W),0):W.next)&&!(te=te.call(W,pe[1])).done)return te;switch(W=0,te&&(pe=[2&pe[0],te.value]),pe[0]){case 0:case 1:te=pe;break;case 4:return ue.label++,{value:pe[1],done:!1};case 5:ue.label++,W=pe[1],pe=[0];continue;case 7:pe=ue.ops.pop(),ue.trys.pop();continue;default:if(!(te=(te=ue.trys).length>0&&te[te.length-1])&&(pe[0]===6||pe[0]===2)){ue=0;continue}if(pe[0]===3&&(!te||pe[1]>te[0]&&pe[1]<te[3])){ue.label=pe[1];break}if(pe[0]===6&&ue.label<te[1]){ue.label=te[1],te=pe;break}if(te&&ue.label<te[2]){ue.label=te[2],ue.ops.push(pe);break}te[2]&&ue.ops.pop(),ue.trys.pop();continue}pe=V.call(M,ue)}catch(Oe){pe=[6,Oe],W=0}finally{$=te=0}if(5&pe[0])throw pe[1];return{value:pe[0]?pe[1]:void 0,done:!0}}([J,me])}}}function K(){for(var M=0,V=0,$=arguments.length;V<$;V++)M+=arguments[V].length;var W=Array(M),te=0;for(V=0;V<$;V++)for(var F=arguments[V],ue=0,se=F.length;ue<se;ue++,te++)W[te]=F[ue];return W}},function(j,m){function o(g,z,I,A,X,K,M){try{var V=g[K](M),$=V.value}catch(W){return void I(W)}V.done?z($):Promise.resolve($).then(A,X)}j.exports=function(g){return function(){var z=this,I=arguments;return new Promise(function(A,X){var K=g.apply(z,I);function M($){o(K,A,X,M,V,"next",$)}function V($){o(K,A,X,M,V,"throw",$)}M(void 0)})}},j.exports.__esModule=!0,j.exports.default=j.exports},function(j,m){function o(g){return j.exports=o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(z){return typeof z}:function(z){return z&&typeof Symbol=="function"&&z.constructor===Symbol&&z!==Symbol.prototype?"symbol":typeof z},j.exports.__esModule=!0,j.exports.default=j.exports,o(g)}j.exports=o,j.exports.__esModule=!0,j.exports.default=j.exports},function(j,m,o){var g=o(16),z=o(24),I=o(42),A=o(38),X=o(56),K=function(M,V,$){var W,te,F,ue,se=M&K.F,J=M&K.G,me=M&K.S,pe=M&K.P,Oe=M&K.B,Fe=J?g:me?g[V]||(g[V]={}):(g[V]||{}).prototype,Le=J?z:z[V]||(z[V]={}),Ae=Le.prototype||(Le.prototype={});for(W in J&&($=V),$)F=((te=!se&&Fe&&Fe[W]!==void 0)?Fe:$)[W],ue=Oe&&te?X(F,g):pe&&typeof F=="function"?X(Function.call,F):F,Fe&&A(Fe,W,F,M&K.U),Le[W]!=F&&I(Le,W,ue),pe&&Ae[W]!=F&&(Ae[W]=F)};g.core=z,K.F=1,K.G=2,K.S=4,K.P=8,K.B=16,K.W=32,K.U=64,K.R=128,j.exports=K},function(j,m){function o(g,z){for(var I=0;I<z.length;I++){var A=z[I];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(g,A.key,A)}}j.exports=function(g,z,I){return z&&o(g.prototype,z),I&&o(g,I),Object.defineProperty(g,"prototype",{writable:!1}),g},j.exports.__esModule=!0,j.exports.default=j.exports},function(j,m){j.exports=function(o,g){if(!(o instanceof g))throw new TypeError("Cannot call a class as a function")},j.exports.__esModule=!0,j.exports.default=j.exports},function(j,m,o){o.d(m,"a",function(){return ft}),o.d(m,"b",function(){return Mt}),o.d(m,"c",function(){return Xt}),o.d(m,"d",function(){return tn}),o.d(m,"e",function(){return en}),o.d(m,"f",function(){return Ce}),o.d(m,"g",function(){return Le}),o.d(m,"h",function(){return Fe}),o.d(m,"i",function(){return Wt}),o.d(m,"j",function(){return Ut}),o.d(m,"k",function(){return Ae}),o.d(m,"l",function(){return Oe}),o.d(m,"m",function(){return Pt}),o.d(m,"n",function(){return Ui}),o.d(m,"o",function(){return lr}),o.d(m,"p",function(){return nn}),o.d(m,"q",function(){return jn}),o.d(m,"r",function(){return Br}),o.d(m,"s",function(){return Ct}),o.d(m,"t",function(){return fn}),o.d(m,"u",function(){return qr}),o.d(m,"v",function(){return an}),o.d(m,"w",function(){return Fr}),o.d(m,"x",function(){return wi}),o.d(m,"y",function(){return $e}),o.d(m,"z",function(){return et}),o.d(m,"A",function(){return Rt});var g=o(1),z=o(72),I=o(40),A=o(71),X=o(39),K=o(70),M=o(135),V=o(184),$=o(183),W=o(69),te=o(182),F=o(68),ue=o(134),se=o(181),J=o(180),me=o(108),pe=o(45);const Oe="year",Fe="quarter",Le="month",Ae="week",ft="date",Mt="day",Xt="dayofyear",tn="hours",Ce="minutes",Wt="seconds",en="milliseconds",Ut=[Oe,Fe,Le,Ae,ft,Mt,Xt,tn,Ce,Wt,en],Qe=Ut.reduce((Ot,$r,$t)=>(Ot[$r]=1+$t,Ot),{});function fn(Ot){const $r=Object(g.i)(Ot).slice(),$t={};return $r.length||Object(g.o)("Missing time unit."),$r.forEach(xe=>{Object(g.w)(Qe,xe)?$t[xe]=1:Object(g.o)("Invalid time unit: ".concat(xe,"."))}),($t[Ae]||$t[Mt]?1:0)+($t[Fe]||$t[Le]||$t[ft]?1:0)+($t[Xt]?1:0)>1&&Object(g.o)("Incompatible time units: ".concat(Ot)),$r.sort((xe,ge)=>Qe[xe]-Qe[ge]),$r}const on={[Oe]:"%Y ",[Fe]:"Q%q ",[Le]:"%b ",[ft]:"%d ",[Ae]:"W%U ",[Mt]:"%a ",[Xt]:"%j ",[tn]:"%H:00",[Ce]:"00:%M",[Wt]:":%S",[en]:".%L",["".concat(Oe,"-").concat(Le)]:"%Y-%m ",["".concat(Oe,"-").concat(Le,"-").concat(ft)]:"%Y-%m-%d ",["".concat(tn,"-").concat(Ce)]:"%H:%M"};function Ct(Ot,$r){const $t=Object(g.p)({},on,$r),xe=fn(Ot),ge=xe.length;let ke,Ne,ot="",xt=0;for(xt=0;xt<ge;)for(ke=xe.length;ke>xt;--ke)if($t[Ne=xe.slice(xt,ke).join("-")]!=null){ot+=$t[Ne],xt=ke;break}return ot.trim()}const Vt=new Date;function En(Ot){return Vt.setFullYear(Ot),Vt.setMonth(0),Vt.setDate(1),Vt.setHours(0,0,0,0),Vt}function Pt(Ot){return Tn(new Date(Ot))}function Rt(Ot){return Hn(new Date(Ot))}function Tn(Ot){return z.a.count(En(Ot.getFullYear())-1,Ot)}function Hn(Ot){return I.b.count(En(Ot.getFullYear())-1,Ot)}function tr(Ot){return En(Ot).getDay()}function pn(Ot,$r,$t,xe,ge,ke,Ne){if(0<=Ot&&Ot<100){const ot=new Date(-1,$r,$t,xe,ge,ke,Ne);return ot.setFullYear(Ot),ot}return new Date(Ot,$r,$t,xe,ge,ke,Ne)}function $e(Ot){return Ke(new Date(Ot))}function et(Ot){return yt(new Date(Ot))}function Ke(Ot){const $r=Date.UTC(Ot.getUTCFullYear(),0,1);return A.a.count($r-1,Ot)}function yt(Ot){const $r=Date.UTC(Ot.getUTCFullYear(),0,1);return X.b.count($r-1,Ot)}function Dt(Ot){return Vt.setTime(Date.UTC(Ot,0,1)),Vt.getUTCDay()}function Lt(Ot,$r,$t,xe,ge,ke,Ne){if(0<=Ot&&Ot<100){const ot=new Date(Date.UTC(-1,$r,$t,xe,ge,ke,Ne));return ot.setUTCFullYear($t.y),ot}return new Date(Date.UTC(Ot,$r,$t,xe,ge,ke,Ne))}function zn(Ot,$r,$t,xe,ge){const ke=$r||1,Ne=Object(g.W)(Ot),ot=(bn,Yt,He)=>function($n,ur,pr,kr){const ui=pr<=1?$n:kr?(Ir,ji)=>kr+pr*Math.floor(($n(Ir,ji)-kr)/pr):(Ir,ji)=>pr*Math.floor($n(Ir,ji)/pr);return ur?(Ir,ji)=>ur(ui(Ir,ji),ji):ui}($t[He=He||bn],xe[He],bn===Ne&&ke,Yt),xt=new Date,Ht=Object(g.Fa)(Ot),yn=Ht[Oe]?ot(Oe):Object(g.m)(2012),dr=Ht[Le]?ot(Le):Ht[Fe]?ot(Fe):g.Ma,_n=Ht[Ae]&&Ht[Mt]?ot(Mt,1,Ae+Mt):Ht[Ae]?ot(Ae,1):Ht[Mt]?ot(Mt,1):Ht[ft]?ot(ft,1):Ht[Xt]?ot(Xt,1):g.Q,In=Ht[tn]?ot(tn):g.Ma,Gn=Ht[Ce]?ot(Ce):g.Ma,Nt=Ht[Wt]?ot(Wt):g.Ma,Ft=Ht[en]?ot(en):g.Ma;return function(bn){xt.setTime(+bn);const Yt=yn(xt);return ge(Yt,dr(xt),_n(xt,Yt),In(xt),Gn(xt),Nt(xt),Ft(xt))}}function Cn(Ot,$r,$t){return $r+7*Ot-($t+6)%7}const ar={[Oe]:Ot=>Ot.getFullYear(),[Fe]:Ot=>Math.floor(Ot.getMonth()/3),[Le]:Ot=>Ot.getMonth(),[ft]:Ot=>Ot.getDate(),[tn]:Ot=>Ot.getHours(),[Ce]:Ot=>Ot.getMinutes(),[Wt]:Ot=>Ot.getSeconds(),[en]:Ot=>Ot.getMilliseconds(),[Xt]:Ot=>Tn(Ot),[Ae]:Ot=>Hn(Ot),[Ae+Mt]:(Ot,$r)=>Cn(Hn(Ot),Ot.getDay(),tr($r)),[Mt]:(Ot,$r)=>Cn(1,Ot.getDay(),tr($r))},we={[Fe]:Ot=>3*Ot,[Ae]:(Ot,$r)=>Cn(Ot,0,tr($r))};function lr(Ot,$r){return zn(Ot,$r||1,ar,we,pn)}const Rr={[Oe]:Ot=>Ot.getUTCFullYear(),[Fe]:Ot=>Math.floor(Ot.getUTCMonth()/3),[Le]:Ot=>Ot.getUTCMonth(),[ft]:Ot=>Ot.getUTCDate(),[tn]:Ot=>Ot.getUTCHours(),[Ce]:Ot=>Ot.getUTCMinutes(),[Wt]:Ot=>Ot.getUTCSeconds(),[en]:Ot=>Ot.getUTCMilliseconds(),[Xt]:Ot=>Ke(Ot),[Ae]:Ot=>yt(Ot),[Mt]:(Ot,$r)=>Cn(1,Ot.getUTCDay(),Dt($r)),[Ae+Mt]:(Ot,$r)=>Cn(yt(Ot),Ot.getUTCDay(),Dt($r))},Tr={[Fe]:Ot=>3*Ot,[Ae]:(Ot,$r)=>Cn(Ot,0,Dt($r))};function qr(Ot,$r){return zn(Ot,$r||1,Rr,Tr,Lt)}const Gr={[Oe]:K.a,[Fe]:M.a.every(3),[Le]:M.a,[Ae]:I.b,[ft]:z.a,[Mt]:z.a,[Xt]:z.a,[tn]:V.a,[Ce]:$.a,[Wt]:W.a,[en]:te.a},hn={[Oe]:F.a,[Fe]:ue.a.every(3),[Le]:ue.a,[Ae]:X.b,[ft]:A.a,[Mt]:A.a,[Xt]:A.a,[tn]:se.a,[Ce]:J.a,[Wt]:W.a,[en]:te.a};function nn(Ot){return Gr[Ot]}function an(Ot){return hn[Ot]}function or(Ot,$r,$t){return Ot?Ot.offset($r,$t):void 0}function jn(Ot,$r,$t){return or(nn(Ot),$r,$t)}function Fr(Ot,$r,$t){return or(an(Ot),$r,$t)}function Pr(Ot,$r,$t,xe){return Ot?Ot.range($r,$t,xe):void 0}function Br(Ot,$r,$t,xe){return Pr(nn(Ot),$r,$t,xe)}function wi(Ot,$r,$t,xe){return Pr(an(Ot),$r,$t,xe)}const Ai=31536e6,Jn=[Oe,Le,ft,tn,Ce,Wt,en],di=Jn.slice(0,-1),ri=di.slice(0,-1),Dr=ri.slice(0,-1),ki=Dr.slice(0,-1),Ei=[Oe,Le],mo=[Oe],Gi=[[di,1,1e3],[di,5,5e3],[di,15,15e3],[di,30,3e4],[ri,1,6e4],[ri,5,3e5],[ri,15,9e5],[ri,30,18e5],[Dr,1,36e5],[Dr,3,108e5],[Dr,6,216e5],[Dr,12,432e5],[ki,1,864e5],[[Oe,Ae],1,6048e5],[Ei,1,2592e6],[Ei,3,7776e6],[mo,1,Ai]];function Ui(Ot){const $r=Ot.extent,$t=Ot.maxbins||40,xe=Math.abs(Object(g.Z)($r))/$t;let ge,ke,Ne=Object(me.a)(ot=>ot[2]).right(Gi,xe);return Ne===Gi.length?(ge=mo,ke=Object(pe.c)($r[0]/Ai,$r[1]/Ai,$t)):Ne?(ge=(Ne=Gi[xe/Gi[Ne-1][2]<Gi[Ne][2]/xe?Ne-1:Ne])[0],ke=Ne[1]):(ge=Jn,ke=Math.max(Object(pe.c)($r[0],$r[1],$t),1)),{units:ge,step:ke}}},function(j,m,o){o.d(m,"e",function(){return g}),o.d(m,"c",function(){return z}),o.d(m,"b",function(){return I}),o.d(m,"a",function(){return A}),o.d(m,"f",function(){return X}),o.d(m,"d",function(){return K}),o.d(m,"g",function(){return M});const g=1e3,z=60*g,I=60*z,A=24*I,X=7*A,K=30*A,M=365*A},function(j,m){j.exports=function(o){return typeof o=="object"?o!==null:typeof o=="function"}},function(j,m,o){var g=o(13);j.exports=function(z){if(!g(z))throw TypeError(z+" is not an object!");return z}},function(j,m){j.exports=function(o){try{return!!o()}catch{return!0}}},function(j,m){var o=j.exports=typeof window!="undefined"&&window.Math==Math?window:typeof self!="undefined"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=o)},function(j,m,o){j.exports=o(280)},function(j,m){j.exports=function(o,g,z){return g in o?Object.defineProperty(o,g,{value:z,enumerable:!0,configurable:!0,writable:!0}):o[g]=z,o},j.exports.__esModule=!0,j.exports.default=j.exports},function(j,m,o){var g=o(129)("wks"),z=o(84),I=o(16).Symbol,A=typeof I=="function";(j.exports=function(X){return g[X]||(g[X]=A&&I[X]||(A?I:z)("Symbol."+X))}).store=g},function(j,m,o){o.r(m),function(g){o.d(m,"GraphModel",function(){return Ot}),o.d(m,"loadGraphModel",function(){return $r}),o.d(m,"deregisterOp",function(){return te}),o.d(m,"registerOp",function(){return $}),o.d(m,"version_converter",function(){return $t});var z,I,A=o(0),X=function(){return(X=Object.assign||function(xe){for(var ge,ke=1,Ne=arguments.length;ke<Ne;ke++)for(var ot in ge=arguments[ke])Object.prototype.hasOwnProperty.call(ge,ot)&&(xe[ot]=ge[ot]);return xe}).apply(this,arguments)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K(xe,ge,ke,Ne){return new(ke||(ke=Promise))(function(ot,xt){function Ht(_n){try{dr(Ne.next(_n))}catch(In){xt(In)}}function yn(_n){try{dr(Ne.throw(_n))}catch(In){xt(In)}}function dr(_n){_n.done?ot(_n.value):new ke(function(In){In(_n.value)}).then(Ht,yn)}dr((Ne=Ne.apply(xe,ge||[])).next())})}function M(xe,ge){var ke,Ne,ot,xt,Ht={label:0,sent:function(){if(1&ot[0])throw ot[1];return ot[1]},trys:[],ops:[]};return xt={next:yn(0),throw:yn(1),return:yn(2)},typeof Symbol=="function"&&(xt[Symbol.iterator]=function(){return this}),xt;function yn(dr){return function(_n){return function(In){if(ke)throw new TypeError("Generator is already executing.");for(;Ht;)try{if(ke=1,Ne&&(ot=2&In[0]?Ne.return:In[0]?Ne.throw||((ot=Ne.return)&&ot.call(Ne),0):Ne.next)&&!(ot=ot.call(Ne,In[1])).done)return ot;switch(Ne=0,ot&&(In=[2&In[0],ot.value]),In[0]){case 0:case 1:ot=In;break;case 4:return Ht.label++,{value:In[1],done:!1};case 5:Ht.label++,Ne=In[1],In=[0];continue;case 7:In=Ht.ops.pop(),Ht.trys.pop();continue;default:if(!(ot=(ot=Ht.trys).length>0&&ot[ot.length-1])&&(In[0]===6||In[0]===2)){Ht=0;continue}if(In[0]===3&&(!ot||In[1]>ot[0]&&In[1]<ot[3])){Ht.label=In[1];break}if(In[0]===6&&Ht.label<ot[1]){Ht.label=ot[1],ot=In;break}if(ot&&Ht.label<ot[2]){Ht.label=ot[2],Ht.ops.push(In);break}ot[2]&&Ht.ops.pop(),Ht.trys.pop();continue}In=ge.call(xe,Ht)}catch(Gn){In=[6,Gn],Ne=0}finally{ke=ot=0}if(5&In[0])throw In[1];return{value:In[0]?In[1]:void 0,done:!0}}([dr,_n])}}}(function(xe){xe[xe.DT_INVALID=0]="DT_INVALID",xe[xe.DT_FLOAT=1]="DT_FLOAT",xe[xe.DT_DOUBLE=2]="DT_DOUBLE",xe[xe.DT_INT32=3]="DT_INT32",xe[xe.DT_UINT8=4]="DT_UINT8",xe[xe.DT_INT16=5]="DT_INT16",xe[xe.DT_INT8=6]="DT_INT8",xe[xe.DT_STRING=7]="DT_STRING",xe[xe.DT_COMPLEX64=8]="DT_COMPLEX64",xe[xe.DT_INT64=9]="DT_INT64",xe[xe.DT_BOOL=10]="DT_BOOL",xe[xe.DT_QINT8=11]="DT_QINT8",xe[xe.DT_QUINT8=12]="DT_QUINT8",xe[xe.DT_QINT32=13]="DT_QINT32",xe[xe.DT_BFLOAT16=14]="DT_BFLOAT16",xe[xe.DT_FLOAT_REF=101]="DT_FLOAT_REF",xe[xe.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",xe[xe.DT_INT32_REF=103]="DT_INT32_REF",xe[xe.DT_UINT8_REF=104]="DT_UINT8_REF",xe[xe.DT_INT16_REF=105]="DT_INT16_REF",xe[xe.DT_INT8_REF=106]="DT_INT8_REF",xe[xe.DT_STRING_REF=107]="DT_STRING_REF",xe[xe.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",xe[xe.DT_INT64_REF=109]="DT_INT64_REF",xe[xe.DT_BOOL_REF=110]="DT_BOOL_REF",xe[xe.DT_QINT8_REF=111]="DT_QINT8_REF",xe[xe.DT_QUINT8_REF=112]="DT_QUINT8_REF",xe[xe.DT_QINT32_REF=113]="DT_QINT32_REF",xe[xe.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"})(z||(z={})),function(xe){(function(ge){ge[ge.LEGACY=0]="LEGACY",ge[ge.V1=1]="V1",ge[ge.V2=2]="V2"})(xe.CheckpointFormatVersion||(xe.CheckpointFormatVersion={}))}(I||(I={}));var V={};function $(xe,ge){var ke={tfOpName:xe,category:"custom",inputs:[],attrs:[],customExecutor:ge};V[xe]=ke}function W(xe){return V[xe]}function te(xe){delete V[xe]}function F(xe,ge,ke,Ne){var ot=ge.inputParams[xe];if(ot&&ot.inputIndexStart!==void 0){var xt=ot.inputIndexStart,Ht=ot.inputIndexEnd===0?void 0:ot.inputIndexEnd===void 0?xt+1:ot.inputIndexEnd;if(ot.type==="tensor")return ue(ge.inputNames[ot.inputIndexStart],ke,Ne);if(ot.type==="tensors")return ge.inputNames.slice(xt,Ht).map(function(_n){return ue(_n,ke,Ne)});var yn=Array.prototype.slice.call(ue(ge.inputNames.slice(xt)[0],ke,Ne).dataSync());return ot.type==="number"?yn[0]:yn}var dr=ge.attrParams[xe];return dr&&dr.value}function ue(xe,ge,ke){var Ne=me(xe),ot=Ne[0],xt=Ne[1],Ht=ke.currentContextIds.find(function(yn){return!!ge[J(ot,yn)]});return Ht!==void 0?ge[J(ot,Ht)][xt]:void 0}function se(xe,ge){var ke=me(xe),Ne=ke[0],ot=ke[1];return[J(Ne,ge&&ge.currentContextId),ot]}function J(xe,ge){return ge?xe+"-"+ge:xe}function me(xe){var ge=xe.lastIndexOf(":");return ge===-1?[xe,0]:[xe.substring(0,ge),Number(xe.substring(ge+1))]}function pe(xe,ge){for(var ke=[],Ne=0;Ne<xe.length;Ne+=ge)ke.push(xe.slice(Ne,Ne+ge));return ke}var Oe=Object.freeze({json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Fe=Object.freeze({json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Le=Object.freeze({json:[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"}]}]}),Ae=Object.freeze({json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]}]}),ft=Object.freeze({json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]}),Mt=Object.freeze({json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Xt=Object.freeze({json:[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]}]}),tn=Object.freeze({json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]}),Ce=Object.freeze({json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}]}),Wt=Object.freeze({json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),en=Object.freeze({json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Ut=Object.freeze({json:[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]}),Qe=Object.freeze({json:[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]}]}),fn=Object.freeze({json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]}),on=Object.freeze({json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]}),Ct=Object.freeze({json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]}]}),Vt=function(){function xe(){var ge=[Oe,Fe,Le,Ae,ft,Mt,Xt,Wt,Ce,tn,en,Ut,Qe,fn,on,Ct],ke=[].concat.apply([],ge.map(function(Ne){return Ne.json}));this.opMappers=ke.reduce(function(Ne,ot){return Ne[ot.tfOpName]=ot,Ne},{})}return Object.defineProperty(xe,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),xe.prototype.transformGraph=function(ge,ke){var Ne=this;ke===void 0&&(ke={});var ot=[],xt=[],Ht=ge.node.reduce(function(Nt,Ft){return Nt[Ft.name]=Ne.mapNode(Ft),Ft.op.startsWith("Placeholder")&&ot.push(Nt[Ft.name]),Ft.op==="Const"&&xt.push(Nt[Ft.name]),Nt},{}),yn=[],dr=[],_n={},In={};ke!=null&&(_n=this.mapSignatureEntries(ke.inputs),In=this.mapSignatureEntries(ke.outputs));var Gn=Object.keys(Ht);return Gn.forEach(function(Nt){var Ft=Ht[Nt];Ft.inputNames.forEach(function(bn){var Yt=se(bn)[0];Ft.inputs.push(Ht[Yt]),Ht[Yt].children.push(Ft)})}),Object.keys(In).length===0?Gn.forEach(function(Nt){var Ft=Ht[Nt];Ft.children.length===0&&dr.push(Ft)}):Object.keys(In).forEach(function(Nt){var Ft=se(Nt)[0],bn=Ht[Ft];bn!=null&&(bn.signatureKey=In[Nt],dr.push(bn))}),Object.keys(_n).length>0?Object.keys(_n).forEach(function(Nt){var Ft=se(Nt)[0],bn=Ht[Ft];bn&&(bn.signatureKey=_n[Nt],yn.push(bn))}):yn=ot,{nodes:Ht,inputs:yn,outputs:dr,weights:xt,placeholders:ot,signature:ke}},xe.prototype.mapSignatureEntries=function(ge){return Object.keys(ge||{}).reduce(function(ke,Ne){return ke[ge[Ne].name]=Ne,ke},{})},xe.prototype.mapNode=function(ge){var ke=W(ge.op)||this.opMappers[ge.op]||{};ge.attr==null&&(ge.attr={});var Ne={name:ge.name,op:ge.op,category:ke.category,inputNames:(ge.input||[]).map(function(ot){return ot.startsWith("^")?ot.substr(1):ot}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:ge.attr};return ke.inputs!=null&&(Ne.inputParams=ke.inputs.reduce(function(ot,xt){return ot[xt.name]={type:xt.type,inputIndexStart:xt.start,inputIndexEnd:xt.end},ot},{})),ke.attrs!=null&&(Ne.attrParams=ke.attrs.reduce(function(ot,xt){var Ht=xt.type,yn=void 0;switch(xt.type){case"string":(yn=Pt(ge.attr,xt.tfName,xt.defaultValue))===void 0&&xt.tfDeprecatedName&&(yn=Pt(ge.attr,xt.tfDeprecatedName,xt.defaultValue));break;case"string[]":(yn=yt(ge.attr,xt.tfName,xt.defaultValue))===void 0&&xt.tfDeprecatedName&&(yn=yt(ge.attr,xt.tfDeprecatedName,xt.defaultValue));break;case"number":(yn=Tn(ge.attr,xt.tfName,xt.defaultValue||0))===void 0&&xt.tfDeprecatedName&&(yn=Tn(ge.attr,xt.tfDeprecatedName,xt.defaultValue));break;case"number[]":(yn=Ke(ge.attr,xt.tfName,xt.defaultValue))===void 0&&xt.tfDeprecatedName&&(yn=Ke(ge.attr,xt.tfDeprecatedName,xt.defaultValue));break;case"bool":(yn=Rt(ge.attr,xt.tfName,xt.defaultValue))===void 0&&xt.tfDeprecatedName&&(yn=Rt(ge.attr,xt.tfDeprecatedName,xt.defaultValue));break;case"bool[]":(yn=Lt(ge.attr,xt.tfName,xt.defaultValue))===void 0&&xt.tfDeprecatedName&&(yn=Lt(ge.attr,xt.tfDeprecatedName,xt.defaultValue));break;case"shape":(yn=et(ge.attr,xt.tfName,xt.defaultValue))===void 0&&xt.tfDeprecatedName&&(yn=et(ge.attr,xt.tfDeprecatedName,xt.defaultValue));break;case"shape[]":(yn=Dt(ge.attr,xt.tfName,xt.defaultValue))===void 0&&xt.tfDeprecatedName&&(yn=Dt(ge.attr,xt.tfDeprecatedName,xt.defaultValue));break;case"dtype":(yn=tr(ge.attr,xt.tfName,xt.defaultValue))===void 0&&xt.tfDeprecatedName&&(yn=tr(ge.attr,xt.tfDeprecatedName,xt.defaultValue));break;case"dtype[]":(yn=pn(ge.attr,xt.tfName,xt.defaultValue))===void 0&&xt.tfDeprecatedName&&(yn=pn(ge.attr,xt.tfDeprecatedName,xt.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+xt.type+" for op: "+ge.op)}return ot[xt.name]={value:yn,type:Ht},ot},{})),Ne},xe}();function En(xe,ge){var ke=Array.isArray(xe)?String.fromCharCode.apply(null,xe):function(Ne){var ot=Object(A.env)().global;if(ot.atob!==void 0)return ot.atob(Ne);if(g!==void 0)return new g(Ne,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(xe);return ge?ke:ke.toLowerCase()}function Pt(xe,ge,ke,Ne){Ne===void 0&&(Ne=!1);var ot=xe[ge];return ot!=null?En(ot.s,Ne):ke}function Rt(xe,ge,ke){var Ne=xe[ge];return Ne?Ne.b:ke}function Tn(xe,ge,ke){var Ne=xe[ge]||{},ot=Ne.i!=null?Ne.i:Ne.f!=null?Ne.f:ke;return typeof ot=="number"?ot:parseInt(ot,10)}function Hn(xe){switch(typeof xe=="string"&&(xe=z[xe]),xe){case z.DT_FLOAT:return"float32";case z.DT_INT32:case z.DT_INT64:case z.DT_INT8:case z.DT_UINT8:return"int32";case z.DT_BOOL:return"bool";case z.DT_DOUBLE:return"float32";case z.DT_STRING:return"string";default:return null}}function tr(xe,ge,ke){var Ne=xe[ge];return Ne&&Ne.type?Hn(Ne.type):ke}function pn(xe,ge,ke){var Ne=xe[ge];return Ne&&Ne.list&&Ne.list.type?Ne.list.type.map(function(ot){return Hn(ot)}):ke}function $e(xe){if(!xe.unknownRank)return xe.dim!=null?xe.dim.map(function(ge){return typeof ge.size=="number"?ge.size:parseInt(ge.size,10)}):[]}function et(xe,ge,ke){var Ne=xe[ge];return Ne&&Ne.shape?$e(Ne.shape):ke}function Ke(xe,ge,ke){var Ne=xe[ge];return Ne?((Ne.list.f&&Ne.list.f.length?Ne.list.f:Ne.list.i)||[]).map(function(ot){return typeof ot=="number"?ot:parseInt(ot,10)}):ke}function yt(xe,ge,ke,Ne){Ne===void 0&&(Ne=!1);var ot=xe[ge];return ot&&ot.list&&ot.list.s?ot.list.s.map(function(xt){return En(xt,Ne)}):ke}function Dt(xe,ge,ke){var Ne=xe[ge];return Ne&&Ne.list&&Ne.list.shape?Ne.list.shape.map(function(ot){return $e(ot)}):ke}function Lt(xe,ge,ke){var Ne=xe[ge];return Ne&&Ne.list&&Ne.list.b?Ne.list.b:ke}var zn=function(){function xe(ge,ke,Ne){var ot=this;this.node=ge,this.tensorMap=ke,this.context=Ne,this.inputs=[],this.attrs={},this.inputs=ge.inputNames.map(function(xt){return ot.getInput(xt)}),ge.rawAttrs!=null&&(this.attrs=Object.keys(ge.rawAttrs).reduce(function(xt,Ht){return xt[Ht]=ot.getAttr(Ht),xt},{}))}return xe.prototype.getInput=function(ge){return ue(ge,this.tensorMap,this.context)},xe.prototype.getAttr=function(ge,ke){var Ne=this.node.rawAttrs[ge];if(Ne.tensor!=null)return ue(ge,this.tensorMap,this.context);if(Ne.i!=null||Ne.f!=null)return Tn(this.node.rawAttrs,ge,ke);if(Ne.s!=null)return Pt(this.node.rawAttrs,ge,ke);if(Ne.b!=null)return Rt(this.node.rawAttrs,ge,ke);if(Ne.shape!=null)return et(this.node.rawAttrs,ge,ke);if(Ne.type!=null)return tr(this.node.rawAttrs,ge,ke);if(Ne.list!=null){if(Ne.list.i!=null||Ne.list.f!=null)return Ke(this.node.rawAttrs,ge,ke);if(Ne.list.s!=null)return yt(this.node.rawAttrs,ge,ke);if(Ne.list.shape!=null)return Dt(this.node.rawAttrs,ge,ke);if(Ne.list.b!=null)return Lt(this.node.rawAttrs,ge,ke);if(Ne.list.type!=null)return pn(this.node.rawAttrs,ge,ke)}return ke},xe}(),Cn=function(xe,ge,ke){switch(xe.op){case"BiasAdd":case"AddV2":case"Add":return[Object(A.add)(F("a",xe,ge,ke),F("b",xe,ge,ke))];case"AddN":return[Object(A.addN)(F("tensors",xe,ge,ke))];case"FloorMod":case"Mod":return[Object(A.mod)(F("a",xe,ge,ke),F("b",xe,ge,ke))];case"Mul":return[Object(A.mul)(F("a",xe,ge,ke),F("b",xe,ge,ke))];case"RealDiv":case"Div":return[Object(A.div)(F("a",xe,ge,ke),F("b",xe,ge,ke))];case"DivNoNan":return[Object(A.divNoNan)(F("a",xe,ge,ke),F("b",xe,ge,ke))];case"FloorDiv":return[Object(A.floorDiv)(F("a",xe,ge,ke),F("b",xe,ge,ke))];case"Sub":return[Object(A.sub)(F("a",xe,ge,ke),F("b",xe,ge,ke))];case"Minimum":return[Object(A.minimum)(F("a",xe,ge,ke),F("b",xe,ge,ke))];case"Maximum":return[Object(A.maximum)(F("a",xe,ge,ke),F("b",xe,ge,ke))];case"Pow":return[Object(A.pow)(F("a",xe,ge,ke),F("b",xe,ge,ke))];case"SquaredDifference":return[Object(A.squaredDifference)(F("a",xe,ge,ke),F("b",xe,ge,ke))];default:throw TypeError("Node type "+xe.op+" is not implemented")}},ar=function(xe,ge,ke){switch(xe.op){case"Abs":case"ComplexAbs":return[Object(A.abs)(F("x",xe,ge,ke))];case"Acos":return[Object(A.acos)(F("x",xe,ge,ke))];case"Acosh":return[Object(A.acosh)(F("x",xe,ge,ke))];case"Asin":return[Object(A.asin)(F("x",xe,ge,ke))];case"Asinh":return[Object(A.asinh)(F("x",xe,ge,ke))];case"Atan":return[Object(A.atan)(F("x",xe,ge,ke))];case"Atan2":return[Object(A.atan2)(F("x",xe,ge,ke),F("y",xe,ge,ke))];case"Atanh":return[Object(A.atanh)(F("x",xe,ge,ke))];case"Ceil":return[Object(A.ceil)(F("x",xe,ge,ke))];case"Complex":return[Object(A.complex)(F("real",xe,ge,ke),F("imag",xe,ge,ke))];case"Cos":return[Object(A.cos)(F("x",xe,ge,ke))];case"Cosh":return[Object(A.cosh)(F("x",xe,ge,ke))];case"Elu":return[Object(A.elu)(F("x",xe,ge,ke))];case"Erf":return[Object(A.erf)(F("x",xe,ge,ke))];case"Exp":return[Object(A.exp)(F("x",xe,ge,ke))];case"Expm1":return[Object(A.expm1)(F("x",xe,ge,ke))];case"Floor":return[Object(A.floor)(F("x",xe,ge,ke))];case"Log":return[Object(A.log)(F("x",xe,ge,ke))];case"Log1p":return[Object(A.log1p)(F("x",xe,ge,ke))];case"Imag":return[Object(A.imag)(F("x",xe,ge,ke))];case"Neg":return[Object(A.neg)(F("x",xe,ge,ke))];case"Reciprocal":return[Object(A.reciprocal)(F("x",xe,ge,ke))];case"Real":return[Object(A.real)(F("x",xe,ge,ke))];case"Relu":return[Object(A.relu)(F("x",xe,ge,ke))];case"Round":return[Object(A.round)(F("x",xe,ge,ke))];case"Selu":return[Object(A.selu)(F("x",xe,ge,ke))];case"Sigmoid":return[Object(A.sigmoid)(F("x",xe,ge,ke))];case"Sin":return[Object(A.sin)(F("x",xe,ge,ke))];case"Sign":return[Object(A.sign)(F("x",xe,ge,ke))];case"Sinh":return[Object(A.sinh)(F("x",xe,ge,ke))];case"Softplus":return[Object(A.softplus)(F("x",xe,ge,ke))];case"Sqrt":return[Object(A.sqrt)(F("x",xe,ge,ke))];case"Square":return[Object(A.square)(F("x",xe,ge,ke))];case"Tanh":return[Object(A.tanh)(F("x",xe,ge,ke))];case"Tan":return[Object(A.tan)(F("x",xe,ge,ke))];case"Relu6":case"ClipByValue":return[Object(A.clipByValue)(F("x",xe,ge,ke),F("clipValueMin",xe,ge,ke),F("clipValueMax",xe,ge,ke))];case"Rsqrt":return[Object(A.rsqrt)(ue(xe.inputNames[0],ge,ke))];case"Prod":return[Object(A.prod)(F("x",xe,ge,ke),F("axes",xe,ge,ke))];case"LeakyRelu":return[Object(A.leakyRelu)(F("x",xe,ge,ke),F("alpha",xe,ge,ke))];case"Prelu":return[Object(A.prelu)(F("x",xe,ge,ke),F("alpha",xe,ge,ke))];default:throw TypeError("Node type "+xe.op+" is not implemented")}},we=function(){function xe(ge,ke,Ne,ot,xt,Ht,yn){this.name=ge,this.dtype=ke,this.maxSize=Ne,this.elementShape=ot,this.identicalElementShapes=xt,this.dynamicSize=Ht,this.clearAfterRead=yn,this.tensors=[],this.closed_=!1,this.id=xe.nextId++}return Object.defineProperty(xe.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),xe.prototype.clearAndClose=function(){this.tensors.forEach(function(ge){return ge.tensor.dispose()}),this.tensors=[],this.closed_=!0},xe.prototype.size=function(){return this.tensors.length},xe.prototype.read=function(ge){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(ge<0||ge>=this.tensors.length)throw new Error("Tried to read from index "+ge+", but array size is: "+this.tensors.length);var ke=this.tensors[ge];if(ke.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+ge+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(ke.cleared=!0),ke.read=!0,ke.tensor},xe.prototype.readMany=function(ge){var ke=this;return ge.map(function(Ne){return ke.read(Ne)})},xe.prototype.write=function(ge,ke){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(ge<0||!this.dynamicSize&&ge>=this.maxSize)throw new Error("Tried to write to index "+ge+", but array is not resizeable and size is: "+this.maxSize);var Ne=this.tensors[ge]||{};if(ke.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+ge+`,
          because the value dtype is `+ke.dtype+", but TensorArray dtype is "+this.dtype+".");if(this.size()!==0||this.elementShape!=null&&this.elementShape.length!==0||(this.elementShape=ke.shape),this.assertShapesMatchAllowUndefinedSize(this.elementShape,ke.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+ge+"."),Ne&&Ne.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+ge+", because it has already been read.");if(Ne&&Ne.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+ge+", because it has already been written.");Ne.tensor=ke,Ne.written=!0,this.tensors[ge]=Ne},xe.prototype.writeMany=function(ge,ke){var Ne=this;if(ge.length!==ke.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,because the index size: "+ge.length+" is not the same as tensors size: "+ke.length+".");ge.forEach(function(ot,xt){return Ne.write(ot,ke[xt])})},xe.prototype.gather=function(ge,ke){if(ke&&ke!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+ke);if(!ge){ge=[];for(var Ne=0;Ne<this.size();Ne++)ge.push(Ne)}if(ge.length===0)return Object(A.tensor)([],[0].concat(this.elementShape));var ot=this.readMany(ge);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,ot[0].shape,"TensorArray shape mismatch: "),Object(A.stack)(ot,0)},xe.prototype.concat=function(ge){if(ge&&ge!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+ge);if(this.size()===0)return Object(A.tensor)([],[0].concat(this.elementShape));for(var ke=[],Ne=0;Ne<this.size();Ne++)ke.push(Ne);var ot=this.readMany(ke);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,ot[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+ot[0].shape+")"),Object(A.concat)(ot,0)},xe.prototype.scatter=function(ge,ke){if(ke.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+ke.dtype);if(ge.length!==ke.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+ge.length+" vs. "+ke.shape[0]);var Ne=Math.max.apply(Math,ge);if(!this.dynamicSize&&Ne>=this.maxSize)throw new Error("Max index must be < array size ("+Ne+"  vs. "+this.maxSize+")");this.writeMany(ge,Object(A.unstack)(ke,0))},xe.prototype.split=function(ge,ke){var Ne=this;if(ke.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+ke.dtype);var ot=0,xt=ge.map(function(In){return ot+=In});if(ot!==ke.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `+ot+", and tensor's shape is: "+ke.shape);if(!this.dynamicSize&&ge.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+ge.length+"), and the TensorArray is not marked as dynamically resizeable");var Ht=ot===0?0:ke.size/ot,yn=[];Object(A.tidy)(function(){ke=ke.reshape([1,ot,Ht]);for(var In=0;In<ge.length;++In){var Gn=[0,In===0?0:xt[In-1],0],Nt=[1,ge[In],Ht];yn[In]=Object(A.slice)(ke,Gn,Nt).reshape(Ne.elementShape)}return yn});for(var dr=[],_n=0;_n<ge.length;_n++)dr[_n]=_n;this.writeMany(dr,yn)},xe.prototype.assertShapesMatchAllowUndefinedSize=function(ge,ke,Ne){Ne===void 0&&(Ne=""),A.util.assert(this.shapesEqualAllowUndefinedSize(ge,ke),function(){return Ne+" Shapes "+ge+" and "+ke+" must match"})},xe.prototype.shapesEqualAllowUndefinedSize=function(ge,ke){if(ge.length!==ke.length)return!1;for(var Ne=0;Ne<ge.length;Ne++)if(ge[Ne]!==-1&&ke[Ne]!==-1&&ge[Ne]!==ke[Ne])return!1;return!0},xe.nextId=0,xe}(),lr=function(xe,ge,ke){return K(void 0,void 0,void 0,function(){var Ne,ot,xt,Ht,yn,dr,_n,In,Gn,Nt,Ft,bn,Yt,He,$n,ur,pr,kr,ui,Ir,ji,Do,Bi,no,$i,mi,ai,qn,Di,ko,Zr,Wo,Oo,So,To;return M(this,function(ds){switch(ds.label){case 0:switch(xe.op){case"LoopCond":return[3,1];case"Switch":return[3,2];case"Merge":return[3,4];case"Enter":return[3,5];case"Exit":return[3,6];case"NextIteration":return[3,7];case"TensorArrayV3":return[3,8];case"TensorArrayWriteV3":return[3,9];case"TensorArrayReadV3":return[3,10];case"TensorArrayGatherV3":return[3,11];case"TensorArrayScatterV3":return[3,12];case"TensorArrayConcatV3":return[3,13];case"TensorArraySplitV3":return[3,14];case"TensorArraySizeV3":return[3,15];case"TensorArrayCloseV3":return[3,16]}return[3,17];case 1:return[2,[F("pred",xe,ge,ke).clone()]];case 2:return Ne=F("pred",xe,ge,ke),ot=F("data",xe,ge,ke),[4,Ne.data()];case 3:return[2,ds.sent()[0]?[void 0,ot.clone()]:[ot.clone(),void 0]];case 4:return[2,(xt=xe.inputNames.find(function(As){return ue(As,ge,ke)!==void 0}))?[ue(xt,ge,ke).clone()]:void 0];case 5:return Ht=F("frameName",xe,ge,ke),yn=F("tensor",xe,ge,ke),ke.enterFrame(Ht),[2,[yn.clone()]];case 6:return dr=F("tensor",xe,ge,ke),ke.exitFrame(),[2,[dr.clone()]];case 7:return _n=F("tensor",xe,ge,ke),ke.nextIteration(),[2,[_n.clone()]];case 8:return In=F("size",xe,ge,ke),Gn=F("dtype",xe,ge,ke),Nt=F("elementShape",xe,ge,ke),Ft=F("dynamicSize",xe,ge,ke),bn=F("clearAfterRead",xe,ge,ke),Yt=F("identicalElementShapes",xe,ge,ke),He=F("name",xe,ge,ke),$n=new we(He,Gn,In,Nt,Yt,Ft,bn),ke.addTensorArray($n),[2,[Object(A.scalar)($n.id),Object(A.scalar)(1)]];case 9:return ur=F("tensorArrayId",xe,ge,ke),pr=F("index",xe,ge,ke),kr=F("tensor",xe,ge,ke),ke.getTensorArray(ur).write(pr,kr),[2,[Object(A.scalar)(1)]];case 10:return ui=F("tensorArrayId",xe,ge,ke),Ir=F("index",xe,ge,ke),[2,[ke.getTensorArray(ui).read(Ir)]];case 11:return ji=F("tensorArrayId",xe,ge,ke),Do=F("indices",xe,ge,ke),Bi=F("dtype",xe,ge,ke),[2,[ke.getTensorArray(ji).gather(Do,Bi)]];case 12:return no=F("tensorArrayId",xe,ge,ke),$i=F("indices",xe,ge,ke),mi=F("tensor",xe,ge,ke),ke.getTensorArray(no).scatter($i,mi),[2,[Object(A.scalar)(1)]];case 13:return ai=F("tensorArrayId",xe,ge,ke),qn=ke.getTensorArray(ai),Di=F("dtype",xe,ge,ke),[2,[qn.concat(Di)]];case 14:return ko=F("tensorArrayId",xe,ge,ke),Zr=F("tensor",xe,ge,ke),Wo=F("lengths",xe,ge,ke),ke.getTensorArray(ko).split(Wo,Zr),[2,[Object(A.scalar)(1)]];case 15:return Oo=F("tensorArrayId",xe,ge,ke),So=ke.getTensorArray(Oo),[2,[Object(A.scalar)(So.size(),"int32")]];case 16:return To=F("tensorArrayId",xe,ge,ke),ke.getTensorArray(To).clearAndClose(),[2,[Object(A.scalar)(0)]];case 17:throw TypeError("Node type "+xe.op+" is not implemented")}})})},Rr=function(xe,ge,ke){switch(xe.op){case"Conv1D":var Ne=F("stride",xe,ge,ke),ot=F("pad",xe,ge,ke),xt=F("dataFormat",xe,ge,ke).toUpperCase(),Ht=F("dilation",xe,ge,ke);return[Object(A.conv1d)(F("x",xe,ge,ke),F("filter",xe,ge,ke),Ne,ot,xt,Ht)];case"Conv2D":Ne=F("strides",xe,ge,ke),ot=F("pad",xe,ge,ke),xt=F("dataFormat",xe,ge,ke).toUpperCase();var yn=F("dilations",xe,ge,ke);return[Object(A.conv2d)(F("x",xe,ge,ke),F("filter",xe,ge,ke),[Ne[1],Ne[2]],ot,xt,[yn[1],yn[2]])];case"_FusedConv2D":case"FusedDepthwiseConv2dNative":var dr=F("fusedOps",xe,ge,ke),_n=dr[0],In=dr[1],Gn=_n==="biasadd",Nt=In==="prelu",Ft=_n==="fusedbatchnorm",bn=F("numArgs",xe,ge,ke);if(Gn){if(Nt&&bn!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!Nt&&bn!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(Ft)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");Ne=F("strides",xe,ge,ke),ot=F("pad",xe,ge,ke),xt=F("dataFormat",xe,ge,ke).toUpperCase(),yn=F("dilations",xe,ge,ke);var Yt=F("args",xe,ge,ke),He=Yt[0],$n=Yt[1];return[(xe.op==="_FusedConv2D"?A.fused.conv2d:A.fused.depthwiseConv2d)({x:F("x",xe,ge,ke),filter:F("filter",xe,ge,ke),strides:[Ne[1],Ne[2]],pad:ot,dataFormat:xt,dilations:[yn[1],yn[2]],bias:He,activation:In,preluActivationWeights:$n})];case"Conv2DBackpropInput":case"Conv2dTranspose":var ur=F("outputShape",xe,ge,ke);return Ne=F("strides",xe,ge,ke),ot=F("pad",xe,ge,ke),[Object(A.conv2dTranspose)(F("x",xe,ge,ke),F("filter",xe,ge,ke),ur,[Ne[1],Ne[2]],ot)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":return Ne=F("strides",xe,ge,ke),ot=F("pad",xe,ge,ke),yn=F("dilations",xe,ge,ke),xt=F("dataFormat",xe,ge,ke).toUpperCase(),[Object(A.depthwiseConv2d)(F("input",xe,ge,ke),F("filter",xe,ge,ke),[Ne[1],Ne[2]],ot,xt,[yn[1],yn[2]])];case"Conv3D":return Ne=F("strides",xe,ge,ke),ot=F("pad",xe,ge,ke),xt=F("dataFormat",xe,ge,ke).toUpperCase(),yn=F("dilations",xe,ge,ke),[Object(A.conv3d)(F("x",xe,ge,ke),F("filter",xe,ge,ke),[Ne[1],Ne[2],Ne[3]],ot,xt,[yn[1],yn[2],yn[3]])];case"AvgPool":Ne=F("strides",xe,ge,ke),ot=F("pad",xe,ge,ke);var pr=F("kernelSize",xe,ge,ke);return[Object(A.avgPool)(F("x",xe,ge,ke),[pr[1],pr[2]],[Ne[1],Ne[2]],ot)];case"MaxPool":return Ne=F("strides",xe,ge,ke),ot=F("pad",xe,ge,ke),pr=F("kernelSize",xe,ge,ke),[Object(A.maxPool)(F("x",xe,ge,ke),[pr[1],pr[2]],[Ne[1],Ne[2]],ot)];case"MaxPoolWithArgmax":Ne=F("strides",xe,ge,ke),ot=F("pad",xe,ge,ke),pr=F("kernelSize",xe,ge,ke);var kr=F("includeBatchInIndex",xe,ge,ke),ui=Object(A.maxPoolWithArgmax)(F("x",xe,ge,ke),[pr[1],pr[2]],[Ne[1],Ne[2]],ot,kr);return[ui.result,ui.indexes];case"AvgPool3D":return Ne=F("strides",xe,ge,ke),ot=F("pad",xe,ge,ke),pr=F("kernelSize",xe,ge,ke),[Object(A.avgPool3d)(F("x",xe,ge,ke),[pr[1],pr[2],pr[3]],[Ne[1],Ne[2],Ne[3]],ot)];case"MaxPool3D":return Ne=F("strides",xe,ge,ke),ot=F("pad",xe,ge,ke),pr=F("kernelSize",xe,ge,ke),[Object(A.maxPool3d)(F("x",xe,ge,ke),[pr[1],pr[2],pr[3]],[Ne[1],Ne[2],Ne[3]],ot)];default:throw TypeError("Node type "+xe.op+" is not implemented")}},Tr=function(xe,ge,ke){switch(xe.op){case"Fill":var Ne=F("shape",xe,ge,ke),ot=F("dtype",xe,ge,ke),xt=F("value",xe,ge,ke);return[Object(A.fill)(Ne,xt,ot)];case"LinSpace":var Ht=F("start",xe,ge,ke),yn=F("stop",xe,ge,ke),dr=F("num",xe,ge,ke);return[Object(A.linspace)(Ht,yn,dr)];case"Multinomial":var _n=F("logits",xe,ge,ke),In=F("numSamples",xe,ge,ke),Gn=F("seed",xe,ge,ke);return[Object(A.multinomial)(_n,In,Gn)];case"OneHot":var Nt=F("indices",xe,ge,ke),Ft=F("depth",xe,ge,ke),bn=F("onValue",xe,ge,ke),Yt=F("offValue",xe,ge,ke);return[Object(A.oneHot)(Nt,Ft,bn,Yt)];case"Ones":return[Object(A.ones)(F("shape",xe,ge,ke),F("dtype",xe,ge,ke))];case"OnesLike":return[Object(A.onesLike)(F("x",xe,ge,ke))];case"RandomUniform":return[Object(A.randomUniform)(F("shape",xe,ge,ke),F("minval",xe,ge,ke),F("maxval",xe,ge,ke),F("dtype",xe,ge,ke))];case"Range":Ht=F("start",xe,ge,ke);var He=F("stop",xe,ge,ke),$n=F("step",xe,ge,ke);return[Object(A.range)(Ht,He,$n,F("dtype",xe,ge,ke))];case"TruncatedNormal":Ne=F("shape",xe,ge,ke);var ur=F("mean",xe,ge,ke),pr=F("stdDev",xe,ge,ke);return Gn=F("seed",xe,ge,ke),[Object(A.truncatedNormal)(Ne,ur,pr,F("dtype",xe,ge,ke),Gn)];case"Zeros":return[Object(A.zeros)(F("shape",xe,ge,ke),F("dtype",xe,ge,ke))];case"ZerosLike":return[Object(A.zerosLike)(F("x",xe,ge,ke))];default:throw TypeError("Node type "+xe.op+" is not implemented")}},qr=function(xe,ge,ke){return K(void 0,void 0,void 0,function(){var Ne,ot,xt,Ht,yn,dr,_n,In;return M(this,function(Gn){switch(Gn.label){case 0:switch(xe.op){case"NonMaxSuppressionV5":case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":return[3,1];case"Where":return[3,5];case"ListDiff":return[3,7]}return[3,8];case 1:return Ne=F("boxes",xe,ge,ke),ot=F("scores",xe,ge,ke),xt=F("maxOutputSize",xe,ge,ke),Ht=F("iouThreshold",xe,ge,ke),yn=F("scoreThreshold",xe,ge,ke),xe.op!=="NonMaxSuppressionV5"?[3,3]:(dr=F("softNmsSigma",xe,ge,ke),[4,A.image.nonMaxSuppressionWithScoreAsync(Ne,ot,xt,Ht,yn,dr)]);case 2:return[2,[(In=Gn.sent()).selectedIndices,In.selectedScores]];case 3:return[4,A.image.nonMaxSuppressionAsync(Ne,ot,xt,Ht,yn)];case 4:return[2,[Gn.sent()]];case 5:return _n=F("condition",xe,ge,ke).asType("bool"),[4,Object(A.whereAsync)(_n)];case 6:return In=[Gn.sent()],_n.dispose(),[2,In];case 7:return[2,Object(A.setdiff1dAsync)(F("x",xe,ge,ke),F("y",xe,ge,ke))];case 8:throw TypeError("Node type "+xe.op+" is not implemented")}})})},Gr=function(xe,ge,ke){switch(xe.op){case"TopKV2":var Ne=F("x",xe,ge,ke),ot=F("k",xe,ge,ke),xt=F("sorted",xe,ge,ke),Ht=Object(A.topk)(Ne,ot,xt);return[Ht.values,Ht.indices];default:throw TypeError("Node type "+xe.op+" is not implemented")}},hn=function(xe,ge,ke){switch(xe.op){case"Const":return ge[xe.name];case"PlaceholderWithDefault":var Ne=F("default",xe,ge,ke);return[ue(xe.name,ge,ke)||Ne];case"Placeholder":return[ue(xe.name,ge,ke)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[F("x",xe,ge,ke).clone()];case"IdentityN":return F("x",xe,ge,ke).map(function(_n){return _n.clone()});case"Snapshot":return[F("x",xe,ge,ke).clone()];case"Shape":return[Object(A.tensor1d)(F("x",xe,ge,ke).shape,"int32")];case"ShapeN":return F("x",xe,ge,ke).map(function(_n){return Object(A.tensor1d)(_n.shape)});case"Size":return[Object(A.scalar)(F("x",xe,ge,ke).size,"int32")];case"Rank":return[Object(A.scalar)(F("x",xe,ge,ke).rank,"int32")];case"NoOp":return[Object(A.scalar)(1)];case"Print":var ot=F("x",xe,ge,ke),xt=F("data",xe,ge,ke),Ht=F("message",xe,ge,ke),yn=F("summarize",xe,ge,ke);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(Ht);for(var dr=0;dr<xt.length;dr++)console.log(Array.prototype.slice.call(xt[dr].dataSync()).slice(0,yn));return[ot];default:throw TypeError("Node type "+xe.op+" is not implemented")}},nn=function(xe,ge,ke){switch(xe.op){case"ResizeBilinear":var Ne=F("images",xe,ge,ke),ot=F("size",xe,ge,ke),xt=F("alignCorners",xe,ge,ke);return[A.image.resizeBilinear(Ne,[ot[0],ot[1]],xt)];case"ResizeNearestNeighbor":return Ne=F("images",xe,ge,ke),ot=F("size",xe,ge,ke),xt=F("alignCorners",xe,ge,ke),[A.image.resizeNearestNeighbor(Ne,[ot[0],ot[1]],xt)];case"CropAndResize":var Ht=F("image",xe,ge,ke),yn=F("boxes",xe,ge,ke),dr=F("boxInd",xe,ge,ke),_n=F("cropSize",xe,ge,ke),In=F("method",xe,ge,ke),Gn=F("extrapolationValue",xe,ge,ke);return[A.image.cropAndResize(Ht,yn,dr,_n,In,Gn)];default:throw TypeError("Node type "+xe.op+" is not implemented")}},an=function(xe,ge,ke){switch(xe.op){case"Equal":return[Object(A.equal)(F("a",xe,ge,ke),F("b",xe,ge,ke))];case"NotEqual":return[Object(A.notEqual)(F("a",xe,ge,ke),F("b",xe,ge,ke))];case"Greater":return[Object(A.greater)(F("a",xe,ge,ke),F("b",xe,ge,ke))];case"GreaterEqual":return[Object(A.greaterEqual)(F("a",xe,ge,ke),F("b",xe,ge,ke))];case"Less":return[Object(A.less)(F("a",xe,ge,ke),F("b",xe,ge,ke))];case"LessEqual":return[Object(A.lessEqual)(F("a",xe,ge,ke),F("b",xe,ge,ke))];case"LogicalAnd":return[Object(A.logicalAnd)(F("a",xe,ge,ke),F("b",xe,ge,ke))];case"LogicalNot":return[Object(A.logicalNot)(F("a",xe,ge,ke))];case"LogicalOr":return[Object(A.logicalOr)(F("a",xe,ge,ke),F("b",xe,ge,ke))];case"Select":case"SelectV2":return[Object(A.where)(F("condition",xe,ge,ke),F("a",xe,ge,ke),F("b",xe,ge,ke))];default:throw TypeError("Node type "+xe.op+" is not implemented")}},or=function(xe,ge,ke){switch(xe.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[Object(A.matMul)(F("a",xe,ge,ke),F("b",xe,ge,ke),F("transposeA",xe,ge,ke),F("transposeB",xe,ge,ke))];case"Transpose":return[Object(A.transpose)(F("x",xe,ge,ke),F("perm",xe,ge,ke))];case"_FusedMatMul":var Ne=F("fusedOps",xe,ge,ke),ot=Ne[0],xt=Ne[1],Ht=ot==="biasadd",yn=xt==="prelu",dr=F("numArgs",xe,ge,ke);if(Ht){if(yn&&dr!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!yn&&dr!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var _n=F("args",xe,ge,ke),In=_n[0],Gn=_n[1];return[A.fused.matMul({a:F("a",xe,ge,ke),b:F("b",xe,ge,ke),transposeA:F("transposeA",xe,ge,ke),transposeB:F("transposeB",xe,ge,ke),bias:In,activation:xt,preluActivationWeights:Gn})];default:throw TypeError("Node type "+xe.op+" is not implemented")}},jn=function(xe,ge,ke){switch(xe.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[Object(A.batchNorm)(F("x",xe,ge,ke),F("mean",xe,ge,ke),F("variance",xe,ge,ke),F("offset",xe,ge,ke),F("scale",xe,ge,ke),F("epsilon",xe,ge,ke))];case"LRN":return[Object(A.localResponseNormalization)(F("x",xe,ge,ke),F("radius",xe,ge,ke),F("bias",xe,ge,ke),F("alpha",xe,ge,ke),F("beta",xe,ge,ke))];case"Softmax":return[Object(A.softmax)(F("x",xe,ge,ke))];case"LogSoftmax":return[Object(A.logSoftmax)(F("x",xe,ge,ke))];case"SparseToDense":return[Object(A.sparseToDense)(F("sparseIndices",xe,ge,ke),F("outputShape",xe,ge,ke),F("sparseValues",xe,ge,ke),F("defaultValue",xe,ge,ke))];default:throw TypeError("Node type "+xe.op+" is not implemented")}},Fr=function(xe,ge,ke){switch(xe.op){case"Max":var Ne=F("axis",xe,ge,ke),ot=F("keepDims",xe,ge,ke);return[Object(A.max)(F("x",xe,ge,ke),Ne,ot)];case"Mean":return Ne=F("axis",xe,ge,ke),ot=F("keepDims",xe,ge,ke),[Object(A.mean)(F("x",xe,ge,ke),Ne,ot)];case"Min":return Ne=F("axis",xe,ge,ke),ot=F("keepDims",xe,ge,ke),[Object(A.min)(F("x",xe,ge,ke),Ne,ot)];case"Sum":return Ne=F("axis",xe,ge,ke),ot=F("keepDims",xe,ge,ke),[Object(A.sum)(F("x",xe,ge,ke),Ne,ot)];case"All":return Ne=F("axis",xe,ge,ke),ot=F("keepDims",xe,ge,ke),[Object(A.all)(F("x",xe,ge,ke),Ne,ot)];case"Any":return Ne=F("axis",xe,ge,ke),ot=F("keepDims",xe,ge,ke),[Object(A.any)(F("x",xe,ge,ke),Ne,ot)];case"ArgMax":return Ne=F("axis",xe,ge,ke),[Object(A.argMax)(F("x",xe,ge,ke),Ne)];case"ArgMin":return Ne=F("axis",xe,ge,ke),[Object(A.argMin)(F("x",xe,ge,ke),Ne)];case"Prod":return Ne=F("axis",xe,ge,ke),ot=F("keepDims",xe,ge,ke),[Object(A.prod)(F("x",xe,ge,ke),Ne,ot)];default:throw TypeError("Node type "+xe.op+" is not implemented")}},Pr=function(xe,ge,ke){switch(xe.op){case"ConcatV2":case"Concat":var Ne=F("n",xe,ge,ke),ot=F("axis",xe,ge,ke),xt=F("tensors",xe,ge,ke);return xt=xt.slice(0,Ne),[Object(A.concat)(xt,ot)];case"GatherV2":case"Gather":ot=F("axis",xe,ge,ke);var Ht=F("x",xe,ge,ke),yn=F("indices",xe,ge,ke);return[Object(A.gather)(Ht,yn.asType("int32"),ot)];case"ReverseV2":case"Reverse":return ot=F("axis",xe,ge,ke),Ht=F("x",xe,ge,ke),[Object(A.reverse)(Ht,ot)];case"Slice":var dr=F("begin",xe,ge,ke),_n=F("size",xe,ge,ke);return[Object(A.slice)(F("x",xe,ge,ke),dr,_n)];case"StridedSlice":dr=F("begin",xe,ge,ke);var In=F("end",xe,ge,ke),Gn=F("strides",xe,ge,ke),Nt=F("beginMask",xe,ge,ke),Ft=F("endMask",xe,ge,ke),bn=F("ellipsisMask",xe,ge,ke),Yt=F("newAxisMask",xe,ge,ke),He=F("shrinkAxisMask",xe,ge,ke),$n=F("x",xe,ge,ke);if(dr.length===1&&$n.shape.length>1)for(var ur=1;ur<$n.shape.length;ur++)dr.push(0),In.push($n.shape[ur]),Gn.push(Gn[0]);return[Object(A.stridedSlice)($n,dr,In,Gn,Nt,Ft,bn,Yt,He)];case"Pack":return Object(A.tidy)(function(){var no=F("axis",xe,ge,ke),$i=F("tensors",xe,ge,ke),mi=$i[0].shape,ai=$i[0].squeeze().shape,qn=$i.map(function(Di){var ko=A.util.arraysEqual(Di.shape,mi);if(!ko&&!A.util.arraysEqual(Di.squeeze().shape,ai))throw new Error("the input tensors shape does not match");return ko?Di:Di.reshape(mi)});return[Object(A.stack)(qn,no)]});case"Unpack":return Object(A.tidy)(function(){var no=F("axis",xe,ge,ke),$i=F("tensor",xe,ge,ke);return Object(A.unstack)($i,no)});case"Tile":var pr=F("reps",xe,ge,ke);return[Object(A.tile)(F("x",xe,ge,ke),pr)];case"Split":case"SplitV":ot=F("axis",xe,ge,ke);var kr=F("numOrSizeSplits",xe,ge,ke);return Object(A.split)(F("x",xe,ge,ke),kr,ot);case"ScatterNd":yn=F("indices",xe,ge,ke);var ui=F("values",xe,ge,ke),Ir=F("shape",xe,ge,ke);return[Object(A.scatterND)(yn,ui,Ir)];case"GatherNd":var ji=F("x",xe,ge,ke);return yn=F("indices",xe,ge,ke),[Object(A.gatherND)(ji,yn)];case"SparseToDense":yn=F("sparseIndices",xe,ge,ke),Ir=F("outputShape",xe,ge,ke);var Do=F("sparseValues",xe,ge,ke),Bi=F("defaultValue",xe,ge,ke);return[Object(A.sparseToDense)(yn,Do,Ir,Do.dtype===Bi.dtype?Bi:Bi.asType(Do.dtype))];default:throw TypeError("Node type "+xe.op+" is not implemented")}},Br=function(xe,ge,ke){switch(xe.op){case"FFT":return[Object(A.fft)(F("x",xe,ge,ke))];case"IFFT":return[Object(A.ifft)(F("x",xe,ge,ke))];case"RFFT":return[Object(A.rfft)(F("x",xe,ge,ke))];case"IRFFT":return[Object(A.irfft)(F("x",xe,ge,ke))];default:throw TypeError("Node type "+xe.op+" is not implemented")}},wi=function(xe,ge,ke){switch(xe.op){case"Cast":return[Object(A.cast)(F("x",xe,ge,ke),F("dtype",xe,ge,ke))];case"ExpandDims":var Ne=F("axis",xe,ge,ke);return[Object(A.expandDims)(F("x",xe,ge,ke),Ne)];case"Squeeze":return Ne=F("axis",xe,ge,ke),[Object(A.squeeze)(F("x",xe,ge,ke),Ne)];case"Reshape":return[Object(A.reshape)(F("x",xe,ge,ke),F("shape",xe,ge,ke))];case"PadV2":case"Pad":return[Object(A.pad)(F("x",xe,ge,ke),pe(F("padding",xe,ge,ke),2),F("constantValue",xe,ge,ke))];case"SpaceToBatchND":var ot=F("blockShape",xe,ge,ke),xt=pe(F("paddings",xe,ge,ke),2);return[Object(A.spaceToBatchND)(F("x",xe,ge,ke),ot,xt)];case"BatchToSpaceND":ot=F("blockShape",xe,ge,ke);var Ht=pe(F("crops",xe,ge,ke),2);return[Object(A.batchToSpaceND)(F("x",xe,ge,ke),ot,Ht)];case"DepthToSpace":var yn=F("blockSize",xe,ge,ke),dr=F("dataFormat",xe,ge,ke).toUpperCase();return[Object(A.depthToSpace)(F("x",xe,ge,ke),yn,dr)];default:throw TypeError("Node type "+xe.op+" is not implemented")}};function Ai(xe,ge,ke){var Ne=function(ot,xt,Ht){switch(ot.category){case"arithmetic":return Object(A.tidy)(function(){return Cn(ot,xt,Ht)});case"basic_math":return Object(A.tidy)(function(){return ar(ot,xt,Ht)});case"control":return lr(ot,xt,Ht);case"convolution":return Object(A.tidy)(function(){return Rr(ot,xt,Ht)});case"creation":return Object(A.tidy)(function(){return Tr(ot,xt,Ht)});case"dynamic":return qr(ot,xt,Ht);case"evaluation":return Object(A.tidy)(function(){return Gr(ot,xt,Ht)});case"image":return Object(A.tidy)(function(){return nn(ot,xt,Ht)});case"graph":return Object(A.tidy)(function(){return hn(ot,xt,Ht)});case"logical":return Object(A.tidy)(function(){return an(ot,xt,Ht)});case"matrices":return Object(A.tidy)(function(){return or(ot,xt,Ht)});case"normalization":return Object(A.tidy)(function(){return jn(ot,xt,Ht)});case"reduction":return Object(A.tidy)(function(){return Fr(ot,xt,Ht)});case"slice_join":return Object(A.tidy)(function(){return Pr(ot,xt,Ht)});case"spectral":return Object(A.tidy)(function(){return Br(ot,xt,Ht)});case"transformation":return Object(A.tidy)(function(){return wi(ot,xt,Ht)});case"custom":var yn=W(ot.op);if(yn&&yn.customExecutor)return yn.customExecutor(new zn(ot,xt,Ht));throw TypeError("Custom op "+ot.op+" is not registered.");default:throw TypeError("Unknown op '"+ot.op+"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(xe,ge,ke);return Ne instanceof Promise?Ne.then(function(ot){return[].concat(ot)}):[].concat(Ne)}var Jn=function(){function xe(ge,ke){this.weightMap=ge,this.tensorArrayMap=ke,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return xe.prototype.newFrame=function(ge,ke){return{id:ge,frameName:ke,iterationId:0}},Object.defineProperty(xe.prototype,"currentContext",{get:function(){return this.contexts},set:function(ge){this.contexts!==ge&&(this.contexts=ge,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(xe.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(xe.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),xe.prototype.generateCurrentContextIds=function(){for(var ge=[],ke=0;ke<this.contexts.length-1;ke++){var Ne=this.contexts.slice(0,this.contexts.length-ke);ge.push(this.contextIdforContexts(Ne))}ge.push(""),this._currentContextIds=ge},xe.prototype.contextIdforContexts=function(ge){return ge?ge.map(function(ke){return ke.id===0&&ke.iterationId===0?"":ke.frameName+"-"+ke.iterationId}).join("/"):""},xe.prototype.enterFrame=function(ge){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,ge)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},xe.prototype.exitFrame=function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},xe.prototype.nextIteration=function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var ge=Object.assign({},this.contexts[this.contexts.length-1]);ge.iterationId+=1,ge.id=this.lastId,this.contexts.splice(-1,1,ge),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},xe.prototype.getWeight=function(ge){return this.weightMap[ge]},xe.prototype.addTensorArray=function(ge){this.tensorArrayMap[ge.id]=ge},xe.prototype.getTensorArray=function(ge){return this.tensorArrayMap[ge]},xe}();function di(xe,ge,ke){for(var Ne=new Set,ot=[],xt=null,Ht=null,yn=new Set,dr=Object.keys(xe).map(function(Gn){return me(Gn)[0]}),_n=ge.slice();_n.length>0;){var In=_n.pop();(ki(In)||Ei(In))&&xt==null&&(Ht=(xt=In).children.map(function(Gn){return Gn.name}).filter(function(Gn){return Ne.has(Gn)})),Ne.add(In.name),ke[In.name]==null&&dr.indexOf(In.name)===-1&&(In.inputs.length!==0?In.inputs.forEach(function(Gn){yn.has(Gn.name)||(yn.add(Gn.name),_n.push(Gn))}):ot.push(In.name))}return{inputs:xe,outputs:ge,usedNodes:Ne,missingInputs:ot,dynamicNode:xt,syncInputs:Ht}}var ri=["Switch","Merge","Enter","Exit","NextIteration"],Dr=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"];function ki(xe){return ri.indexOf(xe.op)>=0}function Ei(xe){return Dr.indexOf(xe.op)>=0}var mo=function(){function xe(ge){this.graph=ge,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._outputs=ge.outputs,this._inputs=ge.inputs,this._signature=ge.signature}return Object.defineProperty(xe.prototype,"weightMap",{get:function(){return this._weightMap},set:function(ge){var ke=Object.keys(ge).map(function(Ne){return ge[Ne].map(function(ot){return ot.id})});this.weightIds=[].concat.apply([],ke),this._weightMap=ge},enumerable:!0,configurable:!0}),Object.defineProperty(xe.prototype,"inputs",{get:function(){return this._inputs.map(function(ge){return{name:ge.name,shape:ge.attrParams.shape?ge.attrParams.shape.value:void 0,dtype:ge.attrParams.dtype?ge.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(xe.prototype,"outputs",{get:function(){return this._outputs.map(function(ge){return{name:ge.name,shape:ge.attrParams.shape?ge.attrParams.shape.value:void 0,dtype:ge.attrParams.dtype?ge.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(xe.prototype,"inputNodes",{get:function(){return this._inputs.map(function(ge){return ge.signatureKey||ge.name})},enumerable:!0,configurable:!0}),Object.defineProperty(xe.prototype,"outputNodes",{get:function(){return this._outputs.map(function(ge){return ge.signatureKey||ge.name})},enumerable:!0,configurable:!0}),xe.prototype.getCompilationKey=function(ge,ke){var Ne=ge.map(function(xt){return xt.name}).sort(),ot=ke.map(function(xt){return xt.name}).sort();return Ne.join(this.SEPERATOR)+"--"+ot.join(this.SEPERATOR)},xe.prototype.compile=function(ge,ke){var Ne=di(ge,ke,this.weightMap),ot=Ne.missingInputs,xt=Ne.dynamicNode,Ht=Ne.syncInputs;if(xt!=null)throw new Error("This execution contains the node '"+xt.name+"', which has the dynamic op '"+xt.op+"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs ["+Ht+"]");if(ot.length>0){var yn=ke.map(function(_n){return _n.name}),dr=Object.keys(ge);throw new Error("Cannot compute the outputs ["+yn+"] from the provided inputs ["+dr+"]. Missing the following inputs: ["+ot+"]")}return function(_n,In,Gn){var Nt=Gn.usedNodes,Ft=Gn.inputs,bn=[];Object.keys(Ft).map(function(ur){return me(ur)[0]}).map(function(ur){return _n.nodes[ur]}).forEach(function(ur){Nt.has(ur.name)&&bn.push(ur)}),_n.weights.forEach(function(ur){Nt.has(ur.name)&&bn.push(ur)});for(var Yt=new Set,He=[];bn.length>0;){var $n=bn.pop();Yt.add($n.name),In[$n.name]||He.push($n),$n.children.forEach(function(ur){!Yt.has(ur.name)&&Nt.has(ur.name)&&ur.inputs.every(function(pr){return Yt.has(pr.name)})&&bn.push(ur)})}return He}(this.graph,this.weightMap,Ne)},xe.prototype.execute=function(ge,ke){var Ne=this;ge=this.mapInputs(ge);var ot=Object.keys(ge).sort();this.checkInputs(ge),this.checkInputShapeAndType(ge),ke=this.mapOutputs(ke),this.checkOutputs(ke);var xt=ot.map(function(In){return Ne.graph.nodes[me(In)[0]]}),Ht=ke.map(function(In){return Ne.graph.nodes[me(In)[0]]}),yn=this.getCompilationKey(xt,Ht),dr=this.compiledMap.get(yn);dr==null&&(dr=this.compile(ge,Ht),this.compiledMap.set(yn,dr));var _n={};return Object(A.tidy)(function(){var In=new Jn(Ne._weightMap,_n),Gn=X({},Ne.weightMap);Object.keys(ge).forEach(function($n){var ur=me($n),pr=ur[0],kr=[];kr[ur[1]]=ge[$n],Gn[pr]=kr});for(var Nt=Ne.getFrozenTensorIds(Gn),Ft={},bn=0;bn<dr.length;bn++){var Yt=dr[bn];if(!Gn[Yt.name]){var He=Ai(Yt,Gn,In);if(He instanceof Promise)throw new Error("The execution of the op '"+Yt.op+"' returned a promise. Please use model.executeAsync() instead.");Gn[Yt.name]=He,Ne.checkTensorForDisposal(Yt.name,Yt,Gn,In,Nt,ke,Ft)}}return ke.map(function($n){return ue($n,Gn,In)})})},xe.prototype.getFrozenTensorIds=function(ge){var ke=[].concat.apply([],Object.keys(ge).map(function(Ne){return ge[Ne]}).map(function(Ne){return Ne.map(function(ot){return ot.id})}));return new Set(ke)},xe.prototype.checkTensorForDisposal=function(ge,ke,Ne,ot,xt,Ht,yn){ke.category!=="control"&&Ht.indexOf(ge)===-1&&(Ne[ge].forEach(function(dr){dr!=null&&(yn[dr.id]=(yn[dr.id]||0)+ke.children.length)}),ke.inputs.forEach(function(dr){if(dr.category!=="control"){var _n=function(In,Gn,Nt){return Gn[J(In,Nt.currentContextId)]}(dr.name,Ne,ot);_n!=null&&_n.forEach(function(In){if(In&&!xt.has(In.id)){var Gn=yn[In.id];Gn===1?(In.dispose(),delete yn[In.id]):Gn!=null&&yn[In.id]--}})}}))},xe.prototype.executeAsync=function(ge,ke){return K(this,void 0,void 0,function(){var Ne,ot,xt,Ht,yn,dr,_n=this;return M(this,function(In){switch(In.label){case 0:return ge=this.mapInputs(ge),this.checkInputs(ge),this.checkInputShapeAndType(ge),ke=this.mapOutputs(ke),this.checkOutputs(ke),Ne={},ot=new Jn(this._weightMap,Ne),[4,this.executeWithControlFlow(ge,ot,ke)];case 1:return xt=In.sent(),Ht=ke.map(function(Gn){return ue(Gn,xt,ot)}),yn=new Set(Ht.map(function(Gn){return Gn.id})),dr=new Set(Object.keys(ge).map(function(Gn){return ge[Gn].id})),Object.keys(xt).forEach(function(Gn){xt[Gn].forEach(function(Nt){!Nt||Nt.isDisposed||yn.has(Nt.id)||dr.has(Nt.id)||_n.weightIds.indexOf(Nt.id)!==-1||Nt.dispose()})}),[2,Ht]}})})},xe.prototype.executeWithControlFlow=function(ge,ke,Ne){return K(this,void 0,void 0,function(){var ot,xt,Ht,yn,dr,_n,In,Gn,Nt,Ft,bn,Yt,He,$n,ur,pr,kr=this;return M(this,function(ui){switch(ui.label){case 0:ot=Object.keys(ge),xt=ot.map(function(Ir){return kr.graph.nodes[me(Ir)[0]]}),Ht=Ne.map(function(Ir){return kr.graph.nodes[me(Ir)[0]]}),yn=di(ge,Ht,this.weightMap),dr=yn.usedNodes,_n=yn.missingInputs,In=yn.dynamicNode,Gn=yn.syncInputs,Nt=xt.concat(this.graph.weights).map(function(Ir){return{node:Ir,contexts:ke.currentContext}}),Ft=X({},this.weightMap),Object.keys(ge).forEach(function(Ir){var ji=me(Ir),Do=ji[0],Bi=[];Bi[ji[1]]=ge[Ir],Ft[Do]=Bi}),bn={},Yt=this.getFrozenTensorIds(Ft),He={},ui.label=1;case 1:return Nt.length>0?($n=this.processStack(xt,Nt,ke,Ft,He,Yt,Ne,bn,dr),[4,Promise.all($n)]):[3,3];case 2:return ui.sent(),[3,1];case 3:if(In==null&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),(ur=Ht.filter(function(Ir){return!ki(Ir)&&!ue(Ir.name,Ft,ke)}).map(function(Ir){return Ir.name})).length>0)throw pr="",In!=null&&(pr="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs ["+Gn+"]"),new Error("Cannot compute the outputs ["+ur+"] from the provided inputs ["+ot+"]. Consider providing the following inputs: ["+_n+"]. "+pr);return[2,Ft]}})})},xe.prototype.processStack=function(ge,ke,Ne,ot,xt,Ht,yn,dr,_n){for(var In=this,Gn=[],Nt=function(){var bn=ke.pop();Ne.currentContext=bn.contexts;var Yt="";if(bn.node.op==="Enter"&&F("isConstant",bn.node,ot,Ne)&&(Yt=se(bn.node.name,Ne)[0]),ge.indexOf(bn.node)===-1){var He=Ai(bn.node,ot,Ne);Yt||(Yt=se(bn.node.name,Ne)[0]);var $n=Ne.currentContext;He instanceof Promise?Gn.push(He.then(function(ur){return ot[Yt]=ur,Ne.currentContext=$n,In.checkTensorForDisposal(Yt,bn.node,ot,Ne,Ht,yn,dr),In.processChildNodes(bn.node,ke,Ne,ot,xt,_n),ur})):(ot[Yt]=He,Ft.checkTensorForDisposal(Yt,bn.node,ot,Ne,Ht,yn,dr),Ft.processChildNodes(bn.node,ke,Ne,ot,xt,_n))}else Ft.processChildNodes(bn.node,ke,Ne,ot,xt,_n)},Ft=this;ke.length>0;)Nt();return Gn},xe.prototype.processChildNodes=function(ge,ke,Ne,ot,xt,Ht){ge.children.forEach(function(yn){var dr=se(yn.name,Ne)[0];!xt[dr]&&Ht.has(yn.name)&&(yn.op==="Merge"?yn.inputNames.some(function(_n){return!!ue(_n,ot,Ne)})&&(xt[dr]=!0,ke.push({contexts:Ne.currentContext,node:yn})):yn.inputNames.every(function(_n){return!!ue(_n,ot,Ne)})&&(xt[dr]=!0,ke.push({contexts:Ne.currentContext,node:yn})))})},xe.prototype.dispose=function(){var ge=this;Object.keys(this.weightMap).forEach(function(ke){return ge.weightMap[ke].forEach(function(Ne){return Ne.dispose()})})},xe.prototype.checkInputShapeAndType=function(ge){var ke=this;Object.keys(ge).forEach(function(Ne){var ot=ge[Ne],xt=me(Ne)[0],Ht=ke.graph.nodes[xt];if(Ht.attrParams.shape&&Ht.attrParams.shape.value){var yn=Ht.attrParams.shape.value,dr=yn.length===ot.shape.length&&ot.shape.every(function(_n,In){return yn[In]===-1||yn[In]===_n});A.util.assert(dr,function(){return"The shape of dict['"+Ht.name+"'] provided in model.execute(dict) must be ["+yn+"], but was ["+ot.shape+"]"})}Ht.attrParams.dtype&&Ht.attrParams.dtype.value&&A.util.assert(ot.dtype===Ht.attrParams.dtype.value,function(){return"The dtype of dict['"+Ht.name+"'] provided in model.execute(dict) must be "+Ht.attrParams.dtype.value+", but was "+ot.dtype})})},xe.prototype.mapInputs=function(ge){var ke={};for(var Ne in ge)this._signature!=null&&this._signature.inputs!=null&&this._signature.inputs[Ne]!=null?ke[this._signature.inputs[Ne].name]=ge[Ne]:ke[Ne]=ge[Ne];return ke},xe.prototype.checkInputs=function(ge){var ke=this,Ne=Object.keys(ge).filter(function(ot){var xt=me(ot)[0];return ke.graph.nodes[xt]==null});if(Ne.length>0)throw new Error("The dict provided in model.execute(dict) has keys: ["+Ne+"] that are not part of graph")},xe.prototype.mapOutputs=function(ge){var ke=this;return ge.map(function(Ne){return ke._signature!=null&&ke._signature.outputs!=null&&ke._signature.outputs[Ne]!=null?ke._signature.outputs[Ne].name:Ne},{})},xe.prototype.checkOutputs=function(ge){var ke=this;ge.forEach(function(Ne){var ot=me(Ne)[0];if(!ke.graph.nodes[ot])throw new Error("The output '"+Ne+"' is not found in the graph")})},xe}(),Gi="?tfjs-format=file",Ui="model.json",Ot=function(){function xe(ge,ke){ke===void 0&&(ke={}),this.modelUrl=ge,this.loadOptions=ke,this.version="n/a",ke==null&&(this.loadOptions={})}return Object.defineProperty(xe.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(xe.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(xe.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(xe.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(xe.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(xe.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),xe.prototype.findIOHandler=function(){var ge=this.modelUrl;if(ge.load!=null)this.handler=ge;else if(this.loadOptions.requestInit!=null)this.handler=A.io.browserHTTPRequest(ge,this.loadOptions);else{var ke=A.io.getLoadHandlers(ge,this.loadOptions.onProgress);if(ke.length===0)ke.push(A.io.browserHTTPRequest(ge,this.loadOptions));else if(ke.length>1)throw new Error("Found more than one ("+ke.length+") load handlers for URL '"+[ge]+"'");this.handler=ke[0]}},xe.prototype.load=function(){return K(this,void 0,void 0,function(){var ge,ke,Ne,ot;return M(this,function(xt){switch(xt.label){case 0:if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return ge=this,[4,this.handler.load()];case 1:return ge.artifacts=xt.sent(),ke=this.artifacts.modelTopology,Ne={},this.artifacts.userDefinedMetadata!=null&&(Ne=this.artifacts.userDefinedMetadata.signature),this.version=ke.versions.producer+"."+ke.versions.minConsumer,ot=A.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs),this.executor=new mo(Vt.Instance.transformGraph(ke,Ne)),this.executor.weightMap=this.convertTensorMapToTensorsMap(ot),[2,!0]}})})},xe.prototype.save=function(ge,ke){return K(this,void 0,void 0,function(){var Ne;return M(this,function(ot){if(typeof ge=="string"){if((Ne=A.io.getSaveHandlers(ge)).length===0)throw new Error("Cannot find any save handlers for URL '"+ge+"'");if(Ne.length>1)throw new Error("Found more than one ("+Ne.length+") save handlers for URL '"+ge+"'");ge=Ne[0]}if(ge.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[2,ge.save(this.artifacts)]})})},xe.prototype.predict=function(ge,ke){return this.execute(ge,this.outputNodes)},xe.prototype.normalizeInputs=function(ge){if(!(ge instanceof A.Tensor||Array.isArray(ge)))return ge;if((ge=Array.isArray(ge)?ge:[ge]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has "+this.inputNodes.length+" placeholders, while there are "+ge.length+" input tensors.");return this.inputNodes.reduce(function(ke,Ne,ot){return ke[Ne]=ge[ot],ke},{})},xe.prototype.normalizeOutputs=function(ge){return ge=ge||this.outputNodes,Array.isArray(ge)?ge:[ge]},xe.prototype.execute=function(ge,ke){ge=this.normalizeInputs(ge),ke=this.normalizeOutputs(ke);var Ne=this.executor.execute(ge,ke);return Ne.length>1?Ne:Ne[0]},xe.prototype.executeAsync=function(ge,ke){return K(this,void 0,void 0,function(){var Ne;return M(this,function(ot){switch(ot.label){case 0:return ge=this.normalizeInputs(ge),ke=this.normalizeOutputs(ke),[4,this.executor.executeAsync(ge,ke)];case 1:return[2,(Ne=ot.sent()).length>1?Ne:Ne[0]]}})})},xe.prototype.convertTensorMapToTensorsMap=function(ge){return Object.keys(ge).reduce(function(ke,Ne){return ke[Ne]=[ge[Ne]],ke},{})},xe.prototype.dispose=function(){this.executor.dispose()},xe}();function $r(xe,ge){return ge===void 0&&(ge={}),K(this,void 0,void 0,function(){var ke;return M(this,function(Ne){switch(Ne.label){case 0:if(xe==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return ge==null&&(ge={}),ge.fromTFHub&&xe.load==null&&(xe.endsWith("/")||(xe+="/"),xe=""+xe+Ui+Gi),[4,(ke=new Ot(xe,ge)).load()];case 1:return Ne.sent(),[2,ke]}})})}var $t="1.7.4"}.call(this,o(92).Buffer)},function(j,m,o){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(103);function z(se){for(var J=se.length,me=0,pe=0;J>0;)pe=Math.random()*J|0,me=se[--J],se[J]=se[pe],se[pe]=me}function I(se,J){if(!se)throw new Error(typeof J=="string"?J:J())}function A(se,J,me){if(J===void 0&&(J=[]),me===void 0&&(me=!1),J==null&&(J=[]),Array.isArray(se)||$(se)&&!me)for(var pe=0;pe<se.length;++pe)A(se[pe],J,me);else J.push(se);return J}function X(se,J){if(se===J)return!0;if(se==null||J==null||se.length!==J.length)return!1;for(var me=0;me<se.length;me++)if(se[me]!==J[me])return!1;return!0}function K(se){return se%1==0}function M(se,J){var me=J.length;return I((se=se==null?J.map(function(pe,Oe){return Oe}):[].concat(se)).every(function(pe){return pe>=-me&&pe<me}),function(){return"All values in axis param must be in range [-"+me+", "+me+") but got axis "+se}),I(se.every(function(pe){return K(pe)}),function(){return"All values in axis param must be integers but got axis "+se}),se.map(function(pe){return pe<0?me+pe:pe})}function V(se,J){for(var me=0;me<se.length;me++){var pe=se[me];if(isNaN(pe)||!isFinite(pe))throw Error("A tensor of type "+J+" being uploaded contains "+pe+".")}}function $(se){return se instanceof Float32Array||se instanceof Int32Array||se instanceof Uint8Array}function W(se){return typeof se=="string"||se instanceof String}function te(se){return typeof se=="boolean"}function F(se){return typeof se=="number"}function ue(se,J){if(J==null||J==="float32"||J==="complex64")return new Float32Array(se);if(J==="int32")return new Int32Array(se);if(J==="bool")return new Uint8Array(se);throw new Error("Unknown data type "+J)}m.shuffle=z,m.clamp=function(se,J,me){return Math.max(se,Math.min(J,me))},m.nearestLargerEven=function(se){return se%2==0?se:se+1},m.sum=function(se){for(var J=0,me=0;me<se.length;me++)J+=se[me];return J},m.randUniform=function(se,J){var me=Math.random();return J*me+(1-me)*se},m.distSquared=function(se,J){for(var me=0,pe=0;pe<se.length;pe++){var Oe=Number(se[pe])-Number(J[pe]);me+=Oe*Oe}return me},m.assert=I,m.assertShapesMatch=function(se,J,me){me===void 0&&(me=""),I(X(se,J),function(){return me+" Shapes "+se+" and "+J+" must match"})},m.assertNonNull=function(se){I(se!=null,function(){return"The input to the tensor constructor must be a non-null value."})},m.flatten=A,m.sizeFromShape=function(se){if(se.length===0)return 1;for(var J=se[0],me=1;me<se.length;me++)J*=se[me];return J},m.isScalarShape=function(se){return se.length===0},m.arraysEqual=X,m.isInt=K,m.tanh=function(se){if(Math.tanh!=null)return Math.tanh(se);if(se===1/0)return 1;if(se===-1/0)return-1;var J=Math.exp(2*se);return(J-1)/(J+1)},m.sizeToSquarishShape=function(se){var J=Math.ceil(Math.sqrt(se));return[J,Math.ceil(se/J)]},m.createShuffledIndices=function(se){for(var J=new Uint32Array(se),me=0;me<se;++me)J[me]=me;return z(J),J},m.rightPad=function(se,J){return J<=se.length?se:se+" ".repeat(J-se.length)},m.repeatedTry=function(se,J,me){return J===void 0&&(J=function(pe){return 0}),new Promise(function(pe,Oe){var Fe=0,Le=function(){if(se())pe();else{var Ae=J(++Fe);me!=null&&Fe>=me?Oe():setTimeout(Le,Ae)}};Le()})},m.inferFromImplicitShape=function(se,J){for(var me=1,pe=-1,Oe=0;Oe<se.length;++Oe)if(se[Oe]>=0)me*=se[Oe];else if(se[Oe]===-1){if(pe!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+pe+" and dim "+Oe);pe=Oe}else if(se[Oe]<0)throw Error("Shapes can not be < 0. Found "+se[Oe]+" at dim "+Oe);if(pe===-1){if(J>0&&J!==me)throw Error("Size("+J+") must match the product of shape "+se);return se}if(me===0)throw Error("Cannot infer the missing size in ["+se+"] when there are 0 elements");if(J%me!=0)throw Error("The implicit shape can't be a fractional number. Got "+J+" / "+me);var Fe=se.slice();return Fe[pe]=J/me,Fe},m.parseAxisParam=M,m.squeezeShape=function(se,J){for(var me=[],pe=[],Oe=J!=null&&Array.isArray(J)&&J.length===0,Fe=J==null||Oe?null:M(J,se).sort(),Le=0,Ae=0;Ae<se.length;++Ae){if(Fe!=null){if(Fe[Le]===Ae&&se[Ae]!==1)throw new Error("Can't squeeze axis "+Ae+" since its dim '"+se[Ae]+"' is not 1");(Fe[Le]==null||Fe[Le]>Ae)&&se[Ae]===1&&(me.push(se[Ae]),pe.push(Ae)),Fe[Le]<=Ae&&Le++}se[Ae]!==1&&(me.push(se[Ae]),pe.push(Ae))}return{newShape:me,keptDims:pe}},m.getTypedArrayFromDType=function(se,J){var me=null;if(se==null||se==="float32")me=new Float32Array(J);else if(se==="int32")me=new Int32Array(J);else{if(se!=="bool")throw new Error("Unknown data type "+se);me=new Uint8Array(J)}return me},m.getArrayFromDType=function(se,J){var me=null;if(se==null||se==="float32")me=new Float32Array(J);else if(se==="int32")me=new Int32Array(J);else if(se==="bool")me=new Uint8Array(J);else{if(se!=="string")throw new Error("Unknown data type "+se);me=new Array(J)}return me},m.checkConversionForErrors=V,m.isValidDtype=function(se){return se==="bool"||se==="complex64"||se==="float32"||se==="int32"||se==="string"},m.hasEncodingLoss=function(se,J){return!(J==="complex64"||J==="float32"&&se!=="complex64"||J==="int32"&&se!=="float32"&&se!=="complex64"||J==="bool"&&se==="bool")},m.isTypedArray=$,m.bytesPerElement=function(se){if(se==="float32"||se==="int32")return 4;if(se==="complex64")return 8;if(se==="bool")return 1;throw new Error("Unknown dtype "+se)},m.bytesFromStringArray=function(se){if(se==null)return 0;var J=0;return se.forEach(function(me){return J+=me.length}),J},m.isString=W,m.isBoolean=te,m.isNumber=F,m.inferDtype=function se(J){return Array.isArray(J)?se(J[0]):J instanceof Float32Array?"float32":J instanceof Int32Array||J instanceof Uint8Array?"int32":F(J)?"float32":W(J)?"string":te(J)?"bool":"float32"},m.isFunction=function(se){return!!(se&&se.constructor&&se.call&&se.apply)},m.nearestDivisor=function(se,J){for(var me=J;me<se;++me)if(se%me==0)return me;return se},m.computeStrides=function(se){var J=se.length;if(J<2)return[];var me=new Array(J-1);me[J-2]=se[J-1];for(var pe=J-3;pe>=0;--pe)me[pe]=me[pe+1]*se[pe+1];return me},m.toTypedArray=function(se,J,me){if(J==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(se)&&(se=A(se)),me&&V(se,J),function(Fe,Le){return Fe instanceof Float32Array&&Le==="float32"||Fe instanceof Int32Array&&Le==="int32"||Fe instanceof Uint8Array&&Le==="bool"}(se,J))return se;if(J==null||J==="float32"||J==="complex64")return new Float32Array(se);if(J==="int32")return new Int32Array(se);if(J==="bool"){for(var pe=new Uint8Array(se.length),Oe=0;Oe<pe.length;++Oe)Math.round(se[Oe])!==0&&(pe[Oe]=1);return pe}throw new Error("Unknown data type "+J)},m.toNestedArray=function(se,J){if(se.length===0)return J[0];var me=se.reduce(function(pe,Oe){return pe*Oe});if(me===0)return[];if(me!==J.length)throw new Error("["+se+"] does not match the input size.");return function pe(Oe,Fe,Le){var Ae=new Array;if(Fe.length===1)for(var ft=Fe[0],Mt=0;Mt<ft;Mt++)Ae[Mt]=Le[Oe+Mt];else{ft=Fe[0];var Xt=Fe.slice(1),tn=Xt.reduce(function(Ce,Wt){return Ce*Wt});for(Mt=0;Mt<ft;Mt++)Ae[Mt]=pe(Oe+Mt*tn,Xt,Le)}return Ae}(0,se,J)},m.makeOnesTypedArray=function(se,J){for(var me=ue(se,J),pe=0;pe<me.length;pe++)me[pe]=1;return me},m.makeZerosTypedArray=ue,m.now=function(){return g.env().platform.now()},m.assertNonNegativeIntegerDimensions=function(se){se.forEach(function(J){I(Number.isInteger(J)&&J>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+se+"]."})})},m.fetch=function(se,J){return g.env().platform.fetch(se,J)},m.encodeString=function(se,J){return J===void 0&&(J="utf-8"),J=J||"utf-8",g.env().platform.encode(se,J)},m.decodeString=function(se,J){return J===void 0&&(J="utf-8"),J=J||"utf-8",g.env().platform.decode(se,J)},m.locToIndex=function(se,J,me){if(J===0)return 0;if(J===1)return se[0];for(var pe=se[se.length-1],Oe=0;Oe<se.length-1;++Oe)pe+=me[Oe]*se[Oe];return pe},m.indexToLoc=function(se,J,me){if(J===0)return[];if(J===1)return[se];for(var pe=new Array(J),Oe=0;Oe<pe.length-1;++Oe)pe[Oe]=Math.floor(se/me[Oe]),se-=pe[Oe]*me[Oe];return pe[pe.length-1]=se,pe}},function(j,m,o){var g=o(54),z=Math.min;j.exports=function(I){return I>0?z(g(I),9007199254740991):0}},function(j,m,o){var g=o(262),z=o(261),I=o(187),A=o(260);j.exports=function(X,K){return g(X)||z(X,K)||I(X,K)||A()},j.exports.__esModule=!0,j.exports.default=j.exports},function(j,m){var o=j.exports={version:"2.6.12"};typeof __e=="number"&&(__e=o)},function(j,m,o){(function(g,z){/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var I=this&&this.__awaiter||function(me,pe,Oe,Fe){return new(Oe||(Oe=Promise))(function(Le,Ae){function ft(tn){try{Xt(Fe.next(tn))}catch(Ce){Ae(Ce)}}function Mt(tn){try{Xt(Fe.throw(tn))}catch(Ce){Ae(Ce)}}function Xt(tn){tn.done?Le(tn.value):new Oe(function(Ce){Ce(tn.value)}).then(ft,Mt)}Xt((Fe=Fe.apply(me,pe||[])).next())})},A=this&&this.__generator||function(me,pe){var Oe,Fe,Le,Ae,ft={label:0,sent:function(){if(1&Le[0])throw Le[1];return Le[1]},trys:[],ops:[]};return Ae={next:Mt(0),throw:Mt(1),return:Mt(2)},typeof Symbol=="function"&&(Ae[Symbol.iterator]=function(){return this}),Ae;function Mt(Xt){return function(tn){return function(Ce){if(Oe)throw new TypeError("Generator is already executing.");for(;ft;)try{if(Oe=1,Fe&&(Le=2&Ce[0]?Fe.return:Ce[0]?Fe.throw||((Le=Fe.return)&&Le.call(Fe),0):Fe.next)&&!(Le=Le.call(Fe,Ce[1])).done)return Le;switch(Fe=0,Le&&(Ce=[2&Ce[0],Le.value]),Ce[0]){case 0:case 1:Le=Ce;break;case 4:return ft.label++,{value:Ce[1],done:!1};case 5:ft.label++,Fe=Ce[1],Ce=[0];continue;case 7:Ce=ft.ops.pop(),ft.trys.pop();continue;default:if(!(Le=(Le=ft.trys).length>0&&Le[Le.length-1])&&(Ce[0]===6||Ce[0]===2)){ft=0;continue}if(Ce[0]===3&&(!Le||Ce[1]>Le[0]&&Ce[1]<Le[3])){ft.label=Ce[1];break}if(Ce[0]===6&&ft.label<Le[1]){ft.label=Le[1],Le=Ce;break}if(Le&&ft.label<Le[2]){ft.label=Le[2],ft.ops.push(Ce);break}Le[2]&&ft.ops.pop(),ft.trys.pop();continue}Ce=pe.call(me,ft)}catch(Wt){Ce=[6,Wt],Fe=0}finally{Oe=Le=0}if(5&Ce[0])throw Ce[1];return{value:Ce[0]?Ce[1]:void 0,done:!0}}([Xt,tn])}}};Object.defineProperty(m,"__esModule",{value:!0});var X,K=o(103),M=o(382),V=o(381),$=o(380),W=o(33),te=o(74),F=o(21),ue=o(21),se=function(){function me(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return me.prototype.dispose=function(){for(var pe in this.registeredVariables)this.registeredVariables[pe].dispose()},me}(),J=function(){function me(pe){this.ENV=pe,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new se}return me.prototype.ready=function(){return I(this,void 0,void 0,function(){var pe,Oe,Fe;return A(this,function(Le){switch(Le.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];pe=this.getSortedBackends(),Oe=0,Le.label=1;case 1:return Oe<pe.length?(Fe=pe[Oe],[4,this.initializeBackend(Fe).success]):[3,5];case 2:return Le.sent()?[4,this.setBackend(Fe)]:[3,4];case 3:return Le.sent(),[2];case 4:return Oe++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(me.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var pe=this.initializeBackendsAndReturnBest(),Oe=pe.name;if(pe.asyncInit)throw new Error("The highest priority backend '"+Oe+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(Oe)}return this.backendInstance},enumerable:!0,configurable:!0}),me.prototype.backendNames=function(){return Object.keys(this.registryFactory)},me.prototype.findBackend=function(pe){return!(pe in this.registry)&&(!(pe in this.registryFactory)||this.initializeBackend(pe).asyncInit)?null:this.registry[pe]},me.prototype.findBackendFactory=function(pe){return pe in this.registryFactory?this.registryFactory[pe].factory:null},me.prototype.registerBackend=function(pe,Oe,Fe){return Fe===void 0&&(Fe=1),pe in this.registryFactory?(console.warn(pe+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[pe]={factory:Oe,priority:Fe},!0)},me.prototype.setBackend=function(pe){return I(this,void 0,void 0,function(){var Oe,Fe,Le;return A(this,function(Ae){switch(Ae.label){case 0:if(this.registryFactory[pe]==null)throw new Error("Backend name '"+pe+"' not found in registry");return this.backendName=pe,this.registry[pe]!=null?[3,4]:(this.backendInstance=null,Oe=this.initializeBackend(pe),Fe=Oe.success,Oe.asyncInit?[4,Fe]:[3,2]);case 1:return Le=Ae.sent(),[3,3];case 2:Le=Fe,Ae.label=3;case 3:if(!Le)return[2,!1];Ae.label=4;case 4:return this.backendInstance=this.registry[pe],this.setupRegisteredKernels(),this.profiler=new V.Profiler(this.backendInstance),[2,!0]}})})},me.prototype.setupRegisteredKernels=function(){var pe=this;M.getKernelsForBackend(this.backendName).forEach(function(Oe){Oe.setupFunc!=null&&Oe.setupFunc(pe.backendInstance)})},me.prototype.disposeRegisteredKernels=function(pe){var Oe=this;M.getKernelsForBackend(pe).forEach(function(Fe){Fe.disposeFunc!=null&&Fe.disposeFunc(Oe.registry[pe])})},me.prototype.initializeBackend=function(pe){var Oe=this,Fe=this.registryFactory[pe];if(Fe==null)throw new Error("Cannot initialize backend "+pe+", no registration found.");try{var Le=Fe.factory();if(Promise.resolve(Le)===Le){var Ae=++this.pendingBackendInitId,ft=Le.then(function(Mt){return!(Ae<Oe.pendingBackendInitId)&&(Oe.registry[pe]=Mt,Oe.pendingBackendInit=null,!0)}).catch(function(Mt){return!(Ae<Oe.pendingBackendInitId)&&(Oe.pendingBackendInit=null,console.warn("Initialization of backend "+pe+" failed"),console.warn(Mt.stack||Mt.message),!1)});return this.pendingBackendInit=ft,{success:ft,asyncInit:!0}}return this.registry[pe]=Le,{success:!0,asyncInit:!1}}catch(Mt){return console.warn("Initialization of backend "+pe+" failed"),console.warn(Mt.stack||Mt.message),{success:!1,asyncInit:!1}}},me.prototype.removeBackend=function(pe){if(!(pe in this.registryFactory))throw new Error(pe+" backend not found in registry");this.backendName===pe&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,pe in this.registry&&(this.disposeRegisteredKernels(pe),this.registry[pe].dispose(),delete this.registry[pe]),delete this.registryFactory[pe],this.backendName===pe&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},me.prototype.getSortedBackends=function(){var pe=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(Oe,Fe){return pe.registryFactory[Fe].priority-pe.registryFactory[Oe].priority})},me.prototype.initializeBackendsAndReturnBest=function(){for(var pe=this.getSortedBackends(),Oe=0;Oe<pe.length;Oe++){var Fe=pe[Oe],Le=this.initializeBackend(Fe),Ae=Le.success,ft=Le.asyncInit;if(ft||Ae)return{name:Fe,asyncInit:ft}}throw new Error("Could not initialize any backends, all backend initializations failed.")},me.prototype.moveData=function(pe,Oe){var Fe=this.state.tensorInfo.get(Oe),Le=Fe.backend,Ae=this.readSync(Oe);Le.disposeData(Oe),Fe.backend=pe,pe.move(Oe,Ae,Fe.shape,Fe.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},me.prototype.tidy=function(pe,Oe){var Fe,Le=this,Ae=null;if(Oe==null){if(typeof pe!="function")throw new Error("Please provide a function to tidy()");Oe=pe}else{if(typeof pe!="string"&&!(pe instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof Oe!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");Ae=pe}return this.scopedRun(function(){return Le.startScope(Ae)},function(){return Le.endScope(Fe)},function(){return(Fe=Oe())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Fe})},me.prototype.scopedRun=function(pe,Oe,Fe){pe();try{var Le=Fe();return Oe(),Le}catch(Ae){throw Oe(),Ae}},me.prototype.nextTensorId=function(){return me.nextTensorId++},me.prototype.nextVariableId=function(){return me.nextVariableId++},me.prototype.clone=function(pe){var Oe=this.makeTensorFromDataId(pe.dataId,pe.shape,pe.dtype),Fe={x:pe};return this.addTapeNode(this.state.activeScope.name,Fe,[Oe],function(Le){return{x:function(){return Le.toFloat()}}},[],{}),Oe},me.prototype.runKernel=function(pe,Oe,Fe,Le,Ae){return this.runKernelFunc(null,Oe,null,pe,Fe,Le,Ae)},me.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},me.prototype.checkKernelForMemLeak=function(pe,Oe,Fe){var Le=this.backend.numDataIds(),Ae=0;Fe.forEach(function(Xt){Ae+=Xt.dtype==="complex64"?3:1});var ft=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],Mt=Le-Oe-Ae-ft;if(Mt>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+Mt+" data ids) after running '"+pe+"'")},me.prototype.runKernelFunc=function(pe,Oe,Fe,Le,Ae,ft,Mt){var Xt,tn=this,Ce=[],Wt=this.isTapeOn();Le==null&&(Le=this.state.activeScope!=null?this.state.activeScope.name:"");var en,Ut=this.state.numBytes,Qe=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var fn,on=M.getKernel(Le,this.backendName);if(on!=null)en=function(){var Vt=tn.backend.numDataIds();fn=on.kernelFunc({inputs:Oe,attrs:Ae,backend:tn.backend});var En=Array.isArray(fn)?fn:[fn];tn.shouldCheckForMemLeaks()&&tn.checkKernelForMemLeak(Le,Vt,En);var Pt=En.map(function(Hn){var tr=Hn.dataId,pn=Hn.shape,$e=Hn.dtype;return tn.makeTensorFromDataId(tr,pn,$e)});if(Wt){var Rt=tn.getTensorsForGradient(Le,Oe,Pt);if(Rt==null){Mt==null&&(Mt=[]);var Tn=Pt.filter(function(Hn,tr){return Mt[tr]});Rt=(ft||[]).slice().concat(Tn)}Ce=tn.saveTensorsForBackwardMode(Rt)}return Pt};else{var Ct=function(Vt){Wt&&(Ce=Vt.map(function(En){return tn.keep(tn.clone(En))}))};en=function(){var Vt=tn.backend.numDataIds();fn=tn.tidy(function(){return pe(tn.backend,Ct)});var En=Array.isArray(fn)?fn:[fn];return tn.shouldCheckForMemLeaks()&&tn.checkKernelForMemLeak(Le,Vt,En),En}}return this.scopedRun(function(){return tn.state.kernelDepth++},function(){return tn.state.kernelDepth--},function(){Xt=tn.ENV.getBool("DEBUG")?tn.profiler.profileKernel(Le,Oe,function(){return en()}):en()}),Wt&&this.addTapeNode(Le,Oe,Xt,Fe,Ce,Ae),this.state.profiling&&this.state.activeProfile.kernels.push({name:Le,bytesAdded:this.state.numBytes-Ut,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-Qe,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(Oe).map(function(Vt){return Oe[Vt].shape}),outputShapes:Xt.map(function(Vt){return Vt.shape})}),Array.isArray(fn)?Xt:Xt[0]},me.prototype.saveTensorsForBackwardMode=function(pe){var Oe=this;return pe.map(function(Fe){return Oe.keep(Oe.clone(Fe))})},me.prototype.getTensorsForGradient=function(pe,Oe,Fe){var Le=M.getGradient(pe);if(Le!=null){var Ae=Le.inputsToSave||[],ft=Le.outputsToSave||[],Mt=void 0;Le.saveAllInputs?(F.assert(Array.isArray(Oe),function(){return"saveAllInputs is true, expected inputs to be an array."}),Mt=Object.keys(Oe).map(function(tn){return Oe[tn]})):Mt=Ae.map(function(tn){return Oe[tn]});var Xt=Fe.filter(function(tn,Ce){return ft[Ce]});return Mt.concat(Xt)}return null},me.prototype.makeTensor=function(pe,Oe,Fe,Le){if(pe==null)throw new Error("Values passed to engine.makeTensor() are null");Fe=Fe||"float32",Le=Le||this.backend;var Ae=pe;Fe==="string"&&F.isString(pe[0])&&(Ae=pe.map(function(Ce){return F.encodeString(Ce)}));var ft=Le.write(Ae,Oe,Fe),Mt=new W.Tensor(Oe,Fe,ft,this.nextTensorId());if(this.incRef(Mt,Le),Fe==="string"){var Xt=this.state.tensorInfo.get(ft),tn=ue.bytesFromStringArray(Ae);this.state.numBytes+=tn-Xt.bytes,Xt.bytes=tn}return Mt},me.prototype.makeTensorFromDataId=function(pe,Oe,Fe,Le){Fe=Fe||"float32";var Ae=new W.Tensor(Oe,Fe,pe,this.nextTensorId());return this.incRef(Ae,Le),Ae},me.prototype.makeVariable=function(pe,Oe,Fe,Le){Oe===void 0&&(Oe=!0),Fe=Fe||this.nextVariableId().toString(),Le!=null&&Le!==pe.dtype&&(pe=pe.asType(Le));var Ae=new W.Variable(pe,Oe,Fe,this.nextTensorId());if(this.state.registeredVariables[Ae.name]!=null)throw new Error("Variable with name "+Ae.name+" was already registered");return this.state.registeredVariables[Ae.name]=Ae,this.incRef(Ae,this.backend),Ae},me.prototype.incRef=function(pe,Oe){var Fe=this.state.tensorInfo.has(pe.dataId)?this.state.tensorInfo.get(pe.dataId).refCount:0;if(this.state.numTensors++,pe.dtype==="string"&&this.state.numStringTensors++,Fe===0){this.state.numDataBuffers++;var Le=0;pe.dtype!=="complex64"&&pe.dtype!=="string"&&(Le=pe.size*F.bytesPerElement(pe.dtype)),this.state.tensorInfo.set(pe.dataId,{backend:Oe||this.backend,dtype:pe.dtype,shape:pe.shape,bytes:Le,refCount:0}),this.state.numBytes+=Le}this.state.tensorInfo.get(pe.dataId).refCount++,pe instanceof W.Variable||this.track(pe)},me.prototype.disposeTensor=function(pe){if(this.state.tensorInfo.has(pe.dataId)){this.state.numTensors--,pe.dtype==="string"&&this.state.numStringTensors--;var Oe=this.state.tensorInfo.get(pe.dataId);Oe.refCount<=1?(pe.dtype!=="complex64"&&(this.state.numBytes-=Oe.bytes),this.state.numDataBuffers--,Oe.backend.disposeData(pe.dataId),this.state.tensorInfo.delete(pe.dataId)):this.state.tensorInfo.get(pe.dataId).refCount--}},me.prototype.disposeVariables=function(){for(var pe in this.state.registeredVariables){var Oe=this.state.registeredVariables[pe];this.disposeVariable(Oe)}},me.prototype.disposeVariable=function(pe){this.disposeTensor(pe),this.state.registeredVariables[pe.name]!=null&&delete this.state.registeredVariables[pe.name]},me.prototype.memory=function(){var pe=this.backend.memory();return pe.numTensors=this.state.numTensors,pe.numDataBuffers=this.state.numDataBuffers,pe.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(pe.unreliable=!0,pe.reasons==null&&(pe.reasons=[]),pe.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),pe},me.prototype.profile=function(pe){return I(this,void 0,void 0,function(){var Oe,Fe;return A(this,function(Le){return this.state.profiling=!0,Oe=this.state.numBytes,Fe=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=pe(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(Ae){return Ae.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-Oe,this.state.activeProfile.newTensors=this.state.numTensors-Fe,[2,this.state.activeProfile]})})},me.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},me.prototype.addTapeNode=function(pe,Oe,Fe,Le,Ae,ft){var Mt=this,Xt={id:this.state.nextTapeNodeId++,kernelName:pe,inputs:Oe,outputs:Fe,saved:Ae},tn=M.getGradient(pe);tn!=null&&(Le=tn.gradFunc),Le!=null&&(Xt.gradient=function(Ce){return Ce=Ce.map(function(Wt,en){if(Wt==null){var Ut=Fe[en],Qe=F.makeZerosTypedArray(Ut.size,Ut.dtype);return Mt.makeTensor(Qe,Ut.shape,Ut.dtype)}return Wt}),Le(Ce.length>1?Ce:Ce[0],Ae,ft)}),this.state.activeTape.push(Xt)},me.prototype.keep=function(pe){return pe.kept=!0,pe},me.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},me.prototype.endTape=function(){this.state.gradientDepth--},me.prototype.startScope=function(pe){var Oe={track:[],name:"unnamed scope",id:this.state.nextScopeId++};pe&&(Oe.name=pe),this.state.scopeStack.push(Oe),this.state.activeScope=Oe},me.prototype.endScope=function(pe){for(var Oe=this,Fe=te.getTensorsInContainer(pe),Le=new Set(Fe.map(function(Xt){return Xt.id})),Ae=0;Ae<this.state.activeScope.track.length;Ae++){var ft=this.state.activeScope.track[Ae];ft.kept||Le.has(ft.id)||ft.dispose()}var Mt=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],Fe.forEach(function(Xt){Xt.kept||Xt.scopeId!==Mt.id||Oe.track(Xt)})},me.prototype.gradients=function(pe,Oe,Fe,Le){var Ae=this;if(Le===void 0&&(Le=!1),F.assert(Oe.length>0,function(){return"gradients() received an empty list of xs."}),Fe!=null&&Fe.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+Fe.dtype+"'");var ft=this.scopedRun(function(){return Ae.startTape()},function(){return Ae.endTape()},function(){return Ae.tidy("forward",pe)});F.assert(ft instanceof W.Tensor,function(){return"The result y returned by f() must be a tensor."});var Mt=$.getFilteredNodesXToY(this.state.activeTape,Oe,ft);if(!Le&&Mt.length===0&&Oe.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var Xt={};Xt[ft.id]=Fe==null?function(Ce){var Wt=ue.makeOnesTypedArray(ue.sizeFromShape(Ce),"float32");return m.ENGINE.makeTensor(Wt,Ce,"float32")}(ft.shape):Fe,$.backpropagateGradients(Xt,Mt,function(Ce){return Ae.tidy(Ce)});var tn=Oe.map(function(Ce){return Xt[Ce.id]});return Ae.state.gradientDepth===0&&(Ae.state.activeTape.forEach(function(Ce){for(var Wt=0,en=Ce.saved;Wt<en.length;Wt++)en[Wt].dispose()}),Ae.state.activeTape=null),{value:ft,grads:tn}})},me.prototype.customGrad=function(pe){var Oe=this;return F.assert(F.isFunction(pe),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var Fe,Le=[],Ae=0;Ae<arguments.length;Ae++)Le[Ae]=arguments[Ae];F.assert(Le.every(function(Mt){return Mt instanceof W.Tensor}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var ft={};return Le.forEach(function(Mt,Xt){ft[Xt]=Mt}),Oe.runKernelFunc(function(Mt,Xt){return Fe=pe.apply(void 0,Le.concat([Xt])),F.assert(Fe.value instanceof W.Tensor,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),F.assert(F.isFunction(Fe.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),Fe.value},ft,function(Mt,Xt){var tn=Fe.gradFunc(Mt,Xt),Ce=Array.isArray(tn)?tn:[tn];F.assert(Ce.length===Le.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),F.assert(Ce.every(function(en){return en instanceof W.Tensor}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var Wt={};return Ce.forEach(function(en,Ut){Wt[Ut]=function(){return en}}),Wt})}},me.prototype.readSync=function(pe){return this.state.tensorInfo.get(pe).backend.readSync(pe)},me.prototype.read=function(pe){return this.state.tensorInfo.get(pe).backend.read(pe)},me.prototype.time=function(pe){return I(this,void 0,void 0,function(){var Oe,Fe;return A(this,function(Le){switch(Le.label){case 0:return Oe=ue.now(),[4,this.backend.time(pe)];case 1:return(Fe=Le.sent()).wallMs=ue.now()-Oe,[2,Fe]}})})},me.prototype.track=function(pe){return this.state.activeScope!=null&&(pe.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(pe)),pe},Object.defineProperty(me.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),me.prototype.reset=function(){for(var pe in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new se,this.registry)this.disposeRegisteredKernels(pe),this.registry[pe].dispose(),delete this.registry[pe];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},me.nextTensorId=0,me.nextVariableId=0,me}();m.Engine=J,m.ENGINE=function(){var me=function(){if(X==null){var Oe=void 0;if(typeof window!="undefined")Oe=window;else if(g!==void 0)Oe=g;else if(z!==void 0)Oe=z;else{if(typeof self=="undefined")throw new Error("Could not find a global object");Oe=self}X=Oe}return X}();if(me._tfengine==null){var pe=new K.Environment(me);me._tfengine=new J(pe)}return K.setEnvironmentGlobal(me._tfengine.ENV),W.setTensorTracker(function(){return me._tfengine}),me._tfengine}()}).call(this,o(59),o(75))},function(j,m,o){var g=o(14),z=o(240),I=o(66),A=Object.defineProperty;m.f=o(27)?Object.defineProperty:function(X,K,M){if(g(X),K=I(K,!0),g(M),z)try{return A(X,K,M)}catch{}if("get"in M||"set"in M)throw TypeError("Accessors not supported!");return"value"in M&&(X[K]=M.value),X}},function(j,m,o){j.exports=!o(15)(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0});/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var g=o(25);m.op=function(z){var I=Object.keys(z);if(I.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+I.length+" keys.");var A=I[0],X=z[A];A.endsWith("_")&&(A=A.substring(0,A.length-1));var K=function(){for(var M=[],V=0;V<arguments.length;V++)M[V]=arguments[V];g.ENGINE.startScope(A);try{var $=X.apply(void 0,M);return $ instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),g.ENGINE.endScope($),$}catch(W){throw g.ENGINE.endScope(null),W}};return Object.defineProperty(K,"name",{value:A,configurable:!0}),K}},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(25),z=o(103),I=o(33),A=o(21);function X(V,$){var W=V;if(A.isTypedArray(V))return $==="string"?[]:[V.length];if(!Array.isArray(V))return[];for(var te=[];Array.isArray(W)||A.isTypedArray(W)&&$!=="string";)te.push(W.length),W=W[0];return Array.isArray(V)&&z.env().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function F(ue,se,J){if(J=J||[],!Array.isArray(ue)&&!A.isTypedArray(ue))return void A.assert(se.length===0,function(){return"Element arr["+J.join("][")+"] is a primitive, but should be an array/TypedArray of "+se[0]+" elements"});A.assert(se.length>0,function(){return"Element arr["+J.join("][")+"] should be a primitive, but is an array of "+ue.length+" elements"}),A.assert(ue.length===se[0],function(){return"Element arr["+J.join("][")+"] should have "+se[0]+" elements, but has "+ue.length+" elements"});for(var me=se.slice(1),pe=0;pe<ue.length;++pe)F(ue[pe],me,J.concat(pe))}(V,te,[]),te}function K(V,$,W,te){if(V!=null&&(V!=="numeric"&&V!==$||V==="numeric"&&$==="string"))throw new Error("Argument '"+W+"' passed to '"+te+"' must be "+V+" tensor, but got "+$+" tensor")}function M(V,$,W,te){if(te===void 0&&(te="numeric"),V instanceof I.Tensor)return K(te,V.dtype,$,W),V;var F=A.inferDtype(V);if(F!=="string"&&["bool","int32","float32"].indexOf(te)>=0&&(F=te),K(te,F,$,W),V==null||!A.isTypedArray(V)&&!Array.isArray(V)&&typeof V!="number"&&typeof V!="boolean"&&typeof V!="string"){var ue=V==null?"null":V.constructor.name;throw new Error("Argument '"+$+"' passed to '"+W+"' must be a Tensor or TensorLike, but got '"+ue+"'")}var se=X(V,F);A.isTypedArray(V)||Array.isArray(V)||(V=[V]);var J=F!=="string"?A.toTypedArray(V,F,z.env().getBool("DEBUG")):A.flatten(V,[],!0);return g.ENGINE.makeTensor(J,se,F)}m.inferShape=X,m.convertToTensor=M,m.convertToTensorArray=function(V,$,W,te){if(te===void 0&&(te="numeric"),!Array.isArray(V))throw new Error("Argument "+$+" passed to "+W+" must be a `Tensor[]` or `TensorLike[]`");return V.map(function(F,ue){return M(F,$+"["+ue+"]",W)},te)}},function(j,m,o){var g=o(254),z=o(253),I=o(187),A=o(252);j.exports=function(X){return g(X)||z(X)||I(X)||A()},j.exports.__esModule=!0,j.exports.default=j.exports},function(j,m,o){o.d(m,"a",function(){return I});var g=new Date,z=new Date;function I(A,X,K,M){function V($){return A($=arguments.length===0?new Date:new Date(+$)),$}return V.floor=function($){return A($=new Date(+$)),$},V.ceil=function($){return A($=new Date($-1)),X($,1),A($),$},V.round=function($){var W=V($),te=V.ceil($);return $-W<te-$?W:te},V.offset=function($,W){return X($=new Date(+$),W==null?1:Math.floor(W)),$},V.range=function($,W,te){var F,ue=[];if($=V.ceil($),te=te==null?1:Math.floor(te),!($<W&&te>0))return ue;do ue.push(F=new Date(+$)),X($,te),A($);while(F<$&&$<W);return ue},V.filter=function($){return I(function(W){if(W>=W)for(;A(W),!$(W);)W.setTime(W-1)},function(W,te){if(W>=W)if(te<0)for(;++te<=0;)for(;X(W,-1),!$(W););else for(;--te>=0;)for(;X(W,1),!$(W););})},K&&(V.count=function($,W){return g.setTime(+$),z.setTime(+W),A(g),A(z),Math.floor(K(g,z))},V.every=function($){return $=Math.floor($),isFinite($)&&$>0?$>1?V.filter(M?function(W){return M(W)%$==0}:function(W){return V.count(0,W)%$==0}):V:null}),V}},function(j,m,o){const g=o(116),{MAX_LENGTH:z,MAX_SAFE_INTEGER:I}=o(117),{re:A,t:X}=o(90),K=o(115),{compareIdentifiers:M}=o(146);class V{constructor(W,te){if(te=K(te),W instanceof V){if(W.loose===!!te.loose&&W.includePrerelease===!!te.includePrerelease)return W;W=W.version}else if(typeof W!="string")throw new TypeError(`Invalid Version: ${W}`);if(W.length>z)throw new TypeError(`version is longer than ${z} characters`);g("SemVer",W,te),this.options=te,this.loose=!!te.loose,this.includePrerelease=!!te.includePrerelease;const F=W.trim().match(te.loose?A[X.LOOSE]:A[X.FULL]);if(!F)throw new TypeError(`Invalid Version: ${W}`);if(this.raw=W,this.major=+F[1],this.minor=+F[2],this.patch=+F[3],this.major>I||this.major<0)throw new TypeError("Invalid major version");if(this.minor>I||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>I||this.patch<0)throw new TypeError("Invalid patch version");F[4]?this.prerelease=F[4].split(".").map(ue=>{if(/^[0-9]+$/.test(ue)){const se=+ue;if(se>=0&&se<I)return se}return ue}):this.prerelease=[],this.build=F[5]?F[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(W){if(g("SemVer.compare",this.version,this.options,W),!(W instanceof V)){if(typeof W=="string"&&W===this.version)return 0;W=new V(W,this.options)}return W.version===this.version?0:this.compareMain(W)||this.comparePre(W)}compareMain(W){return W instanceof V||(W=new V(W,this.options)),M(this.major,W.major)||M(this.minor,W.minor)||M(this.patch,W.patch)}comparePre(W){if(W instanceof V||(W=new V(W,this.options)),this.prerelease.length&&!W.prerelease.length)return-1;if(!this.prerelease.length&&W.prerelease.length)return 1;if(!this.prerelease.length&&!W.prerelease.length)return 0;let te=0;do{const F=this.prerelease[te],ue=W.prerelease[te];if(g("prerelease compare",te,F,ue),F===void 0&&ue===void 0)return 0;if(ue===void 0)return 1;if(F===void 0)return-1;if(F!==ue)return M(F,ue)}while(++te)}compareBuild(W){W instanceof V||(W=new V(W,this.options));let te=0;do{const F=this.build[te],ue=W.build[te];if(g("prerelease compare",te,F,ue),F===void 0&&ue===void 0)return 0;if(ue===void 0)return 1;if(F===void 0)return-1;if(F!==ue)return M(F,ue)}while(++te)}inc(W,te){switch(W){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",te);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",te);break;case"prepatch":this.prerelease.length=0,this.inc("patch",te),this.inc("pre",te);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",te),this.inc("pre",te);break;case"major":this.minor===0&&this.patch===0&&this.prerelease.length!==0||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":this.patch===0&&this.prerelease.length!==0||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let F=this.prerelease.length;for(;--F>=0;)typeof this.prerelease[F]=="number"&&(this.prerelease[F]++,F=-2);F===-1&&this.prerelease.push(0)}te&&(this.prerelease[0]===te?isNaN(this.prerelease[1])&&(this.prerelease=[te,0]):this.prerelease=[te,0]);break;default:throw new Error(`invalid increment argument: ${W}`)}return this.format(),this.raw=this.version,this}}j.exports=V},function(j,m,o){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var g=this&&this.__extends||function(){var ue=function(se,J){return(ue=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(me,pe){me.__proto__=pe}||function(me,pe){for(var Oe in pe)pe.hasOwnProperty(Oe)&&(me[Oe]=pe[Oe])})(se,J)};return function(se,J){function me(){this.constructor=se}ue(se,J),se.prototype=J===null?Object.create(J):(me.prototype=J.prototype,new me)}}(),z=this&&this.__awaiter||function(ue,se,J,me){return new(J||(J=Promise))(function(pe,Oe){function Fe(ft){try{Ae(me.next(ft))}catch(Mt){Oe(Mt)}}function Le(ft){try{Ae(me.throw(ft))}catch(Mt){Oe(Mt)}}function Ae(ft){ft.done?pe(ft.value):new J(function(Mt){Mt(ft.value)}).then(Fe,Le)}Ae((me=me.apply(ue,se||[])).next())})},I=this&&this.__generator||function(ue,se){var J,me,pe,Oe,Fe={label:0,sent:function(){if(1&pe[0])throw pe[1];return pe[1]},trys:[],ops:[]};return Oe={next:Le(0),throw:Le(1),return:Le(2)},typeof Symbol=="function"&&(Oe[Symbol.iterator]=function(){return this}),Oe;function Le(Ae){return function(ft){return function(Mt){if(J)throw new TypeError("Generator is already executing.");for(;Fe;)try{if(J=1,me&&(pe=2&Mt[0]?me.return:Mt[0]?me.throw||((pe=me.return)&&pe.call(me),0):me.next)&&!(pe=pe.call(me,Mt[1])).done)return pe;switch(me=0,pe&&(Mt=[2&Mt[0],pe.value]),Mt[0]){case 0:case 1:pe=Mt;break;case 4:return Fe.label++,{value:Mt[1],done:!1};case 5:Fe.label++,me=Mt[1],Mt=[0];continue;case 7:Mt=Fe.ops.pop(),Fe.trys.pop();continue;default:if(!(pe=(pe=Fe.trys).length>0&&pe[pe.length-1])&&(Mt[0]===6||Mt[0]===2)){Fe=0;continue}if(Mt[0]===3&&(!pe||Mt[1]>pe[0]&&Mt[1]<pe[3])){Fe.label=Mt[1];break}if(Mt[0]===6&&Fe.label<pe[1]){Fe.label=pe[1],pe=Mt;break}if(pe&&Fe.label<pe[2]){Fe.label=pe[2],Fe.ops.push(Mt);break}pe[2]&&Fe.ops.pop(),Fe.trys.pop();continue}Mt=se.call(ue,Fe)}catch(Xt){Mt=[6,Xt],me=0}finally{J=pe=0}if(5&Mt[0])throw Mt[1];return{value:Mt[0]?Mt[1]:void 0,done:!0}}([Ae,ft])}}};Object.defineProperty(m,"__esModule",{value:!0});var A=o(379),X=o(21),K=o(21),M=function(){function ue(se,J,me){var pe=this;if(this.dtype=J,this.shape=se.slice(),this.size=X.sizeFromShape(se),me!=null){var Oe=me.length;X.assert(Oe===this.size,function(){return"Length of values '"+Oe+"' does not match the size inferred by the shape '"+pe.size+"'."})}if(J==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=me||X.getArrayFromDType(J,this.size),this.strides=K.computeStrides(se)}return ue.prototype.set=function(se){for(var J=this,me=[],pe=1;pe<arguments.length;pe++)me[pe-1]=arguments[pe];me.length===0&&(me=[0]),X.assert(me.length===this.rank,function(){return"The number of provided coordinates ("+me.length+") must match the rank ("+J.rank+")"});var Oe=this.locToIndex(me);this.values[Oe]=se},ue.prototype.get=function(){for(var se=[],J=0;J<arguments.length;J++)se[J]=arguments[J];se.length===0&&(se=[0]);for(var me=0,pe=0,Oe=se;pe<Oe.length;pe++){var Fe=Oe[pe];if(Fe<0||Fe>=this.shape[me]){var Le="Requested out of range element at "+se+".   Buffer shape="+this.shape;throw new Error(Le)}me++}for(var Ae=se[se.length-1],ft=0;ft<se.length-1;++ft)Ae+=this.strides[ft]*se[ft];return this.values[Ae]},ue.prototype.locToIndex=function(se){if(this.rank===0)return 0;if(this.rank===1)return se[0];for(var J=se[se.length-1],me=0;me<se.length-1;++me)J+=this.strides[me]*se[me];return J},ue.prototype.indexToLoc=function(se){if(this.rank===0)return[];if(this.rank===1)return[se];for(var J=new Array(this.shape.length),me=0;me<J.length-1;++me)J[me]=Math.floor(se/this.strides[me]),se-=J[me]*this.strides[me];return J[J.length-1]=se,J},Object.defineProperty(ue.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),ue.prototype.toTensor=function(){return V().makeTensor(this.values,this.shape,this.dtype)},ue}();m.TensorBuffer=M;var V=null,$=null,W=null;m.setTensorTracker=function(ue){V=ue},m.setOpHandler=function(ue){$=ue},m.setDeprecationWarningFn=function(ue){W=ue};var te=function(){function ue(se,J,me,pe){this.kept=!1,this.isDisposedInternal=!1,this.shape=se.slice(),this.dtype=J||"float32",this.size=X.sizeFromShape(se),this.strides=K.computeStrides(se),this.dataId=me,this.id=pe,this.rankType=this.rank<5?this.rank.toString():"higher"}return ue.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},ue.prototype.asScalar=function(){return this.throwIfDisposed(),X.assert(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},ue.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},ue.prototype.as2D=function(se,J){return this.throwIfDisposed(),this.reshape([se,J])},ue.prototype.as3D=function(se,J,me){return this.throwIfDisposed(),this.reshape([se,J,me])},ue.prototype.as4D=function(se,J,me,pe){return this.throwIfDisposed(),this.reshape([se,J,me,pe])},ue.prototype.as5D=function(se,J,me,pe,Oe){return this.throwIfDisposed(),this.reshape([se,J,me,pe,Oe])},ue.prototype.asType=function(se){return this.throwIfDisposed(),$.cast(this,se)},Object.defineProperty(ue.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),ue.prototype.buffer=function(){return z(this,void 0,void 0,function(){var se;return I(this,function(J){switch(J.label){case 0:return[4,this.data()];case 1:return se=J.sent(),[2,$.buffer(this.shape,this.dtype,se)]}})})},ue.prototype.bufferSync=function(){return $.buffer(this.shape,this.dtype,this.dataSync())},ue.prototype.array=function(){return z(this,void 0,void 0,function(){var se;return I(this,function(J){switch(J.label){case 0:return[4,this.data()];case 1:return se=J.sent(),[2,K.toNestedArray(this.shape,se)]}})})},ue.prototype.arraySync=function(){return K.toNestedArray(this.shape,this.dataSync())},ue.prototype.data=function(){return z(this,void 0,void 0,function(){var se,J;return I(this,function(me){switch(me.label){case 0:return this.throwIfDisposed(),se=V().read(this.dataId),this.dtype!=="string"?[3,2]:[4,se];case 1:J=me.sent();try{return[2,J.map(function(pe){return X.decodeString(pe)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}me.label=2;case 2:return[2,se]}})})},ue.prototype.dataSync=function(){this.throwIfDisposed();var se=V().readSync(this.dataId);if(this.dtype==="string")try{return se.map(function(J){return X.decodeString(J)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return se},ue.prototype.bytes=function(){return z(this,void 0,void 0,function(){var se;return I(this,function(J){switch(J.label){case 0:return this.throwIfDisposed(),[4,V().read(this.dataId)];case 1:return se=J.sent(),this.dtype==="string"?[2,se]:[2,new Uint8Array(se.buffer)]}})})},ue.prototype.dispose=function(){this.isDisposed||(V().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(ue.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),ue.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},ue.prototype.toFloat=function(){return this.asType("float32")},ue.prototype.toInt=function(){return this.asType("int32")},ue.prototype.toBool=function(){return this.asType("bool")},ue.prototype.print=function(se){return se===void 0&&(se=!1),$.print(this,se)},ue.prototype.reshape=function(se){return this.throwIfDisposed(),$.reshape(this,se)},ue.prototype.reshapeAs=function(se){return this.throwIfDisposed(),this.reshape(se.shape)},ue.prototype.expandDims=function(se){return se===void 0&&(se=0),$.expandDims(this,se)},ue.prototype.cumsum=function(se,J,me){return se===void 0&&(se=0),J===void 0&&(J=!1),me===void 0&&(me=!1),$.cumsum(this,se,J,me)},ue.prototype.squeeze=function(se){return this.throwIfDisposed(),$.squeeze(this,se)},ue.prototype.clone=function(){return this.throwIfDisposed(),$.clone(this)},ue.prototype.toString=function(se){se===void 0&&(se=!1);var J=this.dataSync();return A.tensorToString(J,this.shape,this.dtype,se)},ue.prototype.gather=function(se,J){return J===void 0&&(J=0),this.throwIfDisposed(),$.gather(this,se,J)},ue.prototype.matMul=function(se,J,me){return J===void 0&&(J=!1),me===void 0&&(me=!1),this.throwIfDisposed(),$.matMul(this,se,J,me)},ue.prototype.dot=function(se){return this.throwIfDisposed(),$.dot(this,se)},ue.prototype.norm=function(se,J,me){return se===void 0&&(se="euclidean"),J===void 0&&(J=null),me===void 0&&(me=!1),this.throwIfDisposed(),$.norm(this,se,J,me)},ue.prototype.slice=function(se,J){return this.throwIfDisposed(),$.slice(this,se,J)},ue.prototype.reverse=function(se){return this.throwIfDisposed(),$.reverse(this,se)},ue.prototype.concat=function(se,J){return J===void 0&&(J=0),this.throwIfDisposed(),se instanceof ue&&(se=[se]),$.concat([this].concat(se),J)},ue.prototype.split=function(se,J){return J===void 0&&(J=0),this.throwIfDisposed(),$.split(this,se,J)},ue.prototype.stack=function(se,J){return J===void 0&&(J=0),$.stack([this,se],J)},ue.prototype.unstack=function(se){return se===void 0&&(se=0),$.unstack(this,se)},ue.prototype.batchNormalization=function(se,J,me,pe,Oe){return me===void 0&&(me=.001),W("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(se,J,Oe,pe,me)},ue.prototype.all=function(se,J){return se===void 0&&(se=null),J===void 0&&(J=!1),this.throwIfDisposed(),$.all(this,se,J)},ue.prototype.any=function(se,J){return se===void 0&&(se=null),J===void 0&&(J=!1),this.throwIfDisposed(),$.any(this,se,J)},ue.prototype.logSumExp=function(se,J){return se===void 0&&(se=null),J===void 0&&(J=!1),this.throwIfDisposed(),$.logSumExp(this,se,J)},ue.prototype.sum=function(se,J){return se===void 0&&(se=null),J===void 0&&(J=!1),this.throwIfDisposed(),$.sum(this,se,J)},ue.prototype.prod=function(se,J){return se===void 0&&(se=null),J===void 0&&(J=!1),this.throwIfDisposed(),$.prod(this,se,J)},ue.prototype.mean=function(se,J){return se===void 0&&(se=null),J===void 0&&(J=!1),this.throwIfDisposed(),$.mean(this,se,J)},ue.prototype.min=function(se,J){return se===void 0&&(se=null),J===void 0&&(J=!1),this.throwIfDisposed(),$.min(this,se,J)},ue.prototype.max=function(se,J){return se===void 0&&(se=null),J===void 0&&(J=!1),this.throwIfDisposed(),$.max(this,se,J)},ue.prototype.argMin=function(se){return se===void 0&&(se=null),this.throwIfDisposed(),$.argMin(this,se)},ue.prototype.argMax=function(se){return se===void 0&&(se=null),this.throwIfDisposed(),$.argMax(this,se)},ue.prototype.cast=function(se){return this.throwIfDisposed(),$.cast(this,se)},ue.prototype.addStrict=function(se){return this.throwIfDisposed(),$.addStrict(this,se)},ue.prototype.atan2=function(se){return this.throwIfDisposed(),$.atan2(this,se)},ue.prototype.sub=function(se){return this.throwIfDisposed(),$.sub(this,se)},ue.prototype.subStrict=function(se){return this.throwIfDisposed(),$.subStrict(this,se)},ue.prototype.pow=function(se){return this.throwIfDisposed(),$.pow(this,se)},ue.prototype.powStrict=function(se){return this.throwIfDisposed(),$.powStrict(this,se)},ue.prototype.mul=function(se){return this.throwIfDisposed(),$.mul(this,se)},ue.prototype.mulStrict=function(se){return this.throwIfDisposed(),$.mulStrict(this,se)},ue.prototype.floorDiv=function(se){return this.throwIfDisposed(),$.floorDiv(this,se)},ue.prototype.divStrict=function(se){return this.throwIfDisposed(),$.divStrict(this,se)},ue.prototype.minimum=function(se){return this.throwIfDisposed(),$.minimum(this,se)},ue.prototype.minimumStrict=function(se){return this.throwIfDisposed(),$.minimumStrict(this,se)},ue.prototype.maximum=function(se){return this.throwIfDisposed(),$.maximum(this,se)},ue.prototype.maximumStrict=function(se){return this.throwIfDisposed(),$.maximumStrict(this,se)},ue.prototype.mod=function(se){return this.throwIfDisposed(),$.mod(this,se)},ue.prototype.modStrict=function(se){return this.throwIfDisposed(),$.modStrict(this,se)},ue.prototype.squaredDifferenceStrict=function(se){return this.throwIfDisposed(),$.squaredDifferenceStrict(this,se)},ue.prototype.notEqual=function(se){return this.throwIfDisposed(),$.notEqual(this,se)},ue.prototype.notEqualStrict=function(se){return this.throwIfDisposed(),$.notEqualStrict(this,se)},ue.prototype.less=function(se){return this.throwIfDisposed(),$.less(this,se)},ue.prototype.lessStrict=function(se){return this.throwIfDisposed(),$.lessStrict(this,se)},ue.prototype.equal=function(se){return this.throwIfDisposed(),$.equal(this,se)},ue.prototype.equalStrict=function(se){return this.throwIfDisposed(),$.equalStrict(this,se)},ue.prototype.lessEqual=function(se){return this.throwIfDisposed(),$.lessEqual(this,se)},ue.prototype.lessEqualStrict=function(se){return this.throwIfDisposed(),$.lessEqualStrict(this,se)},ue.prototype.greater=function(se){return this.throwIfDisposed(),$.greater(this,se)},ue.prototype.greaterStrict=function(se){return this.throwIfDisposed(),$.greaterStrict(this,se)},ue.prototype.greaterEqual=function(se){return this.throwIfDisposed(),$.greaterEqual(this,se)},ue.prototype.greaterEqualStrict=function(se){return this.throwIfDisposed(),$.greaterEqualStrict(this,se)},ue.prototype.logicalAnd=function(se){return this.throwIfDisposed(),$.logicalAnd(this,se)},ue.prototype.logicalOr=function(se){return this.throwIfDisposed(),$.logicalOr(this,se)},ue.prototype.logicalNot=function(){return this.throwIfDisposed(),$.logicalNot(this)},ue.prototype.logicalXor=function(se){return this.throwIfDisposed(),$.logicalXor(this,se)},ue.prototype.where=function(se,J){return this.throwIfDisposed(),$.where(se,this,J)},ue.prototype.neg=function(){return this.throwIfDisposed(),$.neg(this)},ue.prototype.ceil=function(){return this.throwIfDisposed(),$.ceil(this)},ue.prototype.floor=function(){return this.throwIfDisposed(),$.floor(this)},ue.prototype.sign=function(){return this.throwIfDisposed(),$.sign(this)},ue.prototype.isNaN=function(){return this.throwIfDisposed(),$.isNaN(this)},ue.prototype.isInf=function(){return this.throwIfDisposed(),$.isInf(this)},ue.prototype.isFinite=function(){return this.throwIfDisposed(),$.isFinite(this)},ue.prototype.exp=function(){return this.throwIfDisposed(),$.exp(this)},ue.prototype.expm1=function(){return this.throwIfDisposed(),$.expm1(this)},ue.prototype.log=function(){return this.throwIfDisposed(),$.log(this)},ue.prototype.log1p=function(){return this.throwIfDisposed(),$.log1p(this)},ue.prototype.sqrt=function(){return this.throwIfDisposed(),$.sqrt(this)},ue.prototype.rsqrt=function(){return this.throwIfDisposed(),$.rsqrt(this)},ue.prototype.square=function(){return this.throwIfDisposed(),$.square(this)},ue.prototype.reciprocal=function(){return this.throwIfDisposed(),$.reciprocal(this)},ue.prototype.abs=function(){return this.throwIfDisposed(),$.abs(this)},ue.prototype.clipByValue=function(se,J){return this.throwIfDisposed(),$.clipByValue(this,se,J)},ue.prototype.relu=function(){return this.throwIfDisposed(),$.relu(this)},ue.prototype.relu6=function(){return this.throwIfDisposed(),$.relu6(this)},ue.prototype.elu=function(){return this.throwIfDisposed(),$.elu(this)},ue.prototype.selu=function(){return this.throwIfDisposed(),$.selu(this)},ue.prototype.leakyRelu=function(se){return se===void 0&&(se=.2),this.throwIfDisposed(),$.leakyRelu(this,se)},ue.prototype.prelu=function(se){return this.throwIfDisposed(),$.prelu(this,se)},ue.prototype.sigmoid=function(){return this.throwIfDisposed(),$.sigmoid(this)},ue.prototype.logSigmoid=function(){return this.throwIfDisposed(),$.logSigmoid(this)},ue.prototype.softplus=function(){return this.throwIfDisposed(),$.softplus(this)},ue.prototype.zerosLike=function(){return this.throwIfDisposed(),$.zerosLike(this)},ue.prototype.onesLike=function(){return this.throwIfDisposed(),$.onesLike(this)},ue.prototype.sin=function(){return this.throwIfDisposed(),$.sin(this)},ue.prototype.cos=function(){return this.throwIfDisposed(),$.cos(this)},ue.prototype.tan=function(){return this.throwIfDisposed(),$.tan(this)},ue.prototype.asin=function(){return this.throwIfDisposed(),$.asin(this)},ue.prototype.acos=function(){return this.throwIfDisposed(),$.acos(this)},ue.prototype.atan=function(){return this.throwIfDisposed(),$.atan(this)},ue.prototype.sinh=function(){return this.throwIfDisposed(),$.sinh(this)},ue.prototype.cosh=function(){return this.throwIfDisposed(),$.cosh(this)},ue.prototype.tanh=function(){return this.throwIfDisposed(),$.tanh(this)},ue.prototype.asinh=function(){return this.throwIfDisposed(),$.asinh(this)},ue.prototype.acosh=function(){return this.throwIfDisposed(),$.acosh(this)},ue.prototype.atanh=function(){return this.throwIfDisposed(),$.atanh(this)},ue.prototype.erf=function(){return this.throwIfDisposed(),$.erf(this)},ue.prototype.round=function(){return this.throwIfDisposed(),$.round(this)},ue.prototype.step=function(se){return se===void 0&&(se=0),this.throwIfDisposed(),$.step(this,se)},ue.prototype.softmax=function(se){return se===void 0&&(se=-1),this.throwIfDisposed(),$.softmax(this,se)},ue.prototype.logSoftmax=function(se){return se===void 0&&(se=-1),this.throwIfDisposed(),$.logSoftmax(this,se)},ue.prototype.resizeBilinear=function(se,J){return J===void 0&&(J=!1),this.throwIfDisposed(),$.image.resizeBilinear(this,se,J)},ue.prototype.resizeNearestNeighbor=function(se,J){return J===void 0&&(J=!1),this.throwIfDisposed(),$.image.resizeNearestNeighbor(this,se,J)},ue.prototype.conv1d=function(se,J,me,pe,Oe,Fe){return pe===void 0&&(pe="NWC"),Oe===void 0&&(Oe=1),this.throwIfDisposed(),$.conv1d(this,se,J,me,pe,Oe,Fe)},ue.prototype.conv2d=function(se,J,me,pe,Oe,Fe){return pe===void 0&&(pe="NHWC"),Oe===void 0&&(Oe=[1,1]),this.throwIfDisposed(),$.conv2d(this,se,J,me,pe,Oe,Fe)},ue.prototype.conv2dTranspose=function(se,J,me,pe,Oe){return this.throwIfDisposed(),$.conv2dTranspose(this,se,J,me,pe,Oe)},ue.prototype.depthwiseConv2D=function(se,J,me,pe,Oe,Fe){return pe===void 0&&(pe="NHWC"),Oe===void 0&&(Oe=[1,1]),this.throwIfDisposed(),$.depthwiseConv2d(this,se,J,me,pe,Oe,Fe)},ue.prototype.separableConv2d=function(se,J,me,pe,Oe,Fe){return Oe===void 0&&(Oe=[1,1]),Fe===void 0&&(Fe="NHWC"),this.throwIfDisposed(),$.separableConv2d(this,se,J,me,pe,Oe,Fe)},ue.prototype.avgPool=function(se,J,me,pe){return this.throwIfDisposed(),$.avgPool(this,se,J,me,pe)},ue.prototype.maxPool=function(se,J,me,pe){return this.throwIfDisposed(),$.maxPool(this,se,J,me,pe)},ue.prototype.localResponseNormalization=function(se,J,me,pe){return se===void 0&&(se=5),J===void 0&&(J=1),me===void 0&&(me=1),pe===void 0&&(pe=.5),$.localResponseNormalization(this,se,J,me,pe)},ue.prototype.pool=function(se,J,me,pe,Oe){return this.throwIfDisposed(),$.pool(this,se,J,me,pe,Oe)},ue.prototype.variable=function(se,J,me){return se===void 0&&(se=!0),this.throwIfDisposed(),V().makeVariable(this,se,J,me)},ue.prototype.unsortedSegmentSum=function(se,J){return this.throwIfDisposed(),$.unsortedSegmentSum(this,se,J)},ue.prototype.batchToSpaceND=function(se,J){return this.throwIfDisposed(),$.batchToSpaceND(this,se,J)},ue.prototype.spaceToBatchND=function(se,J){return this.throwIfDisposed(),$.spaceToBatchND(this,se,J)},ue.prototype.topk=function(se,J){return se===void 0&&(se=1),J===void 0&&(J=!0),this.throwIfDisposed(),$.topk(this,se,J)},ue.prototype.stridedSlice=function(se,J,me,pe,Oe,Fe,Le,Ae){return pe===void 0&&(pe=0),Oe===void 0&&(Oe=0),Fe===void 0&&(Fe=0),Le===void 0&&(Le=0),Ae===void 0&&(Ae=0),this.throwIfDisposed(),$.stridedSlice(this,se,J,me,pe,Oe,Fe,Le,Ae)},ue.prototype.depthToSpace=function(se,J){return this.throwIfDisposed(),$.depthToSpace(this,se,J)},ue.prototype.fft=function(){return this.throwIfDisposed(),$.spectral.fft(this)},ue.prototype.ifft=function(){return this.throwIfDisposed(),$.spectral.ifft(this)},ue.prototype.rfft=function(){return this.throwIfDisposed(),$.spectral.rfft(this)},ue.prototype.irfft=function(){return this.throwIfDisposed(),$.spectral.irfft(this)},ue}();m.Tensor=te,Object.defineProperty(te,Symbol.hasInstance,{value:function(ue){return!!ue&&ue.dataId!=null&&ue.shape!=null&&ue.dtype!=null}});var F=function(ue){function se(J,me,pe,Oe){var Fe=ue.call(this,J.shape,J.dtype,J.dataId,Oe)||this;return Fe.trainable=me,Fe.name=pe,Fe}return g(se,ue),se.prototype.assign=function(J){if(J.dtype!==this.dtype)throw new Error("dtype of the new value ("+J.dtype+") and previous value ("+this.dtype+") must match");if(!X.arraysEqual(J.shape,this.shape))throw new Error("shape of the new value ("+J.shape+") and previous value ("+this.shape+") must match");V().disposeTensor(this),this.dataId=J.dataId,V().incRef(this,null)},se.prototype.dispose=function(){V().disposeVariable(this),this.isDisposedInternal=!0},se}(te);m.Variable=F,Object.defineProperty(F,Symbol.hasInstance,{value:function(ue){return ue instanceof te&&ue.assign!=null&&ue.assign instanceof Function}})},function(j,m,o){var g=o(61);j.exports=function(z){return Object(g(z))}},function(j,m){function o(g){return j.exports=o=Object.setPrototypeOf?Object.getPrototypeOf:function(z){return z.__proto__||Object.getPrototypeOf(z)},j.exports.__esModule=!0,j.exports.default=j.exports,o(g)}j.exports=o,j.exports.__esModule=!0,j.exports.default=j.exports},function(j,m,o){var g=o(195),z=Object.prototype.toString;function I($){return z.call($)==="[object Array]"}function A($){return $===void 0}function X($){return $!==null&&typeof $=="object"}function K($){if(z.call($)!=="[object Object]")return!1;var W=Object.getPrototypeOf($);return W===null||W===Object.prototype}function M($){return z.call($)==="[object Function]"}function V($,W){if($!=null)if(typeof $!="object"&&($=[$]),I($))for(var te=0,F=$.length;te<F;te++)W.call(null,$[te],te,$);else for(var ue in $)Object.prototype.hasOwnProperty.call($,ue)&&W.call(null,$[ue],ue,$)}j.exports={isArray:I,isArrayBuffer:function($){return z.call($)==="[object ArrayBuffer]"},isBuffer:function($){return $!==null&&!A($)&&$.constructor!==null&&!A($.constructor)&&typeof $.constructor.isBuffer=="function"&&$.constructor.isBuffer($)},isFormData:function($){return typeof FormData!="undefined"&&$ instanceof FormData},isArrayBufferView:function($){return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?ArrayBuffer.isView($):$&&$.buffer&&$.buffer instanceof ArrayBuffer},isString:function($){return typeof $=="string"},isNumber:function($){return typeof $=="number"},isObject:X,isPlainObject:K,isUndefined:A,isDate:function($){return z.call($)==="[object Date]"},isFile:function($){return z.call($)==="[object File]"},isBlob:function($){return z.call($)==="[object Blob]"},isFunction:M,isStream:function($){return X($)&&M($.pipe)},isURLSearchParams:function($){return typeof URLSearchParams!="undefined"&&$ instanceof URLSearchParams},isStandardBrowserEnv:function(){return(typeof navigator=="undefined"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window!="undefined"&&typeof document!="undefined"},forEach:V,merge:function $(){var W={};function te(se,J){K(W[J])&&K(se)?W[J]=$(W[J],se):K(se)?W[J]=$({},se):I(se)?W[J]=se.slice():W[J]=se}for(var F=0,ue=arguments.length;F<ue;F++)V(arguments[F],te);return W},extend:function($,W,te){return V(W,function(F,ue){$[ue]=te&&typeof F=="function"?g(F,te):F}),$},trim:function($){return $.trim?$.trim():$.replace(/^\s+|\s+$/g,"")},stripBOM:function($){return $.charCodeAt(0)===65279&&($=$.slice(1)),$}}},function(j,m,o){var g=o(8),z=o(15),I=o(61),A=/"/g,X=function(K,M,V,$){var W=String(I(K)),te="<"+M;return V!==""&&(te+=" "+V+'="'+String($).replace(A,"&quot;")+'"'),te+">"+W+"</"+M+">"};j.exports=function(K,M){var V={};V[K]=M(X),g(g.P+g.F*z(function(){var $=""[K]('"');return $!==$.toLowerCase()||$.split('"').length>3}),"String",V)}},function(j,m,o){var g=o(16),z=o(42),I=o(43),A=o(84)("src"),X=o(576),K=(""+X).split("toString");o(24).inspectSource=function(M){return X.call(M)},(j.exports=function(M,V,$,W){var te=typeof $=="function";te&&(I($,"name")||z($,"name",V)),M[V]!==$&&(te&&(I($,A)||z($,A,M[V]?""+M[V]:K.join(String(V)))),M===g?M[V]=$:W?M[V]?M[V]=$:z(M,V,$):(delete M[V],z(M,V,$)))})(Function.prototype,"toString",function(){return typeof this=="function"&&this[A]||X.call(this)})},function(j,m,o){o.d(m,"b",function(){return A}),o.d(m,"a",function(){return X}),o.d(m,"c",function(){return V});var g=o(31),z=o(12);function I(te){return Object(g.a)(function(F){F.setUTCDate(F.getUTCDate()-(F.getUTCDay()+7-te)%7),F.setUTCHours(0,0,0,0)},function(F,ue){F.setUTCDate(F.getUTCDate()+7*ue)},function(F,ue){return(ue-F)/z.f})}var A=I(0),X=I(1),K=I(2),M=I(3),V=I(4),$=I(5),W=I(6);A.range,X.range,K.range,M.range,V.range,$.range,W.range},function(j,m,o){o.d(m,"b",function(){return A}),o.d(m,"a",function(){return X}),o.d(m,"c",function(){return V});var g=o(31),z=o(12);function I(te){return Object(g.a)(function(F){F.setDate(F.getDate()-(F.getDay()+7-te)%7),F.setHours(0,0,0,0)},function(F,ue){F.setDate(F.getDate()+7*ue)},function(F,ue){return(ue-F-(ue.getTimezoneOffset()-F.getTimezoneOffset())*z.c)/z.f})}var A=I(0),X=I(1),K=I(2),M=I(3),V=I(4),$=I(5),W=I(6);A.range,X.range,K.range,M.range,V.range,$.range,W.range},function(j,m,o){var g=o(107),z=o(61);j.exports=function(I){return g(z(I))}},function(j,m,o){var g=o(26),z=o(85);j.exports=o(27)?function(I,A,X){return g.f(I,A,z(1,X))}:function(I,A,X){return I[A]=X,I}},function(j,m){var o={}.hasOwnProperty;j.exports=function(g,z){return o.call(g,z)}},function(j,m,o){var g=o(45),z=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function I(pn){if(!($e=z.exec(pn)))throw new Error("invalid format: "+pn);var $e;return new A({fill:$e[1],align:$e[2],sign:$e[3],symbol:$e[4],zero:$e[5],width:$e[6],comma:$e[7],precision:$e[8]&&$e[8].slice(1),trim:$e[9],type:$e[10]})}function A(pn){this.fill=pn.fill===void 0?" ":pn.fill+"",this.align=pn.align===void 0?">":pn.align+"",this.sign=pn.sign===void 0?"-":pn.sign+"",this.symbol=pn.symbol===void 0?"":pn.symbol+"",this.zero=!!pn.zero,this.width=pn.width===void 0?void 0:+pn.width,this.comma=!!pn.comma,this.precision=pn.precision===void 0?void 0:+pn.precision,this.trim=!!pn.trim,this.type=pn.type===void 0?"":pn.type+""}I.prototype=A.prototype,A.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,0|this.width))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};function X(pn,$e){if((et=(pn=$e?pn.toExponential($e-1):pn.toExponential()).indexOf("e"))<0)return null;var et,Ke=pn.slice(0,et);return[Ke.length>1?Ke[0]+Ke.slice(2):Ke,+pn.slice(et+1)]}var K,M,V,$,W=function(pn){return(pn=X(Math.abs(pn)))?pn[1]:NaN},te=function(pn,$e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(W($e)/3)))-W(Math.abs(pn)))},F=function(pn,$e){return pn=Math.abs(pn),$e=Math.abs($e)-pn,Math.max(0,W($e)-W(pn))+1},ue=function(pn){return Math.max(0,-W(Math.abs(pn)))},se=function(pn){e:for(var $e,et=pn.length,Ke=1,yt=-1;Ke<et;++Ke)switch(pn[Ke]){case".":yt=$e=Ke;break;case"0":yt===0&&(yt=Ke),$e=Ke;break;default:if(!+pn[Ke])break e;yt>0&&(yt=0)}return yt>0?pn.slice(0,yt)+pn.slice($e+1):pn},J=function(pn,$e){var et=X(pn,$e);if(!et)return pn+"";var Ke=et[0],yt=et[1];return yt<0?"0."+new Array(-yt).join("0")+Ke:Ke.length>yt+1?Ke.slice(0,yt+1)+"."+Ke.slice(yt+1):Ke+new Array(yt-Ke.length+2).join("0")},me={"%":(pn,$e)=>(100*pn).toFixed($e),b:pn=>Math.round(pn).toString(2),c:pn=>pn+"",d:function(pn){return Math.abs(pn=Math.round(pn))>=1e21?pn.toLocaleString("en").replace(/,/g,""):pn.toString(10)},e:(pn,$e)=>pn.toExponential($e),f:(pn,$e)=>pn.toFixed($e),g:(pn,$e)=>pn.toPrecision($e),o:pn=>Math.round(pn).toString(8),p:(pn,$e)=>J(100*pn,$e),r:J,s:function(pn,$e){var et=X(pn,$e);if(!et)return pn+"";var Ke=et[0],yt=et[1],Dt=yt-(K=3*Math.max(-8,Math.min(8,Math.floor(yt/3))))+1,Lt=Ke.length;return Dt===Lt?Ke:Dt>Lt?Ke+new Array(Dt-Lt+1).join("0"):Dt>0?Ke.slice(0,Dt)+"."+Ke.slice(Dt):"0."+new Array(1-Dt).join("0")+X(pn,Math.max(0,$e+Dt-1))[0]},X:pn=>Math.round(pn).toString(16).toUpperCase(),x:pn=>Math.round(pn).toString(16)},pe=function(pn){return pn},Oe=Array.prototype.map,Fe=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"],Le=function(pn){var $e=pn.grouping===void 0||pn.thousands===void 0?pe:function(we,lr){return function(Rr,Tr){for(var qr=Rr.length,Gr=[],hn=0,nn=we[0],an=0;qr>0&&nn>0&&(an+nn+1>Tr&&(nn=Math.max(1,Tr-an)),Gr.push(Rr.substring(qr-=nn,qr+nn)),!((an+=nn+1)>Tr));)nn=we[hn=(hn+1)%we.length];return Gr.reverse().join(lr)}}(Oe.call(pn.grouping,Number),pn.thousands+""),et=pn.currency===void 0?"":pn.currency[0]+"",Ke=pn.currency===void 0?"":pn.currency[1]+"",yt=pn.decimal===void 0?".":pn.decimal+"",Dt=pn.numerals===void 0?pe:function(we){return function(lr){return lr.replace(/[0-9]/g,function(Rr){return we[+Rr]})}}(Oe.call(pn.numerals,String)),Lt=pn.percent===void 0?"%":pn.percent+"",zn=pn.minus===void 0?"\u2212":pn.minus+"",Cn=pn.nan===void 0?"NaN":pn.nan+"";function ar(we){var lr=(we=I(we)).fill,Rr=we.align,Tr=we.sign,qr=we.symbol,Gr=we.zero,hn=we.width,nn=we.comma,an=we.precision,or=we.trim,jn=we.type;jn==="n"?(nn=!0,jn="g"):me[jn]||(an===void 0&&(an=12),or=!0,jn="g"),(Gr||lr==="0"&&Rr==="=")&&(Gr=!0,lr="0",Rr="=");var Fr=qr==="$"?et:qr==="#"&&/[boxX]/.test(jn)?"0"+jn.toLowerCase():"",Pr=qr==="$"?Ke:/[%p]/.test(jn)?Lt:"",Br=me[jn],wi=/[defgprs%]/.test(jn);function Ai(Jn){var di,ri,Dr,ki=Fr,Ei=Pr;if(jn==="c")Ei=Br(Jn)+Ei,Jn="";else{var mo=(Jn=+Jn)<0||1/Jn<0;if(Jn=isNaN(Jn)?Cn:Br(Math.abs(Jn),an),or&&(Jn=se(Jn)),mo&&+Jn==0&&Tr!=="+"&&(mo=!1),ki=(mo?Tr==="("?Tr:zn:Tr==="-"||Tr==="("?"":Tr)+ki,Ei=(jn==="s"?Fe[8+K/3]:"")+Ei+(mo&&Tr==="("?")":""),wi){for(di=-1,ri=Jn.length;++di<ri;)if(48>(Dr=Jn.charCodeAt(di))||Dr>57){Ei=(Dr===46?yt+Jn.slice(di+1):Jn.slice(di))+Ei,Jn=Jn.slice(0,di);break}}}nn&&!Gr&&(Jn=$e(Jn,1/0));var Gi=ki.length+Jn.length+Ei.length,Ui=Gi<hn?new Array(hn-Gi+1).join(lr):"";switch(nn&&Gr&&(Jn=$e(Ui+Jn,Ui.length?hn-Ei.length:1/0),Ui=""),Rr){case"<":Jn=ki+Jn+Ei+Ui;break;case"=":Jn=ki+Ui+Jn+Ei;break;case"^":Jn=Ui.slice(0,Gi=Ui.length>>1)+ki+Jn+Ei+Ui.slice(Gi);break;default:Jn=Ui+ki+Jn+Ei}return Dt(Jn)}return an=an===void 0?6:/[gprs]/.test(jn)?Math.max(1,Math.min(21,an)):Math.max(0,Math.min(20,an)),Ai.toString=function(){return we+""},Ai}return{format:ar,formatPrefix:function(we,lr){var Rr=ar(((we=I(we)).type="f",we)),Tr=3*Math.max(-8,Math.min(8,Math.floor(W(lr)/3))),qr=Math.pow(10,-Tr),Gr=Fe[8+Tr/3];return function(hn){return Rr(qr*hn)+Gr}}}};(function(pn){M=Le(pn),V=M.format,$=M.formatPrefix})({thousands:",",grouping:[3],currency:["$",""]});var Ae=o(11),ft=o(1),Mt=o(100),Xt=o(246);function tn(pn){const $e={};return et=>$e[et]||($e[et]=pn(et))}function Ce(pn){const $e=tn(pn.format),et=pn.formatPrefix;return{format:$e,formatPrefix:et,formatFloat(Ke){const yt=I(Ke||",");if(yt.precision==null){switch(yt.precision=12,yt.type){case"%":yt.precision-=2;break;case"e":yt.precision-=1}return function(Dt,Lt){return zn=>{const Cn=Dt(zn),ar=Cn.indexOf(Lt);if(ar<0)return Cn;let we=function(Rr,Tr){let qr,Gr=Rr.lastIndexOf("e");if(Gr>0)return Gr;for(Gr=Rr.length;--Gr>Tr;)if((qr=Rr.charCodeAt(Gr))>=48&&qr<=57)return Gr+1}(Cn,ar);const lr=we<Cn.length?Cn.slice(we):"";for(;--we>ar;)if(Cn[we]!=="0"){++we;break}return Cn.slice(0,we)+lr}}($e(yt),$e(".1f")(1)[1])}return $e(yt)},formatSpan(Ke,yt,Dt,Lt){Lt=I(Lt==null?",f":Lt);const zn=Object(g.c)(Ke,yt,Dt),Cn=Math.max(Math.abs(Ke),Math.abs(yt));let ar;if(Lt.precision==null)switch(Lt.type){case"s":return isNaN(ar=te(zn,Cn))||(Lt.precision=ar),et(Lt,Cn);case"":case"e":case"g":case"p":case"r":isNaN(ar=F(zn,Cn))||(Lt.precision=ar-(Lt.type==="e"));break;case"f":case"%":isNaN(ar=ue(zn))||(Lt.precision=ar-2*(Lt.type==="%"))}return $e(Lt)}}}let Wt,en;function Ut(){return Wt=Ce({format:V,formatPrefix:$})}function Qe(pn){return Ce(Le(pn))}function fn(pn){return arguments.length?Wt=Qe(pn):Wt}function on(pn,$e,et){et=et||{},Object(ft.H)(et)||Object(ft.o)("Invalid time multi-format specifier: ".concat(et));const Ke=$e(Ae.i),yt=$e(Ae.f),Dt=$e(Ae.d),Lt=$e(Ae.a),zn=$e(Ae.k),Cn=$e(Ae.g),ar=$e(Ae.h),we=$e(Ae.l),lr=pn(et[Ae.e]||".%L"),Rr=pn(et[Ae.i]||":%S"),Tr=pn(et[Ae.f]||"%I:%M"),qr=pn(et[Ae.d]||"%I %p"),Gr=pn(et[Ae.a]||et[Ae.b]||"%a %d"),hn=pn(et[Ae.k]||"%b %d"),nn=pn(et[Ae.g]||"%B"),an=pn(et[Ae.h]||"%B"),or=pn(et[Ae.l]||"%Y");return jn=>(Ke(jn)<jn?lr:yt(jn)<jn?Rr:Dt(jn)<jn?Tr:Lt(jn)<jn?qr:Cn(jn)<jn?zn(jn)<jn?Gr:hn:we(jn)<jn?ar(jn)<jn?nn:an:or)(jn)}function Ct(pn){const $e=tn(pn.format),et=tn(pn.utcFormat);return{timeFormat:Ke=>Object(ft.J)(Ke)?$e(Ke):on($e,Ae.p,Ke),utcFormat:Ke=>Object(ft.J)(Ke)?et(Ke):on(et,Ae.v,Ke),timeParse:tn(pn.parse),utcParse:tn(pn.utcParse)}}function Vt(){return en=Ct({format:Mt.a,parse:Mt.b,utcFormat:Mt.c,utcParse:Mt.d})}function En(pn){return Ct(Object(Xt.a)(pn))}function Pt(pn){return arguments.length?en=En(pn):en}o.d(m,"a",function(){return Hn}),o.d(m,"b",function(){return Tn}),o.d(m,"c",function(){return fn}),o.d(m,"d",function(){return tr}),o.d(m,"e",function(){return Pt}),Ut(),Vt();const Rt=(pn,$e)=>Object(ft.p)({},pn,$e);function Tn(pn,$e){const et=pn?Qe(pn):fn(),Ke=$e?En($e):Pt();return Rt(et,Ke)}function Hn(pn,$e){const et=arguments.length;return et&&et!==2&&Object(ft.o)("defaultLocale expects either zero or two arguments."),et?Rt(fn(pn),Pt($e)):Rt(fn(),Pt())}function tr(){return Ut(),Vt(),Hn()}},function(j,m,o){o.d(m,"b",function(){return A}),o.d(m,"c",function(){return X});var g=Math.sqrt(50),z=Math.sqrt(10),I=Math.sqrt(2);function A(K,M,V){var $=(M-K)/Math.max(0,V),W=Math.floor(Math.log($)/Math.LN10),te=$/Math.pow(10,W);return W>=0?(te>=g?10:te>=z?5:te>=I?2:1)*Math.pow(10,W):-Math.pow(10,-W)/(te>=g?10:te>=z?5:te>=I?2:1)}function X(K,M,V){var $=Math.abs(M-K)/Math.max(0,V),W=Math.pow(10,Math.floor(Math.log($)/Math.LN10)),te=$/W;return te>=g?W*=10:te>=z?W*=5:te>=I&&(W*=2),M<K?-W:W}m.a=function(K,M,V){var $,W,te,F,ue=-1;if(V=+V,(K=+K)==(M=+M)&&V>0)return[K];if(($=M<K)&&(W=K,K=M,M=W),(F=A(K,M,V))===0||!isFinite(F))return[];if(F>0){let se=Math.round(K/F),J=Math.round(M/F);for(se*F<K&&++se,J*F>M&&--J,te=new Array(W=J-se+1);++ue<W;)te[ue]=(se+ue)*F}else{F=-F;let se=Math.round(K*F),J=Math.round(M*F);for(se/F<K&&++se,J/F>M&&--J,te=new Array(W=J-se+1);++ue<W;)te[ue]=(se+ue)/F}return $&&te.reverse(),te}},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var g=this&&this.__awaiter||function(A,X,K,M){return new(K||(K=Promise))(function(V,$){function W(ue){try{F(M.next(ue))}catch(se){$(se)}}function te(ue){try{F(M.throw(ue))}catch(se){$(se)}}function F(ue){ue.done?V(ue.value):new K(function(se){se(ue.value)}).then(W,te)}F((M=M.apply(A,X||[])).next())})};Object.defineProperty(m,"__esModule",{value:!0});const z=o(198),I=o(197);m.getDrawArea=function(A){if(A instanceof HTMLElement)return A;if(z.isSurface(A))return A.drawArea;if(z.isSurfaceInfo(A))return I.visor().surface({name:A.name,tab:A.tab,styles:A.styles}).drawArea;throw new Error("Not a drawable")},m.shallowEquals=function(A,X){const K=Object.getOwnPropertyNames(A),M=Object.getOwnPropertyNames(X);if(K.length!==M.length)return!1;for(let V=0;V<K.length;V++){const $=K[V];if(A[$]!==X[$])return!1}return!0},m.nextFrame=function(){return g(this,void 0,void 0,function*(){yield new Promise(A=>requestAnimationFrame(A))})}},function(j,m,o){class g{constructor(en,Ut){if(Ut=I(Ut),en instanceof g)return en.loose===!!Ut.loose&&en.includePrerelease===!!Ut.includePrerelease?en:new g(en.raw,Ut);if(en instanceof A)return this.raw=en.value,this.set=[[en]],this.format(),this;if(this.options=Ut,this.loose=!!Ut.loose,this.includePrerelease=!!Ut.includePrerelease,this.raw=en,this.set=en.split(/\s*\|\|\s*/).map(Qe=>this.parseRange(Qe.trim())).filter(Qe=>Qe.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${en}`);if(this.set.length>1){const Qe=this.set[0];if(this.set=this.set.filter(fn=>!F(fn[0])),this.set.length===0)this.set=[Qe];else if(this.set.length>1){for(const fn of this.set)if(fn.length===1&&ue(fn[0])){this.set=[fn];break}}}this.format()}format(){return this.range=this.set.map(en=>en.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(en){en=en.trim();const Ut=`parseRange:${Object.keys(this.options).join(",")}:${en}`,Qe=z.get(Ut);if(Qe)return Qe;const fn=this.options.loose,on=fn?M[V.HYPHENRANGELOOSE]:M[V.HYPHENRANGE];en=en.replace(on,tn(this.options.includePrerelease)),X("hyphen replace",en),en=en.replace(M[V.COMPARATORTRIM],$),X("comparator trim",en,M[V.COMPARATORTRIM]),en=(en=(en=en.replace(M[V.TILDETRIM],W)).replace(M[V.CARETTRIM],te)).split(/\s+/).join(" ");const Ct=fn?M[V.COMPARATORLOOSE]:M[V.COMPARATOR],Vt=en.split(" ").map(Rt=>J(Rt,this.options)).join(" ").split(/\s+/).map(Rt=>Xt(Rt,this.options)).filter(this.options.loose?Rt=>!!Rt.match(Ct):()=>!0).map(Rt=>new A(Rt,this.options)),En=(Vt.length,new Map);for(const Rt of Vt){if(F(Rt))return[Rt];En.set(Rt.value,Rt)}En.size>1&&En.has("")&&En.delete("");const Pt=[...En.values()];return z.set(Ut,Pt),Pt}intersects(en,Ut){if(!(en instanceof g))throw new TypeError("a Range is required");return this.set.some(Qe=>se(Qe,Ut)&&en.set.some(fn=>se(fn,Ut)&&Qe.every(on=>fn.every(Ct=>on.intersects(Ct,Ut)))))}test(en){if(!en)return!1;if(typeof en=="string")try{en=new K(en,this.options)}catch{return!1}for(let Ut=0;Ut<this.set.length;Ut++)if(Ce(this.set[Ut],en,this.options))return!0;return!1}}j.exports=g;const z=new(o(335))({max:1e3}),I=o(115),A=o(113),X=o(116),K=o(32),{re:M,t:V,comparatorTrimReplace:$,tildeTrimReplace:W,caretTrimReplace:te}=o(90),F=Wt=>Wt.value==="<0.0.0-0",ue=Wt=>Wt.value==="",se=(Wt,en)=>{let Ut=!0;const Qe=Wt.slice();let fn=Qe.pop();for(;Ut&&Qe.length;)Ut=Qe.every(on=>fn.intersects(on,en)),fn=Qe.pop();return Ut},J=(Wt,en)=>(X("comp",Wt,en),Wt=Fe(Wt,en),X("caret",Wt),Wt=pe(Wt,en),X("tildes",Wt),Wt=Ae(Wt,en),X("xrange",Wt),Wt=Mt(Wt,en),X("stars",Wt),Wt),me=Wt=>!Wt||Wt.toLowerCase()==="x"||Wt==="*",pe=(Wt,en)=>Wt.trim().split(/\s+/).map(Ut=>Oe(Ut,en)).join(" "),Oe=(Wt,en)=>{const Ut=en.loose?M[V.TILDELOOSE]:M[V.TILDE];return Wt.replace(Ut,(Qe,fn,on,Ct,Vt)=>{let En;return X("tilde",Wt,Qe,fn,on,Ct,Vt),me(fn)?En="":me(on)?En=`>=${fn}.0.0 <${+fn+1}.0.0-0`:me(Ct)?En=`>=${fn}.${on}.0 <${fn}.${+on+1}.0-0`:Vt?(X("replaceTilde pr",Vt),En=`>=${fn}.${on}.${Ct}-${Vt} <${fn}.${+on+1}.0-0`):En=`>=${fn}.${on}.${Ct} <${fn}.${+on+1}.0-0`,X("tilde return",En),En})},Fe=(Wt,en)=>Wt.trim().split(/\s+/).map(Ut=>Le(Ut,en)).join(" "),Le=(Wt,en)=>{X("caret",Wt,en);const Ut=en.loose?M[V.CARETLOOSE]:M[V.CARET],Qe=en.includePrerelease?"-0":"";return Wt.replace(Ut,(fn,on,Ct,Vt,En)=>{let Pt;return X("caret",Wt,fn,on,Ct,Vt,En),me(on)?Pt="":me(Ct)?Pt=`>=${on}.0.0${Qe} <${+on+1}.0.0-0`:me(Vt)?Pt=on==="0"?`>=${on}.${Ct}.0${Qe} <${on}.${+Ct+1}.0-0`:`>=${on}.${Ct}.0${Qe} <${+on+1}.0.0-0`:En?(X("replaceCaret pr",En),Pt=on==="0"?Ct==="0"?`>=${on}.${Ct}.${Vt}-${En} <${on}.${Ct}.${+Vt+1}-0`:`>=${on}.${Ct}.${Vt}-${En} <${on}.${+Ct+1}.0-0`:`>=${on}.${Ct}.${Vt}-${En} <${+on+1}.0.0-0`):(X("no pr"),Pt=on==="0"?Ct==="0"?`>=${on}.${Ct}.${Vt}${Qe} <${on}.${Ct}.${+Vt+1}-0`:`>=${on}.${Ct}.${Vt}${Qe} <${on}.${+Ct+1}.0-0`:`>=${on}.${Ct}.${Vt} <${+on+1}.0.0-0`),X("caret return",Pt),Pt})},Ae=(Wt,en)=>(X("replaceXRanges",Wt,en),Wt.split(/\s+/).map(Ut=>ft(Ut,en)).join(" ")),ft=(Wt,en)=>{Wt=Wt.trim();const Ut=en.loose?M[V.XRANGELOOSE]:M[V.XRANGE];return Wt.replace(Ut,(Qe,fn,on,Ct,Vt,En)=>{X("xRange",Wt,Qe,fn,on,Ct,Vt,En);const Pt=me(on),Rt=Pt||me(Ct),Tn=Rt||me(Vt),Hn=Tn;return fn==="="&&Hn&&(fn=""),En=en.includePrerelease?"-0":"",Pt?Qe=fn===">"||fn==="<"?"<0.0.0-0":"*":fn&&Hn?(Rt&&(Ct=0),Vt=0,fn===">"?(fn=">=",Rt?(on=+on+1,Ct=0,Vt=0):(Ct=+Ct+1,Vt=0)):fn==="<="&&(fn="<",Rt?on=+on+1:Ct=+Ct+1),fn==="<"&&(En="-0"),Qe=`${fn+on}.${Ct}.${Vt}${En}`):Rt?Qe=`>=${on}.0.0${En} <${+on+1}.0.0-0`:Tn&&(Qe=`>=${on}.${Ct}.0${En} <${on}.${+Ct+1}.0-0`),X("xRange return",Qe),Qe})},Mt=(Wt,en)=>(X("replaceStars",Wt,en),Wt.trim().replace(M[V.STAR],"")),Xt=(Wt,en)=>(X("replaceGTE0",Wt,en),Wt.trim().replace(M[en.includePrerelease?V.GTE0PRE:V.GTE0],"")),tn=Wt=>(en,Ut,Qe,fn,on,Ct,Vt,En,Pt,Rt,Tn,Hn,tr)=>`${Ut=me(Qe)?"":me(fn)?`>=${Qe}.0.0${Wt?"-0":""}`:me(on)?`>=${Qe}.${fn}.0${Wt?"-0":""}`:Ct?`>=${Ut}`:`>=${Ut}${Wt?"-0":""}`} ${En=me(Pt)?"":me(Rt)?`<${+Pt+1}.0.0-0`:me(Tn)?`<${Pt}.${+Rt+1}.0-0`:Hn?`<=${Pt}.${Rt}.${Tn}-${Hn}`:Wt?`<${Pt}.${Rt}.${+Tn+1}-0`:`<=${En}`}`.trim(),Ce=(Wt,en,Ut)=>{for(let Qe=0;Qe<Wt.length;Qe++)if(!Wt[Qe].test(en))return!1;if(en.prerelease.length&&!Ut.includePrerelease){for(let Qe=0;Qe<Wt.length;Qe++)if(X(Wt[Qe].semver),Wt[Qe].semver!==A.ANY&&Wt[Qe].semver.prerelease.length>0){const fn=Wt[Qe].semver;if(fn.major===en.major&&fn.minor===en.minor&&fn.patch===en.patch)return!0}return!1}return!0}},function(j,m,o){const g=o(32);j.exports=(z,I,A)=>new g(z,A).compare(new g(I,A))},function(j,m,o){var g=o(15);j.exports=function(z,I){return!!z&&g(function(){I?z.call(null,function(){},1):z.call(null)})}},function(j,m,o){o.r(m);var g=function(Le,Ae){if((ft=(Le=Ae?Le.toExponential(Ae-1):Le.toExponential()).indexOf("e"))<0)return null;var ft,Mt=Le.slice(0,ft);return[Mt.length>1?Mt[0]+Mt.slice(2):Mt,+Le.slice(ft+1)]},z=function(Le){return(Le=g(Math.abs(Le)))?Le[1]:NaN},I=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function A(Le){return new X(Le)}function X(Le){if(!(Ae=I.exec(Le)))throw new Error("invalid format: "+Le);var Ae;this.fill=Ae[1]||" ",this.align=Ae[2]||">",this.sign=Ae[3]||"-",this.symbol=Ae[4]||"",this.zero=!!Ae[5],this.width=Ae[6]&&+Ae[6],this.comma=!!Ae[7],this.precision=Ae[8]&&+Ae[8].slice(1),this.trim=!!Ae[9],this.type=Ae[10]||""}A.prototype=X.prototype,X.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width==null?"":Math.max(1,0|this.width))+(this.comma?",":"")+(this.precision==null?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var K,M,V,$,W=function(Le){e:for(var Ae,ft=Le.length,Mt=1,Xt=-1;Mt<ft;++Mt)switch(Le[Mt]){case".":Xt=Ae=Mt;break;case"0":Xt===0&&(Xt=Mt),Ae=Mt;break;default:if(Xt>0){if(!+Le[Mt])break e;Xt=0}}return Xt>0?Le.slice(0,Xt)+Le.slice(Ae+1):Le},te=function(Le,Ae){var ft=g(Le,Ae);if(!ft)return Le+"";var Mt=ft[0],Xt=ft[1];return Xt<0?"0."+new Array(-Xt).join("0")+Mt:Mt.length>Xt+1?Mt.slice(0,Xt+1)+"."+Mt.slice(Xt+1):Mt+new Array(Xt-Mt.length+2).join("0")},F={"%":function(Le,Ae){return(100*Le).toFixed(Ae)},b:function(Le){return Math.round(Le).toString(2)},c:function(Le){return Le+""},d:function(Le){return Math.round(Le).toString(10)},e:function(Le,Ae){return Le.toExponential(Ae)},f:function(Le,Ae){return Le.toFixed(Ae)},g:function(Le,Ae){return Le.toPrecision(Ae)},o:function(Le){return Math.round(Le).toString(8)},p:function(Le,Ae){return te(100*Le,Ae)},r:te,s:function(Le,Ae){var ft=g(Le,Ae);if(!ft)return Le+"";var Mt=ft[0],Xt=ft[1],tn=Xt-(K=3*Math.max(-8,Math.min(8,Math.floor(Xt/3))))+1,Ce=Mt.length;return tn===Ce?Mt:tn>Ce?Mt+new Array(tn-Ce+1).join("0"):tn>0?Mt.slice(0,tn)+"."+Mt.slice(tn):"0."+new Array(1-tn).join("0")+g(Le,Math.max(0,Ae+tn-1))[0]},X:function(Le){return Math.round(Le).toString(16).toUpperCase()},x:function(Le){return Math.round(Le).toString(16)}},ue=function(Le){return Le},se=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"],J=function(Le){var Ae=Le.grouping&&Le.thousands?function(Wt,en){return function(Ut,Qe){for(var fn=Ut.length,on=[],Ct=0,Vt=Wt[0],En=0;fn>0&&Vt>0&&(En+Vt+1>Qe&&(Vt=Math.max(1,Qe-En)),on.push(Ut.substring(fn-=Vt,fn+Vt)),!((En+=Vt+1)>Qe));)Vt=Wt[Ct=(Ct+1)%Wt.length];return on.reverse().join(en)}}(Le.grouping,Le.thousands):ue,ft=Le.currency,Mt=Le.decimal,Xt=Le.numerals?function(Wt){return function(en){return en.replace(/[0-9]/g,function(Ut){return Wt[+Ut]})}}(Le.numerals):ue,tn=Le.percent||"%";function Ce(Wt){var en=(Wt=A(Wt)).fill,Ut=Wt.align,Qe=Wt.sign,fn=Wt.symbol,on=Wt.zero,Ct=Wt.width,Vt=Wt.comma,En=Wt.precision,Pt=Wt.trim,Rt=Wt.type;Rt==="n"?(Vt=!0,Rt="g"):F[Rt]||(En==null&&(En=12),Pt=!0,Rt="g"),(on||en==="0"&&Ut==="=")&&(on=!0,en="0",Ut="=");var Tn=fn==="$"?ft[0]:fn==="#"&&/[boxX]/.test(Rt)?"0"+Rt.toLowerCase():"",Hn=fn==="$"?ft[1]:/[%p]/.test(Rt)?tn:"",tr=F[Rt],pn=/[defgprs%]/.test(Rt);function $e(et){var Ke,yt,Dt,Lt=Tn,zn=Hn;if(Rt==="c")zn=tr(et)+zn,et="";else{var Cn=(et=+et)<0;if(et=tr(Math.abs(et),En),Pt&&(et=W(et)),Cn&&+et==0&&(Cn=!1),Lt=(Cn?Qe==="("?Qe:"-":Qe==="-"||Qe==="("?"":Qe)+Lt,zn=(Rt==="s"?se[8+K/3]:"")+zn+(Cn&&Qe==="("?")":""),pn){for(Ke=-1,yt=et.length;++Ke<yt;)if(48>(Dt=et.charCodeAt(Ke))||Dt>57){zn=(Dt===46?Mt+et.slice(Ke+1):et.slice(Ke))+zn,et=et.slice(0,Ke);break}}}Vt&&!on&&(et=Ae(et,1/0));var ar=Lt.length+et.length+zn.length,we=ar<Ct?new Array(Ct-ar+1).join(en):"";switch(Vt&&on&&(et=Ae(we+et,we.length?Ct-zn.length:1/0),we=""),Ut){case"<":et=Lt+et+zn+we;break;case"=":et=Lt+we+et+zn;break;case"^":et=we.slice(0,ar=we.length>>1)+Lt+et+zn+we.slice(ar);break;default:et=we+Lt+et+zn}return Xt(et)}return En=En==null?6:/[gprs]/.test(Rt)?Math.max(1,Math.min(21,En)):Math.max(0,Math.min(20,En)),$e.toString=function(){return Wt+""},$e}return{format:Ce,formatPrefix:function(Wt,en){var Ut=Ce(((Wt=A(Wt)).type="f",Wt)),Qe=3*Math.max(-8,Math.min(8,Math.floor(z(en)/3))),fn=Math.pow(10,-Qe),on=se[8+Qe/3];return function(Ct){return Ut(fn*Ct)+on}}}};function me(Le){return M=J(Le),V=M.format,$=M.formatPrefix,M}me({decimal:".",thousands:",",grouping:[3],currency:["$",""]});var pe=function(Le){return Math.max(0,-z(Math.abs(Le)))},Oe=function(Le,Ae){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(z(Ae)/3)))-z(Math.abs(Le)))},Fe=function(Le,Ae){return Le=Math.abs(Le),Ae=Math.abs(Ae)-Le,Math.max(0,z(Ae)-z(Le))+1};o.d(m,"formatDefaultLocale",function(){return me}),o.d(m,"format",function(){return V}),o.d(m,"formatPrefix",function(){return $}),o.d(m,"formatLocale",function(){return J}),o.d(m,"formatSpecifier",function(){return A}),o.d(m,"precisionFixed",function(){return pe}),o.d(m,"precisionPrefix",function(){return Oe}),o.d(m,"precisionRound",function(){return Fe})},function(j,m,o){var g=o(56),z=o(107),I=o(34),A=o(22),X=o(224);j.exports=function(K,M){var V=K==1,$=K==2,W=K==3,te=K==4,F=K==6,ue=K==5||F,se=M||X;return function(J,me,pe){for(var Oe,Fe,Le=I(J),Ae=z(Le),ft=g(me,pe,3),Mt=A(Ae.length),Xt=0,tn=V?se(J,Mt):$?se(J,0):void 0;Mt>Xt;Xt++)if((ue||Xt in Ae)&&(Fe=ft(Oe=Ae[Xt],Xt,Le),K)){if(V)tn[Xt]=Fe;else if(Fe)switch(K){case 3:return!0;case 5:return Oe;case 6:return Xt;case 2:tn.push(Oe)}else if(te)return!1}return F?-1:W||te?te:tn}}},function(j,m,o){var g=o(8),z=o(24),I=o(15);j.exports=function(A,X){var K=(z.Object||{})[A]||Object[A],M={};M[A]=X(K),g(g.S+g.F*I(function(){K(1)}),"Object",M)}},function(j,m,o){var g=o(106),z=o(85),I=o(41),A=o(66),X=o(43),K=o(240),M=Object.getOwnPropertyDescriptor;m.f=o(27)?M:function(V,$){if(V=I(V),$=A($,!0),K)try{return M(V,$)}catch{}if(X(V,$))return z(!g.f.call(V,$),V[$])}},function(j,m){var o=Math.ceil,g=Math.floor;j.exports=function(z){return isNaN(z=+z)?0:(z>0?g:o)(z)}},function(j,m){j.exports=function(o){if(typeof o!="function")throw TypeError(o+" is not a function!");return o}},function(j,m,o){var g=o(55);j.exports=function(z,I,A){if(g(z),I===void 0)return z;switch(A){case 1:return function(X){return z.call(I,X)};case 2:return function(X,K){return z.call(I,X,K)};case 3:return function(X,K,M){return z.call(I,X,K,M)}}return function(){return z.apply(I,arguments)}}},function(j,m,o){var g=o(7).default,z=o(258);j.exports=function(I,A){if(A&&(g(A)==="object"||typeof A=="function"))return A;if(A!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return z(I)},j.exports.__esModule=!0,j.exports.default=j.exports},function(j,m,o){var g=o(259);j.exports=function(z,I){if(typeof I!="function"&&I!==null)throw new TypeError("Super expression must either be null or a function");z.prototype=Object.create(I&&I.prototype,{constructor:{value:z,writable:!0,configurable:!0}}),Object.defineProperty(z,"prototype",{writable:!1}),I&&g(z,I)},j.exports.__esModule=!0,j.exports.default=j.exports},function(j,m){var o;o=function(){return this}();try{o=o||Function("return this")()||(0,eval)("this")}catch{typeof window=="object"&&(o=window)}j.exports=o},function(j,m,o){if(o(27)){var g=o(83),z=o(16),I=o(15),A=o(8),X=o(118),K=o(151),M=o(56),V=o(94),$=o(85),W=o(42),te=o(93),F=o(54),ue=o(22),se=o(213),J=o(81),me=o(66),pe=o(43),Oe=o(105),Fe=o(13),Le=o(34),Ae=o(159),ft=o(80),Mt=o(78),Xt=o(79).f,tn=o(157),Ce=o(84),Wt=o(19),en=o(51),Ut=o(128),Qe=o(104),fn=o(155),on=o(96),Ct=o(125),Vt=o(95),En=o(156),Pt=o(222),Rt=o(26),Tn=o(53),Hn=Rt.f,tr=Tn.f,pn=z.RangeError,$e=z.TypeError,et=z.Uint8Array,Ke=Array.prototype,yt=K.ArrayBuffer,Dt=K.DataView,Lt=en(0),zn=en(2),Cn=en(3),ar=en(4),we=en(5),lr=en(6),Rr=Ut(!0),Tr=Ut(!1),qr=fn.values,Gr=fn.keys,hn=fn.entries,nn=Ke.lastIndexOf,an=Ke.reduce,or=Ke.reduceRight,jn=Ke.join,Fr=Ke.sort,Pr=Ke.slice,Br=Ke.toString,wi=Ke.toLocaleString,Ai=Wt("iterator"),Jn=Wt("toStringTag"),di=Ce("typed_constructor"),ri=Ce("def_constructor"),Dr=X.CONSTR,ki=X.TYPED,Ei=X.VIEW,mo=en(1,function(Yt,He){return $t(Qe(Yt,Yt[ri]),He)}),Gi=I(function(){return new et(new Uint16Array([1]).buffer)[0]===1}),Ui=!!et&&!!et.prototype.set&&I(function(){new et(1).set({})}),Ot=function(Yt,He){var $n=F(Yt);if($n<0||$n%He)throw pn("Wrong offset!");return $n},$r=function(Yt){if(Fe(Yt)&&ki in Yt)return Yt;throw $e(Yt+" is not a typed array!")},$t=function(Yt,He){if(!(Fe(Yt)&&di in Yt))throw $e("It is not a typed array constructor!");return new Yt(He)},xe=function(Yt,He){return ge(Qe(Yt,Yt[ri]),He)},ge=function(Yt,He){for(var $n=0,ur=He.length,pr=$t(Yt,ur);ur>$n;)pr[$n]=He[$n++];return pr},ke=function(Yt,He,$n){Hn(Yt,He,{get:function(){return this._d[$n]}})},Ne=function(Yt){var He,$n,ur,pr,kr,ui,Ir=Le(Yt),ji=arguments.length,Do=ji>1?arguments[1]:void 0,Bi=Do!==void 0,no=tn(Ir);if(no!=null&&!Ae(no)){for(ui=no.call(Ir),ur=[],He=0;!(kr=ui.next()).done;He++)ur.push(kr.value);Ir=ur}for(Bi&&ji>2&&(Do=M(Do,arguments[2],2)),He=0,$n=ue(Ir.length),pr=$t(this,$n);$n>He;He++)pr[He]=Bi?Do(Ir[He],He):Ir[He];return pr},ot=function(){for(var Yt=0,He=arguments.length,$n=$t(this,He);He>Yt;)$n[Yt]=arguments[Yt++];return $n},xt=!!et&&I(function(){wi.call(new et(1))}),Ht=function(){return wi.apply(xt?Pr.call($r(this)):$r(this),arguments)},yn={copyWithin:function(Yt,He){return Pt.call($r(this),Yt,He,arguments.length>2?arguments[2]:void 0)},every:function(Yt){return ar($r(this),Yt,arguments.length>1?arguments[1]:void 0)},fill:function(Yt){return En.apply($r(this),arguments)},filter:function(Yt){return xe(this,zn($r(this),Yt,arguments.length>1?arguments[1]:void 0))},find:function(Yt){return we($r(this),Yt,arguments.length>1?arguments[1]:void 0)},findIndex:function(Yt){return lr($r(this),Yt,arguments.length>1?arguments[1]:void 0)},forEach:function(Yt){Lt($r(this),Yt,arguments.length>1?arguments[1]:void 0)},indexOf:function(Yt){return Tr($r(this),Yt,arguments.length>1?arguments[1]:void 0)},includes:function(Yt){return Rr($r(this),Yt,arguments.length>1?arguments[1]:void 0)},join:function(Yt){return jn.apply($r(this),arguments)},lastIndexOf:function(Yt){return nn.apply($r(this),arguments)},map:function(Yt){return mo($r(this),Yt,arguments.length>1?arguments[1]:void 0)},reduce:function(Yt){return an.apply($r(this),arguments)},reduceRight:function(Yt){return or.apply($r(this),arguments)},reverse:function(){for(var Yt,He=$r(this).length,$n=Math.floor(He/2),ur=0;ur<$n;)Yt=this[ur],this[ur++]=this[--He],this[He]=Yt;return this},some:function(Yt){return Cn($r(this),Yt,arguments.length>1?arguments[1]:void 0)},sort:function(Yt){return Fr.call($r(this),Yt)},subarray:function(Yt,He){var $n=$r(this),ur=$n.length,pr=J(Yt,ur);return new(Qe($n,$n[ri]))($n.buffer,$n.byteOffset+pr*$n.BYTES_PER_ELEMENT,ue((He===void 0?ur:J(He,ur))-pr))}},dr=function(Yt,He){return xe(this,Pr.call($r(this),Yt,He))},_n=function(Yt){$r(this);var He=Ot(arguments[1],1),$n=this.length,ur=Le(Yt),pr=ue(ur.length),kr=0;if(pr+He>$n)throw pn("Wrong length!");for(;kr<pr;)this[He+kr]=ur[kr++]},In={entries:function(){return hn.call($r(this))},keys:function(){return Gr.call($r(this))},values:function(){return qr.call($r(this))}},Gn=function(Yt,He){return Fe(Yt)&&Yt[ki]&&typeof He!="symbol"&&He in Yt&&String(+He)==String(He)},Nt=function(Yt,He){return Gn(Yt,He=me(He,!0))?$(2,Yt[He]):tr(Yt,He)},Ft=function(Yt,He,$n){return!(Gn(Yt,He=me(He,!0))&&Fe($n)&&pe($n,"value"))||pe($n,"get")||pe($n,"set")||$n.configurable||pe($n,"writable")&&!$n.writable||pe($n,"enumerable")&&!$n.enumerable?Hn(Yt,He,$n):(Yt[He]=$n.value,Yt)};Dr||(Tn.f=Nt,Rt.f=Ft),A(A.S+A.F*!Dr,"Object",{getOwnPropertyDescriptor:Nt,defineProperty:Ft}),I(function(){Br.call({})})&&(Br=wi=function(){return jn.call(this)});var bn=te({},yn);te(bn,In),W(bn,Ai,In.values),te(bn,{slice:dr,set:_n,constructor:function(){},toString:Br,toLocaleString:Ht}),ke(bn,"buffer","b"),ke(bn,"byteOffset","o"),ke(bn,"byteLength","l"),ke(bn,"length","e"),Hn(bn,Jn,{get:function(){return this[ki]}}),j.exports=function(Yt,He,$n,ur){var pr=Yt+((ur=!!ur)?"Clamped":"")+"Array",kr="get"+Yt,ui="set"+Yt,Ir=z[pr],ji=Ir||{},Do=Ir&&Mt(Ir),Bi=!Ir||!X.ABV,no={},$i=Ir&&Ir.prototype,mi=function(ko,Zr){Hn(ko,Zr,{get:function(){return function(Wo,Oo){var So=Wo._d;return So.v[kr](Oo*He+So.o,Gi)}(this,Zr)},set:function(Wo){return function(Oo,So,To){var ds=Oo._d;ur&&(To=(To=Math.round(To))<0?0:To>255?255:255&To),ds.v[ui](So*He+ds.o,To,Gi)}(this,Zr,Wo)},enumerable:!0})};Bi?(Ir=$n(function(ko,Zr,Wo,Oo){V(ko,Ir,pr,"_d");var So,To,ds,As,Cf=0,eo=0;if(Fe(Zr)){if(!(Zr instanceof yt||(As=Oe(Zr))=="ArrayBuffer"||As=="SharedArrayBuffer"))return ki in Zr?ge(Ir,Zr):Ne.call(Ir,Zr);So=Zr,eo=Ot(Wo,He);var bu=Zr.byteLength;if(Oo===void 0){if(bu%He||(To=bu-eo)<0)throw pn("Wrong length!")}else if((To=ue(Oo)*He)+eo>bu)throw pn("Wrong length!");ds=To/He}else ds=se(Zr),So=new yt(To=ds*He);for(W(ko,"_d",{b:So,o:eo,l:To,e:ds,v:new Dt(So)});Cf<ds;)mi(ko,Cf++)}),$i=Ir.prototype=ft(bn),W($i,"constructor",Ir)):I(function(){Ir(1)})&&I(function(){new Ir(-1)})&&Ct(function(ko){new Ir,new Ir(null),new Ir(1.5),new Ir(ko)},!0)||(Ir=$n(function(ko,Zr,Wo,Oo){var So;return V(ko,Ir,pr),Fe(Zr)?Zr instanceof yt||(So=Oe(Zr))=="ArrayBuffer"||So=="SharedArrayBuffer"?Oo!==void 0?new ji(Zr,Ot(Wo,He),Oo):Wo!==void 0?new ji(Zr,Ot(Wo,He)):new ji(Zr):ki in Zr?ge(Ir,Zr):Ne.call(Ir,Zr):new ji(se(Zr))}),Lt(Do!==Function.prototype?Xt(ji).concat(Xt(Do)):Xt(ji),function(ko){ko in Ir||W(Ir,ko,ji[ko])}),Ir.prototype=$i,g||($i.constructor=Ir));var ai=$i[Ai],qn=!!ai&&(ai.name=="values"||ai.name==null),Di=In.values;W(Ir,di,!0),W($i,ki,pr),W($i,Ei,!0),W($i,ri,Ir),(ur?new Ir(1)[Jn]==pr:Jn in $i)||Hn($i,Jn,{get:function(){return pr}}),no[pr]=Ir,A(A.G+A.W+A.F*(Ir!=ji),no),A(A.S,pr,{BYTES_PER_ELEMENT:He}),A(A.S+A.F*I(function(){ji.of.call(Ir,1)}),pr,{from:Ne,of:ot}),"BYTES_PER_ELEMENT"in $i||W($i,"BYTES_PER_ELEMENT",He),A(A.P,pr,yn),Vt(pr),A(A.P+A.F*Ui,pr,{set:_n}),A(A.P+A.F*!qn,pr,In),g||$i.toString==Br||($i.toString=Br),A(A.P+A.F*I(function(){new Ir(1).slice()}),pr,{slice:dr}),A(A.P+A.F*(I(function(){return[1,2].toLocaleString()!=new Ir([1,2]).toLocaleString()})||!I(function(){$i.toLocaleString.call([1,2])})),pr,{toLocaleString:Ht}),on[pr]=qn?ai:Di,g||qn||W($i,Ai,Di)}}else j.exports=function(){}},function(j,m){j.exports=function(o){if(o==null)throw TypeError("Can't call method on  "+o);return o}},function(j,m){var o={}.toString;j.exports=function(g){return o.call(g).slice(8,-1)}},function(j,m,o){(function(g){o.d(m,"a",function(){return Xt}),o.d(m,"b",function(){return tn}),o.d(m,"c",function(){return pe}),o.d(m,"d",function(){return Oe}),o.d(m,"e",function(){return en}),o.d(m,"f",function(){return Wt}),o.d(m,"g",function(){return Ce}),o.d(m,"h",function(){return se});var z=o(1),I=o(582),A=o(176),X=o(44);const K=/^(data:|([A-Za-z]+:)?\/\/)/,M=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,V=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,$="file://";async function W(){Object(z.o)("No file system access.")}async function te(){Object(z.o)("No HTTP fetch method available.")}const F=Ut=>Ut!=null&&Ut==Ut,ue=Ut=>!(Number.isNaN(+Ut)||Ut instanceof Date),se={boolean:z.Ca,integer:z.Ea,number:z.Ea,date:z.Da,string:z.Ga,unknown:z.y},J=[Ut=>Ut==="true"||Ut==="false"||Ut===!0||Ut===!1,Ut=>ue(Ut)&&Number.isInteger(+Ut),ue,Ut=>!Number.isNaN(Date.parse(Ut))],me=["boolean","integer","number","date"];function pe(Ut,Qe){if(!Ut||!Ut.length)return"unknown";const fn=Ut.length,on=J.length,Ct=J.map((Vt,En)=>En+1);for(let Vt,En,Pt=0,Rt=0;Pt<fn;++Pt)for(En=Qe?Ut[Pt][Qe]:Ut[Pt],Vt=0;Vt<on;++Vt)if(Ct[Vt]&&F(En)&&!J[Vt](En)&&(Ct[Vt]=0,++Rt===J.length))return"string";return me[Ct.reduce((Vt,En)=>Vt===0?En:Vt,0)-1]}function Oe(Ut,Qe){return Qe.reduce((fn,on)=>(fn[on]=pe(Ut,on),fn),{})}function Fe(Ut){const Qe=function(fn,on){const Ct={delimiter:Ut};return Le(fn,on?Object(z.p)(on,Ct):Ct)};return Qe.responseType="text",Qe}function Le(Ut,Qe){return Qe.header&&(Ut=Qe.header.map(z.Ba).join(Qe.delimiter)+`
`+Ut),Object(I.a)(Qe.delimiter).parse(Ut+"")}function Ae(Ut,Qe){const fn=Qe&&Qe.property?Object(z.u)(Qe.property):z.y;return Object(z.H)(Ut)&&!function(on){return!(typeof g!="function"||!Object(z.E)(g.isBuffer))&&g.isBuffer(on)}(Ut)?function(on,Ct){return!Object(z.B)(on)&&Object(z.F)(on)&&(on=[...on]),Ct&&Ct.copy?JSON.parse(JSON.stringify(on)):on}(fn(Ut),Qe):fn(JSON.parse(Ut))}Le.responseType="text",Ae.responseType="json";const ft={interior:(Ut,Qe)=>Ut!==Qe,exterior:(Ut,Qe)=>Ut===Qe};function Mt(Ut,Qe){let fn,on,Ct,Vt;return Ut=Ae(Ut,Qe),Qe&&Qe.feature?(fn=A.a,Ct=Qe.feature):Qe&&Qe.mesh?(fn=A.b,Ct=Qe.mesh,Vt=ft[Qe.filter]):Object(z.o)("Missing TopoJSON feature or mesh parameter."),(on=(on=Ut.objects[Ct])?fn(Ut,on,Vt):Object(z.o)("Invalid TopoJSON object: "+Ct))&&on.features||[on]}Mt.responseType="json";const Xt={dsv:Le,csv:Fe(","),tsv:Fe("	"),json:Ae,topojson:Mt};function tn(Ut,Qe){return arguments.length>1?(Xt[Ut]=Qe,this):Object(z.w)(Xt,Ut)?Xt[Ut]:null}function Ce(Ut){const Qe=tn(Ut);return Qe&&Qe.responseType||"text"}function Wt(Ut,Qe,fn,on){const Ct=tn((Qe=Qe||{}).type||"json");return Ct||Object(z.o)("Unknown data format type: "+Qe.type),Ut=Ct(Ut,Qe),Qe.parse&&function(Vt,En,Pt,Rt){if(!Vt.length)return;const Tn=Object(X.e)();Pt=Pt||Tn.timeParse,Rt=Rt||Tn.utcParse;let Hn,tr,pn,$e,et,Ke,yt=Vt.columns||Object.keys(Vt[0]);En==="auto"&&(En=Oe(Vt,yt));const Dt=(yt=Object.keys(En)).map(Lt=>{const zn=En[Lt];let Cn,ar;if(zn&&(zn.startsWith("date:")||zn.startsWith("utc:")))return Cn=zn.split(/:(.+)?/,2),((ar=Cn[1])[0]==="'"&&ar[ar.length-1]==="'"||ar[0]==='"'&&ar[ar.length-1]==='"')&&(ar=ar.slice(1,-1)),(Cn[0]==="utc"?Rt:Pt)(ar);if(!se[zn])throw Error("Illegal format pattern: "+Lt+":"+zn);return se[zn]});for(pn=0,et=Vt.length,Ke=yt.length;pn<et;++pn)for(Hn=Vt[pn],$e=0;$e<Ke;++$e)tr=yt[$e],Hn[tr]=Dt[$e](Hn[tr])}(Ut,Qe.parse,fn,on),Object(z.w)(Ut,"columns")&&delete Ut.columns,Ut}const en=function(Ut,Qe){return fn=>({options:fn||{},sanitize:async function(on,Ct){Ct=Object(z.p)({},this.options,Ct);const Vt=this.fileAccess,En={href:null};let Pt,Rt,Tn;const Hn=M.test(on.replace(V,""));on!=null&&typeof on=="string"&&Hn||Object(z.o)("Sanitize failure, invalid URI: "+Object(z.Ba)(on));const tr=K.test(on);return(Tn=Ct.baseURL)&&!tr&&(on.startsWith("/")||Tn.endsWith("/")||(on="/"+on),on=Tn+on),Rt=(Pt=on.startsWith($))||Ct.mode==="file"||Ct.mode!=="http"&&!tr&&Vt,Pt?on=on.slice($.length):on.startsWith("//")&&(Ct.defaultProtocol==="file"?(on=on.slice(2),Rt=!0):on=(Ct.defaultProtocol||"http")+":"+on),Object.defineProperty(En,"localFile",{value:!!Rt}),En.href=on,Ct.target&&(En.target=Ct.target+""),Ct.rel&&(En.rel=Ct.rel+""),Ct.context==="image"&&Ct.crossOrigin&&(En.crossOrigin=Ct.crossOrigin+""),En},load:async function(on,Ct){const Vt=await this.sanitize(on,Ct),En=Vt.href;return Vt.localFile?this.file(En):this.http(En,Ct)},fileAccess:!!Qe,file:function(on){return on?Ct=>new Promise((Vt,En)=>{on.readFile(Ct,(Pt,Rt)=>{Pt?En(Pt):Vt(Rt)})}):W}(Qe),http:function(on){return on?async function(Ct,Vt){const En=Object(z.p)({},this.options.http,Vt),Pt=Vt&&Vt.response,Rt=await on(Ct,En);return Rt.ok?Object(z.E)(Rt[Pt])?Rt[Pt]():Rt.text():Object(z.o)(Rt.status+""+Rt.statusText)}:te}(Ut)})}(typeof fetch!="undefined"&&fetch,null)}).call(this,o(92).Buffer)},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});const g=o(102),z=o(46),I={prepend:!1};m.subSurface=function(A,X,K={}){const M=z.getDrawArea(A),V=g.css({"& canvas":{display:"block"},marginTop:".5rem",marginBottom:".5rem"}),$=g.css({backgroundColor:"white",display:"inline-block",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",padding:"0 10px 0 10px",marginBottom:"20px",fontWeight:"600",textAlign:"left"}),W=Object.assign({},I,K);let te=M.querySelector(`div[data-name=${X}]`);if(!te){if((te=document.createElement("div")).setAttribute("class",`${V}`),te.dataset.name=X,W.title){const F=document.createElement("div");F.setAttribute("class",`subsurface-title ${$}`),F.innerText=W.title,te.appendChild(F)}W.prepend?M.insertBefore(te,M.firstChild):M.appendChild(te)}return te},m.getDefaultWidth=function(A){let X=0,K=A;for(;K&&K.clientWidth===0;)K=K.parentElement,X=50;return K.clientWidth-X},m.getDefaultHeight=function(A){return A.clientHeight===0?200:A.clientHeight}},function(j,m,o){var g=o(84)("meta"),z=o(13),I=o(43),A=o(26).f,X=0,K=Object.isExtensible||function(){return!0},M=!o(15)(function(){return K(Object.preventExtensions({}))}),V=function(W){A(W,g,{value:{i:"O"+ ++X,w:{}}})},$=j.exports={KEY:g,NEED:!1,fastKey:function(W,te){if(!z(W))return typeof W=="symbol"?W:(typeof W=="string"?"S":"P")+W;if(!I(W,g)){if(!K(W))return"F";if(!te)return"E";V(W)}return W[g].i},getWeak:function(W,te){if(!I(W,g)){if(!K(W))return!0;if(!te)return!1;V(W)}return W[g].w},onFreeze:function(W){return M&&$.NEED&&K(W)&&!I(W,g)&&V(W),W}}},function(j,m,o){var g=o(13);j.exports=function(z,I){if(!g(z))return z;var A,X;if(I&&typeof(A=z.toString)=="function"&&!g(X=A.call(z))||typeof(A=z.valueOf)=="function"&&!g(X=A.call(z))||!I&&typeof(A=z.toString)=="function"&&!g(X=A.call(z)))return X;throw TypeError("Can't convert object to primitive value")}},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),o(0),o(384);const g=o(349),z=o(289),I=o(288),A=o(137),X=o(196),K=o(287),M=o(109),V=o(286),$=o(285),W=o(284),te=o(283),F=o(110),ue=o(282);m.version_vis=ue.version;const se={barchart:g.barchart,table:M.table,histogram:A.histogram,linechart:X.linechart,scatterplot:K.scatterplot,confusionMatrix:z.confusionMatrix,heatmap:I.heatmap};m.render=se;const J={accuracy:F.accuracy,perClassAccuracy:F.perClassAccuracy,confusionMatrix:F.confusionMatrix};m.metrics=J;const me={history:V.history,fitCallbacks:V.fitCallbacks,perClassAccuracy:W.perClassAccuracy,valuesDistribution:te.valuesDistribution,layer:$.layer,modelSummary:$.modelSummary};m.show=me;var pe=o(197);m.visor=pe.visor,function(Oe){for(var Fe in Oe)m.hasOwnProperty(Fe)||(m[Fe]=Oe[Fe])}(o(198))},function(j,m,o){var g=o(31),z=Object(g.a)(function(I){I.setUTCMonth(0,1),I.setUTCHours(0,0,0,0)},function(I,A){I.setUTCFullYear(I.getUTCFullYear()+A)},function(I,A){return A.getUTCFullYear()-I.getUTCFullYear()},function(I){return I.getUTCFullYear()});z.every=function(I){return isFinite(I=Math.floor(I))&&I>0?Object(g.a)(function(A){A.setUTCFullYear(Math.floor(A.getUTCFullYear()/I)*I),A.setUTCMonth(0,1),A.setUTCHours(0,0,0,0)},function(A,X){A.setUTCFullYear(A.getUTCFullYear()+X*I)}):null},m.a=z,z.range},function(j,m,o){var g=o(31),z=o(12),I=Object(g.a)(function(A){A.setTime(A-A.getMilliseconds())},function(A,X){A.setTime(+A+X*z.e)},function(A,X){return(X-A)/z.e},function(A){return A.getUTCSeconds()});m.a=I,I.range},function(j,m,o){var g=o(31),z=Object(g.a)(function(I){I.setMonth(0,1),I.setHours(0,0,0,0)},function(I,A){I.setFullYear(I.getFullYear()+A)},function(I,A){return A.getFullYear()-I.getFullYear()},function(I){return I.getFullYear()});z.every=function(I){return isFinite(I=Math.floor(I))&&I>0?Object(g.a)(function(A){A.setFullYear(Math.floor(A.getFullYear()/I)*I),A.setMonth(0,1),A.setHours(0,0,0,0)},function(A,X){A.setFullYear(A.getFullYear()+X*I)}):null},m.a=z,z.range},function(j,m,o){var g=o(31),z=o(12),I=Object(g.a)(function(A){A.setUTCHours(0,0,0,0)},function(A,X){A.setUTCDate(A.getUTCDate()+X)},function(A,X){return(X-A)/z.a},function(A){return A.getUTCDate()-1});m.a=I,I.range},function(j,m,o){var g=o(31),z=o(12),I=Object(g.a)(A=>A.setHours(0,0,0,0),(A,X)=>A.setDate(A.getDate()+X),(A,X)=>(X-A-(X.getTimezoneOffset()-A.getTimezoneOffset())*z.c)/z.a,A=>A.getDate()-1);m.a=I,I.range},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.Add="Add",m.AddN="AddN",m.Div="Div",m.FusedBatchNorm="FusedBatchNorm",m.SquaredDifference="SquaredDifference",m.Square="Square",m.Transpose="Transpose",m.NonMaxSuppressionV5="NonMaxSuppressionV5",m.BroadcastTo="BroadcastTo",m.OneHot="OneHot",m.Identity="Identity",m.Tile="Tile",m.PadV2="PadV2",m.FromPixels="FromPixels",m.MaxPoolWithArgmax="MaxPoolWithArgmax"},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(33),z=o(378),I=o(21);m.makeTypesMatch=function(A,X){if(A.dtype===X.dtype)return[A,X];var K=z.upcastType(A.dtype,X.dtype);return[A.cast(K),X.cast(K)]},m.assertTypesMatch=function(A,X){I.assert(A.dtype===X.dtype,function(){return"The dtypes of the first("+A.dtype+") and second("+X.dtype+") input must match"})},m.isTensorInList=function(A,X){return X.some(function(K){return K.id===A.id})},m.getTensorsInContainer=function(A){var X=[];return function K(M,V,$){if(M!=null){if(M instanceof g.Tensor)V.push(M);else if(function(ue){return Array.isArray(ue)||typeof ue=="object"}(M)){var W=M;for(var te in W){var F=W[te];$.has(F)||($.add(F),K(F,V,$))}}}}(A,X,new Set),X}},function(j,m){var o,g,z=j.exports={};function I(){throw new Error("setTimeout has not been defined")}function A(){throw new Error("clearTimeout has not been defined")}function X(se){if(o===setTimeout)return setTimeout(se,0);if((o===I||!o)&&setTimeout)return o=setTimeout,setTimeout(se,0);try{return o(se,0)}catch{try{return o.call(null,se,0)}catch{return o.call(this,se,0)}}}(function(){try{o=typeof setTimeout=="function"?setTimeout:I}catch{o=I}try{g=typeof clearTimeout=="function"?clearTimeout:A}catch{g=A}})();var K,M=[],V=!1,$=-1;function W(){V&&K&&(V=!1,K.length?M=K.concat(M):$=-1,M.length&&te())}function te(){if(!V){var se=X(W);V=!0;for(var J=M.length;J;){for(K=M,M=[];++$<J;)K&&K[$].run();$=-1,J=M.length}K=null,V=!1,function(me){if(g===clearTimeout)return clearTimeout(me);if((g===A||!g)&&clearTimeout)return g=clearTimeout,clearTimeout(me);try{g(me)}catch{try{return g.call(null,me)}catch{return g.call(this,me)}}}(se)}}function F(se,J){this.fun=se,this.array=J}function ue(){}z.nextTick=function(se){var J=new Array(arguments.length-1);if(arguments.length>1)for(var me=1;me<arguments.length;me++)J[me-1]=arguments[me];M.push(new F(se,J)),M.length!==1||V||X(te)},F.prototype.run=function(){this.fun.apply(null,this.array)},z.title="browser",z.browser=!0,z.env={},z.argv=[],z.version="",z.versions={},z.on=ue,z.addListener=ue,z.once=ue,z.off=ue,z.removeListener=ue,z.removeAllListeners=ue,z.emit=ue,z.prependListener=ue,z.prependOnceListener=ue,z.listeners=function(se){return[]},z.binding=function(se){throw new Error("process.binding is not supported")},z.cwd=function(){return"/"},z.chdir=function(se){throw new Error("process.chdir is not supported")},z.umask=function(){return 0}},function(j,m,o){var g=o(13);j.exports=function(z,I){if(!g(z)||z._t!==I)throw TypeError("Incompatible receiver, "+I+" required!");return z}},function(j,m,o){var g=o(19)("unscopables"),z=Array.prototype;z[g]==null&&o(42)(z,g,{}),j.exports=function(I){z[g][I]=!0}},function(j,m,o){var g=o(43),z=o(34),I=o(173)("IE_PROTO"),A=Object.prototype;j.exports=Object.getPrototypeOf||function(X){return X=z(X),g(X,I)?X[I]:typeof X.constructor=="function"&&X instanceof X.constructor?X.constructor.prototype:X instanceof Object?A:null}},function(j,m,o){var g=o(238),z=o(172).concat("length","prototype");m.f=Object.getOwnPropertyNames||function(I){return g(I,z)}},function(j,m,o){var g=o(14),z=o(237),I=o(172),A=o(173)("IE_PROTO"),X=function(){},K=function(){var M,V=o(175)("iframe"),$=I.length;for(V.style.display="none",o(171).appendChild(V),V.src="javascript:",(M=V.contentWindow.document).open(),M.write("<script>document.F=Object<\/script>"),M.close(),K=M.F;$--;)delete K.prototype[I[$]];return K()};j.exports=Object.create||function(M,V){var $;return M!==null?(X.prototype=g(M),$=new X,X.prototype=null,$[A]=M):$=K(),V===void 0?$:z($,V)}},function(j,m,o){var g=o(54),z=Math.max,I=Math.min;j.exports=function(A,X){return(A=g(A))<0?z(A+X,0):I(A,X)}},function(j,m,o){var g=o(238),z=o(172);j.exports=Object.keys||function(I){return g(I,z)}},function(j,m){j.exports=!1},function(j,m){var o=0,g=Math.random();j.exports=function(z){return"Symbol(".concat(z===void 0?"":z,")_",(++o+g).toString(36))}},function(j,m){j.exports=function(o,g){return{enumerable:!(1&o),configurable:!(2&o),writable:!(4&o),value:g}}},function(j,m,o){j.exports=function(g,z){z||(z={}),typeof z=="function"&&(z={cmp:z});var I=typeof z.cycles=="boolean"&&z.cycles,A=z.cmp&&function(K){return function(M){return function(V,$){var W={key:V,value:M[V]},te={key:$,value:M[$]};return K(W,te)}}}(z.cmp),X=[];return function K(M){if(M&&M.toJSON&&typeof M.toJSON=="function"&&(M=M.toJSON()),M!==void 0){if(typeof M=="number")return isFinite(M)?""+M:"null";if(typeof M!="object")return JSON.stringify(M);var V,$;if(Array.isArray(M)){for($="[",V=0;V<M.length;V++)V&&($+=","),$+=K(M[V])||"null";return $+"]"}if(M===null)return"null";if(X.indexOf(M)!==-1){if(I)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var W=X.push(M)-1,te=Object.keys(M).sort(A&&A(M));for($="",V=0;V<te.length;V++){var F=te[V],ue=K(M[F]);ue&&($&&($+=","),$+=JSON.stringify(F)+":"+ue)}return X.splice(W,1),"{"+$+"}"}}(g)}},function(j,m,o){m.a=function(g,z){return g<z?-1:g>z?1:g>=z?0:NaN}},function(j,m,o){o.r(m);var g={};o.d(g,"JsonPatchError",function(){return Ut}),o.d(g,"deepClone",function(){return Qe}),o.d(g,"getValueByPointer",function(){return Ct}),o.d(g,"applyOperation",function(){return Vt}),o.d(g,"applyPatch",function(){return En}),o.d(g,"applyReducer",function(){return Pt}),o.d(g,"validator",function(){return Rt}),o.d(g,"validate",function(){return Tn}),o.d(g,"_areEquals",function(){return Hn});var z={};o.d(z,"unobserve",function(){return et}),o.d(z,"observe",function(){return Ke}),o.d(z,"generate",function(){return yt}),o.d(z,"compare",function(){return Lt});var I={};o.d(I,"aggregate",function(){return Tl}),o.d(I,"bin",function(){return Yd}),o.d(I,"collect",function(){return Ec}),o.d(I,"compare",function(){return Sg}),o.d(I,"countpattern",function(){return Jf}),o.d(I,"cross",function(){return $s}),o.d(I,"density",function(){return Nl}),o.d(I,"dotbin",function(){return vl}),o.d(I,"expression",function(){return Rs}),o.d(I,"extent",function(){return Ku}),o.d(I,"facet",function(){return aa}),o.d(I,"field",function(){return ms}),o.d(I,"filter",function(){return la}),o.d(I,"flatten",function(){return xu}),o.d(I,"fold",function(){return Mr}),o.d(I,"formula",function(){return Cc}),o.d(I,"generate",function(){return sc}),o.d(I,"impute",function(){return yd}),o.d(I,"joinaggregate",function(){return uc}),o.d(I,"kde",function(){return bd}),o.d(I,"key",function(){return Xu}),o.d(I,"load",function(){return Nu}),o.d(I,"lookup",function(){return rf}),o.d(I,"multiextent",function(){return Iu}),o.d(I,"multivalues",function(){return $a}),o.d(I,"params",function(){return Wp}),o.d(I,"pivot",function(){return Mh}),o.d(I,"prefacet",function(){return jh}),o.d(I,"project",function(){return _o}),o.d(I,"proxy",function(){return Ki}),o.d(I,"quantile",function(){return Ka}),o.d(I,"relay",function(){return Vp}),o.d(I,"sample",function(){return qp}),o.d(I,"sequence",function(){return Hp}),o.d(I,"sieve",function(){return Qf}),o.d(I,"subflow",function(){return Tt}),o.d(I,"timeunit",function(){return nu}),o.d(I,"tupleindex",function(){return Zf}),o.d(I,"values",function(){return cc}),o.d(I,"window",function(){return cr});var A={};o.d(A,"interpolate",function(){return Qo}),o.d(A,"interpolateArray",function(){return zo}),o.d(A,"interpolateBasis",function(){return yi}),o.d(A,"interpolateBasisClosed",function(){return zr}),o.d(A,"interpolateDate",function(){return Xa}),o.d(A,"interpolateDiscrete",function(){return Ng}),o.d(A,"interpolateHue",function(){return Ul}),o.d(A,"interpolateNumber",function(){return Zi}),o.d(A,"interpolateNumberArray",function(){return Ao}),o.d(A,"interpolateObject",function(){return co}),o.d(A,"interpolateRound",function(){return Wa}),o.d(A,"interpolateString",function(){return ks}),o.d(A,"interpolateTransformCss",function(){return em}),o.d(A,"interpolateTransformSvg",function(){return yv}),o.d(A,"interpolateZoom",function(){return Rg}),o.d(A,"interpolateRgb",function(){return Oi}),o.d(A,"interpolateRgbBasis",function(){return qo}),o.d(A,"interpolateRgbBasisClosed",function(){return Ia}),o.d(A,"interpolateHsl",function(){return Um}),o.d(A,"interpolateHslLong",function(){return jg}),o.d(A,"interpolateLab",function(){return Gh}),o.d(A,"interpolateHcl",function(){return G0}),o.d(A,"interpolateHclLong",function(){return qm}),o.d(A,"interpolateCubehelix",function(){return up}),o.d(A,"interpolateCubehelixLong",function(){return $0}),o.d(A,"piecewise",function(){return ol}),o.d(A,"quantize",function(){return dh});var X={};o.d(X,"bound",function(){return H2}),o.d(X,"identifier",function(){return Jb}),o.d(X,"mark",function(){return $2}),o.d(X,"overlap",function(){return K2}),o.d(X,"render",function(){return ne}),o.d(X,"viewlayout",function(){return pg});var K={};o.d(K,"axisticks",function(){return Qb}),o.d(K,"datajoin",function(){return dS}),o.d(K,"encode",function(){return pS}),o.d(K,"legendentries",function(){return mS}),o.d(K,"linkpath",function(){return hE}),o.d(K,"pie",function(){return dE}),o.d(K,"scale",function(){return wS}),o.d(K,"sortitems",function(){return ES}),o.d(K,"stack",function(){return mE});var M={};o.d(M,"contour",function(){return $E}),o.d(M,"geojson",function(){return YE}),o.d(M,"geopath",function(){return JE}),o.d(M,"geopoint",function(){return QE}),o.d(M,"geoshape",function(){return ZE}),o.d(M,"graticule",function(){return e3}),o.d(M,"heatmap",function(){return t3}),o.d(M,"isocontour",function(){return qE}),o.d(M,"kde2d",function(){return GE}),o.d(M,"projection",function(){return M4});var V={};o.d(V,"force",function(){return s3});var $={};o.d($,"nest",function(){return p3}),o.d($,"pack",function(){return g3}),o.d($,"partition",function(){return y3}),o.d($,"stratify",function(){return b3}),o.d($,"tree",function(){return w3}),o.d($,"treelinks",function(){return k3}),o.d($,"treemap",function(){return E3});var W={};o.d(W,"label",function(){return A3});var te={};o.d(te,"loess",function(){return O3}),o.d(te,"regression",function(){return D3});var F={};o.d(F,"voronoi",function(){return R3});var ue={};o.d(ue,"wordcloud",function(){return j3});var se={};o.d(se,"crossfilter",function(){return B3}),o.d(se,"resolvefilter",function(){return P3});var J={};o.d(J,"Dataflow",function(){return Gn}),o.d(J,"EventStream",function(){return Ui}),o.d(J,"MultiPulse",function(){return Ht}),o.d(J,"Operator",function(){return Ei}),o.d(J,"Parameters",function(){return ri}),o.d(J,"Pulse",function(){return ke}),o.d(J,"Transform",function(){return Ft}),o.d(J,"changeset",function(){return Jn}),o.d(J,"definition",function(){return Yt}),o.d(J,"ingest",function(){return jn}),o.d(J,"isTuple",function(){return nn}),o.d(J,"transform",function(){return He}),o.d(J,"transforms",function(){return bn}),o.d(J,"tupleid",function(){return an}),o.d(J,"interpolate",function(){return td}),o.d(J,"interpolateColors",function(){return ed}),o.d(J,"interpolateRange",function(){return im}),o.d(J,"quantizeInterpolator",function(){return fp}),o.d(J,"scale",function(){return Ra}),o.d(J,"scheme",function(){return dp}),o.d(J,"projection",function(){return VE}),o.d(J,"View",function(){return PT}),o.d(J,"defaultLocale",function(){return Rr.a}),o.d(J,"formatLocale",function(){return Rr.c}),o.d(J,"locale",function(){return Rr.b}),o.d(J,"resetDefaultLocale",function(){return Rr.d}),o.d(J,"timeFormatLocale",function(){return Rr.e}),o.d(J,"expressionFunction",function(){return Hf}),o.d(J,"parse",function(){return E7}),o.d(J,"runtimeContext",function(){return yT}),o.d(J,"codegenExpression",function(){return yP}),o.d(J,"parseExpression",function(){return mP}),o.d(J,"parseSelector",function(){return Sy}),o.d(J,"version",function(){return AP}),o.d(J,"Debug",function(){return we.a}),o.d(J,"Error",function(){return we.b}),o.d(J,"Info",function(){return we.c}),o.d(J,"None",function(){return we.d}),o.d(J,"Warn",function(){return we.e}),o.d(J,"accessor",function(){return we.f}),o.d(J,"accessorFields",function(){return we.g}),o.d(J,"accessorName",function(){return we.h}),o.d(J,"array",function(){return we.i}),o.d(J,"ascending",function(){return we.j}),o.d(J,"clampRange",function(){return we.k}),o.d(J,"compare",function(){return we.l}),o.d(J,"constant",function(){return we.m}),o.d(J,"debounce",function(){return we.n}),o.d(J,"error",function(){return we.o}),o.d(J,"extend",function(){return we.p}),o.d(J,"extent",function(){return we.q}),o.d(J,"extentIndex",function(){return we.r}),o.d(J,"falsy",function(){return we.s}),o.d(J,"fastmap",function(){return we.t}),o.d(J,"field",function(){return we.u}),o.d(J,"flush",function(){return we.v}),o.d(J,"hasOwnProperty",function(){return we.w}),o.d(J,"id",function(){return we.x}),o.d(J,"identity",function(){return we.y}),o.d(J,"inherits",function(){return we.z}),o.d(J,"inrange",function(){return we.A}),o.d(J,"isArray",function(){return we.B}),o.d(J,"isBoolean",function(){return we.C}),o.d(J,"isDate",function(){return we.D}),o.d(J,"isFunction",function(){return we.E}),o.d(J,"isIterable",function(){return we.F}),o.d(J,"isNumber",function(){return we.G}),o.d(J,"isObject",function(){return we.H}),o.d(J,"isRegExp",function(){return we.I}),o.d(J,"isString",function(){return we.J}),o.d(J,"key",function(){return we.K}),o.d(J,"lerp",function(){return we.L}),o.d(J,"logger",function(){return we.M}),o.d(J,"lruCache",function(){return we.N}),o.d(J,"merge",function(){return we.O}),o.d(J,"mergeConfig",function(){return we.P}),o.d(J,"one",function(){return we.Q}),o.d(J,"pad",function(){return we.R}),o.d(J,"panLinear",function(){return we.S}),o.d(J,"panLog",function(){return we.T}),o.d(J,"panPow",function(){return we.U}),o.d(J,"panSymlog",function(){return we.V}),o.d(J,"peek",function(){return we.W}),o.d(J,"quarter",function(){return we.X}),o.d(J,"repeat",function(){return we.Y}),o.d(J,"span",function(){return we.Z}),o.d(J,"splitAccessPath",function(){return we.Aa}),o.d(J,"stringValue",function(){return we.Ba}),o.d(J,"toBoolean",function(){return we.Ca}),o.d(J,"toDate",function(){return we.Da}),o.d(J,"toNumber",function(){return we.Ea}),o.d(J,"toSet",function(){return we.Fa}),o.d(J,"toString",function(){return we.Ga}),o.d(J,"truncate",function(){return we.Ha}),o.d(J,"truthy",function(){return we.Ia}),o.d(J,"utcquarter",function(){return we.Ja}),o.d(J,"visitArray",function(){return we.Ka}),o.d(J,"writeConfig",function(){return we.La}),o.d(J,"zero",function(){return we.Ma}),o.d(J,"zoomLinear",function(){return we.Na}),o.d(J,"zoomLog",function(){return we.Oa}),o.d(J,"zoomPow",function(){return we.Pa}),o.d(J,"zoomSymlog",function(){return we.Qa}),o.d(J,"bandwidthNRD",function(){return mi}),o.d(J,"bin",function(){return ai}),o.d(J,"bootstrapCI",function(){return ko}),o.d(J,"cumulativeLogNormal",function(){return Ql}),o.d(J,"cumulativeNormal",function(){return eo}),o.d(J,"cumulativeUniform",function(){return pl}),o.d(J,"densityLogNormal",function(){return ws}),o.d(J,"densityNormal",function(){return Cf}),o.d(J,"densityUniform",function(){return Zl}),o.d(J,"dotbin",function(){return Zr}),o.d(J,"quantileLogNormal",function(){return Hs}),o.d(J,"quantileNormal",function(){return bu}),o.d(J,"quantileUniform",function(){return ml}),o.d(J,"quantiles",function(){return no}),o.d(J,"quartiles",function(){return $i}),o.d(J,"random",function(){return qn}),o.d(J,"randomInteger",function(){return Oo}),o.d(J,"randomKDE",function(){return kc}),o.d(J,"randomLCG",function(){return Wo}),o.d(J,"randomLogNormal",function(){return Mc}),o.d(J,"randomMixture",function(){return Af}),o.d(J,"randomNormal",function(){return wc}),o.d(J,"randomUniform",function(){return Gc}),o.d(J,"regressionExp",function(){return jc}),o.d(J,"regressionLinear",function(){return Is}),o.d(J,"regressionLoess",function(){return Yc}),o.d(J,"regressionLog",function(){return Ba}),o.d(J,"regressionPoly",function(){return eu}),o.d(J,"regressionPow",function(){return ac}),o.d(J,"regressionQuad",function(){return Xc}),o.d(J,"sampleCurve",function(){return Of}),o.d(J,"sampleLogNormal",function(){return _c}),o.d(J,"sampleNormal",function(){return As}),o.d(J,"sampleUniform",function(){return Gs}),o.d(J,"setRandom",function(){return Di}),o.d(J,"DATE",function(){return hr.a}),o.d(J,"DAY",function(){return hr.b}),o.d(J,"DAYOFYEAR",function(){return hr.c}),o.d(J,"HOURS",function(){return hr.d}),o.d(J,"MILLISECONDS",function(){return hr.e}),o.d(J,"MINUTES",function(){return hr.f}),o.d(J,"MONTH",function(){return hr.g}),o.d(J,"QUARTER",function(){return hr.h}),o.d(J,"SECONDS",function(){return hr.i}),o.d(J,"TIME_UNITS",function(){return hr.j}),o.d(J,"WEEK",function(){return hr.k}),o.d(J,"YEAR",function(){return hr.l}),o.d(J,"dayofyear",function(){return hr.m}),o.d(J,"timeBin",function(){return hr.n}),o.d(J,"timeFloor",function(){return hr.o}),o.d(J,"timeInterval",function(){return hr.p}),o.d(J,"timeOffset",function(){return hr.q}),o.d(J,"timeSequence",function(){return hr.r}),o.d(J,"timeUnitSpecifier",function(){return hr.s}),o.d(J,"timeUnits",function(){return hr.t}),o.d(J,"utcFloor",function(){return hr.u}),o.d(J,"utcInterval",function(){return hr.v}),o.d(J,"utcOffset",function(){return hr.w}),o.d(J,"utcSequence",function(){return hr.x}),o.d(J,"utcdayofyear",function(){return hr.y}),o.d(J,"utcweek",function(){return hr.z}),o.d(J,"week",function(){return hr.A}),o.d(J,"format",function(){return lr.a}),o.d(J,"formats",function(){return lr.b}),o.d(J,"inferType",function(){return lr.c}),o.d(J,"inferTypes",function(){return lr.d}),o.d(J,"loader",function(){return lr.e}),o.d(J,"read",function(){return lr.f}),o.d(J,"responseType",function(){return lr.g}),o.d(J,"typeParsers",function(){return lr.h}),o.d(J,"Bounds",function(){return pu}),o.d(J,"CanvasHandler",function(){return Ge}),o.d(J,"CanvasRenderer",function(){return St}),o.d(J,"Gradient",function(){return Gg}),o.d(J,"GroupItem",function(){return dm}),o.d(J,"Handler",function(){return u}),o.d(J,"Item",function(){return bp}),o.d(J,"Marks",function(){return Oh}),o.d(J,"RenderType",function(){return Ar}),o.d(J,"Renderer",function(){return x}),o.d(J,"ResourceLoader",function(){return ag}),o.d(J,"SVGHandler",function(){return un}),o.d(J,"SVGRenderer",function(){return gt}),o.d(J,"SVGStringRenderer",function(){return Nr}),o.d(J,"Scenegraph",function(){return Zg}),o.d(J,"boundClip",function(){return oa}),o.d(J,"boundContext",function(){return hg}),o.d(J,"boundItem",function(){return _p}),o.d(J,"boundMark",function(){return ld}),o.d(J,"boundStroke",function(){return ad}),o.d(J,"domChild",function(){return Cl}),o.d(J,"domClear",function(){return wf}),o.d(J,"domCreate",function(){return ca}),o.d(J,"domFind",function(){return kv}),o.d(J,"font",function(){return Ch}),o.d(J,"fontFamily",function(){return cd}),o.d(J,"fontSize",function(){return $l}),o.d(J,"intersect",function(){return Kr}),o.d(J,"intersectBoxLine",function(){return Re}),o.d(J,"intersectPath",function(){return q}),o.d(J,"intersectPoint",function(){return ee}),o.d(J,"intersectRule",function(){return _e}),o.d(J,"lineHeight",function(){return Wu}),o.d(J,"markup",function(){return Me}),o.d(J,"multiLineOffset",function(){return vu}),o.d(J,"pathCurves",function(){return Uu}),o.d(J,"pathEqual",function(){return ja}),o.d(J,"pathParse",function(){return mp}),o.d(J,"pathRectangle",function(){return O0}),o.d(J,"pathRender",function(){return vp}),o.d(J,"pathSymbols",function(){return od}),o.d(J,"pathTrail",function(){return bh}),o.d(J,"point",function(){return h}),o.d(J,"renderModule",function(){return Yr}),o.d(J,"resetSVGClipId",function(){return D0}),o.d(J,"resetSVGDefIds",function(){return Qa}),o.d(J,"sceneEqual",function(){return ba}),o.d(J,"sceneFromJSON",function(){return Kl}),o.d(J,"scenePickVisit",function(){return Zn}),o.d(J,"sceneToJSON",function(){return Qg}),o.d(J,"sceneVisit",function(){return Ln}),o.d(J,"sceneZOrder",function(){return Rn}),o.d(J,"serializeXML",function(){return qe}),o.d(J,"textMetrics",function(){return Au});var me={};o.d(me,"invalidSpec",function(){return mL}),o.d(me,"FIT_NON_SINGLE",function(){return gL}),o.d(me,"containerSizeNonSingle",function(){return vL}),o.d(me,"containerSizeNotCompatibleWithAutosize",function(){return yL}),o.d(me,"droppingFit",function(){return bL}),o.d(me,"cannotProjectOnChannelWithoutField",function(){return xL}),o.d(me,"cannotProjectAggregate",function(){return wL}),o.d(me,"nearestNotSupportForContinuous",function(){return kL}),o.d(me,"selectionNotSupported",function(){return _L}),o.d(me,"selectionNotFound",function(){return EL}),o.d(me,"SCALE_BINDINGS_CONTINUOUS",function(){return CL}),o.d(me,"LEGEND_BINDINGS_PROJECT_LENGTH",function(){return AL}),o.d(me,"noSameUnitLookup",function(){return OL}),o.d(me,"noSuchRepeatedValue",function(){return SL}),o.d(me,"columnsNotSupportByRowCol",function(){return DL}),o.d(me,"CONCAT_CANNOT_SHARE_AXIS",function(){return TL}),o.d(me,"unrecognizedParse",function(){return NL}),o.d(me,"differentParse",function(){return IL}),o.d(me,"invalidTransformIgnored",function(){return FL}),o.d(me,"NO_FIELDS_NEEDS_AS",function(){return RL}),o.d(me,"customFormatTypeNotAllowed",function(){return ML}),o.d(me,"encodingOverridden",function(){return jL}),o.d(me,"projectionOverridden",function(){return BL}),o.d(me,"REPLACE_ANGLE_WITH_THETA",function(){return PL}),o.d(me,"primitiveChannelDef",function(){return LL}),o.d(me,"invalidFieldType",function(){return zL}),o.d(me,"invalidFieldTypeForCountAggregate",function(){return UL}),o.d(me,"invalidAggregate",function(){return WL}),o.d(me,"missingFieldType",function(){return VL}),o.d(me,"droppingColor",function(){return qL}),o.d(me,"emptyFieldDef",function(){return HL}),o.d(me,"latLongDeprecated",function(){return GL}),o.d(me,"LINE_WITH_VARYING_SIZE",function(){return $L}),o.d(me,"incompatibleChannel",function(){return KL}),o.d(me,"invalidEncodingChannel",function(){return XL}),o.d(me,"facetChannelShouldBeDiscrete",function(){return YL}),o.d(me,"facetChannelDropped",function(){return JL}),o.d(me,"discreteChannelCannotEncode",function(){return QL}),o.d(me,"lineWithRange",function(){return ZL}),o.d(me,"orientOverridden",function(){return ez}),o.d(me,"CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN",function(){return tz}),o.d(me,"RANGE_STEP_DEPRECATED",function(){return nz}),o.d(me,"cannotUseScalePropertyWithNonColor",function(){return rz}),o.d(me,"unaggregateDomainHasNoEffectForRawField",function(){return iz}),o.d(me,"unaggregateDomainWithNonSharedDomainOp",function(){return oz}),o.d(me,"unaggregatedDomainWithLogScale",function(){return az}),o.d(me,"cannotApplySizeToNonOrientedMark",function(){return sz}),o.d(me,"scaleTypeNotWorkWithChannel",function(){return uz}),o.d(me,"scaleTypeNotWorkWithFieldDef",function(){return cz}),o.d(me,"scalePropertyNotWorkWithScaleType",function(){return lz}),o.d(me,"scaleTypeNotWorkWithMark",function(){return fz}),o.d(me,"stepDropped",function(){return hz}),o.d(me,"mergeConflictingProperty",function(){return dz}),o.d(me,"mergeConflictingDomainProperty",function(){return pz}),o.d(me,"independentScaleMeansIndependentGuide",function(){return mz}),o.d(me,"domainSortDropped",function(){return gz}),o.d(me,"MORE_THAN_ONE_SORT",function(){return vz}),o.d(me,"FACETED_INDEPENDENT_DIFFERENT_SOURCES",function(){return yz}),o.d(me,"FACETED_INDEPENDENT_SAME_FIELDS_DIFFERENT_SOURCES",function(){return bz}),o.d(me,"FACETED_INDEPENDENT_SAME_SOURCE",function(){return xz}),o.d(me,"INVALID_CHANNEL_FOR_AXIS",function(){return wz}),o.d(me,"cannotStackRangedMark",function(){return kz}),o.d(me,"cannotStackNonLinearScale",function(){return _z}),o.d(me,"stackNonSummativeAggregate",function(){return Ez}),o.d(me,"invalidTimeUnit",function(){return Cz}),o.d(me,"droppedDay",function(){return Az}),o.d(me,"errorBarCenterAndExtentAreNotNeeded",function(){return Oz}),o.d(me,"errorBarCenterIsUsedWithWrongExtent",function(){return Sz}),o.d(me,"errorBarContinuousAxisHasCustomizedAggregate",function(){return Dz}),o.d(me,"errorBarCenterIsNotNeeded",function(){return Tz}),o.d(me,"errorBand1DNotSupport",function(){return Nz}),o.d(me,"channelRequiredForBinned",function(){return Iz}),o.d(me,"domainRequiredForThresholdScale",function(){return Fz});var pe={};o.d(pe,"compile",function(){return ZV}),o.d(pe,"extractTransforms",function(){return tq}),o.d(pe,"normalize",function(){return u5}),o.d(pe,"version",function(){return nq});var Oe={};o.d(Oe,"dark",function(){return rq}),o.d(Oe,"excel",function(){return iq}),o.d(Oe,"fivethirtyeight",function(){return oq}),o.d(Oe,"ggplot2",function(){return aq}),o.d(Oe,"googlecharts",function(){return fq}),o.d(Oe,"latimes",function(){return sq}),o.d(Oe,"quartz",function(){return uq}),o.d(Oe,"urbaninstitute",function(){return lq}),o.d(Oe,"version",function(){return hq}),o.d(Oe,"vox",function(){return cq});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var Fe=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Le=Object.prototype.hasOwnProperty;function Ae(e,t){return Le.call(e,t)}function ft(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);t=[];for(var r in e)Ae(e,r)&&t.push(r);return t}function Mt(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Xt(e){for(var t,n=0,r=e.length;n<r;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function tn(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Ce(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Wt(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];i!==void 0&&n.push(r+": "+i)}return n.join(`
`)}var en=function(e){function t(n,r,i,s,f){var v=this.constructor,w=e.call(this,Wt(n,{name:r,index:i,operation:s,tree:f}))||this;return w.name=r,w.index=i,w.operation=s,w.tree=f,Object.setPrototypeOf(w,v.prototype),w.message=Wt(n,{name:r,index:i,operation:s,tree:f}),w}return Fe(t,e),t}(Error),Ut=en,Qe=Mt,fn={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=Ct(n,this.path);r&&(r=Mt(r));var i=Vt(n,{op:"remove",path:this.from}).removed;return Vt(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=Ct(n,this.from);return Vt(n,{op:"add",path:this.path,value:Mt(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Hn(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},on={add:function(e,t,n){return Xt(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:fn.move,copy:fn.copy,test:fn.test,_get:fn._get};function Ct(e,t){if(t=="")return e;var n={op:"_get",path:t};return Vt(e,n),n.value}function Vt(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Rt(t,0)),t.path===""){var f={newDocument:e};if(t.op==="add")return f.newDocument=t.value,f;if(t.op==="replace")return f.newDocument=t.value,f.removed=e,f;if(t.op==="move"||t.op==="copy")return f.newDocument=Ct(e,t.from),t.op==="move"&&(f.removed=e),f;if(t.op==="test"){if(f.test=Hn(e,t.value),f.test===!1)throw new Ut("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return f.newDocument=e,f}if(t.op==="remove")return f.removed=e,f.newDocument=null,f;if(t.op==="_get")return t.value=e,f;if(n)throw new Ut("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return f}r||(e=Mt(e));var v=(t.path||"").split("/"),w=e,O=1,N=v.length,L=void 0,Y=void 0,ie=void 0;for(ie=typeof n=="function"?n:Rt;;){if((Y=v[O])&&Y.indexOf("~")!=-1&&(Y=Ce(Y)),i&&Y=="__proto__")throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&L===void 0&&(w[Y]===void 0?L=v.slice(0,O).join("/"):O==N-1&&(L=t.path),L!==void 0&&ie(t,0,e,L)),O++,Array.isArray(w)){if(Y==="-")Y=w.length;else{if(n&&!Xt(Y))throw new Ut("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);Xt(Y)&&(Y=~~Y)}if(O>=N){if(n&&t.op==="add"&&Y>w.length)throw new Ut("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);if((f=on[t.op].call(t,w,Y,e)).test===!1)throw new Ut("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return f}}else if(O>=N){if((f=fn[t.op].call(t,w,Y,e)).test===!1)throw new Ut("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return f}if(w=w[Y],n&&O<N&&(!w||typeof w!="object"))throw new Ut("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}function En(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new Ut("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Mt(e));for(var s=new Array(t.length),f=0,v=t.length;f<v;f++)s[f]=Vt(e,t[f],n,!0,i,f),e=s[f].newDocument;return s.newDocument=e,s}function Pt(e,t,n){var r=Vt(e,t);if(r.test===!1)throw new Ut("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Rt(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new Ut("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!fn[e.op])throw new Ut("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if(typeof e.path!="string")throw new Ut("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Ut('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Ut("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Ut("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&function v(w){if(w===void 0)return!0;if(w){if(Array.isArray(w)){for(var O=0,N=w.length;O<N;O++)if(v(w[O]))return!0}else if(typeof w=="object"){var L=ft(w),Y=L.length;for(O=0;O<Y;O++)if(v(w[L[O]]))return!0}}return!1}(e.value))throw new Ut("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Ut("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new Ut("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var f=Tn([{op:"_get",path:e.from,value:void 0}],n);if(f&&f.name==="OPERATION_PATH_UNRESOLVABLE")throw new Ut("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}function Tn(e,t,n){try{if(!Array.isArray(e))throw new Ut("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)En(Mt(t),Mt(e),n||!0);else{n=n||Rt;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof Ut)return i;throw i}}function Hn(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n,r,i,s=Array.isArray(e),f=Array.isArray(t);if(s&&f){if((r=e.length)!=t.length)return!1;for(n=r;n--!=0;)if(!Hn(e[n],t[n]))return!1;return!0}if(s!=f)return!1;var v=Object.keys(e);if((r=v.length)!==Object.keys(t).length)return!1;for(n=r;n--!=0;)if(!t.hasOwnProperty(v[n]))return!1;for(n=r;n--!=0;)if(!Hn(e[i=v[n]],t[i]))return!1;return!0}return e!=e&&t!=t}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var tr=new WeakMap,pn=function(){return function(e){this.observers=new Map,this.obj=e}}(),$e=function(){return function(e,t){this.callback=e,this.observer=t}}();function et(e,t){t.unobserve()}function Ke(e,t){var n,r=function(v){return tr.get(v)}(e);if(r){var i=function(v,w){return v.observers.get(w)}(r,t);n=i&&i.observer}else r=new pn(e),tr.set(e,r);if(n)return n;if(n={},r.value=Mt(e),t){n.callback=t,n.next=null;var s=function(){yt(n)},f=function(){clearTimeout(n.next),n.next=setTimeout(s)};typeof window!="undefined"&&(window.addEventListener("mouseup",f),window.addEventListener("keyup",f),window.addEventListener("mousedown",f),window.addEventListener("keydown",f),window.addEventListener("change",f))}return n.patches=[],n.object=e,n.unobserve=function(){yt(n),clearTimeout(n.next),function(v,w){v.observers.delete(w.callback)}(r,n),typeof window!="undefined"&&(window.removeEventListener("mouseup",f),window.removeEventListener("keyup",f),window.removeEventListener("mousedown",f),window.removeEventListener("keydown",f),window.removeEventListener("change",f))},r.observers.set(t,new $e(t,n)),n}function yt(e,t){t===void 0&&(t=!1);var n=tr.get(e.object);Dt(n.value,e.object,e.patches,"",t),e.patches.length&&En(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function Dt(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=ft(t),f=ft(e),v=!1,w=f.length-1;w>=0;w--){var O=e[L=f[w]];if(!Ae(t,L)||t[L]===void 0&&O!==void 0&&Array.isArray(t)===!1)Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+tn(L),value:Mt(O)}),n.push({op:"remove",path:r+"/"+tn(L)}),v=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}));else{var N=t[L];typeof O=="object"&&O!=null&&typeof N=="object"&&N!=null&&Array.isArray(O)===Array.isArray(N)?Dt(O,N,n,r+"/"+tn(L),i):O!==N&&(i&&n.push({op:"test",path:r+"/"+tn(L),value:Mt(O)}),n.push({op:"replace",path:r+"/"+tn(L),value:Mt(N)}))}}if(v||s.length!=f.length)for(w=0;w<s.length;w++){var L;Ae(e,L=s[w])||t[L]===void 0||n.push({op:"add",path:r+"/"+tn(L),value:Mt(t[L])})}}}function Lt(e,t,n){n===void 0&&(n=!1);var r=[];return Dt(e,t,r,"",n),r}Object.assign({},g,z,{JsonPatchError:en,deepClone:Mt,escapePathComponent:tn,unescapePathComponent:Ce});var zn=o(133),Cn=o.n(zn),ar=o(179),we=o(1),lr=o(63),Rr=o(44);function Tr(e){const t=e||we.y,n=[],r={};return n.add=i=>{const s=t(i);return r[s]||(r[s]=1,n.push(i)),n},n.remove=i=>{const s=t(i);if(r[s]){r[s]=0;const f=n.indexOf(i);f>=0&&n.splice(f,1)}return n},n}async function qr(e,t){try{await t(e)}catch(n){e.error(n)}}const Gr=Symbol("vega_id");let hn=1;function nn(e){return!(!e||!an(e))}function an(e){return e[Gr]}function or(e,t){return e[Gr]=t,e}function jn(e){const t=e===Object(e)?e:{data:e};return an(t)?t:or(t,hn++)}function Fr(e){return Pr(e,jn({}))}function Pr(e,t){for(const n in e)t[n]=e[n];return t}function Br(e,t){return or(t,an(e))}function wi(e,t){return e?t?(n,r)=>e(n,r)||an(t(n))-an(t(r)):(n,r)=>e(n,r)||an(n)-an(r):null}function Ai(e){return e&&e.constructor===Jn}function Jn(){const e=[],t=[],n=[],r=[],i=[];let s=null,f=!1;return{constructor:Jn,insert(v){const w=Object(we.i)(v),O=w.length;for(let N=0;N<O;++N)e.push(w[N]);return this},remove(v){const w=Object(we.E)(v)?r:t,O=Object(we.i)(v),N=O.length;for(let L=0;L<N;++L)w.push(O[L]);return this},modify(v,w,O){const N={field:w,value:Object(we.m)(O)};return Object(we.E)(v)?(N.filter=v,i.push(N)):(N.tuple=v,n.push(N)),this},encode(v,w){return Object(we.E)(v)?i.push({filter:v,field:w}):n.push({tuple:v,field:w}),this},clean(v){return s=v,this},reflow(){return f=!0,this},pulse(v,w){const O={},N={};let L,Y,ie,fe,ve,Be;for(L=0,Y=w.length;L<Y;++L)O[an(w[L])]=1;for(L=0,Y=t.length;L<Y;++L)O[an(ve=t[L])]=-1;for(L=0,Y=r.length;L<Y;++L)fe=r[L],w.forEach(Ve=>{fe(Ve)&&(O[an(Ve)]=-1)});for(L=0,Y=e.length;L<Y;++L)Be=an(ve=e[L]),O[Be]?O[Be]=1:v.add.push(jn(e[L]));for(L=0,Y=w.length;L<Y;++L)ve=w[L],O[an(ve)]<0&&v.rem.push(ve);function We(Ve,ct,lt){lt?Ve[ct]=lt(Ve):v.encode=ct,f||(N[an(Ve)]=Ve)}for(L=0,Y=n.length;L<Y;++L)ve=(ie=n[L]).tuple,fe=ie.field,(Be=O[an(ve)])>0&&(We(ve,fe,ie.value),v.modifies(fe));for(L=0,Y=i.length;L<Y;++L)ie=i[L],fe=ie.filter,w.forEach(Ve=>{fe(Ve)&&O[an(Ve)]>0&&We(Ve,ie.field,ie.value)}),v.modifies(ie.field);if(f)v.mod=t.length||r.length?w.filter(Ve=>O[an(Ve)]>0):w.slice();else for(Be in N)v.mod.push(N[Be]);return(s||s==null&&(t.length||r.length))&&v.clean(!0),v}}}const di="_:mod:_";function ri(){Object.defineProperty(this,di,{writable:!0,value:{}})}ri.prototype={set(e,t,n,r){const i=this,s=i[e],f=i[di];return t!=null&&t>=0?(s[t]!==n||r)&&(s[t]=n,f[t+":"+e]=-1,f[e]=-1):(s!==n||r)&&(i[e]=n,f[e]=Object(we.B)(n)?1+n.length:-1),i},modified(e,t){const n=this[di];if(!arguments.length){for(const r in n)if(n[r])return!0;return!1}if(Object(we.B)(e)){for(let r=0;r<e.length;++r)if(n[e[r]])return!0;return!1}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[di]={},this}};let Dr=0;const ki=new ri;function Ei(e,t,n,r){this.id=++Dr,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,r)}function mo(e){return function(t){const n=this.flags;return arguments.length===0?!!(n&e):(this.flags=t?n|e:n&~e,this)}}Ei.prototype={targets(){return this._targets||(this._targets=Tr(we.x))},set(e){return this.value!==e?(this.value=e,1):0},skip:mo(1),modified:mo(2),parameters(e,t,n){t=t!==!1;const r=this._argval=this._argval||new ri,i=this._argops=this._argops||[],s=[];let f,v,w,O;const N=(L,Y,ie)=>{ie instanceof Ei?(ie!==this&&(t&&ie.targets().add(this),s.push(ie)),i.push({op:ie,name:L,index:Y})):r.set(L,Y,ie)};for(f in e)if(v=e[f],f==="pulse")Object(we.i)(v).forEach(L=>{L instanceof Ei?L!==this&&(L.targets().add(this),s.push(L)):Object(we.o)("Pulse parameters must be operator instances.")}),this.source=v;else if(Object(we.B)(v))for(r.set(f,-1,Array(w=v.length)),O=0;O<w;++O)N(f,O,v[O]);else N(f,-1,v);return this.marshall().clear(),n&&(i.initonly=!0),s},marshall(e){const t=this._argval||ki,n=this._argops;let r,i,s,f;if(n){const v=n.length;for(i=0;i<v;++i)f=(s=(r=n[i]).op).modified()&&s.stamp===e,t.set(r.name,r.index,s.value,f);if(n.initonly){for(i=0;i<v;++i)(r=n[i]).op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,r;if(e)for(t=0,n=e.length;t<n;++t)(r=e[t].op)._targets&&r._targets.remove(this);this.pulse=null,this.source=null},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),r=t.call(this,n,e);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};let Gi=0;function Ui(e,t,n){this.id=++Gi,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function Ot(e,t,n){return new Ui(e,t,n)}Ui.prototype={_filter:we.Ia,_apply:we.y,targets(){return this._targets||(this._targets=Tr(we.x))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,r=n?n.length:0;for(let i=0;i<r;++i)n[i].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=Ot(e);return this.targets().add(t),t},apply(e){const t=Ot(null,e);return this.targets().add(t),t},merge(){const e=Ot();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter(()=>{const n=Date.now();return n-t>e?(t=n,1):0})},debounce(e){const t=Ot();return this.targets().add(Ot(null,null,Object(we.n)(e,n=>{const r=n.dataflow;t.receive(n),r&&r.run&&r.run()}))),t},between(e,t){let n=!1;return e.targets().add(Ot(null,null,()=>n=!0)),t.targets().add(Ot(null,null,()=>n=!1)),this.filter(()=>n)},detach(){this._filter=we.Ia,this._targets=null}};const $r={skip:!0};function $t(e,t,n,r,i,s){const f=Object(we.p)({},s,$r);let v,w;Object(we.E)(n)||(n=Object(we.m)(n)),r===void 0?v=O=>e.touch(n(O)):Object(we.E)(r)?(w=new Ei(null,r,i,!1),v=O=>{w.evaluate(O);const N=n(O),L=w.value;Ai(L)?e.pulse(N,L,s):e.update(N,L,f)}):v=O=>e.update(n(O),r,f),t.apply(v)}function xe(e,t,n,r,i,s){if(r===void 0)t.targets().add(n);else{const f=s||{},v=new Ei(null,function(w,O){return O=Object(we.E)(O)?O:Object(we.m)(O),w?function(N,L){const Y=O(N,L);return w.skip()||(w.skip(Y!==this.value).value=Y),Y}:O}(n,r),i,!1);v.modified(f.force),v.rank=t.rank,t.targets().add(v),n&&(v.skip(!0),v.value=n.value,v.targets().add(n),e.connect(n,[v]))}}const ge={};function ke(e,t,n){this.dataflow=e,this.stamp=t==null?-1:t,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function Ne(e,t){const n=[];return Object(we.Ka)(e,t,r=>n.push(r)),n}function ot(e,t){const n={};return e.visit(t,r=>{n[an(r)]=1}),r=>n[an(r)]?null:r}function xt(e,t){return e?(n,r)=>e(n,r)&&t(n,r):t}function Ht(e,t,n,r){const i=this,s=n.length;let f=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=r||null,this.pulses=n;for(let v=0;v<s;++v){const w=n[v];if(w.stamp===t){if(w.fields){const O=i.fields||(i.fields={});for(const N in w.fields)O[N]=1}w.changed(i.ADD)&&(f|=i.ADD),w.changed(i.REM)&&(f|=i.REM),w.changed(i.MOD)&&(f|=i.MOD)}}this.changes=f}function yn(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}ke.prototype={StopPropagation:ge,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(e){return new ke(this.dataflow).init(this,e)},clone(){const e=this.fork(7);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(23)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||((e=new ke(this.dataflow).init(this)).add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,!e.fields||64&t||(n.fields=e.fields),1&t?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),2&t?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),4&t?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),32&t?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||7;return 1&t&&this.add.length||2&t&&this.rem.length||4&t&&this.mod.length},reflow(e){if(e)return this.fork(7).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(4,ot(this,1))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return Object(we.B)(e)?e.forEach(n=>t[n]=!0):t[e]=!0,this},modified(e,t){const n=this.fields;return!(!t&&!this.mod.length||!n)&&(arguments.length?Object(we.B)(e)?e.some(r=>n[r]):n[e]:!!n)},filter(e,t){const n=this;return 1&e&&(n.addF=xt(n.addF,t)),2&e&&(n.remF=xt(n.remF,t)),4&e&&(n.modF=xt(n.modF,t)),16&e&&(n.srcF=xt(n.srcF,t)),n},materialize(e){const t=this;return 1&(e=e||7)&&t.addF&&(t.add=Ne(t.add,t.addF),t.addF=null),2&e&&t.remF&&(t.rem=Ne(t.rem,t.remF),t.remF=null),4&e&&t.modF&&(t.mod=Ne(t.mod,t.modF),t.modF=null),16&e&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,r=t;if(16&e)return Object(we.Ka)(n.source,n.srcF,r),n;1&e&&Object(we.Ka)(n.add,n.addF,r),2&e&&Object(we.Ka)(n.rem,n.remF,r),4&e&&Object(we.Ka)(n.mod,n.modF,r);const i=n.source;if(8&e&&i){const s=n.add.length+n.mod.length;s===i.length||(s?Object(we.Ka)(i,ot(n,5),r):Object(we.Ka)(i,n.srcF,r))}return n}},Object(we.z)(Ht,ke,{fork(e){const t=new ke(this.dataflow).init(this,e&this.NO_FIELDS);return e!==void 0&&(e&t.ADD&&this.visit(t.ADD,n=>t.add.push(n)),e&t.REM&&this.visit(t.REM,n=>t.rem.push(n)),e&t.MOD&&this.visit(t.MOD,n=>t.mod.push(n))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?Object(we.B)(e)?e.some(r=>n[r]):n[e]:0},filter(){Object(we.o)("MultiPulse does not support filtering.")},materialize(){Object(we.o)("MultiPulse does not support materialization.")},visit(e,t){const n=this,r=n.pulses,i=r.length;let s=0;if(e&n.SOURCE)for(;s<i;++s)r[s].visit(e,t);else for(;s<i;++s)r[s].stamp===n.stamp&&r[s].visit(e,t);return n}});const dr={skip:!1,force:!1};function _n(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),In(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let r;return t.length?(r=t[0],t[0]=n,function(i,s,f){const v=s,w=i.length,O=i[s];let N,L=1+(s<<1);for(;L<w;)(N=L+1)<w&&f(i[L],i[N])>=0&&(L=N),i[s]=i[L],L=1+((s=L)<<1);i[s]=O,In(i,v,s,f)}(t,0,e)):r=n,r}}}function In(e,t,n,r){let i,s;const f=e[n];for(;n>t&&r(f,i=e[s=n-1>>1])<0;)e[n]=i,n=s;return e[n]=f}function Gn(){this.logger(Object(we.M)()),this.logLevel(we.b),this._clock=0,this._rank=0,this._locale=Object(Rr.a)();try{this._loader=Object(lr.e)()}catch{}this._touched=Tr(we.x),this._input={},this._pulse=null,this._heap=_n((e,t)=>e.qrank-t.qrank),this._postrun=[]}function Nt(e){return function(){return this._log[e].apply(this,arguments)}}function Ft(e,t){Ei.call(this,e,null,t)}Gn.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:Nt("error"),warn:Nt("warn"),info:Nt("info"),debug:Nt("debug"),logLevel:Nt("level"),cleanThreshold:1e4,add:function(e,t,n,r){let i,s=1;return e instanceof Ei?i=e:e&&e.prototype instanceof Ei?i=new e:Object(we.E)(e)?i=new Ei(null,e):(s=0,i=new Ei(e,t)),this.rank(i),s&&(r=n,n=t),n&&this.connect(i,i.parameters(n,r)),this.touch(i),i},connect:function(e,t){const n=e.rank,r=t.length;for(let i=0;i<r;++i)if(n<t[i].rank)return void this.rerank(e)},rank:function(e){e.rank=++this._rank},rerank:function(e){const t=[e];let n,r,i;for(;t.length;)if(this.rank(n=t.pop()),r=n._targets)for(i=r.length;--i>=0;)t.push(n=r[i]),n===e&&Object(we.o)("Cycle detected in dataflow graph.")},pulse:function(e,t,n){this.touch(e,n||dr);const r=new ke(this,this._clock+(this._pulse?0:1)),i=e.pulse&&e.pulse.source||[];return r.target=e,this._input[e.id]=t.pulse(r,i),this},touch:function(e,t){const n=t||dr;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this},update:function(e,t,n){const r=n||dr;return(e.set(t)||r.force)&&this.touch(e,r),this},changeset:Jn,ingest:function(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))},parse:function(e,t){const n=this.locale();return Object(lr.f)(e,t,n.timeParse,n.utcParse)},preload:async function(e,t,n){const r=this,i=r._pending||function(f){let v;const w=new Promise(O=>v=O);return w.requests=0,w.done=()=>{--w.requests==0&&(f._pending=null,v(f))},f._pending=w}(r);i.requests+=1;const s=await r.request(t,n);return r.pulse(e,r.changeset().remove(we.Ia).insert(s.data||[])),i.done(),s},request:async function(e,t){const n=this;let r,i=0;try{r=await n.loader().load(e,{context:"dataflow",response:Object(lr.g)(t&&t.type)});try{r=n.parse(r,t)}catch(s){i=-2,n.warn("Data ingestion failed",e,s)}}catch(s){i=-1,n.warn("Loading failed",e,s)}return{data:r,status:i}},events:function(e,t,n,r){const i=this,s=Ot(n,r),f=function(O){O.dataflow=i;try{s.receive(O)}catch(N){i.error(N)}finally{i.run()}};let v;const w=(v=typeof e=="string"&&typeof document!="undefined"?document.querySelectorAll(e):Object(we.i)(e)).length;for(let O=0;O<w;++O)v[O].addEventListener(t,f);return s},on:function(e,t,n,r,i){return(e instanceof Ei?xe:$t)(this,e,t,n,r,i),this},evaluate:async function(e,t,n){const r=this,i=[];if(r._pulse)return yn(r);if(r._pending&&await r._pending,t&&await qr(r,t),!r._touched.length)return r.debug("Dataflow invoked, but nothing to do."),r;const s=++r._clock;r._pulse=new ke(r,s,e),r._touched.forEach(N=>r._enqueue(N,!0)),r._touched=Tr(we.x);let f,v,w,O=0;try{for(;r._heap.size()>0;)(f=r._heap.pop()).rank===f.qrank?((v=f.run(r._getPulse(f,e))).then?v=await v:v.async&&(i.push(v.async),v=ge),v!==ge&&f._targets&&f._targets.forEach(N=>r._enqueue(N)),++O):r._enqueue(f,!0)}catch(N){r._heap.clear(),w=N}if(r._input={},r._pulse=null,r.debug(`Pulse ${s}: ${O} operators`),w&&(r._postrun=[],r.error(w)),r._postrun.length){const N=r._postrun.sort((L,Y)=>Y.priority-L.priority);r._postrun=[];for(let L=0;L<N.length;++L)await qr(r,N[L].callback)}return n&&await qr(r,n),i.length&&Promise.all(i).then(N=>r.runAsync(null,()=>{N.forEach(L=>{try{L(r)}catch(Y){r.error(Y)}})})),r},run:function(e,t,n){return this._pulse?yn(this):(this.evaluate(e,t,n),this)},runAsync:async function(e,t,n){for(;this._running;)await this._running;const r=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(r,r),this._running},runAfter:function(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(r){this.error(r)}},_enqueue:function(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))},_getPulse:function(e,t){const n=e.source,r=this._clock;return n&&Object(we.B)(n)?new Ht(this,r,n.map(i=>i.pulse),t):this._input[e.id]||function(i,s){return s&&s.stamp===i.stamp?s:(i=i.fork(),s&&s!==ge&&(i.source=s.source),i)}(this._pulse,n&&n.pulse)}},Object(we.z)(Ft,Ei,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),(t=t||e).then?t=t.then(n=>this.pulse=n):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const bn={};function Yt(e){const t=He(e);return t&&t.Definition||null}function He(e){return e=e&&e.toLowerCase(),Object(we.w)(bn,e)?bn[e]:null}var $n=o(87);function ur(e,t){let n;if(t===void 0)for(const r of e)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of e)(i=t(i,++r,e))!=null&&(n<i||n===void 0&&i>=i)&&(n=i)}return n}function pr(e,t){let n;if(t===void 0)for(const r of e)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of e)(i=t(i,++r,e))!=null&&(n>i||n===void 0&&i>=i)&&(n=i)}return n}function kr(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}var ui=function(e){return e===null?NaN:+e};function Ir(e,t,n){if(r=(e=Float64Array.from(function*(v,w){if(w===void 0)for(let O of v)O!=null&&(O=+O)>=O&&(yield O);else{let O=-1;for(let N of v)(N=w(N,++O,v))!=null&&(N=+N)>=N&&(yield N)}}(e,n))).length){if((t=+t)<=0||r<2)return pr(e);if(t>=1)return ur(e);var r,i=(r-1)*t,s=Math.floor(i),f=ur(function v(w,O,N=0,L=w.length-1,Y=$n.a){for(;L>N;){if(L-N>600){const Be=L-N+1,We=O-N+1,Ve=Math.log(Be),ct=.5*Math.exp(2*Ve/3),lt=.5*Math.sqrt(Ve*ct*(Be-ct)/Be)*(We-Be/2<0?-1:1);v(w,O,Math.max(N,Math.floor(O-We*ct/Be+lt)),Math.min(L,Math.floor(O+(Be-We)*ct/Be+lt)),Y)}const ie=w[O];let fe=N,ve=L;for(kr(w,N,O),Y(w[L],ie)>0&&kr(w,N,L);fe<ve;){for(kr(w,fe,ve),++fe,--ve;Y(w[fe],ie)<0;)++fe;for(;Y(w[ve],ie)>0;)--ve}Y(w[N],ie)===0?kr(w,N,ve):kr(w,++ve,L),ve<=O&&(N=ve+1),O<=ve&&(L=ve-1)}return w}(e,s).subarray(0,s+1));return f+(pr(e.subarray(s+1))-f)*(i-s)}}function ji(e,t,n=ui){if(r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,s=Math.floor(i),f=+n(e[s],s,e);return f+(+n(e[s+1],s+1,e)-f)*(i-s)}}var Do=function(e,t){return Ir(e,.5,t)};function*Bi(e,t){if(t==null)for(let n of e)n!=null&&n!==""&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of e)(r=t(r,++n,e))!=null&&r!==""&&(r=+r)>=r&&(yield r)}}function no(e,t,n){const r=Float64Array.from(Bi(e,n));return r.sort($n.a),t.map(i=>ji(r,i))}function $i(e,t){return no(e,[.25,.5,.75],t)}function mi(e,t){const n=e.length,r=function(f,v){const w=function(O,N){let L,Y=0,ie=0,fe=0;if(N===void 0)for(let ve of O)ve!=null&&(ve=+ve)>=ve&&(fe+=(L=ve-ie)*(ve-(ie+=L/++Y)));else{let ve=-1;for(let Be of O)(Be=N(Be,++ve,O))!=null&&(Be=+Be)>=Be&&(fe+=(L=Be-ie)*(Be-(ie+=L/++Y)))}if(Y>1)return fe/(Y-1)}(f,v);return w&&Math.sqrt(w)}(e,t),i=$i(e,t),s=(i[2]-i[0])/1.34;return 1.06*(Math.min(r,s)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)}function ai(e){const t=e.maxbins||20,n=e.base||10,r=Math.log(n),i=e.divide||[5,2];let s,f,v,w,O,N,L=e.extent[0],Y=e.extent[1];const ie=e.span||Y-L||Math.abs(L)||1;if(e.step)s=e.step;else if(e.steps){for(w=ie/t,O=0,N=e.steps.length;O<N&&e.steps[O]<w;++O);s=e.steps[Math.max(0,O-1)]}else{for(f=Math.ceil(Math.log(t)/r),v=e.minstep||0,s=Math.max(v,Math.pow(n,Math.round(Math.log(ie)/r)-f));Math.ceil(ie/s)>t;)s*=n;for(O=0,N=i.length;O<N;++O)(w=s/i[O])>=v&&ie/w<=t&&(s=w)}const fe=(w=Math.log(s))>=0?0:1+~~(-w/r),ve=Math.pow(n,-fe-1);return(e.nice||e.nice===void 0)&&(L=L<(w=Math.floor(L/s+ve)*s)?w-s:w,Y=Math.ceil(Y/s)*s),{start:L,stop:Y===L?L+s:Y,step:s}}var qn=Math.random;function Di(e){qn=e}function ko(e,t,n,r){if(!e.length)return[void 0,void 0];const i=Float64Array.from(Bi(e,r)),s=i.length,f=t;let v,w,O,N;for(O=0,N=Array(f);O<f;++O){for(v=0,w=0;w<s;++w)v+=i[~~(qn()*s)];N[O]=v/s}return N.sort($n.a),[Ir(N,n/2),Ir(N,1-n/2)]}function Zr(e,t,n,r){r=r||(Y=>Y);const i=e.length,s=new Float64Array(i);let f,v=0,w=1,O=r(e[0]),N=O,L=O+t;for(;w<i;++w){if((f=r(e[w]))>=L){for(N=(O+N)/2;v<w;++v)s[v]=N;L=f+t,O=f}N=f}for(N=(O+N)/2;v<w;++v)s[v]=N;return n?function(Y,ie){const fe=Y.length;let ve,Be,We=0,Ve=1;for(;Y[We]===Y[Ve];)++Ve;for(;Ve<fe;){for(ve=Ve+1;Y[Ve]===Y[ve];)++ve;if(Y[Ve]-Y[Ve-1]<ie){for(Be=Ve+(We+ve-Ve-Ve>>1);Be<Ve;)Y[Be++]=Y[Ve];for(;Be>Ve;)Y[Be--]=Y[We]}We=Ve,Ve=ve}return Y}(s,t+t/4):s}function Wo(e){return function(){return(e=(1103515245*e+12345)%2147483647)/2147483647}}function Oo(e,t){let n,r,i;t==null&&(t=e,e=0);const s={min(f){return arguments.length?(i=r-(n=f||0),s):n},max(f){return arguments.length?(i=(r=f||0)-n,s):r},sample:()=>n+Math.floor(i*qn()),pdf:f=>f===Math.floor(f)&&f>=n&&f<r?1/i:0,cdf(f){const v=Math.floor(f);return v<n?0:v>=r?1:(v-n+1)/i},icdf:f=>f>=0&&f<=1?n-1+Math.floor(f*i):NaN};return s.min(e).max(t)}const So=Math.sqrt(2*Math.PI),To=Math.SQRT2;let ds=NaN;function As(e,t){e=e||0,t=t==null?1:t;let n,r,i=0,s=0;if(ds==ds)i=ds,ds=NaN;else{do n=(i=2*qn()-1)*i+(s=2*qn()-1)*s;while(n===0||n>1);i*=r=Math.sqrt(-2*Math.log(n)/n),ds=s*r}return e+i*t}function Cf(e,t,n){n=n==null?1:n;const r=(e-(t||0))/n;return Math.exp(-.5*r*r)/(n*So)}function eo(e,t,n){const r=(e-(t=t||0))/(n=n==null?1:n),i=Math.abs(r);let s;if(i>37)s=0;else{const f=Math.exp(-i*i/2);i<7.07106781186547?(s=f*((((((.0352624965998911*i+.700383064443688)*i+6.37396220353165)*i+33.912866078383)*i+112.079291497871)*i+221.213596169931)*i+220.206867912376),s/=((((((.0883883476483184*i+1.75566716318264)*i+16.064177579207)*i+86.7807322029461)*i+296.564248779674)*i+637.333633378831)*i+793.826512519948)*i+440.413735824752):s=f/(i+1/(i+2/(i+3/(i+4/(i+.65)))))/2.506628274631}return r>0?1-s:s}function bu(e,t,n){return e<0||e>1?NaN:(t||0)+(n==null?1:n)*To*function(r){let i,s=-Math.log((1-r)*(1+r));return s<6.25?i=1.6536545626831027+(i=.24015818242558962+(i=(i=(i=.00018673420803405714+(i=(i=(i=42347877827932404e-23+(i=(i=(i=10512122733215323e-25+(i=(i=(i=26335093153082323e-28+(i=(i=(i=6637638134358324e-30+(i=20972767875968562e-33+(i=(i=11157877678025181e-33+(i=128584807152564e-32+(i=(i=-364441206401782e-35)*(s-=3.125)-16850591381820166e-35)*s)*s)*s-1333171662854621e-31)*s)*s)*s-4054566272975207e-29)*s-8151934197605472e-29)*s)*s-12975133253453532e-27)*s-5415412054294628e-26)*s)*s-4112633980346984e-24)*s-29070369957882005e-24)*s)*s-13654692000834679e-22)*s-13882523362786469e-21)*s)*s-.000740702534166267)*s-.006033670871430149)*s)*s:s<16?(s=Math.sqrt(s)-3.25,i=3.0838856104922208+(i=1.0052589676941592+(i=.005370914553590064+(i=(i=.002491442096107851+(i=(i=.0009532893797373805+(i=(i=24031110387097894e-21+(i=6828485145957318e-20+(i=(i=12475304481671779e-21+(i=29234449089955446e-22+(i=(i=15027403968909828e-22+(i=18239629214389228e-24+(i=(i=9075656193888539e-23+(i=22137376921775787e-25)*s)*s-27517406297064545e-23)*s)*s)*s-4013867526981546e-21)*s)*s)*s-47318229009055734e-21)*s)*s)*s-.0003550375203628475)*s)*s-.0016882755560235047)*s)*s-.003751208507569241)*s)*s)*s):Number.isFinite(s)?(s=Math.sqrt(s)-5,i=4.849906401408584+(i=1.0103004648645344+(i=(i=(i=7599527703001776e-20+(i=(i=4526062597223154e-21+(i=(i=22900482228026655e-23+(i=(i=2914795345090108e-23+(i=(i=761570120807834e-23+(i=(i=15076572693500548e-25+(i=(i=-27109920616438573e-27)*s-2555641816996525e-25)*s)*s-3789465440126737e-24)*s)*s-1496002662714924e-23)*s)*s-6771199775845234e-23)*s)*s-99298272942317e-20)*s)*s-1968177810553167e-20)*s)*s-.00021503011930044477)*s-.00013871931833623122)*s)*s):i=1/0,i*r}(2*e-1)}function wc(e,t){let n,r;const i={mean(s){return arguments.length?(n=s||0,i):n},stdev(s){return arguments.length?(r=s==null?1:s,i):r},sample:()=>As(n,r),pdf:s=>Cf(s,n,r),cdf:s=>eo(s,n,r),icdf:s=>bu(s,n,r)};return i.mean(e).stdev(t)}function kc(e,t){const n=wc();let r=0;const i={data(s){return arguments.length?(e=s,r=s?s.length:0,i.bandwidth(t)):e},bandwidth(s){return arguments.length?(!(t=s)&&e&&(t=mi(e)),i):t},sample:()=>e[~~(qn()*r)]+t*n.sample(),pdf(s){let f=0,v=0;for(;v<r;++v)f+=n.pdf((s-e[v])/t);return f/t/r},cdf(s){let f=0,v=0;for(;v<r;++v)f+=n.cdf((s-e[v])/t);return f/r},icdf(){throw Error("KDE icdf not supported.")}};return i.data(e)}function _c(e,t){return e=e||0,t=t==null?1:t,Math.exp(e+As()*t)}function ws(e,t,n){if(e<=0)return 0;t=t||0,n=n==null?1:n;const r=(Math.log(e)-t)/n;return Math.exp(-.5*r*r)/(n*So*e)}function Ql(e,t,n){return eo(Math.log(e),t,n)}function Hs(e,t,n){return Math.exp(bu(e,t,n))}function Mc(e,t){let n,r;const i={mean(s){return arguments.length?(n=s||0,i):n},stdev(s){return arguments.length?(r=s==null?1:s,i):r},sample:()=>_c(n,r),pdf:s=>ws(s,n,r),cdf:s=>Ql(s,n,r),icdf:s=>Hs(s,n,r)};return i.mean(e).stdev(t)}function Af(e,t){let n,r=0;const i={weights(s){return arguments.length?(n=function(f){const v=[];let w,O=0;for(w=0;w<r;++w)O+=v[w]=f[w]==null?1:+f[w];for(w=0;w<r;++w)v[w]/=O;return v}(t=s||[]),i):t},distributions(s){return arguments.length?(s?(r=s.length,e=s):(r=0,e=[]),i.weights(t)):e},sample(){const s=qn();let f=e[r-1],v=n[0],w=0;for(;w<r-1;v+=n[++w])if(s<v){f=e[w];break}return f.sample()},pdf(s){let f=0,v=0;for(;v<r;++v)f+=n[v]*e[v].pdf(s);return f},cdf(s){let f=0,v=0;for(;v<r;++v)f+=n[v]*e[v].cdf(s);return f},icdf(){throw Error("Mixture icdf not supported.")}};return i.distributions(e).weights(t)}function Gs(e,t){return t==null&&(t=e==null?1:e,e=0),e+(t-e)*qn()}function Zl(e,t,n){return n==null&&(n=t==null?1:t,t=0),e>=t&&e<=n?1/(n-t):0}function pl(e,t,n){return n==null&&(n=t==null?1:t,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function ml(e,t,n){return n==null&&(n=t==null?1:t,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function Gc(e,t){let n,r;const i={min(s){return arguments.length?(n=s||0,i):n},max(s){return arguments.length?(r=s==null?1:s,i):r},sample:()=>Gs(n,r),pdf:s=>Zl(s,n,r),cdf:s=>pl(s,n,r),icdf:s=>ml(s,n,r)};return t==null&&(t=e==null?1:e,e=0),i.min(e).max(t)}function ha(e,t,n,r){const i=r-e*e,s=Math.abs(i)<1e-24?0:(n-e*t)/i;return[t-s*e,s]}function $c(e,t,n,r){e=e.filter(ie=>{let fe=t(ie),ve=n(ie);return fe!=null&&(fe=+fe)>=fe&&ve!=null&&(ve=+ve)>=ve}),r&&e.sort((ie,fe)=>t(ie)-t(fe));const i=e.length,s=new Float64Array(i),f=new Float64Array(i);let v,w,O,N=0,L=0,Y=0;for(O of e)s[N]=v=+t(O),f[N]=w=+n(O),L+=(v-L)/++N,Y+=(w-Y)/N;for(N=0;N<i;++N)s[N]-=L,f[N]-=Y;return[s,f,L,Y]}function Ga(e,t,n,r){let i,s,f=-1;for(const v of e)i=t(v),s=n(v),i!=null&&(i=+i)>=i&&s!=null&&(s=+s)>=s&&r(i,s,++f)}function Kc(e,t,n,r,i){let s=0,f=0;return Ga(e,t,n,(v,w)=>{const O=w-i(v),N=w-r;s+=O*O,f+=N*N}),1-s/f}function Is(e,t,n){let r=0,i=0,s=0,f=0,v=0;Ga(e,t,n,(N,L)=>{r+=(N-r)/++v,i+=(L-i)/v,s+=(N*L-s)/v,f+=(N*N-f)/v});const w=ha(r,i,s,f),O=N=>w[0]+w[1]*N;return{coef:w,predict:O,rSquared:Kc(e,t,n,i,O)}}function Ba(e,t,n){let r=0,i=0,s=0,f=0,v=0;Ga(e,t,n,(N,L)=>{++v,N=Math.log(N),r+=(N-r)/v,i+=(L-i)/v,s+=(N*L-s)/v,f+=(N*N-f)/v});const w=ha(r,i,s,f),O=N=>w[0]+w[1]*Math.log(N);return{coef:w,predict:O,rSquared:Kc(e,t,n,i,O)}}function jc(e,t,n){const[r,i,s,f]=$c(e,t,n);let v,w,O,N=0,L=0,Y=0,ie=0,fe=0;Ga(e,t,n,(Ve,ct)=>{v=r[fe++],w=Math.log(ct),N+=(ct*w-N)/fe,L+=((O=v*ct)-L)/fe,Y+=(O*w-Y)/fe,ie+=(v*O-ie)/fe});const[ve,Be]=ha(L/f,N/f,Y/f,ie/f),We=Ve=>Math.exp(ve+Be*(Ve-s));return{coef:[Math.exp(ve-Be*s),Be],predict:We,rSquared:Kc(e,t,n,f,We)}}function ac(e,t,n){let r=0,i=0,s=0,f=0,v=0,w=0;Ga(e,t,n,(L,Y)=>{const ie=Math.log(L),fe=Math.log(Y);r+=(ie-r)/++w,i+=(fe-i)/w,s+=(ie*fe-s)/w,f+=(ie*ie-f)/w,v+=(Y-v)/w});const O=ha(r,i,s,f),N=L=>O[0]*Math.pow(L,O[1]);return O[0]=Math.exp(O[0]),{coef:O,predict:N,rSquared:Kc(e,t,n,v,N)}}function Xc(e,t,n){const[r,i,s,f]=$c(e,t,n),v=r.length;let w,O,N,L,Y=0,ie=0,fe=0,ve=0,Be=0;for(w=0;w<v;)O=r[w],N=i[w++],Y+=((L=O*O)-Y)/w,ie+=(L*O-ie)/w,fe+=(L*L-fe)/w,ve+=(O*N-ve)/w,Be+=(L*N-Be)/w;const We=fe-Y*Y,Ve=Y*We-ie*ie,ct=(Be*Y-ve*ie)/Ve,lt=(ve*We-Be*ie)/Ve,mt=-ct*Y,dt=kt=>ct*(kt-=s)*kt+lt*kt+mt+f;return{coef:[mt-lt*s+ct*s*s+f,lt-2*ct*s,ct],predict:dt,rSquared:Kc(e,t,n,f,dt)}}function eu(e,t,n,r){if(r===1)return Is(e,t,n);if(r===2)return Xc(e,t,n);const[i,s,f,v]=$c(e,t,n),w=i.length,O=[],N=[],L=r+1;let Y,ie,fe,ve,Be;for(Y=0;Y<L;++Y){for(fe=0,ve=0;fe<w;++fe)ve+=Math.pow(i[fe],Y)*s[fe];for(O.push(ve),Be=new Float64Array(L),ie=0;ie<L;++ie){for(fe=0,ve=0;fe<w;++fe)ve+=Math.pow(i[fe],Y+ie);Be[ie]=ve}N.push(Be)}N.push(O);const We=function(ct){const lt=ct.length-1,mt=[];let dt,kt,wt,dn,Dn;for(dt=0;dt<lt;++dt){for(dn=dt,kt=dt+1;kt<lt;++kt)Math.abs(ct[dt][kt])>Math.abs(ct[dt][dn])&&(dn=kt);for(wt=dt;wt<lt+1;++wt)Dn=ct[wt][dt],ct[wt][dt]=ct[wt][dn],ct[wt][dn]=Dn;for(kt=dt+1;kt<lt;++kt)for(wt=lt;wt>=dt;wt--)ct[wt][kt]-=ct[wt][dt]*ct[dt][kt]/ct[dt][dt]}for(kt=lt-1;kt>=0;--kt){for(Dn=0,wt=kt+1;wt<lt;++wt)Dn+=ct[wt][kt]*mt[wt];mt[kt]=(ct[lt][kt]-Dn)/ct[kt][kt]}return mt}(N),Ve=ct=>{ct-=f;let lt=v+We[0]+We[1]*ct+We[2]*ct*ct;for(Y=3;Y<L;++Y)lt+=We[Y]*Math.pow(ct,Y);return lt};return{coef:function(ct,lt,mt,dt){const kt=Array(ct);let wt,dn,Dn,wn;for(wt=0;wt<ct;++wt)kt[wt]=0;for(wt=ct-1;wt>=0;--wt)for(Dn=lt[wt],wn=1,kt[wt]+=Dn,dn=1;dn<=wt;++dn)wn*=(wt+1-dn)/dn,kt[wt-dn]+=Dn*Math.pow(mt,dn)*wn;return kt[0]+=dt,kt}(L,We,-f,v),predict:Ve,rSquared:Kc(e,t,n,v,Ve)}}const ps=2,ef=1e-12;function Yc(e,t,n,r){const[i,s,f,v]=$c(e,t,n,!0),w=i.length,O=Math.max(2,~~(r*w)),N=new Float64Array(w),L=new Float64Array(w),Y=new Float64Array(w).fill(1);for(let ie=-1;++ie<=ps;){const fe=[0,O-1];for(let Be=0;Be<w;++Be){const We=i[Be],Ve=fe[0],ct=fe[1],lt=We-i[Ve]>i[ct]-We?Ve:ct;let mt=0,dt=0,kt=0,wt=0,dn=0;const Dn=1/Math.abs(i[lt]-We||1);for(let Kn=Ve;Kn<=ct;++Kn){const ir=i[Kn],sr=s[Kn],gr=na(Math.abs(We-ir)*Dn)*Y[Kn],Vr=ir*gr;mt+=gr,dt+=Vr,kt+=sr*gr,wt+=sr*Vr,dn+=ir*Vr}const[wn,Xn]=ha(dt/mt,kt/mt,wt/mt,dn/mt);N[Be]=wn+Xn*We,L[Be]=Math.abs(s[Be]-N[Be]),Xf(i,Be+1,fe)}if(ie===ps)break;const ve=Do(L);if(Math.abs(ve)<ef)break;for(let Be,We,Ve=0;Ve<w;++Ve)Be=L[Ve]/(6*ve),Y[Ve]=Be>=1?ef:(We=1-Be*Be)*We}return function(ie,fe,ve,Be){const We=ie.length,Ve=[];let ct,lt=0,mt=0,dt=[];for(;lt<We;++lt)ct=ie[lt]+ve,dt[0]===ct?dt[1]+=(fe[lt]-dt[1])/++mt:(mt=0,dt[1]+=Be,dt=[ct,fe[lt]],Ve.push(dt));return dt[1]+=Be,Ve}(i,N,f,v)}function na(e){return(e=1-e*e*e)*e*e}function Xf(e,t,n){const r=e[t];let i=n[0],s=n[1]+1;if(!(s>=e.length))for(;t>i&&e[s]-r<=r-e[i];)n[0]=++i,n[1]=s,++s}const Jc=.5*Math.PI/180;function Of(e,t,n,r){n=n||25,r=Math.max(n,r||200);const i=ve=>[ve,e(ve)],s=t[0],f=t[1],v=f-s,w=v/r,O=[i(s)],N=[];if(n===r){for(let ve=1;ve<r;++ve)O.push(i(s+ve/n*v));return O.push(i(f)),O}N.push(i(f));for(let ve=n;--ve>0;)N.push(i(s+ve/n*v));let L=O[0],Y=N[N.length-1];const ie=1/v,fe=function(ve,Be){let We=ve,Ve=ve;const ct=Be.length;for(let lt=0;lt<ct;++lt){const mt=Be[lt][1];mt<We&&(We=mt),mt>Ve&&(Ve=mt)}return 1/(Ve-We)}(L[1],N);for(;Y;){const ve=i((L[0]+Y[0])/2);ve[0]-L[0]>=w&&da(L,ve,Y,ie,fe)>Jc?N.push(ve):(L=Y,O.push(Y),N.pop()),Y=N[N.length-1]}return O}function da(e,t,n,r,i){const s=Math.atan2(i*(n[1]-e[1]),r*(n[0]-e[0])),f=Math.atan2(i*(t[1]-e[1]),r*(t[0]-e[0]));return Math.abs(s-f)}var Qi=function(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((t-e)/n)),s=new Array(i);++r<i;)s[r]=e+r*n;return s},xi=o(108),hr=o(11);function is(e){return e&&e.length?e.length===1?e[0]:function(t){return n=>{const r=t.length;let i=1,s=String(t[0](n));for(;i<r;++i)s+="|"+t[i](n);return s}}(e):function(){return""}}function Nh(e,t,n){return n||e+(t?"_"+t:"")}const No=()=>{},Qc={init:No,add:No,rem:No,idx:0},Yf={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||e.min===void 0)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||e.max===void 0)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},zp=Object.keys(Yf);function tu(e,t){return Yf[e](t)}function Ih(e,t){return e.idx-t.idx}function so(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.init(this))}function Oa(e,t){e!=null&&e!==""?e==e&&(++this.valid,this._ops.forEach(n=>n.add(this,e,t))):++this.missing}function Fh(e,t){e!=null&&e!==""?e==e&&(--this.valid,this._ops.forEach(n=>n.rem(this,e,t))):--this.missing}function Zc(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function Rh(e,t){const n=t||we.y,r=function(f){const v={};f.forEach(O=>v[O.name]=O);const w=O=>{O.req&&O.req.forEach(N=>{v[N]||w(v[N]=Yf[N]())})};return f.forEach(w),Object.values(v).sort(Ih)}(e),i=e.slice().sort(Ih);function s(f){this._ops=r,this._out=i,this.cell=f,this.init()}return s.prototype.init=so,s.prototype.add=Oa,s.prototype.rem=Fh,s.prototype.set=Zc,s.prototype.get=n,s.fields=e.map(f=>f.out),s}function Xd(e){this._key=e?Object(we.u)(e):an,this.reset()}zp.forEach(e=>{Yf[e]=function(t,n){return r=>Object(we.p)({name:t,out:r||t},Qc,n)}(e,Yf[e])});const Tu=Xd.prototype;function Tl(e){Ft.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}Tu.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},Tu.add=function(e){this._add.push(e)},Tu.rem=function(e){this._rem.push(e)},Tu.values=function(){if(this._get=null,this._rem.length===0)return this._add;const e=this._add,t=this._rem,n=this._key,r=e.length,i=t.length,s=Array(r-i),f={};let v,w,O;for(v=0;v<i;++v)f[n(t[v])]=1;for(v=0,w=0;v<r;++v)f[n(O=e[v])]?f[n(O)]=0:s[w++]=O;return this._rem=[],this._add=s},Tu.distinct=function(e){const t=this.values(),n={};let r,i=t.length,s=0;for(;--i>=0;)r=e(t[i])+"",Object(we.w)(n,r)||(n[r]=1,++s);return s},Tu.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=Object(we.r)(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},Tu.argmin=function(e){return this.extent(e)[0]||{}},Tu.argmax=function(e){return this.extent(e)[1]||{}},Tu.min=function(e){const t=this.extent(e)[0];return t!=null?e(t):void 0},Tu.max=function(e){const t=this.extent(e)[1];return t!=null?e(t):void 0},Tu.quartile=function(e){return this._get===e&&this._q||(this._q=$i(this.values(),e),this._get=e),this._q},Tu.q1=function(e){return this.quartile(e)[0]},Tu.q2=function(e){return this.quartile(e)[1]},Tu.q3=function(e){return this.quartile(e)[2]},Tu.ci=function(e){return this._get===e&&this._ci||(this._ci=ko(this.values(),1e3,.05,e),this._get=e),this._ci},Tu.ci0=function(e){return this.ci(e)[0]},Tu.ci1=function(e){return this.ci(e)[1]},Tl.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:zp},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},Object(we.z)(Tl,Ft,{transform(e,t){const n=this,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.modified();return n.stamp=r.stamp,n.value&&(i||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(e):{},t.visit(t.SOURCE,s=>n.add(s))):(n.value=n.value||n.init(e),t.visit(t.REM,s=>n.rem(s)),t.visit(t.ADD,s=>n.add(s))),r.modifies(n._outputs),n._drop=e.drop!==!1,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&r.clean(!0).runAfter(()=>this.clean()),n.changes(r)},cross(){const e=this,t=e.value,n=e._dnames,r=n.map(()=>({})),i=n.length;function s(f){let v,w,O,N;for(v in f)for(O=f[v].tuple,w=0;w<i;++w)r[w][N=O[n[w]]]=N}s(e._prev),s(t),function f(v,w,O){const N=n[O],L=r[O++];for(const Y in L){const ie=v?v+"|"+Y:Y;w[N]=L[Y],O<i?f(ie,w,O):t[ie]||e.cell(ie,w)}}("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],r={};function i(Be){const We=Object(we.i)(Object(we.g)(Be)),Ve=We.length;let ct,lt=0;for(;lt<Ve;++lt)r[ct=We[lt]]||(r[ct]=1,t.push(ct))}this._dims=Object(we.i)(e.groupby),this._dnames=this._dims.map(Be=>{const We=Object(we.h)(Be);return i(Be),n.push(We),We}),this.cellkey=e.key?e.key:is(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const s=e.fields||[null],f=e.ops||["count"],v=e.as||[],w=s.length,O={};let N,L,Y,ie,fe,ve;for(w!==f.length&&Object(we.o)("Unmatched number of fields and aggregate ops."),ve=0;ve<w;++ve)N=s[ve],L=f[ve],N==null&&L!=="count"&&Object(we.o)("Null aggregate field specified."),fe=Nh(L,ie=Object(we.h)(N),v[ve]),n.push(fe),L!=="count"?((Y=O[ie])||(i(N),(Y=O[ie]=[]).field=N,this._measures.push(Y)),L!=="count"&&(this._countOnly=!1),Y.push(tu(L,fe))):this._counts.push(fe);return this._measures=this._measures.map(Be=>Rh(Be,Be.field)),{}},cellkey:is(),cell(e,t){let n=this.value[e];return n?n.num===0&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const r=this._measures,i=r.length;n.agg=Array(i);for(let s=0;s<i;++s)n.agg[s]=new r[s](n)}return n.store&&(n.data=new Xd),n},newtuple(e,t){const n=this._dnames,r=this._dims,i=r.length,s={};for(let f=0;f<i;++f)s[n[f]]=r[f](e);return t?Br(t.tuple,s):jn(s)},clean(){const e=this.value;for(const t in e)e[t].num===0&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const r=n.agg;for(let i=0,s=r.length;i<s;++i)r[i].add(r[i].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const r=n.agg;for(let i=0,s=r.length;i<s;++i)r[i].rem(r[i].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let r=0,i=n.length;r<i;++r)t[n[r]]=e.num;if(!this._countOnly){const r=e.agg;for(let i=0,s=r.length;i<s;++i)r[i].set(t)}return t},changes(e){const t=this._adds,n=this._mods,r=this._prev,i=this._drop,s=e.add,f=e.rem,v=e.mod;let w,O,N,L;if(r)for(O in r)w=r[O],i&&!w.num||f.push(w.tuple);for(N=0,L=this._alen;N<L;++N)s.push(this.celltuple(t[N])),t[N]=null;for(N=0,L=this._mlen;N<L;++N)((w=n[N]).num===0&&i?f:v).push(this.celltuple(w)),n[N]=null;return this._alen=this._mlen=0,this._prev=null,e}});function Yd(e){Ft.call(this,null,e)}function Up(e,t,n){const r=e;let i=t||[],s=n||[],f={},v=0;return{add:w=>s.push(w),remove:w=>f[r(w)]=++v,size:()=>i.length,data:(w,O)=>(v&&(i=i.filter(N=>!f[r(N)]),f={},v=0),O&&w&&i.sort(w),s.length&&(i=w?Object(we.O)(w,i,s.sort(w)):i.concat(s),s=[]),i)}}function Ec(e){Ft.call(this,[],e)}function Sg(e){Ei.call(this,null,el,e)}function el(e){return this.value&&!e.modified()?this.value:Object(we.l)(e.fields,e.orders)}function Jf(e){Ft.call(this,null,e)}function $s(e){Ft.call(this,null,e)}Yd.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},Object(we.z)(Yd,Ft,{transform(e,t){const n=e.interval!==!1,r=this._bins(e),i=r.start,s=r.step,f=e.as||["bin0","bin1"],v=f[0],w=f[1];let O;return O=e.modified()?(t=t.reflow(!0)).SOURCE:t.modified(Object(we.g)(e.field))?t.ADD_MOD:t.ADD,t.visit(O,n?N=>{const L=r(N);N[v]=L,N[w]=L==null?null:i+s*(1+(L-i)/s)}:N=>N[v]=r(N)),t.modifies(n?f:v)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=ai(e),r=n.step;let i,s,f=n.start,v=f+Math.ceil((n.stop-f)/r)*r;(i=e.anchor)!=null&&(s=i-(f+r*Math.floor((i-f)/r)),f+=s,v+=s);const w=function(O){let N=Object(we.Ea)(t(O));return N==null?null:N<f?-1/0:N>v?1/0:(N=Math.max(f,Math.min(N,v-r)),f+r*Math.floor(1e-14+(N-f)/r))};return w.start=f,w.stop=n.stop,w.step=r,this.value=Object(we.f)(w,Object(we.g)(t),e.name||"bin_"+Object(we.h)(t))}}),Ec.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},Object(we.z)(Ec,Ft,{transform(e,t){const n=t.fork(t.ALL),r=Up(an,this.value,n.materialize(n.ADD).add),i=e.sort,s=t.changed()||i&&(e.modified("sort")||t.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(s),this.value=n.source=r.data(wi(i),s),t.source&&t.source.root&&(this.value.root=t.source.root),n}}),Object(we.z)(Sg,Ei),Jf.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},Object(we.z)(Jf,Ft,{transform(e,t){const n=L=>Y=>{for(var ie,fe=function(We,Ve,ct){switch(Ve){case"upper":We=We.toUpperCase();break;case"lower":We=We.toLowerCase()}return We.match(ct)}(v(Y),e.case,s)||[],ve=0,Be=fe.length;ve<Be;++ve)f.test(ie=fe[ve])||L(ie)},r=this._parameterCheck(e,t),i=this._counts,s=this._match,f=this._stop,v=e.field,w=e.as||["text","count"],O=n(L=>i[L]=1+(i[L]||0)),N=n(L=>i[L]-=1);return r?t.visit(t.SOURCE,O):(t.visit(t.ADD,O),t.visit(t.REM,N)),this._finish(t,w)},_parameterCheck(e,t){let n=!1;return!e.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),!e.modified("pattern")&&this._match||(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,r=this._tuples||(this._tuples={}),i=t[0],s=t[1],f=e.fork(e.NO_SOURCE|e.NO_FIELDS);let v,w,O;for(v in n)w=r[v],O=n[v]||0,!w&&O?(r[v]=w=jn({}),w[i]=v,w[s]=O,f.add.push(w)):O===0?(w&&f.rem.push(w),n[v]=null,r[v]=null):w[s]!==O&&(w[s]=O,f.mod.push(w));return f.modifies(t)}}),$s.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},Object(we.z)($s,Ft,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.as||["a","b"],i=r[0],s=r[1],f=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let v=this.value;return f?(v&&(n.rem=v),v=t.materialize(t.SOURCE).source,n.add=this.value=function(w,O,N,L){for(var Y,ie,fe=[],ve={},Be=w.length,We=0;We<Be;++We)for(ve[O]=ie=w[We],Y=0;Y<Be;++Y)ve[N]=w[Y],L(ve)&&(fe.push(jn(ve)),(ve={})[O]=ie);return fe}(v,i,s,e.filter||we.Ia)):n.mod=v,n.source=this.value,n.modifies(r)}});const gl={kde:kc,mixture:Af,normal:wc,lognormal:Mc,uniform:Gc},Ze="distributions",tl="function",es="field";function Nl(e){Ft.call(this,null,e)}const pa=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],Ea={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:pa},{name:"weights",type:"number",array:!0}]};function La(e,t){return e?e.map((n,r)=>t[r]||Object(we.h)(n)):null}function Fs(e,t,n){const r=[],i=L=>L(w);let s,f,v,w,O,N;if(t==null)r.push(e.map(n));else for(s={},f=0,v=e.length;f<v;++f)w=e[f],(N=s[O=t.map(i)])||(s[O]=N=[],N.dims=O,r.push(N)),N.push(n(w));return r}Nl.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:pa.concat(Ea)},{name:"as",type:"string",array:!0,default:["value","density"]}]},Object(we.z)(Nl,Ft,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=function O(N,L){const Y=N[tl];Object(we.w)(gl,Y)||Object(we.o)("Unknown distribution function: "+Y);const ie=gl[Y]();for(const fe in N)fe===es?ie.data((N.from||L()).map(N[fe])):fe===Ze?ie[fe](N[fe].map(ve=>O(ve,L))):typeof ie[fe]===tl&&ie[fe](N[fe]);return ie}(e.distribution,function(O){return()=>O.materialize(O.SOURCE).source}(t)),i=e.steps||e.minsteps||25,s=e.steps||e.maxsteps||200;let f=e.method||"pdf";f!=="pdf"&&f!=="cdf"&&Object(we.o)("Invalid density method: "+f),e.extent||r.data||Object(we.o)("Missing density extent parameter."),f=r[f];const v=e.as||["value","density"],w=Of(f,e.extent||Object(we.q)(r.data()),i,s).map(O=>{const N={};return N[v[0]]=O[0],N[v[1]]=O[1],jn(N)});this.value&&(n.rem=this.value),this.value=n.add=n.source=w}return n}});function vl(e){Ft.call(this,null,e)}vl.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]};function Rs(e){Ei.call(this,null,tf,e),this.modified(!0)}function tf(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:Object(we.f)(n=>t(n,e),Object(we.g)(t),Object(we.h)(t))}function Ku(e){Ft.call(this,[void 0,void 0],e)}function Tt(e,t){Ei.call(this,e),this.parent=t,this.count=0}function aa(e){Ft.call(this,{},e),this._keys=Object(we.t)();const t=this._targets=[];t.active=0,t.forEach=n=>{for(let r=0,i=t.active;r<i;++r)n(t[r],r,t)}}function ms(e){Ei.call(this,null,Ks,e)}function Ks(e){return this.value&&!e.modified()?this.value:Object(we.B)(e.name)?Object(we.i)(e.name).map(t=>Object(we.u)(t)):Object(we.u)(e.name,e.as)}function la(e){Ft.call(this,Object(we.t)(),e)}function xu(e){Ft.call(this,[],e)}function Mr(e){Ft.call(this,[],e)}function Cc(e){Ft.call(this,null,e)}function sc(e){Ft.call(this,[],e)}Object(we.z)(vl,Ft,{transform(e,t){if(this.value&&!e.modified()&&!t.changed())return t;const n=t.materialize(t.SOURCE).source,r=Fs(t.source,e.groupby,we.y),i=e.smooth||!1,s=e.field,f=e.step||((fe,ve)=>Object(we.Z)(Object(we.q)(fe,ve))/30)(n,s),v=wi((fe,ve)=>s(fe)-s(ve)),w=e.as||"bin",O=r.length;let N,L=1/0,Y=-1/0,ie=0;for(;ie<O;++ie){const fe=r[ie].sort(v);N=-1;for(const ve of Zr(fe,f,i,s))ve<L&&(L=ve),ve>Y&&(Y=ve),fe[++N][w]=ve}return this.value={start:L,stop:Y,step:f},t.reflow(!0).modifies(w)}}),Object(we.z)(Rs,Ei),Ku.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},Object(we.z)(Ku,Ft,{transform(e,t){const n=this.value,r=e.field,i=t.changed()||t.modified(r.fields)||e.modified("field");let s=n[0],f=n[1];if((i||s==null)&&(s=1/0,f=-1/0),t.visit(i?t.SOURCE:t.ADD,v=>{const w=Object(we.Ea)(r(v));w!=null&&(w<s&&(s=w),w>f&&(f=w))}),!Number.isFinite(s)||!Number.isFinite(f)){let v=Object(we.h)(r);v&&(v=` for field "${v}"`),t.dataflow.warn(`Infinite extent${v}: [${s}, ${f}]`),s=f=void 0}this.value=[s,f]}}),Object(we.z)(Tt,Ei,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}}),Object(we.z)(aa,Ft,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,r){const i=this.value;let s,f,v=Object(we.w)(i,e)&&i[e];return v?v.value.stamp<n.stamp&&(v.init(n),this.activate(v)):(f=r||(f=this._group[e])&&f.tuple,s=n.dataflow,v=new Tt(n.fork(n.NO_SOURCE),this),s.add(v).connect(t(s,e,f)),i[e]=v,this.activate(v)),v},clean(){const e=this.value;let t=0;for(const n in e)if(e[n].count===0){const r=e[n].detachSubflow;r&&r(),delete e[n],++t}if(t){const n=this._targets.filter(r=>r&&r.count>0);this.initTargets(n)}},initTargets(e){const t=this._targets,n=t.length,r=e?e.length:0;let i=0;for(;i<r;++i)t[i]=e[i];for(;i<n&&t[i]!=null;++i)t[i]=null;t.active=r},transform(e,t){const n=t.dataflow,r=e.key,i=e.subflow,s=this._keys,f=e.modified("key"),v=w=>this.subflow(w,i,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,w=>{const O=an(w),N=s.get(O);N!==void 0&&(s.delete(O),v(N).rem(w))}),t.visit(t.ADD,w=>{const O=r(w);s.set(an(w),O),v(O).add(w)}),f||t.modified(r.fields)?t.visit(t.MOD,w=>{const O=an(w),N=s.get(O),L=r(w);N===L?v(L).mod(w):(s.set(O,L),v(N).rem(w),v(L).add(w))}):t.changed(t.MOD)&&t.visit(t.MOD,w=>{v(s.get(an(w))).mod(w)}),f&&t.visit(t.REFLOW,w=>{const O=an(w),N=s.get(O),L=r(w);N!==L&&(s.set(O,L),v(N).rem(w),v(L).add(w))}),t.clean()?n.runAfter(()=>{this.clean(),s.clean()}):s.empty>n.cleanThreshold&&n.runAfter(s.clean),t}}),Object(we.z)(ms,Ei),la.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},Object(we.z)(la,Ft,{transform(e,t){const n=t.dataflow,r=this.value,i=t.fork(),s=i.add,f=i.rem,v=i.mod,w=e.expr;let O=!0;function N(L){const Y=an(L),ie=w(L,e),fe=r.get(Y);ie&&fe?(r.delete(Y),s.push(L)):ie||fe?O&&ie&&!fe&&v.push(L):(r.set(Y,1),f.push(L))}return t.visit(t.REM,L=>{const Y=an(L);r.has(Y)?r.delete(Y):f.push(L)}),t.visit(t.ADD,L=>{w(L,e)?s.push(L):r.set(an(L),1)}),t.visit(t.MOD,N),e.modified()&&(O=!1,t.visit(t.REFLOW,N)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i}}),xu.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},Object(we.z)(xu,Ft,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=La(r,e.as||[]),s=e.index||null,f=i.length;return n.rem=this.value,t.visit(t.SOURCE,v=>{const w=r.map(fe=>fe(v)),O=w.reduce((fe,ve)=>Math.max(fe,ve.length),0);let N,L,Y,ie=0;for(;ie<O;++ie){for(L=Fr(v),N=0;N<f;++N)L[i[N]]=(Y=w[N][ie])==null?null:Y;s&&(L[s]=ie),n.add.push(L)}}),this.value=n.source=n.add,s&&n.modifies(s),n.modifies(i)}}),Mr.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},Object(we.z)(Mr,Ft,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=r.map(we.h),s=e.as||["key","value"],f=s[0],v=s[1],w=r.length;return n.rem=this.value,t.visit(t.SOURCE,O=>{for(let N,L=0;L<w;++L)(N=Fr(O))[f]=i[L],N[v]=r[L](O),n.add.push(N)}),this.value=n.source=n.add,n.modifies(s)}}),Cc.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},Object(we.z)(Cc,Ft,{transform(e,t){const n=e.expr,r=e.as,i=e.modified(),s=e.initonly?t.ADD:i?t.SOURCE:t.modified(n.fields)||t.modified(r)?t.ADD_MOD:t.ADD;return i&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(r),t.visit(s,f=>f[r]=n(f,e))}}),Object(we.z)(sc,Ft,{transform(e,t){const n=t.fork(t.ALL),r=e.generator;let i,s,f,v=this.value,w=e.size-v.length;if(w>0){for(i=[];--w>=0;)i.push(f=jn(r(e))),v.push(f);n.add=n.add.length?n.materialize(n.ADD).add.concat(i):i}else s=v.slice(0,-w),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(s):s,v=v.slice(-w);return n.source=this.value=v,n}});const nf={value:"value",median:Do,mean:function(e,t){let n=0,r=0;if(t===void 0)for(let i of e)i!=null&&(i=+i)>=i&&(++n,r+=i);else{let i=-1;for(let s of e)(s=t(s,++i,e))!=null&&(s=+s)>=s&&(++n,r+=s)}if(n)return r/n},min:pr,max:ur},Ac=[];function yd(e){Ft.call(this,[],e)}function uc(e){Tl.call(this,e)}function bd(e){Ft.call(this,null,e)}function Xu(e){Ei.call(this,null,Io,e)}function Io(e){return this.value&&!e.modified()?this.value:Object(we.K)(e.fields,e.flat)}function Nu(e){Ft.call(this,[],e),this._pending=null}function Jd(e,t,n){n.forEach(jn);const r=t.fork(t.NO_FIELDS&t.NO_SOURCE);return r.rem=e.value,e.value=r.source=r.add=n,e._pending=null,r.rem.length&&r.clean(!0),r}function rf(e){Ft.call(this,{},e)}function Iu(e){Ei.call(this,null,Ri,e)}function Ri(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let r,i,s=1/0,f=-1/0;for(r=0;r<n;++r)(i=t[r])[0]<s&&(s=i[0]),i[1]>f&&(f=i[1]);return[s,f]}function $a(e){Ei.call(this,null,of,e)}function of(e){return this.value&&!e.modified()?this.value:e.values.reduce((t,n)=>t.concat(n),[])}function Wp(e){Ft.call(this,null,e)}function Mh(e){Tl.call(this,e)}function jh(e){aa.call(this,e)}function _o(e){Ft.call(this,null,e)}function Ki(e){Ft.call(this,null,e)}function Ka(e){Ft.call(this,null,e)}yd.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},Object(we.z)(yd,Ft,{transform(e,t){var n,r,i,s,f,v,w,O,N,L,Y=t.fork(t.ALL),ie=function(dt){var kt,wt=dt.method||nf.value;if(nf[wt]!=null)return wt===nf.value?(kt=dt.value!==void 0?dt.value:0,()=>kt):nf[wt];Object(we.o)("Unrecognized imputation method: "+wt)}(e),fe=function(dt){const kt=dt.field;return wt=>wt?kt(wt):NaN}(e),ve=Object(we.h)(e.field),Be=Object(we.h)(e.key),We=(e.groupby||[]).map(we.h),Ve=function(dt,kt,wt,dn){var Dn,wn,Xn,Kn,ir,sr,gr,Vr,hi=Po=>Po(Vr),Qr=[],Ni=dn?dn.slice():[],ro={},oo={};for(Ni.forEach((Po,ho)=>ro[Po]=ho+1),Kn=0,gr=dt.length;Kn<gr;++Kn)Vr=dt[Kn],sr=wt(Vr),ir=ro[sr]||(ro[sr]=Ni.push(sr)),wn=(Dn=kt?kt.map(hi):Ac)+"",(Xn=oo[wn])||(Xn=oo[wn]=[],Qr.push(Xn),Xn.values=Dn),Xn[ir-1]=Vr;return Qr.domain=Ni,Qr}(t.source,e.groupby,e.key,e.keyvals),ct=[],lt=this.value,mt=Ve.domain.length;for(f=0,O=Ve.length;f<O;++f)for(i=(n=Ve[f]).values,r=NaN,w=0;w<mt;++w)if(n[w]==null){for(s=Ve.domain[w],L={_impute:!0},v=0,N=i.length;v<N;++v)L[We[v]]=i[v];L[Be]=s,L[ve]=Number.isNaN(r)?r=ie(n,fe):r,ct.push(jn(L))}return ct.length&&(Y.add=Y.materialize(Y.ADD).add.concat(ct)),lt.length&&(Y.rem=Y.materialize(Y.REM).rem.concat(lt)),this.value=ct,Y}}),uc.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:zp},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},Object(we.z)(uc,Tl,{transform(e,t){const n=this,r=e.modified();let i;return n.value&&(r||t.modified(n._inputs,!0))?(i=n.value=r?n.init(e):{},t.visit(t.SOURCE,s=>n.add(s))):(i=n.value=n.value||this.init(e),t.visit(t.REM,s=>n.rem(s)),t.visit(t.ADD,s=>n.add(s))),n.changes(),t.visit(t.SOURCE,s=>{Object(we.p)(s,i[n.cellkey(s)].tuple)}),t.reflow(r).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,r;for(n=0,r=this._alen;n<r;++n)this.celltuple(e[n]),e[n]=null;for(n=0,r=this._mlen;n<r;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}}),bd.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},Object(we.z)(bd,Ft,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=Fs(r,e.groupby,e.field),s=(e.groupby||[]).map(we.h),f=e.bandwidth,v=e.cumulative?"cdf":"pdf",w=e.as||["value","density"],O=[];let N=e.extent,L=e.steps||e.minsteps||25,Y=e.steps||e.maxsteps||200;v!=="pdf"&&v!=="cdf"&&Object(we.o)("Invalid density method: "+v),e.resolve==="shared"&&(N||(N=Object(we.q)(r,e.field)),L=Y=e.steps||Y),i.forEach(ie=>{const fe=kc(ie,f)[v],ve=e.counts?ie.length:1;Of(fe,N||Object(we.q)(ie),L,Y).forEach(Be=>{const We={};for(let Ve=0;Ve<s.length;++Ve)We[s[Ve]]=ie.dims[Ve];We[w[0]]=Be[0],We[w[1]]=Be[1]*ve,O.push(jn(We))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=O}return n}}),Object(we.z)(Xu,Ei),Object(we.z)(Nu,Ft,{transform(e,t){const n=t.dataflow;return this._pending?Jd(this,t,this._pending):function(r){return r.modified("async")&&!(r.modified("values")||r.modified("url")||r.modified("format"))}(e)?t.StopPropagation:e.values?Jd(this,t,n.parse(e.values,e.format)):e.async?{async:n.request(e.url,e.format).then(r=>(this._pending=Object(we.i)(r.data),i=>i.touch(this)))}:n.request(e.url,e.format).then(r=>Jd(this,t,Object(we.i)(r.data)))}}),rf.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},Object(we.z)(rf,Ft,{transform(e,t){const n=e.fields,r=e.index,i=e.values,s=e.default==null?null:e.default,f=e.modified(),v=n.length;let w,O,N=f?t.SOURCE:t.ADD,L=t,Y=e.as;return i?(O=i.length,v>1&&!Y&&Object(we.o)('Multi-field lookup requires explicit "as" parameter.'),Y&&Y.length!==v*O&&Object(we.o)('The "as" parameter has too few output field names.'),Y=Y||i.map(we.h),w=function(ie){for(var fe,ve,Be=0,We=0;Be<v;++Be)if((ve=r.get(n[Be](ie)))==null)for(fe=0;fe<O;++fe,++We)ie[Y[We]]=s;else for(fe=0;fe<O;++fe,++We)ie[Y[We]]=i[fe](ve)}):(Y||Object(we.o)("Missing output field names."),w=function(ie){for(var fe,ve=0;ve<v;++ve)fe=r.get(n[ve](ie)),ie[Y[ve]]=fe==null?s:fe}),f?L=t.reflow(!0):N|=n.some(ie=>t.modified(ie.fields))?t.MOD:0,t.visit(N,w),L.modifies(Y)}}),Object(we.z)(Iu,Ei),Object(we.z)($a,Ei),Object(we.z)(Wp,Ft,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),Mh.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:zp,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},Object(we.z)(Mh,Tl,{_transform:Tl.prototype.transform,transform(e,t){return this._transform(function(n,r){const i=n.field,s=n.value,f=(n.op==="count"?"__count__":n.op)||"sum",v=Object(we.g)(i).concat(Object(we.g)(s)),w=function(O,N,L){const Y={},ie=[];return L.visit(L.SOURCE,fe=>{const ve=O(fe);Y[ve]||(Y[ve]=1,ie.push(ve))}),ie.sort(we.j),N?ie.slice(0,N):ie}(i,n.limit||0,r);return r.changed()&&n.set("__pivot__",null,null,!0),{key:n.key,groupby:n.groupby,ops:w.map(()=>f),fields:w.map(O=>function(N,L,Y,ie){return Object(we.f)(fe=>L(fe)===N?Y(fe):NaN,ie,N+"")}(O,i,s,v)),as:w.map(O=>O+""),modified:n.modified.bind(n)}}(e,t),t)}}),Object(we.z)(jh,aa,{transform(e,t){const n=e.subflow,r=e.field,i=s=>this.subflow(an(s),n,t,s);return(e.modified("field")||r&&t.modified(Object(we.g)(r)))&&Object(we.o)("PreFacet does not support field modification."),this.initTargets(),r?(t.visit(t.MOD,s=>{const f=i(s);r(s).forEach(v=>f.mod(v))}),t.visit(t.ADD,s=>{const f=i(s);r(s).forEach(v=>f.add(jn(v)))}),t.visit(t.REM,s=>{const f=i(s);r(s).forEach(v=>f.rem(v))})):(t.visit(t.MOD,s=>i(s).mod(s)),t.visit(t.ADD,s=>i(s).add(s)),t.visit(t.REM,s=>i(s).rem(s))),t.clean()&&t.runAfter(()=>this.clean()),t}}),_o.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},Object(we.z)(_o,Ft,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=La(e.fields,e.as||[]),s=r?(v,w)=>function(O,N,L,Y){for(let ie=0,fe=L.length;ie<fe;++ie)N[Y[ie]]=L[ie](O);return N}(v,w,r,i):Pr;let f;return this.value?f=this.value:(t=t.addAll(),f=this.value={}),t.visit(t.REM,v=>{const w=an(v);n.rem.push(f[w]),f[w]=null}),t.visit(t.ADD,v=>{const w=s(v,jn({}));f[an(v)]=w,n.add.push(w)}),t.visit(t.MOD,v=>{n.mod.push(s(v,f[an(v)]))}),n}}),Object(we.z)(Ki,Ft,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}}),Ka.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};function Vp(e){Ft.call(this,null,e)}function qp(e){Ft.call(this,[],e),this.count=0}function Hp(e){Ft.call(this,null,e)}function Qf(e){Ft.call(this,null,e),this.modified(!0)}function nu(e){Ft.call(this,null,e)}Object(we.z)(Ka,Ft,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const i=Fs(t.materialize(t.SOURCE).source,e.groupby,e.field),s=(e.groupby||[]).map(we.h),f=[],v=e.step||.01,w=e.probs||Qi(v/2,1-1e-14,v),O=w.length;return i.forEach(N=>{const L=no(N,w);for(let Y=0;Y<O;++Y){const ie={};for(let fe=0;fe<s.length;++fe)ie[s[fe]]=N.dims[fe];ie[r[0]]=w[Y],ie[r[1]]=L[Y],f.push(jn(ie))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=f,n}}),Object(we.z)(Vp,Ft,{transform(e,t){let n,r;return this.value?r=this.value:(n=t=t.addAll(),r=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,i=>{const s=an(i);n.rem.push(r[s]),r[s]=null}),t.visit(t.ADD,i=>{const s=Fr(i);r[an(i)]=s,n.add.push(s)}),t.visit(t.MOD,i=>{const s=r[an(i)];for(const f in i)s[f]=i[f],n.modifies(f);n.mod.push(s)})),n}}),qp.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},Object(we.z)(qp,Ft,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.modified("size"),i=e.size,s=this.value.reduce((N,L)=>(N[an(L)]=1,N),{});let f=this.value,v=this.count,w=0;function O(N){let L,Y;f.length<i?f.push(N):(Y=~~((v+1)*qn()))<f.length&&Y>=w&&(L=f[Y],s[an(L)]&&n.rem.push(L),f[Y]=N),++v}if(t.rem.length&&(t.visit(t.REM,N=>{const L=an(N);s[L]&&(s[L]=-1,n.rem.push(N)),--v}),f=f.filter(N=>s[an(N)]!==-1)),(t.rem.length||r)&&f.length<i&&t.source&&(w=v=f.length,t.visit(t.SOURCE,N=>{s[an(N)]||O(N)}),w=-1),r&&f.length>i){const N=f.length-i;for(let L=0;L<N;++L)s[an(f[L])]=-1,n.rem.push(f[L]);f=f.slice(N)}return t.mod.length&&t.visit(t.MOD,N=>{s[an(N)]&&n.mod.push(N)}),t.add.length&&t.visit(t.ADD,O),(t.add.length||w<0)&&(n.add=f.filter(N=>!s[an(N)])),this.count=v,this.value=n.source=f,n}}),Hp.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},Object(we.z)(Hp,Ft,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),r=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=Qi(e.start,e.stop,e.step||1).map(i=>{const s={};return s[r]=i,jn(s)}),n.add=t.add.concat(this.value),n}}),Object(we.z)(Qf,Ft,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});const Fu=["unit0","unit1"];function Zf(e){Ft.call(this,Object(we.t)(),e)}function cc(e){Ft.call(this,null,e)}nu.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:hr.j,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:Fu}]},Object(we.z)(nu,Ft,{transform(e,t){const n=e.field,r=e.interval!==!1,i=e.timezone==="utc",s=this._floor(e,t),f=(i?hr.v:hr.p)(s.unit).offset,v=e.as||Fu,w=v[0],O=v[1],N=s.step;let L=s.start||1/0,Y=s.stop||-1/0,ie=t.ADD;return(e.modified()||t.modified(Object(we.g)(n)))&&(ie=(t=t.reflow(!0)).SOURCE,L=1/0,Y=-1/0),t.visit(ie,fe=>{const ve=n(fe);let Be,We;ve==null?(fe[w]=null,r&&(fe[O]=null)):(fe[w]=Be=We=s(ve),r&&(fe[O]=We=f(Be,N)),Be<L&&(L=Be),We>Y&&(Y=We))}),s.start=L,s.stop=Y,t.modifies(r?v:w)},_floor(e,t){const n=e.timezone==="utc",{units:r,step:i}=e.units?{units:e.units,step:e.step||1}:Object(hr.n)({extent:e.extent||Object(we.q)(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),s=Object(hr.t)(r),f=this.value||{},v=(n?hr.u:hr.o)(s,i);return v.unit=Object(we.W)(s),v.units=s,v.step=i,v.start=f.start,v.stop=f.stop,this.value=v}}),Object(we.z)(Zf,Ft,{transform(e,t){const n=t.dataflow,r=e.field,i=this.value,s=v=>i.set(r(v),v);let f=!0;return e.modified("field")||t.modified(r.fields)?(i.clear(),t.visit(t.SOURCE,s)):t.changed()?(t.visit(t.REM,v=>i.delete(r(v))),t.visit(t.ADD,s)):f=!1,this.modified(f),i.empty>n.cleanThreshold&&n.runAfter(i.clean),t.fork()}}),Object(we.z)(cc,Ft,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(wi(e.sort)):t.source).map(e.field))}});const Bc={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?++e:e}}},percent_rank:function(){const e=Bc.rank(),t=e.next;return{init:e.init,next:n=>(t(n)-1)/(n.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,r=t.compare;let i=t.index;if(e<i){for(;i+1<n.length&&!r(n[i],n[i+1]);)++i;e=i}return(1+e)/n.length}}},ntile:function(e,t){(t=+t)>0||Object(we.o)("ntile num must be greater than zero.");const n=Bc.cume_dist(),r=n.next;return{init:n.init,next:i=>Math.ceil(t*r(i))}},lag:function(e,t){return t=+t||1,{next:n=>{const r=n.index-t;return r>=0?e(n.data[r]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const r=n.index+t,i=n.data;return r<i.length?e(i[r]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return(t=+t)>0||Object(we.o)("nth_value nth must be greater than zero."),{next:n=>{const r=n.i0+(t-1);return r<n.i1?e(n.data[r]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const r=e(n.data[n.index]);return r!=null?t=r:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:r=>{const i=r.data;return r.index<=n?t:(n=function(s,f,v){for(let w=f.length;v<w;++v)if(s(f[v])!=null)return v;return-1}(e,i,r.index))<0?(n=i.length,t=null):t=e(i[n])}}}},Qd=Object.keys(Bc);function wo(e){const t=Object(we.i)(e.ops),n=Object(we.i)(e.fields),r=Object(we.i)(e.params),i=Object(we.i)(e.as),s=this.outputs=[],f=this.windows=[],v={},w={},O=[],N=[];let L=!0;function Y(ie){Object(we.i)(Object(we.g)(ie)).forEach(fe=>v[fe]=1)}Y(e.sort),t.forEach((ie,fe)=>{const ve=n[fe],Be=Object(we.h)(ve),We=Nh(ie,Be,i[fe]);if(Y(ve),s.push(We),Object(we.w)(Bc,ie))f.push(function(Ve,ct,lt,mt){const dt=Bc[Ve](ct,lt);return{init:dt.init||we.Ma,update:function(kt,wt){wt[mt]=dt.next(kt)}}}(ie,n[fe],r[fe],We));else{if(ve==null&&ie!=="count"&&Object(we.o)("Null aggregate field specified."),ie==="count")return void O.push(We);L=!1;let Ve=w[Be];Ve||((Ve=w[Be]=[]).field=ve,N.push(Ve)),Ve.push(tu(ie,We))}}),(O.length||N.length)&&(this.cell=function(ie,fe,ve){ie=ie.map(mt=>Rh(mt,mt.field));const Be={num:0,agg:null,store:!1,count:fe};if(!ve)for(var We=ie.length,Ve=Be.agg=Array(We),ct=0;ct<We;++ct)Ve[ct]=new ie[ct](Be);if(Be.store)var lt=Be.data=new Xd;return Be.add=function(mt){if(Be.num+=1,!ve){lt&&lt.add(mt);for(let dt=0;dt<We;++dt)Ve[dt].add(Ve[dt].get(mt),mt)}},Be.rem=function(mt){if(Be.num-=1,!ve){lt&&lt.rem(mt);for(let dt=0;dt<We;++dt)Ve[dt].rem(Ve[dt].get(mt),mt)}},Be.set=function(mt){let dt,kt;for(lt&&lt.values(),dt=0,kt=fe.length;dt<kt;++dt)mt[fe[dt]]=Be.num;if(!ve)for(dt=0,kt=Ve.length;dt<kt;++dt)Ve[dt].set(mt)},Be.init=function(){Be.num=0,lt&&lt.reset();for(let mt=0;mt<We;++mt)Ve[mt].init()},Be}(N,O,L)),this.inputs=Object.keys(v)}const Il=wo.prototype;function cr(e){Ft.call(this,{},e),this._mlen=0,this._mods=[]}function jr(e,t,n,r){const i=r.sort,s=i&&!r.ignorePeers,f=r.frame||[null,0],v=e.data(n),w=v.length,O=s?Object(xi.a)(i):null,N={i0:0,i1:0,p0:0,p1:0,index:0,data:v,compare:i||Object(we.m)(-1)};t.init();for(let L=0;L<w;++L)Or(N,f,L,w),s&&Mi(N,O),t.update(N,v[L])}function Or(e,t,n,r){e.p0=e.i0,e.p1=e.i1,e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0])),e.i1=t[1]==null?r:Math.min(r,n+Math.abs(t[1])+1),e.index=n}function Mi(e,t){const n=e.i0,r=e.i1-1,i=e.compare,s=e.data,f=s.length-1;n>0&&!i(s[n],s[n-1])&&(e.i0=t.left(s,s[n])),r<f&&!i(s[r],s[r+1])&&(e.i1=t.right(s,s[r]))}function go(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Ca(e){this._context=e}Il.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()},Il.update=function(e,t){const n=this.cell,r=this.windows,i=e.data,s=r&&r.length;let f;if(n){for(f=e.p0;f<e.i0;++f)n.rem(i[f]);for(f=e.p1;f<e.i1;++f)n.add(i[f]);n.set(t)}for(f=0;f<s;++f)r[f].update(e,t)},cr.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Qd.concat(zp)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},Object(we.z)(cr,Ft,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),r=wi(e.sort),i=is(e.groupby),s=v=>this.group(i(v));let f=this.state;f&&!n||(f=this.state=new wo(e)),n||t.modified(f.inputs)?(this.value={},t.visit(t.SOURCE,v=>s(v).add(v))):(t.visit(t.REM,v=>s(v).remove(v)),t.visit(t.ADD,v=>s(v).add(v)));for(let v=0,w=this._mlen;v<w;++v)jr(this._mods[v],f,r,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(f.outputs)},group(e){let t=this.value[e];return t||((t=this.value[e]=Up(an)).stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}}),Ca.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:go(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:go(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};var Eo=function(){};function za(e){this._context=e}za.prototype={areaStart:Eo,areaEnd:Eo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:go(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Sf(e){this._context=e}Sf.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:go(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Zd(e,t){this._basis=new Ca(e),this._beta=t}Zd.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var r,i=e[0],s=t[0],f=e[n]-i,v=t[n]-s,w=-1;++w<=n;)r=w/n,this._basis.point(this._beta*e[w]+(1-this._beta)*(i+r*f),this._beta*t[w]+(1-this._beta)*(s+r*v));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};var Ru=function e(t){function n(r){return t===1?new Ca(r):new Zd(r,t)}return n.beta=function(r){return e(+r)},n}(.85);function Fl(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function Df(e,t){this._context=e,this._k=(1-t)/6}Df.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Fl(this,this._x1,this._y1)}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:Fl(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var af=function e(t){function n(r){return new Df(r,t)}return n.tension=function(r){return e(+r)},n}(0);function Tf(e,t){this._context=e,this._k=(1-t)/6}Tf.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Fl(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var sf=function e(t){function n(r){return new Tf(r,t)}return n.tension=function(r){return e(+r)},n}(0);function ma(e,t){this._context=e,this._k=(1-t)/6}ma.prototype={areaStart:Eo,areaEnd:Eo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Fl(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Dg=function e(t){function n(r){return new ma(r,t)}return n.tension=function(r){return e(+r)},n}(0),eh=Math.abs,Ua=Math.atan2,Ms=Math.cos,Xs=Math.max,Co=Math.min,cu=Math.sin,lc=Math.sqrt,Es=1e-12,uf=Math.PI,Pc=uf/2,Bh=2*uf;function Ph(e){return e>=1?Pc:e<=-1?-Pc:Math.asin(e)}function Rl(e,t,n){var r=e._x1,i=e._y1,s=e._x2,f=e._y2;if(e._l01_a>Es){var v=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,w=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*v-e._x0*e._l12_2a+e._x2*e._l01_2a)/w,i=(i*v-e._y0*e._l12_2a+e._y2*e._l01_2a)/w}if(e._l23_a>Es){var O=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,N=3*e._l23_a*(e._l23_a+e._l12_a);s=(s*O+e._x1*e._l23_2a-t*e._l12_2a)/N,f=(f*O+e._y1*e._l23_2a-n*e._l12_2a)/N}e._context.bezierCurveTo(r,i,s,f,e._x2,e._y2)}function ep(e,t){this._context=e,this._alpha=t}ep.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Rl(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Oc=function e(t){function n(r){return t?new ep(r,t):new Df(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function th(e,t){this._context=e,this._alpha=t}th.prototype={areaStart:Eo,areaEnd:Eo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Rl(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Lh=function e(t){function n(r){return t?new th(r,t):new ma(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function zh(e,t){this._context=e,this._alpha=t}zh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Rl(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var jm=function e(t){function n(r){return t?new zh(r,t):new Tf(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function xd(e){this._context=e}xd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};var Ml=function(e){return new xd(e)};function Uh(e){this._context=e}Uh.prototype={areaStart:Eo,areaEnd:Eo,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function Wh(e){return e<0?-1:1}function Os(e,t,n){var r=e._x1-e._x0,i=t-e._x1,s=(e._y1-e._y0)/(r||i<0&&-0),f=(n-e._y1)/(i||r<0&&-0),v=(s*i+f*r)/(r+i);return(Wh(s)+Wh(f))*Math.min(Math.abs(s),Math.abs(f),.5*Math.abs(v))||0}function nh(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Yu(e,t,n){var r=e._x0,i=e._y0,s=e._x1,f=e._y1,v=(s-r)/3;e._context.bezierCurveTo(r+v,i+v*t,s-v,f-v*n,s,f)}function Vh(e){this._context=e}function Ss(e){this._context=new lu(e)}function lu(e){this._context=e}function Gp(e){this._context=e}function wd(e){var t,n,r=e.length-1,i=new Array(r),s=new Array(r),f=new Array(r);for(i[0]=0,s[0]=2,f[0]=e[0]+2*e[1],t=1;t<r-1;++t)i[t]=1,s[t]=4,f[t]=4*e[t]+2*e[t+1];for(i[r-1]=2,s[r-1]=7,f[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=i[t]/s[t-1],s[t]-=n,f[t]-=n*f[t-1];for(i[r-1]=f[r-1]/s[r-1],t=r-2;t>=0;--t)i[t]=(f[t]-i[t+1])/s[t];for(s[r-1]=(e[r]+i[r-1])/2,t=0;t<r-1;++t)s[t]=2*e[t+1]-i[t+1];return[i,s]}Vh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Yu(this,this._t0,nh(this,this._t0))}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Yu(this,nh(this,n=Os(this,e,t)),n);break;default:Yu(this,this._t0,n=Os(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(Ss.prototype=Object.create(Vh.prototype)).point=function(e,t){Vh.prototype.point.call(this,t,e)},lu.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,s){this._context.bezierCurveTo(t,e,r,n,s,i)}},Gp.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var r=wd(e),i=wd(t),s=0,f=1;f<n;++s,++f)this._context.bezierCurveTo(r[0][s],i[0][s],r[1][s],i[1][s],e[f],t[f]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function rh(e,t){this._context=e,this._t=t}rh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}};const $p=Math.PI,kd=2*$p,ln=kd-1e-6;function Ju(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function er(){return new Ju}Ju.prototype=er.prototype={constructor:Ju,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,s){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+s)},arcTo:function(e,t,n,r,i){e=+e,t=+t,n=+n,r=+r,i=+i;var s=this._x1,f=this._y1,v=n-e,w=r-t,O=s-e,N=f-t,L=O*O+N*N;if(i<0)throw new Error("negative radius: "+i);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(L>1e-6)if(Math.abs(N*v-w*O)>1e-6&&i){var Y=n-s,ie=r-f,fe=v*v+w*w,ve=Y*Y+ie*ie,Be=Math.sqrt(fe),We=Math.sqrt(L),Ve=i*Math.tan(($p-Math.acos((fe+L-ve)/(2*Be*We)))/2),ct=Ve/We,lt=Ve/Be;Math.abs(ct-1)>1e-6&&(this._+="L"+(e+ct*O)+","+(t+ct*N)),this._+="A"+i+","+i+",0,0,"+ +(N*Y>O*ie)+","+(this._x1=e+lt*v)+","+(this._y1=t+lt*w)}else this._+="L"+(this._x1=e)+","+(this._y1=t)},arc:function(e,t,n,r,i,s){e=+e,t=+t,s=!!s;var f=(n=+n)*Math.cos(r),v=n*Math.sin(r),w=e+f,O=t+v,N=1^s,L=s?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);this._x1===null?this._+="M"+w+","+O:(Math.abs(this._x1-w)>1e-6||Math.abs(this._y1-O)>1e-6)&&(this._+="L"+w+","+O),n&&(L<0&&(L=L%kd+kd),L>ln?this._+="A"+n+","+n+",0,1,"+N+","+(e-f)+","+(t-v)+"A"+n+","+n+",0,1,"+N+","+(this._x1=w)+","+(this._y1=O):L>1e-6&&(this._+="A"+n+","+n+",0,"+ +(L>=$p)+","+N+","+(this._x1=e+n*Math.cos(i))+","+(this._y1=t+n*Math.sin(i))))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};var ru=er,Fo=function(e){return function(){return e}};function cf(e){return e.innerRadius}function jl(e){return e.outerRadius}function wr(e){return e.startAngle}function fu(e){return e.endAngle}function Ds(e){return e&&e.padAngle}function Ro(e,t,n,r,i,s,f){var v=e-n,w=t-r,O=(f?s:-s)/lc(v*v+w*w),N=O*w,L=-O*v,Y=e+N,ie=t+L,fe=n+N,ve=r+L,Be=(Y+fe)/2,We=(ie+ve)/2,Ve=fe-Y,ct=ve-ie,lt=Ve*Ve+ct*ct,mt=i-s,dt=Y*ve-fe*ie,kt=(ct<0?-1:1)*lc(Xs(0,mt*mt*lt-dt*dt)),wt=(dt*ct-Ve*kt)/lt,dn=(-dt*Ve-ct*kt)/lt,Dn=(dt*ct+Ve*kt)/lt,wn=(-dt*Ve+ct*kt)/lt,Xn=wt-Be,Kn=dn-We,ir=Dn-Be,sr=wn-We;return Xn*Xn+Kn*Kn>ir*ir+sr*sr&&(wt=Dn,dn=wn),{cx:wt,cy:dn,x01:-N,y01:-L,x11:wt*(i/mt-1),y11:dn*(i/mt-1)}}var yl=function(e){return typeof e=="object"&&"length"in e?e:Array.from(e)};function nl(e){return e[0]}function wu(e){return e[1]}var Bl=function(e,t){var n=Fo(!0),r=null,i=Ml,s=null;function f(v){var w,O,N,L=(v=yl(v)).length,Y=!1;for(r==null&&(s=i(N=ru())),w=0;w<=L;++w)!(w<L&&n(O=v[w],w,v))===Y&&((Y=!Y)?s.lineStart():s.lineEnd()),Y&&s.point(+e(O,w,v),+t(O,w,v));if(N)return s=null,N+""||null}return e=typeof e=="function"?e:e===void 0?nl:Fo(e),t=typeof t=="function"?t:t===void 0?wu:Fo(t),f.x=function(v){return arguments.length?(e=typeof v=="function"?v:Fo(+v),f):e},f.y=function(v){return arguments.length?(t=typeof v=="function"?v:Fo(+v),f):t},f.defined=function(v){return arguments.length?(n=typeof v=="function"?v:Fo(!!v),f):n},f.curve=function(v){return arguments.length?(i=v,r!=null&&(s=i(r)),f):i},f.context=function(v){return arguments.length?(v==null?r=s=null:s=i(r=v),f):r},f},Kt=function(e,t,n){var r=null,i=Fo(!0),s=null,f=Ml,v=null;function w(N){var L,Y,ie,fe,ve,Be=(N=yl(N)).length,We=!1,Ve=new Array(Be),ct=new Array(Be);for(s==null&&(v=f(ve=ru())),L=0;L<=Be;++L){if(!(L<Be&&i(fe=N[L],L,N))===We)if(We=!We)Y=L,v.areaStart(),v.lineStart();else{for(v.lineEnd(),v.lineStart(),ie=L-1;ie>=Y;--ie)v.point(Ve[ie],ct[ie]);v.lineEnd(),v.areaEnd()}We&&(Ve[L]=+e(fe,L,N),ct[L]=+t(fe,L,N),v.point(r?+r(fe,L,N):Ve[L],n?+n(fe,L,N):ct[L]))}if(ve)return v=null,ve+""||null}function O(){return Bl().defined(i).curve(f).context(s)}return e=typeof e=="function"?e:e===void 0?nl:Fo(+e),t=typeof t=="function"?t:Fo(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?wu:Fo(+n),w.x=function(N){return arguments.length?(e=typeof N=="function"?N:Fo(+N),r=null,w):e},w.x0=function(N){return arguments.length?(e=typeof N=="function"?N:Fo(+N),w):e},w.x1=function(N){return arguments.length?(r=N==null?null:typeof N=="function"?N:Fo(+N),w):r},w.y=function(N){return arguments.length?(t=typeof N=="function"?N:Fo(+N),n=null,w):t},w.y0=function(N){return arguments.length?(t=typeof N=="function"?N:Fo(+N),w):t},w.y1=function(N){return arguments.length?(n=N==null?null:typeof N=="function"?N:Fo(+N),w):n},w.lineX0=w.lineY0=function(){return O().x(e).y(t)},w.lineY1=function(){return O().x(e).y(n)},w.lineX1=function(){return O().x(r).y(t)},w.defined=function(N){return arguments.length?(i=typeof N=="function"?N:Fo(!!N),w):i},w.curve=function(N){return arguments.length?(f=N,s!=null&&(v=f(s)),w):f},w.context=function(N){return arguments.length?(N==null?s=v=null:v=f(s=N),w):s},w},fc={draw:function(e,t){var n=Math.sqrt(t/uf);e.moveTo(n,0),e.arc(0,0,n,0,Bh)}};function Mu(e,t){if(typeof document!="undefined"&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}const po=()=>typeof Image!="undefined"?Image:null,uo=Object(xi.a)($n.a),js=uo.right,ju=uo.left;Object(xi.a)(ui).center;var ts=js;function iu(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function bl(e,t){switch(arguments.length){case 0:break;case 1:typeof e=="function"?this.interpolator(e):this.range(e);break;default:this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t)}return this}const Pl=Symbol("implicit");function lf(){var e=new Map,t=[],n=[],r=Pl;function i(s){var f=s+"",v=e.get(f);if(!v){if(r!==Pl)return r;e.set(f,v=t.push(s))}return n[(v-1)%n.length]}return i.domain=function(s){if(!arguments.length)return t.slice();t=[],e=new Map;for(const f of s){const v=f+"";e.has(v)||e.set(v,t.push(f))}return i},i.range=function(s){return arguments.length?(n=Array.from(s),i):n.slice()},i.unknown=function(s){return arguments.length?(r=s,i):r},i.copy=function(){return lf(t,n).unknown(r)},iu.apply(i,arguments),i}var xl=o(45),ih=o(50);function hc(e,t,n,r){var i,s=Object(xl.c)(e,t,n);switch((r=Object(ih.formatSpecifier)(r==null?",f":r)).type){case"s":var f=Math.max(Math.abs(e),Math.abs(t));return r.precision!=null||isNaN(i=Object(ih.precisionPrefix)(s,f))||(r.precision=i),Object(ih.formatPrefix)(r,f);case"":case"e":case"g":case"p":case"r":r.precision!=null||isNaN(i=Object(ih.precisionRound)(s,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-(r.type==="e"));break;case"f":case"%":r.precision!=null||isNaN(i=Object(ih.precisionFixed)(s))||(r.precision=i-2*(r.type==="%"))}return Object(ih.format)(r)}var tp=function(e,t,n){e.prototype=t.prototype=n,n.constructor=e};function oh(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Sc(){}var wl="\\s*([+-]?\\d+)\\s*",kl="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ys="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",np=/^#([0-9a-f]{3,8})$/,_d=new RegExp("^rgb\\("+[wl,wl,wl]+"\\)$"),Ed=new RegExp("^rgb\\("+[Ys,Ys,Ys]+"\\)$"),qh=new RegExp("^rgba\\("+[wl,wl,wl,kl]+"\\)$"),Cd=new RegExp("^rgba\\("+[Ys,Ys,Ys,kl]+"\\)$"),re=new RegExp("^hsl\\("+[kl,Ys,Ys]+"\\)$"),Q=new RegExp("^hsla\\("+[kl,Ys,Ys,kl]+"\\)$"),C={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function R(){return this.rgb().formatHex()}function oe(){return this.rgb().formatRgb()}function Ue(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=np.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Je(t):n===3?new pt(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):n===8?vt(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):n===4?vt(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=_d.exec(e))?new pt(t[1],t[2],t[3],1):(t=Ed.exec(e))?new pt(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=qh.exec(e))?vt(t[1],t[2],t[3],t[4]):(t=Cd.exec(e))?vt(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=re.exec(e))?rr(t[1],t[2]/100,t[3]/100,1):(t=Q.exec(e))?rr(t[1],t[2]/100,t[3]/100,t[4]):C.hasOwnProperty(e)?Je(C[e]):e==="transparent"?new pt(NaN,NaN,NaN,0):null}function Je(e){return new pt(e>>16&255,e>>8&255,255&e,1)}function vt(e,t,n,r){return r<=0&&(e=t=n=NaN),new pt(e,t,n,r)}function qt(e){return e instanceof Sc||(e=Ue(e)),e?new pt((e=e.rgb()).r,e.g,e.b,e.opacity):new pt}function Jt(e,t,n,r){return arguments.length===1?qt(e):new pt(e,t,n,r==null?1:r)}function pt(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Nn(){return"#"+Vn(this.r)+Vn(this.g)+Vn(this.b)}function Pn(){var e=this.opacity;return((e=isNaN(e)?1:Math.max(0,Math.min(1,e)))===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function Vn(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function rr(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new xr(e,t,n,r)}function Yn(e){if(e instanceof xr)return new xr(e.h,e.s,e.l,e.opacity);if(e instanceof Sc||(e=Ue(e)),!e)return new xr;if(e instanceof xr)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),s=Math.max(t,n,r),f=NaN,v=s-i,w=(s+i)/2;return v?(f=t===s?(n-r)/v+6*(n<r):n===s?(r-t)/v+2:(t-n)/v+4,v/=w<.5?s+i:2-s-i,f*=60):v=w>0&&w<1?0:f,new xr(f,v,w,e.opacity)}function br(e,t,n,r){return arguments.length===1?Yn(e):new xr(e,t,n,r==null?1:r)}function xr(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Lr(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Hr(e,t,n,r,i){var s=e*e,f=s*e;return((1-3*e+3*s-f)*t+(4-6*s+3*f)*n+(1+3*e+3*s-3*f)*r+f*i)/6}tp(Sc,Ue,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:R,formatHex:R,formatHsl:function(){return Yn(this).formatHsl()},formatRgb:oe,toString:oe}),tp(pt,Jt,oh(Sc,{brighter:function(e){return e=e==null?1/.7:Math.pow(1/.7,e),new pt(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?.7:Math.pow(.7,e),new pt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Nn,formatHex:Nn,formatRgb:Pn,toString:Pn})),tp(xr,br,oh(Sc,{brighter:function(e){return e=e==null?1/.7:Math.pow(1/.7,e),new xr(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?.7:Math.pow(.7,e),new xr(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new pt(Lr(e>=240?e-240:e+120,i,r),Lr(e,i,r),Lr(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return((e=isNaN(e)?1:Math.max(0,Math.min(1,e)))===1?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(e===1?")":", "+e+")")}}));var yi=function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],s=e[r+1],f=r>0?e[r-1]:2*i-s,v=r<t-1?e[r+2]:2*s-i;return Hr((n-r/t)*t,f,i,s,v)}},zr=function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],s=e[r%t],f=e[(r+1)%t],v=e[(r+2)%t];return Hr((n-r/t)*t,i,s,f,v)}},li=e=>()=>e;function pi(e,t){return function(n){return e+n*t}}function Pi(e,t){var n=t-e;return n?pi(e,n>180||n<-180?n-360*Math.round(n/360):n):li(isNaN(e)?t:e)}function qi(e){return(e=+e)==1?bi:function(t,n){return n-t?function(r,i,s){return r=Math.pow(r,s),i=Math.pow(i,s)-r,s=1/s,function(f){return Math.pow(r+f*i,s)}}(t,n,e):li(isNaN(t)?n:t)}}function bi(e,t){var n=t-e;return n?pi(e,n):li(isNaN(e)?t:e)}var Oi=function e(t){var n=qi(t);function r(i,s){var f=n((i=Jt(i)).r,(s=Jt(s)).r),v=n(i.g,s.g),w=n(i.b,s.b),O=bi(i.opacity,s.opacity);return function(N){return i.r=f(N),i.g=v(N),i.b=w(N),i.opacity=O(N),i+""}}return r.gamma=e,r}(1);function Vo(e){return function(t){var n,r,i=t.length,s=new Array(i),f=new Array(i),v=new Array(i);for(n=0;n<i;++n)r=Jt(t[n]),s[n]=r.r||0,f[n]=r.g||0,v[n]=r.b||0;return s=e(s),f=e(f),v=e(v),r.opacity=1,function(w){return r.r=s(w),r.g=f(w),r.b=v(w),r+""}}}var qo=Vo(yi),Ia=Vo(zr),Ao=function(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(s){for(n=0;n<r;++n)i[n]=e[n]*(1-s)+t[n]*s;return i}};function Ho(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}var zo=function(e,t){return(Ho(t)?Ao:Sa)(e,t)};function Sa(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,s=new Array(i),f=new Array(r);for(n=0;n<i;++n)s[n]=Qo(e[n],t[n]);for(;n<r;++n)f[n]=t[n];return function(v){for(n=0;n<i;++n)f[n]=s[n](v);return f}}var Xa=function(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}},Zi=function(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}},co=function(e,t){var n,r={},i={};for(n in e!==null&&typeof e=="object"||(e={}),t!==null&&typeof t=="object"||(t={}),t)n in e?r[n]=Qo(e[n],t[n]):i[n]=t[n];return function(s){for(n in r)i[n]=r[n](s);return i}},Jo=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Pa=new RegExp(Jo.source,"g"),ks=function(e,t){var n,r,i,s=Jo.lastIndex=Pa.lastIndex=0,f=-1,v=[],w=[];for(e+="",t+="";(n=Jo.exec(e))&&(r=Pa.exec(t));)(i=r.index)>s&&(i=t.slice(s,i),v[f]?v[f]+=i:v[++f]=i),(n=n[0])===(r=r[0])?v[f]?v[f]+=r:v[++f]=r:(v[++f]=null,w.push({i:f,x:Zi(n,r)})),s=Pa.lastIndex;return s<t.length&&(i=t.slice(s),v[f]?v[f]+=i:v[++f]=i),v.length<2?w[0]?function(O){return function(N){return O(N)+""}}(w[0].x):function(O){return function(){return O}}(t):(t=w.length,function(O){for(var N,L=0;L<t;++L)v[(N=w[L]).i]=N.x(O);return v.join("")})},Qo=function(e,t){var n,r=typeof t;return t==null||r==="boolean"?li(t):(r==="number"?Zi:r==="string"?(n=Ue(t))?(t=n,Oi):ks:t instanceof Ue?Oi:t instanceof Date?Xa:Ho(t)?Ao:Array.isArray(t)?Sa:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?co:Zi)(e,t)},Wa=function(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}};function ku(e){return+e}var Cs=[0,1];function fa(e){return e}function _s(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(n){return function(){return n}}(isNaN(t)?NaN:.5)}function _l(e,t,n){var r=e[0],i=e[1],s=t[0],f=t[1];return i<r?(r=_s(i,r),s=n(f,s)):(r=_s(r,i),s=n(s,f)),function(v){return s(r(v))}}function Js(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),s=new Array(r),f=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++f<r;)i[f]=_s(e[f],e[f+1]),s[f]=n(t[f],t[f+1]);return function(v){var w=ts(e,v,1,r)-1;return s[w](i[w](v))}}function Bs(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Fa(){var e,t,n,r,i,s,f=Cs,v=Cs,w=Qo,O=fa;function N(){var Y=Math.min(f.length,v.length);return O!==fa&&(O=function(ie,fe){var ve;return ie>fe&&(ve=ie,ie=fe,fe=ve),function(Be){return Math.max(ie,Math.min(fe,Be))}}(f[0],f[Y-1])),r=Y>2?Js:_l,i=s=null,L}function L(Y){return Y==null||isNaN(Y=+Y)?n:(i||(i=r(f.map(e),v,w)))(e(O(Y)))}return L.invert=function(Y){return O(t((s||(s=r(v,f.map(e),Zi)))(Y)))},L.domain=function(Y){return arguments.length?(f=Array.from(Y,ku),N()):f.slice()},L.range=function(Y){return arguments.length?(v=Array.from(Y),N()):v.slice()},L.rangeRound=function(Y){return v=Array.from(Y),w=Wa,N()},L.clamp=function(Y){return arguments.length?(O=!!Y||fa,N()):O!==fa},L.interpolate=function(Y){return arguments.length?(w=Y,N()):w},L.unknown=function(Y){return arguments.length?(n=Y,L):n},function(Y,ie){return e=Y,t=ie,N()}}function ff(){return Fa()(fa,fa)}function _u(e){var t=e.domain;return e.ticks=function(n){var r=t();return Object(xl.a)(r[0],r[r.length-1],n==null?10:n)},e.tickFormat=function(n,r){var i=t();return hc(i[0],i[i.length-1],n==null?10:n,r)},e.nice=function(n){n==null&&(n=10);var r,i,s=t(),f=0,v=s.length-1,w=s[f],O=s[v],N=10;for(O<w&&(i=w,w=O,O=i,i=f,f=v,v=i);N-- >0;){if((i=Object(xl.b)(w,O,n))===r)return s[f]=w,s[v]=O,t(s);if(i>0)w=Math.floor(w/i)*i,O=Math.ceil(O/i)*i;else{if(!(i<0))break;w=Math.ceil(w*i)/i,O=Math.floor(O*i)/i}r=i}return e},e}function dc(e,t){var n,r=0,i=(e=e.slice()).length-1,s=e[r],f=e[i];return f<s&&(n=r,r=i,i=n,n=s,s=f,f=n),e[r]=t.floor(s),e[i]=t.ceil(f),e}function ns(e){return Math.log(e)}function Bu(e){return Math.exp(e)}function Da(e){return-Math.log(-e)}function Qu(e){return-Math.exp(-e)}function Pu(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Zo(e){return function(t){return-e(-t)}}function Lu(e){var t,n,r=e(ns,Bu),i=r.domain,s=10;function f(){return t=function(v){return v===Math.E?Math.log:v===10&&Math.log10||v===2&&Math.log2||(v=Math.log(v),function(w){return Math.log(w)/v})}(s),n=function(v){return v===10?Pu:v===Math.E?Math.exp:function(w){return Math.pow(v,w)}}(s),i()[0]<0?(t=Zo(t),n=Zo(n),e(Da,Qu)):e(ns,Bu),r}return r.base=function(v){return arguments.length?(s=+v,f()):s},r.domain=function(v){return arguments.length?(i(v),f()):i()},r.ticks=function(v){var w,O=i(),N=O[0],L=O[O.length-1];(w=L<N)&&(ve=N,N=L,L=ve);var Y,ie,fe,ve=t(N),Be=t(L),We=v==null?10:+v,Ve=[];if(!(s%1)&&Be-ve<We){if(ve=Math.floor(ve),Be=Math.ceil(Be),N>0){for(;ve<=Be;++ve)for(ie=1,Y=n(ve);ie<s;++ie)if(!((fe=Y*ie)<N)){if(fe>L)break;Ve.push(fe)}}else for(;ve<=Be;++ve)for(ie=s-1,Y=n(ve);ie>=1;--ie)if(!((fe=Y*ie)<N)){if(fe>L)break;Ve.push(fe)}2*Ve.length<We&&(Ve=Object(xl.a)(N,L,We))}else Ve=Object(xl.a)(ve,Be,Math.min(Be-ve,We)).map(n);return w?Ve.reverse():Ve},r.tickFormat=function(v,w){if(w==null&&(w=s===10?".0e":","),typeof w!="function"&&(w=Object(ih.format)(w)),v===1/0)return w;v==null&&(v=10);var O=Math.max(1,s*v/r.ticks().length);return function(N){var L=N/n(Math.round(t(N)));return L*s<s-.5&&(L*=s),L<=O?w(N):""}},r.nice=function(){return i(dc(i(),{floor:function(v){return n(Math.floor(t(v)))},ceil:function(v){return n(Math.ceil(t(v)))}}))},r}function Qs(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Dc(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Ll(e){return e<0?-e*e:e*e}function Va(e){var t=e(fa,fa),n=1;return t.exponent=function(r){return arguments.length?(n=+r)==1?e(fa,fa):n===.5?e(Dc,Ll):e(Qs(n),Qs(1/n)):n},_u(t)}function hu(){var e=Va(Fa());return e.copy=function(){return Bs(e,hu()).exponent(e.exponent())},iu.apply(e,arguments),e}function Ps(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function rl(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function ah(e){var t=1,n=e(Ps(t),rl(t));return n.constant=function(r){return arguments.length?e(Ps(t=+r),rl(t)):t},_u(n)}var Wi=o(12),rp=o(182),sh=o(69),uh=o(183),s0=o(184),Bm=o(72),Pm=o(40),Kp=o(135),u0=o(70),Xp=o(180),sa=o(181),Ad=o(71),Yp=o(39),ip=o(134),Tg=o(68);function c0(e,t,n,r,i,s){const f=[[sh.a,1,Wi.e],[sh.a,5,5*Wi.e],[sh.a,15,15*Wi.e],[sh.a,30,30*Wi.e],[s,1,Wi.c],[s,5,5*Wi.c],[s,15,15*Wi.c],[s,30,30*Wi.c],[i,1,Wi.b],[i,3,3*Wi.b],[i,6,6*Wi.b],[i,12,12*Wi.b],[r,1,Wi.a],[r,2,2*Wi.a],[n,1,Wi.f],[t,1,Wi.d],[t,3,3*Wi.d],[e,1,Wi.g]];function v(w,O,N){const L=Math.abs(O-w)/N,Y=Object(xi.a)(([,,ve])=>ve).right(f,L);if(Y===f.length)return e.every(Object(xl.c)(w/Wi.g,O/Wi.g,N));if(Y===0)return rp.a.every(Math.max(Object(xl.c)(w,O,N),1));const[ie,fe]=f[L/f[Y-1][2]<f[Y][2]/L?Y-1:Y];return ie.every(fe)}return[function(w,O,N){const L=O<w;L&&([w,O]=[O,w]);const Y=N&&typeof N.range=="function"?N:v(w,O,N),ie=Y?Y.range(w,+O+1):[];return L?ie.reverse():ie},v]}const[Nf,Zu]=c0(Tg.a,ip.a,Yp.b,Ad.a,sa.a,Xp.a),[Jp,op]=c0(u0.a,Kp.a,Pm.b,Bm.a,s0.a,uh.a);var Qp=o(100);function l0(e){return new Date(e)}function Lm(e){return e instanceof Date?+e:+new Date(+e)}function ec(e,t,n,r,i,s,f,v,w,O){var N=ff(),L=N.invert,Y=N.domain,ie=O(".%L"),fe=O(":%S"),ve=O("%I:%M"),Be=O("%I %p"),We=O("%a %d"),Ve=O("%b %d"),ct=O("%B"),lt=O("%Y");function mt(dt){return(w(dt)<dt?ie:v(dt)<dt?fe:f(dt)<dt?ve:s(dt)<dt?Be:r(dt)<dt?i(dt)<dt?We:Ve:n(dt)<dt?ct:lt)(dt)}return N.invert=function(dt){return new Date(L(dt))},N.domain=function(dt){return arguments.length?Y(Array.from(dt,Lm)):Y().map(l0)},N.ticks=function(dt){var kt=Y();return e(kt[0],kt[kt.length-1],dt==null?10:dt)},N.tickFormat=function(dt,kt){return kt==null?mt:O(kt)},N.nice=function(dt){var kt=Y();return dt&&typeof dt.range=="function"||(dt=t(kt[0],kt[kt.length-1],dt==null?10:dt)),dt?Y(dc(kt,dt)):N},N.copy=function(){return Bs(N,ec(e,t,n,r,i,s,f,v,w,O))},N}function il(){var e,t,n,r,i,s=0,f=1,v=fa,w=!1;function O(L){return L==null||isNaN(L=+L)?i:v(n===0?.5:(L=(r(L)-e)*n,w?Math.max(0,Math.min(1,L)):L))}function N(L){return function(Y){var ie,fe;return arguments.length?([ie,fe]=Y,v=L(ie,fe),O):[v(0),v(1)]}}return O.domain=function(L){return arguments.length?([s,f]=L,e=r(s=+s),t=r(f=+f),n=e===t?0:1/(t-e),O):[s,f]},O.clamp=function(L){return arguments.length?(w=!!L,O):w},O.interpolator=function(L){return arguments.length?(v=L,O):v},O.range=N(Qo),O.rangeRound=N(Wa),O.unknown=function(L){return arguments.length?(i=L,O):i},function(L){return r=L,e=L(s),t=L(f),n=e===t?0:1/(t-e),O}}function zl(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function zm(){var e=_u(il()(fa));return e.copy=function(){return zl(e,zm())},bl.apply(e,arguments)}function ap(){var e=Va(il());return e.copy=function(){return zl(e,ap()).exponent(e.exponent())},bl.apply(e,arguments)}function ol(e,t){t===void 0&&(t=e,e=Qo);for(var n=0,r=t.length-1,i=t[0],s=new Array(r<0?0:r);n<r;)s[n]=e(i,i=t[++n]);return function(f){var v=Math.max(0,Math.min(r-1,Math.floor(f*=r)));return s[v](f-v)}}function Zp(){var e,t,n,r,i,s,f,v=0,w=.5,O=1,N=1,L=fa,Y=!1;function ie(ve){return isNaN(ve=+ve)?f:(ve=.5+((ve=+s(ve))-t)*(N*ve<N*t?r:i),L(Y?Math.max(0,Math.min(1,ve)):ve))}function fe(ve){return function(Be){var We,Ve,ct;return arguments.length?([We,Ve,ct]=Be,L=ol(ve,[We,Ve,ct]),ie):[L(0),L(.5),L(1)]}}return ie.domain=function(ve){return arguments.length?([v,w,O]=ve,e=s(v=+v),t=s(w=+w),n=s(O=+O),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),N=t<e?-1:1,ie):[v,w,O]},ie.clamp=function(ve){return arguments.length?(Y=!!ve,ie):Y},ie.interpolator=function(ve){return arguments.length?(L=ve,ie):L},ie.range=fe(Qo),ie.rangeRound=fe(Wa),ie.unknown=function(ve){return arguments.length?(f=ve,ie):f},function(ve){return s=ve,e=ve(v),t=ve(w),n=ve(O),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),N=t<e?-1:1,ie}}function Od(){var e=Va(Zp());return e.copy=function(){return zl(e,Od()).exponent(e.exponent())},bl.apply(e,arguments)}var Sd,Ng=function(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}},Ul=function(e,t){var n=Pi(+e,+t);return function(r){var i=n(r);return i-360*Math.floor(i/360)}},If=180/Math.PI,Wl={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},Ig=function(e,t,n,r,i,s){var f,v,w;return(f=Math.sqrt(e*e+t*t))&&(e/=f,t/=f),(w=e*n+t*r)&&(n-=e*w,r-=t*w),(v=Math.sqrt(n*n+r*r))&&(n/=v,r/=v,w/=v),e*r<t*n&&(e=-e,t=-t,w=-w,f=-f),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*If,skewX:Math.atan(w)*If,scaleX:f,scaleY:v}};function Fg(e,t,n,r){function i(s){return s.length?s.pop()+" ":""}return function(s,f){var v=[],w=[];return s=e(s),f=e(f),function(O,N,L,Y,ie,fe){if(O!==L||N!==Y){var ve=ie.push("translate(",null,t,null,n);fe.push({i:ve-4,x:Zi(O,L)},{i:ve-2,x:Zi(N,Y)})}else(L||Y)&&ie.push("translate("+L+t+Y+n)}(s.translateX,s.translateY,f.translateX,f.translateY,v,w),function(O,N,L,Y){O!==N?(O-N>180?N+=360:N-O>180&&(O+=360),Y.push({i:L.push(i(L)+"rotate(",null,r)-2,x:Zi(O,N)})):N&&L.push(i(L)+"rotate("+N+r)}(s.rotate,f.rotate,v,w),function(O,N,L,Y){O!==N?Y.push({i:L.push(i(L)+"skewX(",null,r)-2,x:Zi(O,N)}):N&&L.push(i(L)+"skewX("+N+r)}(s.skewX,f.skewX,v,w),function(O,N,L,Y,ie,fe){if(O!==L||N!==Y){var ve=ie.push(i(ie)+"scale(",null,",",null,")");fe.push({i:ve-4,x:Zi(O,L)},{i:ve-2,x:Zi(N,Y)})}else L===1&&Y===1||ie.push(i(ie)+"scale("+L+","+Y+")")}(s.scaleX,s.scaleY,f.scaleX,f.scaleY,v,w),s=f=null,function(O){for(var N,L=-1,Y=w.length;++L<Y;)v[(N=w[L]).i]=N.x(O);return v.join("")}}}var em=Fg(function(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Wl:Ig(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),yv=Fg(function(e){return e==null?Wl:(Sd||(Sd=document.createElementNS("http://www.w3.org/2000/svg","g")),Sd.setAttribute("transform",e),(e=Sd.transform.baseVal.consolidate())?(e=e.matrix,Ig(e.a,e.b,e.c,e.d,e.e,e.f)):Wl)},", ",")",")"),bv=1e-12;function ra(e){return((e=Math.exp(e))+1/e)/2}var Rg=function e(t,n,r){function i(s,f){var v,w,O=s[0],N=s[1],L=s[2],Y=f[0],ie=f[1],fe=f[2],ve=Y-O,Be=ie-N,We=ve*ve+Be*Be;if(We<bv)w=Math.log(fe/L)/t,v=function(kt){return[O+kt*ve,N+kt*Be,L*Math.exp(t*kt*w)]};else{var Ve=Math.sqrt(We),ct=(fe*fe-L*L+r*We)/(2*L*n*Ve),lt=(fe*fe-L*L-r*We)/(2*fe*n*Ve),mt=Math.log(Math.sqrt(ct*ct+1)-ct),dt=Math.log(Math.sqrt(lt*lt+1)-lt);w=(dt-mt)/t,v=function(kt){var wt=kt*w,dn=ra(mt),Dn=L/(n*Ve)*(dn*function(wn){return((wn=Math.exp(2*wn))-1)/(wn+1)}(t*wt+mt)-function(wn){return((wn=Math.exp(wn))-1/wn)/2}(mt));return[O+Dn*ve,N+Dn*Be,L*dn/ra(t*wt+mt)]}}return v.duration=1e3*w*t/Math.SQRT2,v}return i.rho=function(s){var f=Math.max(.001,+s),v=f*f;return e(f,v,v*v)},i}(Math.SQRT2,2,4);function Mg(e){return function(t,n){var r=e((t=br(t)).h,(n=br(n)).h),i=bi(t.s,n.s),s=bi(t.l,n.l),f=bi(t.opacity,n.opacity);return function(v){return t.h=r(v),t.s=i(v),t.l=s(v),t.opacity=f(v),t+""}}}var Um=Mg(Pi),jg=Mg(bi);const sp=Math.PI/180,ou=180/Math.PI,tc=.96422,f0=1,h0=.82521,ch=4/29,Vl=6/29,Dd=3*Vl*Vl,H0=Vl*Vl*Vl;function Wm(e){if(e instanceof nc)return new nc(e.l,e.a,e.b,e.opacity);if(e instanceof Lc)return Vm(e);e instanceof pt||(e=qt(e));var t,n,r=Bg(e.r),i=Bg(e.g),s=Bg(e.b),f=ql((.2225045*r+.7168786*i+.0606169*s)/f0);return r===i&&i===s?t=n=f:(t=ql((.4360747*r+.3850649*i+.1430804*s)/tc),n=ql((.0139322*r+.0971045*i+.7141733*s)/h0)),new nc(116*f-16,500*(t-f),200*(f-n),e.opacity)}function Ff(e,t,n,r){return arguments.length===1?Wm(e):new nc(e,t,n,r==null?1:r)}function nc(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function ql(e){return e>H0?Math.pow(e,1/3):e/Dd+ch}function Hh(e){return e>Vl?e*e*e:Dd*(e-ch)}function lh(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Bg(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Td(e){if(e instanceof Lc)return new Lc(e.h,e.c,e.l,e.opacity);if(e instanceof nc||(e=Wm(e)),e.a===0&&e.b===0)return new Lc(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*ou;return new Lc(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function al(e,t,n,r){return arguments.length===1?Td(e):new Lc(e,t,n,r==null?1:r)}function Lc(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function Vm(e){if(isNaN(e.h))return new nc(e.l,0,0,e.opacity);var t=e.h*sp;return new nc(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}function Gh(e,t){var n=bi((e=Ff(e)).l,(t=Ff(t)).l),r=bi(e.a,t.a),i=bi(e.b,t.b),s=bi(e.opacity,t.opacity);return function(f){return e.l=n(f),e.a=r(f),e.b=i(f),e.opacity=s(f),e+""}}function Pg(e){return function(t,n){var r=e((t=al(t)).h,(n=al(n)).h),i=bi(t.c,n.c),s=bi(t.l,n.l),f=bi(t.opacity,n.opacity);return function(v){return t.h=r(v),t.c=i(v),t.l=s(v),t.opacity=f(v),t+""}}}tp(nc,Ff,oh(Sc,{brighter:function(e){return new nc(this.l+18*(e==null?1:e),this.a,this.b,this.opacity)},darker:function(e){return new nc(this.l-18*(e==null?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new pt(lh(3.1338561*(t=tc*Hh(t))-1.6168667*(e=f0*Hh(e))-.4906146*(n=h0*Hh(n))),lh(-.9787684*t+1.9161415*e+.033454*n),lh(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),tp(Lc,al,oh(Sc,{brighter:function(e){return new Lc(this.h,this.c,this.l+18*(e==null?1:e),this.opacity)},darker:function(e){return new Lc(this.h,this.c,this.l-18*(e==null?1:e),this.opacity)},rgb:function(){return Vm(this).rgb()}}));var G0=Pg(Pi),qm=Pg(bi),fh=-.29227,$h=-.90649,Nd=1.97294,Kh=Nd*$h,Rf=1.78277*Nd,Hm=1.78277*fh- -.14861*$h;function Xh(e,t,n,r){return arguments.length===1?function(i){if(i instanceof Ko)return new Ko(i.h,i.s,i.l,i.opacity);i instanceof pt||(i=qt(i));var s=i.r/255,f=i.g/255,v=i.b/255,w=(Hm*v+Kh*s-Rf*f)/(Hm+Kh-Rf),O=v-w,N=(Nd*(f-w)-fh*O)/$h,L=Math.sqrt(N*N+O*O)/(Nd*w*(1-w)),Y=L?Math.atan2(N,O)*ou-120:NaN;return new Ko(Y<0?Y+360:Y,L,w,i.opacity)}(e):new Ko(e,t,n,r==null?1:r)}function Ko(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function hh(e){return function t(n){function r(i,s){var f=e((i=Xh(i)).h,(s=Xh(s)).h),v=bi(i.s,s.s),w=bi(i.l,s.l),O=bi(i.opacity,s.opacity);return function(N){return i.h=f(N),i.s=v(N),i.l=w(Math.pow(N,n)),i.opacity=O(N),i+""}}return n=+n,r.gamma=t,r}(1)}tp(Ko,Xh,oh(Sc,{brighter:function(e){return e=e==null?1/.7:Math.pow(1/.7,e),new Ko(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?.7:Math.pow(.7,e),new Ko(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*sp,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new pt(255*(t+n*(-.14861*r+1.78277*i)),255*(t+n*(fh*r+$h*i)),255*(t+n*(Nd*r)),this.opacity)}}));var up=hh(Pi),$0=hh(bi),dh=function(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n};function cp(e,t,n){const r=e-t+2*n;return e?r>0?r:1:0}const Mf="linear",hf="log",Yh="pow",df="sqrt",to="symlog",pf="time",jf="utc",zu="sequential",lp="diverging",ph="quantile",Bf="quantize",Ts="threshold",Id="ordinal",Gm="point",Jh="band",Pf="bin-ordinal",du="continuous",mf="discrete",El="discretizing",sl="interpolating",ul="temporal";function rc(){const e=lf().unknown(void 0),t=e.domain,n=e.range;let r,i,s=[0,1],f=!1,v=0,w=0,O=.5;function N(){const L=t().length,Y=s[1]<s[0],ie=s[1-Y],fe=cp(L,v,w);let ve=s[Y-0];r=(ie-ve)/(fe||1),f&&(r=Math.floor(r)),ve+=(ie-ve-r*(L-v))*O,i=r*(1-v),f&&(ve=Math.round(ve),i=Math.round(i));const Be=Qi(L).map(We=>ve+r*We);return n(Y?Be.reverse():Be)}return delete e.unknown,e.domain=function(L){return arguments.length?(t(L),N()):t()},e.range=function(L){return arguments.length?(s=[+L[0],+L[1]],N()):s.slice()},e.rangeRound=function(L){return s=[+L[0],+L[1]],f=!0,N()},e.bandwidth=function(){return i},e.step=function(){return r},e.round=function(L){return arguments.length?(f=!!L,N()):f},e.padding=function(L){return arguments.length?(w=Math.max(0,Math.min(1,L)),v=w,N()):v},e.paddingInner=function(L){return arguments.length?(v=Math.max(0,Math.min(1,L)),N()):v},e.paddingOuter=function(L){return arguments.length?(w=Math.max(0,Math.min(1,L)),N()):w},e.align=function(L){return arguments.length?(O=Math.max(0,Math.min(1,L)),N()):O},e.invertRange=function(L){if(L[0]==null||L[1]==null)return;const Y=s[1]<s[0],ie=Y?n().reverse():n(),fe=ie.length-1;let ve,Be,We,Ve=+L[0],ct=+L[1];return Ve!=Ve||ct!=ct||(ct<Ve&&(We=Ve,Ve=ct,ct=We),ct<ie[0]||Ve>s[1-Y])?void 0:(ve=Math.max(0,js(ie,Ve)-1),Be=Ve===ct?ve:js(ie,ct)-1,Ve-ie[ve]>i+1e-10&&++ve,Y&&(We=ve,ve=fe-Be,Be=fe-We),ve>Be?void 0:t().slice(ve,Be+1))},e.invert=function(L){const Y=e.invertRange([L,L]);return Y&&Y[0]},e.copy=function(){return rc().domain(t()).range(s).round(f).paddingInner(v).paddingOuter(w).align(O)},N()}var tm=Array.prototype.map;const Lg=Array.prototype.slice,Fd={};function Ra(e,t,n){return arguments.length>1?(Fd[e]=function(r,i,s){const f=function(){const v=i();return v.invertRange||(v.invertRange=v.invert?function(w){return function(O){let N,L=O[0],Y=O[1];return Y<L&&(N=L,L=Y,Y=N),[w.invert(L),w.invert(Y)]}}(v):v.invertExtent?function(w){return function(O){const N=w.range();let L,Y,ie,fe,ve=O[0],Be=O[1],We=-1;for(Be<ve&&(Y=ve,ve=Be,Be=Y),ie=0,fe=N.length;ie<fe;++ie)N[ie]>=ve&&N[ie]<=Be&&(We<0&&(We=ie),L=ie);if(!(We<0))return ve=w.invertExtent(N[We]),Be=w.invertExtent(N[L]),[ve[0]===void 0?ve[1]:ve[0],Be[1]===void 0?Be[0]:Be[1]]}}(v):void 0),v.type=r,v};return f.metadata=Object(we.Fa)(Object(we.i)(s)),f}(e,t,n),this):nm(e)?Fd[e]:void 0}function nm(e){return Object(we.w)(Fd,e)}function zc(e,t){const n=Fd[e];return n&&n.metadata[t]}function Qh(e){return zc(e,du)}function Zh(e){return zc(e,mf)}function rm(e){return zc(e,El)}function $m(e){return zc(e,hf)}function Km(e){return zc(e,sl)}function Xm(e){return zc(e,ph)}Ra("identity",function e(t){var n;function r(i){return i==null||isNaN(i=+i)?n:i}return r.invert=r,r.domain=r.range=function(i){return arguments.length?(t=Array.from(i,ku),r):t.slice()},r.unknown=function(i){return arguments.length?(n=i,r):n},r.copy=function(){return e(t).unknown(n)},t=arguments.length?Array.from(t,ku):[0,1],_u(r)}),Ra(Mf,function e(){var t=ff();return t.copy=function(){return Bs(t,e())},iu.apply(t,arguments),_u(t)},du),Ra(hf,function e(){var t=Lu(Fa()).domain([1,10]);return t.copy=function(){return Bs(t,e()).base(t.base())},iu.apply(t,arguments),t},[du,hf]),Ra(Yh,hu,du),Ra(df,function(){return hu.apply(null,arguments).exponent(.5)},du),Ra(to,function e(){var t=ah(Fa());return t.copy=function(){return Bs(t,e()).constant(t.constant())},iu.apply(t,arguments)},du),Ra(pf,function(){return iu.apply(ec(Jp,op,u0.a,Kp.a,Pm.b,Bm.a,s0.a,uh.a,sh.a,Qp.a).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)},[du,ul]),Ra(jf,function(){return iu.apply(ec(Nf,Zu,Tg.a,ip.a,Yp.b,Ad.a,sa.a,Xp.a,sh.a,Qp.c).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)},[du,ul]),Ra(zu,zm,[du,sl]),Ra("".concat(zu,"-").concat(Mf),zm,[du,sl]),Ra("".concat(zu,"-").concat(hf),function e(){var t=Lu(il()).domain([1,10]);return t.copy=function(){return zl(t,e()).base(t.base())},bl.apply(t,arguments)},[du,sl,hf]),Ra("".concat(zu,"-").concat(Yh),ap,[du,sl]),Ra("".concat(zu,"-").concat(df),function(){return ap.apply(null,arguments).exponent(.5)},[du,sl]),Ra("".concat(zu,"-").concat(to),function e(){var t=ah(il());return t.copy=function(){return zl(t,e()).constant(t.constant())},bl.apply(t,arguments)},[du,sl]),Ra("".concat(lp,"-").concat(Mf),function e(){var t=_u(Zp()(fa));return t.copy=function(){return zl(t,e())},bl.apply(t,arguments)},[du,sl]),Ra("".concat(lp,"-").concat(hf),function e(){var t=Lu(Zp()).domain([.1,1,10]);return t.copy=function(){return zl(t,e()).base(t.base())},bl.apply(t,arguments)},[du,sl,hf]),Ra("".concat(lp,"-").concat(Yh),Od,[du,sl]),Ra("".concat(lp,"-").concat(df),function(){return Od.apply(null,arguments).exponent(.5)},[du,sl]),Ra("".concat(lp,"-").concat(to),function e(){var t=ah(Zp());return t.copy=function(){return zl(t,e()).constant(t.constant())},bl.apply(t,arguments)},[du,sl]),Ra(ph,function e(){var t,n=[],r=[],i=[];function s(){var v=0,w=Math.max(1,r.length);for(i=new Array(w-1);++v<w;)i[v-1]=ji(n,v/w);return f}function f(v){return v==null||isNaN(v=+v)?t:r[ts(i,v)]}return f.invertExtent=function(v){var w=r.indexOf(v);return w<0?[NaN,NaN]:[w>0?i[w-1]:n[0],w<i.length?i[w]:n[n.length-1]]},f.domain=function(v){if(!arguments.length)return n.slice();n=[];for(let w of v)w==null||isNaN(w=+w)||n.push(w);return n.sort($n.a),s()},f.range=function(v){return arguments.length?(r=Array.from(v),s()):r.slice()},f.unknown=function(v){return arguments.length?(t=v,f):t},f.quantiles=function(){return i.slice()},f.copy=function(){return e().domain(n).range(r).unknown(t)},iu.apply(f,arguments)},[El,ph]),Ra(Bf,function e(){var t,n=0,r=1,i=1,s=[.5],f=[0,1];function v(O){return O!=null&&O<=O?f[ts(s,O,0,i)]:t}function w(){var O=-1;for(s=new Array(i);++O<i;)s[O]=((O+1)*r-(O-i)*n)/(i+1);return v}return v.domain=function(O){return arguments.length?([n,r]=O,n=+n,r=+r,w()):[n,r]},v.range=function(O){return arguments.length?(i=(f=Array.from(O)).length-1,w()):f.slice()},v.invertExtent=function(O){var N=f.indexOf(O);return N<0?[NaN,NaN]:N<1?[n,s[0]]:N>=i?[s[i-1],r]:[s[N-1],s[N]]},v.unknown=function(O){return arguments.length&&(t=O),v},v.thresholds=function(){return s.slice()},v.copy=function(){return e().domain([n,r]).range(f).unknown(t)},iu.apply(_u(v),arguments)},El),Ra(Ts,function e(){var t,n=[.5],r=[0,1],i=1;function s(f){return f!=null&&f<=f?r[ts(n,f,0,i)]:t}return s.domain=function(f){return arguments.length?(n=Array.from(f),i=Math.min(n.length,r.length-1),s):n.slice()},s.range=function(f){return arguments.length?(r=Array.from(f),i=Math.min(n.length,r.length-1),s):r.slice()},s.invertExtent=function(f){var v=r.indexOf(f);return[n[v-1],n[v]]},s.unknown=function(f){return arguments.length?(t=f,s):t},s.copy=function(){return e().domain(n).range(r).unknown(t)},iu.apply(s,arguments)},El),Ra(Pf,function e(){let t=[],n=[];function r(i){return i==null||i!=i?void 0:n[(ts(t,i)-1)%n.length]}return r.domain=function(i){return arguments.length?(t=function(s){return tm.call(s,we.Ea)}(i),r):t.slice()},r.range=function(i){return arguments.length?(n=Lg.call(i),r):n.slice()},r.tickFormat=function(i,s){return hc(t[0],Object(we.W)(t),i==null?10:i,s)},r.copy=function(){return e().domain(r.domain()).range(r.range())},r},[mf,El]),Ra(Id,lf,mf),Ra(Jh,rc,mf),Ra(Gm,function(){return function e(t){const n=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,t.copy=function(){return e(n())},t}(rc().paddingInner(1))},mf);const zg=["clamp","base","constant","exponent"];function im(e,t){const n=t[0],r=Object(we.W)(t)-n;return function(i){return e(n+i*r)}}function ed(e,t,n){return ol(td(t||"rgb",n),e)}function fp(e,t){const n=new Array(t),r=t+1;for(let i=0;i<t;)n[i]=e(++i/r);return n}function Rd(e,t,n){const r=n-t;let i,s,f;return r&&Number.isFinite(r)?(i=(s=e.type).indexOf("-"),s=i<0?s:s.slice(i+1),f=Ra(s)().domain([t,n]).range([0,1]),zg.forEach(v=>e[v]?f[v](e[v]()):0),f):Object(we.m)(.5)}function td(e,t){const n=A[function(r){return"interpolate"+r.toLowerCase().split("-").map(i=>i[0].toUpperCase()+i.slice(1)).join("")}(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function om(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}function Ym(e,t){for(const n in e)dp(n,t(e[n]))}const hp={};function dp(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(hp[e]=t,this):hp[e]}Ym({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},om),Ym({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},e=>ed(om(e)));const am="symbol",gf="discrete",Uc=e=>Object(we.B)(e)?e.map(t=>String(t)):String(e),K0=(e,t)=>e[1]-t[1],Ug=(e,t)=>t[1]-e[1];function sm(e,t,n){let r;return Object(we.G)(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),n!=null&&(t=Math.min(t,Math.floor(Object(we.Z)(e.domain())/n||1)))),Object(we.H)(t)&&(r=t.step,t=t.interval),Object(we.J)(t)&&(t=e.type===pf?Object(hr.p)(t):e.type==jf?Object(hr.v)(t):Object(we.o)("Only time and utc scales accept interval strings."),r&&(t=t.every(r))),t}function d0(e,t,n){let r=e.range(),i=r[0],s=Object(we.W)(r),f=K0;if(i>s&&(r=s,s=i,i=r,f=Ug),i=Math.floor(i),s=Math.ceil(s),t=t.map(v=>[v,e(v)]).filter(v=>i<=v[1]&&v[1]<=s).sort(f).map(v=>v[0]),n>0&&t.length>1){const v=[t[0],Object(we.W)(t)];for(;t.length>n&&t.length>=3;)t=t.filter((w,O)=>!(O%2));t.length<3&&(t=v)}return t}function nd(e,t){return e.bins?d0(e,e.bins):e.ticks?e.ticks(t):e.domain()}function p0(e,t,n,r,i,s){const f=t.type;let v=Uc;if(f===pf||i===pf)v=e.timeFormat(r);else if(f===jf||i===jf)v=e.utcFormat(r);else if($m(f)){const w=e.formatFloat(r);if(s||t.bins)v=w;else{const O=um(t,n,!1);v=N=>O(N)?w(N):""}}else if(t.tickFormat){const w=t.domain();v=e.formatSpan(w[0],w[w.length-1],n,r)}else r&&(v=e.format(r));return v}function um(e,t,n){const r=nd(e,t),i=e.base(),s=Math.log(i),f=Math.max(1,i*t/r.length),v=w=>{let O=w/Math.pow(i,Math.round(Math.log(w)/s));return O*i<i-.5&&(O*=i),O<=f};return n?r.filter(v):v}const Jm={[ph]:"quantiles",[Bf]:"thresholds",[Ts]:"domain"},m0={[ph]:"quantiles",[Bf]:"domain"};function g0(e,t){return e.bins?function(n){const r=n.slice(0,-1);return r.max=Object(we.W)(n),r}(e.bins):e.type===hf?um(e,t,!0):Jm[e.type]?function(n){const r=[-1/0].concat(n);return r.max=1/0,r}(e[Jm[e.type]]()):nd(e,t)}const Wg=e=>Jm[e.type]||e.bins;function v0(e,t,n,r,i,s,f){const v=m0[t.type]&&s!==pf&&s!==jf?function(w,O,N){const L=O[m0[O.type]](),Y=L.length;let ie,fe=Y>1?L[1]-L[0]:L[0];for(ie=1;ie<Y;++ie)fe=Math.min(fe,L[ie]-L[ie-1]);return w.formatSpan(0,fe,30,N)}(e,t,i):p0(e,t,n,i,s,f);return r===am&&Wg(t)?y0(v):r===gf?b0(v):Vg(v)}const y0=e=>(t,n,r)=>{const i=rd(r[n+1],rd(r.max,1/0)),s=mh(t,e),f=mh(i,e);return s&&f?s+" \u2013 "+f:f?"< "+f:"\u2265 "+s},rd=(e,t)=>e!=null?e:t,b0=e=>(t,n)=>n?e(t):null,Vg=e=>t=>e(t),mh=(e,t)=>Number.isFinite(e)?t(e):null;function qg(e,t,n,r){const i=r||t.type;return Object(we.J)(n)&&function(s){return zc(s,ul)}(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||i!==pf?n||i!==jf?v0(e,t,5,null,n,r,!0):e.utcFormat("%A, %d %B %Y, %X UTC"):e.timeFormat("%A, %d %B %Y, %X")}function x0(e,t,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=qg(e,t,n.format,n.formatType);if(rm(t.type)){const s=g0(t).slice(1).map(i),f=s.length;return"".concat(f," boundar").concat(f===1?"y":"ies",": ").concat(s.join(", "))}if(Zh(t.type)){const s=t.domain(),f=s.length,v=f>r?s.slice(0,r-2).map(i).join(", ")+", ending with "+s.slice(-1).map(i):s.map(i).join(", ");return"".concat(f," value").concat(f===1?"":"s",": ").concat(v)}{const s=t.domain();return"values from ".concat(i(s[0])," to ").concat(i(Object(we.W)(s)))}}let id=0;const gh="p_";function Qm(e){return e&&e.gradient}function Hg(e,t,n){const r=e.gradient;let i=e.id,s=r==="radial"?gh:"";return i||(i=e.id="gradient_"+id++,r==="radial"?(e.x1=vf(e.x1,.5),e.y1=vf(e.y1,.5),e.r1=vf(e.r1,0),e.x2=vf(e.x2,.5),e.y2=vf(e.y2,.5),e.r2=vf(e.r2,.5),s=gh):(e.x1=vf(e.x1,0),e.y1=vf(e.y1,0),e.x2=vf(e.x2,1),e.y2=vf(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+s+i+")"}function vf(e,t){return e!=null?e:t}function Gg(e,t){var n,r=[];return n={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:r,stop:function(i,s){return r.push({offset:i,color:s}),n}}}const w0={basis:{curve:function(e){return new Ca(e)}},"basis-closed":{curve:function(e){return new za(e)}},"basis-open":{curve:function(e){return new Sf(e)}},bundle:{curve:Ru,tension:"beta",value:.85},cardinal:{curve:af,tension:"tension",value:0},"cardinal-open":{curve:sf,tension:"tension",value:0},"cardinal-closed":{curve:Dg,tension:"tension",value:0},"catmull-rom":{curve:Oc,tension:"alpha",value:.5},"catmull-rom-closed":{curve:Lh,tension:"alpha",value:.5},"catmull-rom-open":{curve:jm,tension:"alpha",value:.5},linear:{curve:Ml},"linear-closed":{curve:function(e){return new Uh(e)}},monotone:{horizontal:function(e){return new Ss(e)},vertical:function(e){return new Vh(e)}},natural:{curve:function(e){return new Gp(e)}},step:{curve:function(e){return new rh(e,.5)}},"step-after":{curve:function(e){return new rh(e,1)}},"step-before":{curve:function(e){return new rh(e,0)}}};function Uu(e,t,n){var r=Object(we.w)(w0,e)&&w0[e],i=null;return r&&(i=r.curve||r[t||"vertical"],r.tension&&n!=null&&(i=i[r.tension](n))),i}const X0={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},pp=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function mp(e){const t=[];let n,r,i,s,f,v,w,O,N,L;const Y=e.slice().replace(pp[0],"###$1").split(pp[1]).slice(1);for(w=0,N=Y.length;w<N;++w){for(r=(n=Y[w]).slice(1).trim().replace(pp[2],"$1###$2").replace(pp[3],"$1###$2").split(pp[4]),i=[f=n.charAt(0)],O=0,L=r.length;O<L;++O)(s=+r[O])===s&&i.push(s);if(v=X0[f.toLowerCase()],i.length-1>v){const ie=i.length;for(O=1,t.push([f].concat(i.slice(O,O+=v))),f=f==="M"?"L":f==="m"?"l":f;O<ie;O+=v)t.push([f].concat(i.slice(O,O+v)))}else t.push(i)}return t}const vh=Math.PI/180,k0=1e-14,Md=Math.PI/2,yf=2*Math.PI,gp=Math.sqrt(3)/2;var jd={},Zm={},$g=[].join;function _0(e){const t=$g.call(e);if(Zm[t])return Zm[t];var n=e[0],r=e[1],i=e[2],s=e[3],f=e[4],v=e[5],w=e[6],O=e[7];const N=O*f,L=-w*v,Y=w*f,ie=O*v,fe=Math.cos(i),ve=Math.sin(i),Be=Math.cos(s),We=Math.sin(s),Ve=.5*(s-i),ct=Math.sin(.5*Ve),lt=8/3*ct*ct/Math.sin(Ve),mt=n+fe-lt*ve,dt=r+ve+lt*fe,kt=n+Be,wt=r+We,dn=kt+lt*We,Dn=wt-lt*Be;return Zm[t]=[N*mt+L*dt,Y*mt+ie*dt,N*dn+L*Dn,Y*dn+ie*Dn,N*kt+L*wt,Y*kt+ie*wt]}const Eu=["l",0,0,0,0,0,0,0];function E0(e,t,n){const r=Eu[0]=e[0];if(r==="a"||r==="A")Eu[1]=t*e[1],Eu[2]=n*e[2],Eu[3]=e[3],Eu[4]=e[4],Eu[5]=e[5],Eu[6]=t*e[6],Eu[7]=n*e[7];else if(r==="h"||r==="H")Eu[1]=t*e[1];else if(r==="v"||r==="V")Eu[1]=n*e[1];else for(var i=1,s=e.length;i<s;++i)Eu[i]=(i%2==1?t:n)*e[i];return Eu}function vp(e,t,n,r,i,s){var f,v,w,O,N,L=null,Y=0,ie=0,fe=0,ve=0;n==null&&(n=0),r==null&&(r=0),i==null&&(i=1),s==null&&(s=i),e.beginPath&&e.beginPath();for(var Be=0,We=t.length;Be<We;++Be){switch(f=t[Be],i===1&&s===1||(f=E0(f,i,s)),f[0]){case"l":Y+=f[1],ie+=f[2],e.lineTo(Y+n,ie+r);break;case"L":Y=f[1],ie=f[2],e.lineTo(Y+n,ie+r);break;case"h":Y+=f[1],e.lineTo(Y+n,ie+r);break;case"H":Y=f[1],e.lineTo(Y+n,ie+r);break;case"v":ie+=f[1],e.lineTo(Y+n,ie+r);break;case"V":ie=f[1],e.lineTo(Y+n,ie+r);break;case"m":Y+=f[1],ie+=f[2],e.moveTo(Y+n,ie+r);break;case"M":Y=f[1],ie=f[2],e.moveTo(Y+n,ie+r);break;case"c":v=Y+f[5],w=ie+f[6],fe=Y+f[3],ve=ie+f[4],e.bezierCurveTo(Y+f[1]+n,ie+f[2]+r,fe+n,ve+r,v+n,w+r),Y=v,ie=w;break;case"C":Y=f[5],ie=f[6],fe=f[3],ve=f[4],e.bezierCurveTo(f[1]+n,f[2]+r,fe+n,ve+r,Y+n,ie+r);break;case"s":v=Y+f[3],w=ie+f[4],fe=2*Y-fe,ve=2*ie-ve,e.bezierCurveTo(fe+n,ve+r,Y+f[1]+n,ie+f[2]+r,v+n,w+r),fe=Y+f[1],ve=ie+f[2],Y=v,ie=w;break;case"S":v=f[3],w=f[4],fe=2*Y-fe,ve=2*ie-ve,e.bezierCurveTo(fe+n,ve+r,f[1]+n,f[2]+r,v+n,w+r),Y=v,ie=w,fe=f[1],ve=f[2];break;case"q":v=Y+f[3],w=ie+f[4],fe=Y+f[1],ve=ie+f[2],e.quadraticCurveTo(fe+n,ve+r,v+n,w+r),Y=v,ie=w;break;case"Q":v=f[3],w=f[4],e.quadraticCurveTo(f[1]+n,f[2]+r,v+n,w+r),Y=v,ie=w,fe=f[1],ve=f[2];break;case"t":v=Y+f[1],w=ie+f[2],L[0].match(/[QqTt]/)===null?(fe=Y,ve=ie):L[0]==="t"?(fe=2*Y-O,ve=2*ie-N):L[0]==="q"&&(fe=2*Y-fe,ve=2*ie-ve),O=fe,N=ve,e.quadraticCurveTo(fe+n,ve+r,v+n,w+r),ie=w,fe=(Y=v)+f[1],ve=ie+f[2];break;case"T":v=f[1],w=f[2],fe=2*Y-fe,ve=2*ie-ve,e.quadraticCurveTo(fe+n,ve+r,v+n,w+r),Y=v,ie=w;break;case"a":C0(e,Y+n,ie+r,[f[1],f[2],f[3],f[4],f[5],f[6]+Y+n,f[7]+ie+r]),Y+=f[6],ie+=f[7];break;case"A":C0(e,Y+n,ie+r,[f[1],f[2],f[3],f[4],f[5],f[6]+n,f[7]+r]),Y=f[6],ie=f[7];break;case"z":case"Z":e.closePath()}L=f}}function C0(e,t,n,r){const i=function(s,f,v,w,O,N,L,Y,ie){const fe=$g.call(arguments);if(jd[fe])return jd[fe];const ve=L*vh,Be=Math.sin(ve),We=Math.cos(ve),Ve=We*(Y-s)*.5+Be*(ie-f)*.5,ct=We*(ie-f)*.5-Be*(Y-s)*.5;let lt=Ve*Ve/((v=Math.abs(v))*v)+ct*ct/((w=Math.abs(w))*w);lt>1&&(v*=lt=Math.sqrt(lt),w*=lt);const mt=We/v,dt=Be/v,kt=-Be/w,wt=We/w,dn=mt*Y+dt*ie,Dn=kt*Y+wt*ie,wn=mt*s+dt*f,Xn=kt*s+wt*f;let Kn=1/((wn-dn)*(wn-dn)+(Xn-Dn)*(Xn-Dn))-.25;Kn<0&&(Kn=0);let ir=Math.sqrt(Kn);N==O&&(ir=-ir);const sr=.5*(dn+wn)-ir*(Xn-Dn),gr=.5*(Dn+Xn)+ir*(wn-dn),Vr=Math.atan2(Dn-gr,dn-sr);let hi=Math.atan2(Xn-gr,wn-sr)-Vr;hi<0&&N===1?hi+=yf:hi>0&&N===0&&(hi-=yf);const Qr=Math.ceil(Math.abs(hi/(Md+.001))),Ni=[];for(let ro=0;ro<Qr;++ro){const oo=Vr+ro*hi/Qr,Po=Vr+(ro+1)*hi/Qr;Ni[ro]=[sr,gr,oo,Po,v,w,Be,We]}return jd[fe]=Ni}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(let s=0;s<i.length;++s){const f=_0(i[s]);e.bezierCurveTo(f[0],f[1],f[2],f[3],f[4],f[5])}}const eg={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,yf)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r),e.lineTo(-n,r),e.lineTo(-r,r),e.lineTo(-r,n),e.lineTo(r,n),e.lineTo(r,r),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(r,-r),e.lineTo(r,-n),e.lineTo(-r,-n),e.lineTo(-r,-r),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,s=n/8;e.moveTo(-r,n),e.lineTo(r,n),e.lineTo(r,-s),e.lineTo(i,-s),e.lineTo(0,-n),e.lineTo(-i,-s),e.lineTo(-r,-s),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=gp*n,i=r-.5773502691896257*n,s=n/4;e.moveTo(0,-r-i),e.lineTo(-s,r-i),e.lineTo(s,r-i),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=gp*n,i=r-.5773502691896257*n;e.moveTo(0,-r-i),e.lineTo(-n,r-i),e.lineTo(n,r-i),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=gp*n;e.moveTo(0,-r),e.lineTo(-n,r),e.lineTo(n,r),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=gp*n;e.moveTo(0,r),e.lineTo(-n,-r),e.lineTo(n,-r),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=gp*n;e.moveTo(r,0),e.lineTo(-r,-n),e.lineTo(-r,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=gp*n;e.moveTo(-r,0),e.lineTo(r,-n),e.lineTo(r,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function od(e){return Object(we.w)(eg,e)?eg[e]:function(t){if(!Object(we.w)(cm,t)){const n=mp(t);cm[t]={draw:function(r,i){vp(r,n,0,0,Math.sqrt(i)/2)}}}return cm[t]}(e)}var cm={};const yh=.448084975506;function A0(e){return e.x}function tg(e){return e.y}function ng(e){return e.width}function Kg(e){return e.height}function Lf(e){return typeof e=="function"?e:()=>+e}function rg(e,t,n){return Math.max(t,Math.min(e,n))}function O0(){var e=A0,t=tg,n=ng,r=Kg,i=Lf(0),s=i,f=i,v=i,w=null;function O(N,L,Y){var ie,fe=L!=null?L:+e.call(this,N),ve=Y!=null?Y:+t.call(this,N),Be=+n.call(this,N),We=+r.call(this,N),Ve=Math.min(Be,We)/2,ct=rg(+i.call(this,N),0,Ve),lt=rg(+s.call(this,N),0,Ve),mt=rg(+f.call(this,N),0,Ve),dt=rg(+v.call(this,N),0,Ve);if(w||(w=ie=ru()),ct<=0&&lt<=0&&mt<=0&&dt<=0)w.rect(fe,ve,Be,We);else{var kt=fe+Be,wt=ve+We;w.moveTo(fe+ct,ve),w.lineTo(kt-lt,ve),w.bezierCurveTo(kt-yh*lt,ve,kt,ve+yh*lt,kt,ve+lt),w.lineTo(kt,wt-dt),w.bezierCurveTo(kt,wt-yh*dt,kt-yh*dt,wt,kt-dt,wt),w.lineTo(fe+mt,wt),w.bezierCurveTo(fe+yh*mt,wt,fe,wt-yh*mt,fe,wt-mt),w.lineTo(fe,ve+ct),w.bezierCurveTo(fe,ve+yh*ct,fe+yh*ct,ve,fe+ct,ve),w.closePath()}if(ie)return w=null,ie+""||null}return O.x=function(N){return arguments.length?(e=Lf(N),O):e},O.y=function(N){return arguments.length?(t=Lf(N),O):t},O.width=function(N){return arguments.length?(n=Lf(N),O):n},O.height=function(N){return arguments.length?(r=Lf(N),O):r},O.cornerRadius=function(N,L,Y,ie){return arguments.length?(i=Lf(N),s=L!=null?Lf(L):i,v=Y!=null?Lf(Y):i,f=ie!=null?Lf(ie):s,O):i},O.context=function(N){return arguments.length?(w=N==null?null:N,O):w},O}function bh(){var e,t,n,r,i,s,f,v,w=null;function O(L,Y,ie){const fe=ie/2;if(i){var ve=f-Y,Be=L-s;if(ve||Be){var We=Math.sqrt(ve*ve+Be*Be),Ve=(ve/=We)*v,ct=(Be/=We)*v,lt=Math.atan2(Be,ve);w.moveTo(s-Ve,f-ct),w.lineTo(L-ve*fe,Y-Be*fe),w.arc(L,Y,fe,lt-Math.PI,lt),w.lineTo(s+Ve,f+ct),w.arc(s,f,v,lt,lt+Math.PI)}else w.arc(L,Y,fe,0,yf);w.closePath()}else i=1;s=L,f=Y,v=fe}function N(L){var Y,ie,fe,ve=L.length,Be=!1;for(w==null&&(w=fe=ru()),Y=0;Y<=ve;++Y)!(Y<ve&&r(ie=L[Y],Y,L))===Be&&(Be=!Be)&&(i=0),Be&&O(+e(ie,Y,L),+t(ie,Y,L),+n(ie,Y,L));if(fe)return w=null,fe+""||null}return N.x=function(L){return arguments.length?(e=L,N):e},N.y=function(L){return arguments.length?(t=L,N):t},N.size=function(L){return arguments.length?(n=L,N):n},N.defined=function(L){return arguments.length?(r=L,N):r},N.context=function(L){return arguments.length?(w=L==null?null:L,N):w},N}function lm(e,t){return e!=null?e:t}const xh=e=>e.x||0,yp=e=>e.y||0,Cu=e=>e.defined!==!1,ig=function(){var e=cf,t=jl,n=Fo(0),r=null,i=wr,s=fu,f=Ds,v=null;function w(){var O,N,L=+e.apply(this,arguments),Y=+t.apply(this,arguments),ie=i.apply(this,arguments)-Pc,fe=s.apply(this,arguments)-Pc,ve=eh(fe-ie),Be=fe>ie;if(v||(v=O=ru()),Y<L&&(N=Y,Y=L,L=N),Y>Es)if(ve>Bh-Es)v.moveTo(Y*Ms(ie),Y*cu(ie)),v.arc(0,0,Y,ie,fe,!Be),L>Es&&(v.moveTo(L*Ms(fe),L*cu(fe)),v.arc(0,0,L,fe,ie,Be));else{var We,Ve,ct=ie,lt=fe,mt=ie,dt=fe,kt=ve,wt=ve,dn=f.apply(this,arguments)/2,Dn=dn>Es&&(r?+r.apply(this,arguments):lc(L*L+Y*Y)),wn=Co(eh(Y-L)/2,+n.apply(this,arguments)),Xn=wn,Kn=wn;if(Dn>Es){var ir=Ph(Dn/L*cu(dn)),sr=Ph(Dn/Y*cu(dn));(kt-=2*ir)>Es?(mt+=ir*=Be?1:-1,dt-=ir):(kt=0,mt=dt=(ie+fe)/2),(wt-=2*sr)>Es?(ct+=sr*=Be?1:-1,lt-=sr):(wt=0,ct=lt=(ie+fe)/2)}var gr=Y*Ms(ct),Vr=Y*cu(ct),hi=L*Ms(dt),Qr=L*cu(dt);if(wn>Es){var Ni,ro=Y*Ms(lt),oo=Y*cu(lt),Po=L*Ms(mt),ho=L*cu(mt);if(ve<uf&&(Ni=function(qs,Su,Ic,Fc,xc,Kd,nE,QO){var Wb=Ic-qs,C1=Fc-Su,Vb=nE-xc,uy=QO-Kd,Rm=uy*Wb-Vb*C1;if(!(Rm*Rm<Es))return[qs+(Rm=(Vb*(Su-Kd)-uy*(qs-xc))/Rm)*Wb,Su+Rm*C1]}(gr,Vr,Po,ho,ro,oo,hi,Qr))){var ao=gr-Ni[0],xo=Vr-Ni[1],_a=ro-Ni[0],ys=oo-Ni[1],Lo=1/cu(function(qs){return qs>1?0:qs<-1?uf:Math.acos(qs)}((ao*_a+xo*ys)/(lc(ao*ao+xo*xo)*lc(_a*_a+ys*ys)))/2),Vs=lc(Ni[0]*Ni[0]+Ni[1]*Ni[1]);Xn=Co(wn,(L-Vs)/(Lo-1)),Kn=Co(wn,(Y-Vs)/(Lo+1))}}wt>Es?Kn>Es?(We=Ro(Po,ho,gr,Vr,Y,Kn,Be),Ve=Ro(ro,oo,hi,Qr,Y,Kn,Be),v.moveTo(We.cx+We.x01,We.cy+We.y01),Kn<wn?v.arc(We.cx,We.cy,Kn,Ua(We.y01,We.x01),Ua(Ve.y01,Ve.x01),!Be):(v.arc(We.cx,We.cy,Kn,Ua(We.y01,We.x01),Ua(We.y11,We.x11),!Be),v.arc(0,0,Y,Ua(We.cy+We.y11,We.cx+We.x11),Ua(Ve.cy+Ve.y11,Ve.cx+Ve.x11),!Be),v.arc(Ve.cx,Ve.cy,Kn,Ua(Ve.y11,Ve.x11),Ua(Ve.y01,Ve.x01),!Be))):(v.moveTo(gr,Vr),v.arc(0,0,Y,ct,lt,!Be)):v.moveTo(gr,Vr),L>Es&&kt>Es?Xn>Es?(We=Ro(hi,Qr,ro,oo,L,-Xn,Be),Ve=Ro(gr,Vr,Po,ho,L,-Xn,Be),v.lineTo(We.cx+We.x01,We.cy+We.y01),Xn<wn?v.arc(We.cx,We.cy,Xn,Ua(We.y01,We.x01),Ua(Ve.y01,Ve.x01),!Be):(v.arc(We.cx,We.cy,Xn,Ua(We.y01,We.x01),Ua(We.y11,We.x11),!Be),v.arc(0,0,L,Ua(We.cy+We.y11,We.cx+We.x11),Ua(Ve.cy+Ve.y11,Ve.cx+Ve.x11),Be),v.arc(Ve.cx,Ve.cy,Xn,Ua(Ve.y11,Ve.x11),Ua(Ve.y01,Ve.x01),!Be))):v.arc(0,0,L,dt,mt,Be):v.lineTo(hi,Qr)}else v.moveTo(0,0);if(v.closePath(),O)return v=null,O+""||null}return w.centroid=function(){var O=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,N=(+i.apply(this,arguments)+ +s.apply(this,arguments))/2-uf/2;return[Ms(N)*O,cu(N)*O]},w.innerRadius=function(O){return arguments.length?(e=typeof O=="function"?O:Fo(+O),w):e},w.outerRadius=function(O){return arguments.length?(t=typeof O=="function"?O:Fo(+O),w):t},w.cornerRadius=function(O){return arguments.length?(n=typeof O=="function"?O:Fo(+O),w):n},w.padRadius=function(O){return arguments.length?(r=O==null?null:typeof O=="function"?O:Fo(+O),w):r},w.startAngle=function(O){return arguments.length?(i=typeof O=="function"?O:Fo(+O),w):i},w.endAngle=function(O){return arguments.length?(s=typeof O=="function"?O:Fo(+O),w):s},w.padAngle=function(O){return arguments.length?(f=typeof O=="function"?O:Fo(+O),w):f},w.context=function(O){return arguments.length?(v=O==null?null:O,w):v},w}().startAngle(e=>e.startAngle||0).endAngle(e=>e.endAngle||0).padAngle(e=>e.padAngle||0).innerRadius(e=>e.innerRadius||0).outerRadius(e=>e.outerRadius||0).cornerRadius(e=>e.cornerRadius||0),Xg=Kt().x(xh).y1(yp).y0(e=>(e.y||0)+(e.height||0)).defined(Cu),fm=Kt().y(yp).x1(xh).x0(e=>(e.x||0)+(e.width||0)).defined(Cu),hm=Bl().x(xh).y(yp).defined(Cu),Yg=O0().x(xh).y(yp).width(e=>e.width||0).height(e=>e.height||0).cornerRadius(e=>lm(e.cornerRadiusTopLeft,e.cornerRadius)||0,e=>lm(e.cornerRadiusTopRight,e.cornerRadius)||0,e=>lm(e.cornerRadiusBottomRight,e.cornerRadius)||0,e=>lm(e.cornerRadiusBottomLeft,e.cornerRadius)||0),S0=function(e,t){var n=null;function r(){var i;if(n||(n=i=ru()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),i)return n=null,i+""||null}return e=typeof e=="function"?e:Fo(e||fc),t=typeof t=="function"?t:Fo(t===void 0?64:+t),r.type=function(i){return arguments.length?(e=typeof i=="function"?i:Fo(i),r):e},r.size=function(i){return arguments.length?(t=typeof i=="function"?i:Fo(+i),r):t},r.context=function(i){return arguments.length?(n=i==null?null:i,r):n},r}().type(e=>od(e.shape||"circle")).size(e=>lm(e.size,64)),Y0=bh().x(xh).y(yp).defined(Cu).size(e=>e.size||1);function bf(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function Bd(e,t,n,r){return Yg.context(e)(t,n,r)}var og=1;function D0(){og=1}function zf(e,t,n){var r=t.clip,i=e._defs,s=t.clip_id||(t.clip_id="clip"+og++),f=i.clipping[s]||(i.clipping[s]={id:s});return Object(we.E)(r)?f.path=r(null):bf(n)?f.path=Bd(null,n,0,0):(f.width=n.width||0,f.height=n.height||0),"url(#"+s+")"}function pu(e){this.clear(),e&&this.union(e)}function bp(e){this.mark=e,this.bounds=this.bounds||new pu}function dm(e){bp.call(this,e),this.items=this.items||[]}function ag(e){this._pending=0,this._loader=e||Object(lr.e)()}function T0(e){e._pending+=1}function sg(e){e._pending-=1}function ad(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const r=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(r+(n?function(i,s){return i.strokeJoin&&i.strokeJoin!=="miter"?0:s}(t,r):0))}return e}pu.prototype={clone(){return new pu(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,r){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(e,t,n){var{x1:r,y1:i,x2:s,y2:f}=this,v=Math.cos(e),w=Math.sin(e),O=t-t*v+n*w,N=n-t*w-n*v;return[v*r-w*i+O,w*r+v*i+N,v*r-w*f+O,w*r+v*f+N,v*s-w*i+O,w*s+v*i+N,v*s-w*f+O,w*s+v*f+N]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},Object(we.z)(dm,bp),ag.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return T0(t),t._loader.sanitize(e,{context:"href"}).then(n=>(sg(t),n)).catch(()=>(sg(t),null))},loadImage(e){const t=this,n=po();return T0(t),t._loader.sanitize(e,{context:"image"}).then(r=>{const i=r.href;if(!i||!n)throw{url:i};const s=new n,f=Object(we.w)(r,"crossOrigin")?r.crossOrigin:"anonymous";return f!=null&&(s.crossOrigin=f),s.onload=()=>sg(t),s.onerror=()=>sg(t),s.src=i,s}).catch(r=>(sg(t),{complete:!1,width:0,height:0,src:r&&r.url||""}))},ready(){const e=this;return new Promise(t=>{(function n(r){e.pending()?setTimeout(()=>{n(!0)},10):t(r)})(!1)})}};const xv=yf-1e-8;let ug,au,pm,Pd,cg,mm,lg,fg;const sd=(e,t)=>ug.add(e,t),Hl=(e,t)=>sd(au=e,pm=t),N0=e=>sd(e,ug.y1),I0=e=>sd(ug.x1,e),wh=(e,t)=>cg*e+lg*t,gm=(e,t)=>mm*e+fg*t,J0=(e,t)=>sd(wh(e,t),gm(e,t)),Jg=(e,t)=>Hl(wh(e,t),gm(e,t));function hg(e,t){return ug=e,t?(Pd=t*vh,cg=fg=Math.cos(Pd),mm=Math.sin(Pd),lg=-mm):(cg=fg=1,Pd=mm=lg=0),ii}const ii={beginPath(){},closePath(){},moveTo:Jg,lineTo:Jg,rect(e,t,n,r){Pd?(J0(e+n,t),J0(e+n,t+r),J0(e,t+r),Jg(e,t)):(sd(e+n,t+r),Hl(e,t))},quadraticCurveTo(e,t,n,r){const i=wh(e,t),s=gm(e,t),f=wh(n,r),v=gm(n,r);P(au,i,f,N0),P(pm,s,v,I0),Hl(f,v)},bezierCurveTo(e,t,n,r,i,s){const f=wh(e,t),v=gm(e,t),w=wh(n,r),O=gm(n,r),N=wh(i,s),L=gm(i,s);E(au,f,w,N,N0),E(pm,v,O,L,I0),Hl(N,L)},arc(e,t,n,r,i,s){if(r+=Pd,i+=Pd,au=n*Math.cos(i)+e,pm=n*Math.sin(i)+t,Math.abs(i-r)>xv)sd(e-n,t-n),sd(e+n,t+n);else{const f=O=>sd(n*Math.cos(O)+e,n*Math.sin(O)+t);let v,w;if(f(r),f(i),i!==r)if((r%=yf)<0&&(r+=yf),(i%=yf)<0&&(i+=yf),i<r&&(s=!s,v=r,r=i,i=v),s)for(i-=yf,v=r-r%Md,w=0;w<4&&v>i;++w,v-=Md)f(v);else for(v=r-r%Md+Md,w=0;w<4&&v<i;++w,v+=Md)f(v)}}};function P(e,t,n,r){const i=(e-t)/(e+n-2*t);0<i&&i<1&&r(e+(t-e)*i)}function E(e,t,n,r,i){const s=r-e+3*t-3*n,f=e+n-2*t,v=e-t;let w,O=0,N=0;Math.abs(s)>k0?(w=f*f+v*s)>=0&&(O=(-f+(w=Math.sqrt(w)))/s,N=(-f-w)/s):O=.5*v/f,0<O&&O<1&&i(_(O,e,t,n,r)),0<N&&N<1&&i(_(N,e,t,n,r))}function _(e,t,n,r,i){const s=1-e,f=s*s,v=e*e;return f*s*t+3*f*e*n+3*s*v*r+v*e*i}var k=(k=Mu(1,1))?k.getContext("2d"):null;const D=new pu;function q(e){return function(t,n){if(!k)return!0;e(k,t),D.clear().union(t.bounds).intersect(n).round();const{x1:r,y1:i,x2:s,y2:f}=D;for(let v=i;v<=f;++v)for(let w=r;w<=s;++w)if(k.isPointInPath(w,v))return!0;return!1}}function ee(e,t){return t.contains(e.x||0,e.y||0)}function de(e,t){const n=e.x||0,r=e.y||0,i=e.width||0,s=e.height||0;return t.intersects(D.set(n,r,n+i,r+s))}function _e(e,t){const n=e.x||0,r=e.y||0;return Re(t,n,r,e.x2!=null?e.x2:n,e.y2!=null?e.y2:r)}function Re(e,t,n,r,i){const{x1:s,y1:f,x2:v,y2:w}=e,O=r-t,N=i-n;let L,Y,ie,fe,ve=0,Be=1;for(fe=0;fe<4;++fe){if(fe===0&&(L=-O,Y=-(s-t)),fe===1&&(L=O,Y=v-t),fe===2&&(L=-N,Y=-(f-n)),fe===3&&(L=N,Y=w-n),Math.abs(L)<1e-10&&Y<0)return!1;if(ie=Y/L,L<0){if(ie>Be)return!1;ie>ve&&(ve=ie)}else if(L>0){if(ie<ve)return!1;ie<Be&&(Be=ie)}}return!0}function De(e,t){e.globalCompositeOperation=t.blend||"source-over"}function tt(e,t){return e==null?t:e}function st(e,t){const n=t.length;for(let r=0;r<n;++r)e.addColorStop(t[r].offset,t[r].color);return e}function It(e,t,n){return Qm(n)?function(r,i,s){const f=s.width(),v=s.height();let w;if(i.gradient==="radial")w=r.createRadialGradient(s.x1+tt(i.x1,.5)*f,s.y1+tt(i.y1,.5)*v,Math.max(f,v)*tt(i.r1,0),s.x1+tt(i.x2,.5)*f,s.y1+tt(i.y2,.5)*v,Math.max(f,v)*tt(i.r2,.5));else{const O=tt(i.x1,0),N=tt(i.y1,0),L=tt(i.x2,1),Y=tt(i.y2,0);if(O!==L&&N!==Y&&f!==v){const ie=Mu(Math.ceil(f),Math.ceil(v)),fe=ie.getContext("2d");return fe.scale(f,v),fe.fillStyle=st(fe.createLinearGradient(O,N,L,Y),i.stops),fe.fillRect(0,0,f,v),r.createPattern(ie,"no-repeat")}w=r.createLinearGradient(s.x1+O*f,s.y1+N*v,s.x1+L*f,s.y1+Y*v)}return st(w,i.stops)}(e,n,t.bounds):n}function Bt(e,t,n){return(n*=t.fillOpacity==null?1:t.fillOpacity)>0&&(e.globalAlpha=n,e.fillStyle=It(e,t,t.fill),!0)}var mn=[];function xn(e,t,n){var r=(r=t.strokeWidth)!=null?r:1;return!(r<=0)&&(n*=t.strokeOpacity==null?1:t.strokeOpacity)>0&&(e.globalAlpha=n,e.strokeStyle=It(e,t,t.stroke),e.lineWidth=r,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||mn),e.lineDashOffset=t.strokeDashOffset||0),!0)}function Fn(e,t){return e.zindex-t.zindex||e.index-t.index}function Rn(e){if(!e.zdirty)return e.zitems;var t,n,r,i=e.items,s=[];for(n=0,r=i.length;n<r;++n)(t=i[n]).index=n,t.zindex&&s.push(t);return e.zdirty=!1,e.zitems=s.sort(Fn)}function Ln(e,t){var n,r,i=e.items;if(!i||!i.length)return;const s=Rn(e);if(s&&s.length){for(n=0,r=i.length;n<r;++n)i[n].zindex||t(i[n]);i=s}for(n=0,r=i.length;n<r;++n)t(i[n])}function Zn(e,t){var n,r,i=e.items;if(!i||!i.length)return null;const s=Rn(e);for(s&&s.length&&(i=s),r=i.length;--r>=0;)if(n=t(i[r]))return n;if(i===s){for(r=(i=e.items).length;--r>=0;)if(!i[r].zindex&&(n=t(i[r])))return n}return null}function An(e){return function(t,n,r){Ln(n,i=>{r&&!r.intersects(i.bounds)||Sr(e,t,i,i)})}}function Sr(e,t,n,r){var i=n.opacity==null?1:n.opacity;i!==0&&(e(t,r)||(De(t,n),n.fill&&Bt(t,n,i)&&t.fill(),n.stroke&&xn(t,n,i)&&t.stroke()))}function Ur(e){return e=e||we.Ia,function(t,n,r,i,s,f){return r*=t.pixelRatio,i*=t.pixelRatio,Zn(n,v=>{const w=v.bounds;if((!w||w.contains(s,f))&&w)return e(t,v,r,i,s,f)?v:void 0})}}function Wr(e,t){return function(n,r,i,s){var f,v,w=Array.isArray(r)?r[0]:r,O=t==null?w.fill:t,N=w.stroke&&n.isPointInStroke;return N&&(f=w.strokeWidth,v=w.strokeCap,n.lineWidth=f!=null?f:1,n.lineCap=v!=null?v:"butt"),!e(n,r)&&(O&&n.isPointInPath(i,s)||N&&n.isPointInStroke(i,s))}}function ci(e){return Ur(Wr(e))}function Jr(e,t){return"translate("+e+","+t+")"}function Xi(e){return"rotate("+e+")"}function lo(e){return Jr(e.x||0,e.y||0)}function io(e,t,n){function r(i,s){var f=s.x||0,v=s.y||0,w=s.angle||0;i.translate(f,v),w&&i.rotate(w*=vh),i.beginPath(),t(i,s),w&&i.rotate(-w),i.translate(-f,-v)}return{type:e,tag:"path",nested:!1,attr:function(i,s){i("transform",function(f){return Jr(f.x||0,f.y||0)+(f.angle?" "+Xi(f.angle):"")}(s)),i("d",t(null,s))},bound:function(i,s){return t(hg(i,s.angle),s),ad(i,s).translate(s.x||0,s.y||0)},draw:An(r),pick:ci(r),isect:n||q(r)}}var ga=io("arc",function(e,t){return ig.context(e)(t)});function Ya(e,t,n){function r(s,f){s.beginPath(),t(s,f)}const i=Wr(r);return{type:e,tag:"path",nested:!0,attr:function(s,f){var v=f.mark.items;v.length&&s("d",t(null,v))},bound:function(s,f){var v=f.items;return v.length===0?s:(t(hg(s),v),ad(s,v[0]))},draw:function(s){return function(f,v,w){!v.items.length||w&&!w.intersects(v.bounds)||Sr(s,f,v.items[0],v.items)}}(r),pick:function(s,f,v,w,O,N){var L=f.items,Y=f.bounds;return!L||!L.length||Y&&!Y.contains(O,N)?null:(v*=s.pixelRatio,w*=s.pixelRatio,i(s,L,v,w)?L[0]:null)},isect:ee,tip:n}}var Ta=Ya("area",function(e,t){const n=t[0],r=n.interpolate||"linear";return(n.orient==="horizontal"?fm:Xg).curve(Uu(r,n.orient,n.tension)).context(e)(t)},function(e,t){for(var n,r,i=e[0].orient==="horizontal"?t[1]:t[0],s=e[0].orient==="horizontal"?"y":"x",f=e.length,v=1/0;--f>=0;)e[f].defined!==!1&&(r=Math.abs(e[f][s]-i))<v&&(v=r,n=e[f]);return n});function Aa(e,t){e.beginPath(),bf(t)?Bd(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function Ma(e){const t=tt(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function rs(e,t){const n=Ma(t);e("d",Bd(null,t,n,n))}function va(e,t,n,r){const i=Ma(t);e.beginPath(),Bd(e,t,(n||0)+i,(r||0)+i)}const Ns=Wr(va),Tc=Wr(va,!1),Ji=Wr(va,!0);var Hi={type:"group",tag:"g",nested:!1,attr:function(e,t){e("transform",lo(t))},bound:function(e,t){if(!t.clip&&t.items){const n=t.items,r=n.length;for(let i=0;i<r;++i)e.union(n[i].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),ad(e,t),e.translate(t.x||0,t.y||0)},draw:function(e,t,n){Ln(t,r=>{const i=r.x||0,s=r.y||0,f=r.strokeForeground,v=r.opacity==null?1:r.opacity;(r.stroke||r.fill)&&v&&(va(e,r,i,s),De(e,r),r.fill&&Bt(e,r,v)&&e.fill(),r.stroke&&!f&&xn(e,r,v)&&e.stroke()),e.save(),e.translate(i,s),r.clip&&Aa(e,r),n&&n.translate(-i,-s),Ln(r,w=>{this.draw(e,w,n)}),n&&n.translate(i,s),e.restore(),f&&r.stroke&&v&&(va(e,r,i,s),De(e,r),xn(e,r,v)&&e.stroke())})},pick:function(e,t,n,r,i,s){if(t.bounds&&!t.bounds.contains(i,s)||!t.items)return null;const f=n*e.pixelRatio,v=r*e.pixelRatio;return Zn(t,w=>{let O,N,L;const Y=w.bounds;if(Y&&!Y.contains(i,s))return;N=w.x||0,L=w.y||0;const ie=N+(w.width||0),fe=L+(w.height||0),ve=w.clip;if(ve&&(i<N||i>ie||s<L||s>fe))return;if(e.save(),e.translate(N,L),N=i-N,L=s-L,ve&&bf(w)&&!Ji(e,w,f,v))return e.restore(),null;const Be=w.strokeForeground,We=t.interactive!==!1;return We&&Be&&w.stroke&&Tc(e,w,f,v)?(e.restore(),w):(!(O=Zn(w,Ve=>function(ct,lt,mt){return(ct.interactive!==!1||ct.marktype==="group")&&ct.bounds&&ct.bounds.contains(lt,mt)}(Ve,N,L)?this.pick(Ve,n,r,N,L):null))&&We&&(w.fill||!Be&&w.stroke)&&Ns(e,w,f,v)&&(O=w),e.restore(),O||null)})},isect:de,content:function(e,t,n){e("clip-path",t.clip?zf(n,t,t):null)},background:function(e,t){e("class","background"),e("aria-hidden",!0),rs(e,t)},foreground:function(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?rs(e,t):e("d","")}},mu={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function os(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(r=>{e.image=r,e.image.url=e.url})),n}function ya(e,t){return e.width!=null?e.width:t&&t.width?e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width:0}function cl(e,t){return e.height!=null?e.height:t&&t.height?e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height:0}function gu(e,t){return e==="center"?t/2:e==="right"?t:0}function ll(e,t){return e==="middle"?t/2:e==="bottom"?t:0}var xp={type:"image",tag:"image",nested:!1,attr:function(e,t,n){const r=os(t,n),i=ya(t,r),s=cl(t,r),f=(t.x||0)-gu(t.align,i),v=(t.y||0)-ll(t.baseline,s);e("href",!r.src&&r.toDataURL?r.toDataURL():r.src||"",mu["xmlns:xlink"],"xlink:href"),e("transform",Jr(f,v)),e("width",i),e("height",s),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")},bound:function(e,t){const n=t.image,r=ya(t,n),i=cl(t,n),s=(t.x||0)-gu(t.align,r),f=(t.y||0)-ll(t.baseline,i);return e.set(s,f,s+r,f+i)},draw:function(e,t,n){Ln(t,r=>{if(n&&!n.intersects(r.bounds))return;const i=os(r,this);let s=ya(r,i),f=cl(r,i);if(s===0||f===0)return;let v,w,O,N,L=(r.x||0)-gu(r.align,s),Y=(r.y||0)-ll(r.baseline,f);r.aspect!==!1&&(w=i.width/i.height,O=r.width/r.height,w==w&&O==O&&w!==O&&(O<w?(Y+=(f-(N=s/w))/2,f=N):(L+=(s-(N=f*w))/2,s=N))),(i.complete||i.toDataURL)&&(De(e,r),e.globalAlpha=(v=r.opacity)!=null?v:1,e.imageSmoothingEnabled=r.smooth!==!1,e.drawImage(i,L,Y,s,f))})},pick:Ur(),isect:we.Ia,get:os,xOffset:gu,yOffset:ll},Ld=Ya("line",function(e,t){const n=t[0],r=n.interpolate||"linear";return hm.curve(Uu(r,n.orient,n.tension)).context(e)(t)},function(e,t){for(var n,r,i=Math.pow(e[0].strokeWidth||1,2),s=e.length;--s>=0;)if(e[s].defined!==!1&&(n=e[s].x-t[0])*n+(r=e[s].y-t[1])*r<i)return e[s];return null});function kh(e,t){var n=t.path;if(n==null)return!0;var r=t.x||0,i=t.y||0,s=t.scaleX||1,f=t.scaleY||1,v=(t.angle||0)*vh,w=t.pathCache;w&&w.path===n||((t.pathCache=w=mp(n)).path=n),v&&e.rotate&&e.translate?(e.translate(r,i),e.rotate(v),vp(e,w,0,0,s,f),e.rotate(-v),e.translate(-r,-i)):vp(e,w,r,i,s,f)}var ud={type:"path",tag:"path",nested:!1,attr:function(e,t){var n=t.scaleX||1,r=t.scaleY||1;n===1&&r===1||e("vector-effect","non-scaling-stroke"),e("transform",function(i){return Jr(i.x||0,i.y||0)+(i.angle?" "+Xi(i.angle):"")+(i.scaleX||i.scaleY?" "+function(s,f){return"scale("+s+","+f+")"}(i.scaleX||1,i.scaleY||1):"")}(t)),e("d",t.path)},bound:function(e,t){return kh(hg(e,t.angle),t)?e.set(0,0,0,0):ad(e,t,!0)},draw:An(kh),pick:ci(kh),isect:q(kh)};function xf(e,t){e.beginPath(),Bd(e,t)}var Gl={type:"rect",tag:"path",nested:!1,attr:function(e,t){e("d",Bd(null,t))},bound:function(e,t){var n,r;return ad(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)},draw:An(xf),pick:ci(xf),isect:de};function Ja(e,t,n){var r,i,s,f;return!(!t.stroke||!xn(e,t,n))&&(r=t.x||0,i=t.y||0,s=t.x2!=null?t.x2:r,f=t.y2!=null?t.y2:i,e.beginPath(),e.moveTo(r,i),e.lineTo(s,f),!0)}var _h={type:"rule",tag:"line",nested:!1,attr:function(e,t){e("transform",lo(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)},bound:function(e,t){var n,r;return ad(e.set(n=t.x||0,r=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:r),t)},draw:function(e,t,n){Ln(t,r=>{if(!n||n.intersects(r.bounds)){var i=r.opacity==null?1:r.opacity;i&&Ja(e,r,i)&&(De(e,r),e.stroke())}})},pick:Ur(function(e,t,n,r){return!!e.isPointInStroke&&Ja(e,t,1)&&e.isPointInStroke(n,r)}),isect:_e},Uf=io("shape",function(e,t){return(t.mark.shape||t.shape).context(e)(t)}),gs=io("symbol",function(e,t){return S0.context(e)(t)},ee);const as=Object(we.N)();var Au={height:$l,measureWidth:Wf,estimateWidth:wp,width:wp,canvas:zd};function zd(e){Au.width=e&&k?Wf:wp}function wp(e,t){return kp(Eh(e,t),$l(e))}function kp(e,t){return~~(.8*e.length*t)}function Wf(e,t){return $l(e)<=0||!(t=Eh(e,t))?0:vm(t,Ch(e))}function vm(e,t){const n=`(${t}) ${e}`;let r=as.get(n);return r===void 0&&(k.font=t,r=k.measureText(e).width,as.set(n,r)),r}function $l(e){return e.fontSize!=null?+e.fontSize||0:11}function Wu(e){return e.lineHeight!=null?e.lineHeight:$l(e)+2}function pc(e){return function(t){return Object(we.B)(t)?t.length>1?t:t[0]:t}(e.lineBreak&&e.text&&!Object(we.B)(e.text)?e.text.split(e.lineBreak):e.text)}function vu(e){const t=pc(e);return(Object(we.B)(t)?t.length-1:0)*Wu(e)}function Eh(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?function(r,i){var s=+r.limit,f=function(Y){if(Au.width===Wf){const ie=Ch(Y);return fe=>vm(fe,ie)}{const ie=$l(Y);return fe=>kp(fe,ie)}}(r);if(f(i)<s)return i;var v,w=r.ellipsis||"\u2026",O=r.dir==="rtl",N=0,L=i.length;if(s-=f(w),O){for(;N<L;)v=N+L>>>1,f(i.slice(v))>s?N=v+1:L=v;return w+i.slice(N)}for(;N<L;)v=1+(N+L>>>1),f(i.slice(0,v))<s?N=v:L=v-1;return i.slice(0,N)+w}(e,n):n}function cd(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function Ch(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+$l(e)+"px "+cd(e,t)}function Vu(e){var t=e.baseline,n=$l(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*Wu(e):t==="line-bottom"?.29*n-.5*Wu(e):0)}zd(!0);const Vf={left:"start",center:"middle",right:"end"},Ah=new pu;function Wc(e){var t,n=e.x||0,r=e.y||0,i=e.radius||0;return i&&(t=(e.theta||0)-Md,n+=i*Math.cos(t),r+=i*Math.sin(t)),Ah.x1=n,Ah.y1=r,Ah}function wv(e,t,n){var r,i=Au.height(t),s=t.align,f=Wc(t),v=f.x1,w=f.y1,O=t.dx||0,N=(t.dy||0)+Vu(t)-Math.round(.8*i),L=pc(t);if(Object(we.B)(L)?(i+=Wu(t)*(L.length-1),r=L.reduce((Y,ie)=>Math.max(Y,Au.width(t,ie)),0)):r=Au.width(t,L),s==="center"?O-=r/2:s==="right"&&(O-=r),e.set(O+=v,N+=w,O+r,N+i),t.angle&&!n)e.rotate(t.angle*vh,v,w);else if(n===2)return e.rotatedPoints(t.angle*vh,v,w);return e}var Oh={arc:ga,area:Ta,group:Hi,image:xp,line:Ld,path:ud,rect:Gl,rule:_h,shape:Uf,symbol:gs,text:{type:"text",tag:"text",nested:!1,attr:function(e,t){var n,r=t.dx||0,i=(t.dy||0)+Vu(t),s=Wc(t),f=s.x1,v=s.y1,w=t.angle||0;e("text-anchor",Vf[t.align]||"start"),w?(n=Jr(f,v)+" "+Xi(w),(r||i)&&(n+=" "+Jr(r,i))):n=Jr(f+r,v+i),e("transform",n)},bound:wv,draw:function(e,t,n){Ln(t,r=>{var i,s,f,v,w,O,N,L=r.opacity==null?1:r.opacity;if(!(n&&!n.intersects(r.bounds)||L===0||r.fontSize<=0||r.text==null||r.text.length===0)){if(e.font=Ch(r),e.textAlign=r.align||"left",s=(i=Wc(r)).x1,f=i.y1,r.angle&&(e.save(),e.translate(s,f),e.rotate(r.angle*vh),s=f=0),s+=r.dx||0,f+=(r.dy||0)+Vu(r),O=pc(r),De(e,r),Object(we.B)(O))for(w=Wu(r),v=0;v<O.length;++v)N=Eh(r,O[v]),r.fill&&Bt(e,r,L)&&e.fillText(N,s,f),r.stroke&&xn(e,r,L)&&e.strokeText(N,s,f),f+=w;else N=Eh(r,O),r.fill&&Bt(e,r,L)&&e.fillText(N,s,f),r.stroke&&xn(e,r,L)&&e.strokeText(N,s,f);r.angle&&e.restore()}})},pick:Ur(function(e,t,n,r,i,s){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var f=Wc(t),v=f.x1,w=f.y1,O=wv(Ah,t,1),N=-t.angle*vh,L=Math.cos(N),Y=Math.sin(N),ie=L*i-Y*s+(v-L*v+Y*w),fe=Y*i+L*s+(w-Y*v-L*w);return O.contains(ie,fe)}),isect:function(e,t){const n=wv(Ah,e,2);return Re(t,n[0],n[1],n[2],n[3])||Re(t,n[0],n[1],n[4],n[5])||Re(t,n[4],n[5],n[6],n[7])||Re(t,n[2],n[3],n[6],n[7])}},trail:Ya("trail",function(e,t){return Y0.context(e)(t)},function(e,t){for(var n,r,i=e.length;--i>=0;)if(e[i].defined!==!1&&(n=e[i].x-t[0])*n+(r=e[i].y-t[1])*r<(n=e[i].size||1)*n)return e[i];return null})};function _p(e,t,n){var r=Oh[e.mark.marktype],i=t||r.bound;return r.nested&&(e=e.mark),i(e.bounds||(e.bounds=new pu),e,n)}var Q0={mark:null};function ld(e,t,n){var r,i,s,f,v=Oh[e.marktype],w=v.bound,O=e.items,N=O&&O.length;if(v.nested)return N?s=O[0]:(Q0.mark=e,s=Q0),f=_p(s,w,n),t=t&&t.union(f)||f;if(t=t||e.bounds&&e.bounds.clear()||new pu,N)for(r=0,i=O.length;r<i;++r)t.union(_p(O[r],w,n));return e.bounds=t}const ua=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function Qg(e,t){return JSON.stringify(e,ua,t)}function Kl(e){return function t(n){var r,i,s,f=n.marktype,v=n.items;if(v)for(i=0,s=v.length;i<s;++i)r=f?"mark":"group",v[i][r]=n,v[i].zindex&&(v[i][r].zdirty=!0),(f||r)==="group"&&t(v[i]);return f&&ld(n),n}(typeof e=="string"?JSON.parse(e):e)}function Zg(e){arguments.length?this.root=Kl(e):(this.root=Z0({marktype:"group",name:"root",role:"frame"}),this.root.items=[new dm(this.root)])}function Z0(e,t){const n={bounds:new pu,clip:!!e.clip,group:t,interactive:e.interactive!==!1,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return e.aria!=null&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function ca(e,t,n){return!e&&typeof document!="undefined"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function kv(e,t){t=t.toLowerCase();for(var n=e.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===t)return n[r]}function Cl(e,t,n,r){var i,s=e.childNodes[t];return s&&s.tagName.toLowerCase()===n.toLowerCase()||(i=s||null,s=ca(e.ownerDocument,n,r),e.insertBefore(s,i)),s}function wf(e,t){for(var n=e.childNodes,r=n.length;r>t;)e.removeChild(n[--r]);return e}function b(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function h(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function u(e,t){this._active=null,this._handlers={},this._loader=e||Object(lr.e)(),this._tooltip=t||d}function d(e,t,n,r){e.element().setAttribute("title",r||"")}function x(e){this._el=null,this._bgcolor=null,this._loader=new ag(e)}Zg.prototype={toJSON(e){return Qg(this.root,e||0)},mark(e,t,n){const r=Z0(e,t=t||this.root.items[0]);return t.items[n]=r,r.zindex&&(r.group.zdirty=!0),r}},u.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let r=e?e.length:0;--r>=0;)if(e[r].type===t&&(!n||e[r].handler===n))return r;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const r in t)n.push(...t[r]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then(r=>{const i=new MouseEvent(e.type,e),s=ca(null,"a");for(const f in r)s.setAttribute(f,r[f]);s.dispatchEvent(i)}).catch(()=>{})},handleTooltip(e,t,n){if(t&&t.tooltip!=null){t=function(i,s,f,v){var w,O,N=i&&i.mark;if(N&&(w=Oh[N.marktype]).tip){for((O=h(s,f))[0]-=v[0],O[1]-=v[1];i=i.mark.group;)O[0]-=i.x||0,O[1]-=i.y||0;i=w.tip(N.items,O)}return i}(t,e,this.canvas(),this._origin);const r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,s=i.width(),f=i.height();let v=i.x1+r[0]+n.left,w=i.y1+r[1]+n.top;for(;e.mark&&(e=e.mark.group);)v+=e.x||0,w+=e.y||0;return{x:v,y:w,width:s,height:f,left:v,top:w,right:v+s,bottom:w+f}}},x.prototype={initialize(e,t,n,r,i){return this._el=e,this.resize(t,n,r,i)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,r){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=r||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then(()=>t):Promise.resolve(t)},_load(e,t){var n=this,r=n._loader[e](t);if(!n._ready){const i=n._call;n._ready=n._loader.ready().then(s=>{s&&i(),n._ready=null})}return r},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const T="dragleave",H="mousedown",Z="mousemove",ce="mouseout",ye="click",Ee=["keydown","keypress","keyup","dragenter",T,"dragover",H,"mouseup",Z,ce,"mouseover",ye,"dblclick","wheel","mousewheel","touchstart","touchmove","touchend"],je=Z,Pe=ce,ze=ye;function Ge(e,t){u.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}const rt=e=>e==="touchstart"||e==="touchmove"||e==="touchend"?["touchstart","touchmove","touchend"]:[e];function it(e,t){rt(t).forEach(n=>function(r,i){const s=r.canvas();s&&!r._events[i]&&(r._events[i]=1,s.addEventListener(i,r[i]?f=>r[i](f):f=>r.fire(i,f)))}(e,n))}function ht(e,t,n){return function(r){const i=this._active,s=this.pickEvent(r);s===i?this.fire(e,r):(i&&i.exit||this.fire(n,r),this._active=s,this.fire(t,r),this.fire(e,r))}}function Et(e){return function(t){this.fire(e,t),this._active=null}}Object(we.z)(Ge,u,{initialize(e,t,n){return this._canvas=e&&kv(e,"canvas"),[ye,H,Z,ce,T].forEach(r=>it(this,r)),u.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:Ee,DOMMouseScroll(e){this.fire("mousewheel",e)},mousemove:ht(Z,"mouseover",ce),dragover:ht("dragover","dragenter",T),mouseout:Et(ce),dragleave:Et(T),mousedown(e){this._down=this._active,this.fire(H,e)},click(e){this._down===this._active&&(this.fire(ye,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire("touchstart",e,!0)},touchmove(e){this.fire("touchmove",e,!0)},touchend(e){this.fire("touchend",e,!0),this._touch=null},fire(e,t,n){const r=n?this._touch:this._active,i=this._handlers[e];if(t.vegaType=e,e===ze&&r&&r.href?this.handleHref(t,r,r.href):e!==je&&e!==Pe||this.handleTooltip(t,r,e!==Pe),i)for(let s=0,f=i.length;s<f;++s)i[s].handler.call(this._obj,t,r)},on(e,t){const n=this.eventName(e),r=this._handlers;return this._handlerIndex(r[n],e,t)<0&&(it(this,e),(r[n]||(r[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&r.splice(i,1),this},pickEvent(e){const t=h(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,r,i){const s=this.context();return Oh[e.marktype].pick.call(this,s,e,t,n,r,i)}});var At=typeof window!="undefined"&&window.devicePixelRatio||1;function St(e){x.call(this,e),this._options={},this._redraw=!1,this._dirty=new pu,this._tempb=new pu}const Gt=x.prototype;function un(e,t){u.call(this,e,t);const n=this;n._hrefHandler=vn(n,(r,i)=>{i&&i.href&&n.handleHref(r,i,i.href)}),n._tooltipHandler=vn(n,(r,i)=>{n.handleTooltip(r,i,r.type!==Pe)})}Object(we.z)(St,x,{initialize(e,t,n,r,i,s){return this._options=s||{},this._canvas=this._options.externalContext?null:Mu(1,1,this._options.type),e&&this._canvas&&(wf(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),Gt.initialize.call(this,e,t,n,r,i)},resize(e,t,n,r){if(Gt.resize.call(this,e,t,n,r),this._canvas)(function(i,s,f,v,w,O){const N=typeof HTMLElement!="undefined"&&i instanceof HTMLElement&&i.parentNode!=null,L=i.getContext("2d"),Y=N?At:w;i.width=s*Y,i.height=f*Y;for(const ie in O)L[ie]=O[ie];N&&Y!==1&&(i.style.width=s+"px",i.style.height=f+"px"),L.pixelRatio=Y,L.setTransform(Y,0,0,Y,Y*v[0],Y*v[1])})(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const i=this._options.externalContext;i||Object(we.o)("CanvasRenderer is missing a valid canvas or context"),i.scale(this._scale,this._scale),i.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,r=this._width,i=this._height,s=this._dirty,f=((w,O,N)=>new pu().set(0,0,O,N).translate(-w[0],-w[1]))(n,r,i);t.save();const v=this._redraw||s.empty()?(this._redraw=!1,f.expand(1)):function(w,O,N){return O.expand(1).round(),w.pixelRatio%1&&O.scale(w.pixelRatio).round().scale(1/w.pixelRatio),O.translate(-N[0]%1,-N[1]%1),w.beginPath(),w.rect(O.x1,O.y1,O.width(),O.height()),w.clip(),O}(t,f.intersect(s),n);return this.clear(-n[0],-n[1],r,i),this.draw(t,e,v),t.restore(),s.clear(),this},draw(e,t,n){const r=Oh[t.marktype];t.clip&&function(i,s){var f=s.clip;i.save(),Object(we.E)(f)?(i.beginPath(),f(i),i.clip()):Aa(i,s.group)}(e,t),r.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,r){const i=this._options,s=this.context();i.type==="pdf"||i.externalContext||s.clearRect(e,t,n,r),this._bgcolor!=null&&(s.fillStyle=this._bgcolor,s.fillRect(e,t,n,r))}});const vn=(e,t)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,t.call(e._obj,n,r)};Object(we.z)(un,u,{initialize(e,t,n){let r=this._svg;return r&&(r.removeEventListener(ze,this._hrefHandler),r.removeEventListener(je,this._tooltipHandler),r.removeEventListener(Pe,this._tooltipHandler)),this._svg=r=e&&kv(e,"svg"),r&&(r.addEventListener(ze,this._hrefHandler),r.addEventListener(je,this._tooltipHandler),r.addEventListener(Pe,this._tooltipHandler)),u.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),r=this._handlers;if(this._handlerIndex(r[n],e,t)<0){const i={type:e,handler:t,listener:vn(this,t)};(r[n]||(r[n]=[])).push(i),this._svg&&this._svg.addEventListener(n,i.listener)}return this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}});const cn="aria-hidden",kn="aria-label",On="role",p="aria-roledescription",c="graphics-object",a="graphics-symbol",l=(e,t,n)=>({[On]:e,[p]:t,[kn]:n||void 0}),y=Object(we.Fa)(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),S={axis:{desc:"axis",caption:function(e){const t=e.datum,n=e.orient,r=t.title?be(e):null,i=e.context,s=i.scales[t.scale].value,f=i.dataflow.locale(),v=s.type;return`${n==="left"||n==="right"?"Y":"X"}-axis`+(r?` titled '${r}'`:"")+` for a ${Zh(v)?"discrete":v} scale with ${x0(f,s,e)}`}},legend:{desc:"legend",caption:function(e){const t=e.datum,n=t.title?be(e):null,r=`${t.type||""} legend`.trim(),i=t.scales,s=Object.keys(i),f=e.context,v=f.scales[i[s[0]]].value,w=f.dataflow.locale();return function(O){return O.length?O[0].toUpperCase()+O.slice(1):O}(r)+(n?` titled '${n}'`:"")+` for ${function(O){return(O=O.map(N=>N+(N==="fill"||N==="stroke"?" color":""))).length<2?O[0]:O.slice(0,-1).join(", ")+" and "+Object(we.W)(O)}(s)} with ${x0(w,v,e)}`}},"title-text":{desc:"title",caption:e=>`Title text '${le(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${le(e)}'`}},U={ariaRole:On,ariaRoleDescription:p,description:kn};function G(e,t){const n=t.aria===!1;if(e(cn,n||void 0),n||t.description==null)for(const r in U)e(U[r],void 0);else{const r=t.mark.marktype;e(kn,t.description),e(On,t.ariaRole||(r==="group"?c:a)),e(p,t.ariaRoleDescription||`${r} mark`)}}function ae(e){return e.aria===!1?{[cn]:!0}:y[e.role]?null:S[e.role]?function(t,n){try{const r=t.items[0],i=n.caption||(()=>"");return l(n.role||a,n.desc,r.description||i(r))}catch{return null}}(e,S[e.role]):function(t){const n=t.marktype,r=n==="group"||n==="text"||t.items.some(i=>i.description!=null&&i.aria!==!1);return l(r?c:a,`${n} mark container`,t.description)}(e)}function le(e){return Object(we.i)(e.text).join(" ")}function be(e){try{return Object(we.i)(Object(we.W)(e.items).items[0].text).join(" ")}catch{return null}}const Se=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),Ie=e=>Se(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function Me(){let e="",t="",n="";const r=[],i=()=>t=n="",s=(v,w)=>(w!=null&&(t+=` ${v}="${Ie(w)}"`),f),f={open(v,...w){(O=>{t&&(e+=`${t}>${n}`,i()),r.push(O)})(v),t="<"+v;for(const O of w)for(const N in O)s(N,O[N]);return f},close(){const v=r.pop();return e+=t?t+(n?`>${n}</${v}>`:"/>"):`</${v}>`,i(),f},attr:s,text:v=>(n+=Se(v),f),toString:()=>e};return f}const qe=e=>function t(n,r){if(n.open(r.tagName),r.hasAttributes()){const i=r.attributes,s=i.length;for(let f=0;f<s;++f)n.attr(i[f].name,i[f].value)}if(r.hasChildNodes()){const i=r.childNodes,s=i.length;for(let f=0;f<s;f++){const v=i[f];v.nodeType===3?n.text(v.nodeValue):t(n,v)}}return n.close()}(Me(),e)+"",Ye={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},Xe={fill:"none","stroke-miterlimit":10},at=mu.xmlns;function gt(e){x.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const bt=x.prototype;function _t(e,t){for(;e&&e.dirty!==t;e=e.mark.group){if(e.dirty=t,!e.mark||e.mark.dirty===t)return;e.mark.dirty=t}}function jt(e,t,n){let r,i,s;if(t.gradient==="radial"){let f=Cl(e,n++,"pattern",at);fr(f,{id:gh+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),fr(f=Cl(f,0,"rect",at),{width:1,height:1,fill:`url(${Cr()}#${t.id})`}),fr(e=Cl(e,n++,"radialGradient",at),{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else fr(e=Cl(e,n++,"linearGradient",at),{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(r=0,i=t.stops.length;r<i;++r)(s=Cl(e,r,"stop",at)).setAttribute("offset",t.stops[r].offset),s.setAttribute("stop-color",t.stops[r].color);return wf(e,r),n}function Qt(e,t,n){let r;return(e=Cl(e,n,"clipPath",at)).setAttribute("id",t.id),t.path?(r=Cl(e,0,"path",at)).setAttribute("d",t.path):fr(r=Cl(e,0,"rect",at),{x:0,y:0,width:t.width,height:t.height}),wf(e,1),n+1}function sn(e,t,n,r,i){let s,f=e._svg;if(!f&&(f=ca(s=t.ownerDocument,r,at),e._svg=f,e.mark&&(f.__data__=e,f.__values__={fill:"default"},r==="g"))){const v=ca(s,"path",at);f.appendChild(v),v.__data__=e;const w=ca(s,"g",at);f.appendChild(w),w.__data__=e;const O=ca(s,"path",at);f.appendChild(O),O.__data__=e,O.__values__={fill:"default"}}return(f.ownerSVGElement!==i||function(v,w){return v.parentNode&&v.parentNode.childNodes.length>1&&v.previousSibling!=w}(f,n))&&t.insertBefore(f,n?n.nextSibling:t.firstChild),f}Object(we.z)(gt,x,{initialize(e,t,n,r,i){return this._defs={},this._clearDefs(),e&&(this._svg=Cl(e,0,"svg",at),this._svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns",at),this._svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink",mu["xmlns:xlink"]),this._svg.setAttribute("version",mu.version),this._svg.setAttribute("class","marks"),wf(e,1),this._root=Cl(this._svg,0,"g",at),fr(this._root,Xe),wf(this._svg,1)),this.background(this._bgcolor),bt.initialize.call(this,e,t,n,r,i)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),bt.background.apply(this,arguments)},resize(e,t,n,r){return bt.resize.call(this,e,t,n,r),this._svg&&(fr(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),fr(n=Cl(e,0,"rect",at),{width:this._width,height:this._height,fill:t}));const r=qe(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),r},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),wf(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,r,i,s,f,v,w;for(f=0,v=e.length;f<v;++f)(r=(n=e[f]).mark).marktype!==i&&(i=r.marktype,s=Oh[i]),r.zdirty&&r.dirty!==t&&(this._dirtyAll=!1,_t(n,t),r.items.forEach(O=>{O.dirty=t})),r.zdirty||(n.exit?(s.nested&&r.items.length?(w=r.items[0])._svg&&this._update(s,w._svg,w):n._svg&&(w=n._svg.parentNode)&&w.removeChild(n._svg),n._svg=null):(n=s.nested?r.items[0]:n)._update!==t&&(n._svg&&n._svg.ownerSVGElement?this._update(s,n._svg,n):(this._dirtyAll=!1,_t(n,t)),n._update=t));return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const r=this._svg,i=Oh[t.marktype],s=t.interactive===!1?"none":null,f=i.tag==="g";let v=null,w=0;const O=sn(t,e,n,"g",r);O.setAttribute("class",b(t));const N=ae(t);for(const Y in N)yr(O,Y,N[Y]);f||yr(O,"pointer-events",s),yr(O,"clip-path",t.clip?zf(this,t,t.group):null);const L=Y=>{const ie=this.isDirty(Y),fe=sn(Y,O,v,i.tag,r);ie&&(this._update(i,fe,Y),f&&function(ve,Be,We){Be=Be.lastChild.previousSibling;let Ve,ct=0;Ln(We,lt=>{Ve=ve.mark(Be,lt,Ve),++ct}),wf(Be,1+ct)}(this,fe,Y)),v=fe,++w};return i.nested?t.items.length&&L(t.items[0]):Ln(t,L),wf(O,w),O},_update(e,t,n){Zt=t,rn=t.__values__,G(Bn,n),e.attr(Bn,n,this);const r=Sn[e.type];r&&r.call(this,e,t,n),Zt&&this.style(Zt,n)},style(e,t){if(t!=null)for(const n in Ye){let r=n==="font"?cd(t):t[n];if(r===rn[n])continue;const i=Ye[n];r==null?e.removeAttribute(i):(Qm(r)&&(r=Hg(r,this._defs.gradient,Cr())),e.setAttribute(i,r+"")),rn[n]=r}},defs(){const e=this._svg,t=this._defs;let n=t.el,r=0;for(const i in t.gradient)n||(t.el=n=Cl(e,1,"defs",at)),r=jt(n,t.gradient[i],r);for(const i in t.clipping)n||(t.el=n=Cl(e,1,"defs",at)),r=Qt(n,t.clipping[i],r);n&&(r===0?(e.removeChild(n),t.el=null):wf(n,r))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});let Zt=null,rn=null;const Sn={group(e,t,n){const r=Zt=t.childNodes[2];rn=r.__values__,e.foreground(Bn,n,this),rn=t.__values__,Zt=t.childNodes[1],e.content(Bn,n,this);const i=Zt=t.childNodes[0];e.background(Bn,n,this);const s=n.mark.interactive===!1?"none":null;if(s!==rn.events&&(yr(r,"pointer-events",s),yr(i,"pointer-events",s),rn.events=s),n.strokeForeground&&n.stroke){const f=n.fill;yr(r,"display",null),this.style(i,n),yr(i,"stroke",null),f&&(n.fill=null),rn=r.__values__,this.style(r,n),f&&(n.fill=f),Zt=null}else yr(r,"display","none")},image(e,t,n){n.smooth===!1?(Mn(t,"image-rendering","optimizeSpeed"),Mn(t,"image-rendering","pixelated")):Mn(t,"image-rendering",null)},text(e,t,n){const r=pc(n);let i,s,f,v;Object(we.B)(r)?(i=(s=r.map(w=>Eh(n,w))).join(`
`))!==rn.text&&(wf(t,0),f=t.ownerDocument,v=Wu(n),s.forEach((w,O)=>{const N=ca(f,"tspan",at);N.__data__=n,N.textContent=w,O&&(N.setAttribute("x",0),N.setAttribute("dy",v)),t.appendChild(N)}),rn.text=i):(s=Eh(n,r))!==rn.text&&(t.textContent=s,rn.text=s),yr(t,"font-family",cd(n)),yr(t,"font-size",$l(n)+"px"),yr(t,"font-style",n.fontStyle),yr(t,"font-variant",n.fontVariant),yr(t,"font-weight",n.fontWeight)}};function Bn(e,t,n){t!==rn[e]&&(n?function(r,i,s,f){s!=null?r.setAttributeNS(f,i,s):r.removeAttributeNS(f,i)}(Zt,e,t,n):yr(Zt,e,t),rn[e]=t)}function Mn(e,t,n){n!==rn[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),rn[t]=n)}function fr(e,t){for(const n in t)yr(e,n,t[n])}function yr(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function Cr(){let e;return typeof window=="undefined"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function Nr(e){x.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}Object(we.z)(Nr,x,{svg(){return this._text},_render(e){const t=Me();t.open("svg",Object(we.p)({},mu,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&n!=="transparent"&&n!=="none"&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",Xe,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=Oh[t.marktype],r=n.tag,i=[G,n.attr];e.open("g",{class:b(t),"clip-path":t.clip?zf(this,t,t.group):null},ae(t),{"pointer-events":r!=="g"&&t.interactive===!1?"none":null});const s=f=>{const v=this.href(f);if(v&&e.open("a",v),e.open(r,this.attr(t,f,i,r!=="g"?r:null)),r==="text"){const w=pc(f);if(Object(we.B)(w)){const O={x:0,dy:Wu(f)};for(let N=0;N<w.length;++N)e.open("tspan",N?O:null).text(Eh(f,w[N])).close()}else e.text(Eh(f,w))}else if(r==="g"){const w=f.strokeForeground,O=f.fill,N=f.stroke;w&&N&&(f.stroke=null),e.open("path",this.attr(t,f,n.background,"bgrect")).close(),e.open("g",this.attr(t,f,n.content)),Ln(f,L=>this.mark(e,L)),e.close(),w&&N?(O&&(f.fill=null),f.stroke=N,e.open("path",this.attr(t,f,n.foreground,"bgrect")).close(),O&&(f.fill=O)):e.open("path",this.attr(t,f,n.foreground,"bgfore")).close()}e.close(),v&&e.close()};return n.nested?t.items&&t.items.length&&s(t.items[0]):Ln(t,s),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then(r=>{r["xlink:href"]=r.href,r.href=null,(this._hrefs||(this._hrefs={}))[t]=r})}return null},attr(e,t,n,r){const i={},s=(f,v,w,O)=>{i[O||f]=v};return Array.isArray(n)?n.forEach(f=>f(s,t,this)):n(s,t,this),r&&function(f,v,w,O,N){if(v==null||(O==="bgrect"&&w.interactive===!1&&(f["pointer-events"]="none"),O==="bgfore"&&(w.interactive===!1&&(f["pointer-events"]="none"),f.display="none",v.fill!==null)))return f;O==="image"&&v.smooth===!1&&(f.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),O==="text"&&(f["font-family"]=cd(v),f["font-size"]=$l(v)+"px",f["font-style"]=v.fontStyle,f["font-variant"]=v.fontVariant,f["font-weight"]=v.fontWeight);for(const L in Ye){let Y=v[L];const ie=Ye[L];(Y!=="transparent"||ie!=="fill"&&ie!=="stroke")&&Y!=null&&(Qm(Y)&&(Y=Hg(Y,N.gradient,"")),f[ie]=Y)}}(i,t,e,r,this._defs),i},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(Object.keys(t).length+Object.keys(n).length!==0){e.open("defs");for(const r in t){const i=t[r],s=i.stops;i.gradient==="radial"?(e.open("pattern",{id:gh+r,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+r+")"}).close(),e.close(),e.open("radialGradient",{id:r,fx:i.x1,fy:i.y1,fr:i.r1,cx:i.x2,cy:i.y2,r:i.r2})):e.open("linearGradient",{id:r,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2});for(let f=0;f<s.length;++f)e.open("stop",{offset:s[f].offset,"stop-color":s[f].color}).close();e.close()}for(const r in n){const i=n[r];e.open("clipPath",{id:r}),i.path?e.open("path",{d:i.path}).close():e.open("rect",{x:0,y:0,width:i.width,height:i.height}).close(),e.close()}e.close()}}});const Ar={Canvas:"canvas",PNG:"png",SVG:"svg",None:"none"},_r={};function Yr(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(_r[e]=t,this):_r[e]}function Kr(e,t,n){const r=[],i=new pu().union(t),s=e.marktype;return s?fi(e,i,n,r):s==="group"?Ti(e,i,n,r):Object(we.o)("Intersect scene must be mark node or group item.")}function fi(e,t,n,r){if(function(i,s,f){return i.bounds&&s.intersects(i.bounds)&&(i.marktype==="group"||i.interactive!==!1&&(!f||f(i)))}(e,t,n)){const i=e.items,s=e.marktype,f=i.length;let v=0;if(s==="group")for(;v<f;++v)Ti(i[v],t,n,r);else for(const w=Oh[s].isect;v<f;++v){const O=i[v];Yi(O,t,w)&&r.push(O)}}return r}function Ti(e,t,n,r){n&&n(e.mark)&&Yi(e,t,Oh.group.isect)&&r.push(e);const i=e.items,s=i&&i.length;if(s){const f=e.x||0,v=e.y||0;t.translate(-f,-v);for(let w=0;w<s;++w)fi(i[w],t,n,r);t.translate(f,v)}return r}function Yi(e,t,n){const r=e.bounds;return t.encloses(r)||t.intersects(r)&&n(e,t)}_r.canvas=_r.png={renderer:St,headless:St,handler:Ge},_r.svg={renderer:gt,headless:Nr,handler:un},_r.none={};const ia=new pu;function oa(e){const t=e.clip;if(Object(we.E)(t))t(hg(ia.clear()));else{if(!t)return;ia.set(0,0,e.group.width,e.group.height)}e.bounds.intersect(ia)}const wa=1e-9;function ba(e,t,n){return e===t||(n==="path"?ja(e,t):e instanceof Date&&t instanceof Date?+e==+t:Object(we.G)(e)&&Object(we.G)(t)?Math.abs(e-t)<=wa:e&&t&&(Object(we.H)(e)||Object(we.H)(t))?function(r,i){var s,f,v=Object.keys(r),w=Object.keys(i);if(v.length!==w.length)return!1;for(v.sort(),w.sort(),f=v.length-1;f>=0;f--)if(v[f]!=w[f])return!1;for(f=v.length-1;f>=0;f--)if(s=v[f],!ba(r[s],i[s],s))return!1;return typeof r==typeof i}(e,t):e==t)}function ja(e,t){return ba(mp(e),mp(t))}function Qa(){D0(),id=0}const Ls="top",Uo="left",ka="right",Za="bottom",mc="top-left",gc="top-right",vc="bottom-left",Ep="bottom-right",qu="start",Ud="middle",fl="end",e0="x",F0="y",Cp="group",dg="axis",ym="title",A1="frame",_v="scope",Ap="legend",O1="row-header",eb="row-footer",cy="row-title",S1="column-header",D1="column-footer",T1="column-title",Gb="padding",$b="symbol",q2="fit",uE="fit-x",cE="fit-y",lE="pad",Kb="none",tb="all",Xb="each",Yb="flush",Ev="column",Cv="row";function H2(e){Ft.call(this,null,e)}function nb(e,t,n){return t(e.bounds.clear(),e,n)}Object(we.z)(H2,Ft,{transform(e,t){const n=t.dataflow,r=e.mark,i=r.marktype,s=Oh[i],f=s.bound;let v,w=r.bounds;if(s.nested)r.items.length&&n.dirty(r.items[0]),w=nb(r,f),r.items.forEach(O=>{O.bounds.clear().union(w)});else if(i===Cp||e.modified())switch(t.visit(t.MOD,O=>n.dirty(O)),w.clear(),r.items.forEach(O=>w.union(nb(O,f))),r.role){case dg:case Ap:case ym:t.reflow()}else v=t.changed(t.REM),t.visit(t.ADD,O=>{w.union(nb(O,f))}),t.visit(t.MOD,O=>{v=v||w.alignsWith(O.bounds),n.dirty(O),w.union(nb(O,f))}),v&&(w.clear(),r.items.forEach(O=>w.union(O.bounds)));return oa(r),t.modifies("bounds")}});const G2=":vega_identifier:";function Jb(e){Ft.call(this,0,e)}function $2(e){Ft.call(this,null,e)}function K2(e){Ft.call(this,null,e)}Jb.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},Object(we.z)(Jb,Ft,{transform(e,t){const n=function(s){return s._signals[G2]||(s._signals[G2]=s.add(0))}(t.dataflow),r=e.as;let i=n.value;return t.visit(t.ADD,s=>s[r]=s[r]||++i),n.set(this.value=i),t}}),Object(we.z)($2,Ft,{transform(e,t){let n=this.value;n||((n=t.dataflow.scenegraph().mark(e.markdef,function(i){const s=i.groups,f=i.parent;return s&&s.size===1?s.get(Object.keys(s.object)[0]):s&&f?s.lookup(f):null}(e),e.index)).group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const r=n.marktype===Cp?dm:bp;return t.visit(t.ADD,i=>r.call(i,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});const X2={parity:e=>e.filter((t,n)=>n%2?t.opacity=0:1),greedy:(e,t)=>{let n;return e.filter((r,i)=>i&&Y2(n.bounds,r.bounds,t)?r.opacity=0:(n=r,1))}},Y2=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),J2=(e,t)=>{for(var n,r=1,i=e.length,s=e[0].bounds;r<i;s=n,++r)if(Y2(s,n=e[r].bounds,t))return!0},fE=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},Q2=e=>(e.forEach(t=>t.opacity=1),e),B=(e,t)=>e.reflow(t.modified()).modifies("opacity");function ne(e){Ft.call(this,null,e)}Object(we.z)(K2,Ft,{transform(e,t){const n=X2[e.method]||X2.parity,r=e.separation||0;let i,s,f=t.materialize(t.SOURCE).source;if(!f||!f.length)return;if(!e.method)return e.modified("method")&&(Q2(f),t=B(t,e)),t;if(!(f=f.filter(fE)).length)return;if(e.sort&&(f=f.slice().sort(e.sort)),i=Q2(f),t=B(t,e),i.length>=3&&J2(i,r)){do i=n(i,r);while(i.length>=3&&J2(i,r));i.length<3&&!Object(we.W)(f).opacity&&(i.length>1&&(Object(we.W)(i).opacity=0),Object(we.W)(f).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(s=((w,O,N)=>{var L=w.range(),Y=new pu;return O===Ls||O===Za?Y.set(L[0],-1/0,L[1],1/0):Y.set(-1/0,L[0],1/0,L[1]),Y.expand(N||1),ie=>Y.encloses(ie.bounds)})(e.boundScale,e.boundOrient,+e.boundTolerance),f.forEach(w=>{s(w)||(w.opacity=0)}));const v=i[0].mark.bounds.clear();return f.forEach(w=>{w.opacity&&v.union(w.bounds)}),t}}),Object(we.z)(ne,Ft,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,r=>n.dirty(r)),t.fields&&t.fields.zindex){const r=t.source&&t.source[0];r&&(r.mark.zdirty=!0)}}});const Te=new pu;function ut(e,t,n){return e[t]===n?0:(e[t]=n,1)}function zt(e){var t=e.items[0].orient;return t===Uo||t===ka}function gn(e,t,n,r){var i,s,f=t.items[0],v=f.datum,w=f.translate!=null?f.translate:.5,O=f.orient,N=function(dt){let kt=+dt.grid;return[dt.ticks?kt++:-1,dt.labels?kt++:-1,kt+ +dt.domain]}(v),L=f.range,Y=f.offset,ie=f.position,fe=f.minExtent,ve=f.maxExtent,Be=v.title&&f.items[N[2]].items[0],We=f.titlePadding,Ve=f.bounds,ct=Be&&vu(Be),lt=0,mt=0;switch(Te.clear().union(Ve),Ve.clear(),(i=N[0])>-1&&Ve.union(f.items[i].bounds),(i=N[1])>-1&&Ve.union(f.items[i].bounds),O){case Ls:lt=ie||0,mt=-Y,s=Math.max(fe,Math.min(ve,-Ve.y1)),Ve.add(0,-s).add(L,0),Be&&Un(e,Be,s,We,ct,0,-1,Ve);break;case Uo:lt=-Y,mt=ie||0,s=Math.max(fe,Math.min(ve,-Ve.x1)),Ve.add(-s,0).add(0,L),Be&&Un(e,Be,s,We,ct,1,-1,Ve);break;case ka:lt=n+Y,mt=ie||0,s=Math.max(fe,Math.min(ve,Ve.x2)),Ve.add(0,0).add(s,L),Be&&Un(e,Be,s,We,ct,1,1,Ve);break;case Za:lt=ie||0,mt=r+Y,s=Math.max(fe,Math.min(ve,Ve.y2)),Ve.add(0,0).add(L,s),Be&&Un(e,Be,s,We,0,0,1,Ve);break;default:lt=f.x,mt=f.y}return ad(Ve.translate(lt,mt),f),ut(f,"x",lt+w)|ut(f,"y",mt+w)&&(f.bounds=Te,e.dirty(f),f.bounds=Ve,e.dirty(f)),f.mark.bounds.clear().union(Ve)}function Un(e,t,n,r,i,s,f,v){const w=t.bounds;if(t.auto){const O=f*(n+i+r);let N=0,L=0;e.dirty(t),s?N=(t.x||0)-(t.x=O):L=(t.y||0)-(t.y=O),t.mark.bounds.clear().union(w.translate(-N,-L)),e.dirty(t)}v.union(w)}const nr=(e,t)=>Math.floor(Math.min(e,t)),mr=(e,t)=>Math.ceil(Math.max(e,t));function oi(e){return new pu().set(0,0,e.width||0,e.height||0)}function si(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function Xr(e,t,n){const r=Object(we.H)(e)?e[t]:e;return r!=null?r:n!==void 0?n:0}function Li(e){return e<0?Math.ceil(-e):0}function fo(e,t,n){var r,i,s,f,v,w,O,N,L,Y,ie,fe=!n.nodirty,ve=n.bounds===Yb?oi:si,Be=Te.set(0,0,0,0),We=Xr(n.align,Ev),Ve=Xr(n.align,Cv),ct=Xr(n.padding,Ev),lt=Xr(n.padding,Cv),mt=n.columns||t.length,dt=mt<=0?1:Math.ceil(t.length/mt),kt=t.length,wt=Array(kt),dn=Array(mt),Dn=0,wn=Array(kt),Xn=Array(dt),Kn=0,ir=Array(kt),sr=Array(kt),gr=Array(kt);for(i=0;i<mt;++i)dn[i]=0;for(i=0;i<dt;++i)Xn[i]=0;for(i=0;i<kt;++i)w=t[i],v=gr[i]=ve(w),w.x=w.x||0,ir[i]=0,w.y=w.y||0,sr[i]=0,s=i%mt,f=~~(i/mt),Dn=Math.max(Dn,O=Math.ceil(v.x2)),Kn=Math.max(Kn,N=Math.ceil(v.y2)),dn[s]=Math.max(dn[s],O),Xn[f]=Math.max(Xn[f],N),wt[i]=ct+Li(v.x1),wn[i]=lt+Li(v.y1),fe&&e.dirty(t[i]);for(i=0;i<kt;++i)i%mt==0&&(wt[i]=0),i<mt&&(wn[i]=0);if(We===Xb)for(s=1;s<mt;++s){for(ie=0,i=s;i<kt;i+=mt)ie<wt[i]&&(ie=wt[i]);for(i=s;i<kt;i+=mt)wt[i]=ie+dn[s-1]}else if(We===tb){for(ie=0,i=0;i<kt;++i)i%mt&&ie<wt[i]&&(ie=wt[i]);for(i=0;i<kt;++i)i%mt&&(wt[i]=ie+Dn)}else for(We=!1,s=1;s<mt;++s)for(i=s;i<kt;i+=mt)wt[i]+=dn[s-1];if(Ve===Xb)for(f=1;f<dt;++f){for(ie=0,r=(i=f*mt)+mt;i<r;++i)ie<wn[i]&&(ie=wn[i]);for(i=f*mt;i<r;++i)wn[i]=ie+Xn[f-1]}else if(Ve===tb){for(ie=0,i=mt;i<kt;++i)ie<wn[i]&&(ie=wn[i]);for(i=mt;i<kt;++i)wn[i]=ie+Kn}else for(Ve=!1,f=1;f<dt;++f)for(r=(i=f*mt)+mt;i<r;++i)wn[i]+=Xn[f-1];for(L=0,i=0;i<kt;++i)L=wt[i]+(i%mt?L:0),ir[i]+=L-t[i].x;for(s=0;s<mt;++s)for(Y=0,i=s;i<kt;i+=mt)Y+=wn[i],sr[i]+=Y-t[i].y;if(We&&Xr(n.center,Ev)&&dt>1)for(i=0;i<kt;++i)(L=(v=We===tb?Dn:dn[i%mt])-gr[i].x2-t[i].x-ir[i])>0&&(ir[i]+=L/2);if(Ve&&Xr(n.center,Cv)&&mt!==1)for(i=0;i<kt;++i)(Y=(v=Ve===tb?Kn:Xn[~~(i/mt)])-gr[i].y2-t[i].y-sr[i])>0&&(sr[i]+=Y/2);for(i=0;i<kt;++i)Be.union(gr[i].translate(ir[i],sr[i]));switch(L=Xr(n.anchor,e0),Y=Xr(n.anchor,F0),Xr(n.anchor,Ev)){case fl:L-=Be.width();break;case Ud:L-=Be.width()/2}switch(Xr(n.anchor,Cv)){case fl:Y-=Be.height();break;case Ud:Y-=Be.height()/2}for(L=Math.round(L),Y=Math.round(Y),Be.clear(),i=0;i<kt;++i)t[i].mark.bounds.clear();for(i=0;i<kt;++i)(w=t[i]).x+=ir[i]+=L,w.y+=sr[i]+=Y,Be.union(w.mark.bounds.union(w.bounds.translate(ir[i],sr[i]))),fe&&e.dirty(w);return Be}function ea(e,t,n){var r,i,s,f,v,w,O,N=function(Ve){var ct,lt,mt=Ve.items,dt=mt.length,kt=0;const wt={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;kt<dt;++kt)if(lt=(ct=mt[kt]).items,ct.marktype===Cp)switch(ct.role){case dg:case Ap:case ym:break;case O1:wt.rowheaders.push(...lt);break;case eb:wt.rowfooters.push(...lt);break;case S1:wt.colheaders.push(...lt);break;case D1:wt.colfooters.push(...lt);break;case cy:wt.rowtitle=lt[0];break;case T1:wt.coltitle=lt[0];break;default:wt.marks.push(...lt)}return wt}(t),L=N.marks,Y=n.bounds===Yb?qa:ta,ie=n.offset,fe=n.columns||L.length,ve=fe<=0?1:Math.ceil(L.length/fe),Be=ve*fe;const We=fo(e,L,n);We.empty()&&We.set(0,0,0,0),N.rowheaders&&(w=Xr(n.headerBand,Cv,null),r=Ha(e,N.rowheaders,L,fe,ve,-Xr(ie,"rowHeader"),nr,0,Y,"x1",0,fe,1,w)),N.colheaders&&(w=Xr(n.headerBand,Ev,null),i=Ha(e,N.colheaders,L,fe,fe,-Xr(ie,"columnHeader"),nr,1,Y,"y1",0,1,fe,w)),N.rowfooters&&(w=Xr(n.footerBand,Cv,null),s=Ha(e,N.rowfooters,L,fe,ve,Xr(ie,"rowFooter"),mr,0,Y,"x2",fe-1,fe,1,w)),N.colfooters&&(w=Xr(n.footerBand,Ev,null),f=Ha(e,N.colfooters,L,fe,fe,Xr(ie,"columnFooter"),mr,1,Y,"y2",Be-fe,1,fe,w)),N.rowtitle&&(v=Xr(n.titleAnchor,Cv),O=Xr(ie,"rowTitle"),O=v===fl?s+O:r-O,w=Xr(n.titleBand,Cv,.5),vs(e,N.rowtitle,O,0,We,w)),N.coltitle&&(v=Xr(n.titleAnchor,Ev),O=Xr(ie,"columnTitle"),O=v===fl?f+O:i-O,w=Xr(n.titleBand,Ev,.5),vs(e,N.coltitle,O,1,We,w))}function qa(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):void 0}function ta(e,t){return e.bounds[t]}function Ha(e,t,n,r,i,s,f,v,w,O,N,L,Y,ie){var fe,ve,Be,We,Ve,ct,lt,mt,dt,kt=n.length,wt=0,dn=0;if(!kt)return wt;for(fe=N;fe<kt;fe+=L)n[fe]&&(wt=f(wt,w(n[fe],O)));if(!t.length)return wt;for(t.length>i&&(e.warn("Grid headers exceed limit: "+i),t=t.slice(0,i)),wt+=s,ve=0,We=t.length;ve<We;++ve)e.dirty(t[ve]),t[ve].mark.bounds.clear();for(fe=N,ve=0,We=t.length;ve<We;++ve,fe+=L){for(Ve=(ct=t[ve]).mark.bounds,Be=fe;Be>=0&&(lt=n[Be])==null;Be-=Y);v?(mt=ie==null?lt.x:Math.round(lt.bounds.x1+ie*lt.bounds.width()),dt=wt):(mt=wt,dt=ie==null?lt.y:Math.round(lt.bounds.y1+ie*lt.bounds.height())),Ve.union(ct.bounds.translate(mt-(ct.x||0),dt-(ct.y||0))),ct.x=mt,ct.y=dt,e.dirty(ct),dn=f(dn,Ve[O])}return dn}function vs(e,t,n,r,i,s){if(t){e.dirty(t);var f=n,v=n;r?f=Math.round(i.x1+s*i.width()):v=Math.round(i.y1+s*i.height()),t.bounds.translate(f-(t.x||0),v-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=f,t.y=v,e.dirty(t)}}function bm(e,t,n,r,i,s,f){const v=function(Y,ie){const fe=Y[ie]||{};return(ve,Be)=>fe[ve]!=null?fe[ve]:Y[ve]!=null?Y[ve]:Be}(n,t),w=function(Y,ie){let fe=-1/0;return Y.forEach(ve=>{ve.offset!=null&&(fe=Math.max(fe,ve.offset))}),fe>-1/0?fe:ie}(e,v("offset",0)),O=v("anchor",qu),N=O===fl?1:O===Ud?.5:0,L={align:Xb,bounds:v("bounds",Yb),columns:v("direction")==="vertical"?1:e.length,padding:v("margin",8),center:v("center"),nodirty:!0};switch(t){case Uo:L.anchor={x:Math.floor(r.x1)-w,column:fl,y:N*(f||r.height()+2*r.y1),row:O};break;case ka:L.anchor={x:Math.ceil(r.x2)+w,y:N*(f||r.height()+2*r.y1),row:O};break;case Ls:L.anchor={y:Math.floor(i.y1)-w,row:fl,x:N*(s||i.width()+2*i.x1),column:O};break;case Za:L.anchor={y:Math.ceil(i.y2)+w,x:N*(s||i.width()+2*i.x1),column:O};break;case mc:L.anchor={x:w,y:w};break;case gc:L.anchor={x:s-w,y:w,column:fl};break;case vc:L.anchor={x:w,y:f-w,row:fl};break;case Ep:L.anchor={x:s-w,y:f-w,column:fl,row:fl}}return L}function Wd(e,t){var n,r,i=t.items[0],s=i.datum,f=i.orient,v=i.bounds,w=i.x,O=i.y;return i._bounds?i._bounds.clear().union(v):i._bounds=v.clone(),v.clear(),function(N,L,Y){var ie=L.padding,fe=ie-Y.x,ve=ie-Y.y;if(L.datum.title){var Be=L.items[1].items[0],We=Be.anchor,Ve=L.titlePadding||0,ct=ie-Be.x,lt=ie-Be.y;switch(Be.orient){case Uo:fe+=Math.ceil(Be.bounds.width())+Ve;break;case ka:case Za:break;default:ve+=Be.bounds.height()+Ve}switch((fe||ve)&&yc(N,Y,fe,ve),Be.orient){case Uo:lt+=qf(L,Y,Be,We,1,1);break;case ka:ct+=qf(L,Y,Be,fl,0,0)+Ve,lt+=qf(L,Y,Be,We,1,1);break;case Za:ct+=qf(L,Y,Be,We,0,0),lt+=qf(L,Y,Be,fl,-1,0,1)+Ve;break;default:ct+=qf(L,Y,Be,We,0,0)}(ct||lt)&&yc(N,Be,ct,lt),(ct=Math.round(Be.bounds.x1-ie))<0&&(yc(N,Y,-ct,0),yc(N,Be,-ct,0))}else(fe||ve)&&yc(N,Y,fe,ve)}(e,i,i.items[0].items[0]),v=function(N,L){return N.items.forEach(Y=>L.union(Y.bounds)),L.x1=N.padding,L.y1=N.padding,L}(i,v),n=2*i.padding,r=2*i.padding,v.empty()||(n=Math.ceil(v.width()+n),r=Math.ceil(v.height()+r)),s.type===$b&&function(N){const L=N.reduce((Y,ie)=>(Y[ie.column]=Math.max(ie.bounds.x2-ie.x,Y[ie.column]||0),Y),{});N.forEach(Y=>{Y.width=L[Y.column],Y.height=Y.bounds.y2-Y.y})}(i.items[0].items[0].items[0].items),f!==Kb&&(i.x=w=0,i.y=O=0),i.width=n,i.height=r,ad(v.set(w,O,w+n,O+r),i),i.mark.bounds.clear().union(v),i}function qf(e,t,n,r,i,s,f){const v=e.datum.type!=="symbol",w=n.datum.vgrad,O=(!v||!s&&w||f?t:t.items[0]).bounds[i?"y2":"x2"]-e.padding,N=w&&s?O:0,L=w&&s?0:O,Y=i<=0?0:vu(n);return Math.round(r===qu?N:r===fl?L-Y:.5*(O-Y))}function yc(e,t,n,r){t.x+=n,t.y+=r,t.bounds.translate(n,r),t.mark.bounds.translate(n,r),e.dirty(t)}function pg(e){Ft.call(this,null,e)}function R0(e,t){let n=0;if(t===void 0)for(let r of e)(r=+r)&&(n+=r);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}function Qb(e){Ft.call(this,null,e)}function dS(e){Ft.call(this,null,e)}function BM(){return jn({})}function pS(e){Ft.call(this,null,e)}function mS(e){Ft.call(this,[],e)}Object(we.z)(pg,Ft,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach(r=>{e.layout&&ea(n,r,e.layout),function(i,s,f){var v,w,O,N,L,Y=s.items,ie=Math.max(0,s.width||0),fe=Math.max(0,s.height||0),ve=new pu().set(0,0,ie,fe),Be=ve.clone(),We=ve.clone(),Ve=[];for(N=0,L=Y.length;N<L;++N)switch((w=Y[N]).role){case dg:(zt(w)?Be:We).union(gn(i,w,ie,fe));break;case ym:v=w;break;case Ap:Ve.push(Wd(i,w));break;case A1:case _v:case O1:case eb:case cy:case S1:case D1:case T1:Be.union(w.bounds),We.union(w.bounds);break;default:ve.union(w.bounds)}if(Ve.length){const ct={};Ve.forEach(lt=>{(O=lt.orient||ka)!==Kb&&(ct[O]||(ct[O]=[])).push(lt)});for(const lt in ct){const mt=ct[lt];fo(i,mt,bm(mt,lt,f.legends,Be,We,ie,fe))}Ve.forEach(lt=>{const mt=lt.bounds;if(mt.equals(lt._bounds)||(lt.bounds=lt._bounds,i.dirty(lt),lt.bounds=mt,i.dirty(lt)),f.autosize&&f.autosize.type===q2)switch(lt.orient){case Uo:case ka:ve.add(mt.x1,0).add(mt.x2,0);break;case Ls:case Za:ve.add(0,mt.y1).add(0,mt.y2)}else ve.union(mt)})}ve.union(Be).union(We),v&&ve.union(function(ct,lt,mt,dt,kt){var wt,dn=lt.items[0],Dn=dn.frame,wn=dn.orient,Xn=dn.anchor,Kn=dn.offset,ir=dn.padding,sr=dn.items[0].items[0],gr=dn.items[1]&&dn.items[1].items[0],Vr=wn===Uo||wn===ka?dt:mt,hi=0,Qr=0,Ni=0,ro=0,oo=0;if(Dn!==Cp?wn===Uo?(hi=kt.y2,Vr=kt.y1):wn===ka?(hi=kt.y1,Vr=kt.y2):(hi=kt.x1,Vr=kt.x2):wn===Uo&&(hi=dt,Vr=0),wt=Xn===qu?hi:Xn===fl?Vr:(hi+Vr)/2,gr&&gr.text){switch(wn){case Ls:case Za:oo=sr.bounds.height()+ir;break;case Uo:ro=sr.bounds.width()+ir;break;case ka:ro=-sr.bounds.width()-ir}Te.clear().union(gr.bounds),Te.translate(ro-(gr.x||0),oo-(gr.y||0)),ut(gr,"x",ro)|ut(gr,"y",oo)&&(ct.dirty(gr),gr.bounds.clear().union(Te),gr.mark.bounds.clear().union(Te),ct.dirty(gr)),Te.clear().union(gr.bounds)}else Te.clear();switch(Te.union(sr.bounds),wn){case Ls:Qr=wt,Ni=kt.y1-Te.height()-Kn;break;case Uo:Qr=kt.x1-Te.width()-Kn,Ni=wt;break;case ka:Qr=kt.x2+Te.width()+Kn,Ni=wt;break;case Za:Qr=wt,Ni=kt.y2+Kn;break;default:Qr=dn.x,Ni=dn.y}return ut(dn,"x",Qr)|ut(dn,"y",Ni)&&(Te.translate(Qr,Ni),ct.dirty(dn),dn.bounds.clear().union(Te),lt.bounds.clear().union(Te),ct.dirty(dn)),dn.bounds}(i,v,ie,fe,ve)),s.clip&&ve.set(0,0,s.width||0,s.height||0),function(ct,lt,mt,dt){const kt=dt.autosize||{},wt=kt.type;if(ct._autosize<1||!wt)return;let dn=ct._width,Dn=ct._height,wn=Math.max(0,lt.width||0),Xn=Math.max(0,Math.ceil(-mt.x1)),Kn=Math.max(0,lt.height||0),ir=Math.max(0,Math.ceil(-mt.y1));const sr=Math.max(0,Math.ceil(mt.x2-wn)),gr=Math.max(0,Math.ceil(mt.y2-Kn));if(kt.contains===Gb){const Vr=ct.padding();dn-=Vr.left+Vr.right,Dn-=Vr.top+Vr.bottom}wt===Kb?(Xn=0,ir=0,wn=dn,Kn=Dn):wt===q2?(wn=Math.max(0,dn-Xn-sr),Kn=Math.max(0,Dn-ir-gr)):wt===uE?(wn=Math.max(0,dn-Xn-sr),Dn=Kn+ir+gr):wt===cE?(dn=wn+Xn+sr,Kn=Math.max(0,Dn-ir-gr)):wt===lE&&(dn=wn+Xn+sr,Dn=Kn+ir+gr),ct._resizeView(dn,Dn,wn,Kn,[Xn,ir],kt.resize)}(i,s,ve,f)}(n,r,e)}),function(r){return r&&r.mark.role!=="legend-entry"}(e.mark.group)?t.reflow():t}}),Object(we.z)(Qb,Ft,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,s=e.scale,f=sm(s,e.count==null?e.values?e.values.length:10:e.count,e.minstep),v=e.format||p0(n,s,f,e.formatSpecifier,e.formatType,!!e.values),w=e.values?d0(s,e.values,f):nd(s,f);return i&&(r.rem=i),i=w.map((O,N)=>jn({index:N/(w.length-1||1),value:O,label:v(O)})),e.extra&&i.length&&i.push(jn({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r}}),Object(we.z)(dS,Ft,{transform(e,t){var n=t.dataflow,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||BM,s=e.key||an,f=this.value;return Object(we.B)(r.encode)&&(r.encode=null),f&&(e.modified("key")||t.modified(s))&&Object(we.o)("DataJoin does not support modified key function or fields."),f||(t=t.addAll(),this.value=f=function(v){const w=Object(we.t)().test(O=>O.exit);return w.lookup=O=>w.get(v(O)),w}(s)),t.visit(t.ADD,v=>{const w=s(v);let O=f.get(w);O?O.exit?(f.empty--,r.add.push(O)):r.mod.push(O):(O=i(v),f.set(w,O),r.add.push(O)),O.datum=v,O.exit=!1}),t.visit(t.MOD,v=>{const w=s(v),O=f.get(w);O&&(O.datum=v,r.mod.push(O))}),t.visit(t.REM,v=>{const w=s(v),O=f.get(w);v!==O.datum||O.exit||(r.rem.push(O),O.exit=!0,++f.empty)}),t.changed(t.ADD_MOD)&&r.modifies("datum"),(t.clean()||e.clean&&f.empty>n.cleanThreshold)&&n.runAfter(f.clean),r}}),Object(we.z)(pS,Ft,{transform(e,t){var n=t.fork(t.ADD_REM),r=e.mod||!1,i=e.encoders,s=t.encode;if(Object(we.B)(s)){if(!n.changed()&&!s.every(L=>i[L]))return t.StopPropagation;s=s[0],n.encode=null}var f=s==="enter",v=i.update||we.s,w=i.enter||we.s,O=i.exit||we.s,N=(s&&!f?i[s]:v)||we.s;if(t.changed(t.ADD)&&(t.visit(t.ADD,L=>{w(L,e),v(L,e)}),n.modifies(w.output),n.modifies(v.output),N!==we.s&&N!==v&&(t.visit(t.ADD,L=>{N(L,e)}),n.modifies(N.output))),t.changed(t.REM)&&O!==we.s&&(t.visit(t.REM,L=>{O(L,e)}),n.modifies(O.output)),f||N!==we.s){const L=t.MOD|(e.modified()?t.REFLOW:0);f?(t.visit(L,Y=>{const ie=w(Y,e)||r;(N(Y,e)||ie)&&n.mod.push(Y)}),n.mod.length&&n.modifies(w.output)):t.visit(L,Y=>{(N(Y,e)||r)&&n.mod.push(Y)}),n.mod.length&&n.modifies(N.output)}return n.changed()?n:t.StopPropagation}}),Object(we.z)(mS,Ft,{transform(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var n,r,i,s,f,v=t.dataflow.locale(),w=t.fork(t.NO_SOURCE|t.NO_FIELDS),O=this.value,N=e.type||am,L=e.scale,Y=+e.limit,ie=sm(L,e.count==null?5:e.count,e.minstep),fe=!!e.values||N===am,ve=e.format||v0(v,L,ie,N,e.formatSpecifier,e.formatType,fe),Be=e.values||g0(L,ie);return O&&(w.rem=O),N===am?(Y&&Be.length>Y?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),O=Be.slice(0,Y-1),f=!0):O=Be,Object(we.E)(i=e.size)?(e.values||L(O[0])!==0||(O=O.slice(1)),s=O.reduce((We,Ve)=>Math.max(We,i(Ve,e)),0)):i=Object(we.m)(s=i||8),O=O.map((We,Ve)=>jn({index:Ve,label:ve(We,Ve,O),value:We,offset:s,size:i(We,e)})),f&&(f=Be[O.length],O.push(jn({index:O.length,label:"\u2026".concat(Be.length-O.length," entries"),value:f,offset:s,size:i(f,e)})))):N==="gradient"?(n=L.domain(),r=Rd(L,n[0],Object(we.W)(n)),Be.length<3&&!e.values&&n[0]!==Object(we.W)(n)&&(Be=[n[0],Object(we.W)(n)]),O=Be.map((We,Ve)=>jn({index:Ve,label:ve(We,Ve,Be),value:We,perc:r(We)}))):(i=Be.length-1,r=function(We){const Ve=We.domain(),ct=Ve.length-1;let lt=+Ve[0],mt=+Object(we.W)(Ve),dt=mt-lt;if(We.type===Ts){const kt=ct?dt/ct:.1;dt=(mt+=kt)-(lt-=kt)}return kt=>(kt-lt)/dt}(L),O=Be.map((We,Ve)=>jn({index:Ve,label:ve(We,Ve,Be),value:We,perc:Ve?r(We):0,perc2:Ve===i?1:r(Be[Ve+1])}))),w.source=O,w.add=O,this.value=O,w}});const PM=e=>e.source.x,LM=e=>e.source.y,zM=e=>e.target.x,UM=e=>e.target.y;function hE(e){Ft.call(this,{},e)}hE.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},Object(we.z)(hE,Ft,{transform(e,t){var n=e.sourceX||PM,r=e.sourceY||LM,i=e.targetX||zM,s=e.targetY||UM,f=e.as||"path",v=e.orient||"vertical",w=e.shape||"line",O=bS.get(w+"-"+v)||bS.get(w);return O||Object(we.o)("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,N=>{N[f]=O(n(N),r(N),i(N),s(N))}),t.reflow(e.modified()).modifies(f)}});const gS=(e,t,n,r)=>"M"+e+","+t+"L"+n+","+r,vS=(e,t,n,r)=>{var i=n-e,s=r-t,f=Math.sqrt(i*i+s*s)/2;return"M"+e+","+t+"A"+f+","+f+" "+180*Math.atan2(s,i)/Math.PI+" 0 1 "+n+","+r},yS=(e,t,n,r)=>{const i=n-e,s=r-t,f=.2*(i+s),v=.2*(s-i);return"M"+e+","+t+"C"+(e+f)+","+(t+v)+" "+(n+v)+","+(r-f)+" "+n+","+r},bS=Object(we.t)({line:gS,"line-radial":(e,t,n,r)=>gS(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),arc:vS,"arc-radial":(e,t,n,r)=>vS(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),curve:yS,"curve-radial":(e,t,n,r)=>yS(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),"orthogonal-horizontal":(e,t,n,r)=>"M"+e+","+t+"V"+r+"H"+n,"orthogonal-vertical":(e,t,n,r)=>"M"+e+","+t+"H"+n+"V"+r,"orthogonal-radial":(e,t,n,r)=>{const i=Math.cos(e),s=Math.sin(e),f=Math.cos(n),v=Math.sin(n);return"M"+t*i+","+t*s+"A"+t+","+t+" 0 0,"+((Math.abs(n-e)>Math.PI?n<=e:n>e)?1:0)+" "+t*f+","+t*v+"L"+r*f+","+r*v},"diagonal-horizontal":(e,t,n,r)=>{const i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r},"diagonal-vertical":(e,t,n,r)=>{const i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r},"diagonal-radial":(e,t,n,r)=>{const i=Math.cos(e),s=Math.sin(e),f=Math.cos(n),v=Math.sin(n),w=(t+r)/2;return"M"+t*i+","+t*s+"C"+w*i+","+w*s+" "+w*f+","+w*v+" "+r*f+","+r*v}});function dE(e){Ft.call(this,null,e)}dE.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},Object(we.z)(dE,Ft,{transform(e,t){var n,r,i,s=e.as||["startAngle","endAngle"],f=s[0],v=s[1],w=e.field||we.Q,O=e.startAngle||0,N=e.endAngle!=null?e.endAngle:2*Math.PI,L=t.source,Y=L.map(w),ie=Y.length,fe=O,ve=(N-O)/R0(Y),Be=Qi(ie);for(e.sort&&Be.sort((We,Ve)=>Y[We]-Y[Ve]),n=0;n<ie;++n)i=Y[Be[n]],(r=L[Be[n]])[f]=fe,r[v]=fe+=i*ve;return this.value=Y,t.reflow(e.modified()).modifies(s)}});const WM=5;function xS(e){return Qh(e)&&e!==zu}const VM=Object(we.Fa)(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function wS(e){Ft.call(this,null,e),this.modified(!0)}function kS(e,t,n){return $m(e)&&Math.abs(t.reduce((r,i)=>r+(i<0?-1:i>0?1:0),0))!==t.length&&n.warn("Log scale domain includes zero: "+Object(we.Ba)(t)),t}function _S(e,t,n){return Object(we.E)(e)&&(t||n)?im(e,pE(t||[0,1],n)):e}function pE(e,t){return t?e.slice().reverse():e}function ES(e){Ft.call(this,null,e)}Object(we.z)(wS,Ft,{transform(e,t){var n=t.dataflow,r=this.value,i=function(s){var f,v=s.type,w="";return v===zu?zu+"-"+Mf:(function(O){const N=O.type;return Qh(N)&&N!==pf&&N!==jf&&(O.scheme||O.range&&O.range.length&&O.range.every(we.J))}(s)&&(f=s.rawDomain?s.rawDomain.length:s.domain?s.domain.length+ +(s.domainMid!=null):0,w=f===2?zu+"-":f===3?lp+"-":""),(w+v||Mf).toLowerCase())}(e);for(i in r&&i===r.type||(this.value=r=Ra(i)()),e)if(!VM[i]){if(i==="padding"&&xS(r.type))continue;Object(we.E)(r[i])?r[i](e[i]):n.warn("Unsupported scale property: "+i)}return function(s,f,v){var w=s.type,O=f.round||!1,N=f.range;if(f.rangeStep!=null)N=function(L,Y,ie){L!==Jh&&L!==Gm&&Object(we.o)("Only band and point scales support rangeStep.");var fe=(Y.paddingOuter!=null?Y.paddingOuter:Y.padding)||0,ve=L===Gm?1:(Y.paddingInner!=null?Y.paddingInner:Y.padding)||0;return[0,Y.rangeStep*cp(ie,ve,fe)]}(w,f,v);else if(f.scheme&&(N=function(L,Y,ie){var fe,ve,Be=Y.schemeExtent;return Object(we.B)(Y.scheme)?ve=ed(Y.scheme,Y.interpolate,Y.interpolateGamma):(fe=Y.scheme.toLowerCase(),(ve=dp(fe))||Object(we.o)("Unrecognized scheme name: ".concat(Y.scheme))),ie=L===Ts?ie+1:L===Pf?ie-1:L===ph||L===Bf?+Y.schemeCount||WM:ie,Km(L)?_S(ve,Be,Y.reverse):Object(we.E)(ve)?fp(_S(ve,Be),ie):L===Id?ve:ve.slice(0,ie)}(w,f,v),Object(we.E)(N))){if(s.interpolator)return s.interpolator(N);Object(we.o)("Scale type ".concat(w," does not support interpolating color schemes."))}if(N&&Km(w))return s.interpolator(ed(pE(N,f.reverse),f.interpolate,f.interpolateGamma));N&&f.interpolate&&s.interpolate?s.interpolate(td(f.interpolate,f.interpolateGamma)):Object(we.E)(s.round)?s.round(O):Object(we.E)(s.rangeRound)&&s.interpolate(O?Wa:Qo),N&&s.range(pE(N,f.reverse))}(r,e,function(s,f,v){let w=f.bins;if(w&&!Object(we.B)(w)){const O=s.domain(),N=O[0],L=Object(we.W)(O),Y=w.step;let ie=w.start==null?N:w.start,fe=w.stop==null?L:w.stop;Y||Object(we.o)("Scale bins parameter missing step property."),ie<N&&(ie=Y*Math.ceil(N/Y)),fe>L&&(fe=Y*Math.floor(L/Y)),w=Qi(ie,fe+Y/2,Y)}return w?s.bins=w:s.bins&&delete s.bins,s.type===Pf&&(w?f.domain||f.domainRaw||(s.domain(w),v=w.length):s.bins=s.domain()),v}(r,e,function(s,f,v){const w=function(fe,ve,Be){return ve?(fe.domain(kS(fe.type,ve,Be)),ve.length):-1}(s,f.domainRaw,v);if(w>-1)return w;var O,N,L=f.domain,Y=s.type,ie=f.zero||f.zero===void 0&&function(fe){const ve=fe.type;return!fe.bins&&(ve===Mf||ve===Yh||ve===df)}(s);if(!L)return 0;if(xS(Y)&&f.padding&&L[0]!==Object(we.W)(L)&&(L=function(fe,ve,Be,We,Ve,ct){var lt=Math.abs(Object(we.W)(Be)-Be[0]),mt=lt/(lt-2*We),dt=fe===hf?Object(we.Oa)(ve,null,mt):fe===df?Object(we.Pa)(ve,null,mt,.5):fe===Yh?Object(we.Pa)(ve,null,mt,Ve||1):fe===to?Object(we.Qa)(ve,null,mt,ct||1):Object(we.Na)(ve,null,mt);return(ve=ve.slice())[0]=dt[0],ve[ve.length-1]=dt[1],ve}(Y,L,f.range,f.padding,f.exponent,f.constant)),(ie||f.domainMin!=null||f.domainMax!=null||f.domainMid!=null)&&(O=(L=L.slice()).length-1||1,ie&&(L[0]>0&&(L[0]=0),L[O]<0&&(L[O]=0)),f.domainMin!=null&&(L[0]=f.domainMin),f.domainMax!=null&&(L[O]=f.domainMax),f.domainMid!=null)){const fe=(N=f.domainMid)>L[O]?O+1:N<L[0]?0:O;fe!==O&&v.warn("Scale domainMid exceeds domain min or max.",N),L.splice(fe,0,N)}return s.domain(kS(Y,L,v)),Y===Id&&s.unknown(f.domainImplicit?Pl:void 0),f.nice&&s.nice&&s.nice(f.nice!==!0&&sm(s,f.nice)||null),L.length}(r,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),Object(we.z)(ES,Ft,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(wi(e.sort)),this.modified(n),t}});const CS=["y0","y1"];function mE(e){Ft.call(this,null,e)}function qM(e,t,n,r,i){for(var s,f=(t-e.sum)/2,v=e.length,w=0;w<v;++w)(s=e[w])[r]=f,s[i]=f+=Math.abs(n(s))}function HM(e,t,n,r,i){for(var s,f=1/e.sum,v=0,w=e.length,O=0,N=0;O<w;++O)(s=e[O])[r]=v,s[i]=v=f*(N+=Math.abs(n(s)))}function GM(e,t,n,r,i){for(var s,f,v=0,w=0,O=e.length,N=0;N<O;++N)(s=+n(f=e[N]))<0?(f[r]=w,f[i]=w+=s):(f[r]=v,f[i]=v+=s)}mE.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:"zero",values:["zero","center","normalize"]},{name:"as",type:"string",array:!0,length:2,default:CS}]},Object(we.z)(mE,Ft,{transform(e,t){var n,r,i,s,f=e.as||CS,v=f[0],w=f[1],O=wi(e.sort),N=e.field||we.Q,L=e.offset==="center"?qM:e.offset==="normalize"?HM:GM;for(n=function(Y,ie,fe,ve){var Be,We,Ve,ct,lt,mt,dt,kt,wt,dn=[],Dn=wn=>wn(lt);if(ie==null)dn.push(Y.slice());else for(Be={},We=0,Ve=Y.length;We<Ve;++We)lt=Y[We],mt=ie.map(Dn),(dt=Be[mt])||(Be[mt]=dt=[],dn.push(dt)),dt.push(lt);for(mt=0,wt=0,ct=dn.length;mt<ct;++mt){for(dt=dn[mt],We=0,kt=0,Ve=dt.length;We<Ve;++We)kt+=Math.abs(ve(dt[We]));dt.sum=kt,kt>wt&&(wt=kt),fe&&dt.sort(fe)}return dn.max=wt,dn}(t.source,e.groupby,O,N),r=0,i=n.length,s=n.max;r<i;++r)L(n[r],s,N,v,w);return t.reflow(e.modified()).modifies(f)}});var Zb=e=>e;function Z2(e,t){e&&OS.hasOwnProperty(e.type)&&OS[e.type](e,t)}var AS={Feature:function(e,t){Z2(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)Z2(n[r].geometry,t)}},OS={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){gE(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)gE(n[r],t,0)},Polygon:function(e,t){SS(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)SS(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)Z2(n[r],t)}};function gE(e,t,n){var r,i=-1,s=e.length-n;for(t.lineStart();++i<s;)r=e[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function SS(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)gE(e[n],t,1);t.polygonEnd()}var Yv=function(e,t){e&&AS.hasOwnProperty(e.type)?AS[e.type](e,t):Z2(e,t)};class xm{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let r=0;for(let i=0;i<this._n&&i<32;i++){const s=n[i],f=t+s,v=Math.abs(t)<Math.abs(s)?t-(f-s):s-(f-t);v&&(n[r++]=v),t=f}return n[r]=t,this._n=r+1,this}valueOf(){const t=this._partials;let n,r,i,s=this._n,f=0;if(s>0){for(f=t[--s];s>0&&(n=f,!(i=(r=t[--s])-((f=n+r)-n))););s>0&&(i<0&&t[s-1]<0||i>0&&t[s-1]>0)&&(r=2*i)==(n=f+r)-f&&(f=n)}return f}}var Go=1e-6,ss=Math.PI,Xl=ss/2,ew=ss/4,wm=2*ss,kf=180/ss,us=ss/180,zs=Math.abs,rb=Math.atan,M0=Math.atan2,Xo=Math.cos,tw=Math.ceil,DS=Math.exp,vE=Math.hypot,nw=Math.log,yE=Math.pow,Mo=Math.sin,j0=Math.sign||function(e){return e>0?1:e<0?-1:0},km=Math.sqrt,bE=Math.tan;function TS(e){return e>1?0:e<-1?ss:Math.acos(e)}function mg(e){return e>1?Xl:e<-1?-Xl:Math.asin(e)}function Vd(){}var NS,IS,xE,wE,kE=new xm,_E=new xm,N1={point:Vd,lineStart:Vd,lineEnd:Vd,polygonStart:function(){N1.lineStart=$M,N1.lineEnd=XM},polygonEnd:function(){N1.lineStart=N1.lineEnd=N1.point=Vd,kE.add(zs(_E)),_E=new xm},result:function(){var e=kE/2;return kE=new xm,e}};function $M(){N1.point=KM}function KM(e,t){N1.point=FS,NS=xE=e,IS=wE=t}function FS(e,t){_E.add(wE*e-xE*t),xE=e,wE=t}function XM(){FS(NS,IS)}var RS=N1,ib=1/0,rw=ib,ex=-ib,iw=ex,MS,jS,Av,Ov,ow={point:function(e,t){e<ib&&(ib=e),e>ex&&(ex=e),t<rw&&(rw=t),t>iw&&(iw=t)},lineStart:Vd,lineEnd:Vd,polygonStart:Vd,polygonEnd:Vd,result:function(){var e=[[ib,rw],[ex,iw]];return ex=iw=-(rw=ib=1/0),e}},EE=0,CE=0,tx=0,aw=0,sw=0,ob=0,AE=0,OE=0,nx=0,ev={point:ly,lineStart:BS,lineEnd:PS,polygonStart:function(){ev.lineStart=QM,ev.lineEnd=ZM},polygonEnd:function(){ev.point=ly,ev.lineStart=BS,ev.lineEnd=PS},result:function(){var e=nx?[AE/nx,OE/nx]:ob?[aw/ob,sw/ob]:tx?[EE/tx,CE/tx]:[NaN,NaN];return EE=CE=tx=aw=sw=ob=AE=OE=nx=0,e}};function ly(e,t){EE+=e,CE+=t,++tx}function BS(){ev.point=YM}function YM(e,t){ev.point=JM,ly(Av=e,Ov=t)}function JM(e,t){var n=e-Av,r=t-Ov,i=km(n*n+r*r);aw+=i*(Av+e)/2,sw+=i*(Ov+t)/2,ob+=i,ly(Av=e,Ov=t)}function PS(){ev.point=ly}function QM(){ev.point=e6}function ZM(){LS(MS,jS)}function e6(e,t){ev.point=LS,ly(MS=Av=e,jS=Ov=t)}function LS(e,t){var n=e-Av,r=t-Ov,i=km(n*n+r*r);aw+=i*(Av+e)/2,sw+=i*(Ov+t)/2,ob+=i,AE+=(i=Ov*e-Av*t)*(Av+e),OE+=i*(Ov+t),nx+=3*i,ly(Av=e,Ov=t)}var zS=ev;function US(e){this._context=e}US.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,wm)}},result:Vd};var SE,WS,VS,rx,ix,DE=new xm,uw={point:Vd,lineStart:function(){uw.point=t6},lineEnd:function(){SE&&qS(WS,VS),uw.point=Vd},polygonStart:function(){SE=!0},polygonEnd:function(){SE=null},result:function(){var e=+DE;return DE=new xm,e}};function t6(e,t){uw.point=qS,WS=rx=e,VS=ix=t}function qS(e,t){rx-=e,ix-=t,DE.add(km(rx*rx+ix*ix)),rx=e,ix=t}var HS=uw;function GS(){this._string=[]}function $S(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}GS.prototype={_radius:4.5,_circle:$S(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:this._circle==null&&(this._circle=$S(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}return null}};var KS=function(e,t){var n,r,i=4.5;function s(f){return f&&(typeof i=="function"&&r.pointRadius(+i.apply(this,arguments)),Yv(f,n(r))),r.result()}return s.area=function(f){return Yv(f,n(RS)),RS.result()},s.measure=function(f){return Yv(f,n(HS)),HS.result()},s.bounds=function(f){return Yv(f,n(ow)),ow.result()},s.centroid=function(f){return Yv(f,n(zS)),zS.result()},s.projection=function(f){return arguments.length?(n=f==null?(e=null,Zb):(e=f).stream,s):e},s.context=function(f){return arguments.length?(r=f==null?(t=null,new GS):new US(t=f),typeof i!="function"&&r.pointRadius(i),s):t},s.pointRadius=function(f){return arguments.length?(i=typeof f=="function"?f:(r.pointRadius(+f),+f),s):i},s.projection(e).context(t)},XS=function(){var e,t=[];return{point:function(n,r,i){e.push([n,r,i])},lineStart:function(){t.push(e=[])},lineEnd:Vd,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}},cw=function(e,t){return zs(e[0]-t[0])<Go&&zs(e[1]-t[1])<Go};function lw(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}var YS=function(e,t,n,r,i){var s,f,v=[],w=[];if(e.forEach(function(fe){if(!((ve=fe.length-1)<=0)){var ve,Be,We=fe[0],Ve=fe[ve];if(cw(We,Ve)){if(!We[2]&&!Ve[2]){for(i.lineStart(),s=0;s<ve;++s)i.point((We=fe[s])[0],We[1]);return void i.lineEnd()}Ve[0]+=2*Go}v.push(Be=new lw(We,fe,null,!0)),w.push(Be.o=new lw(We,null,Be,!1)),v.push(Be=new lw(Ve,fe,null,!1)),w.push(Be.o=new lw(Ve,null,Be,!0))}}),v.length){for(w.sort(t),JS(v),JS(w),s=0,f=w.length;s<f;++s)w[s].e=n=!n;for(var O,N,L=v[0];;){for(var Y=L,ie=!0;Y.v;)if((Y=Y.n)===L)return;O=Y.z,i.lineStart();do{if(Y.v=Y.o.v=!0,Y.e){if(ie)for(s=0,f=O.length;s<f;++s)i.point((N=O[s])[0],N[1]);else r(Y.x,Y.n.x,1,i);Y=Y.n}else{if(ie)for(O=Y.p.z,s=O.length-1;s>=0;--s)i.point((N=O[s])[0],N[1]);else r(Y.x,Y.p.x,-1,i);Y=Y.p}O=(Y=Y.o).z,ie=!ie}while(!Y.v);i.lineEnd()}}};function JS(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;)i.n=n=e[r],n.p=i,i=n;i.n=n=e[0],n.p=i}}function fw(e){return[M0(e[1],e[0]),mg(e[2])]}function fy(e){var t=e[0],n=e[1],r=Xo(n);return[r*Xo(t),r*Mo(t),Mo(n)]}function hw(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function ab(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function TE(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function dw(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function pw(e){var t=km(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function NE(e){return zs(e[0])<=ss?e[0]:j0(e[0])*((zs(e[0])+ss)%wm-ss)}function QS(e){return Array.from(function*(t){for(const n of t)yield*n}(e))}var ZS=function(e,t,n,r){return function(i){var s,f,v,w=t(i),O=XS(),N=t(O),L=!1,Y={point:ie,lineStart:ve,lineEnd:Be,polygonStart:function(){Y.point=We,Y.lineStart=Ve,Y.lineEnd=ct,f=[],s=[]},polygonEnd:function(){Y.point=ie,Y.lineStart=ve,Y.lineEnd=Be,f=QS(f);var lt=function(mt,dt){var kt=NE(dt),wt=dt[1],dn=Mo(wt),Dn=[Mo(kt),-Xo(kt),0],wn=0,Xn=0,Kn=new xm;dn===1?wt=Xl+Go:dn===-1&&(wt=-Xl-Go);for(var ir=0,sr=mt.length;ir<sr;++ir)if(Vr=(gr=mt[ir]).length)for(var gr,Vr,hi=gr[Vr-1],Qr=NE(hi),Ni=hi[1]/2+ew,ro=Mo(Ni),oo=Xo(Ni),Po=0;Po<Vr;++Po,Qr=ao,ro=_a,oo=ys,hi=ho){var ho=gr[Po],ao=NE(ho),xo=ho[1]/2+ew,_a=Mo(xo),ys=Xo(xo),Lo=ao-Qr,Vs=Lo>=0?1:-1,qs=Vs*Lo,Su=qs>ss,Ic=ro*_a;if(Kn.add(M0(Ic*Vs*Mo(qs),oo*ys+Ic*Xo(qs))),wn+=Su?Lo+Vs*wm:Lo,Su^Qr>=kt^ao>=kt){var Fc=ab(fy(hi),fy(ho));pw(Fc);var xc=ab(Dn,Fc);pw(xc);var Kd=(Su^Lo>=0?-1:1)*mg(xc[2]);(wt>Kd||wt===Kd&&(Fc[0]||Fc[1]))&&(Xn+=Su^Lo>=0?1:-1)}}return(wn<-Go||wn<Go&&Kn<-1e-12)^1&Xn}(s,r);f.length?(L||(i.polygonStart(),L=!0),YS(f,r6,lt,n,i)):lt&&(L||(i.polygonStart(),L=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),L&&(i.polygonEnd(),L=!1),f=s=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function ie(lt,mt){e(lt,mt)&&i.point(lt,mt)}function fe(lt,mt){w.point(lt,mt)}function ve(){Y.point=fe,w.lineStart()}function Be(){Y.point=ie,w.lineEnd()}function We(lt,mt){v.push([lt,mt]),N.point(lt,mt)}function Ve(){N.lineStart(),v=[]}function ct(){We(v[0][0],v[0][1]),N.lineEnd();var lt,mt,dt,kt,wt=N.clean(),dn=O.result(),Dn=dn.length;if(v.pop(),s.push(v),v=null,Dn)if(1&wt){if((mt=(dt=dn[0]).length-1)>0){for(L||(i.polygonStart(),L=!0),i.lineStart(),lt=0;lt<mt;++lt)i.point((kt=dt[lt])[0],kt[1]);i.lineEnd()}}else Dn>1&&2&wt&&dn.push(dn.pop().concat(dn.shift())),f.push(dn.filter(n6))}return Y}};function n6(e){return e.length>1}function r6(e,t){return((e=e.x)[0]<0?e[1]-Xl-Go:Xl-e[1])-((t=t.x)[0]<0?t[1]-Xl-Go:Xl-t[1])}var e4=ZS(function(){return!0},function(e){var t,n=NaN,r=NaN,i=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(s,f){var v=s>0?ss:-ss,w=zs(s-n);zs(w-ss)<Go?(e.point(n,r=(r+f)/2>0?Xl:-Xl),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(v,r),e.point(s,r),t=0):i!==v&&w>=ss&&(zs(n-i)<Go&&(n-=i*Go),zs(s-v)<Go&&(s-=v*Go),r=function(O,N,L,Y){var ie,fe,ve=Mo(O-L);return zs(ve)>Go?rb((Mo(N)*(fe=Xo(Y))*Mo(L)-Mo(Y)*(ie=Xo(N))*Mo(O))/(ie*fe*ve)):(N+Y)/2}(n,r,s,f),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(v,r),t=0),e.point(n=s,r=f),i=v},lineEnd:function(){e.lineEnd(),n=r=NaN},clean:function(){return 2-t}}},function(e,t,n,r){var i;if(e==null)i=n*Xl,r.point(-ss,i),r.point(0,i),r.point(ss,i),r.point(ss,0),r.point(ss,-i),r.point(0,-i),r.point(-ss,-i),r.point(-ss,0),r.point(-ss,i);else if(zs(e[0]-t[0])>Go){var s=e[0]<t[0]?ss:-ss;i=n*s/2,r.point(-s,i),r.point(0,i),r.point(s,i)}else r.point(t[0],t[1])},[-ss,-Xl]),IE=function(e,t){function n(r,i){return r=e(r,i),t(r[0],r[1])}return e.invert&&t.invert&&(n.invert=function(r,i){return(r=t.invert(r,i))&&e.invert(r[0],r[1])}),n};function FE(e,t){return[zs(e)>ss?e+Math.round(-e/wm)*wm:e,t]}function t4(e,t,n){return(e%=wm)?t||n?IE(r4(e),i4(t,n)):r4(e):t||n?i4(t,n):FE}function n4(e){return function(t,n){return[(t+=e)>ss?t-wm:t<-ss?t+wm:t,n]}}function r4(e){var t=n4(e);return t.invert=n4(-e),t}function i4(e,t){var n=Xo(e),r=Mo(e),i=Xo(t),s=Mo(t);function f(v,w){var O=Xo(w),N=Xo(v)*O,L=Mo(v)*O,Y=Mo(w),ie=Y*n+N*r;return[M0(L*i-ie*s,N*n-Y*r),mg(ie*i+L*s)]}return f.invert=function(v,w){var O=Xo(w),N=Xo(v)*O,L=Mo(v)*O,Y=Mo(w),ie=Y*i-L*s;return[M0(L*i+Y*s,N*n+ie*r),mg(ie*n-N*r)]},f}FE.invert=FE;var i6=function(e){function t(n){return(n=e(n[0]*us,n[1]*us))[0]*=kf,n[1]*=kf,n}return e=t4(e[0]*us,e[1]*us,e.length>2?e[2]*us:0),t.invert=function(n){return(n=e.invert(n[0]*us,n[1]*us))[0]*=kf,n[1]*=kf,n},t};function o6(e,t,n,r,i,s){if(n){var f=Xo(t),v=Mo(t),w=r*n;i==null?(i=t+r*wm,s=t-w/2):(i=o4(f,i),s=o4(f,s),(r>0?i<s:i>s)&&(i+=r*wm));for(var O,N=i;r>0?N>s:N<s;N-=w)O=fw([f,-v*Xo(N),-v*Mo(N)]),e.point(O[0],O[1])}}function o4(e,t){(t=fy(t))[0]-=e,pw(t);var n=TS(-t[1]);return((-t[2]<0?-n:n)+wm-Go)%wm}var a6=function(e){var t=Xo(e),n=6*us,r=t>0,i=zs(t)>Go;function s(w,O){return Xo(w)*Xo(O)>t}function f(w,O,N){var L=[1,0,0],Y=ab(fy(w),fy(O)),ie=hw(Y,Y),fe=Y[0],ve=ie-fe*fe;if(!ve)return!N&&w;var Be=t*ie/ve,We=-t*fe/ve,Ve=ab(L,Y),ct=dw(L,Be);TE(ct,dw(Y,We));var lt=Ve,mt=hw(ct,lt),dt=hw(lt,lt),kt=mt*mt-dt*(hw(ct,ct)-1);if(!(kt<0)){var wt=km(kt),dn=dw(lt,(-mt-wt)/dt);if(TE(dn,ct),dn=fw(dn),!N)return dn;var Dn,wn=w[0],Xn=O[0],Kn=w[1],ir=O[1];Xn<wn&&(Dn=wn,wn=Xn,Xn=Dn);var sr=Xn-wn,gr=zs(sr-ss)<Go;if(!gr&&ir<Kn&&(Dn=Kn,Kn=ir,ir=Dn),gr||sr<Go?gr?Kn+ir>0^dn[1]<(zs(dn[0]-wn)<Go?Kn:ir):Kn<=dn[1]&&dn[1]<=ir:sr>ss^(wn<=dn[0]&&dn[0]<=Xn)){var Vr=dw(lt,(-mt+wt)/dt);return TE(Vr,ct),[dn,fw(Vr)]}}}function v(w,O){var N=r?e:ss-e,L=0;return w<-N?L|=1:w>N&&(L|=2),O<-N?L|=4:O>N&&(L|=8),L}return ZS(s,function(w){var O,N,L,Y,ie;return{lineStart:function(){Y=L=!1,ie=1},point:function(fe,ve){var Be,We=[fe,ve],Ve=s(fe,ve),ct=r?Ve?0:v(fe,ve):Ve?v(fe+(fe<0?ss:-ss),ve):0;if(!O&&(Y=L=Ve)&&w.lineStart(),Ve!==L&&(!(Be=f(O,We))||cw(O,Be)||cw(We,Be))&&(We[2]=1),Ve!==L)ie=0,Ve?(w.lineStart(),Be=f(We,O),w.point(Be[0],Be[1])):(Be=f(O,We),w.point(Be[0],Be[1],2),w.lineEnd()),O=Be;else if(i&&O&&r^Ve){var lt;ct&N||!(lt=f(We,O,!0))||(ie=0,r?(w.lineStart(),w.point(lt[0][0],lt[0][1]),w.point(lt[1][0],lt[1][1]),w.lineEnd()):(w.point(lt[1][0],lt[1][1]),w.lineEnd(),w.lineStart(),w.point(lt[0][0],lt[0][1],3)))}!Ve||O&&cw(O,We)||w.point(We[0],We[1]),O=We,L=Ve,N=ct},lineEnd:function(){L&&w.lineEnd(),O=null},clean:function(){return ie|(Y&&L)<<1}}},function(w,O,N,L){o6(L,e,n,N,w,O)},r?[0,-e]:[-ss,e-ss])},s6=function(e,t,n,r,i,s){var f,v=e[0],w=e[1],O=0,N=1,L=t[0]-v,Y=t[1]-w;if(f=n-v,L||!(f>0)){if(f/=L,L<0){if(f<O)return;f<N&&(N=f)}else if(L>0){if(f>N)return;f>O&&(O=f)}if(f=i-v,L||!(f<0)){if(f/=L,L<0){if(f>N)return;f>O&&(O=f)}else if(L>0){if(f<O)return;f<N&&(N=f)}if(f=r-w,Y||!(f>0)){if(f/=Y,Y<0){if(f<O)return;f<N&&(N=f)}else if(Y>0){if(f>N)return;f>O&&(O=f)}if(f=s-w,Y||!(f<0)){if(f/=Y,Y<0){if(f>N)return;f>O&&(O=f)}else if(Y>0){if(f<O)return;f<N&&(N=f)}return O>0&&(e[0]=v+O*L,e[1]=w+O*Y),N<1&&(t[0]=v+N*L,t[1]=w+N*Y),!0}}}}},ox=1e9,mw=-ox;function a4(e,t,n,r){function i(O,N){return e<=O&&O<=n&&t<=N&&N<=r}function s(O,N,L,Y){var ie=0,fe=0;if(O==null||(ie=f(O,L))!==(fe=f(N,L))||w(O,N)<0^L>0)do Y.point(ie===0||ie===3?e:n,ie>1?r:t);while((ie=(ie+L+4)%4)!==fe);else Y.point(N[0],N[1])}function f(O,N){return zs(O[0]-e)<Go?N>0?0:3:zs(O[0]-n)<Go?N>0?2:1:zs(O[1]-t)<Go?N>0?1:0:N>0?3:2}function v(O,N){return w(O.x,N.x)}function w(O,N){var L=f(O,1),Y=f(N,1);return L!==Y?L-Y:L===0?N[1]-O[1]:L===1?O[0]-N[0]:L===2?O[1]-N[1]:N[0]-O[0]}return function(O){var N,L,Y,ie,fe,ve,Be,We,Ve,ct,lt,mt=O,dt=XS(),kt={point:wt,lineStart:function(){kt.point=dn,L&&L.push(Y=[]),ct=!0,Ve=!1,Be=We=NaN},lineEnd:function(){N&&(dn(ie,fe),ve&&Ve&&dt.rejoin(),N.push(dt.result())),kt.point=wt,Ve&&mt.lineEnd()},polygonStart:function(){mt=dt,N=[],L=[],lt=!0},polygonEnd:function(){var Dn=function(){for(var Kn=0,ir=0,sr=L.length;ir<sr;++ir)for(var gr,Vr,hi=L[ir],Qr=1,Ni=hi.length,ro=hi[0],oo=ro[0],Po=ro[1];Qr<Ni;++Qr)gr=oo,Vr=Po,ro=hi[Qr],oo=ro[0],Po=ro[1],Vr<=r?Po>r&&(oo-gr)*(r-Vr)>(Po-Vr)*(e-gr)&&++Kn:Po<=r&&(oo-gr)*(r-Vr)<(Po-Vr)*(e-gr)&&--Kn;return Kn}(),wn=lt&&Dn,Xn=(N=QS(N)).length;(wn||Xn)&&(O.polygonStart(),wn&&(O.lineStart(),s(null,null,1,O),O.lineEnd()),Xn&&YS(N,v,Dn,s,O),O.polygonEnd()),mt=O,N=L=Y=null}};function wt(Dn,wn){i(Dn,wn)&&mt.point(Dn,wn)}function dn(Dn,wn){var Xn=i(Dn,wn);if(L&&Y.push([Dn,wn]),ct)ie=Dn,fe=wn,ve=Xn,ct=!1,Xn&&(mt.lineStart(),mt.point(Dn,wn));else if(Xn&&Ve)mt.point(Dn,wn);else{var Kn=[Be=Math.max(mw,Math.min(ox,Be)),We=Math.max(mw,Math.min(ox,We))],ir=[Dn=Math.max(mw,Math.min(ox,Dn)),wn=Math.max(mw,Math.min(ox,wn))];s6(Kn,ir,e,t,n,r)?(Ve||(mt.lineStart(),mt.point(Kn[0],Kn[1])),mt.point(ir[0],ir[1]),Xn||mt.lineEnd(),lt=!1):Xn&&(mt.lineStart(),mt.point(Dn,wn),lt=!1)}Be=Dn,We=wn,Ve=Xn}return kt}}function gw(e){return function(t){var n=new RE;for(var r in e)n[r]=e[r];return n.stream=t,n}}function RE(){}function ME(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),r!=null&&e.clipExtent(null),Yv(n,e.stream(ow)),t(ow.result()),r!=null&&e.clipExtent(r),e}function vw(e,t,n){return ME(e,function(r){var i=t[1][0]-t[0][0],s=t[1][1]-t[0][1],f=Math.min(i/(r[1][0]-r[0][0]),s/(r[1][1]-r[0][1])),v=+t[0][0]+(i-f*(r[1][0]+r[0][0]))/2,w=+t[0][1]+(s-f*(r[1][1]+r[0][1]))/2;e.scale(150*f).translate([v,w])},n)}function jE(e,t,n){return vw(e,[[0,0],t],n)}function BE(e,t,n){return ME(e,function(r){var i=+t,s=i/(r[1][0]-r[0][0]),f=(i-s*(r[1][0]+r[0][0]))/2,v=-s*r[0][1];e.scale(150*s).translate([f,v])},n)}function PE(e,t,n){return ME(e,function(r){var i=+t,s=i/(r[1][1]-r[0][1]),f=-s*r[0][0],v=(i-s*(r[1][1]+r[0][1]))/2;e.scale(150*s).translate([f,v])},n)}RE.prototype={constructor:RE,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var s4=16,u6=Xo(30*us),u4=function(e,t){return+t?function(n,r){function i(s,f,v,w,O,N,L,Y,ie,fe,ve,Be,We,Ve){var ct=L-s,lt=Y-f,mt=ct*ct+lt*lt;if(mt>4*r&&We--){var dt=w+fe,kt=O+ve,wt=N+Be,dn=km(dt*dt+kt*kt+wt*wt),Dn=mg(wt/=dn),wn=zs(zs(wt)-1)<Go||zs(v-ie)<Go?(v+ie)/2:M0(kt,dt),Xn=n(wn,Dn),Kn=Xn[0],ir=Xn[1],sr=Kn-s,gr=ir-f,Vr=lt*sr-ct*gr;(Vr*Vr/mt>r||zs((ct*sr+lt*gr)/mt-.5)>.3||w*fe+O*ve+N*Be<u6)&&(i(s,f,v,w,O,N,Kn,ir,wn,dt/=dn,kt/=dn,wt,We,Ve),Ve.point(Kn,ir),i(Kn,ir,wn,dt,kt,wt,L,Y,ie,fe,ve,Be,We,Ve))}}return function(s){var f,v,w,O,N,L,Y,ie,fe,ve,Be,We,Ve={point:ct,lineStart:lt,lineEnd:dt,polygonStart:function(){s.polygonStart(),Ve.lineStart=kt},polygonEnd:function(){s.polygonEnd(),Ve.lineStart=lt}};function ct(Dn,wn){Dn=n(Dn,wn),s.point(Dn[0],Dn[1])}function lt(){ie=NaN,Ve.point=mt,s.lineStart()}function mt(Dn,wn){var Xn=fy([Dn,wn]),Kn=n(Dn,wn);i(ie,fe,Y,ve,Be,We,ie=Kn[0],fe=Kn[1],Y=Dn,ve=Xn[0],Be=Xn[1],We=Xn[2],s4,s),s.point(ie,fe)}function dt(){Ve.point=ct,s.lineEnd()}function kt(){lt(),Ve.point=wt,Ve.lineEnd=dn}function wt(Dn,wn){mt(f=Dn,wn),v=ie,w=fe,O=ve,N=Be,L=We,Ve.point=mt}function dn(){i(ie,fe,Y,ve,Be,We,v,w,f,O,N,L,s4,s),Ve.lineEnd=dt,dt()}return Ve}}(e,t):function(n){return gw({point:function(r,i){r=n(r,i),this.stream.point(r[0],r[1])}})}(e)},c6=gw({point:function(e,t){this.stream.point(e*us,t*us)}});function c4(e,t,n,r,i,s){if(!s)return function(ve,Be,We,Ve,ct){function lt(mt,dt){return[Be+ve*(mt*=Ve),We-ve*(dt*=ct)]}return lt.invert=function(mt,dt){return[(mt-Be)/ve*Ve,(We-dt)/ve*ct]},lt}(e,t,n,r,i);var f=Xo(s),v=Mo(s),w=f*e,O=v*e,N=f/e,L=v/e,Y=(v*n-f*t)/e,ie=(v*t+f*n)/e;function fe(ve,Be){return[w*(ve*=r)-O*(Be*=i)+t,n-O*ve-w*Be]}return fe.invert=function(ve,Be){return[r*(N*ve-L*Be+Y),i*(ie-L*ve-N*Be)]},fe}function Sv(e){return l4(function(){return e})()}function l4(e){var t,n,r,i,s,f,v,w,O,N,L=150,Y=480,ie=250,fe=0,ve=0,Be=0,We=0,Ve=0,ct=0,lt=1,mt=1,dt=null,kt=e4,wt=null,dn=Zb,Dn=.5;function wn(sr){return w(sr[0]*us,sr[1]*us)}function Xn(sr){return(sr=w.invert(sr[0],sr[1]))&&[sr[0]*kf,sr[1]*kf]}function Kn(){var sr=c4(L,0,0,lt,mt,ct).apply(null,t(fe,ve)),gr=c4(L,Y-sr[0],ie-sr[1],lt,mt,ct);return n=t4(Be,We,Ve),v=IE(t,gr),w=IE(n,v),f=u4(v,Dn),ir()}function ir(){return O=N=null,wn}return wn.stream=function(sr){return O&&N===sr?O:O=c6(function(gr){return gw({point:function(Vr,hi){var Qr=gr(Vr,hi);return this.stream.point(Qr[0],Qr[1])}})}(n)(kt(f(dn(N=sr)))))},wn.preclip=function(sr){return arguments.length?(kt=sr,dt=void 0,ir()):kt},wn.postclip=function(sr){return arguments.length?(dn=sr,wt=r=i=s=null,ir()):dn},wn.clipAngle=function(sr){return arguments.length?(kt=+sr?a6(dt=sr*us):(dt=null,e4),ir()):dt*kf},wn.clipExtent=function(sr){return arguments.length?(dn=sr==null?(wt=r=i=s=null,Zb):a4(wt=+sr[0][0],r=+sr[0][1],i=+sr[1][0],s=+sr[1][1]),ir()):wt==null?null:[[wt,r],[i,s]]},wn.scale=function(sr){return arguments.length?(L=+sr,Kn()):L},wn.translate=function(sr){return arguments.length?(Y=+sr[0],ie=+sr[1],Kn()):[Y,ie]},wn.center=function(sr){return arguments.length?(fe=sr[0]%360*us,ve=sr[1]%360*us,Kn()):[fe*kf,ve*kf]},wn.rotate=function(sr){return arguments.length?(Be=sr[0]%360*us,We=sr[1]%360*us,Ve=sr.length>2?sr[2]%360*us:0,Kn()):[Be*kf,We*kf,Ve*kf]},wn.angle=function(sr){return arguments.length?(ct=sr%360*us,Kn()):ct*kf},wn.reflectX=function(sr){return arguments.length?(lt=sr?-1:1,Kn()):lt<0},wn.reflectY=function(sr){return arguments.length?(mt=sr?-1:1,Kn()):mt<0},wn.precision=function(sr){return arguments.length?(f=u4(v,Dn=sr*sr),ir()):km(Dn)},wn.fitExtent=function(sr,gr){return vw(wn,sr,gr)},wn.fitSize=function(sr,gr){return jE(wn,sr,gr)},wn.fitWidth=function(sr,gr){return BE(wn,sr,gr)},wn.fitHeight=function(sr,gr){return PE(wn,sr,gr)},function(){return t=e.apply(this,arguments),wn.invert=t.invert&&Xn,Kn()}}function LE(e){var t=0,n=ss/3,r=l4(e),i=r(t,n);return i.parallels=function(s){return arguments.length?r(t=s[0]*us,n=s[1]*us):[t*kf,n*kf]},i}function l6(e,t){var n=Mo(e),r=(n+Mo(t))/2;if(zs(r)<Go)return function(v){var w=Xo(v);function O(N,L){return[N*w,Mo(L)/w]}return O.invert=function(N,L){return[N/w,mg(L*w)]},O}(e);var i=1+n*(2*r-n),s=km(i)/r;function f(v,w){var O=km(i-2*r*Mo(w))/r;return[O*Mo(v*=r),s-O*Xo(v)]}return f.invert=function(v,w){var O=s-w,N=M0(v,zs(O))*j0(O);return O*r<0&&(N-=ss*j0(v)*j0(O)),[N/r,mg((i-(v*v+O*O)*r*r)/(2*r))]},f}var yw=function(){return LE(l6).scale(155.424).center([0,33.6442])},f4=function(){return yw().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])};function h4(e){return function(t,n){var r=Xo(t),i=Xo(n),s=e(r*i);return s===1/0?[2,0]:[s*i*Mo(t),s*Mo(n)]}}function ax(e){return function(t,n){var r=km(t*t+n*n),i=e(r),s=Mo(i),f=Xo(i);return[M0(t*s,r*f),mg(r&&n*s/r)]}}var d4=h4(function(e){return km(2/(1+e))});d4.invert=ax(function(e){return 2*mg(e/2)});var p4=h4(function(e){return(e=TS(e))&&e/Mo(e)});p4.invert=ax(function(e){return e});function bw(e,t){return[e,nw(bE((Xl+t)/2))]}bw.invert=function(e,t){return[e,2*rb(DS(t))-Xl]};function m4(e){var t,n,r,i=Sv(e),s=i.center,f=i.scale,v=i.translate,w=i.clipExtent,O=null;function N(){var L=ss*f(),Y=i(i6(i.rotate()).invert([0,0]));return w(O==null?[[Y[0]-L,Y[1]-L],[Y[0]+L,Y[1]+L]]:e===bw?[[Math.max(Y[0]-L,O),t],[Math.min(Y[0]+L,n),r]]:[[O,Math.max(Y[1]-L,t)],[n,Math.min(Y[1]+L,r)]])}return i.scale=function(L){return arguments.length?(f(L),N()):f()},i.translate=function(L){return arguments.length?(v(L),N()):v()},i.center=function(L){return arguments.length?(s(L),N()):s()},i.clipExtent=function(L){return arguments.length?(L==null?O=t=n=r=null:(O=+L[0][0],t=+L[0][1],n=+L[1][0],r=+L[1][1]),N()):O==null?null:[[O,t],[n,r]]},N()}function xw(e){return bE((Xl+e)/2)}function f6(e,t){var n=Xo(e),r=e===t?Mo(e):nw(n/Xo(t))/nw(xw(t)/xw(e)),i=n*yE(xw(e),r)/r;if(!r)return bw;function s(f,v){i>0?v<-Xl+Go&&(v=-Xl+Go):v>Xl-Go&&(v=Xl-Go);var w=i/yE(xw(v),r);return[w*Mo(r*f),i-w*Xo(r*f)]}return s.invert=function(f,v){var w=i-v,O=j0(r)*km(f*f+w*w),N=M0(f,zs(w))*j0(w);return w*r<0&&(N-=ss*j0(f)*j0(w)),[N/r,2*rb(yE(i/O,1/r))-Xl]},s}function ww(e,t){return[e,t]}ww.invert=ww;function h6(e,t){var n=Xo(e),r=e===t?Mo(e):(n-Xo(t))/(t-e),i=n/r+e;if(zs(r)<Go)return ww;function s(f,v){var w=i-v,O=r*f;return[w*Mo(O),i-w*Xo(O)]}return s.invert=function(f,v){var w=i-v,O=M0(f,zs(w))*j0(w);return w*r<0&&(O-=ss*j0(f)*j0(w)),[O/r,i-j0(r)*km(f*f+w*w)]},s}var sx=1.340264,ux=-.081106,cx=893e-6,lx=.003796,kw=km(3)/2;function g4(e,t){var n=mg(kw*Mo(t)),r=n*n,i=r*r*r;return[e*Xo(n)/(kw*(sx+3*ux*r+i*(7*cx+9*lx*r))),n*(sx+ux*r+i*(cx+lx*r))]}g4.invert=function(e,t){for(var n,r=t,i=r*r,s=i*i*i,f=0;f<12&&(s=(i=(r-=n=(r*(sx+ux*i+s*(cx+lx*i))-t)/(sx+3*ux*i+s*(7*cx+9*lx*i)))*r)*i*i,!(zs(n)<1e-12));++f);return[kw*e*(sx+3*ux*i+s*(7*cx+9*lx*i))/Xo(r),mg(Mo(r)/kw)]};function v4(e,t){var n=Xo(t),r=Xo(e)*n;return[n*Mo(e)/r,Mo(t)/r]}v4.invert=ax(rb);function y4(e,t){var n=t*t,r=n*n;return[e*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791)),t*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))]}y4.invert=function(e,t){var n,r=t,i=25;do{var s=r*r,f=s*s;r-=n=(r*(1.007226+s*(.015085+f*(.028874*s-.044475-.005916*f)))-t)/(1.007226+s*(.045255+f*(.259866*s-.311325-.005916*11*f)))}while(zs(n)>Go&&--i>0);return[e/(.8707+(s=r*r)*(s*(s*s*s*(.003971-.001529*s)-.013791)-.131979)),r]};function b4(e,t){return[Xo(t)*Mo(e),Mo(t)]}b4.invert=ax(mg);function x4(e,t){var n=Xo(t),r=1+Xo(e)*n;return[n*Mo(e)/r,Mo(t)/r]}x4.invert=ax(function(e){return 2*rb(e)});function w4(e,t){return[nw(bE((Xl+t)/2)),-e]}w4.invert=function(e,t){return[-t,2*rb(DS(e))-Xl]};var d6=Math.abs,zE=Math.cos,_w=Math.sin,p6=1e-6,k4=Math.PI,UE=k4/2,_4=m6(2);function E4(e){return e>1?UE:e<-1?-UE:Math.asin(e)}function m6(e){return e>0?Math.sqrt(e):0}var g6=function(e,t,n){function r(i,s){return[e*i*zE(s=function(f,v){var w,O=f*_w(v),N=30;do v-=w=(v+_w(v)-O)/(1+zE(v));while(d6(w)>p6&&--N>0);return v/2}(n,s)),t*_w(s)]}return r.invert=function(i,s){return s=E4(s/t),[i/(e*zE(s)),E4((2*s+_w(2*s))/n)]},r}(_4/UE,_4,k4);const v6=KS(),WE=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function VE(e,t){if(!e||typeof e!="string")throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(Ew[e]=function(n,r){return function i(){const s=r();return s.type=n,s.path=KS().projection(s),s.copy=s.copy||function(){const f=i();return WE.forEach(v=>{s[v]&&f[v](s[v]())}),f.path.pointRadius(s.path.pointRadius()),f},s}}(e,t),this):Ew[e]||null}function C4(e){return e&&e.path||v6}const Ew={albers:f4,albersusa:function(){var e,t,n,r,i,s,f=f4(),v=yw().rotate([154,0]).center([-2,58.5]).parallels([55,65]),w=yw().rotate([157,0]).center([-3,19.9]).parallels([8,18]),O={point:function(Y,ie){s=[Y,ie]}};function N(Y){var ie=Y[0],fe=Y[1];return s=null,n.point(ie,fe),s||(r.point(ie,fe),s)||(i.point(ie,fe),s)}function L(){return e=t=null,N}return N.invert=function(Y){var ie=f.scale(),fe=f.translate(),ve=(Y[0]-fe[0])/ie,Be=(Y[1]-fe[1])/ie;return(Be>=.12&&Be<.234&&ve>=-.425&&ve<-.214?v:Be>=.166&&Be<.234&&ve>=-.214&&ve<-.115?w:f).invert(Y)},N.stream=function(Y){return e&&t===Y?e:e=function(ie){var fe=ie.length;return{point:function(ve,Be){for(var We=-1;++We<fe;)ie[We].point(ve,Be)},sphere:function(){for(var ve=-1;++ve<fe;)ie[ve].sphere()},lineStart:function(){for(var ve=-1;++ve<fe;)ie[ve].lineStart()},lineEnd:function(){for(var ve=-1;++ve<fe;)ie[ve].lineEnd()},polygonStart:function(){for(var ve=-1;++ve<fe;)ie[ve].polygonStart()},polygonEnd:function(){for(var ve=-1;++ve<fe;)ie[ve].polygonEnd()}}}([f.stream(t=Y),v.stream(Y),w.stream(Y)])},N.precision=function(Y){return arguments.length?(f.precision(Y),v.precision(Y),w.precision(Y),L()):f.precision()},N.scale=function(Y){return arguments.length?(f.scale(Y),v.scale(.35*Y),w.scale(Y),N.translate(f.translate())):f.scale()},N.translate=function(Y){if(!arguments.length)return f.translate();var ie=f.scale(),fe=+Y[0],ve=+Y[1];return n=f.translate(Y).clipExtent([[fe-.455*ie,ve-.238*ie],[fe+.455*ie,ve+.238*ie]]).stream(O),r=v.translate([fe-.307*ie,ve+.201*ie]).clipExtent([[fe-.425*ie+Go,ve+.12*ie+Go],[fe-.214*ie-Go,ve+.234*ie-Go]]).stream(O),i=w.translate([fe-.205*ie,ve+.212*ie]).clipExtent([[fe-.214*ie+Go,ve+.166*ie+Go],[fe-.115*ie-Go,ve+.234*ie-Go]]).stream(O),L()},N.fitExtent=function(Y,ie){return vw(N,Y,ie)},N.fitSize=function(Y,ie){return jE(N,Y,ie)},N.fitWidth=function(Y,ie){return BE(N,Y,ie)},N.fitHeight=function(Y,ie){return PE(N,Y,ie)},N.scale(1070)},azimuthalequalarea:function(){return Sv(d4).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return Sv(p4).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return LE(f6).scale(109.5).parallels([30,30])},conicequalarea:yw,conicequidistant:function(){return LE(h6).scale(131.154).center([0,13.9389])},equalEarth:function(){return Sv(g4).scale(177.158)},equirectangular:function(){return Sv(ww).scale(152.63)},gnomonic:function(){return Sv(v4).scale(144.049).clipAngle(60)},identity:function(){var e,t,n,r,i,s,f,v=1,w=0,O=0,N=1,L=1,Y=0,ie=null,fe=1,ve=1,Be=gw({point:function(lt,mt){var dt=ct([lt,mt]);this.stream.point(dt[0],dt[1])}}),We=Zb;function Ve(){return fe=v*N,ve=v*L,s=f=null,ct}function ct(lt){var mt=lt[0]*fe,dt=lt[1]*ve;if(Y){var kt=dt*e-mt*t;mt=mt*e+dt*t,dt=kt}return[mt+w,dt+O]}return ct.invert=function(lt){var mt=lt[0]-w,dt=lt[1]-O;if(Y){var kt=dt*e+mt*t;mt=mt*e-dt*t,dt=kt}return[mt/fe,dt/ve]},ct.stream=function(lt){return s&&f===lt?s:s=Be(We(f=lt))},ct.postclip=function(lt){return arguments.length?(We=lt,ie=n=r=i=null,Ve()):We},ct.clipExtent=function(lt){return arguments.length?(We=lt==null?(ie=n=r=i=null,Zb):a4(ie=+lt[0][0],n=+lt[0][1],r=+lt[1][0],i=+lt[1][1]),Ve()):ie==null?null:[[ie,n],[r,i]]},ct.scale=function(lt){return arguments.length?(v=+lt,Ve()):v},ct.translate=function(lt){return arguments.length?(w=+lt[0],O=+lt[1],Ve()):[w,O]},ct.angle=function(lt){return arguments.length?(t=Mo(Y=lt%360*us),e=Xo(Y),Ve()):Y*kf},ct.reflectX=function(lt){return arguments.length?(N=lt?-1:1,Ve()):N<0},ct.reflectY=function(lt){return arguments.length?(L=lt?-1:1,Ve()):L<0},ct.fitExtent=function(lt,mt){return vw(ct,lt,mt)},ct.fitSize=function(lt,mt){return jE(ct,lt,mt)},ct.fitWidth=function(lt,mt){return BE(ct,lt,mt)},ct.fitHeight=function(lt,mt){return PE(ct,lt,mt)},ct},mercator:function(){return m4(bw).scale(961/wm)},mollweide:function(){return Sv(g6).scale(169.529)},naturalEarth1:function(){return Sv(y4).scale(175.295)},orthographic:function(){return Sv(b4).scale(249.5).clipAngle(90+Go)},stereographic:function(){return Sv(x4).scale(250).clipAngle(142)},transversemercator:function(){var e=m4(w4),t=e.center,n=e.rotate;return e.center=function(r){return arguments.length?t([-r[1],r[0]]):[(r=t())[1],-r[0]]},e.rotate=function(r){return arguments.length?n([r[0],r[1],r.length>2?r[2]+90:90]):[(r=n())[0],r[1],r[2]-90]},n([0,0,90]).scale(159.155)}};for(const e in Ew)VE(e,Ew[e]);function A4(e,t,n){var r=Qi(e,t-Go,n).concat(t);return function(i){return r.map(function(s){return[i,s]})}}function O4(e,t,n){var r=Qi(e,t-Go,n).concat(t);return function(i){return r.map(function(s){return[s,i]})}}function y6(){var e,t,n,r,i,s,f,v,w,O,N,L,Y=10,ie=Y,fe=90,ve=360,Be=2.5;function We(){return{type:"MultiLineString",coordinates:Ve()}}function Ve(){return Qi(tw(r/fe)*fe,n,fe).map(N).concat(Qi(tw(v/ve)*ve,f,ve).map(L)).concat(Qi(tw(t/Y)*Y,e,Y).filter(function(ct){return zs(ct%fe)>Go}).map(w)).concat(Qi(tw(s/ie)*ie,i,ie).filter(function(ct){return zs(ct%ve)>Go}).map(O))}return We.lines=function(){return Ve().map(function(ct){return{type:"LineString",coordinates:ct}})},We.outline=function(){return{type:"Polygon",coordinates:[N(r).concat(L(f).slice(1),N(n).reverse().slice(1),L(v).reverse().slice(1))]}},We.extent=function(ct){return arguments.length?We.extentMajor(ct).extentMinor(ct):We.extentMinor()},We.extentMajor=function(ct){return arguments.length?(r=+ct[0][0],n=+ct[1][0],v=+ct[0][1],f=+ct[1][1],r>n&&(ct=r,r=n,n=ct),v>f&&(ct=v,v=f,f=ct),We.precision(Be)):[[r,v],[n,f]]},We.extentMinor=function(ct){return arguments.length?(t=+ct[0][0],e=+ct[1][0],s=+ct[0][1],i=+ct[1][1],t>e&&(ct=t,t=e,e=ct),s>i&&(ct=s,s=i,i=ct),We.precision(Be)):[[t,s],[e,i]]},We.step=function(ct){return arguments.length?We.stepMajor(ct).stepMinor(ct):We.stepMinor()},We.stepMajor=function(ct){return arguments.length?(fe=+ct[0],ve=+ct[1],We):[fe,ve]},We.stepMinor=function(ct){return arguments.length?(Y=+ct[0],ie=+ct[1],We):[Y,ie]},We.precision=function(ct){return arguments.length?(Be=+ct,w=A4(s,i,90),O=O4(t,e,Be),N=A4(v,f,90),L=O4(r,n,Be),We):Be},We.extentMajor([[-180,-90+Go],[180,90-Go]]).extentMinor([[-180,-80-Go],[180,80+Go]])}function b6(){}const Jv=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function S4(){var e=1,t=1,n=f;function r(v,w){return w.map(O=>i(v,O))}function i(v,w){var O=[],N=[];return function(L,Y,ie){var fe,ve,Be,We,Ve,ct,lt=new Array,mt=new Array;for(fe=ve=-1,We=L[0]>=Y,Jv[We<<1].forEach(dt);++fe<e-1;)Be=We,We=L[fe+1]>=Y,Jv[Be|We<<1].forEach(dt);for(Jv[We<<0].forEach(dt);++ve<t-1;){for(fe=-1,We=L[ve*e+e]>=Y,Ve=L[ve*e]>=Y,Jv[We<<1|Ve<<2].forEach(dt);++fe<e-1;)Be=We,We=L[ve*e+e+fe+1]>=Y,ct=Ve,Ve=L[ve*e+fe+1]>=Y,Jv[Be|We<<1|Ve<<2|ct<<3].forEach(dt);Jv[We|Ve<<3].forEach(dt)}for(fe=-1,Ve=L[ve*e]>=Y,Jv[Ve<<2].forEach(dt);++fe<e-1;)ct=Ve,Ve=L[ve*e+fe+1]>=Y,Jv[Ve<<2|ct<<3].forEach(dt);function dt(kt){var wt,dn,Dn=[kt[0][0]+fe,kt[0][1]+ve],wn=[kt[1][0]+fe,kt[1][1]+ve],Xn=s(Dn),Kn=s(wn);(wt=mt[Xn])?(dn=lt[Kn])?(delete mt[wt.end],delete lt[dn.start],wt===dn?(wt.ring.push(wn),ie(wt.ring)):lt[wt.start]=mt[dn.end]={start:wt.start,end:dn.end,ring:wt.ring.concat(dn.ring)}):(delete mt[wt.end],wt.ring.push(wn),mt[wt.end=Kn]=wt):(wt=lt[Kn])?(dn=mt[Xn])?(delete lt[wt.start],delete mt[dn.end],wt===dn?(wt.ring.push(wn),ie(wt.ring)):lt[dn.start]=mt[wt.end]={start:dn.start,end:wt.end,ring:dn.ring.concat(wt.ring)}):(delete lt[wt.start],wt.ring.unshift(Dn),lt[wt.start=Xn]=wt):lt[Xn]=mt[Kn]={start:Xn,end:Kn,ring:[Dn,wn]}}Jv[Ve<<3].forEach(dt)}(v,w,L=>{n(L,v,w),function(Y){for(var ie=0,fe=Y.length,ve=Y[fe-1][1]*Y[0][0]-Y[fe-1][0]*Y[0][1];++ie<fe;)ve+=Y[ie-1][1]*Y[ie][0]-Y[ie-1][0]*Y[ie][1];return ve}(L)>0?O.push([L]):N.push(L)}),N.forEach(L=>{for(var Y,ie=0,fe=O.length;ie<fe;++ie)if(x6((Y=O[ie])[0],L)!==-1)return void Y.push(L)}),{type:"MultiPolygon",value:w,coordinates:O}}function s(v){return 2*v[0]+v[1]*(e+1)*4}function f(v,w,O){v.forEach(N=>{var L,Y=N[0],ie=N[1],fe=0|Y,ve=0|ie,Be=w[ve*e+fe];Y>0&&Y<e&&fe===Y&&(L=w[ve*e+fe-1],N[0]=Y+(O-L)/(Be-L)-.5),ie>0&&ie<t&&ve===ie&&(L=w[(ve-1)*e+fe],N[1]=ie+(O-L)/(Be-L)-.5)})}return r.contour=i,r.size=function(v){if(!arguments.length)return[e,t];var w=Math.floor(v[0]),O=Math.floor(v[1]);return w>=0&&O>=0||Object(we.o)("invalid size"),e=w,t=O,r},r.smooth=function(v){return arguments.length?(n=v?f:b6,r):n===f},r}function x6(e,t){for(var n,r=-1,i=t.length;++r<i;)if(n=w6(e,t[r]))return n;return 0}function w6(e,t){for(var n=t[0],r=t[1],i=-1,s=0,f=e.length,v=f-1;s<f;v=s++){var w=e[s],O=w[0],N=w[1],L=e[v],Y=L[0],ie=L[1];if(k6(w,L,t))return 0;N>r!=ie>r&&n<(Y-O)*(r-N)/(ie-N)+O&&(i=-i)}return i}function k6(e,t,n){var r;return function(i,s,f){return(s[0]-i[0])*(f[1]-i[1])==(f[0]-i[0])*(s[1]-i[1])}(e,t,n)&&function(i,s,f){return i<=s&&s<=f||f<=s&&s<=i}(e[r=+(e[0]===t[0])],n[r],t[r])}function D4(e,t,n){return function(r){var i=Object(we.q)(r),s=n?Math.min(i[0],0):i[0],f=i[1],v=f-s,w=t?Object(xl.c)(s,f,e):v/(e+1);return Qi(s+w,f,w)}}function qE(e){Ft.call(this,null,e)}function T4(e,t,n,r,i){const s=e.x1||0,f=e.y1||0,v=t*n<0;function w(L){L.forEach(O)}function O(L){v&&L.reverse(),L.forEach(N)}function N(L){L[0]=(L[0]-s)*t+r,L[1]=(L[1]-f)*n+i}return function(L){return L.coordinates.forEach(w),L}}function N4(e,t,n){const r=e>=0?e:mi(t,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function HE(e){return Object(we.E)(e)?e:Object(we.m)(+e)}function I4(){var e=w=>w[0],t=w=>w[1],n=we.Q,r=[-1,-1],i=960,s=500,f=2;function v(w,O){const N=N4(r[0],w,e)>>f,L=N4(r[1],w,t)>>f,Y=N?N+2:0,ie=L?L+2:0,fe=2*Y+(i>>f),ve=2*ie+(s>>f),Be=new Float32Array(fe*ve),We=new Float32Array(fe*ve);let Ve=Be;w.forEach(lt=>{const mt=Y+(+e(lt)>>f),dt=ie+(+t(lt)>>f);mt>=0&&mt<fe&&dt>=0&&dt<ve&&(Be[mt+dt*fe]+=+n(lt))}),N>0&&L>0?(sb(fe,ve,Be,We,N),ub(fe,ve,We,Be,L),sb(fe,ve,Be,We,N),ub(fe,ve,We,Be,L),sb(fe,ve,Be,We,N),ub(fe,ve,We,Be,L)):N>0?(sb(fe,ve,Be,We,N),sb(fe,ve,We,Be,N),sb(fe,ve,Be,We,N),Ve=We):L>0&&(ub(fe,ve,Be,We,L),ub(fe,ve,We,Be,L),ub(fe,ve,Be,We,L),Ve=We);const ct=O?Math.pow(2,-2*f):1/R0(Ve);for(let lt=0,mt=fe*ve;lt<mt;++lt)Ve[lt]*=ct;return{values:Ve,scale:1<<f,width:fe,height:ve,x1:Y,y1:ie,x2:Y+(i>>f),y2:ie+(s>>f)}}return v.x=function(w){return arguments.length?(e=HE(w),v):e},v.y=function(w){return arguments.length?(t=HE(w),v):t},v.weight=function(w){return arguments.length?(n=HE(w),v):n},v.size=function(w){if(!arguments.length)return[i,s];var O=+w[0],N=+w[1];return O>=0&&N>=0||Object(we.o)("invalid size"),i=O,s=N,v},v.cellSize=function(w){return arguments.length?((w=+w)>=1||Object(we.o)("invalid cell size"),f=Math.floor(Math.log(w)/Math.LN2),v):1<<f},v.bandwidth=function(w){return arguments.length?((w=Object(we.i)(w)).length===1&&(w=[+w[0],+w[0]]),w.length!==2&&Object(we.o)("invalid bandwidth"),r=w,v):r},v}function sb(e,t,n,r,i){const s=1+(i<<1);for(let f=0;f<t;++f)for(let v=0,w=0;v<e+i;++v)v<e&&(w+=n[v+f*e]),v>=i&&(v>=s&&(w-=n[v-s+f*e]),r[v-i+f*e]=w/Math.min(v+1,e-1+s-v,s))}function ub(e,t,n,r,i){const s=1+(i<<1);for(let f=0;f<e;++f)for(let v=0,w=0;v<t+i;++v)v<t&&(w+=n[f+v*e]),v>=i&&(v>=s&&(w-=n[f+(v-s)*e]),r[f+(v-i)*e]=w/Math.min(v+1,t-1+s-v,s))}function GE(e){Ft.call(this,null,e)}qE.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},Object(we.z)(qE,Ft,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=e.field||we.y,s=S4().smooth(e.smooth!==!1),f=e.thresholds||function(O,N,L){const Y=D4(L.levels||10,L.nice,L.zero!==!1);return L.resolve!=="shared"?Y:Y(O.map(ie=>ur(N(ie).values)))}(r,i,e),v=e.as===null?null:e.as||"contour",w=[];return r.forEach(O=>{const N=i(O),L=s.size([N.width,N.height])(N.values,Object(we.B)(f)?f:f(N.values));(function(Y,ie,fe,ve){let Be=ve.scale||ie.scale,We=ve.translate||ie.translate;if(Object(we.E)(Be)&&(Be=Be(fe,ve)),Object(we.E)(We)&&(We=We(fe,ve)),(Be===1||Be==null)&&!We)return;const Ve=(Object(we.G)(Be)?Be:Be[0])||1,ct=(Object(we.G)(Be)?Be:Be[1])||1,lt=We&&We[0]||0,mt=We&&We[1]||0;Y.forEach(T4(ie,Ve,ct,lt,mt))})(L,N,O,e),L.forEach(Y=>{w.push(Pr(O,jn(v!=null?{[v]:Y}:Y)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=w,n}}),GE.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const _6=["x","y","weight","size","cellSize","bandwidth"];function F4(e,t){return _6.forEach(n=>t[n]!=null?e[n](t[n]):0),e}function $E(e){Ft.call(this,null,e)}Object(we.z)(GE,Ft,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=function(w,O){var N,L,Y,ie,fe,ve,Be=[],We=Ve=>Ve(ie);if(O==null)Be.push(w);else for(N={},L=0,Y=w.length;L<Y;++L)ie=w[L],fe=O.map(We),(ve=N[fe])||(N[fe]=ve=[],ve.dims=fe,Be.push(ve)),ve.push(ie);return Be}(t.materialize(t.SOURCE).source,e.groupby),s=(e.groupby||[]).map(we.h),f=F4(I4(),e),v=e.as||"grid";return n=i.map(w=>jn(function(O,N){for(let L=0;L<s.length;++L)O[s[L]]=N[L];return O}({[v]:f(w,e.counts)},w.dims))),this.value&&(r.rem=this.value),this.value=r.source=r.add=n,r}}),$E.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},Object(we.z)($E,Ft,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),s=S4().smooth(e.smooth!==!1),f=e.values,v=e.thresholds||D4(e.count||10,e.nice,!!f),w=e.size;return f||(f=t.materialize(t.SOURCE).source,r=T4(n=F4(I4(),e)(f,!0),n.scale||1,n.scale||1,0,0),w=[n.width,n.height],f=n.values),v=Object(we.B)(v)?v:v(f),f=s.size(w)(f,v),r&&f.forEach(r),this.value&&(i.rem=this.value),this.value=i.source=i.add=(f||[]).map(jn),i}});const KE="Feature",XE="FeatureCollection";function YE(e){Ft.call(this,null,e)}function JE(e){Ft.call(this,null,e)}function QE(e){Ft.call(this,null,e)}function ZE(e){Ft.call(this,null,e)}function e3(e){Ft.call(this,[],e),this.generator=y6()}function t3(e){Ft.call(this,null,e)}function R4(e){if(!Object(we.E)(e))return!1;const t=Object(we.Fa)(Object(we.g)(e));return t.$x||t.$y||t.$value||t.$max}function M4(e){Ft.call(this,null,e),this.modified(!0)}function j4(e,t,n){Object(we.E)(e[t])&&e[t](n)}YE.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},Object(we.z)(YE,Ft,{transform(e,t){var n,r=this._features,i=this._points,s=e.fields,f=s&&s[0],v=s&&s[1],w=e.geojson||!s&&we.y,O=t.ADD;n=e.modified()||t.changed(t.REM)||t.modified(Object(we.g)(w))||f&&t.modified(Object(we.g)(f))||v&&t.modified(Object(we.g)(v)),this.value&&!n||(O=t.SOURCE,this._features=r=[],this._points=i=[]),w&&t.visit(O,N=>r.push(w(N))),f&&v&&(t.visit(O,N=>{var L=f(N),Y=v(N);L!=null&&Y!=null&&(L=+L)===L&&(Y=+Y)===Y&&i.push([L,Y])}),r=r.concat({type:KE,geometry:{type:"MultiPoint",coordinates:i}})),this.value={type:XE,features:r}}}),JE.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},Object(we.z)(JE,Ft,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||we.y,s=e.as||"path",f=n.SOURCE;!r||e.modified()?(this.value=r=C4(e.projection),n.materialize().reflow()):f=i===we.y||t.modified(i.fields)?n.ADD_MOD:n.ADD;const v=function(w,O){const N=w.pointRadius();return w.context(null),O!=null&&w.pointRadius(O),N}(r,e.pointRadius);return n.visit(f,w=>w[s]=r(i(w))),r.pointRadius(v),n.modifies(s)}}),QE.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},Object(we.z)(QE,Ft,{transform(e,t){var n,r=e.projection,i=e.fields[0],s=e.fields[1],f=e.as||["x","y"],v=f[0],w=f[1];function O(N){const L=r([i(N),s(N)]);L?(N[v]=L[0],N[w]=L[1]):(N[v]=void 0,N[w]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,O):(n=t.modified(i.fields)||t.modified(s.fields),t.visit(n?t.ADD_MOD:t.ADD,O)),t.modifies(f)}}),ZE.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},Object(we.z)(ZE,Ft,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.as||"shape",s=n.ADD;return r&&!e.modified()||(this.value=r=function(f,v,w){const O=w==null?N=>f(v(N)):N=>{var L=f.pointRadius(),Y=f.pointRadius(w)(v(N));return f.pointRadius(L),Y};return O.context=N=>(f.context(N),O),O}(C4(e.projection),e.field||Object(we.u)("datum"),e.pointRadius),n.materialize().reflow(),s=n.SOURCE),n.visit(s,f=>f[i]=r),n.modifies(i)}}),e3.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},Object(we.z)(e3,Ft,{transform(e,t){var n,r=this.value,i=this.generator;if(!r.length||e.modified())for(const s in e)Object(we.E)(i[s])&&i[s](e[s]);return n=i(),r.length?t.mod.push(Br(r[0],n)):t.add.push(jn(n)),r[0]=n,t}}),t3.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},Object(we.z)(t3,Ft,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,r=e.resolve==="shared",i=e.field||we.y,s=function(O,N){let L;return Object(we.E)(O)?(L=Y=>O(Y,N)).dep=R4(O):O?L=Object(we.m)(O):(L=Y=>Y.$value/Y.$max||0).dep=!0,L}(e.opacity,e),f=function(O,N){let L;return Object(we.E)(O)?(L=Y=>Jt(O(Y,N))).dep=R4(O):L=Object(we.m)(Jt(O||"#888")),L}(e.color,e),v=e.as||"image",w={$x:0,$y:0,$value:0,$max:r?ur(n.map(O=>ur(i(O).values))):0};return n.forEach(O=>{const N=i(O),L=Object(we.p)({},O,w);r||(L.$max=ur(N.values||[])),O[v]=function(Y,ie,fe,ve){const Be=Y.width,We=Y.height,Ve=Y.x1||0,ct=Y.y1||0,lt=Y.x2||Be,mt=Y.y2||We,dt=Y.values,kt=dt?Xn=>dt[Xn]:we.Ma,wt=Mu(lt-Ve,mt-ct),dn=wt.getContext("2d"),Dn=dn.getImageData(0,0,lt-Ve,mt-ct),wn=Dn.data;for(let Xn=ct,Kn=0;Xn<mt;++Xn){ie.$y=Xn-ct;for(let ir=Ve,sr=Xn*Be;ir<lt;++ir,Kn+=4){ie.$x=ir-Ve,ie.$value=kt(ir+sr);const gr=fe(ie);wn[Kn+0]=gr.r,wn[Kn+1]=gr.g,wn[Kn+2]=gr.b,wn[Kn+3]=~~(255*ve(ie))}}return dn.putImageData(Dn,0,0),wt}(N,L,f.dep?f:Object(we.m)(f(L)),s.dep?s:Object(we.m)(s(L)))}),t.reflow(!0).modifies(v)}}),Object(we.z)(M4,Ft,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=function(r){const i=VE((r||"mercator").toLowerCase());return i||Object(we.o)("Unrecognized projection type: "+r),i()}(e.type),WE.forEach(r=>{e[r]!=null&&j4(n,r,e[r])})):WE.forEach(r=>{e.modified(r)&&j4(n,r,e[r])}),e.pointRadius!=null&&n.path.pointRadius(e.pointRadius),e.fit&&function(r,i){const s=function(f){return(f=Object(we.i)(f)).length===1?f[0]:{type:XE,features:f.reduce((v,w)=>v.concat(function(O){return O.type===XE?O.features:Object(we.i)(O).filter(N=>N!=null).map(N=>N.type===KE?N:{type:KE,geometry:N})}(w)),[])}}(i.fit);i.extent?r.fitExtent(i.extent,s):i.size&&r.fitSize(i.size,s)}(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function B4(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,s,f,v,w,O,N,L,Y,ie=e._root,fe={data:r},ve=e._x0,Be=e._y0,We=e._x1,Ve=e._y1;if(!ie)return e._root=fe,e;for(;ie.length;)if((O=t>=(s=(ve+We)/2))?ve=s:We=s,(N=n>=(f=(Be+Ve)/2))?Be=f:Ve=f,i=ie,!(ie=ie[L=N<<1|O]))return i[L]=fe,e;if(v=+e._x.call(null,ie.data),w=+e._y.call(null,ie.data),t===v&&n===w)return fe.next=ie,i?i[L]=fe:e._root=fe,e;do i=i?i[L]=new Array(4):e._root=new Array(4),(O=t>=(s=(ve+We)/2))?ve=s:We=s,(N=n>=(f=(Be+Ve)/2))?Be=f:Ve=f;while((L=N<<1|O)==(Y=(w>=f)<<1|v>=s));return i[Y]=ie,i[L]=fe,e}var _m=function(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i};function E6(e){return e[0]}function C6(e){return e[1]}function n3(e,t,n){var r=new r3(t==null?E6:t,n==null?C6:n,NaN,NaN,NaN,NaN);return e==null?r:r.addAll(e)}function r3(e,t,n,r,i,s){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function P4(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var Em=n3.prototype=r3.prototype;Em.copy=function(){var e,t,n=new r3(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=P4(r),n;for(e=[{source:r,target:n._root=new Array(4)}];r=e.pop();)for(var i=0;i<4;++i)(t=r.source[i])&&(t.length?e.push({source:t,target:r.target[i]=new Array(4)}):r.target[i]=P4(t));return n},Em.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return B4(this.cover(t,n),t,n,e)},Em.addAll=function(e){var t,n,r,i,s=e.length,f=new Array(s),v=new Array(s),w=1/0,O=1/0,N=-1/0,L=-1/0;for(n=0;n<s;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(i=+this._y.call(null,t))||(f[n]=r,v[n]=i,r<w&&(w=r),r>N&&(N=r),i<O&&(O=i),i>L&&(L=i));if(w>N||O>L)return this;for(this.cover(w,O).cover(N,L),n=0;n<s;++n)B4(this,f[n],v[n],e[n]);return this},Em.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,s=(r=Math.floor(t))+1;else{for(var f,v,w=i-n||1,O=this._root;n>e||e>=i||r>t||t>=s;)switch(v=(t<r)<<1|e<n,(f=new Array(4))[v]=O,O=f,w*=2,v){case 0:i=n+w,s=r+w;break;case 1:n=i-w,s=r+w;break;case 2:i=n+w,r=s-w;break;case 3:n=i-w,r=s-w}this._root&&this._root.length&&(this._root=O)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this},Em.data=function(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e},Em.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Em.find=function(e,t,n){var r,i,s,f,v,w,O,N=this._x0,L=this._y0,Y=this._x1,ie=this._y1,fe=[],ve=this._root;for(ve&&fe.push(new _m(ve,N,L,Y,ie)),n==null?n=1/0:(N=e-n,L=t-n,Y=e+n,ie=t+n,n*=n);w=fe.pop();)if(!(!(ve=w.node)||(i=w.x0)>Y||(s=w.y0)>ie||(f=w.x1)<N||(v=w.y1)<L))if(ve.length){var Be=(i+f)/2,We=(s+v)/2;fe.push(new _m(ve[3],Be,We,f,v),new _m(ve[2],i,We,Be,v),new _m(ve[1],Be,s,f,We),new _m(ve[0],i,s,Be,We)),(O=(t>=We)<<1|e>=Be)&&(w=fe[fe.length-1],fe[fe.length-1]=fe[fe.length-1-O],fe[fe.length-1-O]=w)}else{var Ve=e-+this._x.call(null,ve.data),ct=t-+this._y.call(null,ve.data),lt=Ve*Ve+ct*ct;if(lt<n){var mt=Math.sqrt(n=lt);N=e-mt,L=t-mt,Y=e+mt,ie=t+mt,r=ve.data}}return r},Em.remove=function(e){if(isNaN(s=+this._x.call(null,e))||isNaN(f=+this._y.call(null,e)))return this;var t,n,r,i,s,f,v,w,O,N,L,Y,ie=this._root,fe=this._x0,ve=this._y0,Be=this._x1,We=this._y1;if(!ie)return this;if(ie.length)for(;;){if((O=s>=(v=(fe+Be)/2))?fe=v:Be=v,(N=f>=(w=(ve+We)/2))?ve=w:We=w,t=ie,!(ie=ie[L=N<<1|O]))return this;if(!ie.length)break;(t[L+1&3]||t[L+2&3]||t[L+3&3])&&(n=t,Y=L)}for(;ie.data!==e;)if(r=ie,!(ie=ie.next))return this;return(i=ie.next)&&delete ie.next,r?(i?r.next=i:delete r.next,this):t?(i?t[L]=i:delete t[L],(ie=t[0]||t[1]||t[2]||t[3])&&ie===(t[3]||t[2]||t[1]||t[0])&&!ie.length&&(n?n[Y]=ie:this._root=ie),this):(this._root=i,this)},Em.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},Em.root=function(){return this._root},Em.size=function(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e},Em.visit=function(e){var t,n,r,i,s,f,v=[],w=this._root;for(w&&v.push(new _m(w,this._x0,this._y0,this._x1,this._y1));t=v.pop();)if(!e(w=t.node,r=t.x0,i=t.y0,s=t.x1,f=t.y1)&&w.length){var O=(r+s)/2,N=(i+f)/2;(n=w[3])&&v.push(new _m(n,O,N,s,f)),(n=w[2])&&v.push(new _m(n,r,N,O,f)),(n=w[1])&&v.push(new _m(n,O,i,s,N)),(n=w[0])&&v.push(new _m(n,r,i,O,N))}return this},Em.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new _m(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var i=t.node;if(i.length){var s,f=t.x0,v=t.y0,w=t.x1,O=t.y1,N=(f+w)/2,L=(v+O)/2;(s=i[0])&&n.push(new _m(s,f,v,N,L)),(s=i[1])&&n.push(new _m(s,N,v,w,L)),(s=i[2])&&n.push(new _m(s,f,L,N,O)),(s=i[3])&&n.push(new _m(s,N,L,w,O))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},Em.x=function(e){return arguments.length?(this._x=e,this):this._x},Em.y=function(e){return arguments.length?(this._y=e,this):this._y};var Cm=function(e){return function(){return e}},I1=function(e){return 1e-6*(e()-.5)};function A6(e){return e.x+e.vx}function O6(e){return e.y+e.vy}var S6={value:()=>{}};function L4(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new Cw(r)}function Cw(e){this._=e}function D6(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function z4(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=S6,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}Cw.prototype=L4.prototype={constructor:Cw,on:function(e,t){var n,r=this._,i=function(v,w){return v.trim().split(/^|\s+/).map(function(O){var N="",L=O.indexOf(".");if(L>=0&&(N=O.slice(L+1),O=O.slice(0,L)),O&&!w.hasOwnProperty(O))throw new Error("unknown type: "+O);return{type:O,name:N}})}(e+"",r),s=-1,f=i.length;if(!(arguments.length<2)){if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<f;)if(n=(e=i[s]).type)r[n]=z4(r[n],e.name,t);else if(t==null)for(n in r)r[n]=z4(r[n],e.name,null);return this}for(;++s<f;)if((n=(e=i[s]).type)&&(n=D6(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Cw(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),s=0;s<n;++s)i[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=0,n=(r=this._[e]).length;s<n;++s)r[s].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,s=r.length;i<s;++i)r[i].value.apply(t,n)}};var Aw,fx,T6=L4,cb=0,hx=0,dx=0,U4=1e3,Ow=0,hy=0,Sw=0,px=typeof performance=="object"&&performance.now?performance:Date,W4=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function i3(){return hy||(W4(N6),hy=px.now()+Sw)}function N6(){hy=0}function Dw(){this._call=this._time=this._next=null}function V4(e,t,n){var r=new Dw;return r.restart(e,t,n),r}function q4(){hy=(Ow=px.now())+Sw,cb=hx=0;try{(function(){i3(),++cb;for(var e,t=Aw;t;)(e=hy-t._time)>=0&&t._call.call(null,e),t=t._next;--cb})()}finally{cb=0,function(){for(var e,t,n=Aw,r=1/0;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:Aw=t);fx=e,o3(r)}(),hy=0}}function I6(){var e=px.now(),t=e-Ow;t>U4&&(Sw-=t,Ow=e)}function o3(e){cb||(hx&&(hx=clearTimeout(hx)),e-hy>24?(e<1/0&&(hx=setTimeout(q4,e-px.now()-Sw)),dx&&(dx=clearInterval(dx))):(dx||(Ow=px.now(),dx=setInterval(I6,U4)),cb=1,W4(q4)))}Dw.prototype=V4.prototype={constructor:Dw,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?i3():+n)+(t==null?0:+t),this._next||fx===this||(fx?fx._next=this:Aw=this,fx=this),this._call=e,this._time=n,o3()},stop:function(){this._call&&(this._call=null,this._time=1/0,o3())}};function F6(e){return e.x}function R6(e){return e.y}var M6=10,j6=Math.PI*(3-Math.sqrt(5)),B6=function(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),s=0,f=.6,v=new Map,w=V4(L),O=T6("tick","end"),N=function(){let ve=1;return()=>(ve=(1664525*ve+1013904223)%4294967296)/4294967296}();function L(){Y(),O.call("tick",t),n<r&&(w.stop(),O.call("end",t))}function Y(ve){var Be,We,Ve=e.length;ve===void 0&&(ve=1);for(var ct=0;ct<ve;++ct)for(n+=(s-n)*i,v.forEach(function(lt){lt(n)}),Be=0;Be<Ve;++Be)(We=e[Be]).fx==null?We.x+=We.vx*=f:(We.x=We.fx,We.vx=0),We.fy==null?We.y+=We.vy*=f:(We.y=We.fy,We.vy=0);return t}function ie(){for(var ve,Be=0,We=e.length;Be<We;++Be){if((ve=e[Be]).index=Be,ve.fx!=null&&(ve.x=ve.fx),ve.fy!=null&&(ve.y=ve.fy),isNaN(ve.x)||isNaN(ve.y)){var Ve=M6*Math.sqrt(.5+Be),ct=Be*j6;ve.x=Ve*Math.cos(ct),ve.y=Ve*Math.sin(ct)}(isNaN(ve.vx)||isNaN(ve.vy))&&(ve.vx=ve.vy=0)}}function fe(ve){return ve.initialize&&ve.initialize(e,N),ve}return e==null&&(e=[]),ie(),t={tick:Y,restart:function(){return w.restart(L),t},stop:function(){return w.stop(),t},nodes:function(ve){return arguments.length?(e=ve,ie(),v.forEach(fe),t):e},alpha:function(ve){return arguments.length?(n=+ve,t):n},alphaMin:function(ve){return arguments.length?(r=+ve,t):r},alphaDecay:function(ve){return arguments.length?(i=+ve,t):+i},alphaTarget:function(ve){return arguments.length?(s=+ve,t):s},velocityDecay:function(ve){return arguments.length?(f=1-ve,t):1-f},randomSource:function(ve){return arguments.length?(N=ve,v.forEach(fe),t):N},force:function(ve,Be){return arguments.length>1?(Be==null?v.delete(ve):v.set(ve,fe(Be)),t):v.get(ve)},find:function(ve,Be,We){var Ve,ct,lt,mt,dt,kt=0,wt=e.length;for(We==null?We=1/0:We*=We,kt=0;kt<wt;++kt)(lt=(Ve=ve-(mt=e[kt]).x)*Ve+(ct=Be-mt.y)*ct)<We&&(dt=mt,We=lt);return dt},on:function(ve,Be){return arguments.length>1?(O.on(ve,Be),t):O.on(ve)}}};function P6(e){return e.index}function H4(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}const G4={center:function(e,t){var n,r=1;function i(){var s,f,v=n.length,w=0,O=0;for(s=0;s<v;++s)w+=(f=n[s]).x,O+=f.y;for(w=(w/v-e)*r,O=(O/v-t)*r,s=0;s<v;++s)(f=n[s]).x-=w,f.y-=O}return e==null&&(e=0),t==null&&(t=0),i.initialize=function(s){n=s},i.x=function(s){return arguments.length?(e=+s,i):e},i.y=function(s){return arguments.length?(t=+s,i):t},i.strength=function(s){return arguments.length?(r=+s,i):r},i},collide:function(e){var t,n,r,i=1,s=1;function f(){for(var O,N,L,Y,ie,fe,ve,Be=t.length,We=0;We<s;++We)for(N=n3(t,A6,O6).visitAfter(v),O=0;O<Be;++O)L=t[O],fe=n[L.index],ve=fe*fe,Y=L.x+L.vx,ie=L.y+L.vy,N.visit(Ve);function Ve(ct,lt,mt,dt,kt){var wt=ct.data,dn=ct.r,Dn=fe+dn;if(!wt)return lt>Y+Dn||dt<Y-Dn||mt>ie+Dn||kt<ie-Dn;if(wt.index>L.index){var wn=Y-wt.x-wt.vx,Xn=ie-wt.y-wt.vy,Kn=wn*wn+Xn*Xn;Kn<Dn*Dn&&(wn===0&&(Kn+=(wn=I1(r))*wn),Xn===0&&(Kn+=(Xn=I1(r))*Xn),Kn=(Dn-(Kn=Math.sqrt(Kn)))/Kn*i,L.vx+=(wn*=Kn)*(Dn=(dn*=dn)/(ve+dn)),L.vy+=(Xn*=Kn)*Dn,wt.vx-=wn*(Dn=1-Dn),wt.vy-=Xn*Dn)}}}function v(O){if(O.data)return O.r=n[O.data.index];for(var N=O.r=0;N<4;++N)O[N]&&O[N].r>O.r&&(O.r=O[N].r)}function w(){if(t){var O,N,L=t.length;for(n=new Array(L),O=0;O<L;++O)N=t[O],n[N.index]=+e(N,O,t)}}return typeof e!="function"&&(e=Cm(e==null?1:+e)),f.initialize=function(O,N){t=O,r=N,w()},f.iterations=function(O){return arguments.length?(s=+O,f):s},f.strength=function(O){return arguments.length?(i=+O,f):i},f.radius=function(O){return arguments.length?(e=typeof O=="function"?O:Cm(+O),w(),f):e},f},nbody:function(){var e,t,n,r,i,s=Cm(-30),f=1,v=1/0,w=.81;function O(ie){var fe,ve=e.length,Be=n3(e,F6,R6).visitAfter(L);for(r=ie,fe=0;fe<ve;++fe)t=e[fe],Be.visit(Y)}function N(){if(e){var ie,fe,ve=e.length;for(i=new Array(ve),ie=0;ie<ve;++ie)fe=e[ie],i[fe.index]=+s(fe,ie,e)}}function L(ie){var fe,ve,Be,We,Ve,ct=0,lt=0;if(ie.length){for(Be=We=Ve=0;Ve<4;++Ve)(fe=ie[Ve])&&(ve=Math.abs(fe.value))&&(ct+=fe.value,lt+=ve,Be+=ve*fe.x,We+=ve*fe.y);ie.x=Be/lt,ie.y=We/lt}else{(fe=ie).x=fe.data.x,fe.y=fe.data.y;do ct+=i[fe.data.index];while(fe=fe.next)}ie.value=ct}function Y(ie,fe,ve,Be){if(!ie.value)return!0;var We=ie.x-t.x,Ve=ie.y-t.y,ct=Be-fe,lt=We*We+Ve*Ve;if(ct*ct/w<lt)return lt<v&&(We===0&&(lt+=(We=I1(n))*We),Ve===0&&(lt+=(Ve=I1(n))*Ve),lt<f&&(lt=Math.sqrt(f*lt)),t.vx+=We*ie.value*r/lt,t.vy+=Ve*ie.value*r/lt),!0;if(!(ie.length||lt>=v)){(ie.data!==t||ie.next)&&(We===0&&(lt+=(We=I1(n))*We),Ve===0&&(lt+=(Ve=I1(n))*Ve),lt<f&&(lt=Math.sqrt(f*lt)));do ie.data!==t&&(ct=i[ie.data.index]*r/lt,t.vx+=We*ct,t.vy+=Ve*ct);while(ie=ie.next)}}return O.initialize=function(ie,fe){e=ie,n=fe,N()},O.strength=function(ie){return arguments.length?(s=typeof ie=="function"?ie:Cm(+ie),N(),O):s},O.distanceMin=function(ie){return arguments.length?(f=ie*ie,O):Math.sqrt(f)},O.distanceMax=function(ie){return arguments.length?(v=ie*ie,O):Math.sqrt(v)},O.theta=function(ie){return arguments.length?(w=ie*ie,O):Math.sqrt(w)},O},link:function(e){var t,n,r,i,s,f,v=P6,w=function(ve){return 1/Math.min(i[ve.source.index],i[ve.target.index])},O=Cm(30),N=1;function L(ve){for(var Be=0,We=e.length;Be<N;++Be)for(var Ve,ct,lt,mt,dt,kt,wt,dn=0;dn<We;++dn)ct=(Ve=e[dn]).source,mt=(lt=Ve.target).x+lt.vx-ct.x-ct.vx||I1(f),dt=lt.y+lt.vy-ct.y-ct.vy||I1(f),mt*=kt=((kt=Math.sqrt(mt*mt+dt*dt))-n[dn])/kt*ve*t[dn],dt*=kt,lt.vx-=mt*(wt=s[dn]),lt.vy-=dt*wt,ct.vx+=mt*(wt=1-wt),ct.vy+=dt*wt}function Y(){if(r){var ve,Be,We=r.length,Ve=e.length,ct=new Map(r.map((lt,mt)=>[v(lt,mt,r),lt]));for(ve=0,i=new Array(We);ve<Ve;++ve)(Be=e[ve]).index=ve,typeof Be.source!="object"&&(Be.source=H4(ct,Be.source)),typeof Be.target!="object"&&(Be.target=H4(ct,Be.target)),i[Be.source.index]=(i[Be.source.index]||0)+1,i[Be.target.index]=(i[Be.target.index]||0)+1;for(ve=0,s=new Array(Ve);ve<Ve;++ve)Be=e[ve],s[ve]=i[Be.source.index]/(i[Be.source.index]+i[Be.target.index]);t=new Array(Ve),ie(),n=new Array(Ve),fe()}}function ie(){if(r)for(var ve=0,Be=e.length;ve<Be;++ve)t[ve]=+w(e[ve],ve,e)}function fe(){if(r)for(var ve=0,Be=e.length;ve<Be;++ve)n[ve]=+O(e[ve],ve,e)}return e==null&&(e=[]),L.initialize=function(ve,Be){r=ve,f=Be,Y()},L.links=function(ve){return arguments.length?(e=ve,Y(),L):e},L.id=function(ve){return arguments.length?(v=ve,L):v},L.iterations=function(ve){return arguments.length?(N=+ve,L):N},L.strength=function(ve){return arguments.length?(w=typeof ve=="function"?ve:Cm(+ve),ie(),L):w},L.distance=function(ve){return arguments.length?(O=typeof ve=="function"?ve:Cm(+ve),fe(),L):O},L},x:function(e){var t,n,r,i=Cm(.1);function s(v){for(var w,O=0,N=t.length;O<N;++O)(w=t[O]).vx+=(r[O]-w.x)*n[O]*v}function f(){if(t){var v,w=t.length;for(n=new Array(w),r=new Array(w),v=0;v<w;++v)n[v]=isNaN(r[v]=+e(t[v],v,t))?0:+i(t[v],v,t)}}return typeof e!="function"&&(e=Cm(e==null?0:+e)),s.initialize=function(v){t=v,f()},s.strength=function(v){return arguments.length?(i=typeof v=="function"?v:Cm(+v),f(),s):i},s.x=function(v){return arguments.length?(e=typeof v=="function"?v:Cm(+v),f(),s):e},s},y:function(e){var t,n,r,i=Cm(.1);function s(v){for(var w,O=0,N=t.length;O<N;++O)(w=t[O]).vy+=(r[O]-w.y)*n[O]*v}function f(){if(t){var v,w=t.length;for(n=new Array(w),r=new Array(w),v=0;v<w;++v)n[v]=isNaN(r[v]=+e(t[v],v,t))?0:+i(t[v],v,t)}}return typeof e!="function"&&(e=Cm(e==null?0:+e)),s.initialize=function(v){t=v,f()},s.strength=function(v){return arguments.length?(i=typeof v=="function"?v:Cm(+v),f(),s):i},s.y=function(v){return arguments.length?(e=typeof v=="function"?v:Cm(+v),f(),s):e},s}},mx="forces",a3=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],L6=["static","iterations"],$4=["x","y","vx","vy"];function s3(e){Ft.call(this,null,e)}function K4(e,t,n,r){var i,s,f,v,w=Object(we.i)(t.forces);for(i=0,s=a3.length;i<s;++i)(f=a3[i])!==mx&&t.modified(f)&&e[f](t[f]);for(i=0,s=w.length;i<s;++i)v=mx+i,(f=n||t.modified(mx,i)?U6(w[i]):r&&z6(w[i],r)?e.force(v):null)&&e.force(v,f);for(s=e.numForces||0;i<s;++i)e.force(mx+i,null);return e.numForces=w.length,e}function z6(e,t){var n,r;for(n in e)if(Object(we.E)(r=e[n])&&t.modified(Object(we.g)(r)))return 1;return 0}function U6(e){var t,n;for(n in Object(we.w)(G4,e.force)||Object(we.o)("Unrecognized force: "+e.force),t=G4[e.force](),e)Object(we.E)(t[n])&&W6(t[n],e[n],e);return t}function W6(e,t,n){e(Object(we.E)(t)?r=>t(r,n):t)}function V6(e){var t=0,n=e.children,r=n&&n.length;if(r)for(;--r>=0;)t+=n[r].value;else t=1;e.value=t}s3.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:$4}]},Object(we.z)(s3,Ft,{transform(e,t){var n=this.value,r=t.changed(t.ADD_REM),i=e.modified(a3),s=e.iterations||300;if(n?(r&&(t.modifies("index"),n.nodes(t.source)),(i||t.changed(t.MOD))&&K4(n,e,0,t)):(this.value=n=function(f,v){const w=B6(f),O=w.stop,N=w.restart;let L=!1;return w.stopped=()=>L,w.restart=()=>(L=!1,N()),w.stop=()=>(L=!0,O()),K4(w,v,!0).on("end",()=>L=!0)}(t.source,e),n.on("tick",function(f,v){return()=>f.touch(v).run()}(t.dataflow,this)),e.static||(r=!0,n.tick()),t.modifies("index")),i||r||e.modified(L6)||t.changed()&&e.restart){if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/s)),e.static)for(n.stop();--s>=0;)n.tick();else if(n.stopped()&&n.restart(),!r)return t.StopPropagation}return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let v,w=this._argops,O=0,N=w.length;O<N;++O)if((v=w[O]).name===mx&&v.op._argval.force==="link"){for(var r,i=v.op._argops,s=0,f=i.length;s<f;++s)if(i[s].name==="links"&&(r=i[s].op.source)){n.pulse(r,n.changeset().reflow());break}}return t.reflow(e.modified()).modifies($4)}});function u3(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=H6)):t===void 0&&(t=q6);for(var n,r,i,s,f,v=new lb(e),w=[v];n=w.pop();)if((i=t(n.data))&&(f=(i=Array.from(i)).length))for(n.children=i,s=f-1;s>=0;--s)w.push(r=i[s]=new lb(i[s])),r.parent=n,r.depth=n.depth+1;return v.eachBefore(X4)}function q6(e){return e.children}function H6(e){return Array.isArray(e)?e[1]:null}function G6(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function X4(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function lb(e){this.data=e,this.depth=this.height=0,this.parent=null}lb.prototype=u3.prototype={constructor:lb,count:function(){return this.eachAfter(V6)},each:function(e,t){let n=-1;for(const r of this)e.call(t,r,++n,this);return this},eachAfter:function(e,t){for(var n,r,i,s=this,f=[s],v=[],w=-1;s=f.pop();)if(v.push(s),n=s.children)for(r=0,i=n.length;r<i;++r)f.push(n[r]);for(;s=v.pop();)e.call(t,s,++w,this);return this},eachBefore:function(e,t){for(var n,r,i=this,s=[i],f=-1;i=s.pop();)if(e.call(t,i,++f,this),n=i.children)for(r=n.length-1;r>=0;--r)s.push(n[r]);return this},find:function(e,t){let n=-1;for(const r of this)if(e.call(t,r,++n,this))return r},sum:function(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,r=t.children,i=r&&r.length;--i>=0;)n+=r[i].value;t.value=n})},sort:function(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})},path:function(e){for(var t=this,n=function(s,f){if(s===f)return s;var v=s.ancestors(),w=f.ancestors(),O=null;for(s=v.pop(),f=w.pop();s===f;)O=s,s=v.pop(),f=w.pop();return O}(t,e),r=[t];t!==n;)t=t.parent,r.push(t);for(var i=r.length;e!==n;)r.splice(i,0,e),e=e.parent;return r},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e},links:function(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t},copy:function(){return u3(this).eachBefore(G6)},[Symbol.iterator]:function*(){var e,t,n,r,i=this,s=[i];do for(e=s.reverse(),s=[];i=e.pop();)if(yield i,t=i.children)for(n=0,r=t.length;n<r;++n)s.push(t[n]);while(s.length)}};var $6=function(e){return typeof e=="object"&&"length"in e?e:Array.from(e)},K6=function(e){for(var t,n,r=0,i=(e=function(f){for(var v,w,O=f.length;O;)w=Math.random()*O--|0,v=f[O],f[O]=f[w],f[w]=v;return f}(Array.from(e))).length,s=[];r<i;)t=e[r],n&&Y4(n,t)?++r:(n=Y6(s=X6(s,t)),r=0);return n};function X6(e,t){var n,r;if(c3(t,e))return[t];for(n=0;n<e.length;++n)if(Tw(t,e[n])&&c3(gx(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(r=n+1;r<e.length;++r)if(Tw(gx(e[n],e[r]),t)&&Tw(gx(e[n],t),e[r])&&Tw(gx(e[r],t),e[n])&&c3(J4(e[n],e[r],t),e))return[e[n],e[r],t];throw new Error}function Tw(e,t){var n=e.r-t.r,r=t.x-e.x,i=t.y-e.y;return n<0||n*n<r*r+i*i}function Y4(e,t){var n=e.r-t.r+1e-9*Math.max(e.r,t.r,1),r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function c3(e,t){for(var n=0;n<t.length;++n)if(!Y4(e,t[n]))return!1;return!0}function Y6(e){switch(e.length){case 1:return function(t){return{x:t.x,y:t.y,r:t.r}}(e[0]);case 2:return gx(e[0],e[1]);case 3:return J4(e[0],e[1],e[2])}}function gx(e,t){var n=e.x,r=e.y,i=e.r,s=t.x,f=t.y,v=t.r,w=s-n,O=f-r,N=v-i,L=Math.sqrt(w*w+O*O);return{x:(n+s+w/L*N)/2,y:(r+f+O/L*N)/2,r:(L+i+v)/2}}function J4(e,t,n){var r=e.x,i=e.y,s=e.r,f=t.x,v=t.y,w=t.r,O=n.x,N=n.y,L=n.r,Y=r-f,ie=r-O,fe=i-v,ve=i-N,Be=w-s,We=L-s,Ve=r*r+i*i-s*s,ct=Ve-f*f-v*v+w*w,lt=Ve-O*O-N*N+L*L,mt=ie*fe-Y*ve,dt=(fe*lt-ve*ct)/(2*mt)-r,kt=(ve*Be-fe*We)/mt,wt=(ie*ct-Y*lt)/(2*mt)-i,dn=(Y*We-ie*Be)/mt,Dn=kt*kt+dn*dn-1,wn=2*(s+dt*kt+wt*dn),Xn=dt*dt+wt*wt-s*s,Kn=-(Dn?(wn+Math.sqrt(wn*wn-4*Dn*Xn))/(2*Dn):Xn/wn);return{x:r+dt+kt*Kn,y:i+wt+dn*Kn,r:Kn}}function Q4(e,t,n){var r,i,s,f,v=e.x-t.x,w=e.y-t.y,O=v*v+w*w;O?(i=t.r+n.r,i*=i,f=e.r+n.r,i>(f*=f)?(r=(O+f-i)/(2*O),s=Math.sqrt(Math.max(0,f/O-r*r)),n.x=e.x-r*v-s*w,n.y=e.y-r*w+s*v):(r=(O+i-f)/(2*O),s=Math.sqrt(Math.max(0,i/O-r*r)),n.x=t.x+r*v-s*w,n.y=t.y+r*w+s*v)):(n.x=t.x+n.r,n.y=t.y)}function Z4(e,t){var n=e.r+t.r-1e-6,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function eD(e){var t=e._,n=e.next._,r=t.r+n.r,i=(t.x*n.r+n.x*t.r)/r,s=(t.y*n.r+n.y*t.r)/r;return i*i+s*s}function Nw(e){this._=e,this.next=null,this.previous=null}function J6(e){if(!(i=(e=$6(e)).length))return 0;var t,n,r,i,s,f,v,w,O,N,L;if((t=e[0]).x=0,t.y=0,!(i>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(i>2))return t.r+n.r;Q4(n,t,r=e[2]),t=new Nw(t),n=new Nw(n),r=new Nw(r),t.next=r.previous=n,n.next=t.previous=r,r.next=n.previous=t;e:for(v=3;v<i;++v){Q4(t._,n._,r=e[v]),r=new Nw(r),w=n.next,O=t.previous,N=n._.r,L=t._.r;do if(N<=L){if(Z4(w._,r._)){n=w,t.next=n,n.previous=t,--v;continue e}N+=w._.r,w=w.next}else{if(Z4(O._,r._)){(t=O).next=n,n.previous=t,--v;continue e}L+=O._.r,O=O.previous}while(w!==O.next);for(r.previous=t,r.next=n,t.next=n.previous=n=r,s=eD(t);(r=r.next)!==n;)(f=eD(r))<s&&(t=r,s=f);n=t.next}for(t=[n._],r=n;(r=r.next)!==n;)t.push(r._);for(r=K6(t),v=0;v<i;++v)(t=e[v]).x-=r.x,t.y-=r.y;return r.r}function Iw(e){if(typeof e!="function")throw new Error;return e}function dy(){return 0}var fb=function(e){return function(){return e}};function Q6(e){return Math.sqrt(e.value)}function tD(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function l3(e,t){return function(n){if(r=n.children){var r,i,s,f=r.length,v=e(n)*t||0;if(v)for(i=0;i<f;++i)r[i].r+=v;if(s=J6(r),v)for(i=0;i<f;++i)r[i].r-=v;n.r=s+v}}}function nD(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}var rD=function(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)},vx=function(e,t,n,r,i){for(var s,f=e.children,v=-1,w=f.length,O=e.value&&(r-t)/e.value;++v<w;)(s=f[v]).y0=n,s.y1=i,s.x0=t,s.x1=t+=s.value*O},Z6={depth:-1},iD={};function ej(e){return e.id}function tj(e){return e.parentId}var oD=function(){var e=ej,t=tj;function n(r){var i,s,f,v,w,O,N,L=Array.from(r),Y=L.length,ie=new Map;for(s=0;s<Y;++s)i=L[s],w=L[s]=new lb(i),(O=e(i,s,r))!=null&&(O+="")&&(N=w.id=O,ie.set(N,ie.has(N)?iD:w)),(O=t(i,s,r))!=null&&(O+="")&&(w.parent=O);for(s=0;s<Y;++s)if(O=(w=L[s]).parent){if(!(v=ie.get(O)))throw new Error("missing: "+O);if(v===iD)throw new Error("ambiguous: "+O);v.children?v.children.push(w):v.children=[w],w.parent=v}else{if(f)throw new Error("multiple roots");f=w}if(!f)throw new Error("no root");if(f.parent=Z6,f.eachBefore(function(fe){fe.depth=fe.parent.depth+1,--Y}).eachBefore(X4),f.parent=null,Y>0)throw new Error("cycle");return f}return n.id=function(r){return arguments.length?(e=Iw(r),n):e},n.parentId=function(r){return arguments.length?(t=Iw(r),n):t},n};function nj(e,t){return e.parent===t.parent?1:2}function f3(e){var t=e.children;return t?t[0]:e.t}function h3(e){var t=e.children;return t?t[t.length-1]:e.t}function rj(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n}function ij(e,t,n){return e.a.parent===t.parent?e.a:n}function Fw(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}Fw.prototype=Object.create(lb.prototype);function oj(e,t){return e.parent===t.parent?1:2}function aj(e,t){return e+t.x}function sj(e,t){return Math.max(e,t.y)}var Rw=function(e,t,n,r,i){for(var s,f=e.children,v=-1,w=f.length,O=e.value&&(i-n)/e.value;++v<w;)(s=f[v]).x0=t,s.x1=r,s.y0=n,s.y1=n+=s.value*O},aD=(1+Math.sqrt(5))/2;function sD(e,t,n,r,i,s){for(var f,v,w,O,N,L,Y,ie,fe,ve,Be,We=[],Ve=t.children,ct=0,lt=0,mt=Ve.length,dt=t.value;ct<mt;){w=i-n,O=s-r;do N=Ve[lt++].value;while(!N&&lt<mt);for(L=Y=N,Be=N*N*(ve=Math.max(O/w,w/O)/(dt*e)),fe=Math.max(Y/Be,Be/L);lt<mt;++lt){if(N+=v=Ve[lt].value,v<L&&(L=v),v>Y&&(Y=v),Be=N*N*ve,(ie=Math.max(Y/Be,Be/L))>fe){N-=v;break}fe=ie}We.push(f={value:N,dice:w<O,children:Ve.slice(ct,lt)}),f.dice?vx(f,n,r,i,dt?r+=O*N/dt:s):Rw(f,n,r,dt?n+=w*N/dt:i,s),dt-=N,ct=lt}return We}var uD=function e(t){function n(r,i,s,f,v){sD(t,r,i,s,f,v)}return n.ratio=function(r){return e((r=+r)>1?r:1)},n}(aD),uj=function e(t){function n(r,i,s,f,v){if((w=r._squarify)&&w.ratio===t)for(var w,O,N,L,Y,ie=-1,fe=w.length,ve=r.value;++ie<fe;){for(N=(O=w[ie]).children,L=O.value=0,Y=N.length;L<Y;++L)O.value+=N[L].value;O.dice?vx(O,i,s,f,ve?s+=(v-s)*O.value/ve:v):Rw(O,i,s,ve?i+=(f-i)*O.value/ve:f,v),ve-=O.value}else r._squarify=w=sD(t,r,i,s,f,v),w.ratio=t}return n.ratio=function(r){return e((r=+r)>1?r:1)},n}(aD);function d3(e,t,n){const r={};return e.each(i=>{const s=i.data;n(s)&&(r[t(s)]=i)}),e.lookup=r,e}function p3(e){Ft.call(this,null,e)}p3.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const cj=e=>e.values;function Qv(e){Ft.call(this,null,e)}Object(we.z)(p3,Ft,{transform(e,t){t.source||Object(we.o)("Nest transform requires an upstream data source.");var n=e.generate,r=e.modified(),i=t.clone(),s=this.value;return(!s||r||t.changed())&&(s&&s.each(f=>{f.children&&nn(f.data)&&i.rem.push(f.data)}),this.value=s=u3({values:Object(we.i)(e.keys).reduce((f,v)=>(f.key(v),f),function(){const f=[],v={entries:w=>function O(N,L){if(++L>f.length)return N;const Y=[];for(const ie in N)Y.push({key:ie,values:O(N[ie],L)});return Y}(function O(N,L){if(L>=f.length)return N;const Y=N.length,ie=f[L++],fe={},ve={};let Be,We,Ve,ct=-1;for(;++ct<Y;)Be=ie(We=N[ct])+"",(Ve=fe[Be])?Ve.push(We):fe[Be]=[We];for(Be in fe)ve[Be]=O(fe[Be],L);return ve}(w,0),0),key:w=>(f.push(w),v)};return v}()).entries(i.source)},cj),n&&s.each(f=>{f.children&&(f=jn(f.data),i.add.push(f),i.source.push(f))}),d3(s,an,an)),i.source.root=s,i}});const lj=(e,t)=>e.parent===t.parent?1:2;Object(we.z)(Qv,Ft,{transform(e,t){t.source&&t.source.root||Object(we.o)(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),r=this.fields,i=t.source.root,s=e.as||r;e.field?i.sum(e.field):i.count(),e.sort&&i.sort(wi(e.sort,f=>f.data)),function(f,v,w){for(let O,N=0,L=v.length;N<L;++N)(O=v[N])in w&&f[O](w[O])}(n,this.params,e),n.separation&&n.separation(e.separation!==!1?lj:we.Q);try{this.value=n(i)}catch(f){Object(we.o)(f)}return i.each(f=>function(v,w,O){const N=v.data,L=w.length-1;for(let Y=0;Y<L;++Y)N[O[Y]]=v[w[Y]];N[O[L]]=v.children?v.children.length:0}(f,r,s)),t.reflow(e.modified()).modifies(s).modifies("leaf")}});const m3=["x","y","r","depth","children"];function g3(e){Qv.call(this,e)}g3.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:m3.length,default:m3}]},Object(we.z)(g3,Qv,{layout:function(){var e=null,t=1,n=1,r=dy;function i(s){return s.x=t/2,s.y=n/2,e?s.eachBefore(tD(e)).eachAfter(l3(r,.5)).eachBefore(nD(1)):s.eachBefore(tD(Q6)).eachAfter(l3(dy,1)).eachAfter(l3(r,s.r/Math.min(t,n))).eachBefore(nD(Math.min(t,n)/(2*s.r))),s}return i.radius=function(s){return arguments.length?(e=function(f){return f==null?null:Iw(f)}(s),i):e},i.size=function(s){return arguments.length?(t=+s[0],n=+s[1],i):[t,n]},i.padding=function(s){return arguments.length?(r=typeof s=="function"?s:fb(+s),i):r},i},params:["radius","size","padding"],fields:m3});const v3=["x0","y0","x1","y1","depth","children"];function y3(e){Qv.call(this,e)}function b3(e){Ft.call(this,null,e)}y3.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:v3.length,default:v3}]},Object(we.z)(y3,Qv,{layout:function(){var e=1,t=1,n=0,r=!1;function i(s){var f=s.height+1;return s.x0=s.y0=n,s.x1=e,s.y1=t/f,s.eachBefore(function(v,w){return function(O){O.children&&vx(O,O.x0,v*(O.depth+1)/w,O.x1,v*(O.depth+2)/w);var N=O.x0,L=O.y0,Y=O.x1-n,ie=O.y1-n;Y<N&&(N=Y=(N+Y)/2),ie<L&&(L=ie=(L+ie)/2),O.x0=N,O.y0=L,O.x1=Y,O.y1=ie}}(t,f)),r&&s.eachBefore(rD),s}return i.round=function(s){return arguments.length?(r=!!s,i):r},i.size=function(s){return arguments.length?(e=+s[0],t=+s[1],i):[e,t]},i.padding=function(s){return arguments.length?(n=+s,i):n},i},params:["size","round","padding"],fields:v3}),b3.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},Object(we.z)(b3,Ft,{transform(e,t){t.source||Object(we.o)("Stratify transform requires an upstream data source.");let n=this.value;const r=e.modified(),i=t.fork(t.ALL).materialize(t.SOURCE),s=!n||r||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return i.source=i.source.slice(),s&&(n=i.source.length?d3(oD().id(e.key).parentId(e.parentKey)(i.source),e.key,we.Ia):d3(oD()([{}]),e.key,e.key)),i.source.root=this.value=n,i}});const cD={tidy:function(){var e=nj,t=1,n=1,r=null;function i(w){var O=function(We){for(var Ve,ct,lt,mt,dt,kt=new Fw(We,0),wt=[kt];Ve=wt.pop();)if(lt=Ve._.children)for(Ve.children=new Array(dt=lt.length),mt=dt-1;mt>=0;--mt)wt.push(ct=Ve.children[mt]=new Fw(lt[mt],mt)),ct.parent=Ve;return(kt.parent=new Fw(null,0)).children=[kt],kt}(w);if(O.eachAfter(s),O.parent.m=-O.z,O.eachBefore(f),r)w.eachBefore(v);else{var N=w,L=w,Y=w;w.eachBefore(function(We){We.x<N.x&&(N=We),We.x>L.x&&(L=We),We.depth>Y.depth&&(Y=We)});var ie=N===L?1:e(N,L)/2,fe=ie-N.x,ve=t/(L.x+ie+fe),Be=n/(Y.depth||1);w.eachBefore(function(We){We.x=(We.x+fe)*ve,We.y=We.depth*Be})}return w}function s(w){var O=w.children,N=w.parent.children,L=w.i?N[w.i-1]:null;if(O){(function(ie){for(var fe,ve=0,Be=0,We=ie.children,Ve=We.length;--Ve>=0;)(fe=We[Ve]).z+=ve,fe.m+=ve,ve+=fe.s+(Be+=fe.c)})(w);var Y=(O[0].z+O[O.length-1].z)/2;L?(w.z=L.z+e(w._,L._),w.m=w.z-Y):w.z=Y}else L&&(w.z=L.z+e(w._,L._));w.parent.A=function(ie,fe,ve){if(fe){for(var Be,We=ie,Ve=ie,ct=fe,lt=We.parent.children[0],mt=We.m,dt=Ve.m,kt=ct.m,wt=lt.m;ct=h3(ct),We=f3(We),ct&&We;)lt=f3(lt),(Ve=h3(Ve)).a=ie,(Be=ct.z+kt-We.z-mt+e(ct._,We._))>0&&(rj(ij(ct,ie,ve),ie,Be),mt+=Be,dt+=Be),kt+=ct.m,mt+=We.m,wt+=lt.m,dt+=Ve.m;ct&&!h3(Ve)&&(Ve.t=ct,Ve.m+=kt-dt),We&&!f3(lt)&&(lt.t=We,lt.m+=mt-wt,ve=ie)}return ve}(w,L,w.parent.A||N[0])}function f(w){w._.x=w.z+w.parent.m,w.m+=w.parent.m}function v(w){w.x*=t,w.y=w.depth*n}return i.separation=function(w){return arguments.length?(e=w,i):e},i.size=function(w){return arguments.length?(r=!1,t=+w[0],n=+w[1],i):r?null:[t,n]},i.nodeSize=function(w){return arguments.length?(r=!0,t=+w[0],n=+w[1],i):r?[t,n]:null},i},cluster:function(){var e=oj,t=1,n=1,r=!1;function i(s){var f,v=0;s.eachAfter(function(Y){var ie=Y.children;ie?(Y.x=function(fe){return fe.reduce(aj,0)/fe.length}(ie),Y.y=function(fe){return 1+fe.reduce(sj,0)}(ie)):(Y.x=f?v+=e(Y,f):0,Y.y=0,f=Y)});var w=function(Y){for(var ie;ie=Y.children;)Y=ie[0];return Y}(s),O=function(Y){for(var ie;ie=Y.children;)Y=ie[ie.length-1];return Y}(s),N=w.x-e(w,O)/2,L=O.x+e(O,w)/2;return s.eachAfter(r?function(Y){Y.x=(Y.x-s.x)*t,Y.y=(s.y-Y.y)*n}:function(Y){Y.x=(Y.x-N)/(L-N)*t,Y.y=(1-(s.y?Y.y/s.y:1))*n})}return i.separation=function(s){return arguments.length?(e=s,i):e},i.size=function(s){return arguments.length?(r=!1,t=+s[0],n=+s[1],i):r?null:[t,n]},i.nodeSize=function(s){return arguments.length?(r=!0,t=+s[0],n=+s[1],i):r?[t,n]:null},i}},x3=["x","y","depth","children"];function w3(e){Qv.call(this,e)}function k3(e){Ft.call(this,[],e)}w3.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:x3.length,default:x3}]},Object(we.z)(w3,Qv,{layout(e){const t=e||"tidy";if(Object(we.w)(cD,t))return cD[t]();Object(we.o)("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:x3}),k3.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},Object(we.z)(k3,Ft,{transform(e,t){const n=this.value,r=t.source&&t.source.root,i=t.fork(t.NO_SOURCE),s={};return r||Object(we.o)("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(i.rem=n,t.visit(t.SOURCE,f=>s[an(f)]=1),r.each(f=>{const v=f.data,w=f.parent&&f.parent.data;w&&s[an(v)]&&s[an(w)]&&i.add.push(jn({source:w,target:v}))}),this.value=i.add):t.changed(t.MOD)&&(t.visit(t.MOD,f=>s[an(f)]=1),n.forEach(f=>{(s[an(f.source)]||s[an(f.target)])&&i.mod.push(f)})),i}});const lD={binary:function(e,t,n,r,i){var s,f,v=e.children,w=v.length,O=new Array(w+1);for(O[0]=f=s=0;s<w;++s)O[s+1]=f+=v[s].value;(function N(L,Y,ie,fe,ve,Be,We){if(L>=Y-1){var Ve=v[L];return Ve.x0=fe,Ve.y0=ve,Ve.x1=Be,void(Ve.y1=We)}for(var ct=O[L],lt=ie/2+ct,mt=L+1,dt=Y-1;mt<dt;){var kt=mt+dt>>>1;O[kt]<lt?mt=kt+1:dt=kt}lt-O[mt-1]<O[mt]-lt&&L+1<mt&&--mt;var wt=O[mt]-ct,dn=ie-wt;if(Be-fe>We-ve){var Dn=ie?(fe*dn+Be*wt)/ie:Be;N(L,mt,wt,fe,ve,Dn,We),N(mt,Y,dn,Dn,ve,Be,We)}else{var wn=ie?(ve*dn+We*wt)/ie:We;N(L,mt,wt,fe,ve,Be,wn),N(mt,Y,dn,fe,wn,Be,We)}})(0,w,e.value,t,n,r,i)},dice:vx,slice:Rw,slicedice:function(e,t,n,r,i){(1&e.depth?Rw:vx)(e,t,n,r,i)},squarify:uD,resquarify:uj},_3=["x0","y0","x1","y1","depth","children"];function E3(e){Qv.call(this,e)}E3.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:_3.length,default:_3}]},Object(we.z)(E3,Qv,{layout(){const e=function(){var t=uD,n=!1,r=1,i=1,s=[0],f=dy,v=dy,w=dy,O=dy,N=dy;function L(ie){return ie.x0=ie.y0=0,ie.x1=r,ie.y1=i,ie.eachBefore(Y),s=[0],n&&ie.eachBefore(rD),ie}function Y(ie){var fe=s[ie.depth],ve=ie.x0+fe,Be=ie.y0+fe,We=ie.x1-fe,Ve=ie.y1-fe;We<ve&&(ve=We=(ve+We)/2),Ve<Be&&(Be=Ve=(Be+Ve)/2),ie.x0=ve,ie.y0=Be,ie.x1=We,ie.y1=Ve,ie.children&&(fe=s[ie.depth+1]=f(ie)/2,ve+=N(ie)-fe,Be+=v(ie)-fe,We-=w(ie)-fe,Ve-=O(ie)-fe,We<ve&&(ve=We=(ve+We)/2),Ve<Be&&(Be=Ve=(Be+Ve)/2),t(ie,ve,Be,We,Ve))}return L.round=function(ie){return arguments.length?(n=!!ie,L):n},L.size=function(ie){return arguments.length?(r=+ie[0],i=+ie[1],L):[r,i]},L.tile=function(ie){return arguments.length?(t=Iw(ie),L):t},L.padding=function(ie){return arguments.length?L.paddingInner(ie).paddingOuter(ie):L.paddingInner()},L.paddingInner=function(ie){return arguments.length?(f=typeof ie=="function"?ie:fb(+ie),L):f},L.paddingOuter=function(ie){return arguments.length?L.paddingTop(ie).paddingRight(ie).paddingBottom(ie).paddingLeft(ie):L.paddingTop()},L.paddingTop=function(ie){return arguments.length?(v=typeof ie=="function"?ie:fb(+ie),L):v},L.paddingRight=function(ie){return arguments.length?(w=typeof ie=="function"?ie:fb(+ie),L):w},L.paddingBottom=function(ie){return arguments.length?(O=typeof ie=="function"?ie:fb(+ie),L):O},L.paddingLeft=function(ie){return arguments.length?(N=typeof ie=="function"?ie:fb(+ie),L):N},L}();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{Object(we.w)(lD,t)?e.tile(lD[t]):Object(we.o)("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:_3});const fj=4278190080,hj=268435456,dj=.0625;function pj(e,t,n,r){const i=e.width,s=e.height,f=n||r,v=Mu(i,s).getContext("2d");t.forEach(Be=>function We(Ve,ct,lt){if(!ct.length)return;const mt=ct[0].mark.marktype;mt==="group"?ct.forEach(dt=>{dt.items.forEach(kt=>We(Ve,kt.items,lt))}):Oh[mt].draw(Ve,{items:lt?ct.map(mj):ct})}(v,Be,f));const w=new Uint32Array(v.getImageData(0,0,i,s).data.buffer),O=e.bitmap(),N=f&&e.bitmap();let L,Y,ie,fe,ve;for(Y=0;Y<s;++Y)for(L=0;L<i;++L)(ve=w[Y*i+L]&fj)&&(ie=e(L),fe=e(Y),r||O.set(ie,fe),f&&ve^hj&&N.set(ie,fe));return[O,N]}function mj(e){const t=Pr(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=dj,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}const Zv=5,Am=31,yx=32,F1=new Uint32Array(yx+1),tv=new Uint32Array(yx+1);tv[0]=0,F1[0]=~tv[0];for(let e=1;e<=yx;++e)tv[e]=tv[e-1]<<1|1,F1[e]=~tv[e];function gj(e,t,n){const r=Math.max(1,Math.sqrt(e*t/1e6)),i=~~((e+2*n+r)/r),s=~~((t+2*n+r)/r),f=v=>~~((v+n)/r);return f.invert=v=>v*r-n,f.bitmap=()=>function(v,w){const O=new Uint32Array(~~((v*w+yx)/yx));function N(Y,ie){O[Y]|=ie}function L(Y,ie){O[Y]&=ie}return{array:O,get:(Y,ie)=>{const fe=ie*v+Y;return O[fe>>>Zv]&1<<(fe&Am)},set:(Y,ie)=>{const fe=ie*v+Y;N(fe>>>Zv,1<<(fe&Am))},clear:(Y,ie)=>{const fe=ie*v+Y;L(fe>>>Zv,~(1<<(fe&Am)))},getRange:(Y,ie,fe,ve)=>{let Be,We,Ve,ct,lt=ve;for(;lt>=ie;--lt)if((Ve=(Be=lt*v+Y)>>>Zv)==(ct=(We=lt*v+fe)>>>Zv)){if(O[Ve]&F1[Be&Am]&tv[1+(We&Am)])return!0}else{if(O[Ve]&F1[Be&Am]||O[ct]&tv[1+(We&Am)])return!0;for(let mt=Ve+1;mt<ct;++mt)if(O[mt])return!0}return!1},setRange:(Y,ie,fe,ve)=>{let Be,We,Ve,ct,lt;for(;ie<=ve;++ie)if((Ve=(Be=ie*v+Y)>>>Zv)==(ct=(We=ie*v+fe)>>>Zv))N(Ve,F1[Be&Am]&tv[1+(We&Am)]);else for(N(Ve,F1[Be&Am]),N(ct,tv[1+(We&Am)]),lt=Ve+1;lt<ct;++lt)N(lt,4294967295)},clearRange:(Y,ie,fe,ve)=>{let Be,We,Ve,ct,lt;for(;ie<=ve;++ie)if((Ve=(Be=ie*v+Y)>>>Zv)==(ct=(We=ie*v+fe)>>>Zv))L(Ve,tv[Be&Am]|F1[1+(We&Am)]);else for(L(Ve,tv[Be&Am]),L(ct,F1[1+(We&Am)]),lt=Ve+1;lt<ct;++lt)L(lt,0)},outOfBounds:(Y,ie,fe,ve)=>Y<0||ie<0||ve>=w||fe>=v}}(i,s),f.ratio=r,f.padding=n,f.width=e,f.height=t,f}function Mw(e,t,n,r,i,s){let f=n/2;return e-f<0||e+f>i||t-(f=r/2)<0||t+f>s}function R1(e,t,n,r,i,s,f,v){const w=i*s/(2*r),O=e(t-w),N=e(t+w),L=e(n-(s/=2)),Y=e(n+s);return f.outOfBounds(O,L,N,Y)||f.getRange(O,L,N,Y)||v&&v.getRange(O,L,N,Y)}const vj=[-1,-1,1,1],yj=[-1,1,-1,1],bj=["right","center","left"],xj=["bottom","middle","top"];function fD(e,t,n,r,i,s,f,v,w,O,N,L){return!(i.outOfBounds(e,n,t,r)||(L&&s?s.getRange(e,n,t,r)||!function(Y,ie,fe,ve,Be){return Be[0]<=Y&&fe<=Be[2]&&Be[3]<=ie&&ve<=Be[5]}(f,w,v,O,N):i.getRange(e,n,t,r)))}const wj={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},kj={naive:function(e,t,n,r){const i=e.width,s=e.height;return function(f){const v=f.datum.datum.items[r].items,w=v.length,O=f.datum.fontSize,N=Au.width(f.datum,f.datum.text);let L,Y,ie,fe,ve,Be,We,Ve=0;for(let ct=0;ct<w;++ct)L=v[ct].x,ie=v[ct].y,ve=(L+(Y=v[ct].x2===void 0?L:v[ct].x2))/2,Be=(ie+(fe=v[ct].y2===void 0?ie:v[ct].y2))/2,(We=Math.abs(Y-L+fe-ie))>=Ve&&(Ve=We,f.x=ve,f.y=Be);return ve=N/2,Be=O/2,L=f.x-ve,Y=f.x+ve,ie=f.y-Be,fe=f.y+Be,f.align="center",L<0&&Y<=i?f.align="left":0<=L&&i<Y&&(f.align="right"),f.baseline="middle",ie<0&&fe<=s?f.baseline="top":0<=ie&&s<fe&&(f.baseline="bottom"),!0}},"reduced-search":function(e,t,n,r){const i=e.width,s=e.height,f=t[0],v=t[1];function w(O,N,L,Y,ie){const fe=e.invert(O),ve=e.invert(N);let Be,We=L,Ve=s;if(!Mw(fe,ve,Y,ie,i,s)&&!R1(e,fe,ve,ie,Y,We,f,v)&&!R1(e,fe,ve,ie,Y,ie,f,null)){for(;Ve-We>=1;)R1(e,fe,ve,ie,Y,Be=(We+Ve)/2,f,v)?Ve=Be:We=Be;if(We>L)return[fe,ve,We,!0]}}return function(O){const N=O.datum.datum.items[r].items,L=N.length,Y=O.datum.fontSize,ie=Au.width(O.datum,O.datum.text);let fe,ve,Be,We,Ve,ct,lt,mt,dt,kt,wt,dn,Dn,wn,Xn,Kn,ir,sr=n?Y:0,gr=!1,Vr=!1,hi=0;for(let Qr=0;Qr<L;++Qr){for(fe=N[Qr].x,Be=N[Qr].y,ve=N[Qr].x2===void 0?fe:N[Qr].x2,We=N[Qr].y2===void 0?Be:N[Qr].y2,fe>ve&&(ir=fe,fe=ve,ve=ir),Be>We&&(ir=Be,Be=We,We=ir),kt=~~(((dt=e(fe))+(wt=e(ve)))/2),Dn=~~(((dn=e(Be))+(wn=e(We)))/2),lt=kt;lt>=dt;--lt)for(mt=Dn;mt>=dn;--mt)(Kn=w(lt,mt,sr,ie,Y))&&([O.x,O.y,sr,gr]=Kn);for(lt=kt;lt<=wt;++lt)for(mt=Dn;mt<=wn;++mt)(Kn=w(lt,mt,sr,ie,Y))&&([O.x,O.y,sr,gr]=Kn);gr||n||(Ve=(fe+ve)/2,ct=(Be+We)/2,(Xn=Math.abs(ve-fe+We-Be))>=hi&&!Mw(Ve,ct,ie,Y,i,s)&&!R1(e,Ve,ct,Y,ie,Y,f,null)&&(hi=Xn,O.x=Ve,O.y=ct,Vr=!0))}return!(!gr&&!Vr||(Ve=ie/2,ct=Y/2,f.setRange(e(O.x-Ve),e(O.y-ct),e(O.x+Ve),e(O.y+ct)),O.align="center",O.baseline="middle",0))}},floodfill:function(e,t,n,r){const i=e.width,s=e.height,f=t[0],v=t[1],w=e.bitmap();return function(O){const N=O.datum.datum.items[r].items,L=N.length,Y=O.datum.fontSize,ie=Au.width(O.datum,O.datum.text),fe=[];let ve,Be,We,Ve,ct,lt,mt,dt,kt,wt,dn,Dn,wn=n?Y:0,Xn=!1,Kn=!1,ir=0;for(let sr=0;sr<L;++sr){for(ve=N[sr].x,We=N[sr].y,Be=N[sr].x2===void 0?ve:N[sr].x2,Ve=N[sr].y2===void 0?We:N[sr].y2,fe.push([e((ve+Be)/2),e((We+Ve)/2)]);fe.length;)if([mt,dt]=fe.pop(),!(f.get(mt,dt)||v.get(mt,dt)||w.get(mt,dt))){w.set(mt,dt);for(let gr=0;gr<4;++gr)ct=mt+vj[gr],lt=dt+yj[gr],w.outOfBounds(ct,lt,ct,lt)||fe.push([ct,lt]);if(ct=e.invert(mt),lt=e.invert(dt),kt=wn,wt=s,!Mw(ct,lt,ie,Y,i,s)&&!R1(e,ct,lt,Y,ie,kt,f,v)&&!R1(e,ct,lt,Y,ie,Y,f,null)){for(;wt-kt>=1;)R1(e,ct,lt,Y,ie,dn=(kt+wt)/2,f,v)?wt=dn:kt=dn;kt>wn&&(O.x=ct,O.y=lt,wn=kt,Xn=!0)}}Xn||n||(ct=(ve+Be)/2,lt=(We+Ve)/2,(Dn=Math.abs(Be-ve+Ve-We))>=ir&&!Mw(ct,lt,ie,Y,i,s)&&!R1(e,ct,lt,Y,ie,Y,f,null)&&(ir=Dn,O.x=ct,O.y=lt,Kn=!0))}return!(!Xn&&!Kn||(ct=ie/2,lt=Y/2,f.setRange(e(O.x-ct),e(O.y-lt),e(O.x+ct),e(O.y+lt)),O.align="center",O.baseline="middle",0))}}};function _j(e,t,n,r,i,s,f,v,w,O,N){if(!e.length)return e;const L=Math.max(r.length,i.length),Y=function(kt,wt){const dn=new Float64Array(wt),Dn=kt.length;for(let wn=0;wn<Dn;++wn)dn[wn]=kt[wn]||0;for(let wn=Dn;wn<wt;++wn)dn[wn]=dn[Dn-1];return dn}(r,L),ie=function(kt,wt){const dn=new Int8Array(wt),Dn=kt.length;for(let wn=0;wn<Dn;++wn)dn[wn]|=wj[kt[wn]];for(let wn=Dn;wn<wt;++wn)dn[wn]=dn[Dn-1];return dn}(i,L),fe=function(kt){return kt&&kt.mark&&kt.mark.marktype}(e[0].datum),ve=fe==="group"&&e[0].datum.items[w].marktype,Be=ve==="area",We=function(kt,wt,dn,Dn){const wn=Xn=>[Xn.x,Xn.x,Xn.x,Xn.y,Xn.y,Xn.y];return kt?kt==="line"||kt==="area"?Xn=>wn(Xn.datum):wt==="line"?Xn=>{const Kn=Xn.datum.items[Dn].items;return wn(Kn.length?Kn[dn==="start"?0:Kn.length-1]:{x:NaN,y:NaN})}:Xn=>{const Kn=Xn.datum.bounds;return[Kn.x1,(Kn.x1+Kn.x2)/2,Kn.x2,Kn.y1,(Kn.y1+Kn.y2)/2,Kn.y2]}:wn}(fe,ve,v,w),Ve=gj(t[0],t[1],O),ct=Be&&N==="naive",lt=e.map(kt=>({datum:kt,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:We(kt)}));let mt;if(!ct){n&&lt.sort((wt,dn)=>n(wt.datum,dn.datum));let kt=!1;for(let wt=0;wt<ie.length&&!kt;++wt)kt=ie[wt]===5||Y[wt]<0;fe&&(f||Be)&&(s=[e.map(wt=>wt.datum)].concat(s)),mt=s.length?pj(Ve,s,kt,Be):function(wt,dn){const Dn=wt.bitmap();return(dn||[]).forEach(wn=>Dn.set(wt(wn.boundary[0]),wt(wn.boundary[3]))),[Dn,void 0]}(Ve,f&&lt)}const dt=Be?kj[N](Ve,mt,f,w):function(kt,wt,dn,Dn){const wn=kt.width,Xn=kt.height,Kn=wt[0],ir=wt[1],sr=Dn.length;return function(gr){const Vr=gr.boundary,hi=gr.datum.fontSize;if(Vr[2]<0||Vr[5]<0||Vr[0]>wn||Vr[3]>Xn)return!1;let Qr,Ni,ro,oo,Po,ho,ao,xo,_a,ys,Lo,Vs,qs,Su,Ic,Fc=0;for(let xc=0;xc<sr;++xc){if(Qr=(3&dn[xc])-1,Ni=(dn[xc]>>>2&3)-1,ro=Qr===0&&Ni===0||Dn[xc]<0,oo=Qr&&Ni?Math.SQRT1_2:1,Po=Dn[xc]<0?-1:1,ho=Vr[1+Qr]+Dn[xc]*Qr*oo,xo=(Lo=Vr[4+Ni]+Po*hi*Ni/2+Dn[xc]*Ni*oo)-hi/2,_a=Lo+hi/2,Vs=kt(ho),Su=kt(xo),Ic=kt(_a),!Fc){if(!fD(Vs,Vs,Su,Ic,Kn,ir,ho,ho,xo,_a,Vr,ro))continue;Fc=Au.width(gr.datum,gr.datum.text)}if(ao=(ys=ho+Po*Fc*Qr/2)+Fc/2,fD(Vs=kt(ho=ys-Fc/2),qs=kt(ao),Su,Ic,Kn,ir,ho,ao,xo,_a,Vr,ro))return gr.x=Qr?Qr*Po<0?ao:ho:ys,gr.y=Ni?Ni*Po<0?_a:xo:Lo,gr.align=bj[Qr*Po+1],gr.baseline=xj[Ni*Po+1],Kn.setRange(Vs,Su,qs,Ic),!0}return!1}}(Ve,mt,ie,Y);return lt.forEach(kt=>kt.opacity=+dt(kt)),lt}const C3=["x","y","opacity","align","baseline"],hD=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function A3(e){Ft.call(this,null,e)}function dD(e,t){var n,r,i,s,f,v,w=[],O=function(N){return N(s)};if(t==null)w.push(e);else for(n={},r=0,i=e.length;r<i;++r)s=e[r],(v=n[f=t.map(O)])||(n[f]=v=[],v.dims=f,w.push(v)),v.push(s);return w}function O3(e){Ft.call(this,null,e)}A3.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:hD},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:C3.length,default:C3}]},Object(we.z)(A3,Ft,{transform(e,t){const n=e.modified();if(!(n||t.changed(t.ADD_REM)||function(i){const s=e[i];return Object(we.E)(s)&&t.modified(s.fields)}("sort")))return;e.size&&e.size.length===2||Object(we.o)("Size parameter should be specified as a [width, height] array.");const r=e.as||C3;return _j(t.materialize(t.SOURCE).source,e.size,e.sort,Object(we.i)(e.offset||1),Object(we.i)(e.anchor||hD),e.avoidMarks||[],e.avoidBaseMark!==!1,e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach(i=>{const s=i.datum;s[r[0]]=i.x,s[r[1]]=i.y,s[r[2]]=i.opacity,s[r[3]]=i.align,s[r[4]]=i.baseline}),t.reflow(n).modifies(r)}}),O3.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},Object(we.z)(O3,Ft,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=dD(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(we.h),s=i.length,f=e.as||[Object(we.h)(e.x),Object(we.h)(e.y)],v=[];r.forEach(w=>{Yc(w,e.x,e.y,e.bandwidth||.3).forEach(O=>{const N={};for(let L=0;L<s;++L)N[i[L]]=w.dims[L];N[f[0]]=O[0],N[f[1]]=O[1],v.push(jn(N))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=v}return n}});const S3={linear:Is,log:Ba,exp:jc,pow:ac,quad:Xc,poly:eu};function D3(e){Ft.call(this,null,e)}D3.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(S3)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},Object(we.z)(D3,Ft,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=dD(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(we.h),s=e.method||"linear",f=e.order||3,v=((Y,ie)=>Y==="poly"?ie:Y==="quad"?2:1)(s,f),w=e.as||[Object(we.h)(e.x),Object(we.h)(e.y)],O=S3[s],N=[];let L=e.extent;Object(we.w)(S3,s)||Object(we.o)("Invalid regression method: "+s),L!=null&&s==="log"&&L[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),L=null),r.forEach(Y=>{if(Y.length<=v)return void t.dataflow.warn("Skipping regression with more parameters than data points.");const ie=O(Y,e.x,e.y,f);if(e.params)return void N.push(jn({keys:Y.dims,coef:ie.coef,rSquared:ie.rSquared}));const fe=L||Object(we.q)(Y,e.x),ve=Be=>{const We={};for(let Ve=0;Ve<i.length;++Ve)We[i[Ve]]=Y.dims[Ve];We[w[0]]=Be[0],We[w[1]]=Be[1],N.push(jn(We))};s==="linear"?fe.forEach(Be=>ve([Be,ie.predict(Be)])):Of(ie.predict,fe,25,200).forEach(ve)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=N}return n}});const pD=Math.pow(2,-52),jw=new Uint32Array(512);class Bw{static from(t,n=function(i){return i[0]},r=function(i){return i[1]}){const i=t.length,s=new Float64Array(2*i);for(let f=0;f<i;f++){const v=t[f];s[2*f]=n(v),s[2*f+1]=r(v)}return new Bw(s)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const r=Math.max(2*n-5,0);this._triangles=new Uint32Array(3*r),this._halfedges=new Int32Array(3*r),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:r,_hullTri:i,_hullHash:s}=this,f=t.length>>1;let v=1/0,w=1/0,O=-1/0,N=-1/0;for(let Dn=0;Dn<f;Dn++){const wn=t[2*Dn],Xn=t[2*Dn+1];wn<v&&(v=wn),Xn<w&&(w=Xn),wn>O&&(O=wn),Xn>N&&(N=Xn),this._ids[Dn]=Dn}const L=(v+O)/2,Y=(w+N)/2;let ie,fe,ve,Be=1/0;for(let Dn=0;Dn<f;Dn++){const wn=T3(L,Y,t[2*Dn],t[2*Dn+1]);wn<Be&&(ie=Dn,Be=wn)}const We=t[2*ie],Ve=t[2*ie+1];Be=1/0;for(let Dn=0;Dn<f;Dn++){if(Dn===ie)continue;const wn=T3(We,Ve,t[2*Dn],t[2*Dn+1]);wn<Be&&wn>0&&(fe=Dn,Be=wn)}let ct=t[2*fe],lt=t[2*fe+1],mt=1/0;for(let Dn=0;Dn<f;Dn++){if(Dn===ie||Dn===fe)continue;const wn=Cj(We,Ve,ct,lt,t[2*Dn],t[2*Dn+1]);wn<mt&&(ve=Dn,mt=wn)}let dt=t[2*ve],kt=t[2*ve+1];if(mt===1/0){for(let Xn=0;Xn<f;Xn++)this._dists[Xn]=t[2*Xn]-t[0]||t[2*Xn+1]-t[1];hb(this._ids,this._dists,0,f-1);const Dn=new Uint32Array(f);let wn=0;for(let Xn=0,Kn=-1/0;Xn<f;Xn++){const ir=this._ids[Xn];this._dists[ir]>Kn&&(Dn[wn++]=ir,Kn=this._dists[ir])}return this.hull=Dn.subarray(0,wn),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(Pw(We,Ve,ct,lt,dt,kt)){const Dn=fe,wn=ct,Xn=lt;fe=ve,ct=dt,lt=kt,ve=Dn,dt=wn,kt=Xn}const wt=function(Dn,wn,Xn,Kn,ir,sr){const gr=Xn-Dn,Vr=Kn-wn,hi=ir-Dn,Qr=sr-wn,Ni=gr*gr+Vr*Vr,ro=hi*hi+Qr*Qr,oo=.5/(gr*Qr-Vr*hi);return{x:Dn+(Qr*Ni-Vr*ro)*oo,y:wn+(gr*ro-hi*Ni)*oo}}(We,Ve,ct,lt,dt,kt);this._cx=wt.x,this._cy=wt.y;for(let Dn=0;Dn<f;Dn++)this._dists[Dn]=T3(t[2*Dn],t[2*Dn+1],wt.x,wt.y);hb(this._ids,this._dists,0,f-1),this._hullStart=ie;let dn=3;r[ie]=n[ve]=fe,r[fe]=n[ie]=ve,r[ve]=n[fe]=ie,i[ie]=0,i[fe]=1,i[ve]=2,s.fill(-1),s[this._hashKey(We,Ve)]=ie,s[this._hashKey(ct,lt)]=fe,s[this._hashKey(dt,kt)]=ve,this.trianglesLen=0,this._addTriangle(ie,fe,ve,-1,-1,-1);for(let Dn,wn,Xn=0;Xn<this._ids.length;Xn++){const Kn=this._ids[Xn],ir=t[2*Kn],sr=t[2*Kn+1];if(Xn>0&&Math.abs(ir-Dn)<=pD&&Math.abs(sr-wn)<=pD||(Dn=ir,wn=sr,Kn===ie||Kn===fe||Kn===ve))continue;let gr=0;for(let ro=0,oo=this._hashKey(ir,sr);ro<this._hashSize&&((gr=s[(oo+ro)%this._hashSize])===-1||gr===r[gr]);ro++);let Vr,hi=gr=n[gr];for(;Vr=r[hi],!Pw(ir,sr,t[2*hi],t[2*hi+1],t[2*Vr],t[2*Vr+1]);)if((hi=Vr)===gr){hi=-1;break}if(hi===-1)continue;let Qr=this._addTriangle(hi,Kn,r[hi],-1,-1,i[hi]);i[Kn]=this._legalize(Qr+2),i[hi]=Qr,dn++;let Ni=r[hi];for(;Vr=r[Ni],Pw(ir,sr,t[2*Ni],t[2*Ni+1],t[2*Vr],t[2*Vr+1]);)Qr=this._addTriangle(Ni,Kn,Vr,i[Kn],-1,i[Ni]),i[Kn]=this._legalize(Qr+2),r[Ni]=Ni,dn--,Ni=Vr;if(hi===gr)for(;Pw(ir,sr,t[2*(Vr=n[hi])],t[2*Vr+1],t[2*hi],t[2*hi+1]);)Qr=this._addTriangle(Vr,Kn,hi,-1,i[hi],i[Vr]),this._legalize(Qr+2),i[Vr]=Qr,r[hi]=hi,dn--,hi=Vr;this._hullStart=n[Kn]=hi,r[hi]=n[Ni]=Kn,r[Kn]=Ni,s[this._hashKey(ir,sr)]=Kn,s[this._hashKey(t[2*hi],t[2*hi+1])]=hi}this.hull=new Uint32Array(dn);for(let Dn=0,wn=this._hullStart;Dn<dn;Dn++)this.hull[Dn]=wn,wn=r[wn];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(function(r,i){const s=r/(Math.abs(r)+Math.abs(i));return(i>0?3-s:1+s)/4}(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:r,coords:i}=this;let s=0,f=0;for(;;){const v=r[t],w=t-t%3;if(f=w+(t+2)%3,v===-1){if(s===0)break;t=jw[--s];continue}const O=v-v%3,N=w+(t+1)%3,L=O+(v+2)%3,Y=n[f],ie=n[t],fe=n[N],ve=n[L];if(Ej(i[2*Y],i[2*Y+1],i[2*ie],i[2*ie+1],i[2*fe],i[2*fe+1],i[2*ve],i[2*ve+1])){n[t]=ve,n[v]=Y;const Be=r[L];if(Be===-1){let Ve=this._hullStart;do{if(this._hullTri[Ve]===L){this._hullTri[Ve]=t;break}Ve=this._hullPrev[Ve]}while(Ve!==this._hullStart)}this._link(t,Be),this._link(v,r[f]),this._link(f,L);const We=O+(v+1)%3;s<jw.length&&(jw[s++]=We)}else{if(s===0)break;t=jw[--s]}}return f}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,r,i,s,f){const v=this.trianglesLen;return this._triangles[v]=t,this._triangles[v+1]=n,this._triangles[v+2]=r,this._link(v,i),this._link(v+1,s),this._link(v+2,f),this.trianglesLen+=3,v}}function T3(e,t,n,r){const i=e-n,s=t-r;return i*i+s*s}function N3(e,t,n,r,i,s){const f=(r-t)*(i-e),v=(n-e)*(s-t);return Math.abs(f-v)>=33306690738754716e-32*Math.abs(f+v)?f-v:0}function Pw(e,t,n,r,i,s){return(N3(i,s,e,t,n,r)||N3(e,t,n,r,i,s)||N3(n,r,i,s,e,t))<0}function Ej(e,t,n,r,i,s,f,v){const w=e-f,O=t-v,N=n-f,L=r-v,Y=i-f,ie=s-v,fe=N*N+L*L,ve=Y*Y+ie*ie;return w*(L*ve-fe*ie)-O*(N*ve-fe*Y)+(w*w+O*O)*(N*ie-L*Y)<0}function Cj(e,t,n,r,i,s){const f=n-e,v=r-t,w=i-e,O=s-t,N=f*f+v*v,L=w*w+O*O,Y=.5/(f*O-v*w),ie=(O*N-v*L)*Y,fe=(f*L-w*N)*Y;return ie*ie+fe*fe}function hb(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const s=e[i],f=t[s];let v=i-1;for(;v>=n&&t[e[v]]>f;)e[v+1]=e[v--];e[v+1]=s}else{let i=n+1,s=r;bx(e,n+r>>1,i),t[e[n]]>t[e[r]]&&bx(e,n,r),t[e[i]]>t[e[r]]&&bx(e,i,r),t[e[n]]>t[e[i]]&&bx(e,n,i);const f=e[i],v=t[f];for(;;){do i++;while(t[e[i]]<v);do s--;while(t[e[s]]>v);if(s<i)break;bx(e,i,s)}e[n+1]=e[s],e[s]=f,r-i+1>=s-n?(hb(e,t,i,r),hb(e,t,n,s-1)):(hb(e,t,n,s-1),hb(e,t,i,r))}}function bx(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}const mD=1e-6;class py{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,r){const i=(t=+t)+(r=+r),s=n=+n;if(r<0)throw new Error("negative radius");this._x1===null?this._+=`M${i},${s}`:(Math.abs(this._x1-i)>mD||Math.abs(this._y1-s)>mD)&&(this._+="L"+i+","+s),r&&(this._+=`A${r},${r},0,1,1,${t-r},${n}A${r},${r},0,1,1,${this._x1=i},${this._y1=s}`)}rect(t,n,r,i){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+r}v${+i}h${-r}Z`}value(){return this._||null}}class I3{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}class Aj{constructor(t,[n,r,i,s]=[0,0,960,500]){if(!((i=+i)>=(n=+n)&&(s=+s)>=(r=+r)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=i,this.xmin=n,this.ymax=s,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:r},vectors:i}=this,s=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let ie,fe,ve=0,Be=0,We=r.length;ve<We;ve+=3,Be+=2){const Ve=2*r[ve],ct=2*r[ve+1],lt=2*r[ve+2],mt=t[Ve],dt=t[Ve+1],kt=t[ct],wt=t[ct+1],dn=t[lt],Dn=t[lt+1],wn=kt-mt,Xn=wt-dt,Kn=dn-mt,ir=Dn-dt,sr=wn*wn+Xn*Xn,gr=Kn*Kn+ir*ir,Vr=2*(wn*ir-Xn*Kn);if(Vr)if(Math.abs(Vr)<1e-8)ie=(mt+dn)/2,fe=(dt+Dn)/2;else{const hi=1/Vr;ie=mt+(ir*sr-Xn*gr)*hi,fe=dt+(wn*gr-Kn*sr)*hi}else ie=(mt+dn)/2-1e8*ir,fe=(dt+Dn)/2+1e8*Kn;s[Be]=ie,s[Be+1]=fe}let f,v,w,O=n[n.length-1],N=4*O,L=t[2*O],Y=t[2*O+1];i.fill(0);for(let ie=0;ie<n.length;++ie)f=N,v=L,w=Y,N=4*(O=n[ie]),L=t[2*O],Y=t[2*O+1],i[f+2]=i[N]=w-Y,i[f+3]=i[N+1]=L-v}render(t){const n=t==null?t=new py:void 0,{delaunay:{halfedges:r,inedges:i,hull:s},circumcenters:f,vectors:v}=this;if(s.length<=1)return null;for(let N=0,L=r.length;N<L;++N){const Y=r[N];if(Y<N)continue;const ie=2*Math.floor(N/3),fe=2*Math.floor(Y/3),ve=f[ie],Be=f[ie+1],We=f[fe],Ve=f[fe+1];this._renderSegment(ve,Be,We,Ve,t)}let w,O=s[s.length-1];for(let N=0;N<s.length;++N){w=O,O=s[N];const L=2*Math.floor(i[O]/3),Y=f[L],ie=f[L+1],fe=4*w,ve=this._project(Y,ie,v[fe+2],v[fe+3]);ve&&this._renderSegment(Y,ie,ve[0],ve[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new py:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const r=n==null?n=new py:void 0,i=this._clip(t);if(i===null||!i.length)return;n.moveTo(i[0],i[1]);let s=i.length;for(;i[0]===i[s-2]&&i[1]===i[s-1]&&s>1;)s-=2;for(let f=2;f<s;f+=2)i[f]===i[f-2]&&i[f+1]===i[f-1]||n.lineTo(i[f],i[f+1]);return n.closePath(),r&&r.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,r=t.length/2;n<r;++n){const i=this.cellPolygon(n);i&&(i.index=n,yield i)}}cellPolygon(t){const n=new I3;return this.renderCell(t,n),n.value()}_renderSegment(t,n,r,i,s){let f;const v=this._regioncode(t,n),w=this._regioncode(r,i);v===0&&w===0?(s.moveTo(t,n),s.lineTo(r,i)):(f=this._clipSegment(t,n,r,i,v,w))&&(s.moveTo(f[0],f[1]),s.lineTo(f[2],f[3]))}contains(t,n,r){return(n=+n)==n&&(r=+r)==r&&this.delaunay._step(t,n,r)===t}*neighbors(t){const n=this._clip(t);if(n)for(const r of this.delaunay.neighbors(t)){const i=this._clip(r);if(i){e:for(let s=0,f=n.length;s<f;s+=2)for(let v=0,w=i.length;v<w;v+=2)if(n[s]==i[v]&&n[s+1]==i[v+1]&&n[(s+2)%f]==i[(v+w-2)%w]&&n[(s+3)%f]==i[(v+w-1)%w]){yield r;break e}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:r,halfedges:i,triangles:s}}=this,f=r[t];if(f===-1)return null;const v=[];let w=f;do{const O=Math.floor(w/3);if(v.push(n[2*O],n[2*O+1]),s[w=w%3==2?w-2:w+1]!==t)break;w=i[w]}while(w!==f&&w!==-1);return v}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:r}=this,i=4*t;return r[i]||r[i+1]?this._clipInfinite(t,n,r[i],r[i+1],r[i+2],r[i+3]):this._clipFinite(t,n)}_clipFinite(t,n){const r=n.length;let i,s,f,v,w,O=null,N=n[r-2],L=n[r-1],Y=this._regioncode(N,L);for(let ie=0;ie<r;ie+=2)if(i=N,s=L,N=n[ie],L=n[ie+1],f=Y,Y=this._regioncode(N,L),f===0&&Y===0)v=w,w=0,O?O.push(N,L):O=[N,L];else{let fe,ve,Be,We,Ve;if(f===0){if((fe=this._clipSegment(i,s,N,L,f,Y))===null)continue;[ve,Be,We,Ve]=fe}else{if((fe=this._clipSegment(N,L,i,s,Y,f))===null)continue;[We,Ve,ve,Be]=fe,v=w,w=this._edgecode(ve,Be),v&&w&&this._edge(t,v,w,O,O.length),O?O.push(ve,Be):O=[ve,Be]}v=w,w=this._edgecode(We,Ve),v&&w&&this._edge(t,v,w,O,O.length),O?O.push(We,Ve):O=[We,Ve]}if(O)v=w,w=this._edgecode(O[0],O[1]),v&&w&&this._edge(t,v,w,O,O.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return O}_clipSegment(t,n,r,i,s,f){for(;;){if(s===0&&f===0)return[t,n,r,i];if(s&f)return null;let v,w,O=s||f;8&O?(v=t+(r-t)*(this.ymax-n)/(i-n),w=this.ymax):4&O?(v=t+(r-t)*(this.ymin-n)/(i-n),w=this.ymin):2&O?(w=n+(i-n)*(this.xmax-t)/(r-t),v=this.xmax):(w=n+(i-n)*(this.xmin-t)/(r-t),v=this.xmin),s?(t=v,n=w,s=this._regioncode(t,n)):(r=v,i=w,f=this._regioncode(r,i))}}_clipInfinite(t,n,r,i,s,f){let v,w=Array.from(n);if((v=this._project(w[0],w[1],r,i))&&w.unshift(v[0],v[1]),(v=this._project(w[w.length-2],w[w.length-1],s,f))&&w.push(v[0],v[1]),w=this._clipFinite(t,w))for(let O,N=0,L=w.length,Y=this._edgecode(w[L-2],w[L-1]);N<L;N+=2)O=Y,Y=this._edgecode(w[N],w[N+1]),O&&Y&&(N=this._edge(t,O,Y,w,N),L=w.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(w=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return w}_edge(t,n,r,i,s){for(;n!==r;){let f,v;switch(n){case 5:n=4;continue;case 4:n=6,f=this.xmax,v=this.ymin;break;case 6:n=2;continue;case 2:n=10,f=this.xmax,v=this.ymax;break;case 10:n=8;continue;case 8:n=9,f=this.xmin,v=this.ymax;break;case 9:n=1;continue;case 1:n=5,f=this.xmin,v=this.ymin}i[s]===f&&i[s+1]===v||!this.contains(t,f,v)||(i.splice(s,0,f,v),s+=2)}if(i.length>4)for(let f=0;f<i.length;f+=2){const v=(f+2)%i.length,w=(f+4)%i.length;(i[f]===i[v]&&i[v]===i[w]||i[f+1]===i[v+1]&&i[v+1]===i[w+1])&&(i.splice(v,2),f-=2)}return s}_project(t,n,r,i){let s,f,v,w=1/0;if(i<0){if(n<=this.ymin)return null;(s=(this.ymin-n)/i)<w&&(v=this.ymin,f=t+(w=s)*r)}else if(i>0){if(n>=this.ymax)return null;(s=(this.ymax-n)/i)<w&&(v=this.ymax,f=t+(w=s)*r)}if(r>0){if(t>=this.xmax)return null;(s=(this.xmax-t)/r)<w&&(f=this.xmax,v=n+(w=s)*i)}else if(r<0){if(t<=this.xmin)return null;(s=(this.xmin-t)/r)<w&&(f=this.xmin,v=n+(w=s)*i)}return[f,v]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}}const Oj=2*Math.PI,db=Math.pow;function Sj(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class F3{static from(t,n=function(s){return s[0]},r=function(s){return s[1]},i){return new F3("length"in t?function(s,f,v,w){const O=s.length,N=new Float64Array(2*O);for(let L=0;L<O;++L){const Y=s[L];N[2*L]=f.call(w,Y,L,s),N[2*L+1]=v.call(w,Y,L,s)}return N}(t,n,r,i):Float64Array.from(function*(s,f,v,w){let O=0;for(const N of s)yield f.call(w,N,O,s),yield v.call(w,N,O,s),++O}(t,n,r,i)))}constructor(t){this._delaunator=new Bw(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&function(w){const{triangles:O,coords:N}=w;for(let L=0;L<O.length;L+=3){const Y=2*O[L],ie=2*O[L+1],fe=2*O[L+2];if((N[fe]-N[Y])*(N[ie+1]-N[Y+1])-(N[ie]-N[Y])*(N[fe+1]-N[Y+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:n.length/2},(Y,ie)=>ie).sort((Y,ie)=>n[2*Y]-n[2*ie]||n[2*Y+1]-n[2*ie+1]);const w=this.collinear[0],O=this.collinear[this.collinear.length-1],N=[n[2*w],n[2*w+1],n[2*O],n[2*O+1]],L=1e-8*Math.hypot(N[3]-N[1],N[2]-N[0]);for(let Y=0,ie=n.length/2;Y<ie;++Y){const fe=Sj(n[2*Y],n[2*Y+1],L);n[2*Y]=fe[0],n[2*Y+1]=fe[1]}this._delaunator=new Bw(n)}else delete this.collinear;const r=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,f=this.inedges.fill(-1),v=this._hullIndex.fill(-1);for(let w=0,O=r.length;w<O;++w){const N=s[w%3==2?w-2:w+1];r[w]!==-1&&f[N]!==-1||(f[N]=w)}for(let w=0,O=i.length;w<O;++w)v[i[w]]=w;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],this.triangles[1]=i[1],this.triangles[2]=i[1],f[i[0]]=1,i.length===2&&(f[i[1]]=0))}voronoi(t){return new Aj(this,t)}*neighbors(t){const{inedges:n,hull:r,_hullIndex:i,halfedges:s,triangles:f,collinear:v}=this;if(v){const L=v.indexOf(t);return L>0&&(yield v[L-1]),void(L<v.length-1&&(yield v[L+1]))}const w=n[t];if(w===-1)return;let O=w,N=-1;do{if(yield N=f[O],f[O=O%3==2?O-2:O+1]!==t)return;if((O=s[O])===-1){const L=r[(i[t]+1)%r.length];return void(L!==N&&(yield L))}}while(O!==w)}find(t,n,r=0){if((t=+t)!=t||(n=+n)!=n)return-1;const i=r;let s;for(;(s=this._step(r,t,n))>=0&&s!==r&&s!==i;)r=s;return s}_step(t,n,r){const{inedges:i,hull:s,_hullIndex:f,halfedges:v,triangles:w,points:O}=this;if(i[t]===-1||!O.length)return(t+1)%(O.length>>1);let N=t,L=db(n-O[2*t],2)+db(r-O[2*t+1],2);const Y=i[t];let ie=Y;do{let fe=w[ie];const ve=db(n-O[2*fe],2)+db(r-O[2*fe+1],2);if(ve<L&&(L=ve,N=fe),w[ie=ie%3==2?ie-2:ie+1]!==t)break;if((ie=v[ie])===-1){if((ie=s[(f[t]+1)%s.length])!==fe&&db(n-O[2*ie],2)+db(r-O[2*ie+1],2)<L)return ie;break}}while(ie!==Y);return N}render(t){const n=t==null?t=new py:void 0,{points:r,halfedges:i,triangles:s}=this;for(let f=0,v=i.length;f<v;++f){const w=i[f];if(w<f)continue;const O=2*s[f],N=2*s[w];t.moveTo(r[O],r[O+1]),t.lineTo(r[N],r[N+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n=2){const r=t==null?t=new py:void 0,{points:i}=this;for(let s=0,f=i.length;s<f;s+=2){const v=i[s],w=i[s+1];t.moveTo(v+n,w),t.arc(v,w,n,0,Oj)}return r&&r.value()}renderHull(t){const n=t==null?t=new py:void 0,{hull:r,points:i}=this,s=2*r[0],f=r.length;t.moveTo(i[s],i[s+1]);for(let v=1;v<f;++v){const w=2*r[v];t.lineTo(i[w],i[w+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new I3;return this.renderHull(t),t.value()}renderTriangle(t,n){const r=n==null?n=new py:void 0,{points:i,triangles:s}=this,f=2*s[t*=3],v=2*s[t+1],w=2*s[t+2];return n.moveTo(i[f],i[f+1]),n.lineTo(i[v],i[v+1]),n.lineTo(i[w],i[w+1]),n.closePath(),r&&r.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,r=t.length/3;n<r;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new I3;return this.renderTriangle(t,n),n.value()}}function R3(e){Ft.call(this,null,e)}R3.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const Dj=[-1e5,-1e5,1e5,1e5];function Tj(e){const t=e[0][0],n=e[0][1];let r=e.length-1;for(;e[r][0]===t&&e[r][1]===n;--r);return"M"+e.slice(0,r+1).join("L")+"Z"}Object(we.z)(R3,Ft,{transform(e,t){const n=e.as||"path",r=t.source;if(!r||!r.length)return t;let i=e.size;i=i?[0,0,i[0],i[1]]:(i=e.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:Dj;const s=this.value=F3.from(r,e.x,e.y).voronoi(i);for(let f=0,v=r.length;f<v;++f){const w=s.cellPolygon(f);r[f][n]=w?Tj(w):null}return t.reflow(e.modified()).modifies(n)}});var M3=Math.PI/180,xx=64,Lw=2048;function Nj(){var e,t,n,r,i,s,f,v=[256,256],w=gD,O=[],N=Math.random,L={};function Y(ie,fe,ve){for(var Be,We,Ve,ct=fe.x,lt=fe.y,mt=Math.sqrt(v[0]*v[0]+v[1]*v[1]),dt=w(v),kt=N()<.5?1:-1,wt=-kt;(Be=dt(wt+=kt))&&(We=~~Be[0],Ve=~~Be[1],!(Math.min(Math.abs(We),Math.abs(Ve))>=mt));)if(fe.x=ct+We,fe.y=lt+Ve,!(fe.x+fe.x0<0||fe.y+fe.y0<0||fe.x+fe.x1>v[0]||fe.y+fe.y1>v[1])&&(!ve||!Fj(fe,ie,v[0]))&&(!ve||Mj(fe,ve))){for(var dn,Dn=fe.sprite,wn=fe.width>>5,Xn=v[0]>>5,Kn=fe.x-(wn<<4),ir=127&Kn,sr=32-ir,gr=fe.y1-fe.y0,Vr=(fe.y+fe.y0)*Xn+(Kn>>5),hi=0;hi<gr;hi++){dn=0;for(var Qr=0;Qr<=wn;Qr++)ie[Vr+Qr]|=dn<<sr|(Qr<wn?(dn=Dn[hi*wn+Qr])>>>ir:0);Vr+=Xn}return fe.sprite=null,!0}return!1}return L.layout=function(){for(var ie=function(mt){mt.width=mt.height=1;var dt=Math.sqrt(mt.getContext("2d").getImageData(0,0,1,1).data.length>>2);mt.width=(xx<<5)/dt,mt.height=Lw/dt;var kt=mt.getContext("2d");return kt.fillStyle=kt.strokeStyle="red",kt.textAlign="center",{context:kt,ratio:dt}}(Mu()),fe=function(mt){for(var dt=[],kt=-1;++kt<mt;)dt[kt]=0;return dt}((v[0]>>5)*v[1]),ve=null,Be=O.length,We=-1,Ve=[],ct=O.map(mt=>({text:e(mt),font:t(mt),style:r(mt),weight:i(mt),rotate:s(mt),size:~~(n(mt)+1e-14),padding:f(mt),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:mt})).sort((mt,dt)=>dt.size-mt.size);++We<Be;){var lt=ct[We];lt.x=v[0]*(N()+.5)>>1,lt.y=v[1]*(N()+.5)>>1,Ij(ie,lt,ct,We),lt.hasText&&Y(fe,lt,ve)&&(Ve.push(lt),ve?Rj(ve,lt):ve=[{x:lt.x+lt.x0,y:lt.y+lt.y0},{x:lt.x+lt.x1,y:lt.y+lt.y1}],lt.x-=v[0]>>1,lt.y-=v[1]>>1)}return Ve},L.words=function(ie){return arguments.length?(O=ie,L):O},L.size=function(ie){return arguments.length?(v=[+ie[0],+ie[1]],L):v},L.font=function(ie){return arguments.length?(t=my(ie),L):t},L.fontStyle=function(ie){return arguments.length?(r=my(ie),L):r},L.fontWeight=function(ie){return arguments.length?(i=my(ie),L):i},L.rotate=function(ie){return arguments.length?(s=my(ie),L):s},L.text=function(ie){return arguments.length?(e=my(ie),L):e},L.spiral=function(ie){return arguments.length?(w=jj[ie]||ie,L):w},L.fontSize=function(ie){return arguments.length?(n=my(ie),L):n},L.padding=function(ie){return arguments.length?(f=my(ie),L):f},L.random=function(ie){return arguments.length?(N=ie,L):N},L}function Ij(e,t,n,r){if(!t.sprite){var i=e.context,s=e.ratio;i.clearRect(0,0,(xx<<5)/s,Lw/s);var f,v,w,O,N,L=0,Y=0,ie=0,fe=n.length;for(--r;++r<fe;){if(t=n[r],i.save(),i.font=t.style+" "+t.weight+" "+~~((t.size+1)/s)+"px "+t.font,f=i.measureText(t.text+"m").width*s,w=t.size<<1,t.rotate){var ve=Math.sin(t.rotate*M3),Be=Math.cos(t.rotate*M3),We=f*Be,Ve=f*ve,ct=w*Be,lt=w*ve;f=Math.max(Math.abs(We+lt),Math.abs(We-lt))+31>>5<<5,w=~~Math.max(Math.abs(Ve+ct),Math.abs(Ve-ct))}else f=f+31>>5<<5;if(w>ie&&(ie=w),L+f>=xx<<5&&(L=0,Y+=ie,ie=0),Y+w>=Lw)break;i.translate((L+(f>>1))/s,(Y+(w>>1))/s),t.rotate&&i.rotate(t.rotate*M3),i.fillText(t.text,0,0),t.padding&&(i.lineWidth=2*t.padding,i.strokeText(t.text,0,0)),i.restore(),t.width=f,t.height=w,t.xoff=L,t.yoff=Y,t.x1=f>>1,t.y1=w>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,L+=f}for(var mt=i.getImageData(0,0,(xx<<5)/s,Lw/s).data,dt=[];--r>=0;)if((t=n[r]).hasText){for(v=(f=t.width)>>5,w=t.y1-t.y0,O=0;O<w*v;O++)dt[O]=0;if((L=t.xoff)==null)return;Y=t.yoff;var kt=0,wt=-1;for(N=0;N<w;N++){for(O=0;O<f;O++){var dn=v*N+(O>>5),Dn=mt[(Y+N)*(xx<<5)+(L+O)<<2]?1<<31-O%32:0;dt[dn]|=Dn,kt|=Dn}kt?wt=N:(t.y0++,w--,N--,Y++)}t.y1=t.y0+wt,t.sprite=dt.slice(0,(t.y1-t.y0)*v)}}}function Fj(e,t,n){n>>=5;for(var r,i=e.sprite,s=e.width>>5,f=e.x-(s<<4),v=127&f,w=32-v,O=e.y1-e.y0,N=(e.y+e.y0)*n+(f>>5),L=0;L<O;L++){r=0;for(var Y=0;Y<=s;Y++)if((r<<w|(Y<s?(r=i[L*s+Y])>>>v:0))&t[N+Y])return!0;N+=n}return!1}function Rj(e,t){var n=e[0],r=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>r.x&&(r.x=t.x+t.x1),t.y+t.y1>r.y&&(r.y=t.y+t.y1)}function Mj(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function gD(e){var t=e[0]/e[1];return function(n){return[t*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function my(e){return typeof e=="function"?e:function(){return e}}var jj={archimedean:gD,rectangular:function(e){var t=4*e[0]/e[1],n=0,r=0;return function(i){var s=i<0?-1:1;switch(Math.sqrt(1+4*s*i)-s&3){case 0:n+=t;break;case 1:r+=4;break;case 2:n-=t;break;default:r-=4}return[n,r]}}};const vD=["x","y","font","fontSize","fontStyle","fontWeight","angle"],Bj=["text","font","rotate","fontSize","fontStyle","fontWeight"];function j3(e){Ft.call(this,Nj(),e)}j3.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:vD}]},Object(we.z)(j3,Ft,{transform(e,t){!e.size||e.size[0]&&e.size[1]||Object(we.o)("Wordcloud size dimensions must be non-zero.");const n=e.modified();if(!(n||t.changed(t.ADD_REM)||Bj.some(function(ie){const fe=e[ie];return Object(we.E)(fe)&&t.modified(fe.fields)})))return;const r=t.materialize(t.SOURCE).source,i=this.value,s=e.as||vD;let f,v=e.fontSize||14;if(Object(we.E)(v)?f=e.fontSizeRange:v=Object(we.m)(v),f){const ie=v,fe=Ra("sqrt")().domain(Object(we.q)(r,ie)).range(f);v=ve=>fe(ie(ve))}r.forEach(ie=>{ie[s[0]]=NaN,ie[s[1]]=NaN,ie[s[3]]=0});const w=i.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(v).random(qn).layout(),O=i.size(),N=O[0]>>1,L=O[1]>>1,Y=w.length;for(let ie,fe,ve=0;ve<Y;++ve)(fe=(ie=w[ve]).datum)[s[0]]=ie.x+N,fe[s[1]]=ie.y+L,fe[s[2]]=ie.font,fe[s[3]]=ie.size,fe[s[4]]=ie.style,fe[s[5]]=ie.weight,fe[s[6]]=ie.rotate;return t.reflow(n).modifies(s)}});var Pj=function(e,t){return Array.from(t,n=>e[n])};const Lj=e=>new Uint8Array(e),zj=e=>new Uint16Array(e),wx=e=>new Uint32Array(e);function zw(e,t,n){const r=(t<257?Lj:t<65537?zj:wx)(e);return n&&r.set(n),r}function yD(e,t,n){const r=1<<t;return{one:r,zero:~r,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(i,s){const f=this.bisect(this.range,i.value),v=i.index,w=f[0],O=f[1],N=v.length;let L;for(L=0;L<w;++L)s[v[L]]|=r;for(L=O;L<N;++L)s[v[L]]|=r;return this}}}function bD(){let e=wx(0),t=[],n=0;return{insert:function(r,i,s){if(!i.length)return[];const f=n,v=i.length,w=wx(v);let O,N,L,Y=Array(v);for(L=0;L<v;++L)Y[L]=r(i[L]),w[L]=L;if(Y=function(ie,fe){return ie.sort.call(fe,(ve,Be)=>{const We=ie[ve],Ve=ie[Be];return We<Ve?-1:We>Ve?1:0}),Pj(ie,fe)}(Y,w),f)O=t,N=e,t=Array(f+v),e=wx(f+v),function(ie,fe,ve,Be,We,Ve,ct,lt,mt){let dt,kt=0,wt=0;for(dt=0;kt<Be&&wt<ct;++dt)fe[kt]<We[wt]?(lt[dt]=fe[kt],mt[dt]=ve[kt++]):(lt[dt]=We[wt],mt[dt]=Ve[wt++]+ie);for(;kt<Be;++kt,++dt)lt[dt]=fe[kt],mt[dt]=ve[kt];for(;wt<ct;++wt,++dt)lt[dt]=We[wt],mt[dt]=Ve[wt]+ie}(s,O,N,f,Y,w,v,t,e);else{if(s>0)for(L=0;L<v;++L)w[L]+=s;t=Y,e=w}return n=f+v,{index:w,value:Y}},remove:function(r,i){const s=n;let f,v,w;for(v=0;!i[e[v]]&&v<s;++v);for(w=v;v<s;++v)i[f=e[v]]||(e[w]=f,t[w]=t[v],++w);n=s-r},bisect:function(r,i){let s;return i?s=i.length:(i=t,s=n),[ju(i,r[0],0,s),js(i,r[1],0,s)]},reindex:function(r){for(let i=0,s=n;i<s;++i)e[i]=r[e[i]]},index:()=>e,size:()=>n}}function B3(e){Ft.call(this,function(){let t=8,n=[],r=wx(0),i=zw(0,t),s=zw(0,t);return{data:()=>n,seen:()=>r=function(f,v,w){return f.length>=v?f:((w=w||new f.constructor(v)).set(f),w)}(r,n.length),add(f){for(let v,w=0,O=n.length,N=f.length;w<N;++w)(v=f[w])._index=O++,n.push(v)},remove(f,v){const w=n.length,O=Array(w-f),N=n;let L,Y,ie;for(Y=0;!v[Y]&&Y<w;++Y)O[Y]=n[Y],N[Y]=Y;for(ie=Y;Y<w;++Y)L=n[Y],v[Y]?N[Y]=-1:(N[Y]=ie,i[ie]=i[Y],s[ie]=s[Y],O[ie]=L,L._index=ie++),i[Y]=0;return n=O,N},size:()=>n.length,curr:()=>i,prev:()=>s,reset:f=>s[f]=i[f],all:()=>t<257?255:t<65537?65535:4294967295,set(f,v){i[f]|=v},clear(f,v){i[f]&=~v},resize(f,v){(f>i.length||v>t)&&(t=Math.max(v,t),i=zw(f,t,i),s=zw(f,t))}}}(),e),this._indices=null,this._dims=null}function P3(e){Ft.call(this,null,e)}B3.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},Object(we.z)(B3,Ft,{transform(e,t){return this._dims?e.modified("fields")||e.fields.some(n=>t.modified(n.fields))?this.reinit(e,t):this.eval(e,t):this.init(e,t)},init(e,t){const n=e.fields,r=e.query,i=this._indices={},s=this._dims=[],f=r.length;let v,w,O=0;for(;O<f;++O)w=i[v=n[O].fname]||(i[v]=bD()),s.push(yD(w,O,r[O]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),r=e.fields,i=e.query,s=this._indices,f=this._dims,v=this.value,w=v.curr(),O=v.prev(),N=v.all(),L=n.rem=n.add,Y=n.mod,ie=i.length,fe={};let ve,Be,We,Ve,ct,lt,mt,dt,kt;if(O.set(w),t.rem.length&&(ct=this.remove(e,t,n)),t.add.length&&v.add(t.add),t.mod.length)for(lt={},mt=0,dt=(Ve=t.mod).length;mt<dt;++mt)lt[Ve[mt]._index]=1;for(mt=0;mt<ie;++mt)kt=r[mt],(!f[mt]||e.modified("fields",mt)||t.modified(kt.fields))&&((ve=fe[We=kt.fname])||(s[We]=Be=bD(),fe[We]=ve=Be.insert(kt,t.source,0)),f[mt]=yD(Be,mt,i[mt]).onAdd(ve,w));for(mt=0,dt=v.data().length;mt<dt;++mt)ct[mt]||(O[mt]!==w[mt]?L.push(mt):lt[mt]&&w[mt]!==N&&Y.push(mt));return v.mask=(1<<ie)-1,n},eval(e,t){const n=t.materialize().fork(),r=this._dims.length;let i=0;return t.rem.length&&(this.remove(e,t,n),i|=(1<<r)-1),e.modified("query")&&!e.modified("fields")&&(i|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),i|=(1<<r)-1),t.mod.length&&(this.modify(t,n),i|=(1<<r)-1),this.value.mask=i,n},insert(e,t,n){const r=t.add,i=this.value,s=this._dims,f=this._indices,v=e.fields,w={},O=n.add,N=i.size()+r.length,L=s.length;let Y,ie,fe,ve=i.size();i.resize(N,L),i.add(r);const Be=i.curr(),We=i.prev(),Ve=i.all();for(Y=0;Y<L;++Y)fe=w[ie=v[Y].fname]||(w[ie]=f[ie].insert(v[Y],r,ve)),s[Y].onAdd(fe,Be);for(;ve<N;++ve)We[ve]=Ve,Be[ve]!==Ve&&O.push(ve)},modify(e,t){const n=t.mod,r=this.value,i=r.curr(),s=r.all(),f=e.mod;let v,w,O;for(v=0,w=f.length;v<w;++v)i[O=f[v]._index]!==s&&n.push(O)},remove(e,t,n){const r=this._indices,i=this.value,s=i.curr(),f=i.prev(),v=i.all(),w={},O=n.rem,N=t.rem;let L,Y,ie,fe;for(L=0,Y=N.length;L<Y;++L)w[ie=N[L]._index]=1,f[ie]=fe=s[ie],s[ie]=v,fe!==v&&O.push(ie);for(ie in r)r[ie].remove(Y,w);return this.reindex(t,Y,w),w},reindex(e,t,n){const r=this._indices,i=this.value;e.runAfter(()=>{const s=i.remove(t,n);for(const f in r)r[f].reindex(s)})},update(e,t,n){const r=this._dims,i=e.query,s=t.stamp,f=r.length;let v,w,O=0;for(n.filters=0,w=0;w<f;++w)e.modified("query",w)&&(v=w,++O);if(O===1)O=r[v].one,this.incrementOne(r[v],i[v],n.add,n.rem);else for(w=0,O=0;w<f;++w)e.modified("query",w)&&(O|=r[w].one,this.incrementAll(r[w],i[w],s,n.add),n.rem=n.add);return O},incrementAll(e,t,n,r){const i=this.value,s=i.seen(),f=i.curr(),v=i.prev(),w=e.index(),O=e.bisect(e.range),N=e.bisect(t),L=N[0],Y=N[1],ie=O[0],fe=O[1],ve=e.one;let Be,We,Ve;if(L<ie)for(Be=L,We=Math.min(ie,Y);Be<We;++Be)s[Ve=w[Be]]!==n&&(v[Ve]=f[Ve],s[Ve]=n,r.push(Ve)),f[Ve]^=ve;else if(L>ie)for(Be=ie,We=Math.min(L,fe);Be<We;++Be)s[Ve=w[Be]]!==n&&(v[Ve]=f[Ve],s[Ve]=n,r.push(Ve)),f[Ve]^=ve;if(Y>fe)for(Be=Math.max(L,fe),We=Y;Be<We;++Be)s[Ve=w[Be]]!==n&&(v[Ve]=f[Ve],s[Ve]=n,r.push(Ve)),f[Ve]^=ve;else if(Y<fe)for(Be=Math.max(ie,Y),We=fe;Be<We;++Be)s[Ve=w[Be]]!==n&&(v[Ve]=f[Ve],s[Ve]=n,r.push(Ve)),f[Ve]^=ve;e.range=t.slice()},incrementOne(e,t,n,r){const i=this.value.curr(),s=e.index(),f=e.bisect(e.range),v=e.bisect(t),w=v[0],O=v[1],N=f[0],L=f[1],Y=e.one;let ie,fe,ve;if(w<N)for(ie=w,fe=Math.min(N,O);ie<fe;++ie)i[ve=s[ie]]^=Y,n.push(ve);else if(w>N)for(ie=N,fe=Math.min(w,L);ie<fe;++ie)i[ve=s[ie]]^=Y,r.push(ve);if(O>L)for(ie=Math.max(w,L),fe=O;ie<fe;++ie)i[ve=s[ie]]^=Y,n.push(ve);else if(O<L)for(ie=Math.max(N,O),fe=L;ie<fe;++ie)i[ve=s[ie]]^=Y,r.push(ve);e.range=t.slice()}}),P3.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},Object(we.z)(P3,Ft,{transform(e,t){const n=~(e.ignore||0),r=e.filter,i=r.mask;if((i&n)==0)return t.StopPropagation;const s=t.fork(t.ALL),f=r.data(),v=r.curr(),w=r.prev(),O=N=>v[N]&n?null:f[N];return s.filter(s.MOD,O),i&i-1?(s.filter(s.ADD,N=>{const L=v[N]&n;return!L&&L^w[N]&n?f[N]:null}),s.filter(s.REM,N=>{const L=v[N]&n;return L&&!(L^L^w[N]&n)?f[N]:null})):(s.filter(s.ADD,O),s.filter(s.REM,N=>(v[N]&n)===i?f[N]:null)),s.filter(s.SOURCE,N=>O(N._index))}});const Uj="RawCode",pb="Literal",Wj="Property",Vj="Identifier",qj="ArrayExpression",Hj="BinaryExpression",xD="CallExpression",Gj="ConditionalExpression",$j="LogicalExpression",Kj="MemberExpression",Xj="ObjectExpression",Yj="UnaryExpression";function nv(e){this.type=e}var e1,vo,ei,Op,Hu;nv.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(n=0,r=(t=function(i){switch(i.type){case qj:return i.elements;case Hj:case $j:return[i.left,i.right];case xD:return[i.callee].concat(i.arguments);case Gj:return[i.test,i.consequent,i.alternate];case Kj:return[i.object,i.property];case Xj:return i.properties;case Wj:return[i.key,i.value];case Yj:return[i.argument];case Vj:case pb:case Uj:default:return[]}}(this)).length;n<r;++n)if(t[n].visit(e))return 1};var Uw=1,kx=2,gy=3,M1=4,Ww=5,vy=6,gg=7,_x=8;(e1={})[Uw]="Boolean",e1[kx]="<end>",e1[gy]="Identifier",e1[M1]="Keyword",e1[Ww]="Null",e1[vy]="Numeric",e1[gg]="Punctuator",e1[_x]="String",e1[9]="RegularExpression";var Jj="ArrayExpression",Qj="BinaryExpression",Zj="CallExpression",e9="ConditionalExpression",wD="Identifier",t9="Literal",n9="LogicalExpression",r9="MemberExpression",i9="ObjectExpression",o9="Property",a9="UnaryExpression",fd="Unexpected token %0",s9="Unexpected number",u9="Unexpected string",c9="Unexpected identifier",l9="Unexpected reserved word",f9="Unexpected end of input",L3="Invalid regular expression",z3="Invalid regular expression: missing /",kD="Octal literals are not allowed in strict mode.",h9="Duplicate data property in object literal not allowed in strict mode",qd="ILLEGAL",Ex="Disabled.",d9=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),p9=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function Vw(e,t){if(!e)throw new Error("ASSERT: "+t)}function t1(e){return e>=48&&e<=57}function U3(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function Cx(e){return"01234567".indexOf(e)>=0}function m9(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Ax(e){return e===10||e===13||e===8232||e===8233}function Ox(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&d9.test(String.fromCharCode(e))}function qw(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&p9.test(String.fromCharCode(e))}const g9={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function _D(){for(;ei<Op;){const e=vo.charCodeAt(ei);if(!m9(e)&&!Ax(e))break;++ei}}function W3(e){var t,n,r,i=0;for(n=e==="u"?4:2,t=0;t<n;++t)ei<Op&&U3(vo[ei])?(r=vo[ei++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):su({},fd,qd);return String.fromCharCode(i)}function v9(){var e,t,n,r;for(t=0,(e=vo[ei])==="}"&&su({},fd,qd);ei<Op&&U3(e=vo[ei++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&su({},fd,qd),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function ED(){var e,t;for(e=vo.charCodeAt(ei++),t=String.fromCharCode(e),e===92&&(vo.charCodeAt(ei)!==117&&su({},fd,qd),++ei,(e=W3("u"))&&e!=="\\"&&Ox(e.charCodeAt(0))||su({},fd,qd),t=e);ei<Op&&qw(e=vo.charCodeAt(ei));)++ei,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),vo.charCodeAt(ei)!==117&&su({},fd,qd),++ei,(e=W3("u"))&&e!=="\\"&&qw(e.charCodeAt(0))||su({},fd,qd),t+=e);return t}function y9(){var e,t;return e=ei,{type:(t=vo.charCodeAt(ei)===92?ED():function(){var n,r;for(n=ei++;ei<Op;){if((r=vo.charCodeAt(ei))===92)return ei=n,ED();if(!qw(r))break;++ei}return vo.slice(n,ei)}()).length===1?gy:g9.hasOwnProperty(t)?M1:t==="null"?Ww:t==="true"||t==="false"?Uw:gy,value:t,start:e,end:ei}}function V3(){var e,t,n,r,i=ei,s=vo.charCodeAt(ei),f=vo[ei];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++ei,{type:gg,value:String.fromCharCode(s),start:i,end:ei};default:if((e=vo.charCodeAt(ei+1))===61)switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return ei+=2,{type:gg,value:String.fromCharCode(s)+String.fromCharCode(e),start:i,end:ei};case 33:case 61:return ei+=2,vo.charCodeAt(ei)===61&&++ei,{type:gg,value:vo.slice(i,ei),start:i,end:ei}}}return(r=vo.substr(ei,4))===">>>="?{type:gg,value:r,start:i,end:ei+=4}:(n=r.substr(0,3))===">>>"||n==="<<="||n===">>="?{type:gg,value:n,start:i,end:ei+=3}:f===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(f)>=0||t==="=>"?{type:gg,value:t,start:i,end:ei+=2}:(t==="//"&&su({},fd,qd),"<>=!+-*%&|^/".indexOf(f)>=0?{type:gg,value:f,start:i,end:++ei}:void su({},fd,qd))}function CD(){var e,t,n;if(Vw(t1((n=vo[ei]).charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=ei,e="",n!=="."){if(e=vo[ei++],n=vo[ei],e==="0"){if(n==="x"||n==="X")return++ei,function(r){let i="";for(;ei<Op&&U3(vo[ei]);)i+=vo[ei++];return i.length===0&&su({},fd,qd),Ox(vo.charCodeAt(ei))&&su({},fd,qd),{type:vy,value:parseInt("0x"+i,16),start:r,end:ei}}(t);if(Cx(n))return function(r){let i="0"+vo[ei++];for(;ei<Op&&Cx(vo[ei]);)i+=vo[ei++];return(Ox(vo.charCodeAt(ei))||t1(vo.charCodeAt(ei)))&&su({},fd,qd),{type:vy,value:parseInt(i,8),octal:!0,start:r,end:ei}}(t);n&&t1(n.charCodeAt(0))&&su({},fd,qd)}for(;t1(vo.charCodeAt(ei));)e+=vo[ei++];n=vo[ei]}if(n==="."){for(e+=vo[ei++];t1(vo.charCodeAt(ei));)e+=vo[ei++];n=vo[ei]}if(n==="e"||n==="E")if(e+=vo[ei++],(n=vo[ei])!=="+"&&n!=="-"||(e+=vo[ei++]),t1(vo.charCodeAt(ei)))for(;t1(vo.charCodeAt(ei));)e+=vo[ei++];else su({},fd,qd);return Ox(vo.charCodeAt(ei))&&su({},fd,qd),{type:vy,value:parseFloat(e),start:t,end:ei}}function b9(){var e,t,n,r;return Hu=null,_D(),e=ei,t=function(){var i,s,f,v;for(Vw((i=vo[ei])==="/","Regular expression literal must start with a slash"),s=vo[ei++],f=!1,v=!1;ei<Op;)if(s+=i=vo[ei++],i==="\\")Ax((i=vo[ei++]).charCodeAt(0))&&su({},z3),s+=i;else if(Ax(i.charCodeAt(0)))su({},z3);else if(f)i==="]"&&(f=!1);else{if(i==="/"){v=!0;break}i==="["&&(f=!0)}return v||su({},z3),{value:s.substr(1,s.length-2),literal:s}}(),n=function(){var i,s,f;for(s="",f="";ei<Op&&qw((i=vo[ei]).charCodeAt(0));)++ei,i==="\\"&&ei<Op?su({},fd,qd):(f+=i,s+=i);return f.search(/[^gimuy]/g)>=0&&su({},L3,f),{value:f,literal:s}}(),r=function(i,s){let f=i;s.indexOf("u")>=0&&(f=f.replace(/\\u\{([0-9a-fA-F]+)\}/g,(v,w)=>{if(parseInt(w,16)<=1114111)return"x";su({},L3)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(f)}catch{su({},L3)}try{return new RegExp(i,s)}catch{return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:ei}}function AD(){if(_D(),ei>=Op)return{type:kx,start:ei,end:ei};const e=vo.charCodeAt(ei);return Ox(e)?y9():e===40||e===41||e===59?V3():e===39||e===34?function(){var t,n,r,i,s="",f=!1;for(Vw((t=vo[ei])==="'"||t==='"',"String literal must starts with a quote"),n=ei,++ei;ei<Op;){if((r=vo[ei++])===t){t="";break}if(r==="\\")if((r=vo[ei++])&&Ax(r.charCodeAt(0)))r==="\r"&&vo[ei]===`
`&&++ei;else switch(r){case"u":case"x":vo[ei]==="{"?(++ei,s+=v9()):s+=W3(r);break;case"n":s+=`
`;break;case"r":s+="\r";break;case"t":s+="	";break;case"b":s+="\b";break;case"f":s+="\f";break;case"v":s+="\v";break;default:Cx(r)?((i="01234567".indexOf(r))!==0&&(f=!0),ei<Op&&Cx(vo[ei])&&(f=!0,i=8*i+"01234567".indexOf(vo[ei++]),"0123".indexOf(r)>=0&&ei<Op&&Cx(vo[ei])&&(i=8*i+"01234567".indexOf(vo[ei++]))),s+=String.fromCharCode(i)):s+=r}else{if(Ax(r.charCodeAt(0)))break;s+=r}}return t!==""&&su({},fd,qd),{type:_x,value:s,octal:f,start:n,end:ei}}():e===46?t1(vo.charCodeAt(ei+1))?CD():V3():t1(e)?CD():V3()}function vg(){const e=Hu;return ei=e.end,Hu=AD(),ei=e.end,e}function OD(){const e=ei;Hu=AD(),ei=e}function SD(e,t,n){const r=new nv(e==="||"||e==="&&"?n9:Qj);return r.operator=e,r.left=t,r.right=n,r}function x9(e,t){const n=new nv(Zj);return n.callee=e,n.arguments=t,n}function q3(e){const t=new nv(wD);return t.name=e,t}function Sx(e){const t=new nv(t9);return t.value=e.value,t.raw=vo.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function DD(e,t,n){const r=new nv(r9);return r.computed=e==="[",r.object=t,r.property=n,r.computed||(n.member=!0),r}function TD(e,t,n){const r=new nv(o9);return r.key=t,r.value=n,r.kind=e,r}function su(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(s,f)=>(Vw(f<r.length,"Message reference must be in range"),r[f]));throw(n=new Error(i)).index=ei,n.description=i,n}function Hw(e){e.type===kx&&su(e,f9),e.type===vy&&su(e,s9),e.type===_x&&su(e,u9),e.type===gy&&su(e,c9),e.type===M1&&su(e,l9),su(e,fd,e.value)}function Sp(e){const t=vg();t.type===gg&&t.value===e||Hw(t)}function Vc(e){return Hu.type===gg&&Hu.value===e}function H3(e){return Hu.type===M1&&Hu.value===e}function w9(){const e=[];for(ei=Hu.start,Sp("[");!Vc("]");)Vc(",")?(vg(),e.push(null)):(e.push(yy()),Vc("]")||Sp(","));return vg(),function(t){const n=new nv(Jj);return n.elements=t,n}(e)}function ND(){ei=Hu.start;const e=vg();return e.type===_x||e.type===vy?(e.octal&&su(e,kD),Sx(e)):q3(e.value)}function k9(){var e,t,n;return ei=Hu.start,(e=Hu).type===gy?(n=ND(),Sp(":"),TD("init",n,yy())):e.type!==kx&&e.type!==gg?(t=ND(),Sp(":"),TD("init",t,yy())):void Hw(e)}function _9(){var e,t,n=[],r={},i=String;for(ei=Hu.start,Sp("{");!Vc("}");)t="$"+((e=k9()).key.type===wD?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?su({},h9):r[t]=!0,n.push(e),Vc("}")||Sp(",");return Sp("}"),function(s){const f=new nv(i9);return f.properties=s,f}(n)}const E9={if:1};function C9(){var e,t,n;if(Vc("("))return function(){Sp("(");const r=G3();return Sp(")"),r}();if(Vc("["))return w9();if(Vc("{"))return _9();if(e=Hu.type,ei=Hu.start,e===gy||E9[Hu.value])n=q3(vg().value);else if(e===_x||e===vy)Hu.octal&&su(Hu,kD),n=Sx(vg());else{if(e===M1)throw new Error(Ex);e===Uw?((t=vg()).value=t.value==="true",n=Sx(t)):e===Ww?((t=vg()).value=null,n=Sx(t)):Vc("/")||Vc("/=")?(n=Sx(b9()),OD()):Hw(vg())}return n}function A9(){const e=[];if(Sp("("),!Vc(")"))for(;ei<Op&&(e.push(yy()),!Vc(")"));)Sp(",");return Sp(")"),e}function O9(){ei=Hu.start;const e=vg();return function(t){return t.type===gy||t.type===M1||t.type===Uw||t.type===Ww}(e)||Hw(e),q3(e.value)}function S9(){Sp("[");const e=G3();return Sp("]"),e}function ID(){const e=function(){var t;for(t=C9();;)if(Vc("."))Sp("."),t=DD(".",t,O9());else if(Vc("("))t=x9(t,A9());else{if(!Vc("["))break;t=DD("[",t,S9())}return t}();if(Hu.type===gg&&(Vc("++")||Vc("--")))throw new Error(Ex);return e}function Gw(){var e,t;if(Hu.type!==gg&&Hu.type!==M1)t=ID();else{if(Vc("++")||Vc("--"))throw new Error(Ex);if(Vc("+")||Vc("-")||Vc("~")||Vc("!"))e=vg(),t=Gw(),t=function(n,r){const i=new nv(a9);return i.operator=n,i.argument=r,i.prefix=!0,i}(e.value,t);else{if(H3("delete")||H3("void")||H3("typeof"))throw new Error(Ex);t=ID()}}return t}function FD(e){let t=0;if(e.type!==gg&&e.type!==M1)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function yy(){var e,t;return e=function(){var n,r,i,s,f,v,w,O,N,L;if(n=Hu,N=Gw(),(f=FD(s=Hu))===0)return N;for(s.prec=f,vg(),r=[n,Hu],v=[N,s,w=Gw()];(f=FD(Hu))>0;){for(;v.length>2&&f<=v[v.length-2].prec;)w=v.pop(),O=v.pop().value,N=v.pop(),r.pop(),i=SD(O,N,w),v.push(i);(s=vg()).prec=f,v.push(s),r.push(Hu),i=Gw(),v.push(i)}for(i=v[L=v.length-1],r.pop();L>1;)r.pop(),i=SD(v[L-1].value,v[L-2],i),L-=2;return i}(),Vc("?")&&(vg(),t=yy(),Sp(":"),e=function(n,r,i){const s=new nv(e9);return s.test=n,s.consequent=r,s.alternate=i,s}(e,t,yy())),e}function G3(){const e=yy();if(Vc(","))throw new Error(Ex);return e}var RD={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function MD(e){function t(r,i,s){return f=>function(v,w,O,N){let L=e(w[0]);return O&&(L=O+"("+L+")",O.lastIndexOf("new ",0)===0&&(L="("+L+")")),L+"."+v+(N<0?"":N===0?"()":"("+w.slice(1).map(e).join(",")+")")}(r,f,i,s)}const n="new Date";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(r){r.length<3&&Object(we.o)("Missing arguments to clamp function."),r.length>3&&Object(we.o)("Too many arguments to clamp function.");const i=r.map(e);return"Math.max("+i[1]+", Math.min("+i[2]+","+i[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase","String",0),lower:t("toLowerCase","String",0),substring:t("substring","String"),split:t("split","String"),trim:t("trim","String",0),regexp:"RegExp",test:t("test","RegExp"),if:function(r){r.length<3&&Object(we.o)("Missing arguments to if function."),r.length>3&&Object(we.o)("Too many arguments to if function.");const i=r.map(e);return"("+i[0]+"?"+i[1]+":"+i[2]+")"}}}var jD,BD,$3,K3,X3,$w=new xm,Kw=new xm,Dv={point:Vd,lineStart:Vd,lineEnd:Vd,polygonStart:function(){$w=new xm,Dv.lineStart=D9,Dv.lineEnd=T9},polygonEnd:function(){var e=+$w;Kw.add(e<0?wm+e:e),this.lineStart=this.lineEnd=this.point=Vd},sphere:function(){Kw.add(wm)}};function D9(){Dv.point=N9}function T9(){PD(jD,BD)}function N9(e,t){Dv.point=PD,jD=e,BD=t,$3=e*=us,K3=Xo(t=(t*=us)/2+ew),X3=Mo(t)}function PD(e,t){t=(t*=us)/2+ew;var n=(e*=us)-$3,r=n>=0?1:-1,i=r*n,s=Xo(t),f=Mo(t),v=X3*f,w=K3*s+v*Xo(i),O=v*r*Mo(i);$w.add(M0(O,w)),$3=e,K3=s,X3=f}var Al,yg,Yl,t0,by,LD,zD,mb,Dx,j1,n1,r1={point:Y3,lineStart:WD,lineEnd:VD,polygonStart:function(){r1.point=qD,r1.lineStart=I9,r1.lineEnd=F9,Dx=new xm,Dv.polygonStart()},polygonEnd:function(){Dv.polygonEnd(),r1.point=Y3,r1.lineStart=WD,r1.lineEnd=VD,$w<0?(Al=-(Yl=180),yg=-(t0=90)):Dx>Go?t0=90:Dx<-Go&&(yg=-90),n1[0]=Al,n1[1]=Yl},sphere:function(){Al=-(Yl=180),yg=-(t0=90)}};function Y3(e,t){j1.push(n1=[Al=e,Yl=e]),t<yg&&(yg=t),t>t0&&(t0=t)}function UD(e,t){var n=fy([e*us,t*us]);if(mb){var r=ab(mb,n),i=ab([r[1],-r[0],0],r);pw(i),i=fw(i);var s,f=e-by,v=f>0?1:-1,w=i[0]*kf*v,O=zs(f)>180;O^(v*by<w&&w<v*e)?(s=i[1]*kf)>t0&&(t0=s):O^(v*by<(w=(w+360)%360-180)&&w<v*e)?(s=-i[1]*kf)<yg&&(yg=s):(t<yg&&(yg=t),t>t0&&(t0=t)),O?e<by?n0(Al,e)>n0(Al,Yl)&&(Yl=e):n0(e,Yl)>n0(Al,Yl)&&(Al=e):Yl>=Al?(e<Al&&(Al=e),e>Yl&&(Yl=e)):e>by?n0(Al,e)>n0(Al,Yl)&&(Yl=e):n0(e,Yl)>n0(Al,Yl)&&(Al=e)}else j1.push(n1=[Al=e,Yl=e]);t<yg&&(yg=t),t>t0&&(t0=t),mb=n,by=e}function WD(){r1.point=UD}function VD(){n1[0]=Al,n1[1]=Yl,r1.point=Y3,mb=null}function qD(e,t){if(mb){var n=e-by;Dx.add(zs(n)>180?n+(n>0?360:-360):n)}else LD=e,zD=t;Dv.point(e,t),UD(e,t)}function I9(){Dv.lineStart()}function F9(){qD(LD,zD),Dv.lineEnd(),zs(Dx)>Go&&(Al=-(Yl=180)),n1[0]=Al,n1[1]=Yl,mb=null}function n0(e,t){return(t-=e)<0?t+360:t}function R9(e,t){return e[0]-t[0]}function HD(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var Xw,Yw,Jw,Qw,Zw,ek,tk,nk,J3,Q3,Z3,GD,$D,Om,Sm,Dm,rv={sphere:Vd,point:eC,lineStart:KD,lineEnd:XD,polygonStart:function(){rv.lineStart=B9,rv.lineEnd=P9},polygonEnd:function(){rv.lineStart=KD,rv.lineEnd=XD}};function eC(e,t){e*=us;var n=Xo(t*=us);Tx(n*Xo(e),n*Mo(e),Mo(t))}function Tx(e,t,n){Jw+=(e-Jw)/++Xw,Qw+=(t-Qw)/Xw,Zw+=(n-Zw)/Xw}function KD(){rv.point=M9}function M9(e,t){e*=us;var n=Xo(t*=us);Om=n*Xo(e),Sm=n*Mo(e),Dm=Mo(t),rv.point=j9,Tx(Om,Sm,Dm)}function j9(e,t){e*=us;var n=Xo(t*=us),r=n*Xo(e),i=n*Mo(e),s=Mo(t),f=M0(km((f=Sm*s-Dm*i)*f+(f=Dm*r-Om*s)*f+(f=Om*i-Sm*r)*f),Om*r+Sm*i+Dm*s);Yw+=f,ek+=f*(Om+(Om=r)),tk+=f*(Sm+(Sm=i)),nk+=f*(Dm+(Dm=s)),Tx(Om,Sm,Dm)}function XD(){rv.point=eC}function B9(){rv.point=L9}function P9(){YD(GD,$D),rv.point=eC}function L9(e,t){GD=e,$D=t,e*=us,t*=us,rv.point=YD;var n=Xo(t);Om=n*Xo(e),Sm=n*Mo(e),Dm=Mo(t),Tx(Om,Sm,Dm)}function YD(e,t){e*=us;var n=Xo(t*=us),r=n*Xo(e),i=n*Mo(e),s=Mo(t),f=Sm*s-Dm*i,v=Dm*r-Om*s,w=Om*i-Sm*r,O=vE(f,v,w),N=mg(O),L=O&&-N/O;J3.add(L*f),Q3.add(L*v),Z3.add(L*w),Yw+=N,ek+=N*(Om+(Om=r)),tk+=N*(Sm+(Sm=i)),nk+=N*(Dm+(Dm=s)),Tx(Om,Sm,Dm)}const z9="Literal";var i1,U9=1,W9=2,V9=3,q9=4,H9=5,G9=6,$9=7,K9=8;(i1={})[U9]="Boolean",i1[W9]="<end>",i1[V9]="Identifier",i1[q9]="Keyword",i1[H9]="Null",i1[G9]="Numeric",i1[$9]="Punctuator",i1[K9]="String",i1[9]="RegularExpression";const tC="intersect",JD="union",X9="vlMulti",Y9="vlPoint",QD="or",J9="and",Q9="E",Z9="R",e8="R-E",t8="R-LE",n8="R-RE",rk="index:unit";function ZD(e,t){for(var n,r,i=t.fields,s=t.values,f=i.length,v=0;v<f;++v)if((r=i[v]).getter=we.u.getter||Object(we.u)(r.field),n=r.getter(e),Object(we.D)(n)&&(n=Object(we.Ea)(n)),Object(we.D)(s[v])&&(s[v]=Object(we.Ea)(s[v])),Object(we.D)(s[v][0])&&(s[v]=s[v].map(we.Ea)),r.type===Q9){if(Object(we.B)(s[v])?s[v].indexOf(n)<0:n!==s[v])return!1}else if(r.type===Z9){if(!Object(we.A)(n,s[v]))return!1}else if(r.type===n8){if(!Object(we.A)(n,s[v],!0,!1))return!1}else if(r.type===e8){if(!Object(we.A)(n,s[v],!1,!1))return!1}else if(r.type===t8&&!Object(we.A)(n,s[v],!1,!0))return!1;return!0}const nC=Object(we.u)("_vgsid_"),eT=function(e){let t=e,n=e;function r(i,s,f,v){for(f==null&&(f=0),v==null&&(v=i.length);f<v;){const w=f+v>>>1;n(i[w],s)<0?f=w+1:v=w}return f}return e.length===1&&(t=(i,s)=>e(i)-s,n=function(i){return(s,f)=>function(v,w){return v<w?-1:v>w?1:v>=w?0:NaN}(i(s),f)}(e)),{left:r,center:function(i,s,f,v){f==null&&(f=0),v==null&&(v=i.length);const w=r(i,s,f,v-1);return w>f&&t(i[w-1],s)>-t(i[w],s)?w-1:w},right:function(i,s,f,v){for(f==null&&(f=0),v==null&&(v=i.length);f<v;){const w=f+v>>>1;n(i[w],s)>0?v=w:f=w+1}return f}}}(nC),r8=eT.left,i8=eT.right;var tT={E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(n=>t.indexOf(n)>=0):t},R_union:function(e,t){var n=Object(we.Ea)(t[0]),r=Object(we.Ea)(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<r&&(e[1]=r),e):[n,r]},R_intersect:function(e,t){var n=Object(we.Ea)(t[0]),r=Object(we.Ea)(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?r<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>r&&(e[1]=r),e):[n,r]}};const o8=":",a8="@";function rC(e,t,n,r){t[0].type!==z9&&Object(we.o)("First argument to selection functions must be a string literal.");const i=t[0].value,s=t.length>=2&&Object(we.W)(t).value,f=a8+"unit",v=o8+i;s!==tC||Object(we.w)(r,f)||(r[f]=n.getData(i).indataRef(n,"unit")),Object(we.w)(r,v)||(r[v]=n.getData(i).tuplesRef())}function nT(e){const t=this.context.data[e];return t?t.values.value:[]}const Nx=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},s8=Nx("format"),rT=Nx("timeFormat"),u8=Nx("utcFormat"),c8=Nx("timeParse"),l8=Nx("utcParse"),ik=new Date(2e3,0,1);function ok(e,t,n){return Number.isInteger(e)&&Number.isInteger(t)?(ik.setYear(2e3),ik.setMonth(e),ik.setDate(t),rT.call(this,ik,n)):""}const f8=":",h8="@",iC="%",iT="$";function oC(e,t,n,r){t[0].type!==pb&&Object(we.o)("First argument to data functions must be a string literal.");const i=t[0].value,s=f8+i;if(!Object(we.w)(s,r))try{r[s]=n.getData(i).tuplesRef()}catch{}}function bg(e,t,n,r){if(t[0].type===pb)oT(n,r,t[0].value);else for(e in n.scales)oT(n,r,e)}function oT(e,t,n){const r=iC+n;if(!Object(we.w)(t,r))try{t[r]=e.scaleRef(n)}catch{}}function o1(e,t){let n;return Object(we.E)(e)?e:Object(we.J)(e)?(n=t.scales[e])&&n.value:void 0}function aC(e,t){return function(n,r,i){if(n){const s=o1(n,(i||this).context);return s&&s.path[e](r)}return t(r)}}const d8=aC("area",function(e){return Kw=new xm,Yv(e,Dv),2*Kw}),p8=aC("bounds",function(e){var t,n,r,i,s,f,v;if(t0=Yl=-(Al=yg=1/0),j1=[],Yv(e,r1),n=j1.length){for(j1.sort(R9),t=1,s=[r=j1[0]];t<n;++t)HD(r,(i=j1[t])[0])||HD(r,i[1])?(n0(r[0],i[1])>n0(r[0],r[1])&&(r[1]=i[1]),n0(i[0],r[1])>n0(r[0],r[1])&&(r[0]=i[0])):s.push(r=i);for(f=-1/0,t=0,r=s[n=s.length-1];t<=n;r=i,++t)i=s[t],(v=n0(r[1],i[0]))>f&&(f=v,Al=i[0],Yl=r[1])}return j1=n1=null,Al===1/0||yg===1/0?[[NaN,NaN],[NaN,NaN]]:[[Al,yg],[Yl,t0]]}),m8=aC("centroid",function(e){Xw=Yw=Jw=Qw=Zw=ek=tk=nk=0,J3=new xm,Q3=new xm,Z3=new xm,Yv(e,rv);var t=+J3,n=+Q3,r=+Z3,i=vE(t,n,r);return i<1e-12&&(t=ek,n=tk,r=nk,Yw<Go&&(t=Jw,n=Qw,r=Zw),(i=vE(t,n,r))<1e-12)?[NaN,NaN]:[M0(n,t)*kf,mg(r/i)*kf]});function sC(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(r){e.warn(r)}return n[n.length-1]}function uC(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function cC(e){const t=Jt(e);return .2126*uC(t.r)+.7152*uC(t.g)+.0722*uC(t.b)}function aT(e,t){return e===t||e!=e&&t!=t||(Object(we.B)(e)?!(!Object(we.B)(t)||e.length!==t.length)&&function(n,r){for(let i=0,s=n.length;i<s;++i)if(!aT(n[i],r[i]))return!1;return!0}(e,t):!(!Object(we.H)(e)||!Object(we.H)(t))&&sT(e,t))}function sT(e,t){for(const n in e)if(!aT(e[n],t[n]))return!1;return!0}function uT(e){return t=>sT(e,t)}const cT={};function lC(e){return Object(we.B)(e)||ArrayBuffer.isView(e)?e:null}function fC(e){return lC(e)||(Object(we.J)(e)?e:null)}const lT=e=>e.data;function fT(e,t){const n=nT.call(t,e);return n.root&&n.root.lookup||{}}const hT=()=>typeof window!="undefined"&&window||null,Ix={random:()=>qn(),cumulativeNormal:eo,cumulativeLogNormal:Ql,cumulativeUniform:pl,densityNormal:Cf,densityLogNormal:ws,densityUniform:Zl,quantileNormal:bu,quantileLogNormal:Hs,quantileUniform:ml,sampleNormal:As,sampleLogNormal:_c,sampleUniform:Gs,isArray:we.B,isBoolean:we.C,isDate:we.D,isDefined:e=>e!==void 0,isNumber:we.G,isObject:we.H,isRegExp:we.I,isString:we.J,isTuple:nn,isValid:e=>e!=null&&e==e,toBoolean:we.Ca,toDate:we.Da,toNumber:we.Ea,toString:we.Ga,indexof:function(e,...t){return fC(e).indexOf(...t)},join:function(e,...t){return lC(e).join(...t)},lastindexof:function(e,...t){return fC(e).lastIndexOf(...t)},replace:function(e,t,n){return Object(we.E)(n)&&Object(we.o)("Function argument passed to replace."),String(e).replace(t,n)},reverse:function(e){return lC(e).slice().reverse()},slice:function(e,...t){return fC(e).slice(...t)},flush:we.v,lerp:we.L,merge:function(){const e=[].slice.call(arguments);return e.unshift({}),Object(we.p)(...e)},pad:we.R,peek:we.W,pluck:function(e,t){const n=cT[t]||(cT[t]=Object(we.u)(t));return Object(we.B)(e)?e.map(n):n(e)},span:we.Z,inrange:we.A,truncate:we.Ha,rgb:Jt,lab:Ff,hcl:al,hsl:br,luminance:cC,contrast:function(e,t){const n=cC(e),r=cC(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)},sequence:Qi,format:s8,utcFormat:u8,utcParse:l8,utcOffset:hr.w,utcSequence:hr.x,timeFormat:rT,timeParse:c8,timeOffset:hr.q,timeSequence:hr.r,timeUnitSpecifier:hr.s,monthFormat:function(e){return ok.call(this,e,1,"%B")},monthAbbrevFormat:function(e){return ok.call(this,e,1,"%b")},dayFormat:function(e){return ok.call(this,0,2+e,"%A")},dayAbbrevFormat:function(e){return ok.call(this,0,2+e,"%a")},quarter:we.X,utcquarter:we.Ja,week:hr.A,utcweek:hr.z,dayofyear:hr.m,utcdayofyear:hr.y,warn:function(){return sC(this.context.dataflow,"warn",arguments)},info:function(){return sC(this.context.dataflow,"info",arguments)},debug:function(){return sC(this.context.dataflow,"debug",arguments)},extent:we.q,inScope:function(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},intersect:function(e,t,n){if(!e)return[];const[r,i]=e,s=new pu().set(r[0],r[1],i[0],i[1]);return Kr(n||this.context.dataflow.scenegraph().root,s,function(f){let v=null;if(f){const w=Object(we.i)(f.marktype),O=Object(we.i)(f.markname);v=N=>(!w.length||w.some(L=>N.marktype===L))&&(!O.length||O.some(L=>N.name===L))}return v}(t))},clampRange:we.k,pinchDistance:function(e){const t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)},pinchAngle:function(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)},screen:function(){const e=hT();return e?e.screen:{}},containerSize:function(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]},windowSize:function(){const e=hT();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]},bandspace:function(e,t,n){return cp(e||0,t||0,n||0)},setdata:function(e,t){const n=this.context.dataflow,r=this.context.data[e].input;return n.pulse(r,n.changeset().remove(we.Ia).insert(t)),1},pathShape:function(e){let t=null;return function(n){return n?vp(n,t=t||mp(e)):e}},panLinear:we.S,panLog:we.T,panPow:we.U,panSymlog:we.V,zoomLinear:we.Na,zoomLog:we.Oa,zoomPow:we.Pa,zoomSymlog:we.Qa,encode:function(e,t,n){if(e){const r=this.context.dataflow,i=e.mark.source;r.pulse(i,r.changeset().encode(e,t))}return n!==void 0?n:e},modify:function(e,t,n,r,i,s){const f=this.context.dataflow,v=this.context.data[e],w=v.input,O=f.stamp();let N,L,Y=v.changes;if(f._trigger===!1||!(w.value.length||t||r))return 0;if((!Y||Y.stamp<O)&&(v.changes=Y=f.changeset(),Y.stamp=O,f.runAfter(()=>{v.modified=!0,f.pulse(w,Y).run()},!0,1)),n&&(N=n===!0?we.Ia:Object(we.B)(n)||nn(n)?n:uT(n),Y.remove(N)),t&&Y.insert(t),r&&(N=uT(r),w.value.some(N)?Y.remove(N):Y.insert(r)),i)for(L in s)Y.modify(i,L,s[L]);return 1}},g8=["view","item","group","xy","x","y"],v8="event.vega.",dT="this.",hC={},pT={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>`_[${Object(we.Ba)(iT+e)}]`,functions:function(e){const t=MD(e);g8.forEach(n=>t[n]=v8+n);for(const n in Ix)t[n]=dT+n;return Object(we.p)(t,function(n,r,i){r.__bandwidth=f=>f&&f.bandwidth?f.bandwidth():0,i._bandwidth=bg,i._range=bg,i._scale=bg;const s=f=>"_["+(f.type===pb?Object(we.Ba)(iC+f.value):Object(we.Ba)(iC)+"+"+n(f))+"]";return{_bandwidth:f=>`this.__bandwidth(${s(f[0])})`,_range:f=>`${s(f[0])}.range()`,_scale:f=>`${s(f[0])}(${n(f[1])})`}}(e,Ix,hC)),t},constants:RD,visitors:hC},dC=function(e){const t=(e=e||{}).allowed?Object(we.Fa)(e.allowed):{},n=e.forbidden?Object(we.Fa)(e.forbidden):{},r=e.constants||RD,i=(e.functions||MD)(L),s=e.globalvar,f=e.fieldvar,v=Object(we.E)(s)?s:fe=>`${s}["${fe}"]`;let w={},O={},N=0;function L(fe){if(Object(we.J)(fe))return fe;const ve=Y[fe.type];return ve==null&&Object(we.o)("Unsupported type: "+fe.type),ve(fe)}const Y={Literal:fe=>fe.raw,Identifier:fe=>{const ve=fe.name;return N>0?ve:Object(we.w)(n,ve)?Object(we.o)("Illegal identifier: "+ve):Object(we.w)(r,ve)?r[ve]:Object(we.w)(t,ve)?ve:(w[ve]=1,v(ve))},MemberExpression:fe=>{const ve=!fe.computed,Be=L(fe.object);ve&&(N+=1);const We=L(fe.property);return Be===f&&(O[function(Ve){const ct=Ve&&Ve.length-1;return ct&&(Ve[0]==='"'&&Ve[ct]==='"'||Ve[0]==="'"&&Ve[ct]==="'")?Ve.slice(1,-1):Ve}(We)]=1),ve&&(N-=1),Be+(ve?"."+We:"["+We+"]")},CallExpression:fe=>{fe.callee.type!=="Identifier"&&Object(we.o)("Illegal callee type: "+fe.callee.type);const ve=fe.callee.name,Be=fe.arguments,We=Object(we.w)(i,ve)&&i[ve];return We||Object(we.o)("Unrecognized function: "+ve),Object(we.E)(We)?We(Be):We+"("+Be.map(L).join(",")+")"},ArrayExpression:fe=>"["+fe.elements.map(L).join(",")+"]",BinaryExpression:fe=>"("+L(fe.left)+" "+fe.operator+" "+L(fe.right)+")",UnaryExpression:fe=>"("+fe.operator+L(fe.argument)+")",ConditionalExpression:fe=>"("+L(fe.test)+"?"+L(fe.consequent)+":"+L(fe.alternate)+")",LogicalExpression:fe=>"("+L(fe.left)+fe.operator+L(fe.right)+")",ObjectExpression:fe=>"{"+fe.properties.map(L).join(",")+"}",Property:fe=>{N+=1;const ve=L(fe.key);return N-=1,ve+":"+L(fe.value)}};function ie(fe){const ve={code:L(fe),globals:Object.keys(w),fields:Object.keys(O)};return w={},O={},ve}return ie.functions=i,ie.constants=r,ie}(pT);function Hf(e,t,n){return arguments.length===1?Ix[e]:(Ix[e]=t,n&&(hC[e]=n),dC&&(dC.functions[e]=dT+e),this)}function Tv(e,t){const n={};let r;try{r=function(s){ei=0,Op=(vo=s).length,Hu=null,OD();const f=G3();if(Hu.type!==kx)throw new Error("Unexpect token after expression.");return f}(e=Object(we.J)(e)?e:Object(we.Ba)(e)+"")}catch{Object(we.o)("Expression parse error: "+e)}r.visit(s=>{if(s.type!==xD)return;const f=s.callee.name,v=pT.visitors[f];v&&v(f,s.arguments,t,n)});const i=dC(r);return i.globals.forEach(s=>{const f=iT+s;!Object(we.w)(n,f)&&t.getSignal(s)&&(n[f]=t.signalRef(s))}),{$expr:Object(we.p)({code:i.code},t.options.ast?{ast:r}:null),$fields:i.fields,$params:n}}Hf("bandwidth",function(e,t){const n=o1(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0},bg),Hf("copy",function(e,t){const n=o1(e,(t||this).context);return n?n.copy():void 0},bg),Hf("domain",function(e,t){const n=o1(e,(t||this).context);return n?n.domain():[]},bg),Hf("range",function(e,t){const n=o1(e,(t||this).context);return n&&n.range?n.range():[]},bg),Hf("invert",function(e,t,n){const r=o1(e,(n||this).context);return r?Object(we.B)(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t):void 0},bg),Hf("scale",function(e,t,n){const r=o1(e,(n||this).context);return r?r(t):void 0},bg),Hf("gradient",function(e,t,n,r,i){e=o1(e,(i||this).context);const s=Gg(t,n);let f=e.domain(),v=f[0],w=Object(we.W)(f),O=we.y;return w-v?O=Rd(e,v,w):e=(e.interpolator?Ra("sequential")().interpolator(e.interpolator()):Ra("linear")().interpolate(e.interpolate()).range(e.range())).domain([v=0,w=1]),e.ticks&&(v!==(f=e.ticks(+r||15))[0]&&f.unshift(v),w!==Object(we.W)(f)&&f.push(w)),f.forEach(N=>s.stop(O(N),e(N))),s},bg),Hf("geoArea",d8,bg),Hf("geoBounds",p8,bg),Hf("geoCentroid",m8,bg),Hf("geoShape",function(e,t,n){const r=o1(e,(n||this).context);return function(i){return r?r.path.context(i)(t):""}},bg),Hf("indata",function(e,t,n){const r=this.context.data[e]["index:"+t],i=r?r.value.get(n):void 0;return i&&i.count},function(e,t,n,r){t[0].type!==pb&&Object(we.o)("First argument to indata must be a string literal."),t[1].type!==pb&&Object(we.o)("Second argument to indata must be a string literal.");const i=t[0].value,s=t[1].value,f=h8+s;Object(we.w)(f,r)||(r[f]=n.getData(i).indataRef(n,s))}),Hf("data",nT,oC),Hf("treePath",function(e,t,n){const r=fT(e,this),i=r[t],s=r[n];return i&&s?i.path(s).map(lT):void 0},oC),Hf("treeAncestors",function(e,t){const n=fT(e,this)[t];return n?n.ancestors().map(lT):void 0},oC),Hf("vlSelectionTest",function(e,t,n){for(var r,i,s,f,v,w=this.context.data[e],O=w?w.values.value:[],N=w?w[rk]&&w[rk].value:void 0,L=n===tC,Y=O.length,ie=0;ie<Y;++ie)if(r=O[ie],N&&L){if((s=(i=i||{})[f=r.unit]||0)===-1)continue;if(v=ZD(t,r),i[f]=v?-1:++s,v&&N.size===1)return!0;if(!v&&s===N.get(f).count)return!1}else if(L^(v=ZD(t,r)))return v;return Y&&L},rC),Hf("vlSelectionIdTest",function(e,t,n){const r=this.context.data[e],i=r?r.values.value:[],s=r?r[rk]&&r[rk].value:void 0,f=n===tC,v=nC(t),w=r8(i,v);if(w===i.length||nC(i[w])!==v)return!1;if(s&&f){if(s.size===1)return!0;if(i8(i,v)-w<s.size)return!1}return!0},rC),Hf("vlSelectionResolve",function(e,t,n,r){for(var i,s,f,v,w,O,N,L,Y,ie,fe,ve=this.context.data[e],Be=ve?ve.values.value:[],We={},Ve={},ct={},lt=Be.length,mt=0;mt<lt;++mt){for(v=(i=Be[mt]).unit,s=i.fields,f=i.values,ie=0,fe=s.length;ie<fe;++ie)w=s[ie],N=(O=We[w.field]||(We[w.field]={}))[v]||(O[v]=[]),ct[w.field]=L=w.type.charAt(0),Y=tT[L+"_union"],O[v]=Y(N,Object(we.i)(f[ie]));n&&(N=Ve[v]||(Ve[v]=[])).push(Object(we.i)(f).reduce((dt,kt,wt)=>(dt[s[wt].field]=kt,dt),{}))}return t=t||JD,Object.keys(We).forEach(dt=>{We[dt]=Object.keys(We[dt]).map(kt=>We[dt][kt]).reduce((kt,wt)=>kt===void 0?wt:tT[ct[dt]+"_"+t](kt,wt))}),Be=Object.keys(Ve),n&&Be.length&&(We[r?Y9:X9]=t===JD?{[QD]:Be.reduce((dt,kt)=>(dt.push(...Ve[kt]),dt),[])}:{[J9]:Be.map(dt=>({[QD]:Ve[dt]}))}),We},rC),Hf("vlSelectionTuples",function(e,t){return e.map(n=>Object(we.p)({values:t.fields.map(r=>(r.getter||(r.getter=Object(we.u)(r.field)))(n.datum))},t))});const y8=Object(we.Fa)(["rule"]),mT=Object(we.Fa)(["group","image","rect"]);function pC(e){return(e+"").toLowerCase()}function Fx(e,t,n){n[n.length-1]!==";"&&(n="return("+n+");");const r=Function(...t.concat(n));return e&&e.functions?r.bind(e.functions):r}var b8={operator:(e,t)=>Fx(e,["_"],t.code),parameter:(e,t)=>Fx(e,["datum","_"],t.code),event:(e,t)=>Fx(e,["event"],t.code),handler:(e,t)=>Fx(e,["_","event"],"var datum=event.item&&event.item.datum;return ".concat(t.code,";")),encode:(e,t)=>{const{marktype:n,channels:r}=t;let i="var o=item,datum=o.datum,m=0,$;";for(const s in r){const f="o["+Object(we.Ba)(s)+"]";i+="$=".concat(r[s].code,";if(").concat(f,"!==$)").concat(f,"=$,m=1;")}return i+=function(s,f){let v="";return y8[f]||(s.x2&&(s.x?(mT[f]&&(v+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),v+="o.width=o.x2-o.x;"):v+="o.x=o.x2-(o.width||0);"),s.xc&&(v+="o.x=o.xc-(o.width||0)/2;"),s.y2&&(s.y?(mT[f]&&(v+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),v+="o.height=o.y2-o.y;"):v+="o.y=o.y2-(o.height||0);"),s.yc&&(v+="o.y=o.yc-(o.height||0)/2;")),v}(r,n),Fx(e,["item","_"],i+="return m;")},codegen:{get(e){const t="[".concat(e.map(we.Ba).join("]["),"]"),n=Function("_","return _".concat(t,";"));return n.path=t,n},comparator(e,t){let n;const r=Function("a","b","var u, v; return "+e.map((i,s)=>{const f=t[s];let v,w;return i.path?(v="a".concat(i.path),w="b".concat(i.path)):((n=n||{})["f"+s]=i,v="this.f".concat(s,"(a)"),w="this.f".concat(s,"(b)")),function(O,N,L,Y){return"((u = ".concat(O,") < (v = ").concat(N,") || u == null) && v != null ? ").concat(L,`
  : (u > v || v == null) && u != null ? `).concat(Y,`
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? `).concat(L,`
  : v !== v && u === u ? `).concat(Y," : ")}(v,w,-f,f)}).join("")+"0;");return n?r.bind(n):r}}};function gT(e,t,n){if(!e||!Object(we.H)(e))return e;for(let r,i=0,s=vT.length;i<s;++i)if(r=vT[i],Object(we.w)(e,r.key))return r.parse(e,t,n);return e}var vT=[{key:"$ref",parse:function(e,t){return t.get(e.$ref)||Object(we.o)("Operator not defined: "+e.$ref)}},{key:"$key",parse:function(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=Object(we.K)(e.$key,e.$flat,t.expr.codegen))}},{key:"$expr",parse:function(e,t,n){e.$params&&t.parseParameters(e.$params,n);const r="e:"+e.$expr.code+"_"+e.$name;return t.fn[r]||(t.fn[r]=Object(we.f)(t.parameterExpression(e.$expr),e.$fields,e.$name))}},{key:"$field",parse:function(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=Object(we.u)(e.$field,e.$name,t.expr.codegen))}},{key:"$encode",parse:function(e,t){const n=e.$encode,r={};for(const i in n){const s=n[i];r[i]=Object(we.f)(t.encodeExpression(s.$expr),s.$fields),r[i].output=s.$output}return r}},{key:"$compare",parse:function(e,t){const n="c:"+e.$compare+"_"+e.$order,r=Object(we.i)(e.$compare).map(i=>i&&i.$tupleid?an:i);return t.fn[n]||(t.fn[n]=Object(we.l)(r,e.$order,t.expr.codegen))}},{key:"$context",parse:function(e,t){return t}},{key:"$subflow",parse:function(e,t){const n=e.$subflow;return function(r,i,s){const f=t.fork().parse(n),v=f.get(n.operators[0].id),w=f.signals.parent;return w&&w.set(s),v.detachSubflow=()=>t.detach(f),v}}},{key:"$tupleid",parse:function(){return an}}];const x8={skip:!0};function yT(e,t,n,r){return new bT(e,t,n,r)}function bT(e,t,n,r){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=r||b8,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function xT(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}bT.prototype=xT.prototype={fork(){const e=new xT(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(n=>n!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,r=n.dataflow,i=e.value;if(n.set(e.id,t),function(s){return pC(s)==="collect"}(e.type)&&i&&(i.$ingest?r.ingest(t,i.$ingest,i.$format):i.$request?r.preload(t,i.$request,i.$format):r.pulse(t,r.changeset().insert(i))),e.root&&(n.root=t),e.parent){let s=n.get(e.parent.$ref);s?(r.connect(s,[t]),t.targets().add(s)):(n.unresolved=n.unresolved||[]).push(()=>{s=n.get(e.parent.$ref),r.connect(s,[t]),t.targets().add(s)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const s in e.data){const f=n.data[s]||(n.data[s]={});e.data[s].forEach(v=>f[v]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[pC(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,r,i){this.dataflow.on(t,n,r,i,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:function(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(r=>t.parseOperator(r)),n.forEach(r=>t.parseOperatorParameters(r)),(e.streams||[]).forEach(r=>t.parseStream(r)),(e.updates||[]).forEach(r=>t.parseUpdate(r)),t.resolve()},parseOperator:function(e){const t=this;!function(n){return pC(n)==="operator"}(e.type)&&e.type?t.transform(e,e.type):t.operator(e,e.update?t.operatorExpression(e.update):null)},parseOperatorParameters:function(e){const t=this;if(e.params){const n=t.get(e.id);n||Object(we.o)("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}},parseParameters:function(e,t){t=t||{};const n=this;for(const r in e){const i=e[r];t[r]=Object(we.B)(i)?i.map(s=>gT(s,n,t)):gT(i,n,t)}return t},parseStream:function(e){var t,n=this,r=e.filter!=null?n.eventExpression(e.filter):void 0,i=e.stream!=null?n.get(e.stream):void 0;e.source?i=n.events(e.source,e.type,r):e.merge&&(i=(t=e.merge.map(s=>n.get(s)))[0].merge.apply(t[0],t.slice(1))),e.between&&(t=e.between.map(s=>n.get(s)),i=i.between(t[0],t[1])),e.filter&&(i=i.filter(r)),e.throttle!=null&&(i=i.throttle(+e.throttle)),e.debounce!=null&&(i=i.debounce(+e.debounce)),i==null&&Object(we.o)("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),n.stream(e,i)},parseUpdate:function(e){var t,n=Object(we.H)(n=e.source)?n.$ref:n,r=this.get(n),i=e.update,s=void 0;r||Object(we.o)("Source not defined: "+e.source),t=e.target&&e.target.$expr?this.eventExpression(e.target.$expr):this.get(e.target),i&&i.$expr&&(i.$params&&(s=this.parseParameters(i.$params)),i=this.handlerExpression(i.$expr)),this.update(e,r,t,i,s)},getState:function(e){var t=this,n={};if(e.signals){var r=n.signals={};Object.keys(t.signals).forEach(s=>{const f=t.signals[s];e.signals(s,f)&&(r[s]=f.value)})}if(e.data){var i=n.data={};Object.keys(t.data).forEach(s=>{const f=t.data[s];e.data(s,f)&&(i[s]=f.input.value)})}return t.subcontext&&e.recurse!==!1&&(n.subcontext=t.subcontext.map(s=>s.getState(e))),n},setState:function(e){var t=this,n=t.dataflow,r=e.data,i=e.signals;Object.keys(i||{}).forEach(s=>{n.update(t.signals[s],i[s],x8)}),Object.keys(r||{}).forEach(s=>{n.pulse(t.data[s].input,n.changeset().remove(we.Ia).insert(r[s]))}),(e.subcontext||[]).forEach((s,f)=>{const v=t.subcontext[f];v&&v.setState(s)})}};var w8=function(e,t,n){var r=new Dw,i=t;return t==null?(r.restart(e,t,n),r):(r._restart=r.restart,r.restart=function(s,f,v){f=+f,v=v==null?i3():+v,r._restart(function w(O){O+=i,r._restart(w,i+=f,v),s(O)},f,v)},r.restart(e,t,n),r)};function wT(e,t){e&&(t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}const mC="default";function gC(e,t){const n=e.globalCursor()?typeof document!="undefined"&&document.body:e.container();if(n)return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}function ak(e,t){var n=e._runtime.data;return Object(we.w)(n,t)||Object(we.o)("Unrecognized data set: "+t),n[t]}function sk(e,t){Ai(t)||Object(we.o)("Second argument to changes must be a changeset.");const n=ak(this,e);return n.modified=!0,this.pulse(n.input,t)}function kT(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function _T(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function uk(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function k8(e,t,n){var r,i,s=e._renderer,f=s&&s.canvas();return f&&(i=uk(e),(r=h(t.changedTouches?t.changedTouches[0]:t,f))[0]-=i[0],r[1]-=i[1]),t.dataflow=e,t.item=n,t.vega=function(v,w,O){const N=w?w.mark.marktype==="group"?w:w.mark.group:null;function L(ie){var fe,ve=N;if(ie){for(fe=w;fe;fe=fe.mark.group)if(fe.mark.name===ie){ve=fe;break}}return ve&&ve.mark&&ve.mark.interactive?ve:{}}function Y(ie){if(!ie)return O;Object(we.J)(ie)&&(ie=L(ie));const fe=O.slice();for(;ie;)fe[0]-=ie.x||0,fe[1]-=ie.y||0,ie=ie.mark&&ie.mark.group;return fe}return{view:Object(we.m)(v),item:Object(we.m)(w||{}),group:L,xy:Y,x:ie=>Y(ie)[0],y:ie=>Y(ie)[1]}}(e,n,r),t}const ET="view",_8="timer",E8="window",C8={trap:!1};function CT(e,t,n,r){e._eventListeners.push({type:n,sources:Object(we.i)(t),handler:r})}function ck(e,t,n){const r=e._eventConfig&&e._eventConfig[t];return!(r===!1||Object(we.H)(r)&&!r[n])||(e.warn(`Blocked ${t} ${n} event listener.`),!1)}function AT(e){return e.item}function OT(e){return e.item.mark.source}function ST(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function r0(e,t,n){const r=document.createElement(e);for(const i in t)r.setAttribute(i,t[i]);return n!=null&&(r.textContent=n),r}const A8="vega-bind",O8="vega-bind-name",S8="vega-bind-radio";function D8(e,t,n,r){const i=n.event||"input",s=()=>e.update(t.value);r.signal(n.signal,t.value),t.addEventListener(i,s),CT(r,t,i,s),e.set=f=>{t.value=f,t.dispatchEvent(function(v){return typeof Event!="undefined"?new Event(v):{type:v}}(i))}}function T8(e,t,n,r){const i=r.signal(n.signal),s=r0("div",{class:A8}),f=n.input==="radio"?s:s.appendChild(r0("label"));f.appendChild(r0("span",{class:O8},n.name||n.signal)),t.appendChild(s);let v=N8;switch(n.input){case"checkbox":v=I8;break;case"select":v=F8;break;case"radio":v=R8;break;case"range":v=M8}v(e,f,n,i)}function N8(e,t,n,r){const i=r0("input");for(const s in n)s!=="signal"&&s!=="element"&&i.setAttribute(s==="input"?"type":s,n[s]);i.setAttribute("name",n.signal),i.value=r,t.appendChild(i),i.addEventListener("input",()=>e.update(i.value)),e.elements=[i],e.set=s=>i.value=s}function I8(e,t,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const s=r0("input",i);t.appendChild(s),s.addEventListener("change",()=>e.update(s.checked)),e.elements=[s],e.set=f=>s.checked=!!f||null}function F8(e,t,n,r){const i=r0("select",{name:n.signal}),s=n.labels||[];n.options.forEach((f,v)=>{const w={value:f};lk(f,r)&&(w.selected=!0),i.appendChild(r0("option",w,(s[v]||f)+""))}),t.appendChild(i),i.addEventListener("change",()=>{e.update(n.options[i.selectedIndex])}),e.elements=[i],e.set=f=>{for(let v=0,w=n.options.length;v<w;++v)if(lk(n.options[v],f))return void(i.selectedIndex=v)}}function R8(e,t,n,r){const i=r0("span",{class:S8}),s=n.labels||[];t.appendChild(i),e.elements=n.options.map((f,v)=>{const w={type:"radio",name:n.signal,value:f};lk(f,r)&&(w.checked=!0);const O=r0("input",w);O.addEventListener("change",()=>e.update(f));const N=r0("label",{},(s[v]||f)+"");return N.prepend(O),i.appendChild(N),O}),e.set=f=>{const v=e.elements,w=v.length;for(let O=0;O<w;++O)lk(v[O].value,f)&&(v[O].checked=!0)}}function M8(e,t,n,r){r=r!==void 0?r:(+n.max+ +n.min)/2;const i=n.max!=null?n.max:Math.max(100,+r)||100,s=n.min||Math.min(0,i,+r)||0,f=n.step||Object(xl.c)(s,i,100),v=r0("input",{type:"range",name:n.signal,min:s,max:i,step:f});v.value=r;const w=r0("span",{},+r);t.appendChild(v),t.appendChild(w);const O=()=>{w.textContent=v.value,e.update(+v.value)};v.addEventListener("input",O),v.addEventListener("change",O),e.elements=[v],e.set=N=>{v.value=N,w.textContent=N}}function lk(e,t){return e===t||e+""==t+""}function DT(e,t,n,r,i,s){return(t=t||new r(e.loader())).initialize(n,kT(e),_T(e),uk(e),i,s).background(e.background())}function vC(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function yC(e,t,n){if(typeof t=="string"){if(typeof document=="undefined")return e.error("DOM document instance not found."),null;if(!(t=document.querySelector(t)))return e.error("Signal bind element not found: "+t),null}if(t&&n)try{t.innerHTML=""}catch(r){t=null,e.error(r)}return t}const Rx=e=>+e||0,j8=e=>({top:e,bottom:e,left:e,right:e});function TT(e){return Object(we.H)(e)?{top:Rx(e.top),bottom:Rx(e.bottom),left:Rx(e.left),right:Rx(e.right)}:j8(Rx(e))}async function bC(e,t,n,r){const i=Yr(t),s=i&&i.headless;return s||Object(we.o)("Unrecognized renderer type: "+t),await e.runAsync(),DT(e,null,null,s,n,r).renderAsync(e._scenegraph.root)}var NT="width",IT="height",xC="padding",FT={skip:!0};function RT(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===xC?r.left+r.right:0)}function MT(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===xC?r.top+r.bottom:0)}function B8(e,t){return t.modified&&Object(we.B)(t.input.value)&&e.indexOf("_:vega:_")}function P8(e,t){return!(e==="parent"||t instanceof bn.proxy)}function L8(e,t,n,r){const i=e.element();i&&i.setAttribute("title",function(s){return s==null?"":Object(we.B)(s)?jT(s):Object(we.H)(s)&&!Object(we.D)(s)?function(f){return Object.keys(f).map(v=>{const w=f[v];return v+": "+(Object(we.B)(w)?jT(w):BT(w))}).join(`
`)}(s):s+""}(r))}function jT(e){return"["+e.map(BT).join(", ")+"]"}function BT(e){return Object(we.B)(e)?"[\u2026]":Object(we.H)(e)&&!Object(we.D)(e)?"{\u2026}":e}function PT(e,t){const n=this;if(t=t||{},Gn.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),t.logLevel!=null&&n.logLevel(t.logLevel),t.locale||e.locale){const s=Object(we.p)({},e.locale,t.locale);n.locale(Object(Rr.b)(s.number,s.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||Ar.Canvas,n._scenegraph=new Zg;const r=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||L8,n._redraw=!0,n._handler=new Ge().scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(s){const f=Object(we.p)({defaults:{}},s),v=(w,O)=>{O.forEach(N=>{Object(we.B)(w[N])&&(w[N]=Object(we.Fa)(w[N]))})};return v(f.defaults,["prevent","allow"]),v(f,["view","window","selector"]),f}(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=function(s,f,v){return yT(s,bn,Ix,v).parse(f)}(n,e,t.expr);n._runtime=i,n._signals=i.signals,n._bind=(e.bindings||[]).map(s=>({state:null,param:Object(we.p)({},s)})),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=RT(n,n._width),n._viewHeight=MT(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(s){var f=s._signals,v=f[NT],w=f[IT],O=f[xC];function N(){s._autosize=s._resize=1}s._resizeWidth=s.add(null,Y=>{s._width=Y.size,s._viewWidth=RT(s,Y.size),N()},{size:v}),s._resizeHeight=s.add(null,Y=>{s._height=Y.size,s._viewHeight=MT(s,Y.size),N()},{size:w});const L=s.add(null,N,{pad:O});s._resizeWidth.rank=v.rank+1,s._resizeHeight.rank=w.rank+1,L.rank=O.rank+1}(n),function(s){s.add(null,f=>(s._background=f.bg,s._resize=1,f.bg),{bg:s._signals.background})}(n),function(s){const f=s._signals.cursor||(s._signals.cursor=s.add({user:mC,item:null}));s.on(s.events("view","mousemove"),f,(v,w)=>{const O=f.value,N=O?Object(we.J)(O)?O:O.user:mC,L=w.item&&w.item.cursor||null;return O&&N===O.user&&L==O.item?O:{user:N,item:L}}),s.add(null,function(v){let w=v.cursor,O=this.value;return Object(we.J)(w)||(O=w.item,w=w.user),gC(s,w&&w!==mC?w:O||w),O},{cursor:f})}(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function fk(e,t){return Object(we.w)(e._signals,t)?e._signals[t]:Object(we.o)("Unrecognized signal name: "+Object(we.Ba)(t))}function LT(e,t){const n=(e._targets||[]).filter(r=>r._update&&r._update.handler===t);return n.length?n[0]:null}function zT(e,t,n,r){let i=LT(n,r);return i||((i=vC(e,()=>r(t,n.value))).handler=r,e.on(n,null,i)),e}function UT(e,t,n){const r=LT(t,n);return r&&t._targets.remove(r),e}Object(we.z)(PT,Gn,{async evaluate(e,t,n){if(await Gn.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,function(r){var i=uk(r),s=kT(r),f=_T(r);r._renderer.background(r.background()),r._renderer.resize(s,f,i),r._handler.origin(i),r._resizeListeners.forEach(v=>{try{v(s,f)}catch(w){r.error(w)}})}(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(r){this.error(r)}return n&&qr(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=e!=null?e+"":null;return t!==this._desc&&wT(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const r=fk(this,e);return arguments.length===1?r.value:this.update(r,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",TT(e)):TT(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(Yr(e)||Object(we.o)("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(Gn.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(fk(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(e,t,n,r,i,s){this.runAfter(f=>{let v=0;f._autosize=0,f.width()!==n&&(v=1,f.signal(NT,n,FT),f._resizeWidth.skip(!0)),f.height()!==r&&(v=1,f.signal(IT,r,FT),f._resizeHeight.skip(!0)),f._viewWidth!==e&&(f._resize=1,f._viewWidth=e),f._viewHeight!==t&&(f._resize=1,f._viewHeight=t),f._origin[0]===i[0]&&f._origin[1]===i[1]||(f._resize=1,f._origin=i),v&&f.run("enter"),s&&f.runAfter(w=>w.resize())},!1,1)},addEventListener(e,t,n){let r=t;return n&&n.trap===!1||((r=vC(this,t)).raw=t),this._handler.on(e,r),this},removeEventListener(e,t){for(var n,r,i=this._handler.handlers(e),s=i.length;--s>=0;)if(r=i[s].type,n=i[s].handler,e===r&&(t===n||t===n.raw)){this._handler.off(r,n);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return zT(this,e,fk(this,e),t)},removeSignalListener(e,t){return UT(this,fk(this,e),t)},addDataListener(e,t){return zT(this,e,ak(this,e).values,t)},removeDataListener(e,t){return UT(this,ak(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=gC(this,null);this._globalCursor=!!e,t&&gC(this,t)}return this}return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:function(e,t){this._timers.push(w8(function(n){e({timestamp:Date.now(),elapsed:n})},t))},events:function(e,t,n){var r,i=this,s=new Ui(n),f=function(O,N){i.runAsync(null,()=>{e===ET&&function(L,Y){var ie=L._eventConfig.defaults,fe=ie.prevent,ve=ie.allow;return fe!==!1&&ve!==!0&&(fe===!0||ve===!1||(fe?fe[Y]:ve?!ve[Y]:L.preventDefault()))}(i,t)&&O.preventDefault(),s.receive(k8(i,O,N))})};if(e===_8)ck(i,"timer",t)&&i.timer(f,t);else if(e===ET)ck(i,"view",t)&&i.addEventListener(t,f,C8);else if(e===E8?ck(i,"window",t)&&typeof window!="undefined"&&(r=[window]):typeof document!="undefined"&&ck(i,"selector",t)&&(r=document.querySelectorAll(e)),r){for(var v=0,w=r.length;v<w;++v)r[v].addEventListener(t,f);CT(i,r,t,f)}else i.warn("Can not resolve event source: "+e);return s},finalize:function(){var e,t,n,r=this._tooltip,i=this._timers,s=this._eventListeners;for(e=i.length;--e>=0;)i[e].stop();for(e=s.length;--e>=0;)for(t=(n=s[e]).sources.length;--t>=0;)n.sources[t].removeEventListener(n.type,n.handler);return r&&r.call(this,this._handler,null,null,null),this},hover:function(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","mouseover",AT),OT,ST(e)),this.on(this.events("view","mouseout",AT),OT,ST(t)),this},data:function(e,t){return arguments.length<2?ak(this,e).values.value:sk.call(this,e,Jn().remove(we.Ia).insert(t))},change:sk,insert:function(e,t){return sk.call(this,e,Jn().insert(t))},remove:function(e,t){return sk.call(this,e,Jn().remove(t))},scale:function(e){var t=this._runtime.scales;return Object(we.w)(t,e)||Object(we.o)("Unrecognized scale or projection: "+e),t[e].value},initialize:function(e,t){const n=this,r=n._renderType,i=n._eventConfig.bind,s=Yr(r);e=n._el=e?yC(n,e,!0):null,function(w){const O=w.container();O&&(O.setAttribute("role","graphics-document"),O.setAttribute("aria-roleDescription","visualization"),wT(O,w.description()))}(n),s||n.error("Unrecognized renderer type: "+r);const f=s.handler||Ge,v=e?s.renderer:s.headless;return n._renderer=v?DT(n,n._renderer,e,v):null,n._handler=function(w,O,N,L){const Y=new L(w.loader(),vC(w,w.tooltip())).scene(w.scenegraph().root).initialize(N,uk(w),w);return O&&O.handlers().forEach(ie=>{Y.on(ie.type,ie.handler)}),Y}(n,n._handler,e,f),n._redraw=!0,e&&i!=="none"&&(t=t?n._elBind=yC(n,t,!0):e.appendChild(r0("form",{class:"vega-bindings"})),n._bind.forEach(w=>{w.param.element&&i!=="container"&&(w.element=yC(n,w.param.element,!!w.param.input))}),n._bind.forEach(w=>{(function(O,N,L){if(!N)return;const Y=L.param;let ie=L.state;ie||(ie=L.state={elements:null,active:!1,set:null,update:fe=>{fe!=O.signal(Y.signal)&&O.runAsync(null,()=>{ie.source=!0,O.signal(Y.signal,fe)})}},Y.debounce&&(ie.update=Object(we.n)(Y.debounce,ie.update))),(Y.input==null&&Y.element?D8:T8)(ie,N,Y,O),ie.active||(O.on(O._signals[Y.signal],null,()=>{ie.source?ie.source=!1:ie.set(O.signal(Y.signal))}),ie.active=!0)})(n,w.element||t,w)})),n},toImageURL:async function(e,t){e!==Ar.Canvas&&e!==Ar.SVG&&e!==Ar.PNG&&Object(we.o)("Unrecognized image type: "+e);const n=await bC(this,e,t);return e===Ar.SVG?function(r,i){const s=new Blob([r],{type:i});return window.URL.createObjectURL(s)}(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")},toCanvas:async function(e,t){return(await bC(this,Ar.Canvas,e,t)).canvas()},toSVG:async function(e){return(await bC(this,Ar.SVG,e)).svg()},getState:function(e){return this._runtime.getState(e||{data:B8,signals:P8,recurse:!0})},setState:function(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}});const z8="view",hk="[",dk="]",WT="{",VT="}",U8=":",qT=",",W8="@",V8=">",q8=/[[\]{}]/,H8={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let HT,GT;function Mx(e,t,n,r,i){const s=e.length;let f,v=0;for(;t<s;++t){if(f=e[t],!v&&f===n)return t;i&&i.indexOf(f)>=0?--v:r&&r.indexOf(f)>=0&&++v}return t}function $T(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=Mx(e,i,qT,hk+WT,dk+VT),t.push(e.substring(r,i).trim()),r=++i;if(t.length===0)throw"Empty event selector: "+e;return t}function wC(e){return e[0]==="["?function(t){const n=t.length;let r,i=1;if((i=Mx(t,i,dk,hk,dk))===n)throw"Empty between selector: "+t;if((r=$T(t.substring(1,i))).length!==2)throw"Between selector must have two elements: "+t;if((t=t.slice(i+1).trim())[0]!==V8)throw"Expected '>' after between selector: "+t;r=r.map(wC);const s=wC(t.slice(1).trim());return s.between?{between:r,stream:s}:(s.between=r,s)}(e):function(t){const n={source:HT},r=[];let i,s,f=[0,0],v=0,w=0,O=t.length,N=0;if(t[O-1]===VT){if(!((N=t.lastIndexOf(WT))>=0))throw"Unmatched right brace: "+t;try{f=function(L){const Y=L.split(qT);if(!L.length||Y.length>2)throw L;return Y.map(ie=>{const fe=+ie;if(fe!=fe)throw L;return fe})}(t.substring(N+1,O-1))}catch{throw"Invalid throttle specification: "+t}t=t.slice(0,N).trim(),O=t.length,N=0}if(!O)throw t;if(t[0]===W8&&(v=++N),(i=Mx(t,N,U8))<O&&(r.push(t.substring(w,i).trim()),w=N=++i),(N=Mx(t,N,hk))===O)r.push(t.substring(w,O).trim());else if(r.push(t.substring(w,N).trim()),s=[],(w=++N)===O)throw"Unmatched left bracket: "+t;for(;N<O;){if((N=Mx(t,N,dk))===O)throw"Unmatched left bracket: "+t;if(s.push(t.substring(w,N).trim()),N<O-1&&t[++N]!==hk)throw"Expected left bracket: "+t;w=++N}if(!(O=r.length)||q8.test(r[O-1]))throw"Invalid event selector: "+t;return O>1?(n.type=r[1],v?n.markname=r[0].slice(1):function(L){return GT[L]}(r[0])?n.marktype=r[0]:n.source=r[0]):n.type=r[0],n.type.slice(-1)==="!"&&(n.consume=!0,n.type=n.type.slice(0,-1)),s!=null&&(n.filter=s),f[0]&&(n.throttle=f[0]),f[1]&&(n.debounce=f[1]),n}(e)}const jx=e=>+e||0,G8=e=>({top:e,bottom:e,left:e,right:e}),hd=e=>Object(we.H)(e)&&!Object(we.B)(e)?Object(we.p)({},e):{value:e};function KT(e,t,n,r){return n!=null?(Object(we.H)(n)&&!Object(we.B)(n)||Object(we.B)(n)&&n.length&&Object(we.H)(n[0])?e.update[t]=n:e[r||"enter"][t]={value:n},1):0}function Hd(e,t,n){for(const r in t)KT(e,r,t[r]);for(const r in n)KT(e,r,n[r],"update")}function gb(e,t,n){for(const r in t)n&&Object(we.w)(n,r)||(e[r]=Object(we.p)(e[r]||{},t[r]));return e}function vb(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const kC="mark",_C="frame",EC="scope",$8="axis",K8="axis-domain",X8="axis-grid",Y8="axis-label",J8="axis-tick",Q8="axis-title",Z8="legend",eB="legend-band",tB="legend-entry",nB="legend-gradient",XT="legend-label",rB="legend-symbol",iB="legend-title",oB="title",aB="title-text",sB="title-subtitle";function CC(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const YT=e=>Object(we.J)(e)?Object(we.Ba)(e):e.signal?`(${e.signal})`:JT(e);function pk(e){if(e.gradient!=null)return function(n){const r=[n.start,n.stop,n.count].map(i=>i==null?null:Object(we.Ba)(i));for(;r.length&&Object(we.W)(r)==null;)r.pop();return r.unshift(YT(n.gradient)),`gradient(${r.join(",")})`}(e);let t=e.signal?`(${e.signal})`:e.color?function(n){return n.c?mk("hcl",n.h,n.c,n.l):n.h||n.s?mk("hsl",n.h,n.s,n.l):n.l||n.a?mk("lab",n.l,n.a,n.b):n.r||n.g||n.b?mk("rgb",n.r,n.g,n.b):null}(e.color):e.field!=null?JT(e.field):e.value!==void 0?Object(we.Ba)(e.value):void 0;return e.scale!=null&&(t=function(n,r){const i=YT(n.scale);return n.range!=null?r=`lerp(_range(${i}), ${+n.range})`:(r!==void 0&&(r=`_scale(${i}, ${r})`),n.band&&(r=(r?r+"+":"")+`_bandwidth(${i})`+(+n.band==1?"":"*"+gk(n.band)),n.extra&&(r=`(datum.extra ? _scale(${i}, datum.extra.value) : ${r})`)),r==null&&(r="0")),r}(e,t)),t===void 0&&(t=null),e.exponent!=null&&(t=`pow(${t},${gk(e.exponent)})`),e.mult!=null&&(t+=`*${gk(e.mult)}`),e.offset!=null&&(t+=`+${gk(e.offset)}`),e.round&&(t=`round(${t})`),t}const mk=(e,t,n,r)=>`(${e}(${[t,n,r].map(pk).join(",")})+'')`;function gk(e){return Object(we.H)(e)?"("+pk(e)+")":e}function JT(e){return function t(n){let r,i,s;if(n.signal)r="datum",s=n.signal;else if(n.group||n.parent){for(i=Math.max(1,n.level||1),r="item";i-- >0;)r+=".mark.group";n.parent?(s=n.parent,r+=".datum"):s=n.group}else n.datum?(r="datum",s=n.datum):Object(we.o)("Invalid field reference: "+Object(we.Ba)(n));return n.signal||(s=Object(we.J)(s)?Object(we.Aa)(s).map(we.Ba).join("]["):t(s)),r+"["+s+"]"}(Object(we.H)(e)?e:{datum:e})}function QT(e,t,n,r,i,s){const f={};(s=s||{}).encoders={$encode:f},e=function(v,w,O,N,L){const Y={},ie={};let fe,ve,Be;for(ve in ve="lineBreak",w!=="text"||L[ve]==null||vb(ve,v)||CC(Y,ve,L[ve]),(O=="legend"||String(O).startsWith("axis"))&&(O=null),Be=O===_C?L.group:O===kC?Object(we.p)({},L.mark,L[w]):null)vb(ve,v)||(ve==="fill"||ve==="stroke")&&(vb("fill",v)||vb("stroke",v))||CC(Y,ve,Be[ve]);for(ve in Object(we.i)(N).forEach(We=>{const Ve=L.style&&L.style[We];for(const ct in Ve)vb(ct,v)||CC(Y,ct,Ve[ct])}),v=Object(we.p)({},v),Y)(Be=Y[ve]).signal?(fe=fe||{})[ve]=Be:ie[ve]=Be;return v.enter=Object(we.p)(ie,v.enter),fe&&(v.update=Object(we.p)(fe,v.update)),v}(e,t,n,r,i.config);for(const v in e)f[v]=uB(e[v],t,s,i);return s}function uB(e,t,n,r){const i={},s={};for(const f in e)e[f]!=null&&(i[f]=lB(cB(e[f]),r,n,s));return{$expr:{marktype:t,channels:i},$fields:Object.keys(s),$output:Object.keys(e)}}function cB(e){return Object(we.B)(e)?function(t){let n="";return t.forEach(r=>{const i=pk(r);n+=r.test?`(${r.test})?${i}:`:i}),Object(we.W)(n)===":"&&(n+="null"),n}(e):pk(e)}function lB(e,t,n,r){const i=Tv(e,t);return i.$fields.forEach(s=>r[s]=1),Object(we.p)(n,i.$params),i.$expr}const fB="outer",hB=["value","update","init","react","bind"];function ZT(e,t){Object(we.o)(e+' for "outer" push: '+Object(we.Ba)(t))}function eN(e,t){const n=e.name;if(e.push===fB)t.signals[n]||ZT("No prior signal definition",n),hB.forEach(r=>{e[r]!==void 0&&ZT("Invalid property ",r)});else{const r=t.addSignal(n,e.value);e.react===!1&&(r.react=!1),e.bind&&t.addBinding(n,e.bind)}}function AC(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function vk(e,t,n,r){return new AC(e,t,n,r)}function yk(e,t){return vk("operator",e,t)}function jo(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function Bx(e,t){return t?{$field:e,$name:t}:{$field:e}}const OC=Bx("key");function tN(e,t){return{$compare:e,$order:t}}const dB="descending";function bk(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const SC="scope",DC="view";function Sh(e){return e&&e.signal}function xk(e){if(Sh(e))return!0;if(Object(we.H)(e)){for(const t in e)if(xk(e[t]))return!0}return!1}function iv(e,t){return e!=null?e:t}function xy(e){return e&&e.signal||e}const nN="timer";function Px(e,t){return(e.merge?pB:e.stream?mB:e.type?gB:Object(we.o)("Invalid stream specification: "+Object(we.Ba)(e)))(e,t)}function pB(e,t){const n=TC({merge:e.merge.map(r=>Px(r,t))},e,t);return t.addStream(n).id}function mB(e,t){const n=TC({stream:Px(e.stream,t)},e,t);return t.addStream(n).id}function gB(e,t){let n;e.type===nN?(n=t.event(nN,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(function(i){return i===SC?DC:i||DC}(e.source),e.type);const r=TC({stream:n},e,t);return Object.keys(r).length===1?n:t.addStream(r).id}function TC(e,t,n){let r=t.between;return r&&(r.length!==2&&Object(we.o)('Stream "between" parameter must have 2 entries: '+Object(we.Ba)(t)),e.between=[Px(r[0],n),Px(r[1],n)]),r=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&r.push(function(i,s,f){const v="event.item";return v+(i&&i!=="*"?"&&"+v+".mark.marktype==='"+i+"'":"")+(f?"&&"+v+".mark.role==='"+f+"'":"")+(s?"&&"+v+".mark.name==='"+s+"'":"")}(t.marktype,t.markname,t.markrole)),t.source===SC&&r.push("inScope(event.item)"),r.length&&(e.filter=Tv("("+r.join(")&&(")+")",n).$expr),(r=t.throttle)!=null&&(e.throttle=+r),(r=t.debounce)!=null&&(e.debounce=+r),t.consume&&(e.consume=!0),e}const vB={code:"_.$value",ast:{type:"Identifier",value:"value"}};function yB(e,t,n){const r=e.encode,i={target:n};let s=e.events,f=e.update,v=[];s||Object(we.o)("Signal update missing events specification."),Object(we.J)(s)&&(s=function(w,O,N){return HT=O||z8,GT=N||H8,$T(w.trim()).map(wC)}(s,t.isSubscope()?SC:DC)),s=Object(we.i)(s).filter(w=>w.signal||w.scale?(v.push(w),0):1),v.length>1&&(v=[function(w){return{signal:"["+w.map(O=>O.scale?'scale("'+O.scale+'")':O.signal)+"]"}}(v)]),s.length&&v.push(s.length>1?{merge:s}:s[0]),r!=null&&(f&&Object(we.o)("Signal encode and update are mutually exclusive."),f="encode(item(),"+Object(we.Ba)(r)+")"),i.update=Object(we.J)(f)?Tv(f,t):f.expr!=null?Tv(f.expr,t):f.value!=null?f.value:f.signal!=null?{$expr:vB,$params:{$value:t.signalRef(f.signal)}}:Object(we.o)("Invalid signal update specification."),e.force&&(i.options={force:!0}),v.forEach(w=>t.addUpdate(Object(we.p)(function(O,N){return{source:O.signal?N.signalRef(O.signal):O.scale?N.scaleRef(O.scale):Px(O,N)}}(w,t),i)))}const ic=e=>(t,n,r)=>vk(e,n,t||void 0,r),rN=ic("aggregate"),bB=ic("axisticks"),iN=ic("bound"),ov=ic("collect"),oN=ic("compare"),xB=ic("datajoin"),aN=ic("encode"),wB=ic("expression"),kB=ic("facet"),_B=ic("field"),EB=ic("key"),CB=ic("legendentries"),AB=ic("load"),OB=ic("mark"),SB=ic("multiextent"),DB=ic("multivalues"),TB=ic("overlap"),NB=ic("params"),sN=ic("prefacet"),IB=ic("projection"),FB=ic("proxy"),RB=ic("relay"),uN=ic("render"),MB=ic("scale"),wy=ic("sieve"),jB=ic("sortitems"),cN=ic("viewlayout"),BB=ic("values");let PB=0;const lN={min:"min",max:"max",count:"sum"};function LB(e,t){const n=t.getScale(e.name).params;let r;for(r in n.domain=fN(e.domain,e,t),e.range!=null&&(n.range=function i(s,f,v){const w=f.config.range;let O=s.range;if(O.signal)return f.signalRef(O.signal);if(Object(we.J)(O)){if(w&&Object(we.w)(w,O))return s=Object(we.p)({},s,{range:w[O]}),i(s,f,v);O==="width"?O=[0,{signal:"width"}]:O==="height"?O=Zh(s.type)?[0,{signal:"height"}]:[{signal:"height"},0]:Object(we.o)("Unrecognized scale range value: "+Object(we.Ba)(O))}else{if(O.scheme)return v.scheme=Object(we.B)(O.scheme)?wk(O.scheme,f):B0(O.scheme,f),O.extent&&(v.schemeExtent=wk(O.extent,f)),void(O.count&&(v.schemeCount=B0(O.count,f)));if(O.step)return void(v.rangeStep=B0(O.step,f));if(Zh(s.type)&&!Object(we.B)(O))return fN(O,s,f);Object(we.B)(O)||Object(we.o)("Unsupported range type: "+Object(we.Ba)(O))}return O.map(N=>(Object(we.B)(N)?wk:B0)(N,f))}(e,t,n)),e.interpolate!=null&&function(i,s){s.interpolate=B0(i.type||i),i.gamma!=null&&(s.interpolateGamma=B0(i.gamma))}(e.interpolate,n),e.nice!=null&&(n.nice=function(i){return Object(we.H)(i)?{interval:B0(i.interval),step:B0(i.step)}:B0(i)}(e.nice)),e.bins!=null&&(n.bins=function(i,s){return i.signal||Object(we.B)(i)?wk(i,s):s.objectProperty(i)}(e.bins,t)),e)Object(we.w)(n,r)||r==="name"||(n[r]=B0(e[r],t))}function B0(e,t){return Object(we.H)(e)?e.signal?t.signalRef(e.signal):Object(we.o)("Unsupported object: "+Object(we.Ba)(e)):e}function wk(e,t){return e.signal?t.signalRef(e.signal):e.map(n=>B0(n,t))}function kk(e){Object(we.o)("Can not find data set: "+Object(we.Ba)(e))}function fN(e,t,n){if(e)return e.signal?n.signalRef(e.signal):(Object(we.B)(e)?function(r,i,s){return r.map(f=>B0(f,s))}:e.fields?function(r,i,s){const f=r.data,v=r.fields.reduce((w,O)=>(O=Object(we.J)(O)?{data:f,field:O}:Object(we.B)(O)||O.signal?function(N,L){const Y="_:vega:_"+PB++,ie=ov({});if(Object(we.B)(N))ie.value={$ingest:N};else if(N.signal){const fe="setdata("+Object(we.Ba)(Y)+","+N.signal+")";ie.params.input=L.signalRef(fe)}return L.addDataPipeline(Y,[ie,wy({})]),{data:Y,field:"data"}}(O,s):O,w.push(O),w),[]);return(Zh(i.type)?function(w,O,N){const L=hN(w.sort,!0);let Y,ie;const fe=N.map(We=>{const Ve=O.getData(We.data);return Ve||kk(We.data),Ve.countsRef(O,We.field,L)}),ve={groupby:OC,pulse:fe};L&&(Y=L.op||"count",ie=L.field?bk(Y,L.field):"count",ve.ops=[lN[Y]],ve.fields=[O.fieldRef(ie)],ve.as=[ie]),Y=O.add(rN(ve));const Be=O.add(ov({pulse:jo(Y)}));return jo(ie=O.add(BB({field:OC,sort:O.sortRef(L),pulse:jo(Be)})))}:Xm(i.type)?function(w,O,N){const L=N.map(Y=>{const ie=O.getData(Y.data);return ie||kk(Y.data),ie.domainRef(O,Y.field)});return jo(O.add(DB({values:L})))}:function(w,O,N){const L=N.map(Y=>{const ie=O.getData(Y.data);return ie||kk(Y.data),ie.extentRef(O,Y.field)});return jo(O.add(SB({extents:L})))})(r,s,v)}:function(r,i,s){const f=s.getData(r.data);return f||kk(r.data),Zh(i.type)?f.valuesRef(s,r.field,hN(r.sort,!1)):Xm(i.type)?f.domainRef(s,r.field):f.extentRef(s,r.field)})(e,t,n);t.domainMin==null&&t.domainMax==null||Object(we.o)("No scale domain defined for domainMin/domainMax to override.")}function hN(e,t){return e&&(e.field||e.op?e.field||e.op==="count"?t&&e.field&&e.op&&!lN[e.op]&&Object(we.o)("Multiple domain scales can not be sorted using "+e.op):Object(we.o)("No field provided for sort aggregate op: "+e.op):Object(we.H)(e)?e.field="key":e={field:"key"}),e}function NC(e,t,n){return Object(we.B)(e)?e.map(r=>NC(r,t,n)):Object(we.H)(e)?e.signal?n.signalRef(e.signal):t==="fit"?e:Object(we.o)("Unsupported parameter object: "+Object(we.Ba)(e)):e}const av="top",B1="bottom",zB="vertical",UB="start",WB="end",IC="index",FC="label",VB="offset",yb="perc",qB="perc2",P0="value",Lx="guide-label",RC="guide-title",HB="group-title",GB="group-subtitle",dN="symbol",_k="gradient",MC="discrete",jC="size",BC=[jC,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],zx={name:1,style:1,interactive:1},Us={value:0},L0={value:1},Ek="group",pN="rect",PC="rule",$B="symbol",ky="text";function Ux(e){return e.type=Ek,e.interactive=e.interactive||!1,e}function xg(e,t){const n=(r,i)=>iv(e[r],iv(t[r],i));return n.isVertical=r=>zB===iv(e.direction,t.direction||(r?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>iv(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>iv(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>iv(e.columns,iv(t.columns,+n.isVertical(!0))),n}function mN(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function Ck(e,t,n){return`item.anchor === '${UB}' ? ${e} : item.anchor === '${WB}' ? ${t} : ${n}`}const LC=Ck(Object(we.Ba)("left"),Object(we.Ba)("right"),Object(we.Ba)("center"));function i0(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=gb(e.encode,t,zx)):e.interactive=!1,e}const KB=`datum.${yb}<=0?"left":datum.${yb}>=1?"right":"center"`,XB=`datum.${yb}<=0?"${B1}":datum.${yb}>=1?"${av}":"middle"`;function gN(e,t,n,r){const i=xg(e,t),s=i.isVertical(),f=hd(i.gradientThickness()),v=i.gradientLength();let w,O,N,L,Y=i("labelOverlap"),ie="";const fe={enter:w={opacity:Us},update:O={opacity:L0,text:{field:FC}},exit:{opacity:Us}};return Hd(fe,{fill:i("labelColor"),fillOpacity:i("labelOpacity"),font:i("labelFont"),fontSize:i("labelFontSize"),fontStyle:i("labelFontStyle"),fontWeight:i("labelFontWeight"),limit:iv(e.labelLimit,t.gradientLabelLimit)}),s?(w.align={value:"left"},w.baseline=O.baseline={signal:XB},N="y",L="x",ie="1-"):(w.align=O.align={signal:KB},w.baseline={value:"top"},N="x",L="y"),w[N]=O[N]={signal:ie+"datum."+yb,mult:v},w[L]=O[L]=f,f.offset=iv(e.labelOffset,t.gradientLabelOffset)||0,Y=Y?{separation:i("labelSeparation"),method:Y,order:"datum."+IC}:void 0,i0({type:ky,role:XT,style:Lx,key:P0,from:r,encode:fe,overlap:Y},n)}const Ak='(item.orient === "left" || item.orient === "right")',YB=`datum.vgrad && ${Ak}`,JB=Ck('"top"','"bottom"','"middle"'),QB=`datum.vgrad && item.orient === "right" ? (${Ck('"right"','"left"','"center"')}) : (${Ak} && !(datum.vgrad && item.orient === "left")) ? "left" : ${LC}`,ZB=`item._anchor || (${Ak} ? "middle" : "start")`,e7=`${YB} ? (item.orient === "left" ? -90 : 90) : 0`,t7=`${Ak} ? (datum.vgrad ? (item.orient === "right" ? "bottom" : "top") : ${JB}) : "top"`;function vN(e){return Object(we.H)(e)&&e.signal?e.signal:Object(we.Ba)(e)}function yN(e){const t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")&&t.indexOf("title")?e.type===Ek?EC:t||kC:t}function zC(e,t){const n=Yt(e.type);n||Object(we.o)("Unrecognized transform type: "+Object(we.Ba)(e.type));const r=vk(n.type.toLowerCase(),null,bN(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(r)),r.metadata=n.metadata||{},r}function bN(e,t,n){const r={},i=e.params.length;for(let s=0;s<i;++s){const f=e.params[s];r[f.name]=n7(f,t,n)}return r}function n7(e,t,n){const r=e.type,i=t[e.name];return r==="index"?function(s,f,v){return Object(we.J)(f.from)||Object(we.o)('Lookup "from" parameter must be a string literal.'),v.getData(f.from).lookupRef(v,f.key)}(0,t,n):i!==void 0?r==="param"?function(s,f,v){const w=f[s.name];return s.array?(Object(we.B)(w)||Object(we.o)("Expected an array of sub-parameters. Instead: "+Object(we.Ba)(w)),w.map(O=>wN(s,O,v))):wN(s,w,v)}(e,t,n):r==="projection"?n.projectionRef(t[e.name]):e.array&&!Sh(i)?i.map(s=>xN(e,s,n)):xN(e,i,n):void(e.required&&Object(we.o)("Missing required "+Object(we.Ba)(t.type)+" parameter: "+Object(we.Ba)(e.name)))}function xN(e,t,n){const r=e.type;if(Sh(t))return kN(r)?Object(we.o)("Expression references can not be signals."):UC(r)?n.fieldRef(t):_N(r)?n.compareRef(t):n.signalRef(t.signal);{const i=e.expr||UC(r);return i&&r7(t)?n.exprRef(t.expr,t.as):i&&i7(t)?Bx(t.field,t.as):kN(r)?Tv(t,n):o7(r)?jo(n.getData(t).values):UC(r)?Bx(t):_N(r)?n.compareRef(t):t}}function wN(e,t,n){const r=e.params.length;let i;for(let f=0;f<r;++f){i=e.params[f];for(const v in i.key)if(i.key[v]!==t[v]){i=null;break}if(i)break}i||Object(we.o)("Unsupported parameter: "+Object(we.Ba)(t));const s=Object(we.p)(bN(i,t,n),i.key);return jo(n.add(NB(s)))}const r7=e=>e&&e.expr,i7=e=>e&&e.field,o7=e=>e==="data",kN=e=>e==="expr",UC=e=>e==="field",_N=e=>e==="compare";function Ok(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:jo(t.getData(e.data).output)}function _y(e,t,n,r,i){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=i,this.index={}}function EN(e){return Object(we.J)(e)?e:null}function CN(e,t,n){const r=bk(n.op,n.field);let i;if(t.ops){for(let s=0,f=t.as.length;s<f;++s)if(t.as[s]===r)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((i=n.op.signal)?e.signalRef(i):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(r))}function Wx(e,t,n,r,i,s,f){const v=t[n]||(t[n]={}),w=function(Y){return Object(we.H)(Y)?(Y.order===dB?"-":"+")+bk(Y.op,Y.field):""}(s);let O,N,L=EN(i);if(L!=null&&(e=t.scope,O=v[L+=w?"|"+w:""]),!O){const Y=s?{field:OC,pulse:t.countsRef(e,i,s)}:{field:e.fieldRef(i),pulse:jo(t.output)};w&&(Y.sort=e.sortRef(s)),N=e.add(vk(r,void 0,Y)),f&&(t.index[i]=N),O=jo(N),L!=null&&(v[L]=O)}return O}function AN(e,t,n){const r=e.remove,i=e.insert,s=e.toggle,f=e.modify,v=e.values,w=t.add(yk()),O=Tv("if("+e.trigger+',modify("'+n+'",'+[i,r,s,f,v].map(N=>N==null?"null":N).join(",")+"),0)",t);w.update=O.$expr,w.params=O.$params}function Sk(e,t){const n=yN(e),r=e.type===Ek,i=e.from&&e.from.facet,s=e.overlap;let f,v,w,O,N,L,Y,ie=e.layout||n===EC||n===_C;const fe=n===kC||ie||i,ve=function(dt,kt,wt){let dn,Dn,wn,Xn,Kn;return dt?(dn=dt.facet)&&(kt||Object(we.o)("Only group marks can be faceted."),dn.field!=null?Xn=Kn=Ok(dn,wt):(dt.data?Kn=jo(wt.getData(dt.data).aggregate):((wn=zC(Object(we.p)({type:"aggregate",groupby:Object(we.i)(dn.groupby)},dn.aggregate),wt)).params.key=wt.keyRef(dn.groupby),wn.params.pulse=Ok(dn,wt),Xn=Kn=jo(wt.add(wn))),Dn=wt.keyRef(dn.groupby,!0))):Xn=jo(wt.add(ov(null,[{}]))),Xn||(Xn=Ok(dt,wt)),{key:Dn,pulse:Xn,parent:Kn}}(e.from,r,t),Be=jo(v=t.add(xB({key:ve.key||(e.key?Bx(e.key):void 0),pulse:ve.pulse,clean:!r})));v=w=t.add(ov({pulse:Be}));const We=jo(v=t.add(OB({markdef:function(dt){return{marktype:dt.type,name:dt.name||void 0,role:dt.role||yN(dt),zindex:+dt.zindex||void 0,aria:dt.aria,description:dt.description}}(e),interactive:function(dt,kt){return dt&&dt.signal?kt.signalRef(dt.signal):dt!==!1}(e.interactive,t),clip:function(dt,kt){let wt;return Object(we.H)(dt)&&(dt.signal?wt=dt.signal:dt.path?wt="pathShape("+vN(dt.path)+")":dt.sphere&&(wt="geoShape("+vN(dt.sphere)+', {type: "Sphere"})')),wt?kt.signalRef(wt):!!dt}(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:jo(v)})));(v=O=t.add(aN(QT(e.encode,e.type,n,e.style,t,{mod:!1,pulse:We})))).params.parent=t.encode(),e.transform&&e.transform.forEach(dt=>{const kt=zC(dt,t),wt=kt.metadata;(wt.generates||wt.changes)&&Object(we.o)("Mark transforms should not generate new data."),wt.nomod||(O.params.mod=!0),kt.params.pulse=jo(v),t.add(v=kt)}),e.sort&&(v=t.add(jB({sort:t.compareRef(e.sort),pulse:jo(v)})));const Ve=jo(v);(i||ie)&&(L=jo(ie=t.add(cN({layout:t.objectProperty(e.layout),legends:t.legends,mark:We,pulse:Ve}))));const ct=t.add(iN({mark:We,pulse:L||Ve}));Y=jo(ct),r&&(fe&&((f=t.operators).pop(),ie&&f.pop()),t.pushState(Ve,L||Y,Be),i?function(dt,kt,wt){const dn=dt.from.facet,Dn=dn.name,wn=Ok(dn,kt);let Xn;dn.name||Object(we.o)("Facet must have a name: "+Object(we.Ba)(dn)),dn.data||Object(we.o)("Facet must reference a data set: "+Object(we.Ba)(dn)),dn.field?Xn=kt.add(sN({field:kt.fieldRef(dn.field),pulse:wn})):dn.groupby?Xn=kt.add(kB({key:kt.keyRef(dn.groupby),group:jo(kt.proxy(wt.parent)),pulse:wn})):Object(we.o)("Facet must specify groupby or field: "+Object(we.Ba)(dn));const Kn=kt.fork(),ir=Kn.add(ov()),sr=Kn.add(wy({pulse:jo(ir)}));Kn.addData(Dn,new _y(Kn,ir,ir,sr)),Kn.addSignal("parent",null),Xn.params.subflow={$subflow:Kn.parse(dt).toRuntime()}}(e,t,ve):fe?function(dt,kt,wt){const dn=kt.add(sN({pulse:wt.pulse})),Dn=kt.fork();Dn.add(wy()),Dn.addSignal("parent",null),dn.params.subflow={$subflow:Dn.parse(dt).toRuntime()}}(e,t,ve):t.parse(e),t.popState(),fe&&(ie&&f.push(ie),f.push(ct))),s&&(Y=function(dt,kt,wt){const dn=dt.method,Dn=dt.bound,wn=dt.separation,Xn={separation:Sh(wn)?wt.signalRef(wn.signal):wn,method:Sh(dn)?wt.signalRef(dn.signal):dn,pulse:kt};if(dt.order&&(Xn.sort=wt.compareRef({field:dt.order})),Dn){const Kn=Dn.tolerance;Xn.boundTolerance=Sh(Kn)?wt.signalRef(Kn.signal):+Kn,Xn.boundScale=wt.scaleRef(Dn.scale),Xn.boundOrient=Dn.orient}return jo(wt.add(TB(Xn)))}(s,Y,t));const lt=t.add(uN({pulse:Y})),mt=t.add(wy({pulse:jo(lt)},void 0,t.parent()));e.name!=null&&(N=e.name,t.addData(N,new _y(t,w,lt,mt)),e.on&&e.on.forEach(dt=>{(dt.insert||dt.remove||dt.toggle)&&Object(we.o)("Marks only support modify triggers."),AN(dt,t,N)}))}function a7(e,t){const n=t.config.legend,r=e.encode||{},i=xg(e,n),s=r.legend||{},f=s.name||void 0,v=s.interactive,w=s.style,O={};let N,L,Y,ie=0;BC.forEach(Ve=>e[Ve]?(O[Ve]=e[Ve],ie=ie||e[Ve]):0),ie||Object(we.o)("Missing valid scale for legend.");const fe=function(Ve,ct){let lt=Ve.type||dN;return Ve.type||function(mt){return BC.reduce((dt,kt)=>dt+(mt[kt]?1:0),0)}(Ve)!==1||!Ve.fill&&!Ve.stroke||(lt=Qh(ct)?_k:rm(ct)?MC:dN),lt!==_k?lt:rm(ct)?MC:_k}(e,t.scaleType(ie)),ve={title:e.title!=null,scales:O,type:fe,vgrad:fe!=="symbol"&&i.isVertical()},Be=jo(t.add(ov(null,[ve]))),We=jo(t.add(CB(L={type:fe,scale:t.scaleRef(ie),count:t.objectProperty(i("tickCount")),limit:t.property(i("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return fe===_k?(Y=[function(Ve,ct,lt,mt){const dt=xg(Ve,lt),kt=dt.isVertical(),wt=dt.gradientThickness(),dn=dt.gradientLength();let Dn,wn,Xn,Kn,ir;kt?(wn=[0,1],Xn=[0,0],Kn=wt,ir=dn):(wn=[0,0],Xn=[1,0],Kn=dn,ir=wt);const sr={enter:Dn={opacity:Us,x:Us,y:Us,width:hd(Kn),height:hd(ir)},update:Object(we.p)({},Dn,{opacity:L0,fill:{gradient:ct,start:wn,stop:Xn}}),exit:{opacity:Us}};return Hd(sr,{stroke:dt("gradientStrokeColor"),strokeWidth:dt("gradientStrokeWidth")},{opacity:dt("gradientOpacity")}),i0({type:pN,role:nB,encode:sr},mt)}(e,ie,n,r.gradient),gN(e,n,r.labels,We)],L.count=L.count||t.signalRef(`max(2,2*floor((${xy(i.gradientLength())})/100))`)):fe===MC?Y=[function(Ve,ct,lt,mt,dt){const kt=xg(Ve,lt),wt=kt.isVertical(),dn=kt.gradientThickness(),Dn=kt.gradientLength();let wn,Xn,Kn,ir,sr="";wt?(wn="y",Kn="y2",Xn="x",ir="width",sr="1-"):(wn="x",Kn="x2",Xn="y",ir="height");const gr={opacity:Us,fill:{scale:ct,field:P0}};gr[wn]={signal:sr+"datum."+yb,mult:Dn},gr[Xn]=Us,gr[Kn]={signal:sr+"datum."+qB,mult:Dn},gr[ir]=hd(dn);const Vr={enter:gr,update:Object(we.p)({},gr,{opacity:L0}),exit:{opacity:Us}};return Hd(Vr,{stroke:kt("gradientStrokeColor"),strokeWidth:kt("gradientStrokeWidth")},{opacity:kt("gradientOpacity")}),i0({type:pN,role:eB,key:P0,from:dt,encode:Vr},mt)}(e,ie,n,r.gradient,We),gN(e,n,r.labels,We)]:(N=function(Ve,ct){const lt=xg(Ve,ct);return{align:lt("gridAlign"),columns:lt.entryColumns(),center:{row:!0,column:!1},padding:{row:lt("rowPadding"),column:lt("columnPadding")}}}(e,n),Y=[function(Ve,ct,lt,mt,dt){const kt=xg(Ve,ct),wt=lt.entries,dn=!(!wt||!wt.interactive),Dn=wt?wt.name:void 0,wn=kt("clipHeight"),Xn=kt("symbolOffset"),Kn={data:"value"},ir=`(${dt}) ? datum.${VB} : datum.${jC}`,sr=wn?hd(wn):{field:jC},gr=`datum.${IC}`,Vr=`max(1, ${dt})`;let hi,Qr,Ni,ro,oo;sr.mult=.5,hi={enter:Qr={opacity:Us,x:{signal:ir,mult:.5,offset:Xn},y:sr},update:Ni={opacity:L0,x:Qr.x,y:Qr.y},exit:{opacity:Us}};let Po=null,ho=null;Ve.fill||(Po=ct.symbolBaseFillColor,ho=ct.symbolBaseStrokeColor),Hd(hi,{fill:kt("symbolFillColor",Po),shape:kt("symbolType"),size:kt("symbolSize"),stroke:kt("symbolStrokeColor",ho),strokeDash:kt("symbolDash"),strokeDashOffset:kt("symbolDashOffset"),strokeWidth:kt("symbolStrokeWidth")},{opacity:kt("symbolOpacity")}),BC.forEach(ys=>{Ve[ys]&&(Ni[ys]=Qr[ys]={scale:Ve[ys],field:P0})});const ao=i0({type:$B,role:rB,key:P0,from:Kn,clip:!!wn||void 0,encode:hi},lt.symbols),xo=hd(Xn);xo.offset=kt("labelOffset"),Hd(hi={enter:Qr={opacity:Us,x:{signal:ir,offset:xo},y:sr},update:Ni={opacity:L0,text:{field:FC},x:Qr.x,y:Qr.y},exit:{opacity:Us}},{align:kt("labelAlign"),baseline:kt("labelBaseline"),fill:kt("labelColor"),fillOpacity:kt("labelOpacity"),font:kt("labelFont"),fontSize:kt("labelFontSize"),fontStyle:kt("labelFontStyle"),fontWeight:kt("labelFontWeight"),limit:kt("labelLimit")});const _a=i0({type:ky,role:XT,style:Lx,key:P0,from:Kn,encode:hi},lt.labels);return hi={enter:{noBound:{value:!wn},width:Us,height:wn?hd(wn):Us,opacity:Us},exit:{opacity:Us},update:Ni={opacity:L0,row:{signal:null},column:{signal:null}}},kt.isVertical(!0)?(ro=`ceil(item.mark.items.length / ${Vr})`,Ni.row.signal=`${gr}%${ro}`,Ni.column.signal=`floor(${gr} / ${ro})`,oo={field:["row",gr]}):(Ni.row.signal=`floor(${gr} / ${Vr})`,Ni.column.signal=`${gr} % ${Vr}`,oo={field:gr}),Ni.column.signal=`(${dt})?${Ni.column.signal}:${gr}`,Ux({role:EC,from:mt={facet:{data:mt,name:"value",groupby:IC}},encode:gb(hi,wt,zx),marks:[ao,_a],name:Dn,interactive:dn,sort:oo})}(e,n,r,We,xy(N.columns))],L.size=function(Ve,ct,lt){const mt=xy(ON("size",Ve,lt)),dt=xy(ON("strokeWidth",Ve,lt)),kt=xy(function(wt,dn,Dn){return mN("fontSize",wt)||function(wn,Xn,Kn){const ir=Xn.config.style[Kn];return ir&&ir[wn]}("fontSize",dn,Dn)}(lt[1].encode,ct,Lx));return Tv(`max(ceil(sqrt(${mt})+${dt}),${kt})`,ct)}(e,t,Y[0].marks)),Y=[Ux({role:tB,from:Be,encode:{enter:{x:{value:0},y:{value:0}}},marks:Y,layout:N,interactive:v})],ve.title&&Y.push(function(Ve,ct,lt,mt){const dt=xg(Ve,ct),kt={enter:{opacity:Us},update:{opacity:L0,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:Us}};return Hd(kt,{orient:dt("titleOrient"),_anchor:dt("titleAnchor"),anchor:{signal:ZB},angle:{signal:e7},align:{signal:QB},baseline:{signal:t7},text:Ve.title,fill:dt("titleColor"),fillOpacity:dt("titleOpacity"),font:dt("titleFont"),fontSize:dt("titleFontSize"),fontStyle:dt("titleFontStyle"),fontWeight:dt("titleFontWeight"),limit:dt("titleLimit"),lineHeight:dt("titleLineHeight")},{align:dt("titleAlign"),baseline:dt("titleBaseline")}),i0({type:ky,role:iB,style:RC,from:mt,encode:kt},lt)}(e,n,r.title,Be)),Sk(Ux({role:Z8,from:Be,encode:gb(function(Ve,ct,lt){const mt={enter:{},update:{}};return Hd(mt,{orient:Ve("orient"),offset:Ve("offset"),padding:Ve("padding"),titlePadding:Ve("titlePadding"),cornerRadius:Ve("cornerRadius"),fill:Ve("fillColor"),stroke:Ve("strokeColor"),strokeWidth:lt.strokeWidth,strokeDash:lt.strokeDash,x:Ve("legendX"),y:Ve("legendY"),format:ct.format,formatType:ct.formatType}),mt}(i,e,n),s,zx),marks:Y,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:f,interactive:v,style:w}),t)}function ON(e,t,n){return t[e]?`scale("${t[e]}",datum)`:mN(e,n[0].encode)}_y.fromEntries=function(e,t){const n=t.length,r=t[n-1],i=t[n-2];let s=t[0],f=null,v=1;for(s&&s.type==="load"&&(s=t[1]),e.add(t[0]);v<n;++v)t[v].params.pulse=jo(t[v-1]),e.add(t[v]),t[v].type==="aggregate"&&(f=t[v]);return new _y(e,s,i,r,f)},_y.prototype={countsRef(e,t,n){const r=this,i=r.counts||(r.counts={}),s=EN(t);let f,v,w;return s!=null&&(e=r.scope,f=i[s]),f?n&&n.field&&CN(e,f.agg.params,n):(w={groupby:e.fieldRef(t,"key"),pulse:jo(r.output)},n&&n.field&&CN(e,w,n),f={agg:v=e.add(rN(w)),ref:jo(f=e.add(ov({pulse:jo(v)})))},s!=null&&(i[s]=f)),f.ref},tuplesRef(){return jo(this.values)},extentRef(e,t){return Wx(e,this,"extent","extent",t,!1)},domainRef(e,t){return Wx(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return Wx(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return Wx(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return Wx(e,this,"indata","tupleindex",t,!0,!0)}};const s7='item.orient==="left"?-90:item.orient==="right"?90:0';function u7(e,t){const n=xg(e=Object(we.J)(e)?{text:e}:e,t.config.title),r=e.encode||{},i=r.group||{},s=i.name||void 0,f=i.interactive,v=i.style,w=[],O=jo(t.add(ov(null,[{}])));return w.push(function(N,L,Y,ie){const fe={value:0},ve=N.text,Be={enter:{opacity:fe},update:{opacity:{value:1}},exit:{opacity:fe}};return Hd(Be,{text:ve,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:L("dx"),dy:L("dy"),fill:L("color"),font:L("font"),fontSize:L("fontSize"),fontStyle:L("fontStyle"),fontWeight:L("fontWeight"),lineHeight:L("lineHeight")},{align:L("align"),angle:L("angle"),baseline:L("baseline")}),i0({type:ky,role:aB,style:HB,from:ie,encode:Be},Y)}(e,n,function(N){const L=N.encode;return L&&L.title||Object(we.p)({name:N.name,interactive:N.interactive,style:N.style},L)}(e),O)),e.subtitle&&w.push(function(N,L,Y,ie){const fe={value:0},ve=N.subtitle,Be={enter:{opacity:fe},update:{opacity:{value:1}},exit:{opacity:fe}};return Hd(Be,{text:ve,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:L("dx"),dy:L("dy"),fill:L("subtitleColor"),font:L("subtitleFont"),fontSize:L("subtitleFontSize"),fontStyle:L("subtitleFontStyle"),fontWeight:L("subtitleFontWeight"),lineHeight:L("subtitleLineHeight")},{align:L("align"),angle:L("angle"),baseline:L("baseline")}),i0({type:ky,role:sB,style:GB,from:ie,encode:Be},Y)}(e,n,r.subtitle,O)),Sk(Ux({role:oB,from:O,encode:function(N,L){const Y={enter:{},update:{}};return Hd(Y,{orient:N("orient"),anchor:N("anchor"),align:{signal:LC},angle:{signal:s7},limit:N("limit"),frame:N("frame"),offset:N("offset")||0,padding:N("subtitlePadding")}),gb(Y,L,zx)}(n,i),marks:w,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:s,interactive:f,style:v}),t)}function c7(e,t){const n=[];e.transform&&e.transform.forEach(r=>{n.push(zC(r,t))}),e.on&&e.on.forEach(r=>{AN(r,t,e.name)}),t.addDataPipeline(e.name,function(r,i,s){const f=[];let v,w,O,N,L,Y=null,ie=!1,fe=!1;for(r.values?Sh(r.values)||xk(r.format)?(f.push(SN(i,r)),f.push(Y=Ey())):f.push(Y=Ey({$ingest:r.values,$format:r.format})):r.url?xk(r.url)||xk(r.format)?(f.push(SN(i,r)),f.push(Y=Ey())):f.push(Y=Ey({$request:r.url,$format:r.format})):r.source&&(Y=v=Object(we.i)(r.source).map(ve=>jo(i.getData(ve).output)),f.push(null)),w=0,O=s.length;w<O;++w)N=s[w],L=N.metadata,Y||L.source||f.push(Y=Ey()),f.push(N),L.generates&&(fe=!0),L.modifies&&!fe&&(ie=!0),L.source?Y=N:L.changes&&(Y=null);return v&&(O=v.length-1,f[0]=RB({derive:ie,pulse:O?v:v[0]}),(ie||O)&&f.splice(1,0,Ey())),Y||f.push(Ey()),f.push(wy({})),f}(e,t,n))}function Ey(e){const t=ov({},e);return t.metadata={source:!0},t}function SN(e,t){return AB({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const DN=e=>e===B1||e===av,Dk=(e,t,n)=>Sh(e)?d7(e.signal,t,n):e==="left"||e===av?t:n,dd=(e,t,n)=>Sh(e)?f7(e.signal,t,n):DN(e)?t:n,sv=(e,t,n)=>Sh(e)?h7(e.signal,t,n):DN(e)?n:t,TN=(e,t,n)=>Sh(e)?p7(e.signal,t,n):e===av?{value:t}:{value:n},l7=(e,t,n)=>Sh(e)?m7(e.signal,t,n):e==="right"?{value:t}:{value:n},f7=(e,t,n)=>NN(`${e} === '${av}' || ${e} === '${B1}'`,t,n),h7=(e,t,n)=>NN(`${e} !== '${av}' && ${e} !== '${B1}'`,t,n),d7=(e,t,n)=>WC(`${e} === 'left' || ${e} === '${av}'`,t,n),p7=(e,t,n)=>WC(`${e} === '${av}'`,t,n),m7=(e,t,n)=>WC(`${e} === 'right'`,t,n),NN=(e,t,n)=>(t=t!=null?hd(t):t,n=n!=null?hd(n):n,IN(t)&&IN(n)?{signal:`${e} ? (${t=t?t.signal||Object(we.Ba)(t.value):null}) : (${n=n?n.signal||Object(we.Ba)(n.value):null})`}:[Object(we.p)({test:e},t)].concat(n||[])),IN=e=>e==null||Object.keys(e).length===1,WC=(e,t,n)=>({signal:`${e} ? (${bb(t)}) : (${bb(n)})`}),g7=(e,t,n,r,i)=>({signal:(r!=null?`${e} === 'left' ? (${bb(r)}) : `:"")+(n!=null?`${e} === '${B1}' ? (${bb(n)}) : `:"")+(i!=null?`${e} === 'right' ? (${bb(i)}) : `:"")+(t!=null?`${e} === '${av}' ? (${bb(t)}) : `:"")+"(null)"}),bb=e=>Sh(e)?e.signal:e==null?null:Object(we.Ba)(e),v7=(e,t)=>t===0?0:Sh(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t},xb=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function wb(e,t,n,r){let i;if(t&&Object(we.w)(t,e))return t[e];if(Object(we.w)(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=e[5].toLowerCase()+e.slice(6)}return r[RC][i]}if(e.startsWith("label")){switch(e){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=e[5].toLowerCase()+e.slice(6)}return r[Lx][i]}return null}function FN(e){const t={};for(const n of e)if(n)for(const r in n)t[r]=1;return Object.keys(t)}function RN(e,t){return{scale:e.scale,range:t}}function y7(e,t,n,r,i){const s=xg(e,t),f=e.orient,v=e.gridScale,w=Dk(f,1,-1),O=function(Ve,ct){if(ct!==1)if(Object(we.H)(Ve)){let lt=Ve=Object(we.p)({},Ve);for(;lt.mult!=null;){if(!Object(we.H)(lt.mult))return lt.mult=Sh(ct)?{signal:`(${lt.mult}) * (${ct.signal})`}:lt.mult*ct,Ve;lt=lt.mult=Object(we.p)({},lt.mult)}lt.mult=ct}else Ve=Sh(ct)?{signal:`(${ct.signal}) * (${Ve||0})`}:ct*(Ve||0);return Ve}(e.offset,w);let N,L,Y;const ie={enter:N={opacity:Us},update:Y={opacity:L0},exit:L={opacity:Us}};Hd(ie,{stroke:s("gridColor"),strokeCap:s("gridCap"),strokeDash:s("gridDash"),strokeDashOffset:s("gridDashOffset"),strokeOpacity:s("gridOpacity"),strokeWidth:s("gridWidth")});const fe={scale:e.scale,field:P0,band:i.band,extra:i.extra,offset:i.offset,round:s("tickRound")},ve=dd(f,{signal:"height"},{signal:"width"}),Be=v?{scale:v,range:0,mult:w,offset:O}:{value:0,offset:O},We=v?{scale:v,range:1,mult:w,offset:O}:Object(we.p)(ve,{mult:w,offset:O});return N.x=Y.x=dd(f,fe,Be),N.y=Y.y=sv(f,fe,Be),N.x2=Y.x2=sv(f,We),N.y2=Y.y2=dd(f,We),L.x=dd(f,fe),L.y=sv(f,fe),i0({type:PC,role:X8,key:P0,from:r,encode:ie},n)}function VC(e,t,n,r,i){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+r+","+i+")"}}function b7(e,t,n,r,i,s){const f=xg(e,t),v=e.orient,w=e.scale,O=Dk(v,-1,1),N=xy(f("labelFlush")),L=xy(f("labelFlushOffset")),Y=f("labelAlign"),ie=f("labelBaseline");let fe,ve=N===0||!!N;const Be=hd(i);Be.mult=O,Be.offset=hd(f("labelPadding")||0),Be.offset.mult=O;const We={scale:w,field:P0,band:.5,offset:function dn(Dn,wn){return wn?Dn?Object(we.H)(Dn)?Object.assign({},Dn,{offset:dn(Dn.offset,wn)}):{value:Dn,offset:wn}:wn:Dn}(s.offset,f("labelOffset"))},Ve=dd(v,ve?VC(w,N,'"left"','"right"','"center"'):{value:"center"},l7(v,"left","right")),ct=dd(v,TN(v,"bottom","top"),ve?VC(w,N,'"top"','"bottom"','"middle"'):{value:"middle"}),lt=VC(w,N,`-(${L})`,L,0);ve=ve&&L;const mt={opacity:Us,x:dd(v,We,Be),y:sv(v,We,Be)},dt={enter:mt,update:fe={opacity:L0,text:{field:FC},x:mt.x,y:mt.y,align:Ve,baseline:ct},exit:{opacity:Us,x:mt.x,y:mt.y}};Hd(dt,{dx:!Y&&ve?dd(v,lt):null,dy:!ie&&ve?sv(v,lt):null}),Hd(dt,{angle:f("labelAngle"),fill:f("labelColor"),fillOpacity:f("labelOpacity"),font:f("labelFont"),fontSize:f("labelFontSize"),fontWeight:f("labelFontWeight"),fontStyle:f("labelFontStyle"),limit:f("labelLimit"),lineHeight:f("labelLineHeight")},{align:Y,baseline:ie});const kt=f("labelBound");let wt=f("labelOverlap");return wt=wt||kt?{separation:f("labelSeparation"),method:wt,order:"datum.index",bound:kt?{scale:w,orient:v,tolerance:kt}:null}:void 0,fe.align!==Ve&&(fe.align=xb(fe.align,Ve)),fe.baseline!==ct&&(fe.baseline=xb(fe.baseline,ct)),i0({type:ky,role:Y8,style:Lx,key:P0,from:r,encode:dt,overlap:wt},n)}function x7(e,t,n,r){const i=xg(e,t),s=e.orient,f=Dk(s,-1,1);let v,w;const O={enter:v={opacity:Us,anchor:hd(i("titleAnchor",null)),align:{signal:LC}},update:w=Object(we.p)({},v,{opacity:L0,text:hd(e.title)}),exit:{opacity:Us}},N={signal:`lerp(range("${e.scale}"), ${Ck(0,1,.5)})`};return w.x=dd(s,N),w.y=sv(s,N),v.angle=dd(s,Us,v7(f,90)),v.baseline=dd(s,TN(s,B1,av),{value:B1}),w.angle=v.angle,w.baseline=v.baseline,Hd(O,{fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),angle:i("titleAngle"),baseline:i("titleBaseline")}),function(L,Y,ie,fe){const ve=(Ve,ct)=>Ve!=null?(ie.update[ct]=xb(hd(Ve),ie.update[ct]),!1):!vb(ct,fe),Be=ve(L("titleX"),"x"),We=ve(L("titleY"),"y");ie.enter.auto=We===Be?hd(We):dd(Y,hd(We),hd(Be))}(i,s,O,n),O.update.align=xb(O.update.align,v.align),O.update.angle=xb(O.update.angle,v.angle),O.update.baseline=xb(O.update.baseline,v.baseline),i0({type:ky,role:Q8,style:RC,from:r,encode:O},n)}function w7(e,t){const n=function(ve,Be){var We,Ve,ct,lt=Be.config,mt=lt.style,dt=lt.axis,kt=Be.scaleType(ve.scale)==="band"&&lt.axisBand,wt=ve.orient;if(Sh(wt)){const dn=FN([lt.axisX,lt.axisY]),Dn=FN([lt.axisTop,lt.axisBottom,lt.axisLeft,lt.axisRight]);for(ct of(We={},dn))We[ct]=dd(wt,wb(ct,lt.axisX,dt,mt),wb(ct,lt.axisY,dt,mt));for(ct of(Ve={},Dn))Ve[ct]=g7(wt.signal,wb(ct,lt.axisTop,dt,mt),wb(ct,lt.axisBottom,dt,mt),wb(ct,lt.axisLeft,dt,mt),wb(ct,lt.axisRight,dt,mt))}else We=wt===av||wt===B1?lt.axisX:lt.axisY,Ve=lt["axis"+wt[0].toUpperCase()+wt.slice(1)];return We||Ve||kt?Object(we.p)({},dt,We,Ve,kt):dt}(e,t),r=e.encode||{},i=r.axis||{},s=i.name||void 0,f=i.interactive,v=i.style,w=xg(e,n),O=function(ve){const Be=ve("tickBand");let We,Ve,ct=ve("tickOffset");return Be?Be.signal?(We={signal:`(${Be.signal}) === 'extent' ? 1 : 0.5`},Ve={signal:`(${Be.signal}) === 'extent'`},Object(we.H)(ct)||(ct={signal:`(${Be.signal}) === 'extent' ? 0 : ${ct}`})):Be==="extent"?(We=1,Ve=!0,ct=0):(We=.5,Ve=!1):(We=ve("bandPosition"),Ve=ve("tickExtra")),{extra:Ve,band:We,offset:ct}}(w),N={scale:e.scale,ticks:!!w("ticks"),labels:!!w("labels"),grid:!!w("grid"),domain:!!w("domain"),title:e.title!=null},L=jo(t.add(ov({},[N]))),Y=jo(t.add(bB({scale:t.scaleRef(e.scale),extra:t.property(O.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),ie=[];let fe;return N.grid&&ie.push(y7(e,n,r.grid,Y,O)),N.ticks&&(fe=w("tickSize"),ie.push(function(ve,Be,We,Ve,ct,lt){const mt=xg(ve,Be),dt=ve.orient,kt=Dk(dt,-1,1);let wt,dn,Dn;const wn={enter:wt={opacity:Us},update:Dn={opacity:L0},exit:dn={opacity:Us}};Hd(wn,{stroke:mt("tickColor"),strokeCap:mt("tickCap"),strokeDash:mt("tickDash"),strokeDashOffset:mt("tickDashOffset"),strokeOpacity:mt("tickOpacity"),strokeWidth:mt("tickWidth")});const Xn=hd(ct);Xn.mult=kt;const Kn={scale:ve.scale,field:P0,band:lt.band,extra:lt.extra,offset:lt.offset,round:mt("tickRound")};return Dn.y=wt.y=dd(dt,Us,Kn),Dn.y2=wt.y2=dd(dt,Xn),dn.x=dd(dt,Kn),Dn.x=wt.x=sv(dt,Us,Kn),Dn.x2=wt.x2=sv(dt,Xn),dn.y=sv(dt,Kn),i0({type:PC,role:J8,key:P0,from:Ve,encode:wn},We)}(e,n,r.ticks,Y,fe,O))),N.labels&&(fe=N.ticks?fe:0,ie.push(b7(e,n,r.labels,Y,fe,O))),N.domain&&ie.push(function(ve,Be,We,Ve){const ct=xg(ve,Be),lt=ve.orient;let mt,dt;const kt={enter:mt={opacity:Us},update:dt={opacity:L0},exit:{opacity:Us}};Hd(kt,{stroke:ct("domainColor"),strokeCap:ct("domainCap"),strokeDash:ct("domainDash"),strokeDashOffset:ct("domainDashOffset"),strokeWidth:ct("domainWidth"),strokeOpacity:ct("domainOpacity")});const wt=RN(ve,0),dn=RN(ve,1);return mt.x=dt.x=dd(lt,wt,Us),mt.x2=dt.x2=dd(lt,dn),mt.y=dt.y=sv(lt,wt,Us),mt.y2=dt.y2=sv(lt,dn),i0({type:PC,role:K8,from:Ve,encode:kt},We)}(e,n,r.domain,L)),N.title&&ie.push(x7(e,n,r.title,L)),Sk(Ux({role:$8,from:L,encode:gb(function(ve,Be){const We={enter:{},update:{}};return Hd(We,{orient:ve("orient"),offset:ve("offset")||0,position:iv(Be.position,0),titlePadding:ve("titlePadding"),minExtent:ve("minExtent"),maxExtent:ve("maxExtent"),range:{signal:`abs(span(range("${Be.scale}")))`},translate:ve("translate"),format:Be.format,formatType:Be.formatType}),We}(w,e),i,zx),marks:ie,aria:w("aria"),description:w("description"),zindex:w("zindex"),name:s,interactive:f,style:v}),t)}function MN(e,t,n){const r=Object(we.i)(e.signals),i=Object(we.i)(e.scales);return n||r.forEach(s=>eN(s,t)),Object(we.i)(e.projections).forEach(s=>function(f,v){const w=v.config.projection||{},O={};for(const N in f)N!=="name"&&(O[N]=NC(f[N],N,v));for(const N in w)O[N]==null&&(O[N]=NC(w[N],N,v));v.addProjection(f.name,O)}(s,t)),i.forEach(s=>function(f,v){const w=f.type||"linear";nm(w)||Object(we.o)("Unrecognized scale type: "+Object(we.Ba)(w)),v.addScale(f.name,{type:w,domain:void 0})}(s,t)),Object(we.i)(e.data).forEach(s=>c7(s,t)),i.forEach(s=>LB(s,t)),(n||r).forEach(s=>function(f,v){const w=v.getSignal(f.name);let O=f.update;f.init&&(O?Object(we.o)("Signals can not include both init and update expressions."):(O=f.init,w.initonly=!0)),O&&(O=Tv(O,v),w.update=O.$expr,w.params=O.$params),f.on&&f.on.forEach(N=>yB(N,v,w.id))}(s,t)),Object(we.i)(e.axes).forEach(s=>w7(s,t)),Object(we.i)(e.marks).forEach(s=>Sk(s,t)),Object(we.i)(e.legends).forEach(s=>a7(s,t)),e.title&&u7(e.title,t),t.parseLambdas(),t}const k7=e=>gb({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e);function _7(e,t){const n=t.config,r=jo(t.root=t.add(yk())),i=function(O,N){const L=ve=>iv(O[ve],N[ve]),Y=[Vx("background",L("background")),Vx("autosize",function(ve){return Object(we.H)(ve)?ve:{type:ve||"pad"}}(L("autosize"))),Vx("padding",function(ve){return Object(we.H)(ve)?ve.signal?ve:{top:jx(ve.top),bottom:jx(ve.bottom),left:jx(ve.left),right:jx(ve.right)}:G8(jx(ve))}(L("padding"))),Vx("width",L("width")||0),Vx("height",L("height")||0)],ie=Y.reduce((ve,Be)=>(ve[Be.name]=Be,ve),{}),fe={};return Object(we.i)(O.signals).forEach(ve=>{Object(we.w)(ie,ve.name)?ve=Object(we.p)(ie[ve.name],ve):Y.push(ve),fe[ve.name]=ve}),Object(we.i)(N.signals).forEach(ve=>{Object(we.w)(fe,ve.name)||Object(we.w)(ie,ve.name)||Y.push(ve)}),Y}(e,n);i.forEach(O=>eN(O,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const s=t.add(ov()),f=t.add(aN(QT(k7(e.encode),Ek,_C,e.style,t,{pulse:jo(s)}))),v=t.add(cN({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:r,pulse:jo(f)}));t.operators.pop(),t.pushState(jo(f),jo(v),null),MN(e,t,i),t.operators.push(v);let w=t.add(iN({mark:r,pulse:jo(v)}));return w=t.add(uN({pulse:jo(w)})),w=t.add(wy({pulse:jo(w)})),t.addData("root",new _y(t,s,s,w)),t}function Vx(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function jN(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function BN(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function qC(e){return(Object(we.B)(e)?function(t){const n=t.length;let r="[";for(let i=0;i<n;++i){const s=t[i];r+=(i>0?",":"")+(Object(we.H)(s)?s.signal||qC(s):Object(we.Ba)(s))}return r+"]"}:function(t){let n,r,i="{",s=0;for(n in t)r=t[n],i+=(++s>1?",":"")+Object(we.Ba)(n)+":"+(Object(we.H)(r)?r.signal||qC(r):Object(we.Ba)(r));return i+"}"})(e)}function E7(e,t,n){return Object(we.H)(e)||Object(we.o)("Input Vega specification must be an object."),_7(e,new jN(t=Object(we.P)({description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:"#4c78a8"},area:{fill:"#4c78a8"},image:null,line:{stroke:"#4c78a8",strokeWidth:2},path:{stroke:"#4c78a8"},rect:{fill:"#4c78a8"},rule:{stroke:"#000"},shape:{stroke:"#4c78a8"},symbol:{fill:"#4c78a8",size:64},text:{fill:"#000",font:"sans-serif",fontSize:11},trail:{fill:"#4c78a8",size:2},style:{"guide-label":{fill:"#000",font:"sans-serif",fontSize:10},"guide-title":{fill:"#000",font:"sans-serif",fontSize:11,fontWeight:"bold"},"group-title":{fill:"#000",font:"sans-serif",fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:"#000",font:"sans-serif",fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:"#ddd"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:"#888",grid:!1,gridWidth:1,gridColor:"#ddd",labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:"#888",tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:"#ddd",gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:"#888",titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}},t,e.config),n)).toRuntime()}jN.prototype=BN.prototype={parse(e){return MN(e,this)},fork(){return new BN(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(t=>{t.$ref=e.id}),e.refs=null),e},proxy(e){const t=e instanceof AC?jo(e):e;return this.add(FB({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(r,i,s){let f;r&&((f=r.data||(r.data={}))[i]||(f[i]=[])).push(s)}for(e in this.data){n((t=this.data[e]).input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const r in t.index)n(t.index[r],e,"index:"+r)}return this},pushState(e,t,n){this._encode.push(jo(this.add(wy({pulse:e})))),this._parent.push(t),this._lookup.push(n?jo(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return Object(we.W)(this._parent)},encode(){return Object(we.W)(this._encode)},lookup(){return Object(we.W)(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(Object(we.J)(e))return Bx(e,t);e.signal||Object(we.o)("Unsupported field reference: "+Object(we.Ba)(e));const n=e.signal;let r=this.field[n];if(!r){const i={name:this.signalRef(n)};t&&(i.as=t),this.field[n]=r=jo(this.add(_B(i)))}return r},compareRef(e){let t=!1;const n=s=>Sh(s)?(t=!0,this.signalRef(s.signal)):function(f){return f&&f.expr}(s)?(t=!0,this.exprRef(s.expr)):s,r=Object(we.i)(e.field).map(n),i=Object(we.i)(e.order).map(n);return t?jo(this.add(oN({fields:r,orders:i}))):tN(r,i)},keyRef(e,t){let n=!1;const r=this.signals;return e=Object(we.i)(e).map(i=>Sh(i)?(n=!0,jo(r[i.signal])):i),n?jo(this.add(EB({fields:e,flat:t}))):function(i,s){const f={$key:i};return s&&(f.$flat=!0),f}(e,t)},sortRef(e){if(!e)return e;const t=bk(e.op,e.field),n=e.order||"ascending";return n.signal?jo(this.add(oN({fields:t,orders:this.signalRef(n.signal)}))):tN(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},hasOwnSignal(e){return Object(we.w)(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&Object(we.o)("Duplicate signal name: "+Object(we.Ba)(e));const n=t instanceof AC?t:this.add(yk(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||Object(we.o)("Unrecognized signal name: "+Object(we.Ba)(e)),this.signals[e]},signalRef(e){return this.signals[e]?jo(this.signals[e]):(Object(we.w)(this.lambdas,e)||(this.lambdas[e]=this.add(yk(null))),jo(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const r=e[t],i=Tv(r,this),s=this.lambdas[r];s.params=i.$params,s.update=i.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return e&&Object(we.H)(e)?this.signalRef(e.signal||qC(e)):e},exprRef(e,t){const n={expr:Tv(e,this)};return t&&(n.expr.$name=t),jo(this.add(wB(n)))},addBinding(e,t){this.bindings||Object(we.o)("Nested signals do not support binding: "+Object(we.Ba)(e)),this.bindings.push(Object(we.p)({signal:e},t))},addScaleProj(e,t){Object(we.w)(this.scales,e)&&Object(we.o)("Duplicate scale or projection name: "+Object(we.Ba)(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,MB(t))},addProjection(e,t){this.addScaleProj(e,IB(t))},getScale(e){return this.scales[e]||Object(we.o)("Unrecognized scale name: "+Object(we.Ba)(e)),this.scales[e]},scaleRef(e){return jo(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return Object(we.w)(this.data,e)&&Object(we.o)("Duplicate data set name: "+Object(we.Ba)(e)),this.data[e]=t},getData(e){return this.data[e]||Object(we.o)("Undefined data set name: "+Object(we.Ba)(e)),this.data[e]},addDataPipeline(e,t){return Object(we.w)(this.data,e)&&Object(we.o)("Duplicate data set name: "+Object(we.Ba)(e)),this.addData(e,_y.fromEntries(this,t))}};const C7="RawCode",A7="Literal",O7="Property",S7="Identifier",D7="ArrayExpression",T7="BinaryExpression",N7="CallExpression",I7="ConditionalExpression",F7="LogicalExpression",R7="MemberExpression",M7="ObjectExpression",j7="UnaryExpression";function uv(e){this.type=e}var a1,yo,ti,Dp,Gu;uv.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(n=0,r=(t=function(i){switch(i.type){case D7:return i.elements;case T7:case F7:return[i.left,i.right];case N7:return[i.callee].concat(i.arguments);case I7:return[i.test,i.consequent,i.alternate];case R7:return[i.object,i.property];case M7:return i.properties;case O7:return[i.key,i.value];case j7:return[i.argument];case S7:case A7:case C7:default:return[]}}(this)).length;n<r;++n)if(t[n].visit(e))return 1};var Tk=1,qx=2,Cy=3,P1=4,Nk=5,Ay=6,wg=7,Hx=8;(a1={})[Tk]="Boolean",a1[qx]="<end>",a1[Cy]="Identifier",a1[P1]="Keyword",a1[Nk]="Null",a1[Ay]="Numeric",a1[wg]="Punctuator",a1[Hx]="String",a1[9]="RegularExpression";var B7="ArrayExpression",P7="BinaryExpression",L7="CallExpression",z7="ConditionalExpression",PN="Identifier",U7="Literal",W7="LogicalExpression",V7="MemberExpression",q7="ObjectExpression",H7="Property",G7="UnaryExpression",pd="Unexpected token %0",$7="Unexpected number",K7="Unexpected string",X7="Unexpected identifier",Y7="Unexpected reserved word",J7="Unexpected end of input",HC="Invalid regular expression",GC="Invalid regular expression: missing /",LN="Octal literals are not allowed in strict mode.",Q7="Duplicate data property in object literal not allowed in strict mode",Gd="ILLEGAL",Gx="Disabled.",Z7=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),eP=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function Ik(e,t){if(!e)throw new Error("ASSERT: "+t)}function s1(e){return e>=48&&e<=57}function $C(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function $x(e){return"01234567".indexOf(e)>=0}function tP(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Kx(e){return e===10||e===13||e===8232||e===8233}function Xx(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&Z7.test(String.fromCharCode(e))}function Fk(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&eP.test(String.fromCharCode(e))}const nP={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function zN(){for(;ti<Dp;){const e=yo.charCodeAt(ti);if(!tP(e)&&!Kx(e))break;++ti}}function KC(e){var t,n,r,i=0;for(n=e==="u"?4:2,t=0;t<n;++t)ti<Dp&&$C(yo[ti])?(r=yo[ti++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):uu({},pd,Gd);return String.fromCharCode(i)}function rP(){var e,t,n,r;for(t=0,(e=yo[ti])==="}"&&uu({},pd,Gd);ti<Dp&&$C(e=yo[ti++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&uu({},pd,Gd),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function UN(){var e,t;for(e=yo.charCodeAt(ti++),t=String.fromCharCode(e),e===92&&(yo.charCodeAt(ti)!==117&&uu({},pd,Gd),++ti,(e=KC("u"))&&e!=="\\"&&Xx(e.charCodeAt(0))||uu({},pd,Gd),t=e);ti<Dp&&Fk(e=yo.charCodeAt(ti));)++ti,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),yo.charCodeAt(ti)!==117&&uu({},pd,Gd),++ti,(e=KC("u"))&&e!=="\\"&&Fk(e.charCodeAt(0))||uu({},pd,Gd),t+=e);return t}function iP(){var e,t;return e=ti,{type:(t=yo.charCodeAt(ti)===92?UN():function(){var n,r;for(n=ti++;ti<Dp;){if((r=yo.charCodeAt(ti))===92)return ti=n,UN();if(!Fk(r))break;++ti}return yo.slice(n,ti)}()).length===1?Cy:nP.hasOwnProperty(t)?P1:t==="null"?Nk:t==="true"||t==="false"?Tk:Cy,value:t,start:e,end:ti}}function XC(){var e,t,n,r,i=ti,s=yo.charCodeAt(ti),f=yo[ti];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++ti,{type:wg,value:String.fromCharCode(s),start:i,end:ti};default:if((e=yo.charCodeAt(ti+1))===61)switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return ti+=2,{type:wg,value:String.fromCharCode(s)+String.fromCharCode(e),start:i,end:ti};case 33:case 61:return ti+=2,yo.charCodeAt(ti)===61&&++ti,{type:wg,value:yo.slice(i,ti),start:i,end:ti}}}return(r=yo.substr(ti,4))===">>>="?{type:wg,value:r,start:i,end:ti+=4}:(n=r.substr(0,3))===">>>"||n==="<<="||n===">>="?{type:wg,value:n,start:i,end:ti+=3}:f===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(f)>=0||t==="=>"?{type:wg,value:t,start:i,end:ti+=2}:(t==="//"&&uu({},pd,Gd),"<>=!+-*%&|^/".indexOf(f)>=0?{type:wg,value:f,start:i,end:++ti}:void uu({},pd,Gd))}function WN(){var e,t,n;if(Ik(s1((n=yo[ti]).charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=ti,e="",n!=="."){if(e=yo[ti++],n=yo[ti],e==="0"){if(n==="x"||n==="X")return++ti,function(r){let i="";for(;ti<Dp&&$C(yo[ti]);)i+=yo[ti++];return i.length===0&&uu({},pd,Gd),Xx(yo.charCodeAt(ti))&&uu({},pd,Gd),{type:Ay,value:parseInt("0x"+i,16),start:r,end:ti}}(t);if($x(n))return function(r){let i="0"+yo[ti++];for(;ti<Dp&&$x(yo[ti]);)i+=yo[ti++];return(Xx(yo.charCodeAt(ti))||s1(yo.charCodeAt(ti)))&&uu({},pd,Gd),{type:Ay,value:parseInt(i,8),octal:!0,start:r,end:ti}}(t);n&&s1(n.charCodeAt(0))&&uu({},pd,Gd)}for(;s1(yo.charCodeAt(ti));)e+=yo[ti++];n=yo[ti]}if(n==="."){for(e+=yo[ti++];s1(yo.charCodeAt(ti));)e+=yo[ti++];n=yo[ti]}if(n==="e"||n==="E")if(e+=yo[ti++],(n=yo[ti])!=="+"&&n!=="-"||(e+=yo[ti++]),s1(yo.charCodeAt(ti)))for(;s1(yo.charCodeAt(ti));)e+=yo[ti++];else uu({},pd,Gd);return Xx(yo.charCodeAt(ti))&&uu({},pd,Gd),{type:Ay,value:parseFloat(e),start:t,end:ti}}function oP(){var e,t,n,r;return Gu=null,zN(),e=ti,t=function(){var i,s,f,v;for(Ik((i=yo[ti])==="/","Regular expression literal must start with a slash"),s=yo[ti++],f=!1,v=!1;ti<Dp;)if(s+=i=yo[ti++],i==="\\")Kx((i=yo[ti++]).charCodeAt(0))&&uu({},GC),s+=i;else if(Kx(i.charCodeAt(0)))uu({},GC);else if(f)i==="]"&&(f=!1);else{if(i==="/"){v=!0;break}i==="["&&(f=!0)}return v||uu({},GC),{value:s.substr(1,s.length-2),literal:s}}(),n=function(){var i,s,f;for(s="",f="";ti<Dp&&Fk((i=yo[ti]).charCodeAt(0));)++ti,i==="\\"&&ti<Dp?uu({},pd,Gd):(f+=i,s+=i);return f.search(/[^gimuy]/g)>=0&&uu({},HC,f),{value:f,literal:s}}(),r=function(i,s){let f=i;s.indexOf("u")>=0&&(f=f.replace(/\\u\{([0-9a-fA-F]+)\}/g,(v,w)=>{if(parseInt(w,16)<=1114111)return"x";uu({},HC)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(f)}catch{uu({},HC)}try{return new RegExp(i,s)}catch{return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:ti}}function VN(){if(zN(),ti>=Dp)return{type:qx,start:ti,end:ti};const e=yo.charCodeAt(ti);return Xx(e)?iP():e===40||e===41||e===59?XC():e===39||e===34?function(){var t,n,r,i,s="",f=!1;for(Ik((t=yo[ti])==="'"||t==='"',"String literal must starts with a quote"),n=ti,++ti;ti<Dp;){if((r=yo[ti++])===t){t="";break}if(r==="\\")if((r=yo[ti++])&&Kx(r.charCodeAt(0)))r==="\r"&&yo[ti]===`
`&&++ti;else switch(r){case"u":case"x":yo[ti]==="{"?(++ti,s+=rP()):s+=KC(r);break;case"n":s+=`
`;break;case"r":s+="\r";break;case"t":s+="	";break;case"b":s+="\b";break;case"f":s+="\f";break;case"v":s+="\v";break;default:$x(r)?((i="01234567".indexOf(r))!==0&&(f=!0),ti<Dp&&$x(yo[ti])&&(f=!0,i=8*i+"01234567".indexOf(yo[ti++]),"0123".indexOf(r)>=0&&ti<Dp&&$x(yo[ti])&&(i=8*i+"01234567".indexOf(yo[ti++]))),s+=String.fromCharCode(i)):s+=r}else{if(Kx(r.charCodeAt(0)))break;s+=r}}return t!==""&&uu({},pd,Gd),{type:Hx,value:s,octal:f,start:n,end:ti}}():e===46?s1(yo.charCodeAt(ti+1))?WN():XC():s1(e)?WN():XC()}function kg(){const e=Gu;return ti=e.end,Gu=VN(),ti=e.end,e}function qN(){const e=ti;Gu=VN(),ti=e}function HN(e,t,n){const r=new uv(e==="||"||e==="&&"?W7:P7);return r.operator=e,r.left=t,r.right=n,r}function aP(e,t){const n=new uv(L7);return n.callee=e,n.arguments=t,n}function YC(e){const t=new uv(PN);return t.name=e,t}function Yx(e){const t=new uv(U7);return t.value=e.value,t.raw=yo.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function GN(e,t,n){const r=new uv(V7);return r.computed=e==="[",r.object=t,r.property=n,r.computed||(n.member=!0),r}function $N(e,t,n){const r=new uv(H7);return r.key=t,r.value=n,r.kind=e,r}function uu(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(s,f)=>(Ik(f<r.length,"Message reference must be in range"),r[f]));throw(n=new Error(i)).index=ti,n.description=i,n}function Rk(e){e.type===qx&&uu(e,J7),e.type===Ay&&uu(e,$7),e.type===Hx&&uu(e,K7),e.type===Cy&&uu(e,X7),e.type===P1&&uu(e,Y7),uu(e,pd,e.value)}function Tp(e){const t=kg();t.type===wg&&t.value===e||Rk(t)}function qc(e){return Gu.type===wg&&Gu.value===e}function JC(e){return Gu.type===P1&&Gu.value===e}function sP(){const e=[];for(ti=Gu.start,Tp("[");!qc("]");)qc(",")?(kg(),e.push(null)):(e.push(Oy()),qc("]")||Tp(","));return kg(),function(t){const n=new uv(B7);return n.elements=t,n}(e)}function KN(){ti=Gu.start;const e=kg();return e.type===Hx||e.type===Ay?(e.octal&&uu(e,LN),Yx(e)):YC(e.value)}function uP(){var e,t,n;return ti=Gu.start,(e=Gu).type===Cy?(n=KN(),Tp(":"),$N("init",n,Oy())):e.type!==qx&&e.type!==wg?(t=KN(),Tp(":"),$N("init",t,Oy())):void Rk(e)}function cP(){var e,t,n=[],r={},i=String;for(ti=Gu.start,Tp("{");!qc("}");)t="$"+((e=uP()).key.type===PN?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?uu({},Q7):r[t]=!0,n.push(e),qc("}")||Tp(",");return Tp("}"),function(s){const f=new uv(q7);return f.properties=s,f}(n)}const lP={if:1};function fP(){var e,t,n;if(qc("("))return function(){Tp("(");const r=QC();return Tp(")"),r}();if(qc("["))return sP();if(qc("{"))return cP();if(e=Gu.type,ti=Gu.start,e===Cy||lP[Gu.value])n=YC(kg().value);else if(e===Hx||e===Ay)Gu.octal&&uu(Gu,LN),n=Yx(kg());else{if(e===P1)throw new Error(Gx);e===Tk?((t=kg()).value=t.value==="true",n=Yx(t)):e===Nk?((t=kg()).value=null,n=Yx(t)):qc("/")||qc("/=")?(n=Yx(oP()),qN()):Rk(kg())}return n}function hP(){const e=[];if(Tp("("),!qc(")"))for(;ti<Dp&&(e.push(Oy()),!qc(")"));)Tp(",");return Tp(")"),e}function dP(){ti=Gu.start;const e=kg();return function(t){return t.type===Cy||t.type===P1||t.type===Tk||t.type===Nk}(e)||Rk(e),YC(e.value)}function pP(){Tp("[");const e=QC();return Tp("]"),e}function XN(){const e=function(){var t;for(t=fP();;)if(qc("."))Tp("."),t=GN(".",t,dP());else if(qc("("))t=aP(t,hP());else{if(!qc("["))break;t=GN("[",t,pP())}return t}();if(Gu.type===wg&&(qc("++")||qc("--")))throw new Error(Gx);return e}function Mk(){var e,t;if(Gu.type!==wg&&Gu.type!==P1)t=XN();else{if(qc("++")||qc("--"))throw new Error(Gx);if(qc("+")||qc("-")||qc("~")||qc("!"))e=kg(),t=Mk(),t=function(n,r){const i=new uv(G7);return i.operator=n,i.argument=r,i.prefix=!0,i}(e.value,t);else{if(JC("delete")||JC("void")||JC("typeof"))throw new Error(Gx);t=XN()}}return t}function YN(e){let t=0;if(e.type!==wg&&e.type!==P1)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function Oy(){var e,t;return e=function(){var n,r,i,s,f,v,w,O,N,L;if(n=Gu,N=Mk(),(f=YN(s=Gu))===0)return N;for(s.prec=f,kg(),r=[n,Gu],v=[N,s,w=Mk()];(f=YN(Gu))>0;){for(;v.length>2&&f<=v[v.length-2].prec;)w=v.pop(),O=v.pop().value,N=v.pop(),r.pop(),i=HN(O,N,w),v.push(i);(s=kg()).prec=f,v.push(s),r.push(Gu),i=Mk(),v.push(i)}for(i=v[L=v.length-1],r.pop();L>1;)r.pop(),i=HN(v[L-1].value,v[L-2],i),L-=2;return i}(),qc("?")&&(kg(),t=Oy(),Tp(":"),e=function(n,r,i){const s=new uv(z7);return s.test=n,s.consequent=r,s.alternate=i,s}(e,t,Oy())),e}function QC(){const e=Oy();if(qc(","))throw new Error(Gx);return e}function mP(e){ti=0,Dp=(yo=e).length,Gu=null,qN();const t=QC();if(Gu.type!==qx)throw new Error("Unexpect token after expression.");return t}var gP={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function vP(e){function t(r,i,s){return f=>function(v,w,O,N){let L=e(w[0]);return O&&(L=O+"("+L+")",O.lastIndexOf("new ",0)===0&&(L="("+L+")")),L+"."+v+(N<0?"":N===0?"()":"("+w.slice(1).map(e).join(",")+")")}(r,f,i,s)}const n="new Date";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(r){r.length<3&&Object(we.o)("Missing arguments to clamp function."),r.length>3&&Object(we.o)("Too many arguments to clamp function.");const i=r.map(e);return"Math.max("+i[1]+", Math.min("+i[2]+","+i[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase","String",0),lower:t("toLowerCase","String",0),substring:t("substring","String"),split:t("split","String"),trim:t("trim","String",0),regexp:"RegExp",test:t("test","RegExp"),if:function(r){r.length<3&&Object(we.o)("Missing arguments to if function."),r.length>3&&Object(we.o)("Too many arguments to if function.");const i=r.map(e);return"("+i[0]+"?"+i[1]+":"+i[2]+")"}}}function yP(e){const t=(e=e||{}).allowed?Object(we.Fa)(e.allowed):{},n=e.forbidden?Object(we.Fa)(e.forbidden):{},r=e.constants||gP,i=(e.functions||vP)(L),s=e.globalvar,f=e.fieldvar,v=Object(we.E)(s)?s:fe=>"".concat(s,'["').concat(fe,'"]');let w={},O={},N=0;function L(fe){if(Object(we.J)(fe))return fe;const ve=Y[fe.type];return ve==null&&Object(we.o)("Unsupported type: "+fe.type),ve(fe)}const Y={Literal:fe=>fe.raw,Identifier:fe=>{const ve=fe.name;return N>0?ve:Object(we.w)(n,ve)?Object(we.o)("Illegal identifier: "+ve):Object(we.w)(r,ve)?r[ve]:Object(we.w)(t,ve)?ve:(w[ve]=1,v(ve))},MemberExpression:fe=>{const ve=!fe.computed,Be=L(fe.object);ve&&(N+=1);const We=L(fe.property);return Be===f&&(O[function(Ve){const ct=Ve&&Ve.length-1;return ct&&(Ve[0]==='"'&&Ve[ct]==='"'||Ve[0]==="'"&&Ve[ct]==="'")?Ve.slice(1,-1):Ve}(We)]=1),ve&&(N-=1),Be+(ve?"."+We:"["+We+"]")},CallExpression:fe=>{fe.callee.type!=="Identifier"&&Object(we.o)("Illegal callee type: "+fe.callee.type);const ve=fe.callee.name,Be=fe.arguments,We=Object(we.w)(i,ve)&&i[ve];return We||Object(we.o)("Unrecognized function: "+ve),Object(we.E)(We)?We(Be):We+"("+Be.map(L).join(",")+")"},ArrayExpression:fe=>"["+fe.elements.map(L).join(",")+"]",BinaryExpression:fe=>"("+L(fe.left)+" "+fe.operator+" "+L(fe.right)+")",UnaryExpression:fe=>"("+fe.operator+L(fe.argument)+")",ConditionalExpression:fe=>"("+L(fe.test)+"?"+L(fe.consequent)+":"+L(fe.alternate)+")",LogicalExpression:fe=>"("+L(fe.left)+fe.operator+L(fe.right)+")",ObjectExpression:fe=>"{"+fe.properties.map(L).join(",")+"}",Property:fe=>{N+=1;const ve=L(fe.key);return N-=1,ve+":"+L(fe.value)}};function ie(fe){const ve={code:L(fe),globals:Object.keys(w),fields:Object.keys(O)};return w={},O={},ve}return ie.functions=i,ie.constants=r,ie}const bP="view",jk="[",Bk="]",JN="{",QN="}",xP=":",ZN=",",wP="@",kP=">",_P=/[[\]{}]/,EP={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let eI,tI;function Sy(e,t,n){return eI=t||bP,tI=n||EP,nI(e.trim()).map(ZC)}function Jx(e,t,n,r,i){const s=e.length;let f,v=0;for(;t<s;++t){if(f=e[t],!v&&f===n)return t;i&&i.indexOf(f)>=0?--v:r&&r.indexOf(f)>=0&&++v}return t}function nI(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=Jx(e,i,ZN,jk+JN,Bk+QN),t.push(e.substring(r,i).trim()),r=++i;if(t.length===0)throw"Empty event selector: "+e;return t}function ZC(e){return e[0]==="["?function(t){const n=t.length;let r,i=1;if((i=Jx(t,i,Bk,jk,Bk))===n)throw"Empty between selector: "+t;if((r=nI(t.substring(1,i))).length!==2)throw"Between selector must have two elements: "+t;if((t=t.slice(i+1).trim())[0]!==kP)throw"Expected '>' after between selector: "+t;r=r.map(ZC);const s=ZC(t.slice(1).trim());return s.between?{between:r,stream:s}:(s.between=r,s)}(e):function(t){const n={source:eI},r=[];let i,s,f=[0,0],v=0,w=0,O=t.length,N=0;if(t[O-1]===QN){if(!((N=t.lastIndexOf(JN))>=0))throw"Unmatched right brace: "+t;try{f=function(L){const Y=L.split(ZN);if(!L.length||Y.length>2)throw L;return Y.map(ie=>{const fe=+ie;if(fe!=fe)throw L;return fe})}(t.substring(N+1,O-1))}catch{throw"Invalid throttle specification: "+t}t=t.slice(0,N).trim(),O=t.length,N=0}if(!O)throw t;if(t[0]===wP&&(v=++N),(i=Jx(t,N,xP))<O&&(r.push(t.substring(w,i).trim()),w=N=++i),(N=Jx(t,N,jk))===O)r.push(t.substring(w,O).trim());else if(r.push(t.substring(w,N).trim()),s=[],(w=++N)===O)throw"Unmatched left bracket: "+t;for(;N<O;){if((N=Jx(t,N,Bk))===O)throw"Unmatched left bracket: "+t;if(s.push(t.substring(w,N).trim()),N<O-1&&t[++N]!==jk)throw"Expected left bracket: "+t;w=++N}if(!(O=r.length)||_P.test(r[O-1]))throw"Invalid event selector: "+t;return O>1?(n.type=r[1],v?n.markname=r[0].slice(1):function(L){return tI[L]}(r[0])?n.marktype=r[0]:n.source=r[0]):n.type=r[0],n.type.slice(-1)==="!"&&(n.consume=!0,n.type=n.type.slice(0,-1)),s!=null&&(n.filter=s),f[0]&&(n.throttle=f[0]),f[1]&&(n.debounce=f[1]),n}(e)}var CP="5.20.0";Object(we.p)(bn,I,X,K,M,V,W,$,te,F,ue,se);const AP=CP;var OP=o(245),kb=function(e,t,n){return e.fields=t||[],e.fname=n,e},SP=function(e){return e.length===1?DP(e[0]):TP(e)};const DP=e=>function(t){return t[e]},TP=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};var eA=function(e){throw Error(e)},Dy=function(e){var t,n,r,i=[],s=null,f=0,v=e.length,w="";function O(){i.push(w+e.substring(t,n)),w="",t=n+1}for(e+="",t=n=0;n<v;++n)if((r=e[n])==="\\")w+=e.substring(t,n),w+=e.substring(++n,++n),t=n;else if(r===s)O(),s=null,f=-1;else{if(s)continue;t===f&&r==='"'||t===f&&r==="'"?(t=n+1,s=r):r!=="."||f?r==="["?(n>t&&O(),f=t=n+1):r==="]"&&(f||eA("Access path missing open bracket: "+e),f>0&&O(),f=0,t=n+1):n>t?O():t=n+1}return f&&eA("Access path missing closing bracket: "+e),s&&eA("Access path missing closing quote: "+e),n>t&&(n++,O()),i},NP=function(e,t,n){const r=Dy(e);return e=r.length===1?r[0]:e,kb((n&&n.get||SP)(r),[e],t||e)},Qx=[],IP=(NP("id"),kb(function(e){return e},Qx,"identity"));kb(function(){return 0},Qx,"zero"),kb(function(){return 1},Qx,"one"),kb(function(){return!0},Qx,"true"),kb(function(){return!1},Qx,"false");function Pk(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}var $o=Array.isArray,md=function(e){return e===Object(e)};const rI=e=>e!=="__proto__";function iI(...e){return e.reduce((t,n)=>{for(var r in n)if(r==="signals")t.signals=FP(t.signals,n.signals);else{var i=r==="legend"?{layout:1}:r==="style"||null;tA(t,r,n[r],i)}return t},{})}function tA(e,t,n,r){var i,s;if(rI(t))if(md(n)&&!$o(n))for(i in s=md(e[t])?e[t]:e[t]={},n)r&&(r===!0||r[i])?tA(s,i,n[i]):rI(i)&&(s[i]=n[i]);else e[t]=n}function FP(e,t){if(e==null)return t;const n={},r=[];function i(s){n[s.name]||(n[s.name]=1,r.push(s))}return t.forEach(i),e.forEach(i),r}var _f=function(e){return e!=null?$o(e)?e:[e]:[]},RP=function(e){return typeof e=="function"};const MP=Object.prototype.hasOwnProperty;var Ty=function(e,t){return MP.call(e,t)},Zx=function(e){return typeof e=="boolean"},Gf=function(e){return typeof e=="number"},cs=function(e){return typeof e=="string"};function Ws(e){return $o(e)?"["+e.map(Ws)+"]":md(e)||cs(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}var Ny=function(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=!0;return t};function Bo(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function"){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(n,r){return Array.isArray(r)?n.push.apply(n,e.call(r,t-1)):n.push(r),n},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var jP=o(244),BP=o.n(jP),PP=o(243),LP=o.n(PP),zP=o(86),e2=o.n(zP);function nA(e){return!!e.or}function rA(e){return!!e.and}function iA(e){return!!e.not}const t2=LP.a,ls=BP.a;function n2(e,t){const n={};for(const r of t)Ty(e,r)&&(n[r]=e[r]);return n}function u1(e,t){const n=Object.assign({},e);for(const r of t)delete n[r];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>e2()(e)).join(",")})`};const hl=e2.a;function Zs(e){if(Gf(e))return e;const t=cs(e)?e:e2()(e);if(t.length<250)return t;let n=0;for(let r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r),n&=n;return n}function oI(e){return e===!1||e===null}function Yo(e,t){return e.indexOf(t)>-1}function r2(e,t){let n=0;for(const[r,i]of e.entries())if(t(i,r,n++))return!0;return!1}function aI(e,t){let n=0;for(const[r,i]of e.entries())if(!t(i,r,n++))return!1;return!0}function UP(e,t){for(const n of Si(t))tA(e,n,t[n],!0)}function L1(e,t){const n=[],r={};let i;for(const s of e)(i=t(s))in r||(r[i]=1,n.push(s));return n}function sI(e,t){for(const n of e)if(t.has(n))return!0;return!1}function uI(e){const t=new Set;for(const n of e){const r=Dy(n).map((s,f)=>f===0?s:`[${s}]`),i=r.map((s,f)=>r.slice(0,f+1).join(""));for(const s of i)t.add(s)}return t}function cI(e,t){return e===void 0||t===void 0||sI(uI(e),uI(t))}function bc(e){return Si(e).length===0}const Si=Object.keys,z1=Object.values;function lI(e){const t=[];for(const n in e)Ty(e,n)&&t.push({key:n,value:e[n]});return t}function Lk(e){return e===!0||e===!1}function dl(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function i2(e,t){return iA(e)?"!("+i2(e.not,t)+")":rA(e)?"("+e.and.map(n=>i2(n,t)).join(") && (")+")":nA(e)?"("+e.or.map(n=>i2(n,t)).join(") || (")+")":t(e)}function oA(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&oA(e[n],t)&&delete e[n],bc(e)}function zk(e){return e.charAt(0).toUpperCase()+e.substr(1)}function fI(e,t="datum"){const n=Dy(e),r=[];for(let i=1;i<=n.length;i++){const s=`[${n.slice(0,i).map(Ws).join("][")}]`;r.push(`${t}${s}`)}return r.join(" && ")}function WP(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function U1(e){return`${Dy(e).map(WP).join("\\.")}`}function _b(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function hI(e){return`${Dy(e).join(".")}`}function o2(e){return e?Dy(e).length:0}function $f(...e){for(const t of e)if(t!==void 0)return t}let VP=42;function qP(e){const t=++VP;return e?String(e)+t:t}function Uk(e){if(e!==void 0)return(e%360+360)%360}function aA(e){return!!Gf(e)||!isNaN(e)&&!isNaN(parseFloat(e))}const dI={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function sA(e){return e&&e.condition}const pI=["domain","grid","labels","ticks","title"],HP={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},mI={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},GP=Object.assign(Object.assign({},mI),{style:1,labelExpr:1,encoding:1});function gI(e){return!!GP[e]}const Tm={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},vI=Tm.arc,Wk=Tm.area,Vk=Tm.bar,$P=Tm.image,qk=Tm.line,Hk=Tm.point,KP=Tm.rect,Gk=Tm.rule,yI=Tm.text,uA=Tm.tick,XP=Tm.trail,cA=Tm.circle,lA=Tm.square,bI=Tm.geoshape;function Iy(e){return Yo(["line","area","trail"],e)}function xI(e){return Yo(["rect","bar","image","arc"],e)}const wI=Si(Tm);function Nv(e){return e.type}Ny(wI);const YP=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],kI=Si({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),JP={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},QP={binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},ZP={binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5};function c1(e){return"mark"in e}class $k{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return!!c1(t)&&function(n){return Nv(n)?n.type:n}(t.mark)===this.name}}const eL={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},tL={count:1,min:1,max:1};function W1(e){return!!e&&!!e.argmin}function Fy(e){return!!e&&!!e.argmax}function fA(e){return cs(e)&&!!eL[e]}const nL=["count","valid","missing","distinct"];function _I(e){return cs(e)&&Yo(nL,e)}const rL=["count","sum","distinct","valid","missing"],iL=Ny(["mean","average","median","q1","q3","min","max"]),l1="row",f1="column",Kk="facet",Ol="x",Dh="y",cv="x2",Iv="y2",Fv="radius",h1="radius2",lv="theta",d1="theta2",Rv="latitude",Mv="longitude",fv="latitude2",z0="longitude2",_g="color",jv="fill",Bv="stroke",Eg="shape",p1="size",Ry="angle",m1="opacity",V1="fillOpacity",q1="strokeOpacity",H1="strokeWidth",G1="strokeDash",a2="text",s2="order",u2="detail",Xk="key",My="tooltip",Yk="href",Jk="url",Qk="description",EI={theta:1,theta2:1,radius:1,radius2:1};function CI(e){return e in EI}const hA={longitude:1,longitude2:1,latitude:1,latitude2:1},oL=Si(hA),AI=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),EI),hA),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function Eb(e){return e===_g||e===jv||e===Bv}const OI={row:1,column:1,facet:1},U0=Si(OI),dA=Object.assign(Object.assign({},AI),OI),SI=Si(dA),aL=Bo(dA,["order","detail","tooltip"]),sL=Bo(aL,["row","column","facet"]);function uL(e){return!!sL[e]}function DI(e){return!!dA[e]}const cL=[cv,Iv,fv,z0,d1,h1];function TI(e){return jy(e)!==e}function jy(e){switch(e){case cv:return Ol;case Iv:return Dh;case fv:return Rv;case z0:return Mv;case d1:return lv;case h1:return Fv}return e}function $1(e){if(CI(e))switch(e){case lv:return"startAngle";case d1:return"endAngle";case Fv:return"outerRadius";case h1:return"innerRadius"}return e}function Pv(e){switch(e){case Ol:return cv;case Dh:return Iv;case Rv:return fv;case Mv:return z0;case lv:return d1;case Fv:return h1}}function Lv(e){switch(e){case Ol:case cv:return"width";case Dh:case Iv:return"height"}}const pA=Bo(AI,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),lL=Si(pA),K1={x:1,y:1},W0=Si(K1);function zv(e){return e in K1}const mA={theta:1,radius:1},fL=Si(mA);function Zk(e){return e==="width"?Ol:Dh}const NI=Bo(pA,["text","tooltip","href","url","description","detail","key","order"]),hL=Si(NI),II=Object.assign(Object.assign(Object.assign({},K1),mA),NI),e_=Si(II);function X1(e){return!!II[e]}function dL(e,t){return function(n){switch(n){case _g:case jv:case Bv:case Qk:case u2:case Xk:case My:case Yk:case s2:case m1:case V1:case q1:case H1:case Kk:case l1:case f1:return FI;case Ol:case Dh:case Rv:case Mv:return pL;case cv:case Iv:case fv:case z0:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case p1:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case G1:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Eg:return{point:"always",geoshape:"always"};case a2:return{text:"always"};case Ry:return{point:"always",square:"always",text:"always"};case Jk:return{image:"always"};case lv:case Fv:return{text:"always",arc:"always"};case d1:case h1:return{arc:"always"}}}(e)[t]}const FI={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},pL=Bo(FI,["geoshape"]);function t_(e){switch(e){case Ol:case Dh:case lv:case Fv:case p1:case Ry:case H1:case m1:case V1:case q1:case cv:case Iv:case d1:case h1:return;case Kk:case l1:case f1:case Eg:case G1:case a2:case My:case Yk:case Jk:case Qk:return"discrete";case _g:case jv:case Bv:return"flexible";case Rv:case Mv:case fv:case z0:case u2:case Xk:case s2:return}}function RI(e){return Zx(e)&&(e=h_(e,void 0)),"bin"+Si(e).map(t=>n_(e[t])?dl(`_${t}_${Object.entries(e[t])}`):dl(`_${t}_${e[t]}`)).join("")}function Nc(e){return e===!0||c2(e)&&!e.binned}function Nm(e){return e==="binned"||c2(e)&&e.binned===!0}function c2(e){return md(e)}function n_(e){return e==null?void 0:e.selection}function MI(e){switch(e){case l1:case f1:case p1:case _g:case jv:case Bv:case H1:case m1:case V1:case q1:case Eg:return 6;case G1:return 4;default:return 10}}function mL(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const gL='Autosize "fit" only works for single views and layered views.';function vL(e){return`${e=="width"?"Width":"Height"} "container" only works for single views and layered views.`}function yL(e){return`${e=="width"?"Width":"Height"} "container" only works well with autosize "fit" or "fit-${e=="width"?"x":"y"}".`}function bL(e){return e?`Dropping "fit-${e}" because spec has discrete ${Lv(e)}.`:'Dropping "fit" because spec has discrete size.'}function xL(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function wL(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function kL(e){return`The "nearest" transform is not supported for ${e} marks.`}function _L(e){return`Selection not supported for ${e} yet.`}function EL(e){return`Cannot find a selection named "${e}".`}const CL="Scale bindings are currently only supported for scales with unbinned, continuous domains.",AL="Legend bindings are only supported for selections over an individual field or encoding channel.";function OL(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}function SL(e){return`Unknown repeated value "${e}".`}function DL(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const TL="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function NL(e){return`Unrecognized parse "${e}".`}function IL(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function FL(e){return`Ignoring an invalid transform: ${hl(e)}.`}const RL='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function ML(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function jL(e){return`Layer's shared ${e.join(",")} channel ${e.length===1?"is":"are"} overriden.`}function BL(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${hl(t)} is overridden by a child projection ${hl(n)}.`}const PL="Arc marks uses theta channel rather than angle, replacing angle with theta.";function LL(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${hl(n)}}.`}function zL(e){return`Invalid field type "${e}".`}function UL(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function WL(e){return`Invalid aggregation operator "${e}".`}function VL(e,t){return`Missing type for channel "${e}", using "${t}" instead.`}function qL(e,t){const{fill:n,stroke:r}=t;return`Dropping color ${e} as the plot also has ${n&&r?"fill and stroke":n?"fill":"stroke"}.`}function HL(e,t){return`Dropping ${hl(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}function GL(e,t,n){return`${e}-encoding with type ${t} is deprecated. Replacing with ${n}-encoding.`}const $L="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function KL(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function XL(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function YL(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function JL(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function QL(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function ZL(e,t){return`Line mark is for continuous lines and thus cannot be used with ${e&&t?"x2 and y2":e?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function ez(e,t){return`Specified orient "${e}" overridden with "${t}".`}const tz="Custom domain scale cannot be unioned with default field-based domain.",nz=`Scale's "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.`;function rz(e){return`Cannot use the scale property "${e}" with non-color channel.`}function iz(e){return`Using unaggregated domain with raw field has no effect (${hl(e)}).`}function oz(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function az(e){return`Unaggregated domain is currently unsupported for log scale (${hl(e)}).`}function sz(e){return`Cannot apply size to non-oriented mark "${e}".`}function uz(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function cz(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function lz(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function fz(e,t){return`Scale type "${t}" does not work with mark "${e}".`}function hz(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function dz(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${hl(n)} and ${hl(r)}). Using ${hl(n)}.`}function pz(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${hl(n)} and ${hl(r)}). Using the union of the two domains.`}function mz(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function gz(e){return`Dropping sort property ${hl(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const vz="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",yz="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",bz="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",xz="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.",wz="Invalid channel for axis.";function kz(e){return`Cannot stack "${e}" if there is already "${e}2".`}function _z(e){return`Cannot stack non-linear scale (${e}).`}function Ez(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function Cz(e,t){return`Invalid ${e}: ${hl(t)}.`}function Az(e){return`Dropping day from datetime ${hl(e)} as day cannot be combined with other units.`}function Oz(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function Sz(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function Dz(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function Tz(e,t){return`Center is not needed to be specified in ${t} when extent is ${e}.`}function Nz(e){return`1D error band does not support ${e}.`}function Iz(e){return`Channel ${e} is required for "binned" bin.`}function Fz(e){return`Domain for ${e} is required for threshold scale.`}const jI=function(e,t){var n=e||0;return{level:function(r){return arguments.length?(n=+r,this):n},error:function(){return n>=1&&Pk(t||"error","ERROR",arguments),this},warn:function(){return n>=2&&Pk(t||"warn","WARN",arguments),this},info:function(){return n>=3&&Pk(t||"log","INFO",arguments),this},debug:function(){return n>=4&&Pk(t||"log","DEBUG",arguments),this}}}(2);let r_=jI;function Rz(){return r_=jI}function _i(...e){r_.warn(...e)}function Cb(e){if(e&&md(e)){for(const t of vA)if(t in e)return!0}return!1}const BI=["january","february","march","april","may","june","july","august","september","october","november","december"],Mz=BI.map(e=>e.substr(0,3)),PI=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],jz=PI.map(e=>e.substr(0,3));function gA(e,t){const n=[];if(t&&e.day!==void 0&&Si(e).length>1&&(_i(me.droppedDay(e)),delete(e=ls(e)).day),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const r=t?function(i){if(aA(i)&&(i=+i),Gf(i))return i-1;{const s=i.toLowerCase(),f=BI.indexOf(s);if(f!==-1)return f;const v=s.substr(0,3),w=Mz.indexOf(v);if(w!==-1)return w;throw new Error(me.invalidTimeUnit("month",i))}}(e.month):e.month;n.push(r)}else if(e.quarter!==void 0){const r=t?function(i){if(aA(i)&&(i=+i),Gf(i))return i>4&&_i(me.invalidTimeUnit("quarter",i)),i-1;throw new Error(me.invalidTimeUnit("quarter",i))}(e.quarter):e.quarter;n.push(Gf(r)?3*r:r+"*3")}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const r=t?function(i){if(aA(i)&&(i=+i),Gf(i))return i%7;{const s=i.toLowerCase(),f=PI.indexOf(s);if(f!==-1)return f;const v=s.substr(0,3),w=jz.indexOf(v);if(w!==-1)return w;throw new Error(me.invalidTimeUnit("day",i))}}(e.day):e.day;n.push(Gf(r)?r+1:r+"+1")}else n.push(1);for(const r of["hours","minutes","seconds","milliseconds"]){const i=e[r];n.push(i===void 0?0:i)}return n}function l2(e){const t=gA(e,!0).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}const LI={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},vA=Si(LI);function yA(e){return e.startsWith("utc")}const Bz={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function bA(e){const t=[];for(const n of vA)zI(e,n)&&t.push(n);return t}function zI(e,t){const n=e.indexOf(t);return!(n<0)&&!(n>0&&t==="seconds"&&e.charAt(n-1)==="i")&&!(e.length>n+3&&t==="day"&&e.charAt(n+3)==="o")&&!(n>0&&t==="year"&&e.charAt(n-1)==="f")}function Pz(e,t,{end:n}={end:!1}){const r=fI(t),i=yA(e)?"utc":"";function s(w){return w==="quarter"?`(${i}quarter(${r})-1)`:`${i}${w}(${r})`}let f;const v={};for(const w of vA)zI(e,w)&&(v[w]=s(w),f=w);return n&&(v[f]+="+1"),function(w){const O=gA(w,!1).join(", ");return w.utc?`utc(${O})`:`datetime(${O})`}(v)}function UI(e){if(!e)return;const t=bA(e);return`timeUnitSpecifier(${e2()(t)}, ${e2()(Bz)})`}function Im(e){if(!e)return;let t;return cs(e)?t={unit:e}:md(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),yA(t.unit)&&(t.utc=!0,t.unit=function(n){return n.substr(3)}(t.unit)),t}function xa(e){return e&&!!e.signal}function Y1(e){return!!e.step}function J1(e){return!$o(e)&&"field"in e&&"data"in e}const Lz=Si({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1}),zz={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},xA=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function wA(e){return e&&!!e.field&&e.equal!==void 0}function WI(e){return e&&!!e.field&&e.lt!==void 0}function VI(e){return e&&!!e.field&&e.lte!==void 0}function qI(e){return e&&!!e.field&&e.gt!==void 0}function HI(e){return e&&!!e.field&&e.gte!==void 0}function kA(e){return!!(e&&e.field&&($o(e.range)&&e.range.length===2||xa(e.range)))}function _A(e){return e&&!!e.field&&($o(e.oneOf)||$o(e.in))}function GI(e){return _A(e)||wA(e)||kA(e)||WI(e)||qI(e)||VI(e)||HI(e)}function Uv(e,t){return UA(e,{timeUnit:t,wrapTime:!0})}function $I(e,t=!0){var n;const{field:r}=e,i=(n=Im(e.timeUnit))===null||n===void 0?void 0:n.unit,s=i?"time("+Pz(i,r)+")":Fi(e,{expr:"datum"});if(wA(e))return s+"==="+Uv(e.equal,i);if(WI(e))return`${s}<${Uv(e.lt,i)}`;if(qI(e))return`${s}>${Uv(e.gt,i)}`;if(VI(e))return`${s}<=${Uv(e.lte,i)}`;if(HI(e))return`${s}>=${Uv(e.gte,i)}`;if(_A(e))return`indexof([${function(f,v){return f.map(w=>Uv(w,v))}(e.oneOf,i).join(",")}], ${s}) !== -1`;if(function(f){return f&&!!f.field&&f.valid!==void 0}(e))return EA(s,e.valid);if(kA(e)){const{range:f}=e,v=xa(f)?{signal:`${f.signal}[0]`}:f[0],w=xa(f)?{signal:`${f.signal}[1]`}:f[1];if(v!==null&&w!==null&&t)return"inrange("+s+", ["+Uv(v,i)+", "+Uv(w,i)+"])";const O=[];return v!==null&&O.push(`${s} >= ${Uv(v,i)}`),w!==null&&O.push(`${s} <= ${Uv(w,i)}`),O.length>0?O.join(" && "):"true"}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function EA(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function Uz(e){var t;return GI(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=Im(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const Ab={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},By=Ab.quantitative,CA=Ab.ordinal,Ob=Ab.temporal,AA=Ab.nominal,Sb=Ab.geojson,Wz=Si(Ab),Kf={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},OA={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},Vz=Si(OA);function qz(e,t){const n=OA[e],r=OA[t];return n===r||n==="ordinal-position"&&r==="time"||r==="ordinal-position"&&n==="time"}const Hz={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function KI(e){return Hz[e]}const XI=["linear","log","pow","sqrt","symlog","time","utc"],Gz=Ny(XI),$z=Ny(["linear","log","pow","sqrt","symlog"]),Kz=Ny(["quantile","quantize","threshold"]),Xz=Ny(XI.concat(["quantile","quantize","threshold","sequential","identity"])),Yz=Ny(["ordinal","bin-ordinal","point","band"]);function Cg(e){return e in Yz}function V0(e){return e in Xz}function hv(e){return e in Gz}function i_(e){return e in Kz}function YI(e){return e==null?void 0:e.selection}const Jz={type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},Qz=Bo(Jz,["type","domain","range","scheme"]),Zz=Si(Qz);(function(){var e;const t={};for(const n of SI)for(const r of Wz)for(const i of Vz){const s=eU(n,r);eF(n,i)&&ZI(i,r)&&(t[s]=(e=t[s])!==null&&e!==void 0?e:[],t[s].push(i))}})();function JI(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!Yo(["point","band","identity"],e);case"bins":return!Yo(["point","band","identity","ordinal"],e);case"round":return hv(e)||e==="band"||e==="point";case"padding":return hv(e)||Yo(["point","band"],e);case"paddingOuter":case"align":return Yo(["point","band"],e);case"paddingInner":return e==="band";case"domainMid":case"clamp":return hv(e);case"nice":return hv(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return V0(e)&&!Yo(["log","time","utc","threshold","quantile"],e)}}function QI(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return Eb(e)?void 0:me.cannotUseScalePropertyWithNonColor(e);case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function ZI(e,t){return Yo([CA,AA],t)?e===void 0||Cg(e):t===Ob?Yo([Kf.TIME,Kf.UTC,void 0],e):t!==By||Yo([Kf.LOG,Kf.POW,Kf.SQRT,Kf.SYMLOG,Kf.QUANTILE,Kf.QUANTIZE,Kf.THRESHOLD,Kf.LINEAR,void 0],e)}function eF(e,t){if(!X1(e))return!1;switch(e){case Ol:case Dh:case lv:case Fv:return hv(t)||Yo(["band","point"],t);case p1:case H1:case m1:case V1:case q1:case Ry:return hv(t)||i_(t)||Yo(["band","point","ordinal"],t);case _g:case jv:case Bv:return t!=="band";case G1:return t==="ordinal"||i_(t);case Eg:return t==="ordinal"}}function eU(e,t){return e+"_"+t}function SA(e){const{channel:t,channelDef:n,markDef:r,scale:i,config:s}=e,f=nF(e);return Vi(n)&&!_I(n.aggregate)&&i&&hv(i.get("type"))&&i.get("zero")===!1?tF({fieldDef:n,channel:t,markDef:r,ref:f,config:s}):f}function tF({fieldDef:e,channel:t,markDef:n,ref:r,config:i}){return Iy(n.type)||Ou("invalid",n,i)===null?r:[function(s,f){const v=DA(s,!0),w=jy(f)==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:v},w)}(e,t),r]}function DA(e,t=!0){return EA(cs(e)?e:Fi(e,{expr:"datum"}),!t)}function Py(e,t,n,r){const i={};if(t&&(i.scale=t),Z1(e)){const{datum:s}=e;Cb(s)?i.signal=l2(s):xa(s)?i.signal=s.signal:i.value=s}else i.field=Fi(e,n);if(r){const{offset:s,band:f}=r;s&&(i.offset=s),f&&(i.band=f)}return i}function o_({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:r,startSuffix:i,band:s=.5}){const f=0<s&&s<1?"datum":void 0,v=Fi(t,{expr:f,suffix:i}),w=n!==void 0?Fi(n,{expr:f}):Fi(t,{suffix:"end",expr:f}),O={};if(s===0||s===1){O.scale=e;const N=s===0?v:w;O.field=N}else{const N=`${s} * ${v} + ${1-s} * ${w}`;O.signal=`scale("${e}", ${N})`}return r&&(O.offset=r),O}function nF({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:s,scale:f,stack:v,offset:w,defaultRef:O,band:N}){var L;if(t){if(Na(t)){if(o0(t)){N=N!=null?N:d2({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:v,config:i,isMidPoint:!0});const{bin:ie,timeUnit:fe,type:ve}=t;if(Nc(ie)||N&&fe&&ve===Ob)return v&&v.impute?Py(t,s,{binSuffix:"mid"},{offset:w}):N?o_({scaleName:s,fieldOrDatumDef:t,band:N,offset:w}):Py(t,s,p2(t,e)?{binSuffix:"range"}:{},{offset:w});if(Nm(ie)){if(Vi(n))return o_({scaleName:s,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:N,offset:w});{const Be=e===Ol?cv:Iv;_i(me.channelRequiredForBinned(Be))}}}const Y=f==null?void 0:f.get("type");return Py(t,s,Cg(Y)?{binSuffix:"range"}:{},{offset:w,band:Y==="band"?(L=N!=null?N:t.band)!==null&&L!==void 0?L:.5:void 0})}if(g1(t)){const Y=t.value,ie=w?{offset:w}:{};return Object.assign(Object.assign({},f2(e,Y)),ie)}}return RP(O)&&(O=O()),O&&Object.assign(Object.assign({},O),w?{offset:w}:{})}function f2(e,t){return Yo(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:Yo(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:Ef(t)}function Ly(e){return e&&e!=="number"&&e!=="time"}function rF(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}const tU=" \u2013 ";function TA({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:s}){var f,v;if(Ly(n))return NA({fieldOrDatumDef:e,format:t,formatType:n,expr:r,config:s});const w=iF(e,r,i);if(d_(e)){const O=function(N,L,Y,ie,fe){return!L||Y?(Y=cs(Y)?Y:ie,`${fe?"utc":"time"}Format(${N}, '${Y}')`):function(ve,Be,We){if(!ve)return;const Ve=UI(ve);return`${We||yA(ve)?"utc":"time"}Format(${Be}, ${Ve})`}(L,N,fe)}(w,Vi(e)?(f=Im(e.timeUnit))===null||f===void 0?void 0:f.unit:void 0,t,s.timeFormat,BA(e)&&((v=e.scale)===null||v===void 0?void 0:v.type)===Kf.UTC);return O?{signal:O}:void 0}return t=sF(Q1(e),t,s),Vi(e)&&Nc(e.bin)?{signal:a_(w,Fi(e,{expr:r,binSuffix:"end"}),t,n,s)}:t||Q1(e)==="quantitative"?{signal:`${uF(w,t)}`}:{signal:`isValid(${w}) ? ${w} : ""+${w}`}}function iF(e,t,n){return Vi(e)?n?`${Fi(e,{expr:t,suffix:"end"})}-${Fi(e,{expr:t,suffix:"start"})}`:Fi(e,{expr:t}):function(r){const{datum:i}=r;return Cb(i)?l2(i):`${JSON.stringify(i)}`}(e)}function NA({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:s,field:f}){return f=f!=null?f:iF(e,r,i),Vi(e)&&Nc(e.bin)?{signal:a_(f,Fi(e,{expr:r,binSuffix:"end"}),t,n,s)}:{signal:rF(n,f,t)}}function oF(e,t,n,r,i,s){var f;if(!Ly(r))return d_(e)?function(v,w,O,N){return v||(w?{signal:UI(w)}:N?void 0:O.timeFormat)}(n,Vi(e)?(f=Im(e.timeUnit))===null||f===void 0?void 0:f.unit:void 0,i,s):sF(t,n,i)}function aF(e,t,n){return e&&(xa(e)||e==="number"||e==="time")?e:d_(t)&&n!=="time"&&n!=="utc"?"time":void 0}function sF(e,t,n){return cs(t)?t:e===By?n.numberFormat:void 0}function uF(e,t){return`format(${e}, "${t||""}")`}function cF(e,t,n,r){var i;return Ly(n)?rF(n,e,t):uF(e,(i=cs(t)?t:void 0)!==null&&i!==void 0?i:r.numberFormat)}function a_(e,t,n,r,i){const s=cF(e,n,r,i),f=cF(t,n,r,i);return`${EA(e,!1)} ? "null" : ${s} + "${tU}" + ${f}`}const s_="min",nU={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function lF(e){return e in nU}function fF(e){return!!e&&!!e.encoding}function Wv(e){return!(!e||e.op!=="count"&&!e.field)}function hF(e){return!!e&&$o(e)}function h2(e){return"row"in e||"column"in e}function IA(e){return!!e&&"header"in e}function u_(e){return"facet"in e}function dF(e){const{field:t,timeUnit:n,bin:r,aggregate:i}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{field:t})}function pF(e){return o0(e)&&"sort"in e}function d2({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:i,config:s,isMidPoint:f}){if(Na(t)&&t.band!==void 0)return t.band;if(Vi(t)){const{timeUnit:v,bin:w}=t;if(v&&!n)return f?Wy("timeUnitBandPosition",r,s):xI(r.type)?Wy("timeUnitBand",r,s):0;if(Nc(w))return xI(r.type)&&!f?1:.5}return(i==null?void 0:i.fieldChannel)===e&&f?.5:void 0}function FA(e,t,n,r,i,s){return!!(Nc(t.bin)||t.timeUnit&&o0(t)&&t.type==="temporal")&&!!d2({channel:e,fieldDef:t,fieldDef2:n,stack:r,markDef:i,config:s})}function RA(e){return!!e&&"condition"in e}function c_(e){const t=e&&e.condition;return!!t&&!$o(t)&&Vi(t)}function MA(e){const t=e&&e.condition;return!!t&&!$o(t)&&Na(t)}function Vi(e){return!(!e||!e.field&&e.aggregate!=="count")}function Q1(e){return e&&e.type}function Z1(e){return!!e&&"datum"in e}function Vv(e){return o0(e)&&yF(e)||jA(e)}function jA(e){return Z1(e)&&Gf(e.datum)}function Na(e){return Vi(e)||Z1(e)}function o0(e){return!!e&&("field"in e&&"type"in e||e.aggregate==="count")}function g1(e){return e&&"value"in e&&"value"in e}function BA(e){return!!e&&("scale"in e||"sort"in e)}function PA(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function mF(e){return!!e&&"legend"in e}function gF(e){return!!e&&("format"in e||"formatType"in e)}function Fi(e,t={}){var n,r,i;let s=e.field;const f=t.prefix;let v=t.suffix,w="";if(function(O){return O.aggregate==="count"}(e))s=function(O){return function(N){return N.indexOf("__")===0}(O)?O:`__${O}`}("count");else{let O;if(!t.nofn)if(function(N){return"op"in N}(e))O=e.op;else{const{bin:N,aggregate:L,timeUnit:Y}=e;Nc(N)?(O=RI(N),v=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((r=t.suffix)!==null&&r!==void 0?r:"")):L?Fy(L)?(w=`["${s}"]`,s=`argmax_${L.argmax}`):W1(L)?(w=`["${s}"]`,s=`argmin_${L.argmin}`):O=String(L):Y&&(O=function(ie){const fe=Im(ie),{utc:ve}=fe,Be=Bo(fe,["utc"]);return Be.unit?(ve?"utc":"")+Si(Be).map(We=>dl(`${We==="unit"?"":`_${We}_`}${Be[We]}`)).join(""):(ve?"utc":"")+"timeunit"+Si(Be).map(We=>dl(`_${We}_${Be[We]}`)).join("")}(Y),v=(!Yo(["range","mid"],t.binSuffix)&&t.binSuffix||"")+((i=t.suffix)!==null&&i!==void 0?i:""))}O&&(s=s?`${O}_${s}`:O)}return v&&(s=`${s}_${v}`),f&&(s=`${f}_${s}`),t.forAs?hI(s):t.expr?function(O,N="datum"){return`${N}[${Ws(Dy(O).join("."))}]`}(s,t.expr)+w:U1(s)+w}function vF(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return Vi(e)&&!!e.bin;case"temporal":return!1}throw new Error(me.invalidFieldType(e.type))}function yF(e){return!vF(e)}const bF=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return function(n){const{aggregate:r,bin:i,timeUnit:s,field:f}=n;if(Fy(r))return`${f} for argmax(${r.argmax})`;if(W1(r))return`${f} for argmin(${r.argmin})`;const v=Im(s),w=r||(v==null?void 0:v.unit)||(v==null?void 0:v.maxbins)&&"timeunit"||Nc(i)&&"bin";return w?w.toUpperCase()+"("+f+")":f}(e);default:return function(n,r){var i;const{field:s,bin:f,timeUnit:v,aggregate:w}=n;if(w==="count")return r.countTitle;if(Nc(f))return`${s} (binned)`;if(v){const O=(i=Im(v))===null||i===void 0?void 0:i.unit;if(O)return`${s} (${bA(O).join("-")})`}else if(w)return Fy(w)?`${s} for max ${w.argmax}`:W1(w)?`${s} for min ${w.argmin}`:`${zk(w)} of ${s}`;return s}(e,t)}};let xF=bF;function wF(e){xF=e}function zy(e,t,{allowDisabling:n,includeDefault:r=!0}){var i,s;const f=((i=LA(e))!==null&&i!==void 0?i:{}).title;if(!Vi(e))return f;const v=e,w=r?kF(v,t):void 0;return n?$f(f,v.title,w):(s=f!=null?f:v.title)!==null&&s!==void 0?s:w}function LA(e){return PA(e)&&e.axis?e.axis:mF(e)&&e.legend?e.legend:IA(e)&&e.header?e.header:void 0}function kF(e,t){return xF(e,t)}function l_(e){var t;if(gF(e)){const{format:n,formatType:r}=e;return{format:n,formatType:r}}{const n=(t=LA(e))!==null&&t!==void 0?t:{},{format:r,formatType:i}=n;return{format:r,formatType:i}}}function qv(e){return Vi(e)?e:c_(e)?e.condition:void 0}function Th(e){return Na(e)?e:MA(e)?e.condition:void 0}function zA(e,t,n){if(cs(e)||Gf(e)||Zx(e)){const r=cs(e)?"string":Gf(e)?"number":"boolean";return _i(me.primitiveChannelDef(t,r,e)),{value:e}}return Na(e)?f_(e,t,n):MA(e)?Object.assign(Object.assign({},e),{condition:f_(e.condition,t,n)}):e}function f_(e,t,n){if(gF(e)){const{format:r,formatType:i}=e,s=Bo(e,["format","formatType"]);if(Ly(i)&&!n.customFormatTypes)return _i(me.customFormatTypeNotAllowed(t)),f_(s,t,n)}else{const r=PA(e)?"axis":mF(e)?"legend":IA(e)?"header":null;if(r&&e[r]){const i=e[r],{format:s,formatType:f}=i,v=Bo(i,["format","formatType"]);if(Ly(f)&&!n.customFormatTypes)return _i(me.customFormatTypeNotAllowed(t)),f_(Object.assign(Object.assign({},e),{[r]:v}),t,n)}}return Vi(e)?_F(e,t):function(r){let i=r.type;if(i)return r;const{datum:s}=r;return i=Gf(s)?"quantitative":cs(s)?"nominal":Cb(s)?"temporal":void 0,Object.assign(Object.assign({},r),{type:i})}(e)}function _F(e,t){const{aggregate:n,timeUnit:r,bin:i,field:s}=e,f=Object.assign({},e);if(!n||fA(n)||Fy(n)||W1(n)||(_i(me.invalidAggregate(n)),delete f.aggregate),r&&(f.timeUnit=Im(r)),s&&(f.field=`${s}`),Nc(i)&&(f.bin=h_(i,t)),Nm(i)&&!zv(t)&&_i(`Channel ${t} should not be used with "binned" bin.`),o0(f)){const{type:v}=f,w=function(O){if(O)switch(O=O.toLowerCase()){case"q":case By:return"quantitative";case"t":case Ob:return"temporal";case"o":case CA:return"ordinal";case"n":case AA:return"nominal";case Sb:return"geojson"}}(v);v!==w&&(f.type=w),v!=="quantitative"&&_I(n)&&(_i(me.invalidFieldTypeForCountAggregate(v,n)),f.type="quantitative")}else if(!TI(t)){const v=function(w,O){if(w.timeUnit)return"temporal";if(Nc(w.bin))return"quantitative";switch(t_(O)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative"}}(f,t);_i(me.missingFieldType(t,v)),f.type=v}if(o0(f)){const{compatible:v,warning:w}=function(O,N){const L=O.type;if(L==="geojson"&&N!=="shape")return{compatible:!1,warning:`Channel ${N} should not be used with a geojson data.`};switch(N){case l1:case f1:case Kk:return yF(O)?{compatible:!1,warning:me.facetChannelShouldBeDiscrete(N)}:Uy;case Ol:case Dh:case _g:case jv:case Bv:case a2:case u2:case Xk:case My:case Yk:case Jk:case Ry:case lv:case Fv:case Qk:return Uy;case Mv:case z0:case Rv:case fv:return L!==By?{compatible:!1,warning:`Channel ${N} should be used with a quantitative field only, not ${O.type} field.`}:Uy;case m1:case V1:case q1:case H1:case p1:case d1:case h1:case cv:case Iv:return L!=="nominal"||O.sort?Uy:{compatible:!1,warning:`Channel ${N} should not be used with an unsorted discrete field.`};case G1:return Yo(["ordinal","nominal"],O.type)?Uy:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case Eg:return Yo(["ordinal","nominal","geojson"],O.type)?Uy:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case s2:return O.type!=="nominal"||"sort"in O?Uy:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(f,t);v||_i(w)}if(pF(f)&&cs(f.sort)){const{sort:v}=f;if(lF(v))return Object.assign(Object.assign({},f),{sort:{encoding:v}});const w=v.substr(1);if(v.charAt(0)==="-"&&lF(w))return Object.assign(Object.assign({},f),{sort:{encoding:w,order:"descending"}})}if(IA(f)){const{header:v}=f,{orient:w}=v,O=Bo(v,["orient"]);if(w)return Object.assign(Object.assign({},f),{header:Object.assign(Object.assign({},O),{labelOrient:v.labelOrient||w,titleOrient:v.titleOrient||w})})}return f}function h_(e,t){return Zx(e)?{maxbins:MI(t)}:e==="binned"?{binned:!0}:e.maxbins||e.step?e:Object.assign(Object.assign({},e),{maxbins:MI(t)})}const Uy={compatible:!0};function d_(e){const{formatType:t}=l_(e);return t==="time"||!t&&function(n){return n&&(n.type==="temporal"||Vi(n)&&!!n.timeUnit)}(e)}function UA(e,{timeUnit:t,type:n,wrapTime:r,undefinedIfExprNotRequired:i}){var s;const f=t&&((s=Im(t))===null||s===void 0?void 0:s.unit);let v,w=f||n==="temporal";return xa(e)?v=e.signal:Cb(e)?(w=!0,v=l2(e)):(cs(e)||Gf(e))&&w&&(v=`datetime(${JSON.stringify(e)})`,function(O){return!!LI[O]}(f)&&(Gf(e)&&e<1e4||cs(e)&&isNaN(Date.parse(e)))&&(v=l2({[f]:e}))),v?r&&w?`time(${v})`:v:i?void 0:JSON.stringify(e)}function EF(e,t){const{type:n}=e;return t.map(r=>{const i=UA(r,{timeUnit:Vi(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return i!==void 0?{signal:i}:r})}function p2(e,t){return Nc(e.bin)?X1(t)&&Yo(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function CF(e){const{anchor:t,frame:n,offset:r,orient:i,color:s,subtitleColor:f,subtitleFont:v,subtitleFontSize:w,subtitleFontStyle:O,subtitleFontWeight:N,subtitleLineHeight:L,subtitlePadding:Y}=e,ie=Bo(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),fe=Object.assign(Object.assign({},ie),s?{fill:s}:{}),ve=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),r?{offset:r}:{}),i?{orient:i}:{}),Be=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},f?{subtitleColor:f}:{}),v?{subtitleFont:v}:{}),w?{subtitleFontSize:w}:{}),O?{subtitleFontStyle:O}:{}),N?{subtitleFontWeight:N}:{}),L?{subtitleLineHeight:L}:{}),Y?{subtitlePadding:Y}:{});return{titleMarkConfig:fe,subtitleMarkConfig:n2(fe,["align","baseline","dx","dy","limit"]),nonMark:ve,subtitle:Be}}function ey(e){return cs(e)||$o(e)&&cs(e[0])}function Ef(e){return xa(e)?e:e!==void 0?{value:e}:void 0}function AF(e){return xa(e)?e.signal:Ws(e.value)}function m2(e){return xa(e)?e.signal:e==null?null:Ws(e)}function OF(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function Ou(e,t,n,r={}){const{vgChannel:i,ignoreVgConfig:s}=r;return i&&t[i]!==void 0?t[i]:t[e]!==void 0?t[e]:!s||i&&i!==e?Wy(e,t,n,r):void 0}function Wy(e,t,n,{vgChannel:r}={}){return $f(r?p_(e,t,n.style):void 0,p_(e,t,n.style),r?n[t.type][r]:void 0,n[t.type][e],r?n.mark[r]:n.mark[e])}function p_(e,t,n){return SF(e,OF(t),n)}function SF(e,t,n){let r;t=_f(t);for(const i of t){const s=n[i];s&&s[e]!==void 0&&(r=s[e])}return r}function DF(e,t){return _f(e).reduce((n,r)=>{var i;return n.field.push(Fi(r,t)),n.order.push((i=r.sort)!==null&&i!==void 0?i:"ascending"),n},{field:[],order:[]})}function TF(e,t){const n=[...e];return t.forEach(r=>{for(const i of n)if(t2(i,r))return;n.push(r)}),n}function NF(e,t){return t2(e,t)||!t?e:e?[..._f(e),..._f(t)].join(", "):t}function IF(e,t){const n=e.value,r=t.value;if(n==null||r===null)return{explicit:e.explicit,value:null};if((ey(n)||xa(n))&&(ey(r)||xa(r)))return{explicit:e.explicit,value:NF(n,r)};if(ey(n)||xa(n))return{explicit:e.explicit,value:n};if(ey(r)||xa(r))return{explicit:e.explicit,value:r};if(!(ey(n)||xa(n)||ey(r)||xa(r)))return{explicit:e.explicit,value:TF(n,r)};throw new Error("It should never reach here")}function Vy(e,t){const n=e&&e[t];return!!n&&($o(n)?r2(n,r=>!!r.field):Vi(n)||c_(n))}function WA(e){return r2(SI,t=>{if(Vy(e,t)){const n=e[t];if($o(n))return r2(n,r=>!!r.aggregate);{const r=qv(n);return r&&!!r.aggregate}}return!1})}function VA(e,t){const n=[],r=[],i=[],s=[],f={};return qA(e,(v,w)=>{if(Vi(v)){const{field:O,aggregate:N,bin:L,timeUnit:Y}=v,ie=Bo(v,["field","aggregate","bin","timeUnit"]);if(N||Y||L){const fe=LA(v),ve=fe&&fe.title;let Be=Fi(v,{forAs:!0});const We=Object.assign(Object.assign(Object.assign({},ve?[]:{title:zy(v,t,{allowDisabling:!0})}),ie),{field:Be});if(N){let Ve;if(Fy(N)?(Ve="argmax",Be=Fi({op:"argmax",field:N.argmax},{forAs:!0}),We.field=`${Be}.${O}`):W1(N)?(Ve="argmin",Be=Fi({op:"argmin",field:N.argmin},{forAs:!0}),We.field=`${Be}.${O}`):N!=="boxplot"&&N!=="errorbar"&&N!=="errorband"&&(Ve=N),Ve){const ct={op:Ve,as:Be};O&&(ct.field=O),s.push(ct)}}else if(n.push(Be),o0(v)&&Nc(L)){if(r.push({bin:L,field:O,as:Be}),n.push(Fi(v,{binSuffix:"end"})),p2(v,w)&&n.push(Fi(v,{binSuffix:"range"})),zv(w)){const Ve={field:Be+"_end"};f[w+"2"]=Ve}We.bin="binned",TI(w)||(We.type=By)}else if(Y){i.push({timeUnit:Y,field:O,as:Be});const Ve=o0(v)&&v.type!==Ob&&"time";Ve&&(w===a2||w===My?We.formatType=Ve:function(ct){return!!pA[ct]}(w)?We.legend=Object.assign({formatType:Ve},We.legend):zv(w)&&(We.axis=Object.assign({formatType:Ve},We.axis)))}f[w]=We}else n.push(O),f[w]=e[w]}else f[w]=e[w]}),{bins:r,timeUnits:i,aggregate:s,groupby:n,encoding:f}}function rU(e,t,n){const r=t.type;return Si(e).reduce((i,s)=>{if(!DI(s))return _i(me.invalidEncodingChannel(s)),i;const f=e[s];if(s!=="angle"||r!=="arc"||e.theta||(_i(me.REPLACE_ANGLE_WITH_THETA),s=lv),!function(v,w,O){const N=dL(w,O);if(!N)return!1;if(N==="binned"){const L=v[w===cv?Ol:Dh];return!!(Vi(L)&&Vi(v[w])&&Nm(L.bin))}return!0}(e,s,r))return _i(me.incompatibleChannel(s,r)),i;if(s===p1&&r==="line"){const v=qv(e[s]);if(v!=null&&v.aggregate)return _i(me.LINE_WITH_VARYING_SIZE),i}if(s===_g&&(t.filled?"fill"in e:"stroke"in e))return _i(me.droppingColor("encoding",{fill:"fill"in e,stroke:"stroke"in e})),i;if(s===u2||s===s2&&!$o(f)&&!g1(f)||s===My&&$o(f))f&&(i[s]=_f(f).reduce((v,w)=>(Vi(w)?v.push(_F(w,s)):_i(me.emptyFieldDef(w,s)),v),[]));else{if(s===My&&f===null)i[s]=null;else if(!(Vi(f)||Z1(f)||g1(f)||RA(f)||xa(f)))return _i(me.emptyFieldDef(f,s)),i;i[s]=zA(f,s,n)}return i},{})}function qA(e,t,n){if(e)for(const r of Si(e)){const i=e[r];if($o(i))for(const s of i)t.call(n,s,r);else t.call(n,i,r)}}function FF(e,t,n,r){return e?Si(e).reduce((i,s)=>{const f=e[s];return $o(f)?f.reduce((v,w)=>t.call(r,v,w,s),i):t.call(r,i,f,s)},n):n}function RF(e,t){return Si(t).reduce((n,r)=>{switch(r){case Ol:case Dh:case Yk:case Qk:case Jk:case cv:case Iv:case lv:case d1:case Fv:case h1:case Rv:case Mv:case fv:case z0:case a2:case Eg:case Ry:case My:return n;case s2:if(e==="line"||e==="trail")return n;case u2:case Xk:{const i=t[r];if($o(i)||Vi(i))for(const s of _f(i))s.aggregate||n.push(Fi(s,{}));return n}case p1:if(e==="trail")return n;case _g:case jv:case Bv:case m1:case V1:case q1:case G1:case H1:{const i=qv(t[r]);return i&&!i.aggregate&&n.push(Fi(i,{})),n}}},[])}function HA(e,t,n,r=!0){return"tooltip"in n?{tooltip:n.tooltip}:{tooltip:[...e.map(({fieldPrefix:i,titlePrefix:s})=>{const f=r?` of ${t.field}`:"";return{field:i+t.field,type:t.type,title:xa(s)?{signal:s+`"${escape(f)}"`}:s+f}}),...function(i){const s=[];for(const f of Si(i))if(Vy(i,f)){const v=i[f],w=_f(v);for(const O of w)Vi(O)?s.push(O):c_(O)&&s.push(O.condition)}return s}(n)]}}function MF(e){const{axis:t,title:n,field:r}=e;return t&&t.title!==void 0?void 0:$f(n,r)}function GA(e,t,n,r,i){const{scale:s,axis:f}=n;return({partName:v,mark:w,positionPrefix:O,endPositionPrefix:N,aria:L,extraEncoding:Y={}})=>{const ie=MF(n);return jF(e,v,i,L,{mark:w,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:O+"_"+n.field,type:n.type},ie!==void 0?{title:ie}:{}),s!==void 0?{scale:s}:{}),f!==void 0?{axis:f}:{})},cs(N)?{[t+"2"]:{field:N+"_"+n.field}}:{}),r),Y)})}}function jF(e,t,n,r,i){const{clip:s,color:f,opacity:v}=e,w=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),s?{clip:s}:{}),f?{color:f}:{}),v?{opacity:v}:{}),Nv(i.mark)?i.mark:{type:i.mark}),{style:`${w}-${t}`}),Zx(e[t])?{}:e[t]),r===!1?{aria:r}:{})})]:[]}function BF(e,t,n){const{encoding:r}=e,i=t==="vertical"?"y":"x",s=r[i],f=r[i+"2"],v=r[i+"Error"],w=r[i+"Error2"];return{continuousAxisChannelDef:m_(s,n),continuousAxisChannelDef2:m_(f,n),continuousAxisChannelDefError:m_(v,n),continuousAxisChannelDefError2:m_(w,n),continuousAxis:i}}function m_(e,t){if(e&&e.aggregate){const{aggregate:n}=e,r=Bo(e,["aggregate"]);return n!==t&&_i(me.errorBarContinuousAxisHasCustomizedAggregate(n,t)),r}return e}function PF(e,t){const{mark:n,encoding:r}=e,{x:i,y:s}=r;if(Vv(i)){if(Vv(s)){const f=Vi(i)&&i.aggregate,v=Vi(s)&&s.aggregate;if(f||v!==t){if(v||f!==t){if(f===t&&v===t)throw new Error("Both x and y cannot have aggregate");return Nv(n)&&n.orient?n.orient:"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(Vv(s))return"vertical";throw new Error("Need a valid continuous axis for "+t+"s")}const g_="boxplot",iU=new $k(g_,zF);function LF(e){return Gf(e)?"tukey":e}function zF(e,{config:t}){var n,r;const{mark:i,encoding:s,selection:f,projection:v}=e,w=Bo(e,["mark","encoding","selection","projection"]),O=Nv(i)?i:{type:i};f&&_i(me.selectionNotSupported("boxplot"));const N=(n=O.extent)!==null&&n!==void 0?n:t.boxplot.extent,L=Ou("size",O,t),Y=LF(N),{transform:ie,continuousAxisChannelDef:fe,continuousAxis:ve,groupby:Be,aggregate:We,encodingWithoutContinuousAxis:Ve,ticksOrient:ct,boxOrient:lt,customTooltipWithoutAggregatedField:mt}=function(Qr,Ni,ro){const oo=PF(Qr,g_),{continuousAxisChannelDef:Po,continuousAxis:ho}=BF(Qr,oo,g_),ao=Po.field,xo=LF(Ni),_a=[...UF(ao),{op:"median",field:ao,as:"mid_box_"+ao},{op:"min",field:ao,as:(xo==="min-max"?"lower_whisker_":"min_")+ao},{op:"max",field:ao,as:(xo==="min-max"?"upper_whisker_":"max_")+ao}],ys=xo==="min-max"||xo==="tukey"?[]:[{calculate:`datum["upper_box_${ao}"] - datum["lower_box_${ao}"]`,as:"iqr_"+ao},{calculate:`min(datum["upper_box_${ao}"] + datum["iqr_${ao}"] * ${Ni}, datum["max_${ao}"])`,as:"upper_whisker_"+ao},{calculate:`max(datum["lower_box_${ao}"] - datum["iqr_${ao}"] * ${Ni}, datum["min_${ao}"])`,as:"lower_whisker_"+ao}],Lo=Qr.encoding,Vs=ho,qs=(Lo[Vs],Bo(Lo,[typeof Vs=="symbol"?Vs:Vs+""])),{customTooltipWithoutAggregatedField:Su,filteredEncoding:Ic}=function(Wb){const{tooltip:C1}=Wb,Vb=Bo(Wb,["tooltip"]);if(!C1)return{filteredEncoding:Wb};let uy,Rm;if($o(C1)){for(const ZO of C1)ZO.aggregate?(uy||(uy=[]),uy.push(ZO)):(Rm||(Rm=[]),Rm.push(ZO));uy&&(Vb.tooltip=uy)}else C1.aggregate?Vb.tooltip=C1:Rm=C1;return $o(Rm)&&Rm.length===1&&(Rm=Rm[0]),{customTooltipWithoutAggregatedField:Rm,filteredEncoding:Vb}}(qs),{bins:Fc,timeUnits:xc,aggregate:Kd,groupby:nE,encoding:QO}=VA(Ic,ro);return{transform:[...Fc,...xc,{aggregate:[...Kd,..._a],groupby:nE},...ys],groupby:nE,aggregate:Kd,continuousAxisChannelDef:Po,continuousAxis:ho,encodingWithoutContinuousAxis:QO,ticksOrient:oo==="vertical"?"horizontal":"vertical",boxOrient:oo,customTooltipWithoutAggregatedField:Su}}(e,N,t),{color:dt,size:kt}=Ve,wt=Bo(Ve,["color","size"]),dn=Qr=>GA(O,ve,fe,Qr,t.boxplot),Dn=dn(wt),wn=dn(Ve),Xn=dn(Object.assign(Object.assign({},wt),kt?{size:kt}:{})),Kn=HA([{fieldPrefix:Y==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:Y==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],fe,Ve),ir={type:"tick",color:"black",opacity:1,orient:ct,invalid:null},sr=Y==="min-max"?Kn:HA([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],fe,Ve),gr=[...Dn({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:sr}),...Dn({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:sr}),...Dn({partName:"ticks",mark:ir,positionPrefix:"lower_whisker",aria:!1,extraEncoding:sr}),...Dn({partName:"ticks",mark:ir,positionPrefix:"upper_whisker",aria:!1,extraEncoding:sr})],Vr=[...Y!=="tukey"?gr:[],...wn({partName:"box",mark:Object.assign(Object.assign({type:"bar"},L?{size:L}:{}),{orient:lt,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:Kn}),...Xn({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},md(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),L?{size:L}:{}),{orient:ct,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:Kn})];let hi;if(Y!=="min-max"){const Qr=`datum["lower_box_${fe.field}"]`,Ni=`datum["upper_box_${fe.field}"]`,ro=`(${Ni} - ${Qr})`,oo=`${Qr} - ${N} * ${ro}`,Po=`${Ni} + ${N} * ${ro}`,ho=`datum["${fe.field}"]`,ao={joinaggregate:UF(fe.field),groupby:Be};let xo;Y==="tukey"&&(xo={transform:[{filter:`(${oo} <= ${ho}) && (${ho} <= ${Po})`},{aggregate:[{op:"min",field:fe.field,as:"lower_whisker_"+fe.field},{op:"max",field:fe.field,as:"upper_whisker_"+fe.field},{op:"min",field:"lower_box_"+fe.field,as:"lower_box_"+fe.field},{op:"max",field:"upper_box_"+fe.field,as:"upper_box_"+fe.field},...We],groupby:Be}],layer:gr});const _a=Bo(wt,["tooltip"]),{scale:ys,axis:Lo}=fe,Vs=MF(fe),qs=jF(O,"outliers",t.boxplot,!0,{transform:[{filter:`(${ho} < ${oo}) || (${ho} > ${Po})`}],mark:"point",encoding:Object.assign(Object.assign({[ve]:Object.assign(Object.assign(Object.assign({field:fe.field,type:fe.type},Vs!==void 0?{title:Vs}:{}),ys!==void 0?{scale:ys}:{}),Lo!==void 0?{axis:Lo}:{})},_a),mt?{tooltip:mt}:{})})[0];qs&&xo?hi={transform:[ao],layer:[qs,xo]}:qs?(hi=qs).transform.unshift(ao):xo&&(hi=xo).transform.unshift(ao)}return hi?Object.assign(Object.assign({},w),{layer:[hi,{transform:ie,layer:Vr}]}):Object.assign(Object.assign({},w),{transform:((r=w.transform)!==null&&r!==void 0?r:[]).concat(ie),layer:Vr})}function UF(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}const $A="errorbar",oU=new $k($A,WF);function WF(e,{config:t}){const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:s,ticksOrient:f,markDef:v,outerSpec:w,tooltipEncoding:O}=VF(e,$A,t),N=GA(v,i,r,s,t.errorbar),L={type:"tick",orient:f},Y=[...N({partName:"ticks",mark:L,positionPrefix:"lower",aria:!1,extraEncoding:O}),...N({partName:"ticks",mark:L,positionPrefix:"upper",aria:!1,extraEncoding:O}),...N({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:O})];return Object.assign(Object.assign(Object.assign({},w),{transform:n}),Y.length>1?{layer:Y}:Object.assign({},Y[0]))}function aU(e,t){const{encoding:n}=e;if(function(v){return(Na(v.x)||Na(v.y))&&!Na(v.x2)&&!Na(v.y2)&&!Na(v.xError)&&!Na(v.xError2)&&!Na(v.yError)&&!Na(v.yError2)}(n))return{orient:PF(e,t),inputType:"raw"};const r=function(v){return Na(v.x2)||Na(v.y2)}(n),i=function(v){return Na(v.xError)||Na(v.xError2)||Na(v.yError)||Na(v.yError2)}(n),s=n.x,f=n.y;if(r){if(i)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const v=n.x2,w=n.y2;if(Na(v)&&Na(w))throw new Error(`${t} cannot have both x2 and y2`);if(Na(v)){if(Vv(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}if(Na(w)){if(Vv(f))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}{const v=n.xError,w=n.xError2,O=n.yError,N=n.yError2;if(Na(w)&&!Na(v))throw new Error(`${t} cannot have xError2 without xError`);if(Na(N)&&!Na(O))throw new Error(`${t} cannot have yError2 without yError`);if(Na(v)&&Na(O))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(Na(v)){if(Vv(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(Na(O)){if(Vv(f))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function VF(e,t,n){var r;const{mark:i,encoding:s,selection:f,projection:v}=e,w=Bo(e,["mark","encoding","selection","projection"]),O=Nv(i)?i:{type:i};f&&_i(me.selectionNotSupported(t));const{orient:N,inputType:L}=aU(e,t),{continuousAxisChannelDef:Y,continuousAxisChannelDef2:ie,continuousAxisChannelDefError:fe,continuousAxisChannelDefError2:ve,continuousAxis:Be}=BF(e,N,t),{errorBarSpecificAggregate:We,postAggregateCalculates:Ve,tooltipSummary:ct,tooltipTitleWithFieldName:lt}=function(Qr,Ni,ro,oo,Po,ho,ao,xo){let _a=[],ys=[];const Lo=Ni.field;let Vs,qs=!1;if(ho==="raw"){const Su=Qr.center?Qr.center:Qr.extent?Qr.extent==="iqr"?"median":"mean":xo.errorbar.center,Ic=Qr.extent?Qr.extent:Su==="mean"?"stderr":"iqr";if(Su==="median"!=(Ic==="iqr")&&_i(me.errorBarCenterIsUsedWithWrongExtent(Su,Ic,ao)),Ic==="stderr"||Ic==="stdev")_a=[{op:Ic,field:Lo,as:"extent_"+Lo},{op:Su,field:Lo,as:"center_"+Lo}],ys=[{calculate:`datum["center_${Lo}"] + datum["extent_${Lo}"]`,as:"upper_"+Lo},{calculate:`datum["center_${Lo}"] - datum["extent_${Lo}"]`,as:"lower_"+Lo}],Vs=[{fieldPrefix:"center_",titlePrefix:zk(Su)},{fieldPrefix:"upper_",titlePrefix:qF(Su,Ic,"+")},{fieldPrefix:"lower_",titlePrefix:qF(Su,Ic,"-")}],qs=!0;else{let Fc,xc,Kd;Qr.center&&Qr.extent&&_i(me.errorBarCenterIsNotNeeded(Qr.extent,ao)),Ic==="ci"?(Fc="mean",xc="ci0",Kd="ci1"):(Fc="median",xc="q1",Kd="q3"),_a=[{op:xc,field:Lo,as:"lower_"+Lo},{op:Kd,field:Lo,as:"upper_"+Lo},{op:Fc,field:Lo,as:"center_"+Lo}],Vs=[{fieldPrefix:"upper_",titlePrefix:zy({field:Lo,aggregate:Kd,type:"quantitative"},xo,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:zy({field:Lo,aggregate:xc,type:"quantitative"},xo,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:zy({field:Lo,aggregate:Fc,type:"quantitative"},xo,{allowDisabling:!1})}]}}else{(Qr.center||Qr.extent)&&_i(me.errorBarCenterAndExtentAreNotNeeded(Qr.center,Qr.extent)),ho==="aggregated-upper-lower"?(Vs=[],ys=[{calculate:`datum["${ro.field}"]`,as:"upper_"+Lo},{calculate:`datum["${Lo}"]`,as:"lower_"+Lo}]):ho==="aggregated-error"&&(Vs=[{fieldPrefix:"",titlePrefix:Lo}],ys=[{calculate:`datum["${Lo}"] + datum["${oo.field}"]`,as:"upper_"+Lo}],Po?ys.push({calculate:`datum["${Lo}"] + datum["${Po.field}"]`,as:"lower_"+Lo}):ys.push({calculate:`datum["${Lo}"] - datum["${oo.field}"]`,as:"lower_"+Lo}));for(const Su of ys)Vs.push({fieldPrefix:Su.as.substring(0,6),titlePrefix:_b(_b(Su.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:ys,errorBarSpecificAggregate:_a,tooltipSummary:Vs,tooltipTitleWithFieldName:qs}}(O,Y,ie,fe,ve,L,t,n),mt=s,dt=Be,kt=(mt[dt],Be==="x"?"x2":"y2"),wt=(mt[kt],Be==="x"?"xError":"yError"),dn=(mt[wt],Be==="x"?"xError2":"yError2"),Dn=(mt[dn],Bo(mt,[typeof dt=="symbol"?dt:dt+"",typeof kt=="symbol"?kt:kt+"",typeof wt=="symbol"?wt:wt+"",typeof dn=="symbol"?dn:dn+""])),{bins:wn,timeUnits:Xn,aggregate:Kn,groupby:ir,encoding:sr}=VA(Dn,n),gr=[...Kn,...We],Vr=L!=="raw"?[]:ir,hi=HA(ct,Y,sr,lt);return{transform:[...(r=w.transform)!==null&&r!==void 0?r:[],...wn,...Xn,...gr.length===0?[]:[{aggregate:gr,groupby:Vr}],...Ve],groupby:Vr,continuousAxisChannelDef:Y,continuousAxis:Be,encodingWithoutContinuousAxis:sr,ticksOrient:N==="vertical"?"horizontal":"vertical",markDef:O,outerSpec:w,tooltipEncoding:hi}}function qF(e,t,n){return zk(e)+" "+n+" "+t}const KA="errorband",sU=new $k(KA,HF);function HF(e,{config:t}){const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:s,markDef:f,outerSpec:v,tooltipEncoding:w}=VF(e,KA,t),O=f,N=GA(O,i,r,s,t.errorband),L=e.encoding.x!==void 0&&e.encoding.y!==void 0;let Y={type:L?"area":"rect"},ie={type:L?"line":"rule"};const fe=Object.assign(Object.assign({},O.interpolate?{interpolate:O.interpolate}:{}),O.tension&&O.interpolate?{tension:O.tension}:{});return L?(Y=Object.assign(Object.assign(Object.assign({},Y),fe),{ariaRoleDescription:"errorband"}),ie=Object.assign(Object.assign({},ie),fe)):O.interpolate?_i(me.errorBand1DNotSupport("interpolate")):O.tension&&_i(me.errorBand1DNotSupport("tension")),Object.assign(Object.assign({},v),{transform:n,layer:[...N({partName:"band",mark:Y,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:w}),...N({partName:"borders",mark:ie,positionPrefix:"lower",aria:!1,extraEncoding:w}),...N({partName:"borders",mark:ie,positionPrefix:"upper",aria:!1,extraEncoding:w})]})}const GF={};function XA(e,t,n){const r=new $k(e,t);GF[e]={normalizer:r,parts:n}}XA(g_,zF,["box","median","outliers","rule","ticks"]),XA($A,WF,["ticks","rule"]),XA(KA,HF,["band","borders"]);const uU=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],$F=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],cU={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},lU={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},Db="_vgsid_",fU={single:{on:"click",fields:[Db],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[Db],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function YA(e){return!(!e||e!=="legend"&&!e.legend)}function JA(e){return YA(e)&&md(e)}function QA(e){return"concat"in e}function v_(e){return"vconcat"in e}function ZA(e){return"hconcat"in e}function Hv(e){return md(e)&&e.step!==void 0}function KF(e){return e.view||e.width||e.height}const hU=Si({align:1,bounds:1,center:1,columns:1,spacing:1});function eO(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function y_(e,t){const n=g2(e,t);return Hv(n)?n.step:tO}function g2(e,t){var n;return $f((n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"],{step:e.step})}const tO=20,dU={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:tO},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:QP,circle:{},geoshape:{},image:{},line:{},point:{},rect:ZP,rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:fU,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},v1=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],XF={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},YF={blue:v1[0],orange:v1[1],red:v1[2],teal:v1[3],green:v1[4],yellow:v1[5],purple:v1[6],pink:v1[7],brown:v1[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function JF(e={}){const{color:t,font:n,fontSize:r}=e,i=Bo(e,["color","font","fontSize"]);return iI({},dU,n?function(s){return{text:{font:s},style:{"guide-label":{font:s},"guide-title":{font:s},"group-title":{font:s},"group-subtitle":{font:s}}}}(n):{},t?function(s={}){return{signals:[{name:"color",value:md(s)?Object.assign(Object.assign({},YF),s):YF}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(t):{},r?function(s){return{signals:[{name:"fontSize",value:md(s)?Object.assign(Object.assign({},XF),s):XF}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(r):{},i||{})}const pU=["view",...wI],mU=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],gU=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function vU(e){e=ls(e);for(const t of mU)delete e[t];if(e.axis)for(const t in e.axis)sA(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of uU)delete e.legend[t];if(e.mark){for(const t of kI)delete e.mark[t];e.mark.tooltip&&md(e.mark.tooltip)&&delete e.mark.tooltip}for(const t of pU){for(const r of kI)delete e[t][r];const n=gU[t];if(n)for(const r of n)delete e[t][r];yU(e,t)}for(const t of Si(GF))delete e[t];(function(t){const{titleMarkConfig:n,subtitleMarkConfig:r,subtitle:i}=CF(t.title);bc(n)||(t.style["group-title"]=Object.assign(Object.assign({},t.style["group-title"]),n)),bc(r)||(t.style["group-subtitle"]=Object.assign(Object.assign({},t.style["group-subtitle"]),r)),bc(i)?delete t.title:t.title=i})(e);for(const t in e)md(e[t])&&bc(e[t])&&delete e[t];return bc(e)?void 0:e}function yU(e,t,n,r){const i=r?e[t][r]:e[t];t==="view"&&(n="cell");const s=Object.assign(Object.assign({},i),e.style[n!=null?n:t]);bc(s)||(e.style[n!=null?n:t]=s),r||delete e[t]}function b_(e){return"layer"in e}class QF{map(t,n){return u_(t)?this.mapFacet(t,n):function(r){return"repeat"in r}(t)?this.mapRepeat(t,n):ZA(t)?this.mapHConcat(t,n):v_(t)?this.mapVConcat(t,n):QA(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(b_(t))return this.mapLayer(t,n);if(c1(t))return this.mapUnit(t,n);throw new Error(me.invalidSpec(t))}mapLayer(t,n){return Object.assign(Object.assign({},t),{layer:t.layer.map(r=>this.mapLayerOrUnit(r,n))})}mapHConcat(t,n){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map(r=>this.map(r,n))})}mapVConcat(t,n){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map(r=>this.map(r,n))})}mapConcat(t,n){const{concat:r}=t,i=Bo(t,["concat"]);return Object.assign(Object.assign({},i),{concat:r.map(s=>this.map(s,n))})}mapFacet(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}mapRepeat(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}}const bU={zero:1,center:1,normalize:1},xU=new Set([vI,Vk,Wk,Gk,Hk,cA,lA,qk,yI,uA]),wU=new Set([Vk,Wk,vI]);function ZF(e,t){var n,r;const i=t==="x"?"y":"radius",s=e[t],f=e[i];if(Vi(s)&&Vi(f))if(Q1(s)==="quantitative"&&Q1(f)==="quantitative"){if(s.stack)return t;if(f.stack)return i;const v=Vi(s)&&!!s.aggregate;if(v!==(Vi(f)&&!!f.aggregate))return v?t:i;{const w=(n=s.scale)===null||n===void 0?void 0:n.type,O=(r=f.scale)===null||r===void 0?void 0:r.type;if(w&&w!=="linear")return i;if(O&&O!=="linear")return t}}else{if(Q1(s)==="quantitative")return t;if(Q1(f)==="quantitative")return i}else{if(Q1(s)==="quantitative")return t;if(Q1(f)==="quantitative")return i}}function e5(e,t,n={}){const r=Nv(e)?e.type:e;if(!xU.has(r))return null;const i=ZF(t,"x")||ZF(t,"theta");if(!i)return null;const s=t[i],f=Vi(s)?Fi(s,{}):void 0;let v=function(Y){switch(Y){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(i),w=t[v],O=Vi(w)?Fi(w,{}):void 0;O===f&&(O=void 0,w=void 0,v=void 0);const N=lL.reduce((Y,ie)=>{if(ie!=="tooltip"&&Vy(t,ie)){const fe=t[ie];for(const ve of _f(fe)){const Be=qv(ve);if(Be.aggregate)continue;const We=Fi(Be,{});We&&We===O||Y.push({channel:ie,fieldDef:Be})}}return Y},[]);let L;if(s.stack!==void 0?L=Zx(s.stack)?s.stack?"zero":null:s.stack:N.length>0&&wU.has(r)&&(L="zero"),!L||!function(Y){return Y in bU}(L)||WA(t)&&N.length===0)return null;if(s.scale&&s.scale.type&&s.scale.type!==Kf.LINEAR){if(n.disallowNonLinearStack)return null;_i(me.cannotStackNonLinearScale(s.scale.type))}return Na(t[Pv(i)])?(s.stack!==void 0&&_i(me.cannotStackRangedMark(i)),null):(Vi(s)&&s.aggregate&&!Yo(rL,s.aggregate)&&_i(me.stackNonSummativeAggregate(s.aggregate)),{groupbyChannel:w?v:void 0,groupbyField:O,fieldChannel:i,impute:s.impute!==null&&Iy(r),stackBy:N,offset:L})}function nO(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?md(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?md(t.point)?t.point:{}:void 0}function t5(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class kU{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(c1(t)){const{mark:r,encoding:i}=t,s=Nv(r)?r:{type:r};switch(s.type){case"line":case"rule":case"trail":return!!nO(s,n[s.type],i);case"area":return!!nO(s,n[s.type],i)||!!t5(s,n[s.type])}}return!1}run(t,n,r){const{config:i}=n,{selection:s,projection:f,encoding:v,mark:w}=t,O=Bo(t,["selection","projection","encoding","mark"]),N=Nv(w)?w:{type:w},L=nO(N,i[N.type],v),Y=N.type==="area"&&t5(N,i[N.type]),ie=[Object.assign(Object.assign({},s?{selection:s}:{}),{mark:function(Be){const We=Bo(Be,["point","line"]);return Si(We).length>1?We:We.type}(Object.assign(Object.assign({},N.type==="area"&&N.opacity===void 0&&N.fillOpacity===void 0?{opacity:.7}:{}),N)),encoding:u1(v,["shape"])})],fe=e5(N,v);let ve=v;if(fe){const{fieldChannel:Be,offset:We}=fe;ve=Object.assign(Object.assign({},v),{[Be]:Object.assign(Object.assign({},v[Be]),We?{stack:We}:{})})}return Y&&ie.push(Object.assign(Object.assign({},f?{projection:f}:{}),{mark:Object.assign(Object.assign({type:"line"},n2(N,["clip","interpolate","tension","tooltip"])),Y),encoding:ve})),L&&ie.push(Object.assign(Object.assign({},f?{projection:f}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},n2(N,["clip","tooltip"])),L),encoding:ve})),r(Object.assign(Object.assign({},O),{layer:ie}),Object.assign(Object.assign({},n),{config:function(Be){for(const We of["line","area","rule","trail"])Be[We]&&(Be=Object.assign(Object.assign({},Be),{[We]:u1(Be[We],["point","line"])}));return Be}(i)}))}}class _U{constructor(){this.name="RangeStep"}hasMatchingType(t){var n;if(c1(t)&&t.encoding)for(const r of W0){const i=t.encoding[r];if(i&&Na(i)&&((n=i==null?void 0:i.scale)===null||n===void 0?void 0:n.rangeStep))return!0}return!1}run(t){var n;const r={};let i=Object.assign({},t.encoding);for(const s of W0){const f=Lv(s),v=i[s];if(v&&Na(v)&&((n=v==null?void 0:v.scale)===null||n===void 0?void 0:n.rangeStep)){const{scale:w}=v,O=Bo(v,["scale"]),N=w,L=Bo(N,["rangeStep"]);r[f]={step:w.rangeStep},_i(me.RANGE_STEP_DEPRECATED),i=Object.assign(Object.assign({},i),{[s]:Object.assign(Object.assign({},O),bc(L)?{}:{scale:L})})}}return Object.assign(Object.assign(Object.assign({},r),t),{encoding:i})}}function rO(e,t){return t?o5(e,t):e}function iO(e,t,n){const r=t[e];return function(i){return i&&!cs(i)&&"repeat"in i}(r)?r.repeat in n?Object.assign(Object.assign({},t),{[e]:n[r.repeat]}):void _i(me.noSuchRepeatedValue(r.repeat)):t}function n5(e,t){if((e=iO("field",e,t))!==void 0){if(e===null)return null;if(pF(e)&&Wv(e.sort)){const n=iO("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function r5(e,t){if(Vi(e))return n5(e,t);{const n=iO("datum",e,t);return n===e||n.type||(n.type="nominal"),n}}function i5(e,t){if(!Na(e)){if(MA(e)){const n=r5(e.condition,t);return n?Object.assign(Object.assign({},e),{condition:n}):Bo(e,["condition"])}return e}{const n=r5(e,t);if(n)return n;if(RA(e))return{condition:e.condition}}}function o5(e,t){const n={};for(const r in e)if(Ty(e,r)){const i=e[r];if($o(i))n[r]=i.map(s=>i5(s,t)).filter(s=>s);else{const s=i5(i,t);s!==void 0&&(n[r]=s)}}return n}class EU{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(c1(t)){const{encoding:n,mark:r}=t;if(r==="line")for(const i of cL){const s=n[jy(i)];if(n[i]&&(Vi(s)&&!Nm(s.bin)||Z1(s)))return!0}}return!1}run(t,n,r){const{encoding:i}=t;return _i(me.lineWithRange(!!i.x2,!!i.y2)),r(Object.assign(Object.assign({},t),{mark:"rule"}),n)}}function a5(e){const{parentEncoding:t,encoding:n}=e;if(t&&n){const i=Si(t).reduce((s,f)=>(n[f]&&s.push(f),s),[]);i.length>0&&_i(me.encodingOverridden(i))}const r=Object.assign(Object.assign({},t!=null?t:{}),n!=null?n:{});return bc(r)?void 0:r}function s5(e){const{parentProjection:t,projection:n}=e;return t&&n&&_i(me.projectionOverridden({parentProjection:t,projection:n})),n!=null?n:t}function u5(e,t){t===void 0&&(t=JF(e.config));const n=function(f,v={}){return CU.map(f,{config:v})}(e,t),{width:r,height:i}=e,s=function(f,v,w){let{width:O,height:N}=v;const L=c1(f)||b_(f),Y={};L?O=="container"&&N=="container"?(Y.type="fit",Y.contains="padding"):O=="container"?(Y.type="fit-x",Y.contains="padding"):N=="container"&&(Y.type="fit-y",Y.contains="padding"):(O=="container"&&(_i(me.containerSizeNonSingle("width")),O=void 0),N=="container"&&(_i(me.containerSizeNonSingle("height")),N=void 0));const ie=Object.assign(Object.assign(Object.assign({type:"pad"},Y),w?c5(w.autosize):{}),c5(f.autosize));if(ie.type!=="fit"||L||(_i(me.FIT_NON_SINGLE),ie.type="pad"),O=="container"&&ie.type!="fit"&&ie.type!="fit-x"&&_i(me.containerSizeNotCompatibleWithAutosize("width")),N=="container"&&ie.type!="fit"&&ie.type!="fit-y"&&_i(me.containerSizeNotCompatibleWithAutosize("height")),!t2(ie,{type:"pad"}))return ie}(n,{width:r,height:i,autosize:e.autosize},t);return Object.assign(Object.assign({},n),s?{autosize:s}:{})}const CU=new class extends QF{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[iU,oU,sU,new kU,new EU,new _U]}map(e,t){if(c1(e)){const n=Vy(e.encoding,l1),r=Vy(e.encoding,f1),i=Vy(e.encoding,Kk);if(n||r||i)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:r}=t,i=Object.assign(Object.assign({},e),{encoding:rO(e.encoding,t.repeater)});if(n||r)return this.mapUnitWithParentEncodingOrProjection(i,t);const s=this.mapLayerOrUnit.bind(this);for(const f of this.nonFacetUnitNormalizers)if(f.hasMatchingType(i,t.config))return f.run(i,t,s);return i}mapRepeat(e,t){return function(n){return!$o(n.repeat)&&n.repeat.layer}(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:r}=e,i=Bo(e,["repeat","spec"]),{row:s,column:f,layer:v}=n,{repeater:w={},repeaterPrefix:O=""}=t;return s||f?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},s?{row:s}:{}),f?{column:f}:{}),spec:{repeat:{layer:v},spec:r}}),t):Object.assign(Object.assign({},i),{layer:v.map(N=>{const L=Object.assign(Object.assign({},w),{layer:N}),Y=(r.name||"")+O+`child__layer_${dl(N)}`,ie=this.mapLayerOrUnit(r,Object.assign(Object.assign({},t),{repeater:L,repeaterPrefix:Y}));return ie.name=Y,ie})})}mapNonLayerRepeat(e,t){var n;const{repeat:r,spec:i,data:s}=e,f=Bo(e,["repeat","spec","data"]);!$o(r)&&e.columns&&(e=u1(e,["columns"]),_i(me.columnsNotSupportByRowCol("repeat")));const v=[],{repeater:w={},repeaterPrefix:O=""}=t,N=!$o(r)&&r.row||[w?w.row:null],L=!$o(r)&&r.column||[w?w.column:null],Y=$o(r)&&r||[w?w.repeat:null];for(const fe of Y)for(const ve of N)for(const Be of L){const We={repeat:fe,row:ve,column:Be,layer:w.layer},Ve=(i.name||"")+O+"child__"+($o(r)?`${dl(fe)}`:(r.row?`row_${dl(ve)}`:"")+(r.column?`column_${dl(Be)}`:"")),ct=this.map(i,Object.assign(Object.assign({},t),{repeater:We,repeaterPrefix:Ve}));ct.name=Ve,v.push(u1(ct,["data"]))}const ie=$o(r)?e.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:(n=i.data)!==null&&n!==void 0?n:s,align:"all"},f),{columns:ie,concat:v})}mapFacet(e,t){const{facet:n}=e;return h2(n)&&e.columns&&(e=u1(e,["columns"]),_i(me.columnsNotSupportByRowCol("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:r}=e,{parentEncoding:i,parentProjection:s,config:f}=t,v=s5({parentProjection:s,projection:r}),w=a5({parentEncoding:i,encoding:rO(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),v?{projection:v}:{}),w?{encoding:w}:{}),{config:f})}mapFacetedUnit(e,t){const n=e.encoding,{row:r,column:i,facet:s}=n,f=Bo(n,["row","column","facet"]),{mark:v,width:w,projection:O,height:N,view:L,selection:Y,encoding:ie}=e,fe=Bo(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:ve,layout:Be}=this.getFacetMappingAndLayout({row:r,column:i,facet:s},t),We=rO(f,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},fe),Be),{facet:ve,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},w?{width:w}:{}),N?{height:N}:{}),L?{view:L}:{}),O?{projection:O}:{}),{mark:v,encoding:We}),Y?{selection:Y}:{})}),t)}getFacetMappingAndLayout(e,t){var n;const{row:r,column:i,facet:s}=e;if(r||i){s&&_i(me.facetChannelDropped([...r?[l1]:[],...i?[f1]:[]]));const f={},v={};for(const w of[l1,f1]){const O=e[w];if(O){const N=Bo(O,["align","center","spacing","columns"]);f[w]=N;for(const L of["align","center","spacing"])O[L]!==void 0&&(v[L]=(n=v[L])!==null&&n!==void 0?n:{},v[L][w]=O[L])}}return{facetMapping:f,layout:v}}{const{align:f,center:v,spacing:w,columns:O}=s;return{facetMapping:function(N,L){return L?h2(N)?o5(N,L):n5(N,L):N}(Bo(s,["align","center","spacing","columns"]),t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},f?{align:f}:{}),v?{center:v}:{}),w?{spacing:w}:{}),O?{columns:O}:{})}}}mapLayer(e,t){var{parentEncoding:n,parentProjection:r}=t,i=Bo(t,["parentEncoding","parentProjection"]);const{encoding:s,projection:f}=e,v=Bo(e,["encoding","projection"]),w=Object.assign(Object.assign({},i),{parentEncoding:a5({parentEncoding:n,encoding:s}),parentProjection:s5({parentProjection:r,projection:f})});return super.mapLayer(v,w)}};function c5(e){return cs(e)?{type:e}:e!=null?e:{}}const AU=["background","padding"];function l5(e){return AU.reduce((t,n)=>(e&&e[n]!==void 0&&(t[n]=e[n]),t),{})}class y1{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new y1(ls(this.explicit),ls(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return $f(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,n){n.value!==void 0&&this.set(t,n.value,n.explicit)}set(t,n,r){return delete this[r?"implicit":"explicit"][t],this[r?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,n){n.explicit[t]!==void 0?this.set(t,n.explicit[t],!0):n.implicit[t]!==void 0&&this.set(t,n.implicit[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of Si(t.combine())){const r=t.getWithExplicit(n);this.setWithExplicit(n,r)}}}function qy(e){return{explicit:!0,value:e}}function dv(e){return{explicit:!1,value:e}}function f5(e){return(t,n,r,i)=>{const s=e(t.value,n.value);return s>0?t:s<0?n:x_(t,n,r,i)}}function x_(e,t,n,r){return e.explicit&&t.explicit&&_i(me.mergeConflictingProperty(n,r,e.value,t.value)),e}function ty(e,t,n,r,i=x_){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:t2(e.value,t.value)?e:i(e,t,n,r)}class OU extends y1{constructor(t={},n={},r=!1){super(t,n),this.explicit=t,this.implicit=n,this.parseNothing=r}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function v2(e){return"url"in e}function w_(e){return"values"in e}function h5(e){return"name"in e&&!v2(e)&&!w_(e)&&!Hy(e)}function Hy(e){return e&&(d5(e)||p5(e)||oO(e))}function d5(e){return"sequence"in e}function p5(e){return"sphere"in e}function oO(e){return"graticule"in e}const Np="main",k_="raw";function m5(e){return"filter"in e}function SU(e){return"lookup"in e}function DU(e){return"pivot"in e}function TU(e){return"density"in e}function NU(e){return"quantile"in e}function IU(e){return"regression"in e}function FU(e){return"loess"in e}function RU(e){return"sample"in e}function MU(e){return"window"in e}function jU(e){return"joinaggregate"in e}function BU(e){return"flatten"in e}function PU(e){return"calculate"in e}function LU(e){return"bin"in e}function zU(e){return"impute"in e}function UU(e){return"timeUnit"in e}function WU(e){return"aggregate"in e}function VU(e){return"stack"in e}function qU(e){return"fold"in e}function HU(e){return e.map(t=>m5(t)?{filter:function n(r,i){return iA(r)?{not:n(r.not,i)}:rA(r)?{and:r.and.map(s=>n(s,i))}:nA(r)?{or:r.or.map(s=>n(s,i))}:i(r)}(t.filter,Uz)}:t)}function y2(e,t,n,r){const i=RA(t)&&t.condition,s=r(t);return i?{[n]:[..._f(i).map(f=>{const v=r(f),w=function(O){return O.selection}(f)?Z5(e,f.selection):R_(e,f.test);return Object.assign({test:w},v)}),...s!==void 0?[s]:[]]}:s!==void 0?{[n]:s}:{}}function aO(e,t="text"){const n=e.encoding[t];return y2(e,n,t,r=>__(r,e.config))}function __(e,t,n="datum"){if(e){if(g1(e))return Ef(e.value);if(Na(e)){const{format:r,formatType:i}=l_(e);return TA({fieldOrDatumDef:e,format:r,formatType:i,expr:n,config:t})}}}function g5(e,t={}){const{encoding:n,markDef:r,config:i,stack:s}=e,f=n.tooltip;if($o(f))return{tooltip:y5({tooltip:f},s,i,t)};{const v=t.reactiveGeom?"datum.datum":"datum";return y2(e,f,"tooltip",w=>{const O=__(w,i,v);if(O)return O;if(w===null)return;let N=Ou("tooltip",r,i);return N===!0&&(N={content:"encoding"}),cs(N)?{value:N}:md(N)?N.content==="encoding"?y5(n,s,i,t):{signal:v}:void 0})}}function v5(e,t,n,{reactiveGeom:r}={}){const i={},s=r?"datum.datum":"datum",f=[];function v(O,N){const L=jy(N),Y=o0(O)?O:Object.assign(Object.assign({},O),{type:e[L].type}),ie=_f(zy(Y,n,{allowDisabling:!1})).join(", ");let fe;if(zv(N)){const ve=N==="x"?"x2":"y2",Be=qv(e[ve]);if(Nm(Y.bin)&&Be){const We=Fi(Y,{expr:s}),Ve=Fi(Be,{expr:s}),{format:ct,formatType:lt}=l_(Y);fe=a_(We,Ve,ct,lt,n),i[ve]=!0}else if(t&&t.fieldChannel===N&&t.offset==="normalize"){const{format:We,formatType:Ve}=l_(Y);fe=TA({fieldOrDatumDef:Y,format:We,formatType:Ve,expr:s,config:n,normalizeStack:!0}).signal}}fe=fe!=null?fe:__(Y,n,s).signal,f.push({channel:N,key:ie,value:fe})}qA(e,(O,N)=>{Vi(O)?v(O,N):c_(O)&&v(O.condition,N)});const w={};for(const{channel:O,key:N,value:L}of f)i[O]||w[N]||(w[Ws(N)]=L);return w}function y5(e,t,n,{reactiveGeom:r}={}){const i=lI(v5(e,t,n,{reactiveGeom:r})).map(({key:s,value:f})=>`${s}: ${f}`);return i.length>0?{signal:`{${i.join(", ")}}`}:void 0}function GU(e){const{markDef:t,config:n}=e,r=Ou("aria",t,n);return r===!1?{}:Object.assign(Object.assign(Object.assign({},r?{aria:r}:{}),function(i){const{mark:s,markDef:f,config:v}=i;if(v.aria===!1)return{};const w=Ou("ariaRoleDescription",f,v);return w!=null?{ariaRoleDescription:{value:w}}:s in zz?{}:{ariaRoleDescription:{value:s}}}(e)),function(i){const{encoding:s,markDef:f,config:v,stack:w}=i,O=s.description;if(O)return y2(i,O,"description",Y=>__(Y,i.config));const N=Ou("description",f,v);if(N!=null)return{description:Ef(N)};if(v.aria===!1)return{};const L=v5(s,w,v);if(!bc(L))return{description:{signal:lI(L).map(({key:Y,value:ie})=>`${Y} + ": " + (${ie})`).join(' + "; " + ')}}}(e))}function gd(e,t,n={}){const{markDef:r,encoding:i,config:s}=t,{vgChannel:f}=n;let{defaultRef:v,defaultValue:w}=n;v===void 0&&(w=w!=null?w:Ou(e,r,s,{vgChannel:f,ignoreVgConfig:!0}))!==void 0&&(v=Ef(w));const O=i[e];return y2(t,O,f!=null?f:e,N=>nF({channel:e,channelDef:N,markDef:r,config:s,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:v}))}function b5(e,t={filled:void 0}){var n,r,i,s;const{markDef:f,encoding:v,config:w}=e,{type:O}=f,N=(n=t.filled)!==null&&n!==void 0?n:Ou("filled",f,w),L=Yo(["bar","point","circle","square","geoshape"],O)?"transparent":void 0,Y=(i=(r=Ou(N===!0?"color":void 0,f,w,{vgChannel:"fill"}))!==null&&r!==void 0?r:w.mark[N===!0&&"color"])!==null&&i!==void 0?i:L,ie=(s=Ou(N===!1?"color":void 0,f,w,{vgChannel:"stroke"}))!==null&&s!==void 0?s:w.mark[N===!1&&"color"],fe=N?"fill":"stroke",ve=Object.assign(Object.assign({},Y?{fill:Ef(Y)}:{}),ie?{stroke:Ef(ie)}:{});return f.color&&(N?f.fill:f.stroke)&&_i(me.droppingColor("property",{fill:"fill"in f,stroke:"stroke"in f})),Object.assign(Object.assign(Object.assign(Object.assign({},ve),gd("color",e,{vgChannel:fe,defaultValue:N?Y:ie})),gd("fill",e,{defaultValue:v.fill?Y:void 0})),gd("stroke",e,{defaultValue:v.stroke?ie:void 0}))}function E_(e,t){const n=t[function(r){switch(r){case Ol:return"xOffset";case Dh:return"yOffset";case cv:return"x2Offset";case Iv:return"y2Offset";case lv:return"thetaOffset";case Fv:return"radiusOffset";case d1:return"theta2Offset";case h1:return"radius2Offset"}}(e)];if(n)return n}function Ip(e,t,{defaultPos:n,vgChannel:r,isMidPoint:i}){const{encoding:s,markDef:f,config:v,stack:w}=t,O=s[e],N=s[Pv(e)],L=t.scaleName(e),Y=t.getScaleComponent(e),ie=E_(e,f),fe=sO({model:t,defaultPos:n,channel:e,scaleName:L,scale:Y}),ve=!O&&zv(e)&&(s.latitude||s.longitude)?{field:t.getName(e)}:function(Be){const{channel:We,channelDef:Ve,isMidPoint:ct,scaleName:lt,stack:mt,offset:dt,markDef:kt,config:wt}=Be;if(Na(Ve)&&mt&&We===mt.fieldChannel){if(Vi(Ve)){const dn=d2({channel:We,fieldDef:Ve,isMidPoint:ct,markDef:kt,stack:mt,config:wt});if(dn!==void 0)return o_({scaleName:lt,fieldOrDatumDef:Ve,startSuffix:"start",band:dn,offset:dt})}return Py(Ve,lt,{suffix:"end"},{offset:dt})}return SA(Be)}({channel:e,channelDef:O,channel2Def:N,markDef:f,config:v,isMidPoint:i,scaleName:L,scale:Y,stack:w,offset:ie,defaultRef:fe});return ve?{[r||e]:ve}:void 0}function sO({model:e,defaultPos:t,channel:n,scaleName:r,scale:i}){const{markDef:s,config:f}=e;return()=>{const v=jy(n),w=$1(n),O=Ou(n,s,f,{vgChannel:w});if(O!==void 0)return f2(n,O);switch(t){case"zeroOrMin":case"zeroOrMax":if(r){const N=i.get("type");if(!Yo([Kf.LOG,Kf.TIME,Kf.UTC],N)){if(i.domainDefinitelyIncludesZero())return{scale:r,value:0}}}if(t==="zeroOrMin")return v==="y"?{field:{group:"height"}}:{value:0};switch(v){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const N=e[Lv(n)];return Object.assign(Object.assign({},N),{mult:.5})}}}}const $U={left:"x",center:"xc",right:"x2"},KU={top:"y",middle:"yc",bottom:"y2"};function x5(e,t,n,r="middle"){if(e==="radius"||e==="theta")return $1(e);const i=Ou(e==="x"?"align":"baseline",t,n);return e==="x"?$U[i||(r==="top"?"left":"center")]:KU[i||r]}function C_(e,t,{defaultPos:n,defaultPos2:r,range:i}){return i?w5(e,t,{defaultPos:n,defaultPos2:r}):Ip(e,t,{defaultPos:n})}function w5(e,t,{defaultPos:n,defaultPos2:r}){const{markDef:i,config:s}=t,f=Pv(e),v=Lv(e),w=function(N,L,Y){const{encoding:ie,mark:fe,markDef:ve,stack:Be,config:We}=N,Ve=jy(Y),ct=Lv(Y),lt=$1(Y),mt=ie[Ve],dt=N.scaleName(Ve),kt=N.getScaleComponent(Ve),wt=E_(Y in ie||Y in ve?Y:Ve,N.markDef);if(!mt&&(Y==="x2"||Y==="y2")&&(ie.latitude||ie.longitude))return{[lt]:{field:N.getName(Y)}};const dn=function({channel:Dn,channelDef:wn,channel2Def:Xn,markDef:Kn,config:ir,scaleName:sr,scale:gr,stack:Vr,offset:hi,defaultRef:Qr}){return Na(wn)&&Vr&&Dn.charAt(0)===Vr.fieldChannel.charAt(0)?Py(wn,sr,{suffix:"start"},{offset:hi}):SA({channel:Dn,channelDef:Xn,scaleName:sr,scale:gr,stack:Vr,markDef:Kn,config:ir,offset:hi,defaultRef:Qr})}({channel:Y,channelDef:mt,channel2Def:ie[Y],markDef:ve,config:We,scaleName:dt,scale:kt,stack:Be,offset:wt,defaultRef:void 0});return dn!==void 0?{[lt]:dn}:A_(Y,ve)||A_(Y,{[Y]:p_(Y,ve,We.style),[ct]:p_(ct,ve,We.style)})||A_(Y,We[fe])||A_(Y,We.mark)||{[lt]:sO({model:N,defaultPos:L,channel:Y,scaleName:dt,scale:kt})()}}(t,r,f),O=w[v]?x5(e,i,s):$1(e);return Object.assign(Object.assign({},Ip(e,t,{defaultPos:n,vgChannel:O})),w)}function A_(e,t){const n=Lv(e),r=$1(e);return t[r]!==void 0?{[r]:f2(e,t[r])}:t[e]!==void 0?{[r]:f2(e,t[e])}:t[n]?{[n]:f2(e,t[n])}:void 0}function ny(e,t,n){var r,i,s,f;const{config:v,encoding:w,markDef:O,stack:N}=e,L=Pv(t),Y=Lv(t),ie=w[t],fe=w[L],ve=e.getScaleComponent(t),Be=ve?ve.get("type"):void 0,We=e.scaleName(t),Ve=O.orient,ct=(i=(r=w[Y])!==null&&r!==void 0?r:w.size)!==null&&i!==void 0?i:Ou("size",O,v,{vgChannel:Y}),lt=n==="bar"&&(t==="x"?Ve==="vertical":Ve==="horizontal");if(Vi(ie)&&(Nc(ie.bin)||Nm(ie.bin)||ie.timeUnit&&!fe)&&!ct&&!Cg(Be)){const mt=d2({channel:t,fieldDef:ie,stack:N,markDef:O,config:v}),dt=(s=e.component.axes[t])===null||s===void 0?void 0:s[0];return function({fieldDef:kt,fieldDef2:wt,channel:dn,band:Dn,scaleName:wn,markDef:Xn,spacing:Kn=0,axisTranslate:ir,reverse:sr,config:gr}){const Vr=Pv(dn),hi=$1(dn),Qr=$1(Vr),Ni=E_(dn,Xn);if(Nc(kt.bin)||kt.timeUnit)return{[Qr]:k5({channel:dn,fieldDef:kt,scaleName:wn,markDef:Xn,band:(1-Dn)/2,offset:b2(Vr,Kn,sr,ir,Ni),config:gr}),[hi]:k5({channel:dn,fieldDef:kt,scaleName:wn,markDef:Xn,band:1-(1-Dn)/2,offset:b2(dn,Kn,sr,ir,Ni),config:gr})};if(Nm(kt.bin)){const ro=Py(kt,wn,{},{offset:b2(Vr,Kn,sr,ir,Ni)});if(Vi(wt))return{[Qr]:ro,[hi]:Py(wt,wn,{},{offset:b2(dn,Kn,sr,ir,Ni)})};if(c2(kt.bin)&&kt.bin.step)return{[Qr]:ro,[hi]:{signal:`scale("${wn}", ${Fi(kt,{expr:"datum"})} + ${kt.bin.step})`,offset:b2(dn,Kn,sr,ir,Ni)}}}return void _i(me.channelRequiredForBinned(Vr))}({fieldDef:ie,fieldDef2:fe,channel:t,markDef:O,scaleName:We,band:mt,axisTranslate:(f=dt==null?void 0:dt.get("translate"))!==null&&f!==void 0?f:.5,spacing:zv(t)?Ou("binSpacing",O,v):void 0,reverse:ve.get("reverse"),config:v})}return(Na(ie)&&Cg(Be)||lt)&&!fe?function(mt,dt,kt,wt){var dn;const{markDef:Dn,encoding:wn,config:Xn,stack:Kn}=wt,ir=Dn.orient,sr=wt.scaleName(kt),gr=wt.getScaleComponent(kt),Vr=Lv(kt),hi=Pv(kt),Qr=ir==="horizontal"&&kt==="y"||ir==="vertical"&&kt==="x",Ni=Ou(Qr?"size":Vr,Dn,Xn,{vgChannel:Vr});let ro;(wn.size||Ni!==void 0)&&(Qr?ro=gd("size",wt,{vgChannel:Vr,defaultValue:Ni}):_i(me.cannotApplySizeToNonOrientedMark(Dn.type)));const oo=(dn=Na(dt)?d2({channel:kt,fieldDef:dt,markDef:Dn,stack:Kn,config:Xn}):void 0)!==null&&dn!==void 0?dn:1;ro=ro||{[Vr]:function(_a,ys,Lo,Vs,qs,Su){if(Vs){const xc=Vs.get("type");if(xc==="point"||xc==="band"){if(qs[_a].discreteBandSize!==void 0)return{value:qs[_a].discreteBandSize};if(xc===Kf.POINT){const Kd=Vs.get("range");return Y1(Kd)&&Gf(Kd.step)?{value:Kd.step-2}:{value:tO-2}}return{scale:Lo,band:Su}}return{value:qs[_a].continuousBandSize}}const Ic=y_(qs.view,ys),Fc=$f(qs[_a].discreteBandSize,Ic-2);return Fc!==void 0?{value:Fc}:void 0}(mt,Vr,sr,gr,Xn,oo)};const Po=(gr==null?void 0:gr.get("type"))!=="band"||!("band"in ro[Vr]),ho=x5(kt,Dn,Xn,Po?"middle":"top"),ao=E_(kt,Dn),xo=SA({channel:kt,channelDef:dt,markDef:Dn,config:Xn,scaleName:sr,scale:gr,stack:Kn,offset:ao,defaultRef:sO({model:wt,defaultPos:"mid",channel:kt,scaleName:sr,scale:gr}),band:Po?.5:(1-oo)/2});if(Vr)return Object.assign({[ho]:xo},ro);{const _a=$1(hi),ys=ro[Vr],Lo=ao?Object.assign(Object.assign({},ys),{offset:ao}):ys;return{[ho]:xo,[_a]:$o(xo)?[xo[0],Object.assign(Object.assign({},xo[1]),{offset:Lo})]:Object.assign(Object.assign({},xo),{offset:Lo})}}}(n,ie,t,e):w5(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function b2(e,t,n,r,i){if(CI(e))return 0;const s=e==="x"||e==="y2"?-t/2:t/2;if(xa(n)){const f=m2(i);return{signal:`${n.signal} ? ${r-s}${f?"-"+f:""} : ${r+s}${f?"+"+f:""}`}}if(xa(i)){const f=r+(n?-s:s);return{signal:`${f||""}${n?" - ":f?" + ":""}${i.signal}`}}return i=i||0,r+(n?-i-s:+i+s)}function k5({channel:e,fieldDef:t,scaleName:n,markDef:r,band:i,offset:s,config:f}){return tF({fieldDef:t,channel:e,markDef:r,ref:o_({scaleName:n,fieldOrDatumDef:t,band:i,offset:s}),config:f})}const XU=new Set(["aria"]);function q0(e,t){const{fill:n,stroke:r}=t.color==="include"?b5(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(i,s){return Lz.reduce((f,v)=>(XU.has(v)||i[v]===void 0||s[v]==="ignore"||(f[v]=Ef(i[v])),f),{})}(e.markDef,t)),_5(e,"fill",n)),_5(e,"stroke",r)),gd("opacity",e)),gd("fillOpacity",e)),gd("strokeOpacity",e)),gd("strokeWidth",e)),gd("strokeDash",e)),g5(e)),aO(e,"href")),GU(e))}function _5(e,t,n){const{config:r,mark:i,markDef:s}=e;if(Ou("invalid",s,r)==="hide"&&n&&!Iy(i)){const f=function(v,{invalid:w=!1,channels:O}){const N=O.reduce((Y,ie)=>{const fe=v.getScaleComponent(ie);if(fe){const ve=fe.get("type"),Be=v.vgField(ie,{expr:"datum"});Be&&V0(ve)&&(Y[Be]=!0)}return Y},{}),L=Si(N);if(L.length>0){const Y=w?"||":"&&";return L.map(ie=>DA(ie,w)).join(` ${Y} `)}}(e,{invalid:!0,channels:e_});if(f)return{[t]:[{test:f,value:null},..._f(n)]}}return n?{[t]:n}:{}}function uO(e){const{config:t,markDef:n}=e;if(Ou("invalid",n,t)){const r=function(i,{invalid:s=!1,channels:f}){const v=f.reduce((O,N)=>{const L=i.getScaleComponent(N);if(L){const Y=L.get("type"),ie=i.vgField(N,{expr:"datum"});ie&&V0(Y)&&(O[ie]=!0)}return O},{}),w=Si(v);if(w.length>0){const O=s?"||":"&&";return w.map(N=>DA(N,s)).join(` ${O} `)}}(e,{channels:W0});if(r)return{defined:{signal:r}}}return{}}function E5(e,t){if(t!==void 0)return{[e]:Ef(t)}}var C5={has:e=>e.type!=="interval"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName("voronoi")},marks:(e,t,n)=>{const{x:r,y:i}=t.project.hasChannel,s=e.mark;if(Iy(s))return _i(me.nearestNotSupportForContinuous(s)),n;const f={name:e.getName("voronoi"),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},g5(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:r||!i?"datum.datum.x || 0":"0"},y:{expr:i||!r?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let v=0,w=!1;return n.forEach((O,N)=>{var L;const Y=(L=O.name)!==null&&L!==void 0?L:"";Y===e.component.mark[0].name?v=N:Y.indexOf("voronoi")>=0&&(w=!0)}),w||n.splice(v+1,0,f),n}};class oc{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){this._children.indexOf(t)>-1?console.warn("Attempt to add the same child twice."):n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const r of this._children)r.parent=t;this._children=[],t.removeChild(this),t.parent.removeChild(t),this.parent=n,t.parent=this}}class Fm extends oc{constructor(t,n,r,i){super(t,n),this.type=r,this.refCounts=i,this._source=this._name=n,!this.refCounts||this._name in this.refCounts||(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName="clone_"+this.debugName,t._source=this._source,t._name="clone_"+this._name,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${qP()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}class Gv extends oc{constructor(t,n){super(t),this.formula=n}clone(){return new Gv(null,ls(this.formula))}static makeFromEncoding(t,n){const r=n.reduceFieldDef((i,s,f)=>{const{field:v,timeUnit:w}=s,O=Jl(n)?n.encoding[Pv(f)]:void 0,N=Jl(n)&&FA(f,s,O,n.stack,n.markDef,n.config);if(w){const L=Fi(s,{forAs:!0});i[Zs({as:L,field:v,timeUnit:w})]=Object.assign({as:L,field:v,timeUnit:w},N?{band:!0}:{})}return i},{});return bc(r)?null:new Gv(t,r)}static makeFromTransform(t,n){const r=Object.assign({},n),{timeUnit:i}=r,s=Bo(r,["timeUnit"]),f=Im(i),v=Object.assign(Object.assign({},s),{timeUnit:f});return new Gv(t,{[Zs(v)]:v})}merge(t){this.formula=Object.assign({},this.formula);for(const n in t.formula)this.formula[n]&&!t.formula[n].band||(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}producedFields(){return new Set(z1(this.formula).map(t=>t.as))}dependentFields(){return new Set(z1(this.formula).map(t=>t.field))}hash(){return`TimeUnit ${Zs(this.formula)}`}assemble(){const t=[];for(const n of z1(this.formula)){const{field:r,as:i,timeUnit:s}=n,f=Im(s),{unit:v,utc:w}=f,O=Bo(f,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:U1(r),type:"timeunit"},v?{units:bA(v)}:{}),w?{timezone:"utc"}:{}),O),{as:[i,`${i}_end`]}))}return t}}const x2="_tuple_fields";var A5={has:e=>e.type==="single"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!YA(e.bind),parse:(e,t,n,r)=>{r.on||delete t.events,r.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const r=t.name,i=t.project,s=t.bind,f=t.init&&t.init[0],v=C5.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.items.forEach((w,O)=>{var N,L;const Y=dl(`${r}_${w.field}`);n.filter(ie=>ie.name===Y).length||n.unshift(Object.assign(Object.assign({name:Y},f?{init:Tb(f[O])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${v}[${Ws(w.field)}] : null`}]:[],bind:(L=(N=s[w.field])!==null&&N!==void 0?N:s[w.channel])!==null&&L!==void 0?L:s}))}),n},signals:(e,t,n)=>{const r=t.name,i=t.project,s=n.filter(O=>O.name===r+$v)[0],f=r+x2,v=i.items.map(O=>dl(`${r}_${O.field}`)),w=v.map(O=>`${O} !== null`).join(" && ");return v.length&&(s.update=`${w} ? {fields: ${f}, values: [${v.join(", ")}]} : null`),delete s.value,delete s.on,n}},O5={has:e=>e.type==="multi"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+"_toggle",value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+$v,r=t.name+"_toggle";return`${r} ? null : ${n}, `+(t.resolve==="global"?`${r} ? null : true, `:`${r} ? null : {unit: ${b1(e)}}, `)+`${r} ? ${n} : null`}},ry={has:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const r of t.project.items){const i=r.channel;if(!X1(i))continue;const s=e.getScaleComponent(i),f=s?s.get("type"):void 0;if(!s||!V0(f)){_i(me.SCALE_BINDINGS_CONTINUOUS);continue}const v={selection:t.name,field:r.field};s.set("selectionExtent",v,!0),n.push(r)}},topLevelSignals:(e,t,n)=>{const r=t.scales.filter(f=>n.filter(v=>v.name===f.signals.data).length===0);if(!e.parent||lO(e)||r.length===0)return n;const i=n.filter(f=>f.name===t.name)[0];let s=i.update;if(s.indexOf(P5)>=0)i.update=`{${r.map(f=>`${Ws(f.field)}: ${f.signals.data}`).join(", ")}}`;else{for(const f of r){const v=`${Ws(f.field)}: ${f.signals.data}`;s.indexOf(v)<0&&(s=`${s.substring(0,s.length-1)}, ${v}}`)}i.update=s}return n.concat(r.map(f=>({name:f.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!lO(e))for(const r of t.scales){const i=n.filter(s=>s.name===r.signals.data)[0];i.push="outer",delete i.value,delete i.update}return n}};function cO(e,t){return`domain(${Ws(e.scaleName(t))})`}function lO(e){var t;return e.parent&&Lb(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:lO(e.parent.parent))}const S5={has:e=>{const t=e.resolve==="global"&&e.bind&&YA(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==Db;return t&&!n&&_i(me.LEGEND_BINDINGS_PROJECT_LENGTH),t&&n},parse:(e,t,n,r)=>{var i;if(r.on||delete t.events,r.clear||delete t.clear,r.on||r.clear){const v='event.item && indexof(event.item.mark.role, "legend") < 0';for(const w of t.events)w.filter=_f((i=w.filter)!==null&&i!==void 0?i:[]),w.filter.indexOf(v)<0&&w.filter.push(v)}const s=JA(t.bind)?t.bind.legend:"click",f=cs(s)?Sy(s,"view"):_f(s);t.bind={legend:{merge:f}}},topLevelSignals:(e,t,n)=>{const r=t.name,i=JA(t.bind)&&t.bind.legend,s=f=>v=>{const w=ls(v);return w.markname=f,w};for(const f of t.project.items){if(!f.hasLegend)continue;const v=`${dl(f.field)}_legend`,w=`${r}_${v}`;if(n.filter(O=>O.name===w).length===0){const O=i.merge.map(s(`${v}_symbols`)).concat(i.merge.map(s(`${v}_labels`))).concat(i.merge.map(s(`${v}_entries`)));n.unshift(Object.assign(Object.assign({name:w},t.init?{}:{value:null}),{on:[{events:O,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:i.merge,update:`!event.item || !datum ? null : ${w}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const r=t.name,i=t.project,s=n.find(L=>L.name===r+$v),f=r+x2,v=i.items.filter(L=>L.hasLegend).map(L=>dl(`${r}_${dl(L.field)}_legend`)),w=`${v.map(L=>`${L} !== null`).join(" && ")} ? {fields: ${f}, values: [${v.join(", ")}]} : null`;t.events&&v.length>0?s.on.push({events:v.map(L=>({signal:L})),update:w}):v.length>0&&(s.update=w,delete s.value,delete s.on);const O=n.find(L=>L.name===r+"_toggle"),N=JA(t.bind)&&t.bind.legend;return O&&(t.events?O.on.push(Object.assign(Object.assign({},O.on[0]),{events:N})):O.on[0].events=N),n}},D5="_translate_anchor",T5="_translate_delta";function N5(e,t,n,r,i){var s;const f=t.name,v=f+D5,w=f+T5,O=n.channel,N=ry.has(t),L=i.filter(We=>We.name===n.signals[N?"data":"visual"])[0],Y=e.getSizeSignalRef(r).signal,ie=e.getScaleComponent(O),fe=ie.get("type"),ve=`${v}.extent_${O}`,Be=`${N?fe==="log"?"panLog":fe==="pow"?"panPow":"panLinear":"panLinear"}(${ve}, ${`${N&&O===Ol?"-":""}${w}.${O} / `+(N?`${Y}`:`span(${ve})`)}`+(N&&fe==="pow"?`, ${(s=ie.get("exponent"))!==null&&s!==void 0?s:1}`:"")+")";L.on.push({events:{signal:w},update:N?Be:`clampRange(${Be}, 0, ${Y})`})}const I5="_zoom_anchor",F5="_zoom_delta";function R5(e,t,n,r,i){var s;const f=t.name,v=n.channel,w=ry.has(t),O=i.filter(Be=>Be.name===n.signals[w?"data":"visual"])[0],N=e.getSizeSignalRef(r).signal,L=e.getScaleComponent(v),Y=L.get("type"),ie=w?cO(e,v):O.name,fe=f+F5,ve=`${w?Y==="log"?"zoomLog":Y==="pow"?"zoomPow":"zoomLinear":"zoomLinear"}(${ie}, ${`${f}${I5}.${v}`}, ${fe}`+(w&&Y==="pow"?`, ${(s=L.get("exponent"))!==null&&s!==void 0?s:1}`:"")+")";O.on.push({events:{signal:fe},update:w?ve:`clampRange(${ve}, 0, ${N})`})}const YU=[{has:()=>!0,parse:(e,t,n)=>{var r,i,s;const f=t.name,v=(r=t.project)!==null&&r!==void 0?r:t.project=new class{constructor(...Y){this.items=Y,this.hasChannel={},this.hasField={}}},w={},O={},N=new Set,L=(Y,ie)=>{const fe=ie==="visual"?Y.channel:Y.field;let ve=dl(`${f}_${fe}`);for(let Be=1;N.has(ve);Be++)ve=dl(`${f}_${fe}_${Be}`);return N.add(ve),{[ie]:ve}};if(!n.fields&&!n.encodings){const Y=e.config.selection[n.type];if(n.init)for(const ie of _f(n.init))for(const fe of Si(ie))uL(fe)?(n.encodings||(n.encodings=[])).push(fe):n.type==="interval"?(_i('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=Y.encodings):(n.fields||(n.fields=[])).push(fe);else n.encodings=Y.encodings,n.fields=Y.fields}for(const Y of(i=n.fields)!==null&&i!==void 0?i:[]){const ie={type:"E",field:Y};ie.signals=Object.assign({},L(ie,"data")),v.items.push(ie),v.hasField[Y]=ie}for(const Y of(s=n.encodings)!==null&&s!==void 0?s:[]){const ie=e.fieldDef(Y);if(ie){let fe=ie.field;if(ie.aggregate){_i(me.cannotProjectAggregate(Y,ie.aggregate));continue}if(!fe){_i(me.cannotProjectOnChannelWithoutField(Y));continue}if(ie.timeUnit){fe=e.vgField(Y);const ve={timeUnit:ie.timeUnit,as:fe,field:ie.field};O[Zs(ve)]=ve}if(!w[fe]){let ve="E";t.type==="interval"?V0(e.getScaleComponent(Y).get("type"))&&(ve="R"):ie.bin&&(ve="R-RE");const Be={field:fe,channel:Y,type:ve};Be.signals=Object.assign(Object.assign({},L(Be,"data")),L(Be,"visual")),v.items.push(w[fe]=Be),v.hasField[fe]=v.hasChannel[Y]=w[fe]}}else _i(me.cannotProjectOnChannelWithoutField(Y))}if(n.init){const Y=ie=>v.items.map(fe=>ie[fe.channel]!==void 0?ie[fe.channel]:ie[fe.field]);if(n.type==="interval")t.init=Y(n.init);else{const ie=_f(n.init);t.init=ie.map(Y)}}bc(O)||(v.timeUnit=new Gv(null,O))},signals:(e,t,n)=>{const r=t.name+x2;return n.filter(i=>i.name===r).length>0?n:n.concat({name:r,value:t.project.items.map(i=>{const s=Bo(i,["signals","hasLegend"]);return s.field=U1(s.field),s})})}},O5,ry,S5,{has:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const r=t.name,i=ry.has(t),s=r+D5,{x:f,y:v}=t.project.hasChannel;let w=Sy(t.translate,"scope");return i||(w=w.map(O=>(O.between[0].markname=r+w2,O))),n.push({name:s,value:{},on:[{events:w.map(O=>O.between[0]),update:"{x: x(unit), y: y(unit)"+(f!==void 0?", extent_x: "+(i?cO(e,Ol):`slice(${f.signals.visual})`):"")+(v!==void 0?", extent_y: "+(i?cO(e,Dh):`slice(${v.signals.visual})`):"")+"}"}]},{name:r+T5,value:{},on:[{events:w,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),f!==void 0&&N5(e,t,f,"width",n),v!==void 0&&N5(e,t,v,"height",n),n}},{has:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const r=t.name,i=ry.has(t),s=r+F5,{x:f,y:v}=t.project.hasChannel,w=Ws(e.scaleName(Ol)),O=Ws(e.scaleName(Dh));let N=Sy(t.zoom,"scope");return i||(N=N.map(L=>(L.markname=r+w2,L))),n.push({name:r+I5,on:[{events:N,update:i?"{"+[w?`x: invert(${w}, x(unit))`:"",O?`y: invert(${O}, y(unit))`:""].filter(L=>!!L).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:N,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),f!==void 0&&R5(e,t,f,"width",n),v!==void 0&&R5(e,t,v,"height",n),n}},A5,C5,{has:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t,n)=>{n.clear&&(t.clear=cs(n.clear)?Sy(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(A5.has(t))for(const r of t.project.items){const i=n.findIndex(s=>s.name===dl(`${t.name}_${r.field}`));i!==-1&&n[i].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function r(i,s){i!==-1&&n[i].on&&n[i].on.push({events:t.clear,update:s})}if(t.type==="interval")for(const i of t.project.items){const s=n.findIndex(f=>f.name===i.signals.visual);r(s,"[0, 0]"),s===-1&&r(n.findIndex(f=>f.name===i.signals.data),"null")}else{let i=n.findIndex(s=>s.name===t.name+$v);r(i,"null"),O5.has(t)&&r(i=n.findIndex(s=>s.name===t.name+"_toggle"),"false")}return n}}];function O_(e,t){for(const n of YU)n.has(e)&&t(n)}function Tb(e,t=!0,n=IP){if($o(e)){const r=e.map(i=>Tb(i,t,n));return t?`[${r.join(", ")}]`:r}return Cb(e)?n(t?l2(e):function(r){const i=gA(r,!0);return r.utc?+new Date(Date.UTC(...i)):+new Date(...i)}(e)):t?n(JSON.stringify(e)):e}function M5(e,t){return $y(e,(n,r)=>{t=r.marks?r.marks(e,n,t):t,O_(n,i=>{i.marks&&(t=i.marks(e,n,t))})}),t}function fO(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}const w2="_brush",hO="_scale_trigger",JU={signals:(e,t)=>{const n=t.name,r=n+x2,i=ry.has(t),s=[],f=[],v=[];if(t.translate&&!i){const N=`!event.item || event.item.mark.name !== ${Ws(n+w2)}`;j5(t,(L,Y)=>{var ie;const fe=_f((ie=Y.between[0].filter)!==null&&ie!==void 0?ie:Y.between[0].filter=[]);return fe.indexOf(N)<0&&fe.push(N),L})}t.project.items.forEach((N,L)=>{const Y=N.channel;if(Y!==Ol&&Y!==Dh)return void _i("Interval selections only support x and y encoding channels.");const ie=t.init?t.init[L]:null,fe=function(ct,lt,mt,dt){const kt=mt.channel,wt=mt.signals.visual,dn=mt.signals.data,Dn=ry.has(lt),wn=Ws(ct.scaleName(kt)),Xn=ct.getScaleComponent(kt),Kn=Xn?Xn.get("type"):void 0,ir=hi=>`scale(${wn}, ${hi})`,sr=ct.getSizeSignalRef(kt===Ol?"width":"height").signal,gr=`${kt}(unit)`,Vr=j5(lt,(hi,Qr)=>[...hi,{events:Qr.between[0],update:`[${gr}, ${gr}]`},{events:Qr,update:`[${wt}[0], clamp(${gr}, 0, ${sr})]`}]);return Vr.push({events:{signal:lt.name+hO},update:V0(Kn)?`[${ir(`${dn}[0]`)}, ${ir(`${dn}[1]`)}]`:"[0, 0]"}),Dn?[{name:dn,on:[]}]:[Object.assign(Object.assign({name:wt},dt?{init:Tb(dt,!0,ir)}:{value:[]}),{on:Vr}),Object.assign(Object.assign({name:dn},dt?{init:Tb(dt)}:{}),{on:[{events:{signal:wt},update:`${wt}[0] === ${wt}[1] ? null : invert(${wn}, ${wt})`}]})]}(e,t,N,ie),ve=N.signals.data,Be=N.signals.visual,We=Ws(e.scaleName(Y)),Ve=V0(e.getScaleComponent(Y).get("type"))?"+":"";s.push(...fe),f.push(ve),v.push({scaleName:e.scaleName(Y),expr:`(!isArray(${ve}) || (${Ve}invert(${We}, ${Be})[0] === ${Ve}${ve}[0] && ${Ve}invert(${We}, ${Be})[1] === ${Ve}${ve}[1]))`})}),i||s.push({name:n+hO,value:{},on:[{events:v.map(N=>({scale:N.scaleName})),update:v.map(N=>N.expr).join(" && ")+` ? ${n+hO} : {}`}]});const w=t.init,O=`unit: ${b1(e)}, fields: ${r}, values`;return s.concat(Object.assign(Object.assign({name:n+$v},w?{init:`{${O}: ${Tb(w)}}`}:{}),{on:[{events:[{signal:f.join(" || ")}],update:f.join(" && ")+` ? {${O}: [${f}]} : null`}]}))},modifyExpr:(e,t)=>t.name+$v+", "+(t.resolve==="global"?"true":`{unit: ${b1(e)}}`),marks:(e,t,n)=>{const r=t.name,{x:i,y:s}=t.project.hasChannel,f=i&&i.signals.visual,v=s&&s.signals.visual,w=`data(${Ws(t.name+Gy)})`;if(ry.has(t))return n;const O={x:i!==void 0?{signal:`${f}[0]`}:{value:0},y:s!==void 0?{signal:`${v}[0]`}:{value:0},x2:i!==void 0?{signal:`${f}[1]`}:{field:{group:"width"}},y2:s!==void 0?{signal:`${v}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const Be of Si(O))O[Be]=[Object.assign({test:`${w}.length && ${w}[0].unit === ${b1(e)}`},O[Be]),{value:0}];const N=t.mark,{fill:L,fillOpacity:Y,cursor:ie}=N,fe=Bo(N,["fill","fillOpacity","cursor"]),ve=Si(fe).reduce((Be,We)=>(Be[We]=[{test:[i!==void 0&&`${f}[0] !== ${f}[1]`,s!==void 0&&`${v}[0] !== ${v}[1]`].filter(Ve=>Ve).join(" && "),value:fe[We]},{value:null}],Be),{});return[{name:r+w2+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:L},fillOpacity:{value:Y}},update:O}},...n,{name:r+w2,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},ie?{cursor:{value:ie}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},O),ve)}}]}};function j5(e,t){return e.events.reduce((n,r)=>r.between?t(n,r):(_i(`${r} is not an ordered event stream for interval selections.`),n),[])}function B5(e,t){const n=t.name,r=n+x2,i="(item().isVoronoi ? datum.datum : datum)",s=t.project.items.map(w=>{const O=e.fieldDef(w.channel);return O&&O.bin?`[${i}[${Ws(e.vgField(w.channel,{}))}], ${i}[${Ws(e.vgField(w.channel,{binSuffix:"end"}))}]]`:`${i}[${Ws(w.field)}]`}).join(", "),f=`unit: ${b1(e)}, fields: ${r}, values`,v=t.events;return[{name:n+$v,on:v?[{events:v,update:`datum && item().mark.marktype !== 'group' ? {${f}: [${s}]} : null`,force:!0}]:[]}]}const QU={signals:B5,modifyExpr:(e,t)=>t.name+$v+", "+(t.resolve==="global"?"null":`{unit: ${b1(e)}}`)},ZU={signals:B5,modifyExpr:(e,t)=>t.name+$v+", "+(t.resolve==="global"?"true":`{unit: ${b1(e)}}`)},Gy="_store",$v="_tuple",eW="_modify",P5="vlSelectionResolve",tW={single:ZU,multi:QU,interval:JU};function $y(e,t){const n=e.component.selection;if(n){for(const r of z1(n))if(t(r,tW[r.type])===!0)break}}function b1(e,{escape:t}={escape:!0}){let n=t?Ws(e.name):e.name;const r=function(i){let s=i.parent;for(;s&&!vv(s);)s=s.parent;return s}(e);if(r){const{facet:i}=r;for(const s of U0)i[s]&&(n+=` + '__facet_${s}_' + (facet[${Ws(r.vgField(s))}])`)}return n}function dO(e){let t=!1;return $y(e,n=>{t=t||n.project.items.some(r=>r.field===Db)}),t}const nW="RawCode",rW="Literal",iW="Property",oW="Identifier",aW="ArrayExpression",sW="BinaryExpression",uW="CallExpression",cW="ConditionalExpression",lW="LogicalExpression",fW="MemberExpression",hW="ObjectExpression",dW="UnaryExpression";function pv(e){this.type=e}var x1,bo,ni,Fp,$u;pv.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(n=0,r=(t=function(i){switch(i.type){case aW:return i.elements;case sW:case lW:return[i.left,i.right];case uW:return[i.callee].concat(i.arguments);case cW:return[i.test,i.consequent,i.alternate];case fW:return[i.object,i.property];case hW:return i.properties;case iW:return[i.key,i.value];case dW:return[i.argument];case oW:case rW:case nW:default:return[]}}(this)).length;n<r;++n)if(t[n].visit(e))return 1};var S_=1,k2=2,Ky=3,iy=4,D_=5,Xy=6,Ag=7,_2=8;(x1={})[S_]="Boolean",x1[k2]="<end>",x1[Ky]="Identifier",x1[iy]="Keyword",x1[D_]="Null",x1[Xy]="Numeric",x1[Ag]="Punctuator",x1[_2]="String",x1[9]="RegularExpression";var pW="ArrayExpression",mW="BinaryExpression",gW="CallExpression",vW="ConditionalExpression",L5="Identifier",yW="Literal",bW="LogicalExpression",xW="MemberExpression",wW="ObjectExpression",kW="Property",_W="UnaryExpression",$d="Unexpected token %0",EW="Unexpected number",CW="Unexpected string",AW="Unexpected identifier",OW="Unexpected reserved word",SW="Unexpected end of input",pO="Invalid regular expression",mO="Invalid regular expression: missing /",z5="Octal literals are not allowed in strict mode.",DW="Duplicate data property in object literal not allowed in strict mode",Rp="ILLEGAL",E2="Disabled.",TW=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),NW=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function T_(e,t){if(!e)throw new Error("ASSERT: "+t)}function w1(e){return e>=48&&e<=57}function gO(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function C2(e){return"01234567".indexOf(e)>=0}function IW(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function A2(e){return e===10||e===13||e===8232||e===8233}function O2(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&TW.test(String.fromCharCode(e))}function N_(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&NW.test(String.fromCharCode(e))}var FW={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function U5(){for(var e;ni<Fp&&(IW(e=bo.charCodeAt(ni))||A2(e));)++ni}function vO(e){var t,n,r,i=0;for(n=e==="u"?4:2,t=0;t<n;++t)ni<Fp&&gO(bo[ni])?(r=bo[ni++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):yu({},$d,Rp);return String.fromCharCode(i)}function RW(){var e,t,n,r;for(t=0,(e=bo[ni])==="}"&&yu({},$d,Rp);ni<Fp&&gO(e=bo[ni++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&yu({},$d,Rp),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function W5(){var e,t;for(e=bo.charCodeAt(ni++),t=String.fromCharCode(e),e===92&&(bo.charCodeAt(ni)!==117&&yu({},$d,Rp),++ni,(e=vO("u"))&&e!=="\\"&&O2(e.charCodeAt(0))||yu({},$d,Rp),t=e);ni<Fp&&N_(e=bo.charCodeAt(ni));)++ni,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),bo.charCodeAt(ni)!==117&&yu({},$d,Rp),++ni,(e=vO("u"))&&e!=="\\"&&N_(e.charCodeAt(0))||yu({},$d,Rp),t+=e);return t}function MW(){var e,t;return e=ni,{type:(t=bo.charCodeAt(ni)===92?W5():function(){var n,r;for(n=ni++;ni<Fp;){if((r=bo.charCodeAt(ni))===92)return ni=n,W5();if(!N_(r))break;++ni}return bo.slice(n,ni)}()).length===1?Ky:FW.hasOwnProperty(t)?iy:t==="null"?D_:t==="true"||t==="false"?S_:Ky,value:t,start:e,end:ni}}function yO(){var e,t,n,r,i=ni,s=bo.charCodeAt(ni),f=bo[ni];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++ni,{type:Ag,value:String.fromCharCode(s),start:i,end:ni};default:if((e=bo.charCodeAt(ni+1))===61)switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return ni+=2,{type:Ag,value:String.fromCharCode(s)+String.fromCharCode(e),start:i,end:ni};case 33:case 61:return ni+=2,bo.charCodeAt(ni)===61&&++ni,{type:Ag,value:bo.slice(i,ni),start:i,end:ni}}}return(r=bo.substr(ni,4))===">>>="?{type:Ag,value:r,start:i,end:ni+=4}:(n=r.substr(0,3))===">>>"||n==="<<="||n===">>="?{type:Ag,value:n,start:i,end:ni+=3}:f===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(f)>=0||t==="=>"?{type:Ag,value:t,start:i,end:ni+=2}:"<>=!+-*%&|^/".indexOf(f)>=0?{type:Ag,value:f,start:i,end:++ni}:void yu({},$d,Rp)}function V5(){var e,t,n;if(T_(w1((n=bo[ni]).charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=ni,e="",n!=="."){if(e=bo[ni++],n=bo[ni],e==="0"){if(n==="x"||n==="X")return++ni,function(r){for(var i="";ni<Fp&&gO(bo[ni]);)i+=bo[ni++];return i.length===0&&yu({},$d,Rp),O2(bo.charCodeAt(ni))&&yu({},$d,Rp),{type:Xy,value:parseInt("0x"+i,16),start:r,end:ni}}(t);if(C2(n))return function(r){for(var i="0"+bo[ni++];ni<Fp&&C2(bo[ni]);)i+=bo[ni++];return(O2(bo.charCodeAt(ni))||w1(bo.charCodeAt(ni)))&&yu({},$d,Rp),{type:Xy,value:parseInt(i,8),octal:!0,start:r,end:ni}}(t);n&&w1(n.charCodeAt(0))&&yu({},$d,Rp)}for(;w1(bo.charCodeAt(ni));)e+=bo[ni++];n=bo[ni]}if(n==="."){for(e+=bo[ni++];w1(bo.charCodeAt(ni));)e+=bo[ni++];n=bo[ni]}if(n==="e"||n==="E")if(e+=bo[ni++],(n=bo[ni])!=="+"&&n!=="-"||(e+=bo[ni++]),w1(bo.charCodeAt(ni)))for(;w1(bo.charCodeAt(ni));)e+=bo[ni++];else yu({},$d,Rp);return O2(bo.charCodeAt(ni))&&yu({},$d,Rp),{type:Xy,value:parseFloat(e),start:t,end:ni}}function jW(){var e,t,n,r;return $u=null,U5(),e=ni,t=function(){var i,s,f,v;for(T_((i=bo[ni])==="/","Regular expression literal must start with a slash"),s=bo[ni++],f=!1,v=!1;ni<Fp;)if(s+=i=bo[ni++],i==="\\")A2((i=bo[ni++]).charCodeAt(0))&&yu({},mO),s+=i;else if(A2(i.charCodeAt(0)))yu({},mO);else if(f)i==="]"&&(f=!1);else{if(i==="/"){v=!0;break}i==="["&&(f=!0)}return v||yu({},mO),{value:s.substr(1,s.length-2),literal:s}}(),n=function(){var i,s,f;for(s="",f="";ni<Fp&&N_((i=bo[ni]).charCodeAt(0));)++ni,i==="\\"&&ni<Fp?yu({},$d,Rp):(f+=i,s+=i);return f.search(/[^gimuy]/g)>=0&&yu({},pO,f),{value:f,literal:s}}(),r=function(i,s){var f=i;s.indexOf("u")>=0&&(f=f.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(v,w){if(parseInt(w,16)<=1114111)return"x";yu({},pO)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(f)}catch{yu({},pO)}try{return new RegExp(i,s)}catch{return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:ni}}function q5(){var e;return U5(),ni>=Fp?{type:k2,start:ni,end:ni}:O2(e=bo.charCodeAt(ni))?MW():e===40||e===41||e===59?yO():e===39||e===34?function(){var t,n,r,i,s="",f=!1;for(T_((t=bo[ni])==="'"||t==='"',"String literal must starts with a quote"),n=ni,++ni;ni<Fp;){if((r=bo[ni++])===t){t="";break}if(r==="\\")if((r=bo[ni++])&&A2(r.charCodeAt(0)))r==="\r"&&bo[ni]===`
`&&++ni;else switch(r){case"u":case"x":bo[ni]==="{"?(++ni,s+=RW()):s+=vO(r);break;case"n":s+=`
`;break;case"r":s+="\r";break;case"t":s+="	";break;case"b":s+="\b";break;case"f":s+="\f";break;case"v":s+="\v";break;default:C2(r)?((i="01234567".indexOf(r))!==0&&(f=!0),ni<Fp&&C2(bo[ni])&&(f=!0,i=8*i+"01234567".indexOf(bo[ni++]),"0123".indexOf(r)>=0&&ni<Fp&&C2(bo[ni])&&(i=8*i+"01234567".indexOf(bo[ni++]))),s+=String.fromCharCode(i)):s+=r}else{if(A2(r.charCodeAt(0)))break;s+=r}}return t!==""&&yu({},$d,Rp),{type:_2,value:s,octal:f,start:n,end:ni}}():e===46?w1(bo.charCodeAt(ni+1))?V5():yO():w1(e)?V5():yO()}function Og(){var e;return ni=(e=$u).end,$u=q5(),ni=e.end,e}function H5(){var e;e=ni,$u=q5(),ni=e}function G5(e,t,n){var r=new pv(e==="||"||e==="&&"?bW:mW);return r.operator=e,r.left=t,r.right=n,r}function BW(e,t){var n=new pv(gW);return n.callee=e,n.arguments=t,n}function bO(e){var t=new pv(L5);return t.name=e,t}function S2(e){var t=new pv(yW);return t.value=e.value,t.raw=bo.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function $5(e,t,n){var r=new pv(xW);return r.computed=e==="[",r.object=t,r.property=n,r.computed||(n.member=!0),r}function K5(e,t,n){var r=new pv(kW);return r.key=t,r.value=n,r.kind=e,r}function yu(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,function(s,f){return T_(f<r.length,"Message reference must be in range"),r[f]});throw(n=new Error(i)).index=ni,n.description=i,n}function I_(e){e.type===k2&&yu(e,SW),e.type===Xy&&yu(e,EW),e.type===_2&&yu(e,CW),e.type===Ky&&yu(e,AW),e.type===iy&&yu(e,OW),yu(e,$d,e.value)}function Mp(e){var t=Og();t.type===Ag&&t.value===e||I_(t)}function Hc(e){return $u.type===Ag&&$u.value===e}function xO(e){return $u.type===iy&&$u.value===e}function PW(){var e=[];for(ni=$u.start,Mp("[");!Hc("]");)Hc(",")?(Og(),e.push(null)):(e.push(Yy()),Hc("]")||Mp(","));return Og(),function(t){var n=new pv(pW);return n.elements=t,n}(e)}function X5(){var e;return ni=$u.start,(e=Og()).type===_2||e.type===Xy?(e.octal&&yu(e,z5),S2(e)):bO(e.value)}function LW(){var e,t,n;return ni=$u.start,(e=$u).type===Ky?(n=X5(),Mp(":"),K5("init",n,Yy())):e.type!==k2&&e.type!==Ag?(t=X5(),Mp(":"),K5("init",t,Yy())):void I_(e)}function zW(){var e,t,n=[],r={},i=String;for(ni=$u.start,Mp("{");!Hc("}");)t="$"+((e=LW()).key.type===L5?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?yu({},DW):r[t]=!0,n.push(e),Hc("}")||Mp(",");return Mp("}"),function(s){var f=new pv(wW);return f.properties=s,f}(n)}var UW={if:1};function WW(){var e,t,n;if(Hc("("))return function(){var r;return Mp("("),r=wO(),Mp(")"),r}();if(Hc("["))return PW();if(Hc("{"))return zW();if(e=$u.type,ni=$u.start,e===Ky||UW[$u.value])n=bO(Og().value);else if(e===_2||e===Xy)$u.octal&&yu($u,z5),n=S2(Og());else{if(e===iy)throw new Error(E2);e===S_?((t=Og()).value=t.value==="true",n=S2(t)):e===D_?((t=Og()).value=null,n=S2(t)):Hc("/")||Hc("/=")?(n=S2(jW()),H5()):I_(Og())}return n}function VW(){var e=[];if(Mp("("),!Hc(")"))for(;ni<Fp&&(e.push(Yy()),!Hc(")"));)Mp(",");return Mp(")"),e}function qW(){var e;return ni=$u.start,function(t){return t.type===Ky||t.type===iy||t.type===S_||t.type===D_}(e=Og())||I_(e),bO(e.value)}function HW(){var e;return Mp("["),e=wO(),Mp("]"),e}function Y5(){var e=function(){var t;for(t=WW();;)if(Hc("."))Mp("."),t=$5(".",t,qW());else if(Hc("("))t=BW(t,VW());else{if(!Hc("["))break;t=$5("[",t,HW())}return t}();if($u.type===Ag&&(Hc("++")||Hc("--")))throw new Error(E2);return e}function F_(){var e,t;if($u.type!==Ag&&$u.type!==iy)t=Y5();else{if(Hc("++")||Hc("--"))throw new Error(E2);if(Hc("+")||Hc("-")||Hc("~")||Hc("!"))e=Og(),t=F_(),t=function(n,r){var i=new pv(_W);return i.operator=n,i.argument=r,i.prefix=!0,i}(e.value,t);else{if(xO("delete")||xO("void")||xO("typeof"))throw new Error(E2);t=Y5()}}return t}function J5(e){var t=0;if(e.type!==Ag&&e.type!==iy)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function Yy(){var e,t;return e=function(){var n,r,i,s,f,v,w,O,N,L;if(n=$u,N=F_(),(f=J5(s=$u))===0)return N;for(s.prec=f,Og(),r=[n,$u],v=[N,s,w=F_()];(f=J5($u))>0;){for(;v.length>2&&f<=v[v.length-2].prec;)w=v.pop(),O=v.pop().value,N=v.pop(),r.pop(),i=G5(O,N,w),v.push(i);(s=Og()).prec=f,v.push(s),r.push($u),i=F_(),v.push(i)}for(i=v[L=v.length-1],r.pop();L>1;)r.pop(),i=G5(v[L-1].value,v[L-2],i),L-=2;return i}(),Hc("?")&&(Og(),t=Yy(),Mp(":"),e=function(n,r,i){var s=new pv(vW);return s.test=n,s.consequent=r,s.alternate=i,s}(e,t,Yy())),e}function wO(){var e=Yy();if(Hc(","))throw new Error(E2);return e}var GW=function(e){ni=0,Fp=(bo=e).length,$u=null,H5();var t=wO();if($u.type!==k2)throw new Error("Unexpect token after expression.");return t};function Nb(e,t,n){return e.fields=t||[],e.fname=n,e}function $W(e){return e.length===1?KW(e[0]):XW(e)}const KW=e=>function(t){return t[e]},XW=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function kO(e){throw Error(e)}function YW(e){const t=[],n=e.length;let r,i,s,f=null,v=0,w="";function O(){t.push(w+e.substring(r,i)),w="",r=i+1}for(e+="",r=i=0;i<n;++i)if((s=e[i])==="\\")w+=e.substring(r,i),w+=e.substring(++i,++i),r=i;else if(s===f)O(),f=null,v=-1;else{if(f)continue;r===v&&s==='"'||r===v&&s==="'"?(r=i+1,f=s):s!=="."||v?s==="["?(i>r&&O(),v=r=i+1):s==="]"&&(v||kO("Access path missing open bracket: "+e),v>0&&O(),v=0,r=i+1):i>r?O():r=i+1}return v&&kO("Access path missing closing bracket: "+e),f&&kO("Access path missing closing quote: "+e),i>r&&(i++,O()),t}function JW(e,t,n){const r=YW(e);return e=r.length===1?r[0]:e,Nb((n&&n.get||$W)(r),[e],t||e)}JW("id"),Nb(e=>e,[],"identity"),Nb(()=>0,[],"zero"),Nb(()=>1,[],"one"),Nb(()=>!0,[],"true"),Nb(()=>!1,[],"false");function Q5(e){const t=GW(e),n=new Set;return t.visit(r=>{r.type==="MemberExpression"&&function i(s){return s.object.type==="MemberExpression"?i(s.object):s.object.name==="datum"}(r)&&n.add(function i(s){const f=[];return s.type==="Identifier"?[s.name]:s.type==="Literal"?[s.value]:(s.type==="MemberExpression"&&(f.push(...i(s.object)),f.push(...i(s.property))),f)}(r).slice(1).join("."))}),n}class Ib extends oc{constructor(t,n,r){super(t),this.model=n,this.filter=r,this.expr=R_(this.model,this.filter,this),this._dependentFields=Q5(this.expr)}clone(){return new Ib(null,this.model,ls(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function Z5(e,t,n,r="datum"){const i=[],s=i2(t,function(f){const v=dl(f),w=e.getSelectionComponent(v,f),O=Ws(v+Gy);if(w.project.timeUnit){const N=n!=null?n:e.component.data.raw,L=w.project.timeUnit.clone();N.parent?L.insertAsParentOf(N):N.parent=L}return w.empty!=="none"&&i.push(O),`vlSelectionTest(${O}, ${r}`+(w.resolve==="global"?")":`, ${Ws(w.resolve)})`)});return(i.length?"!("+i.map(f=>`length(data(${f}))`).join(" || ")+") || ":"")+`(${s})`}function eR(e,t){const n=t.encoding;let r=t.field;if(n||r){if(n&&!r){const i=e.project.items.filter(s=>s.channel===n);!i.length||i.length>1?(r=e.project.items[0].field,_i((i.length?"Multiple ":"No ")+`matching ${Ws(n)} encoding found for selection ${Ws(t.selection)}. Using "field": ${Ws(r)}.`)):r=i[0].field}}else r=e.project.items[0].field,e.project.items.length>1&&_i(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${Ws(r)}.`);return`${e.name}[${Ws(r)}]`}function R_(e,t,n){return i2(t,r=>cs(r)?r:function(i){return i==null?void 0:i.selection}(r)?Z5(e,r.selection,n):$I(r))}function _O(e,t,n,r){var i,s,f;e.encode=(i=e.encode)!==null&&i!==void 0?i:{},e.encode[t]=(s=e.encode[t])!==null&&s!==void 0?s:{},e.encode[t].update=(f=e.encode[t].update)!==null&&f!==void 0?f:{},e.encode[t].update[n]=r}function D2(e,t,n,r={header:!1}){var i,s;const f=e.combine(),{disable:v,orient:w,scale:O,labelExpr:N,title:L,zindex:Y}=f,ie=Bo(f,["disable","orient","scale","labelExpr","title","zindex"]);if(!v){for(const fe in ie){const ve=HP[fe],Be=ie[fe];if(ve&&ve!==t&&ve!=="both")delete ie[fe];else if(sA(Be)){const{condition:We}=Be,Ve=Bo(Be,["condition"]),ct=_f(We),lt=dI[fe];if(lt){const{vgProp:mt,part:dt}=lt;_O(ie,dt,mt,[...ct.map(kt=>{const{test:wt}=kt,dn=Bo(kt,["test"]);return Object.assign({test:R_(null,wt)},dn)}),Ve]),delete ie[fe]}else if(lt===null){const mt={signal:ct.map(dt=>{const{test:kt}=dt,wt=Bo(dt,["test"]);return`${R_(null,kt)} ? ${AF(wt)} : `}).join("")+AF(Ve)};ie[fe]=mt}}else if(xa(Be)){const We=dI[fe];if(We){const{vgProp:Ve,part:ct}=We;_O(ie,ct,Ve,Be),delete ie[fe]}}}if(t==="grid"){if(!ie.grid)return;if(ie.encode){const{grid:fe}=ie.encode;ie.encode=Object.assign({},fe?{grid:fe}:{}),bc(ie.encode)&&delete ie.encode}return Object.assign(Object.assign({scale:O,orient:w},ie),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:$f(Y,0)})}{if(!r.header&&e.mainExtracted)return;if(N!==void 0){let ve=N;((s=(i=ie.encode)===null||i===void 0?void 0:i.labels)===null||s===void 0?void 0:s.update)&&xa(ie.encode.labels.update.text)&&(ve=_b(N,"datum.label",ie.encode.labels.update.text.signal)),_O(ie,"labels","text",{signal:ve})}if(ie.labelAlign===null&&delete ie.labelAlign,ie.encode){for(const ve of pI)e.hasAxisPart(ve)||delete ie.encode[ve];bc(ie.encode)&&delete ie.encode}const fe=function(ve,Be){if(ve)return $o(ve)&&!ey(ve)?ve.map(We=>kF(We,Be)).join(", "):ve}(L,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:O,orient:w,grid:!1},fe?{title:fe}:{}),ie),n.aria===!1?{aria:!1}:{}),{zindex:$f(Y,0)})}}}function tR(e){const{axes:t}=e.component,n=[];for(const r of W0)if(t[r]){for(const i of t[r])if(!i.get("disable")&&!i.get("gridScale")){const s=r==="x"?"height":"width",f=e.getSizeSignalRef(s).signal;s!==f&&n.push({name:s,update:f})}}return n}const nR={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},rR={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},QW=Si(nR),ZW=Si(rR);function iR(e,t,n,r){return Object.assign.apply(null,[{},...e.map(i=>{if(i==="axisOrient"){const s=n==="x"?"bottom":"left",f=t[n==="x"?"axisBottom":"axisLeft"]||{},v=t[n==="x"?"axisTop":"axisRight"]||{},w=new Set([...Si(f),...Si(v)]),O={};for(const N of w.values())O[N]={signal:`${r.signal} === "${s}" ? ${m2(f[N])} : ${m2(v[N])}`};return O}return t[i]})])}function eV(e,t,n,r){const i=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:function(O){return O in $z}(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],s=e==="x"?"axisX":"axisY",f=xa(n)?"axisOrient":"axis"+zk(n),v=[...i,...i.map(O=>s+O.substr(4))],w=["axis",f,s];return{vlOnlyAxisConfig:iR(v,r,e,n),vgAxisConfig:iR(w,r,e,n),axisConfigStyle:function(O,N){var L;const Y=[{}];for(const ie of O){let fe=(L=N[ie])===null||L===void 0?void 0:L.style;if(fe){fe=_f(fe);for(const ve of fe)Y.push(N.style[ve])}}return Object.assign.apply(null,Y)}([...w,...v],r)}}function EO(e,t,n,r={}){var i;const s=SF(e,n,t.style);if(s!==void 0)return{configFrom:"style",configValue:s};for(const f of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((i=r[f])===null||i===void 0?void 0:i[e])!==void 0)return{configFrom:f,configValue:r[f][e]};return{}}const oR={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:r,formatType:i}=n;return oF(e,e.type,r,i,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return aF(r,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var r;return(!Vi(e)||!Nm(e.bin))&&((r=t.grid)!==null&&r!==void 0?r:function(i,s){return!Cg(i)&&Vi(s)&&!Nc(s==null?void 0:s.bin)}(n,e))},gridScale:({model:e,channel:t})=>function(n,r){const i=r==="x"?"y":"x";if(n.getScaleComponent(i))return n.scaleName(i)}(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelAlign||sR(t,n,r),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelBaseline||aR(t,n,r),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var r;return(r=e.labelFlush)!==null&&r!==void 0?r:function(i,s){if(s==="x"&&Yo(["quantitative","temporal"],i))return!0}(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var r;return(r=e.labelOverlap)!==null&&r!==void 0?r:function(i,s){if(i!=="nominal")return s!=="log"||"greedy"}(t.type,n)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:r,scaleType:i})=>{var s;const f=e==="x"?"width":e==="y"?"height":void 0,v=f?t.getSizeSignalRef(f):void 0;return(s=n.tickCount)!==null&&s!==void 0?s:function({fieldOrDatumDef:w,scaleType:O,size:N,values:L}){var Y;if(!L&&!Cg(O)&&O!=="log"){if(Vi(w)){if(Nc(w.bin))return{signal:`ceil(${N.signal}/10)`};if(w.timeUnit&&Yo(["month","hours","day","quarter"],(Y=Im(w.timeUnit))===null||Y===void 0?void 0:Y.unit))return}return{signal:`ceil(${N.signal}/40)`}}}({fieldOrDatumDef:r,scaleType:i,size:v,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const r=uR(t,n);if(r!==void 0)return r;const i=t.typedFieldDef(n),s=n==="x"?"x2":"y2",f=t.fieldDef(s);return TF(i?[dF(i)]:[],Vi(f)?[dF(f)]:[])},values:({axis:e,fieldOrDatumDef:t})=>function(n,r){const i=n.values;if($o(i))return EF(r,i);if(xa(i))return i}(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var r;return(r=e.zindex)!==null&&r!==void 0?r:function(i,s){return i==="rect"&&vF(s)?1:0}(n,t)}};function CO(e){return`(((${e.signal} % 360) + 360) % 360)`}function aR(e,t,n,r){if(e!==void 0){if(n==="x"){if(xa(e)){const i=CO(e);return{signal:`(45 < ${i} && ${i} < 135) || (225 < ${i} && ${i} < 315) ? "middle" :(${i} <= 45 || 315 <= ${i}) === ${xa(t)?`(${t.signal} === "top")`:t==="top"} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(xa(t)){const i=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${i} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==(t==="top")?"bottom":"top"}if(xa(e)){const i=CO(e),s=xa(t)?`(${t.signal} === "left")`:t==="left";return{signal:`${i} <= 45 || 315 <= ${i} || (135 <= ${i} && ${i} <= 225) ? ${r?'"middle"':"null"} : (45 <= ${i} && ${i} <= 135) === ${s} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return r?"middle":null;if(xa(t)){const i=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${i} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==(t==="left")?"top":"bottom"}}function sR(e,t,n){if(e===void 0)return;const r=n==="x",i=r?0:90,s=r?"bottom":"left";if(xa(e)){const f=CO(e),v=xa(t)?`(${t.signal} === "${s}")`:t===s;return{signal:`(${i?"("+f+" + 90)":f} % 180 === 0) ? ${r?null:'"center"'} :(${i} < ${f} && ${f} < ${180+i}) === ${v} ? "left" : "right"`}}if((e+i)%180==0)return r?null:"center";if(xa(t)){const f=i<e&&e<180+i?"===":"!==";return{signal:`${`${t.signal} ${f} "${s}"`} ? "left" : "right"`}}return(i<e&&e<180+i)==(t===s)?"left":"right"}function uR(e,t){const n=t==="x"?"x2":"y2",r=e.fieldDef(t),i=e.fieldDef(n),s=r?r.title:void 0,f=i?i.title:void 0;return s&&f?NF(s,f):s||f||(s!==void 0?s:f!==void 0?f:void 0)}class Fb extends oc{constructor(t,n){super(t),this.transform=n,this._dependentFields=Q5(this.transform.calculate)}clone(){return new Fb(null,ls(this.transform))}static parseAllForSortIndex(t,n){return n.forEachFieldDef((r,i)=>{if(BA(r)&&hF(r.sort)){const{field:s,timeUnit:f}=r,v=r.sort,w=v.map((O,N)=>`${$I({field:s,timeUnit:f,equal:O})} ? ${N} : `).join("")+v.length;t=new Fb(t,{calculate:w,as:Rb(r,i,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${Zs(this.transform)}`}}function Rb(e,t,n){return Fi(e,Object.assign({prefix:t,suffix:"sort_index"},n!=null?n:{}))}function M_(e,t){return Yo(["top","bottom"],t)?"column":Yo(["left","right"],t)||e==="row"?"row":"column"}function Mb(e,t,n,r){const i=r==="row"?n.headerRow:r==="column"?n.headerColumn:n.headerFacet;return $f(((t==null?void 0:t.header)||{})[e],i[e],n.header[e])}function j_(e,t,n,r){const i={};for(const s of e){const f=Mb(s,t,n,r);f!==void 0&&(i[s]=f)}return i}const AO=["row","column"],OO=["header","footer"];function tV(e,t){const n=e.component.layoutHeaders[t].title,r=e.config?e.config:void 0,i=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:s,titleAngle:f,titleOrient:v}=j_(["titleAnchor","titleAngle","titleOrient"],i,r,t),w=M_(t,v),O=Uk(f);return{name:`${t}-title`,type:"group",role:`${w}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),lR(O,w)),cR(w,O,s)),fR(r,i,t,QW,nR))}}function cR(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const r=sR(t,e==="row"?"left":"top",e==="row"?"y":"x");return r?{align:r}:{}}function lR(e,t){const n=aR(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function nV(e,t){const n=e.component.layoutHeaders[t],r=[];for(const i of OO)if(n[i])for(const s of n[i]){const f=rV(e,t,i,n,s);f!=null&&r.push(f)}return r}function SO(e,t,n){const{format:r,formatType:i,labelAngle:s,labelAnchor:f,labelOrient:v,labelExpr:w}=j_(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e,n,t),O=TA({fieldOrDatumDef:e,format:r,formatType:i,expr:"parent",config:n}).signal,N=M_(t,v);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:w?_b(_b(w,"datum.label",O),"datum.value",Fi(e,{expr:"parent"})):O}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),lR(s,N)),cR(N,s,f)),fR(n,e,t,ZW,rR))}function rV(e,t,n,r,i){if(i){let s=null;const{facetFieldDef:f}=r,v=e.config?e.config:void 0;if(f&&i.labels){const{labelOrient:L}=j_(["labelOrient"],f,v,t);(t==="row"&&!Yo(["top","bottom"],L)||t==="column"&&!Yo(["left","right"],L))&&(s=SO(f,t,v))}const w=vv(e)&&!h2(e.facet),O=i.axes,N=(O==null?void 0:O.length)>0;if(s||N){const L=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:function(Y,ie){var fe;const{sort:ve}=Y;return Wv(ve)?{field:Fi(ve,{expr:"datum"}),order:(fe=ve.order)!==null&&fe!==void 0?fe:"ascending"}:$o(ve)?{field:Rb(Y,ie,{expr:"datum"}),order:"ascending"}:{field:Fi(Y,{expr:"datum"}),order:ve!=null?ve:"ascending"}}(f,t)}:{}),N&&w?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),s?{title:s}:{}),i.sizeSignal?{encode:{update:{[L]:i.sizeSignal}}}:{}),N?{axes:O}:{})}}return null}const iV={column:{start:0,end:1},row:{start:1,end:0}};function oV(e,t){return iV[t][e]}function fR(e,t,n,r,i){const s={};for(const f of r){if(!i[f])continue;const v=Mb(f,t,e,n);v!==void 0&&(s[i[f]]=v)}return s}function DO(e){return[...B_(e,"width"),...B_(e,"height"),...B_(e,"childWidth"),...B_(e,"childHeight")]}function B_(e,t){const n=t==="width"?"x":"y",r=e.component.layoutSize.get(t);if(!r||r==="merged")return[];const i=e.getSizeSignalRef(t).signal;if(r==="step"){const s=e.getScaleComponent(n);if(s){const f=s.get("type"),v=s.get("range");if(Cg(f)&&Y1(v)){const w=e.scaleName(n);return vv(e.parent)&&e.parent.component.resolve.scale[n]==="independent"?[hR(w,v)]:[hR(w,v),{name:i,update:dR(w,s,`domain('${w}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if(r=="container"){const s=i.endsWith("width"),f=s?"containerSize()[0]":"containerSize()[1]",v=`isFinite(${f}) ? ${f} : ${eO(e.config.view,s?"width":"height")}`;return[{name:i,init:v,on:[{update:v,events:"window:resize"}]}]}return[{name:i,value:r}]}function hR(e,t){return{name:e+"_step",value:t.step}}function dR(e,t,n){const r=t.get("type"),i=t.get("padding"),s=$f(t.get("paddingOuter"),i);let f=t.get("paddingInner");return`bandspace(${n}, ${f=r==="band"?f!==void 0?f:i:1}, ${s}) * ${e}_step`}function pR(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function mR(e,t){return Si(e).reduce((n,r)=>{const i=e[r];return Object.assign(Object.assign({},n),y2(t,i,r,s=>xa(s)?s:{value:s.value}))},{})}function aV(e,t){if(Lb(t)||vv(t))return"shared";if(WO(t))return zv(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function TO(e,t){const n=e.scale[t],r=zv(t)?"axis":"legend";return n==="independent"?(e[r][t]==="shared"&&_i(me.independentScaleMeansIndependentGuide(t)),"independent"):e[r][t]||"shared"}const sV=Object.assign(Object.assign({},lU),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),gR=Si(sV);class uV extends y1{}const vR={symbols:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i,legendType:s}){var f,v,w,O,N;if(s!=="symbol")return;const{markDef:L,encoding:Y,config:ie,mark:fe}=n,ve=L.filled&&fe!=="trail";let Be=Object.assign(Object.assign({},function(Ve,ct,lt){for(const mt of lt){const dt=Wy(mt,ct.markDef,ct.config);dt!==void 0&&(Ve[mt]=Ef(dt))}return Ve}({},n,YP)),b5(n,{filled:ve}));const We=(f=yR(Y.opacity))!==null&&f!==void 0?f:L.opacity;if(Be.fill){if(r==="fill"||ve&&r===_g)delete Be.fill;else if(Be.fill.field)i.get("symbolFillColor")?delete Be.fill:(Be.fill=Ef((v=ie.legend.symbolBaseFillColor)!==null&&v!==void 0?v:"black"),Be.fillOpacity=Ef(We!=null?We:1));else if($o(Be.fill)){const Ve=(N=(O=NO((w=Y.fill)!==null&&w!==void 0?w:Y.color))!==null&&O!==void 0?O:L.fill)!==null&&N!==void 0?N:ve&&L.color;Ve&&(Be.fill=Ef(Ve))}}if(Be.stroke){if(r==="stroke"||!ve&&r===_g)delete Be.stroke;else if(Be.stroke.field)delete Be.stroke;else if($o(Be.stroke)){const Ve=$f(NO(Y.stroke||Y.color),L.stroke,ve?L.color:void 0);Ve&&(Be.stroke={value:Ve})}}if(r!==m1){const Ve=Vi(t)&&xR(n,i,t);Ve?Be.opacity=[Object.assign({test:Ve},Ef(We!=null?We:1)),Ef(ie.legend.unselectedOpacity)]:We&&(Be.opacity=Ef(We))}return bc(Be=Object.assign(Object.assign({},Be),e))?void 0:Be},gradient:function(e,{model:t,legendType:n}){if(n!=="gradient")return;let r={};const i=yR(t.encoding.opacity)||t.markDef.opacity;return i&&(r.opacity=Ef(i)),bc(r=Object.assign(Object.assign({},r),e))?void 0:r},labels:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i}){const s=n.legend(r)||{},f=n.config,v=Vi(t)?xR(n,i,t):void 0,w=v?[{test:v,value:1},{value:f.legend.unselectedOpacity}]:void 0,{format:O,formatType:N}=s,L=Ly(N)?NA({fieldOrDatumDef:t,field:"datum.value",format:O,formatType:N,config:f}):void 0,Y=Object.assign(Object.assign(Object.assign({},w?{opacity:w}:{}),L?{text:L}:{}),e);return bc(Y)?void 0:Y},entries:function(e,{legendCmpt:t}){const n=t.get("selections");return n!=null&&n.length?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}};function yR(e){return bR(e,(t,n)=>Math.max(t,n.value))}function NO(e){return bR(e,(t,n)=>$f(t,n.value))}function bR(e,t){return function(n){const r=n&&n.condition;return!!r&&($o(r)||g1(r))}(e)?_f(e.condition).reduce(t,e.value):g1(e)?e.value:void 0}function xR(e,t,n){const r=t.get("selections");if(!(r!=null&&r.length))return;const i=Ws(n.field);return r.map(s=>`(!length(data(${Ws(dl(s)+Gy)})) || (${s}[${i}] && indexof(${s}[${i}], datum.value) >= 0))`).join(" || ")}const wR={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:r,formatType:i}=t;return oF(e,e.type,r,i,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return aF(r,t,n)},gradientLength:e=>{var t,n;const{legend:r,legendConfig:i}=e;return(n=(t=r.gradientLength)!==null&&t!==void 0?t:i.gradientLength)!==null&&n!==void 0?n:function({legendConfig:s,model:f,direction:v,orient:w,scaleType:O}){const{gradientHorizontalMaxLength:N,gradientHorizontalMinLength:L,gradientVerticalMaxLength:Y,gradientVerticalMinLength:ie}=s;if(hv(O))return v==="horizontal"?w==="top"||w==="bottom"?kR(f,"width",L,N):L:kR(f,"height",ie,Y)}(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var r,i;return(i=(r=e.labelOverlap)!==null&&r!==void 0?r:t.labelOverlap)!==null&&i!==void 0?i:function(s){if(Yo(["quantile","threshold","log"],s))return"greedy"}(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:r})=>{var i;return(i=e.symbolType)!==null&&i!==void 0?i:function(s,f,v,w){var O;if(f!=="shape"){const N=(O=NO(v))!==null&&O!==void 0?O:w;if(N)return N}switch(s){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(t.type,n,r.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>zy(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(Eb(n)&&hv(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>function(n,r){const i=n.values;if($o(i))return EF(r,i);if(xa(i))return i}(t,e)};function cV(e){const{legend:t}=e;return $f(t.type,function({channel:n,timeUnit:r,scaleType:i}){if(Eb(n)){if(Yo(["quarter","month","day"],r))return"symbol";if(hv(i))return"gradient"}return"symbol"}(e))}function lV({legendConfig:e,legendType:t,orient:n,legend:r}){var i,s;return(s=(i=r.direction)!==null&&i!==void 0?i:e[t?"gradientDirection":"symbolDirection"])!==null&&s!==void 0?s:function(f,v){switch(f){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return v==="gradient"?"horizontal":void 0}}(n,t)}function kR(e,t,n,r){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${r})`}}function _R(e){const t=Jl(e)?function(n){const{encoding:r}=n,i={};for(const s of[_g,...$F]){const f=Th(r[s]);f&&n.getScaleComponent(s)&&(s===Eg&&Vi(f)&&f.type===Sb||(i[s]=hV(n,s)))}return i}(e):function(n){const{legends:r,resolve:i}=n.component;for(const s of n.children){_R(s);for(const f of Si(s.component.legends))i.legend[f]=TO(n.component.resolve,f),i.legend[f]==="shared"&&(r[f]=ER(r[f],s.component.legends[f]),r[f]||(i.legend[f]="independent",delete r[f]))}for(const s of Si(r))for(const f of n.children)f.component.legends[s]&&i.legend[s]==="shared"&&delete f.component.legends[s];return r}(e);return e.component.legends=t,t}function fV(e,t,n,r){switch(t){case"disable":return n!==void 0;case"values":return!!(n!=null&&n.values);case"title":if(t==="title"&&e===(r==null?void 0:r.title))return!0}return e===(n||{})[t]}function hV(e,t){var n,r,i;let s=e.legend(t);const{markDef:f,encoding:v,config:w}=e,O=w.legend,N=new uV({},function(dt,kt){const wt=dt.scaleName(kt);if(dt.mark==="trail"){if(kt==="color")return{stroke:wt};if(kt==="size")return{strokeWidth:wt}}return kt==="color"?dt.markDef.filled?{fill:wt}:{stroke:wt}:{[kt]:wt}}(e,t));(function(dt,kt,wt){var dn;const Dn=(dn=dt.fieldDef(kt))===null||dn===void 0?void 0:dn.field;$y(dt,wn=>{var Xn,Kn;const ir=(Xn=wn.project.hasField[Dn])!==null&&Xn!==void 0?Xn:wn.project.hasChannel[kt];if(ir&&S5.has(wn)){const sr=(Kn=wt.get("selections"))!==null&&Kn!==void 0?Kn:[];sr.push(wn.name),wt.set("selections",sr,!1),ir.hasLegend=!0}})})(e,t,N);const L=s!==void 0?!s:O.disable;if(N.set("disable",L,s!==void 0),L)return N;s=s||{};const Y=e.getScaleComponent(t).get("type"),ie=Th(v[t]),fe=Vi(ie)?(n=Im(ie.timeUnit))===null||n===void 0?void 0:n.unit:void 0,ve=s.orient||w.legend.orient||"right",Be=cV({legend:s,channel:t,timeUnit:fe,scaleType:Y}),We={legend:s,channel:t,model:e,markDef:f,encoding:v,fieldOrDatumDef:ie,legendConfig:O,config:w,scaleType:Y,orient:ve,legendType:Be,direction:lV({legend:s,legendType:Be,orient:ve,legendConfig:O})};for(const dt of gR){const kt=dt in wR?wR[dt](We):s[dt];if(kt!==void 0){const wt=fV(kt,dt,s,e.fieldDef(t));(wt||w.legend[dt]===void 0)&&N.set(dt,kt,wt)}}const Ve=(r=s==null?void 0:s.encoding)!==null&&r!==void 0?r:{},ct=N.get("selections"),lt={},mt={fieldOrDatumDef:ie,model:e,channel:t,legendCmpt:N,legendType:Be};for(const dt of["labels","legend","title","symbols","gradient","entries"]){const kt=mR((i=Ve[dt])!==null&&i!==void 0?i:{},e),wt=dt in vR?vR[dt](kt,mt):kt;wt===void 0||bc(wt)||(lt[dt]=Object.assign(Object.assign(Object.assign({},(ct==null?void 0:ct.length)&&Vi(ie)?{name:`${dl(ie.field)}_legend_${dt}`}:{}),ct!=null&&ct.length?{interactive:!!ct}:{}),{update:wt}))}return bc(lt)||N.set("encode",lt,!!(s!=null&&s.encoding)),N}function ER(e,t){var n,r,i,s;if(!e)return t.clone();const f=e.getWithExplicit("orient"),v=t.getWithExplicit("orient");if(f.explicit&&v.explicit&&f.value!==v.value)return;let w=!1;for(const O of gR){const N=ty(e.getWithExplicit(O),t.getWithExplicit(O),O,"legend",(L,Y)=>{switch(O){case"symbolType":return dV(L,Y);case"title":return IF(L,Y);case"type":return w=!0,dv("symbol")}return x_(L,Y,O,"legend")});e.setWithExplicit(O,N)}return w&&(!((r=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||r===void 0)&&r.gradient&&oA(e.implicit,["encode","gradient"]),!((s=(i=e.explicit)===null||i===void 0?void 0:i.encode)===null||s===void 0)&&s.gradient&&oA(e.explicit,["encode","gradient"])),e}function dV(e,t){return t.value==="circle"?t:e}function CR(e,t,n,r){var i,s,f;e.encode=(i=e.encode)!==null&&i!==void 0?i:{},e.encode[t]=(s=e.encode[t])!==null&&s!==void 0?s:{},e.encode[t].update=(f=e.encode[t].update)!==null&&f!==void 0?f:{},e.encode[t].update[n]=r}function AR(e){const t=e.component.legends,n={};for(const r of Si(t)){const i=e.getScaleComponent(r),s=hl(i.get("domains"));if(n[s])for(const f of n[s])ER(f,t[r])||n[s].push(t[r]);else n[s]=[t[r].clone()]}return z1(n).flat().map(r=>function(i,s){var f,v,w;const O=i.combine(),{disable:N,labelExpr:L,selections:Y}=O,ie=Bo(O,["disable","labelExpr","selections"]);if(!N){if(s.aria===!1&&ie.aria==null&&(ie.aria=!1),!((f=ie.encode)===null||f===void 0)&&f.symbols){const fe=ie.encode.symbols.update;!fe.fill||fe.fill.value==="transparent"||fe.stroke||ie.stroke||(fe.stroke={value:"transparent"});for(const ve of $F)ie[ve]&&delete fe[ve]}if(ie.title||delete ie.title,L!==void 0){let fe=L;((w=(v=ie.encode)===null||v===void 0?void 0:v.labels)===null||w===void 0?void 0:w.update)&&xa(ie.encode.labels.update.text)&&(fe=_b(L,"datum.label",ie.encode.labels.update.text.signal)),CR(ie,"labels","text",{signal:fe})}for(const fe in ie){const ve=ie[fe];if(xa(ve)){const Be=cU[fe];if(Be){const{vgProp:We,part:Ve}=Be;CR(ie,Ve,We,ve),delete ie[fe]}}}return ie}}(r,e.config)).filter(r=>r!==void 0)}function pV(e){return Lb(e)||WO(e)?function(t){return t.children.reduce((n,r)=>n.concat(r.assembleProjections()),OR(t))}(e):OR(e)}function OR(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:r}=n;if(t.data){const i={signal:`[${t.size.map(f=>f.signal).join(", ")}]`},s=t.data.reduce((f,v)=>{const w=xa(v)?v.signal:`data('${e.lookupDataSource(v)}')`;return Yo(f,w)||f.push(w),f},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:r,size:i,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]}},n)]}return[Object.assign(Object.assign({name:r},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const mV=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class SR extends y1{constructor(t,n,r,i){super(Object.assign({},n),{name:t}),this.specifiedProjection=n,this.size=r,this.data=i,this.merged=!1}get isFit(){return!!this.data}}function DR(e){e.component.projection=Jl(e)?function(t){var n;if(t.hasProjection){const r=t.specifiedProjection,i=!(r&&(r.scale!=null||r.translate!=null)),s=i?[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]:void 0,f=i?function(v){const w=[],{encoding:O}=v;for(const N of[[Mv,Rv],[z0,fv]])(Th(O[N[0]])||Th(O[N[1]]))&&w.push({signal:v.getName(`geojson_${w.length}`)});return v.channelHasField(Eg)&&v.typedFieldDef(Eg).type===Sb&&w.push({signal:v.getName(`geojson_${w.length}`)}),w.length===0&&w.push(v.requestDataName(Np)),w}(t):void 0;return new SR(t.projectionName(!0),Object.assign(Object.assign({},(n=t.config.projection)!==null&&n!==void 0?n:{}),r!=null?r:{}),s,f)}}(e):function(t){if(t.children.length===0)return;let n;for(const i of t.children)DR(i);const r=aI(t.children,i=>{const s=i.component.projection;if(s){if(n){const f=function(v,w){const O=aI(mV,N=>!Ty(v.explicit,N)&&!Ty(w.explicit,N)||!(!Ty(v.explicit,N)||!Ty(w.explicit,N)||hl(v.get(N))!==hl(w.get(N))));if(hl(v.size)===hl(w.size)){if(O)return v;if(hl(v.explicit)===hl({}))return w;if(hl(w.explicit)===hl({}))return v}return null}(n,s);return f&&(n=f),!!f}return n=s,!0}return!0});if(n&&r){const i=t.projectionName(!0),s=new SR(i,n.specifiedProjection,n.size,ls(n.data));for(const f of t.children){const v=f.component.projection;v&&(v.isFit&&s.data.push(...f.component.projection.data),f.renameProjection(v.get("name"),i),v.merged=!0)}return s}}(e)}function TR(e,t){return`${RI(e)}_${t}`}function IO(e,t,n){var r;const i=TR((r=h_(n,void 0))!==null&&r!==void 0?r:{},t);return e.getName(`${i}_bins`)}function NR(e,t,n){let r,i;r=function(O){return"as"in O}(e)?cs(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:[Fi(e,{forAs:!0}),Fi(e,{binSuffix:"end",forAs:!0})];const s=Object.assign({},h_(t,void 0)),f=TR(s,e.field),{signal:v,extentSignal:w}=function(O,N){return{signal:O.getName(`${N}_bins`),extentSignal:O.getName(`${N}_extent`)}}(n,f);if(n_(s.extent)){const O=s.extent,N=O.selection;i=eR(n.getSelectionComponent(dl(N),N),O),delete s.extent}return{key:f,binComponent:Object.assign(Object.assign(Object.assign({bin:s,field:e.field,as:[r]},v?{signal:v}:{}),w?{extentSignal:w}:{}),i?{span:i}:{})}}class Kv extends oc{constructor(t,n){super(t),this.bins=n}clone(){return new Kv(null,ls(this.bins))}static makeFromEncoding(t,n){const r=n.reduceFieldDef((i,s,f)=>{if(o0(s)&&Nc(s.bin)){const{key:v,binComponent:w}=NR(s,s.bin,n);i[v]=Object.assign(Object.assign(Object.assign({},w),i[v]),function(O,N,L,Y){var ie,fe;if(p2(N,L)){const ve=Jl(O)&&(fe=(ie=O.axis(L))!==null&&ie!==void 0?ie:O.legend(L))!==null&&fe!==void 0?fe:{},Be=Fi(N,{expr:"datum"}),We=Fi(N,{expr:"datum",binSuffix:"end"});return{formulaAs:Fi(N,{binSuffix:"range",forAs:!0}),formula:a_(Be,We,ve.format,ve.formatType,Y)}}return{}}(n,s,f,n.config))}return i},{});return bc(r)?null:new Kv(t,r)}static makeFromTransform(t,n,r){const{key:i,binComponent:s}=NR(n,n.bin,r);return new Kv(t,{[i]:s})}merge(t,n){for(const r of Si(t.bins))r in this.bins?(n(t.bins[r].signal,this.bins[r].signal),this.bins[r].as=L1([...this.bins[r].as,...t.bins[r].as],Zs)):this.bins[r]=t.bins[r];for(const r of t.children)t.removeChild(r),r.parent=this;t.remove()}producedFields(){return new Set(z1(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(z1(this.bins).map(t=>t.field))}hash(){return`Bin ${Zs(this.bins)}`}assemble(){return z1(this.bins).flatMap(t=>{const n=[],[r,...i]=t.as,s=t.bin,{extent:f}=s,v=Bo(s,["extent"]),w=Object.assign(Object.assign(Object.assign({type:"bin",field:U1(t.field),as:r,signal:t.signal},n_(f)?{extent:null}:{extent:f}),t.span?{span:{signal:`span(${t.span})`}}:{}),v);!f&&t.extentSignal&&(n.push({type:"extent",field:U1(t.field),signal:t.extentSignal}),w.extent={signal:t.extentSignal}),n.push(w);for(const O of i)for(let N=0;N<2;N++)n.push({type:"formula",expr:Fi({field:r[N]},{expr:"datum"}),as:O[N]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}class jb extends oc{constructor(t){let n;if(super(null),Hy(t=t!=null?t:{name:"source"})||(n=t.format?Object.assign({},u1(t.format,["parse"])):{}),w_(t))this._data={values:t.values};else if(v2(t)){if(this._data={url:t.url},!n.type){let r=/(?:\.([^.]+))?$/.exec(t.url)[1];Yo(["json","csv","tsv","dsv","topojson"],r)||(r="json"),n.type=r}}else p5(t)?this._data={values:[{type:"Sphere"}]}:(h5(t)||Hy(t))&&(this._data={});this._generator=Hy(t),t.name&&(this._name=t.name),n&&!bc(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function FO(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return console.error("Dataflow graph is inconsistent.",t,n),!1;if(!FO(t.children))return!1}return!0}class T2 extends oc{constructor(t,n){super(t),this.params=n}clone(){return new T2(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${Zs(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class N2 extends oc{constructor(t,n){super(t),this.params=n}clone(){return new N2(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([(t=this.params.as)!==null&&t!==void 0?t:"data"])}hash(){return`Hash ${Zs(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}function P_(e){return e instanceof jb||e instanceof T2||e instanceof N2}class IR{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class k1 extends IR{constructor(){super(),this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:t,mutatedFlag:n}){t&&this.setContinue(),n&&this.setMutated()}reset(){}optimizeNextFromLeaves(t){if(P_(t))return!1;const n=t.parent,{continueFlag:r}=this.run(t);return r&&this.optimizeNextFromLeaves(n),this.mutatedFlag}}class RO extends IR{}function gV(e,t,n,r){const i=Jl(r)?r.encoding[Pv(t)]:void 0;if(o0(n)&&Jl(r)&&FA(t,n,i,r.stack,r.markDef,r.config))e.add(Fi(n,{})),e.add(Fi(n,{suffix:"end"})),n.bin&&p2(n,t)&&e.add(Fi(n,{binSuffix:"range"}));else if(function(s){return s in hA}(t)){const s=function(f){switch(f){case Rv:return"y";case fv:return"y2";case Mv:return"x";case z0:return"x2"}}(t);e.add(r.getName(s))}else e.add(Fi(n));return e}class mv extends oc{constructor(t,n,r){super(t),this.dimensions=n,this.measures=r}clone(){return new mv(null,new Set(this.dimensions),ls(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let r=!1;n.forEachFieldDef(f=>{f.aggregate&&(r=!0)});const i={},s=new Set;return r?(n.forEachFieldDef((f,v)=>{var w,O,N,L;const{aggregate:Y,field:ie}=f;if(Y)if(Y==="count")i["*"]=(w=i["*"])!==null&&w!==void 0?w:{},i["*"].count=new Set([Fi(f,{forAs:!0})]);else{if(W1(Y)||Fy(Y)){const fe=W1(Y)?"argmin":"argmax",ve=Y[fe];i[ve]=(O=i[ve])!==null&&O!==void 0?O:{},i[ve][fe]=new Set([Fi({op:fe,field:ve},{forAs:!0})])}else i[ie]=(N=i[ie])!==null&&N!==void 0?N:{},i[ie][Y]=new Set([Fi(f,{forAs:!0})]);X1(v)&&n.scaleDomain(v)==="unaggregated"&&(i[ie]=(L=i[ie])!==null&&L!==void 0?L:{},i[ie].min=new Set([Fi({field:ie,aggregate:"min"},{forAs:!0})]),i[ie].max=new Set([Fi({field:ie,aggregate:"max"},{forAs:!0})]))}else gV(s,v,f,n)}),s.size+Si(i).length===0?null:new mv(t,s,i)):null}static makeFromTransform(t,n){var r,i,s;const f=new Set,v={};for(const w of n.aggregate){const{op:O,field:N,as:L}=w;O&&(O==="count"?(v["*"]=(r=v["*"])!==null&&r!==void 0?r:{},v["*"].count=new Set([L||Fi(w,{forAs:!0})])):(v[N]=(i=v[N])!==null&&i!==void 0?i:{},v[N][O]=new Set([L||Fi(w,{forAs:!0})])))}for(const w of(s=n.groupby)!==null&&s!==void 0?s:[])f.add(w);return f.size+Si(v).length===0?null:new mv(t,f,v)}merge(t){return function(n,r){if(n.size!==r.size)return!1;for(const i of n)if(!r.has(i))return!1;return!0}(this.dimensions,t.dimensions)?(function(n,r){var i;for(const s of Si(r)){const f=r[s];for(const v of Si(f))s in n?n[s][v]=new Set([...(i=n[s][v])!==null&&i!==void 0?i:[],...f[v]]):n[s]={[v]:f[v]}}}(this.measures,t.measures),!0):(function(...n){r_.debug(...n)}("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...Si(this.measures)])}producedFields(){const t=new Set;for(const n of Si(this.measures))for(const r of Si(this.measures[n])){const i=this.measures[n][r];i.size===0?t.add(`${r}_${n}`):i.forEach(t.add,t)}return t}hash(){return`Aggregate ${Zs({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],r=[];for(const i of Si(this.measures))for(const s of Si(this.measures[i]))for(const f of this.measures[i][s])r.push(f),t.push(s),n.push(i==="*"?null:U1(i));return{type:"aggregate",groupby:[...this.dimensions].map(U1),ops:t,fields:n,as:r}}}class Bb extends oc{constructor(t,n,r,i){super(t),this.model=n,this.name=r,this.data=i;for(const s of U0){const f=n.facet[s];if(f){const{bin:v,sort:w}=f;this[s]=Object.assign({name:n.getName(`${s}_domain`),fields:[Fi(f),...Nc(v)?[Fi(f,{binSuffix:"end"})]:[]]},Wv(w)?{sortField:w}:$o(w)?{sortIndexField:Rb(f,s)}:{})}}this.childModel=n.child}hash(){let t="Facet";for(const n of U0)this[n]&&(t+=` ${n.charAt(0)}:${Zs(this[n])}`);return t}get fields(){var t;const n=[];for(const r of U0)!((t=this[r])===null||t===void 0)&&t.fields&&n.push(...this[r].fields);return n}dependentFields(){const t=new Set(this.fields);for(const n of U0)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of W0){const r=this.childModel.component.scales[n];if(r&&!r.merged){const i=r.get("type"),s=r.get("range");if(Cg(i)&&Y1(s)){const f=zO(z_(this.childModel,n));f?t[n]=f:_i(`Unknown field for ${n}. Cannot calculate view size.`)}}}return t}assembleRowColumnHeaderData(t,n,r){const i={row:"y",column:"x"}[t],s=[],f=[],v=[];r&&r[i]&&(n?(s.push(`distinct_${r[i]}`),f.push("max")):(s.push(r[i]),f.push("distinct")),v.push(`distinct_${r[i]}`));const{sortField:w,sortIndexField:O}=this[t];if(w){const{op:N=s_,field:L}=w;s.push(L),f.push(N),v.push(Fi(w,{forAs:!0}))}else O&&(s.push(O),f.push("max"),v.push(O));return{name:this[t].name,source:n!=null?n:this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},s.length?{fields:s,ops:f,as:v}:{})]}}assembleFacetHeaderData(t){var n,r;const{columns:i}=this.model.layout,{layoutHeaders:s}=this.model.component,f=[],v={};for(const N of AO){for(const L of OO){const Y=(n=s[N]&&s[N][L])!==null&&n!==void 0?n:[];for(const ie of Y)if(((r=ie.axes)===null||r===void 0?void 0:r.length)>0){v[N]=!0;break}}if(v[N]){const L=`length(data("${this.facet.name}"))`,Y=N==="row"?i?{signal:`ceil(${L} / ${i})`}:1:i?{signal:`min(${L}, ${i})`}:{signal:L};f.push({name:`${this.facet.name}_${N}`,transform:[{type:"sequence",start:0,stop:Y}]})}}const{row:w,column:O}=v;return(w||O)&&f.unshift(this.assembleRowColumnHeaderData("facet",null,t)),f}assemble(){var t,n;const r=[];let i=null;const s=this.getChildIndependentFieldsWithStep(),{column:f,row:v,facet:w}=this;if(f&&v&&(s.x||s.y)){i=`cross_${this.column.name}_${this.row.name}`;const O=[].concat((t=s.x)!==null&&t!==void 0?t:[],(n=s.y)!==null&&n!==void 0?n:[]),N=O.map(()=>"distinct");r.push({name:i,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:O,ops:N}]})}for(const O of[f1,l1])this[O]&&r.push(this.assembleRowColumnHeaderData(O,i,s));if(w){const O=this.assembleFacetHeaderData(s);O&&r.push(...O)}return r}}function FR(e){return e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'?e.slice(1,-1):e}function vV(e){const t={};return function n(r,i){if(iA(r))n(r.not,i);else if(rA(r))for(const s of r.and)n(s,i);else if(nA(r))for(const s of r.or)n(s,i);else i(r)}(e.filter,n=>{var r;if(GI(n)){let i=null;wA(n)?i=n.equal:kA(n)?i=n.range[0]:_A(n)&&(i=((r=n.oneOf)!==null&&r!==void 0?r:n.in)[0]),i&&(Cb(i)?t[n.field]="date":Gf(i)?t[n.field]="number":cs(i)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function yV(e){const t={};function n(r){d_(r)?t[r.field]="date":r.type==="quantitative"&&function(i){return cs(i)&&Yo(["min","max"],i)}(r.aggregate)?t[r.field]="number":o2(r.field)>1?r.field in t||(t[r.field]="flatten"):BA(r)&&Wv(r.sort)&&o2(r.sort.field)>1&&(r.sort.field in t||(t[r.sort.field]="flatten"))}if((Jl(e)||vv(e))&&e.forEachFieldDef((r,i)=>{if(o0(r))n(r);else{const s=jy(i),f=e.fieldDef(s);n(Object.assign(Object.assign({},r),{type:f.type}))}}),Jl(e)){const{mark:r,markDef:i,encoding:s}=e;if(Iy(r)&&!e.encoding.order){const f=s[i.orient==="horizontal"?"y":"x"];!Vi(f)||f.type!=="quantitative"||f.field in t||(t[f.field]="number")}}return t}class jp extends oc{constructor(t,n){super(t),this._parse=n}clone(){return new jp(null,ls(this._parse))}hash(){return`Parse ${Zs(this._parse)}`}static makeExplicit(t,n,r){let i={};const s=n.data;return!Hy(s)&&s&&s.format&&s.format.parse&&(i=s.format.parse),this.makeWithAncestors(t,i,{},r)}static makeWithAncestors(t,n,r,i){for(const v of Si(r)){const w=i.getWithExplicit(v);w.value!==void 0&&(w.explicit||w.value===r[v]||w.value==="derived"||r[v]==="flatten"?delete r[v]:_i(me.differentParse(v,r[v],w.value)))}for(const v of Si(n)){const w=i.get(v);w!==void 0&&(w===n[v]?delete n[v]:_i(me.differentParse(v,n[v],w)))}const s=new y1(n,r);i.copyAll(s);const f={};for(const v of Si(s.combine())){const w=s.get(v);w!==null&&(f[v]=w)}return Si(f).length===0||i.parseNothing?null:new jp(t,f)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const n of Si(this._parse)){const r=this._parse[n];o2(n)===1&&(t[n]=r)}return t}producedFields(){return new Set(Si(this._parse))}dependentFields(){return new Set(Si(this._parse))}assembleTransforms(t=!1){return Si(this._parse).filter(n=>!t||o2(n)>1).map(n=>{const r=function(i,s){const f=fI(i);return s==="number"?`toNumber(${f})`:s==="boolean"?`toBoolean(${f})`:s==="string"?`toString(${f})`:s==="date"?`toDate(${f})`:s==="flatten"?f:s.indexOf("date:")===0?`timeParse(${f},'${FR(s.slice(5,s.length))}')`:s.indexOf("utc:")===0?`utcParse(${f},'${FR(s.slice(4,s.length))}')`:(_i(me.unrecognizedParse(s)),null)}(n,this._parse[n]);return r?{type:"formula",expr:r,as:hI(n)}:null}).filter(n=>n!==null)}}class oy extends oc{clone(){return new oy(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([Db])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:Db}}}class Jy extends oc{constructor(t,n){super(t),this.transform=n}clone(){return new Jy(null,ls(this.transform))}addDimensions(t){this.transform.groupby=L1(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:Fi(t)}hash(){return`JoinAggregateTransform ${Zs(this.transform)}`}assemble(){const t=[],n=[],r=[];for(const s of this.transform.joinaggregate)n.push(s.op),r.push(this.getDefaultName(s)),t.push(s.field===void 0?null:s.field);const i=this.transform.groupby;return Object.assign({type:"joinaggregate",as:r,ops:n,fields:t},i!==void 0?{groupby:i}:{})}}class _1 extends oc{constructor(t,n){super(t),this._stack=n}clone(){return new _1(null,ls(this._stack))}static makeFromTransform(t,n){const{stack:r,groupby:i,as:s,offset:f="zero"}=n,v=[],w=[];if(n.sort!==void 0)for(const L of n.sort)v.push(L.field),w.push($f(L.order,"ascending"));const O={field:v,order:w};let N;return N=function(L){return $o(L)&&L.every(Y=>cs(Y))&&L.length>1}(s)?s:cs(s)?[s,s+"_end"]:[n.stack+"_start",n.stack+"_end"],new _1(t,{stackField:r,groupby:i,offset:f,sort:O,facetby:[],as:N})}static makeFromEncoding(t,n){const r=n.stack,{encoding:i}=n;if(!r)return null;const{groupbyChannel:s,fieldChannel:f,offset:v,impute:w}=r;let O;s&&(O=qv(i[s]));const N=function(ie){return ie.stack.stackBy.reduce((fe,ve)=>{const Be=Fi(ve.fieldDef);return Be&&fe.push(Be),fe},[])}(n),L=n.encoding.order;let Y;return Y=$o(L)||Vi(L)?DF(L):N.reduce((ie,fe)=>(ie.field.push(fe),ie.order.push(f==="y"?"descending":"ascending"),ie),{field:[],order:[]}),new _1(t,{dimensionFieldDef:O,stackField:n.vgField(f),facetby:[],stackby:N,sort:Y,offset:v,impute:w,as:[n.vgField(f,{suffix:"start",forAs:!0}),n.vgField(f,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${Zs(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:t,impute:n,groupby:r}=this._stack;return t?t.bin?n?[Fi(t,{binSuffix:"mid"})]:[Fi(t,{}),Fi(t,{binSuffix:"end"})]:[Fi(t)]:r!=null?r:[]}assemble(){const t=[],{facetby:n,dimensionFieldDef:r,stackField:i,stackby:s,sort:f,offset:v,impute:w,as:O}=this._stack;if(w&&r){const{band:N=.5,bin:L}=r;L&&t.push({type:"formula",expr:`${N}*`+Fi(r,{expr:"datum"})+`+${1-N}*`+Fi(r,{expr:"datum",binSuffix:"end"}),as:Fi(r,{binSuffix:"mid",forAs:!0})}),t.push({type:"impute",field:i,groupby:[...s,...n],key:Fi(r,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:i,sort:f,as:O,offset:v}),t}}class Pb extends oc{constructor(t,n){super(t),this.transform=n}clone(){return new Pb(null,ls(this.transform))}addDimensions(t){this.transform.groupby=L1(this.transform.groupby.concat(t),n=>n)}dependentFields(){var t,n;const r=new Set;return((t=this.transform.groupby)!==null&&t!==void 0?t:[]).forEach(r.add,r),((n=this.transform.sort)!==null&&n!==void 0?n:[]).forEach(i=>r.add(i.field)),this.transform.window.map(i=>i.field).filter(i=>i!==void 0).forEach(r.add,r),r}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:Fi(t)}hash(){return`WindowTransform ${Zs(this.transform)}`}assemble(){var t;const n=[],r=[],i=[],s=[];for(const Y of this.transform.window)r.push(Y.op),i.push(this.getDefaultName(Y)),s.push(Y.param===void 0?null:Y.param),n.push(Y.field===void 0?null:Y.field);const f=this.transform.frame,v=this.transform.groupby;if(f&&f[0]===null&&f[1]===null&&r.every(Y=>fA(Y)))return Object.assign({type:"joinaggregate",as:i,ops:r,fields:n},v!==void 0?{groupby:v}:{});const w=[],O=[];if(this.transform.sort!==void 0)for(const Y of this.transform.sort)w.push(Y.field),O.push((t=Y.order)!==null&&t!==void 0?t:"ascending");const N={field:w,order:O},L=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:s,as:i,ops:r,fields:n,sort:N},L!==void 0?{ignorePeers:L}:{}),v!==void 0?{groupby:v}:{}),f!==void 0?{frame:f}:{})}}class bV extends k1{run(t){const n=t.parent;if(t instanceof jp){if(P_(n))return this.flags;if(n.numChildren()>1)return this.setContinue(),this.flags;if(n instanceof jp)this.setMutated(),n.merge(t);else{if(cI(n.producedFields(),t.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),t.swapWithParent()}}return this.setContinue(),this.flags}}class xV extends RO{mergeNodes(t,n){const r=n.shift();for(const i of n)t.removeChild(i),i.parent=r,i.remove()}run(t){const n=t.children.map(i=>i.hash()),r={};for(let i=0;i<n.length;i++)r[n[i]]===void 0?r[n[i]]=[t.children[i]]:r[n[i]].push(t.children[i]);for(const i of Si(r))r[i].length>1&&(this.setMutated(),this.mergeNodes(t,r[i]));for(const i of t.children)this.run(i);return this.mutatedFlag}}class wV extends k1{run(t){return t instanceof Fm||t.numChildren()>0||t instanceof Bb?this.flags:(this.setMutated(),t.remove(),this.flags)}}class kV extends k1{constructor(){super(...arguments),this.fields=new Set,this.prev=null}run(t){if(this.setContinue(),t instanceof Gv){const n=t.producedFields();sI(n,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...n]),this.prev=t}return this.flags}reset(){this.fields.clear()}}class _V extends k1{run(t){this.setContinue();const n=t.parent.children.filter(i=>i instanceof Gv),r=n.pop();for(const i of n)this.setMutated(),r.merge(i);return this.flags}}function MO(e){if(e instanceof Bb)if(e.numChildren()!==1||e.children[0]instanceof Fm){const t=e.model.component.data.main;(function i(s){if(s instanceof Fm&&s.type===Np&&s.numChildren()===1){const f=s.children[0];f instanceof Bb||(f.swapWithParent(),i(s))}})(t);const n=function(i){return function s(f){if(!(f instanceof Bb)){const v=f.clone();if(v instanceof Fm){const w=jO+v.getSource();v.setSource(w),i.model.component.data.outputNodes[w]=v}else(v instanceof mv||v instanceof _1||v instanceof Pb||v instanceof Jy)&&v.addDimensions(i.fields);for(const w of f.children.flatMap(s))w.parent=v;return[v]}return f.children.flatMap(s)}}(e),r=e.children.map(n).flat();for(const i of r)i.parent=t}else{const t=e.children[0];(t instanceof mv||t instanceof _1||t instanceof Pb||t instanceof Jy)&&t.addDimensions(e.fields),t.swapWithParent(),MO(e)}else e.children.map(MO)}class EV extends RO{constructor(){super()}run(t){t instanceof Fm&&!t.isRequired()&&(this.setMutated(),t.remove());for(const n of t.children)this.run(n);return this.mutatedFlag}}class CV extends RO{constructor(t){super(),this.requiresSelectionId=t&&dO(t)}run(t){t instanceof oy&&(this.requiresSelectionId&&(P_(t.parent)||t.parent instanceof mv||t.parent instanceof jp)||(this.setMutated(),t.remove()));for(const n of t.children)this.run(n);return this.mutatedFlag}}class AV extends k1{run(t){const n=t.parent,r=[...n.children],i=n.children.filter(s=>s instanceof jp);if(n.numChildren()>1&&i.length>=1){const s={},f=new Set;for(const v of i){const w=v.parse;for(const O of Si(w))O in s?s[O]!==w[O]&&f.add(O):s[O]=w[O]}for(const v of f)delete s[v];if(!bc(s)){this.setMutated();const v=new jp(n,s);for(const w of r){if(w instanceof jp)for(const O of Si(s))delete w.parse[O];n.removeChild(w),w.parent=v,w instanceof jp&&Si(w.parse).length===0&&w.remove()}}}return this.setContinue(),this.flags}}class OV extends k1{run(t){const n=t.parent,r=n.children.filter(s=>s instanceof mv),i={};for(const s of r){const f=Zs(s.groupBy);f in i||(i[f]=[]),i[f].push(s)}for(const s of Si(i)){const f=i[s];if(f.length>1){const v=f.pop();for(const w of f)v.merge(w)&&(n.removeChild(w),w.parent=v,w.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class SV extends k1{constructor(t){super(),this.model=t}run(t){const n=t.parent,r=!(P_(n)||n instanceof Ib||n instanceof jp||n instanceof oy),i=[],s=[];for(const f of n.children)f instanceof Kv&&(r&&!cI(n.producedFields(),f.dependentFields())?i.push(f):s.push(f));if(i.length>0){const f=i.pop();for(const v of i)f.merge(v,this.model.renameSignal.bind(this.model));this.setMutated(),n instanceof Kv?n.merge(f,this.model.renameSignal.bind(this.model)):f.swapWithParent()}if(s.length>1){const f=s.pop();for(const v of s)f.merge(v,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class DV extends k1{run(t){const n=t.parent,r=[...n.children];if(!r2(r,f=>f instanceof Fm)||n.numChildren()<=1)return this.setContinue(),this.flags;const i=[];let s;for(const f of r)if(f instanceof Fm){let v=f;for(;v.numChildren()===1;){const w=v.children[0];if(!(w instanceof Fm))break;v=w}i.push(...v.children),s?(n.removeChild(f),f.parent=s.parent,s.parent.removeChild(s),s.parent=v,this.setMutated()):s=v}else i.push(f);if(i.length){this.setMutated();for(const f of i)f.parent.removeChild(f),f.parent=s}return this.setContinue(),this.flags}}const jO="scale_",L_=5;function ay(e){const t=[];function n(r){if(r.numChildren()===0)t.push(r);else for(const i of r.children)n(i)}for(const r of e)n(r);return t}function TV(e){return e}function gv(e,t){return t.map(n=>{if(e instanceof k1){const r=e.optimizeNextFromLeaves(n);return e.reset(),r}return e.run(n)}).some(TV)}function RR(e,t){let n=e.sources;const r=new Set;return r.add(gv(new EV,n)),r.add(gv(new CV(t),n)),n=n.filter(i=>i.numChildren()>0),r.add(gv(new wV,ay(n))),n=n.filter(i=>i.numChildren()>0),r.add(gv(new bV,ay(n))),r.add(gv(new SV(t),ay(n))),r.add(gv(new kV,ay(n))),r.add(gv(new AV,ay(n))),r.add(gv(new OV,ay(n))),r.add(gv(new _V,ay(n))),r.add(gv(new xV,n)),r.add(gv(new DV,ay(n))),e.sources=n,r.has(!0)}class a0{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new a0(()=>t(n))}}function MR(e){Jl(e)?function(t){const n=t.component.scales;for(const r of Si(n)){const i=NV(t,r);if(n[r].setWithExplicit("domains",i),IV(t,r),t.component.data.isFaceted){let f=t;for(;!vv(f)&&f.parent;)f=f.parent;if(f.component.resolve.scale[r]==="shared")for(const w of i.value)J1(w)&&(w.data=jO+w.data.replace(jO,""))}}}(e):function(t){for(const r of t.children)MR(r);const n=t.component.scales;for(const r of Si(n)){let i,s=null;for(const f of t.children){const v=f.component.scales[r];if(v){i=i===void 0?v.getWithExplicit("domains"):ty(i,v.getWithExplicit("domains"),"domains","scale",LO);const w=v.get("selectionExtent");s&&w&&s.selection!==w.selection&&_i("The same selection must be used to override scale domains in a layered view."),s=w}}n[r].setWithExplicit("domains",i),s&&n[r].set("selectionExtent",s,!0)}}(e)}function NV(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:r}=e,i=function(s,f,v,w){if(s==="unaggregated"){const{valid:O,reason:N}=jR(f,v);if(!O)return void _i(N)}else if(s===void 0&&w.useUnaggregatedDomain){const{valid:O}=jR(f,v);if(O)return"unaggregated"}return s}(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:i})),t==="x"&&Th(r.x2)?Th(r.x)?ty(sy(n,i,e,"x"),sy(n,i,e,"x2"),"domain","scale",LO):sy(n,i,e,"x2"):t==="y"&&Th(r.y2)?Th(r.y)?ty(sy(n,i,e,"y"),sy(n,i,e,"y2"),"domain","scale",LO):sy(n,i,e,"y2"):sy(n,i,e,t)}function BO(e,t,n){var r;const i=(r=Im(n))===null||r===void 0?void 0:r.unit;return t==="temporal"||i?function(s,f,v){return s.map(w=>({signal:`{data: ${UA(w,{timeUnit:v,type:f})}}`}))}(e,t,i):[e]}function sy(e,t,n,r){const{encoding:i}=n,s=Th(i[r]),{type:f}=s,v=s.timeUnit;if(function(L){return L&&L.unionWith}(t)){const L=sy(e,void 0,n,r),Y=BO(t.unionWith,f,v);return qy([...L.value,...Y])}if(xa(t))return qy([t]);if(t&&t!=="unaggregated"&&!YI(t))return qy(BO(t,f,v));const w=n.stack;if(w&&r===w.fieldChannel){if(w.offset==="normalize")return dv([[0,1]]);const L=n.requestDataName(Np);return dv([{data:L,field:n.vgField(r,{suffix:"start"})},{data:L,field:n.vgField(r,{suffix:"end"})}])}const O=X1(r)&&Vi(s)?function(L,Y,ie){if(!Cg(ie))return;const fe=L.fieldDef(Y),ve=fe.sort;if(hF(ve))return{op:"min",field:Rb(fe,Y),order:"ascending"};const{stack:Be}=L,We=Be?[...Be.groupbyField?[Be.groupbyField]:[],...Be.stackBy.map(Ve=>Ve.fieldDef.field)]:void 0;if(Wv(ve)){const Ve=Be&&!Yo(We,ve.field);return PO(ve,Ve)}if(fF(ve)){const{encoding:Ve,order:ct}=ve,lt=L.fieldDef(Ve),{aggregate:mt,field:dt}=lt,kt=Be&&!Yo(We,dt);if(W1(mt)||Fy(mt))return PO({field:Fi(lt),order:ct},kt);if(fA(mt)||!mt)return PO({op:mt,field:dt,order:ct},kt)}else{if(ve==="descending")return{op:"min",field:L.vgField(Y),order:"descending"};if(Yo(["ascending",void 0],ve))return!0}}(n,r,e):void 0;if(Z1(s))return dv(BO([s.datum],f,v));const N=s;if(t==="unaggregated"){const L=n.requestDataName(Np),{field:Y}=s;return dv([{data:L,field:Fi({field:Y,aggregate:"min"})},{data:L,field:Fi({field:Y,aggregate:"max"})}])}if(Nc(N.bin)){if(Cg(e))return dv(e==="bin-ordinal"?[]:[{data:Lk(O)?n.requestDataName(Np):n.requestDataName(k_),field:n.vgField(r,p2(N,r)?{binSuffix:"range"}:{}),sort:O!==!0&&md(O)?O:{field:n.vgField(r,{}),op:"min"}}]);{const{bin:L}=N;if(Nc(L)){const Y=IO(n,N.field,L);return dv([new a0(()=>{const ie=n.getSignalName(Y);return`[${ie}.start, ${ie}.stop]`})])}return dv([{data:n.requestDataName(Np),field:n.vgField(r,{})}])}}if(N.timeUnit&&Yo(["time","utc"],e)&&FA(r,N,Jl(n)?n.encoding[Pv(r)]:void 0,n.stack,n.markDef,n.config)){const L=n.requestDataName(Np);return dv([{data:L,field:n.vgField(r)},{data:L,field:n.vgField(r,{suffix:"end"})}])}return dv(O?[{data:Lk(O)?n.requestDataName(Np):n.requestDataName(k_),field:n.vgField(r),sort:O}]:[{data:n.requestDataName(Np),field:n.vgField(r)}])}function PO(e,t){const{op:n,field:r,order:i}=e;return Object.assign(Object.assign({op:n!=null?n:t?"sum":s_},r?{field:U1(r)}:{}),i?{order:i}:{})}function IV(e,t){var n;const r=e.component.scales[t],i=e.specifiedScales[t].domain,s=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,f=YI(i)&&i,v=c2(s)&&n_(s.extent)&&s.extent;(f||v)&&r.set("selectionExtent",f!=null?f:v,!0)}function jR(e,t){const{aggregate:n,type:r}=e;return n?cs(n)&&!iL[n]?{valid:!1,reason:me.unaggregateDomainWithNonSharedDomainOp(n)}:r==="quantitative"&&t==="log"?{valid:!1,reason:me.unaggregatedDomainWithLogScale(e)}:{valid:!0}:{valid:!1,reason:me.unaggregateDomainHasNoEffectForRawField(e)}}function LO(e,t,n,r){return e.explicit&&t.explicit&&_i(me.mergeConflictingDomainProperty(n,r,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function zO(e){if(J1(e)&&cs(e.field))return e.field;if(function(t){return!$o(t)&&"fields"in t&&!("data"in t)}(e)){let t;for(const n of e.fields)if(J1(n)&&cs(n.field))if(t){if(t!==n.field)return _i(me.FACETED_INDEPENDENT_DIFFERENT_SOURCES),t}else t=n.field;return _i(me.FACETED_INDEPENDENT_SAME_FIELDS_DIFFERENT_SOURCES),t}if(function(t){return!$o(t)&&"fields"in t&&"data"in t}(e)){_i(me.FACETED_INDEPENDENT_SAME_SOURCE);const t=e.fields[0];return cs(t)?t:void 0}}function z_(e,t){return function(n){const r=L1(n.map(w=>J1(w)?Bo(w,["sort"]):w),Zs),i=L1(n.map(w=>{if(J1(w)){const O=w.sort;return O===void 0||Lk(O)||("op"in O&&O.op==="count"&&delete O.field,O.order==="ascending"&&delete O.order),O}}).filter(w=>w!==void 0),Zs);if(r.length===0)return;if(r.length===1){const w=n[0];if(J1(w)&&i.length>0){let O=i[0];if(i.length>1)_i(me.MORE_THAN_ONE_SORT),O=!0;else if(md(O)&&"field"in O){const N=O.field;w.field===N&&(O=!O.order||{order:O.order})}return Object.assign(Object.assign({},w),{sort:O})}return w}const s=L1(i.map(w=>Lk(w)||!("op"in w)||w.op in tL?w:(_i(me.domainSortDropped(w)),!0)),Zs);let f;s.length===1?f=s[0]:s.length>1&&(_i(me.MORE_THAN_ONE_SORT),f=!0);const v=L1(n.map(w=>J1(w)?w.data:null),w=>w);return v.length===1&&v[0]!==null?Object.assign({data:v[0],fields:r.map(w=>w.field)},f?{sort:f}:{}):Object.assign({fields:r},f?{sort:f}:{})}(e.component.scales[t].get("domains").map(n=>(J1(n)&&(n.data=e.lookupDataSource(n.data)),n)))}function BR(e){return Si(e.component.scales).reduce((t,n)=>{const r=e.component.scales[n];if(r.merged)return t;const i=r.combine(),{name:s,type:f,selectionExtent:v,domains:w,range:O,reverse:N}=i,L=Bo(i,["name","type","selectionExtent","domains","range","reverse"]),Y=function(ve,Be,We){return zv(We)&&Y1(ve)?{step:{signal:Be+"_step"}}:ve}(i.range,s,n);let ie;v&&(ie=function(ve,Be){const We=Be.selection;return{signal:eR(ve.getSelectionComponent(We,dl(We)),Be)}}(e,v));const fe=z_(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:s,type:f},fe?{domain:fe}:{}),ie?{domainRaw:ie}:{}),{range:Y}),N!==void 0?{reverse:N}:{}),L)),t},[])}class PR extends y1{constructor(t,n){super({},{name:t}),this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1||r2(this.get("domains"),t=>$o(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const FV=["range","scheme"];function LR(e){return e==="x"?"width":e==="y"?"height":void 0}function zR(e,t){const n=e.fieldDef(t);if(n&&n.bin&&Nc(n.bin)){const r=IO(e,n.field,n.bin),i=LR(t),s=e.getName(i);return new a0(()=>{const f=e.getSignalName(r),v=`(${f}.stop - ${f}.start) / ${f}.step`;return`${e.getSignalName(s)} / (${v})`})}}function RV(e,t){const n=t.specifiedScales[e],{size:r}=t,i=t.getScaleComponent(e).get("type");for(const s of FV)if(n[s]!==void 0){const f=JI(i,s),v=QI(e,s);if(f)if(v)_i(v);else switch(s){case"range":return $o(n.range)&&zv(e)?qy(n.range.map(w=>{if(w==="width"||w==="height"){const O=t.getName(w),N=t.getSignalName.bind(t);return a0.fromName(N,O)}return w})):qy(n.range);case"scheme":return qy(MV(n[s]))}else _i(me.scalePropertyNotWorkWithScaleType(i,s,e))}if(e===Ol||e===Dh){const s=e===Ol?"width":"height",f=r[s];if(Hv(f)){if(Cg(i))return qy({step:f.step});_i(me.stepDropped(s))}}return dv(function(s,f){const{size:v,config:w,mark:O,encoding:N}=f,L=f.getSignalName.bind(f),{type:Y}=Th(N[s]),ie=f.getScaleComponent(s).get("type"),{domain:fe,domainMid:ve}=f.specifiedScales[s];switch(s){case Ol:case Dh:{if(Yo(["point","band"],ie))if(s!==Ol||v.width){if(s===Dh&&!v.height){const Ve=g2(w.view,"height");if(Hv(Ve))return Ve}}else{const Ve=g2(w.view,"width");if(Hv(Ve))return Ve}const Be=LR(s),We=f.getName(Be);return s===Dh&&V0(ie)?[a0.fromName(L,We),0]:[0,a0.fromName(L,We)]}case p1:{const Be=f.component.scales[s].get("zero"),We=function ct(lt,mt,dt){if(mt)return xa(mt)?{signal:`${mt.signal} ? 0 : ${ct(lt,!1,dt)}`}:0;switch(lt){case"bar":case"tick":return dt.scale.minBandSize;case"line":case"trail":case"rule":return dt.scale.minStrokeWidth;case"text":return dt.scale.minFontSize;case"point":case"square":case"circle":return dt.scale.minSize}throw new Error(me.incompatibleChannel("size",lt))}(O,Be,w),Ve=function(ct,lt,mt,dt){const kt={x:zR(mt,"x"),y:zR(mt,"y")};switch(ct){case"bar":case"tick":{if(dt.scale.maxBandSize!==void 0)return dt.scale.maxBandSize;const wt=WR(lt,kt,dt.view);return Gf(wt)?wt-1:new a0(()=>`${wt.signal} - 1`)}case"line":case"trail":case"rule":return dt.scale.maxStrokeWidth;case"text":return dt.scale.maxFontSize;case"point":case"square":case"circle":{if(dt.scale.maxSize)return dt.scale.maxSize;const wt=WR(lt,kt,dt.view);return Gf(wt)?Math.pow(UR*wt,2):new a0(()=>`pow(${UR} * ${wt.signal}, 2)`)}}throw new Error(me.incompatibleChannel("size",ct))}(O,v,f,w);return i_(ie)?function(ct,lt,mt){const dt=()=>{const kt=m2(lt),wt=m2(ct),dn=`(${kt} - ${wt}) / (${mt} - 1)`;return`sequence(${wt}, ${kt} + ${dn}, ${dn})`};return xa(lt)?new a0(dt):{signal:dt()}}(We,Ve,function(ct,lt,mt,dt){switch(ct){case"quantile":return lt.scale.quantileCount;case"quantize":return lt.scale.quantizeCount;case"threshold":return mt!==void 0&&$o(mt)?mt.length+1:(_i(me.domainRequiredForThresholdScale(dt)),3)}}(ie,w,fe,s)):[We,Ve]}case lv:return[0,2*Math.PI];case Ry:return[0,360];case Fv:return[0,new a0(()=>{const Be=f.getSignalName("width"),We=f.getSignalName("height");return`min(${Be},${We})/2`})];case H1:return[w.scale.minStrokeWidth,w.scale.maxStrokeWidth];case G1:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Eg:return"symbol";case _g:case jv:case Bv:return ie==="ordinal"?Y==="nominal"?"category":"ordinal":ve!==void 0?"diverging":O==="rect"||O==="geoshape"?"heatmap":"ramp";case m1:case V1:case q1:return[w.scale.minOpacity,w.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${s}`)}(e,t))}function MV(e){return function(t){return!cs(t)&&!!t.name}(e)?Object.assign({scheme:e.name},u1(e,["name"])):{scheme:e}}const UR=.95;function WR(e,t,n){const r=Hv(e.width)?e.width.step:y_(n,"width"),i=Hv(e.height)?e.height.step:y_(n,"height");return t.x||t.y?new a0(()=>`min(${[t.x?t.x.signal:r,t.y?t.y.signal:i].join(", ")})`):Math.min(r,i)}function VR(e,t){Jl(e)?function(n,r){const i=n.component.scales,{config:s,encoding:f,markDef:v,specifiedScales:w}=n;for(const O of Si(i)){const N=w[O],L=i[O],Y=n.getScaleComponent(O),ie=Th(f[O]),fe=N[r],ve=Y.get("type"),Be=Y.get("padding"),We=Y.get("paddingInner"),Ve=JI(ve,r),ct=QI(O,r);if(fe!==void 0&&(Ve?ct&&_i(ct):_i(me.scalePropertyNotWorkWithScaleType(ve,r,O))),Ve&&ct===void 0)if(fe!==void 0)L.copyKeyFromObject(r,N);else{const lt=r in qR?qR[r]({model:n,channel:O,fieldOrDatumDef:ie,scaleType:ve,scalePadding:Be,scalePaddingInner:We,domain:N.domain,markDef:v,config:s}):s.scale[r];lt!==void 0&&L.set(r,lt,!1)}}}(e,t):GR(e,t)}const qR={bins:({model:e,fieldOrDatumDef:t})=>Vi(t)?function(n,r){const i=r.bin;if(Nc(i)){const s=IO(n,r.field,i);return new a0(()=>n.getSignalName(s))}if(Nm(i)&&c2(i)&&i.step!==void 0)return{step:i.step}}(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>function(n,r){if(Yo([_g,jv,Bv],n)&&r!=="nominal")return"hcl"}(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>function(r,i,s){var f;if(!(((f=qv(s))===null||f===void 0?void 0:f.bin)||Yo([Kf.TIME,Kf.UTC],r)))return i in K1||void 0}(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:r,config:i})=>function(s,f,v,w,O,N){if(s in K1){if(hv(f)){if(v.continuousPadding!==void 0)return v.continuousPadding;const{type:L,orient:Y}=O;if(L==="bar"&&(!Vi(w)||!w.bin&&!w.timeUnit)&&(Y==="vertical"&&s==="x"||Y==="horizontal"&&s==="y"))return N.continuousBandSize}if(f===Kf.POINT)return v.pointPadding}}(e,t,i.scale,n,r,i.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:r})=>function(i,s,f,v){if(i===void 0&&s in K1){const{bandPaddingInner:w,barBandPaddingInner:O,rectBandPaddingInner:N}=v;return $f(w,f==="bar"?O:N)}}(e,t,n.type,r.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:r,scalePaddingInner:i,config:s})=>function(f,v,w,O,N,L){if(f===void 0&&v in K1&&w===Kf.BAND){const{bandPaddingOuter:Y}=L;return $f(Y,xa(N)?{signal:`${N.signal}/2`}:N/2)}}(e,t,n,r.type,i,s.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:r})=>function(i,s,f,v){if(f==="x"&&v.xReverse!==void 0)return V0(i)&&s==="descending"?xa(v.xReverse)?{signal:`!${v.xReverse.signal}`}:!v.xReverse:v.xReverse;if(V0(i)&&s==="descending")return!0}(t,Vi(e)?e.sort:void 0,n,r.scale),zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:r,scaleType:i})=>function(s,f,v,w,O){if(v&&v!=="unaggregated"&&V0(O)){if($o(v)){const N=v[0],L=v[v.length-1];if(N<=0&&L>=0)return!0}return!1}if(s==="size"&&f.type==="quantitative"&&!i_(O))return!0;if((!Vi(f)||!f.bin)&&Yo([...W0,...fL],s)){const{orient:N,type:L}=w;return!Yo(["bar","area","line","trail"],L)||!(N==="horizontal"&&s==="y"||N==="vertical"&&s==="x")}return!1}(e,t,n,r,i)};function HR(e){Jl(e)?function(t){const n=t.component.scales;for(const r of e_){const i=n[r];if(!i)continue;const s=RV(r,t);i.setWithExplicit("range",s)}}(e):GR(e,"range")}function GR(e,t){const n=e.component.scales;for(const r of e.children)t==="range"?HR(r):VR(r,t);for(const r of Si(n)){let i;for(const s of e.children){const f=s.component.scales[r];f&&(i=ty(i,f.getWithExplicit(t),t,"scale",f5((v,w)=>{switch(t){case"range":return v.step&&w.step?v.step-w.step:0}return 0})))}n[r].setWithExplicit(t,i)}}function jV(e,t,n,r){const i=function(f,v,w){var O;switch(v.type){case"nominal":case"ordinal":if(Eb(f)||t_(f)==="discrete")return f==="shape"&&v.type==="ordinal"&&_i(me.discreteChannelCannotEncode(f,"ordinal")),"ordinal";if(f in K1){if(Yo(["rect","bar","image","rule"],w))return"band"}else if(w==="arc"&&f in mA)return"band";return v.band!==void 0||PA(v)&&((O=v.axis)===null||O===void 0?void 0:O.tickBand)?"band":"point";case"temporal":return Eb(f)?"time":t_(f)==="discrete"?(_i(me.discreteChannelCannotEncode(f,"temporal")),"ordinal"):Vi(v)&&v.timeUnit&&Im(v.timeUnit).utc?"utc":"time";case"quantitative":return Eb(f)?Vi(v)&&Nc(v.bin)?"bin-ordinal":"linear":t_(f)==="discrete"?(_i(me.discreteChannelCannotEncode(f,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(me.invalidFieldType(v.type))}(t,n,r),{type:s}=e;return X1(t)?s!==void 0?eF(t,s)?Vi(n)&&!ZI(s,n.type)?(_i(me.scaleTypeNotWorkWithFieldDef(s,i)),i):s:(_i(me.scaleTypeNotWorkWithChannel(t,s,i)),i):i:null}function $R(e){Jl(e)?e.component.scales=function(t){const{encoding:n,mark:r}=t;return e_.reduce((i,s)=>{const f=Th(n[s]);if(f&&r===bI&&s===Eg&&f.type===Sb)return i;let v=f&&f.scale;if(f&&v!==null&&v!==!1){const w=jV(v=v!=null?v:{},s,f,r);i[s]=new PR(t.scaleName(s+"",!0),{value:w,explicit:v.type===w})}return i},{})}(e):e.component.scales=function(t){var n;const r=t.component.scales={},i={},s=t.component.resolve;for(const f of t.children){$R(f);for(const v of Si(f.component.scales))if(s.scale[v]=(n=s.scale[v])!==null&&n!==void 0?n:aV(v,t),s.scale[v]==="shared"){const w=i[v],O=f.component.scales[v].getWithExplicit("type");w?qz(w.value,O.value)?i[v]=ty(w,O,"type","scale",BV):(s.scale[v]="independent",delete i[v]):i[v]=O}}for(const f of Si(i)){const v=t.scaleName(f,!0),w=i[f];r[f]=new PR(v,w);for(const O of t.children){const N=O.component.scales[f];N&&(O.renameScale(N.get("name"),v),N.merged=!0)}}return r}(e)}const BV=f5((e,t)=>KI(e)-KI(t));class UO{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function Jl(e){return(e==null?void 0:e.type)==="unit"}function vv(e){return(e==null?void 0:e.type)==="facet"}function WO(e){return(e==null?void 0:e.type)==="concat"}function Lb(e){return(e==null?void 0:e.type)==="layer"}class VO{constructor(t,n,r,i,s,f,v){var w,O;this.type=n,this.parent=r,this.config=s,this.view=v,this.children=[],this.correctDataNames=N=>(N.from&&N.from.data&&(N.from.data=this.lookupDataSource(N.from.data)),N.from&&N.from.facet&&N.from.facet.data&&(N.from.facet.data=this.lookupDataSource(N.from.facet.data)),N),this.parent=r,this.config=s,this.name=(w=t.name)!==null&&w!==void 0?w:i,this.title=ey(t.title)?{text:t.title}:t.title,this.scaleNameMap=r?r.scaleNameMap:new UO,this.projectionNameMap=r?r.projectionNameMap:new UO,this.signalNameMap=r?r.signalNameMap:new UO,this.data=t.data,this.description=t.description,this.transforms=HU((O=t.transform)!==null&&O!==void 0?O:[]),this.layout=n==="layer"||n==="unit"?{}:function(N,L,Y){var ie,fe;const ve=Y[L],Be={},{spacing:We,columns:Ve}=ve;We!==void 0&&(Be.spacing=We),Ve!==void 0&&(u_(N)&&!h2(N.facet)||QA(N))&&(Be.columns=Ve),v_(N)&&(Be.columns=1);for(const ct of hU)if(N[ct]!==void 0)if(ct==="spacing"){const lt=N[ct];Be[ct]=Gf(lt)?lt:{row:(ie=lt.row)!==null&&ie!==void 0?ie:We,column:(fe=lt.column)!==null&&fe!==void 0?fe:We}}else Be[ct]=N[ct];return Be}(t,n,s),this.component={data:{sources:r?r.component.data.sources:[],outputNodes:r?r.component.data.outputNodes:{},outputNodeRefCounts:r?r.component.data.outputNodeRefCounts:{},isFaceted:u_(t)||r&&r.component.data.isFaceted&&t.data===void 0},layoutSize:new y1,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},f?ls(f):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){(function(t,{ignoreRange:n}={}){$R(t),MR(t);for(const r of Zz)VR(t,r);n||HR(t)})(this)}parseProjection(){DR(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){_R(this)}assembleGroupStyle(){var t,n;if(this.type==="unit"||this.type==="layer")return(n=(t=this.view)===null||t===void 0?void 0:t.style)!==null&&n!==void 0?n:"cell"}assembleEncodeFromView(t){const n=Bo(t,["style"]),r={};for(const i of Si(n)){const s=n[i];s!==void 0&&(r[i]=Ef(s))}return r}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),t||(this.description&&(n.description=Ef(this.description)),this.type!=="unit"&&this.type!=="layer")?bc(n)?void 0:n:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},n!=null?n:{})}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:n}=t,r=Bo(t,["spacing"]),{component:i,config:s}=this,f=function(v,w){const O={};for(const N of U0){const L=v[N];if(L!=null&&L.facetFieldDef){const{titleAnchor:Y,titleOrient:ie}=j_(["titleAnchor","titleOrient"],L.facetFieldDef,w,N),fe=M_(N,ie),ve=oV(Y,fe);ve!==void 0&&(O[fe]=ve)}}return bc(O)?void 0:O}(i.layoutHeaders,s);return Object.assign(Object.assign(Object.assign({padding:n},this.assembleDefaultLayout()),r),f?{titleBand:f}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const r of U0)t[r].title&&n.push(tV(this,r));for(const r of AO)n=n.concat(nV(this,r));return n}assembleAxes(){return function(t,n){const{x:r=[],y:i=[]}=t;return[...r.map(s=>D2(s,"grid",n)),...i.map(s=>D2(s,"grid",n)),...r.map(s=>D2(s,"main",n)),...i.map(s=>D2(s,"main",n))].filter(s=>s)}(this.component.axes,this.config)}assembleLegends(){return AR(this)}assembleProjections(){return pV(this)}assembleTitle(){var t,n,r;const i=(t=this.title)!==null&&t!==void 0?t:{},{encoding:s}=i,f=Bo(i,["encoding"]),v=Object.assign(Object.assign(Object.assign({},CF(this.config.title).nonMark),f),s?{encode:{update:s}}:{});if(v.text)return Yo(["unit","layer"],this.type)?Yo(["middle",void 0],v.anchor)&&(v.frame=(n=v.frame)!==null&&n!==void 0?n:"group"):v.anchor=(r=v.anchor)!==null&&r!==void 0?r:"start",bc(v)?void 0:v}assembleGroup(t=[]){const n={};(t=t.concat(this.assembleSignals())).length>0&&(n.signals=t);const r=this.assembleLayout();r&&(n.layout=r),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const i=!this.parent||vv(this.parent)?function v(w){return Lb(w)||WO(w)?w.children.reduce((O,N)=>O.concat(v(N)),BR(w)):BR(w)}(this):[];i.length>0&&(n.scales=i);const s=this.assembleAxes();s.length>0&&(n.axes=s);const f=this.assembleLegends();return f.length>0&&(n.legends=f),n}getName(t){return dl((this.name?this.name+"_":"")+t)}requestDataName(t){var n;const r=this.getName(t),i=this.component.data.outputNodeRefCounts;return i[r]=((n=i[r])!==null&&n!==void 0?n:0)+1,r}getSizeSignalRef(t){if(vv(this.parent)){const n=Zk(pR(t)),r=this.component.scales[n];if(r&&!r.merged){const i=r.get("type"),s=r.get("range");if(Cg(i)&&Y1(s)){const f=r.get("name"),v=zO(z_(this,n));return v?{signal:dR(f,r,Fi({aggregate:"distinct",field:v},{expr:"datum"}))}:(_i(`Unknown field for ${n}. Cannot calculate view size.`),null)}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){return n?this.getName(t):DI(t)&&X1(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t))?this.scaleNameMap.get(this.getName(t)):void 0}projectionName(t){return t?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let r=this.component.selection[t];if(!r&&this.parent&&(r=this.parent.getSelectionComponent(t,n)),!r)throw new Error(me.selectionNotFound(n));return r}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)===null||t===void 0?void 0:t.some(r=>r.hasOrientSignalRef()))||((n=this.component.axes.y)===null||n===void 0?void 0:n.some(r=>r.hasOrientSignalRef()))}}class KR extends VO{vgField(t,n={}){const r=this.fieldDef(t);if(r)return Fi(r,n)}reduceFieldDef(t,n){return FF(this.getMapping(),(r,i,s)=>{const f=qv(i);return f?t(r,f,s):r},n)}forEachFieldDef(t,n){qA(this.getMapping(),(r,i)=>{const s=qv(r);s&&t(s,i)},n)}}class U_ extends oc{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=ls(n);const f=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=f[0])!==null&&i!==void 0?i:"value",(s=f[1])!==null&&s!==void 0?s:"density"]}clone(){return new U_(null,ls(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${Zs(this.transform)}`}assemble(){const t=this.transform,{density:n}=t,r=Bo(t,["density"]);return Object.assign({type:"kde",field:n},r)}}class I2 extends oc{constructor(t,n){super(t),this.filter=n}clone(){return new I2(null,Object.assign({},this.filter))}static make(t,n){const{config:r,mark:i,markDef:s}=n;if(Ou("invalid",s,r)!=="filter")return null;const f=n.reduceFieldDef((v,w,O)=>{const N=X1(O)&&n.getScaleComponent(O);return N&&V0(N.get("type"))&&w.aggregate!=="count"&&!Iy(i)&&(v[w.field]=w),v},{});return Si(f).length?new I2(t,f):null}dependentFields(){return new Set(Si(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${Zs(this.filter)}`}assemble(){const t=Si(this.filter).reduce((n,r)=>{const i=this.filter[r],s=Fi(i,{expr:"datum"});return i!==null&&(i.type==="temporal"?n.push(`(isDate(${s}) || (isValid(${s}) && isFinite(+${s})))`):i.type==="quantitative"&&(n.push(`isValid(${s})`),n.push(`isFinite(+${s})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class W_ extends oc{constructor(t,n){super(t),this.transform=n,this.transform=ls(n);const{flatten:r,as:i=[]}=this.transform;this.transform.as=r.map((s,f)=>{var v;return(v=i[f])!==null&&v!==void 0?v:s})}clone(){return new W_(this.parent,ls(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${Zs(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform;return{type:"flatten",fields:t,as:n}}}class V_ extends oc{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=ls(n);const f=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=f[0])!==null&&i!==void 0?i:"key",(s=f[1])!==null&&s!==void 0?s:"value"]}clone(){return new V_(null,ls(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${Zs(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform;return{type:"fold",fields:t,as:n}}}class zb extends oc{constructor(t,n,r,i){super(t),this.fields=n,this.geojson=r,this.signal=i}clone(){return new zb(null,ls(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let r=0;for(const i of[[Mv,Rv],[z0,fv]]){const s=i.map(f=>{const v=Th(n.encoding[f]);return Vi(v)?v.field:Z1(v)?{expr:`${v.datum}`}:g1(v)?{expr:`${v.value}`}:void 0});(s[0]||s[1])&&(t=new zb(t,s,null,n.getName(`geojson_${r++}`)))}if(n.channelHasField(Eg)){const i=n.typedFieldDef(Eg);i.type===Sb&&(t=new zb(t,null,i.field,n.getName(`geojson_${r++}`)))}return t}dependentFields(){var t;const n=((t=this.fields)!==null&&t!==void 0?t:[]).filter(cs);return new Set([...this.geojson?[this.geojson]:[],...n])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${Zs(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class F2 extends oc{constructor(t,n,r,i){super(t),this.projection=n,this.fields=r,this.as=i}clone(){return new F2(null,this.projection,ls(this.fields),ls(this.as))}static parseAll(t,n){if(!n.projectionName())return t;for(const r of[[Mv,Rv],[z0,fv]]){const i=r.map(f=>{const v=Th(n.encoding[f]);return Vi(v)?v.field:Z1(v)?{expr:`${v.datum}`}:g1(v)?{expr:`${v.value}`}:void 0}),s=r[0]===z0?"2":"";(i[0]||i[1])&&(t=new F2(t,n.projectionName(),i,[n.getName("x"+s),n.getName("y"+s)]))}return t}dependentFields(){return new Set(this.fields.filter(cs))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${Zs(this.fields)} ${Zs(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Qy extends oc{constructor(t,n){super(t),this.transform=n}clone(){return new Qy(null,ls(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:r,step:i}=t;return{signal:`sequence(${[n,r,...i?[i]:[]].join(",")})`}}static makeFromTransform(t,n){return new Qy(t,n)}static makeFromEncoding(t,n){const r=n.encoding,i=r.x,s=r.y;if(Vi(i)&&Vi(s)){const f=i.impute?i:s.impute?s:void 0;if(f===void 0)return;const v=i.impute?s:s.impute?i:void 0,{method:w,value:O,frame:N,keyvals:L}=f.impute,Y=RF(n.mark,r);return new Qy(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:f.field,key:v.field},w?{method:w}:{}),O!==void 0?{value:O}:{}),N?{frame:N}:{}),L!==void 0?{keyvals:L}:{}),Y.length?{groupby:Y}:{}))}return null}hash(){return`Impute ${Zs(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:r,method:i,groupby:s,value:f,frame:v=[null,null]}=this.transform,w=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:n},r?{keyvals:function(O){return(O==null?void 0:O.stop)!==void 0}(r)?this.processSequence(r):r}:{}),{method:"value"}),s?{groupby:s}:{}),{value:i&&i!=="value"?null:f});return i&&i!=="value"?[w,Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[i],fields:[t],frame:v,ignorePeers:!1},s?{groupby:s}:{}),{type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t}]:[w]}}class q_ extends oc{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=ls(n);const f=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=f[0])!==null&&i!==void 0?i:n.on,(s=f[1])!==null&&s!==void 0?s:n.loess]}clone(){return new q_(null,ls(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${Zs(this.transform)}`}assemble(){const t=this.transform,{loess:n,on:r}=t,i=Bo(t,["loess","on"]);return Object.assign({type:"loess",x:r,y:n},i)}}class R2 extends oc{constructor(t,n,r){super(t),this.transform=n,this.secondary=r}clone(){return new R2(null,ls(this.transform),this.secondary)}static make(t,n,r,i){const s=n.component.data.sources,{from:f}=r;let v=null;if(function(w){return"data"in w}(f)){let w=QR(f.data,s);w||(w=new jb(f.data),s.push(w));const O=n.getName(`lookup_${i}`);v=new Fm(w,O,"lookup",n.component.data.outputNodeRefCounts),n.component.data.outputNodes[O]=v}else if(function(w){return"selection"in w}(f)){const w=f.selection;if(r=Object.assign({as:w},r),!(v=n.getSelectionComponent(dl(w),w).materialized))throw new Error(me.noSameUnitLookup(w))}return new R2(t,r,v.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?_f(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${Zs({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:_f(this.transform.as)}:{});else{let n=this.transform.as;cs(n)||(_i(me.NO_FIELDS_NEEDS_AS),n="_lookup"),t={as:[n]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}class H_ extends oc{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=ls(n);const f=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=f[0])!==null&&i!==void 0?i:"prob",(s=f[1])!==null&&s!==void 0?s:"value"]}clone(){return new H_(null,ls(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${Zs(this.transform)}`}assemble(){const t=this.transform,{quantile:n}=t,r=Bo(t,["quantile"]);return Object.assign({type:"quantile",field:n},r)}}class G_ extends oc{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=ls(n);const f=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=f[0])!==null&&i!==void 0?i:n.on,(s=f[1])!==null&&s!==void 0?s:n.regression]}clone(){return new G_(null,ls(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${Zs(this.transform)}`}assemble(){const t=this.transform,{regression:n,on:r}=t,i=Bo(t,["regression","on"]);return Object.assign({type:"regression",x:r,y:n},i)}}class $_ extends oc{constructor(t,n){super(t),this.transform=n}clone(){return new $_(null,ls(this.transform))}addDimensions(t){var n;this.transform.groupby=L1(((n=this.transform.groupby)!==null&&n!==void 0?n:[]).concat(t),r=>r)}producedFields(){}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}hash(){return`PivotTransform ${Zs(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:r,limit:i,op:s}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:n},i!==void 0?{limit:i}:{}),s!==void 0?{op:s}:{}),r!==void 0?{groupby:r}:{})}}class K_ extends oc{constructor(t,n){super(t),this.transform=n}clone(){return new K_(null,ls(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${Zs(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function XR(e){let t=0;return function n(r,i){var s;if(r instanceof jb&&!r.isGenerator&&!v2(r.data)&&(e.push(i),i={name:null,source:i.name,transform:[]}),r instanceof jp&&(r.parent instanceof jb&&!i.source?(i.format=Object.assign(Object.assign({},(s=i.format)!==null&&s!==void 0?s:{}),{parse:r.assembleFormatParse()}),i.transform.push(...r.assembleTransforms(!0))):i.transform.push(...r.assembleTransforms())),r instanceof Bb){i.name||(i.name=`data_${t++}`),!i.source||i.transform.length>0?(e.push(i),r.data=i.name):r.data=i.source;for(const f of r.assemble())e.push(f)}else switch((r instanceof T2||r instanceof N2||r instanceof I2||r instanceof Ib||r instanceof Fb||r instanceof F2||r instanceof zb||r instanceof mv||r instanceof R2||r instanceof Pb||r instanceof Jy||r instanceof V_||r instanceof W_||r instanceof U_||r instanceof q_||r instanceof H_||r instanceof G_||r instanceof oy||r instanceof K_||r instanceof $_)&&i.transform.push(r.assemble()),(r instanceof Kv||r instanceof Gv||r instanceof Qy||r instanceof _1)&&i.transform.push(...r.assemble()),r instanceof Fm&&(i.source&&i.transform.length===0?r.setSource(i.source):r.parent instanceof Fm?r.setSource(i.name):(i.name||(i.name=`data_${t++}`),r.setSource(i.name),r.numChildren()===1&&(e.push(i),i={name:null,source:i.name,transform:[]}))),r.numChildren()){case 0:r instanceof Fm&&(!i.source||i.transform.length>0)&&e.push(i);break;case 1:n(r.children[0],i);break;default:{i.name||(i.name=`data_${t++}`);let f=i.name;!i.source||i.transform.length>0?e.push(i):f=i.source;for(const v of r.children)n(v,{name:null,source:f,transform:[]});break}}}}function PV(e){return e==="top"||e==="left"||xa(e)?"header":"footer"}function LV(e,t){var n;const{facet:r,config:i,child:s,component:f}=e;if(e.channelHasField(t)){const v=r[t],w=Mb("title",null,i,t);let O=zy(v,i,{allowDisabling:!0,includeDefault:w===void 0||!!w});s.component.layoutHeaders[t].title&&(O=$o(O)?O.join(", "):O,O+=" / "+s.component.layoutHeaders[t].title,s.component.layoutHeaders[t].title=null);const N=Mb("labelOrient",v,i,t),L=$f(((n=v.header)!==null&&n!==void 0?n:{}).labels,i.header.labels,!0),Y=Yo(["bottom","right"],N)?"footer":"header";f.layoutHeaders[t]={title:O,facetFieldDef:v,[Y]:t==="facet"?[]:[YR(e,t,L)]}}}function YR(e,t,n){const r=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(r)?e.child.getSizeSignalRef(r):void 0,axes:[]}}function JR(e,t){var n;const{child:r}=e;if(r.component.axes[t]){const{layoutHeaders:i,resolve:s}=e.component;if(s.axis[t]=TO(s,t),s.axis[t]==="shared"){const f=t==="x"?"column":"row",v=i[f];for(const w of r.component.axes[t]){const O=PV(w.get("orient"));v[O]=(n=v[O])!==null&&n!==void 0?n:[YR(e,f,!1)];const N=D2(w,"main",e.config,{header:!0});N&&v[O][0].axes.push(N),w.mainExtracted=!0}}}}function zV(e){qO(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";X_(e,t),X_(e,n)}function qO(e){for(const t of e.children)t.parseLayoutSize()}function X_(e,t){const n=pR(t),r=Zk(n),i=e.component.resolve,s=e.component.layoutSize;let f;for(const v of e.children){const w=v.component.layoutSize.getWithExplicit(n),O=i.scale[r];if(O==="independent"&&w.value==="step"){f=void 0;break}if(f){if(O==="independent"&&f.value!==w.value){f=void 0;break}f=ty(f,w,n,"")}else f=w}if(f){for(const v of e.children)e.renameSignal(v.getName(n),e.getName(t)),v.component.layoutSize.set(n,"merged",!1);s.setWithExplicit(t,f)}else s.setWithExplicit(t,{explicit:!1,value:void 0})}function UV(e,t){const n=t==="width"?"x":"y",r=e.config,i=e.getScaleComponent(n);if(i){const s=i.get("type"),f=i.get("range");if(Cg(s)){const v=g2(r.view,t);return Y1(f)||Hv(v)?"step":v}return eO(r.view,t)}if(e.hasProjection||e.mark==="arc")return eO(r.view,t);{const s=g2(r.view,t);return Hv(s)?s.step:s}}function HO(e,t,n){return Fi(t,Object.assign({suffix:`by_${Fi(e)}`},n!=null?n:{}))}class M2 extends KR{constructor(t,n,r,i){super(t,"facet",n,r,i,t.resolve),this.child=XO(t.spec,this,this.getName("child"),void 0,i),this.children=[this.child],this.facet=this.initFacet(t.facet,i)}initFacet(t,n){return h2(t)?FF(t,(r,i,s)=>Yo([l1,f1],s)?i.field===void 0?(_i(me.emptyFieldDef(i,s)),r):(r[s]=zA(i,s,n),r):(_i(me.incompatibleChannel(s,"facet")),r),{}):{facet:zA(t,"facet",n)}}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=Y_(this),this.child.parseData()}parseLayoutSize(){qO(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(t){for(const n of U0)LV(t,n);JR(t,"x"),JR(t,"y")}(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,n,r;const i={};for(const s of U0)for(const f of OO){const v=this.component.layoutHeaders[s],w=v[f],{facetFieldDef:O}=v;if(O){const N=Mb("titleOrient",O,this.config,s);if(Yo(["right","bottom"],N)){const L=M_(s,N);i.titleAnchor=(t=i.titleAnchor)!==null&&t!==void 0?t:{},i.titleAnchor[L]="end"}}if(w!=null&&w[0]){const N=s==="row"?"height":"width",L=f==="header"?"headerBand":"footerBand";s==="facet"||this.child.component.layoutSize.get(N)||(i[L]=(n=i[L])!==null&&n!==void 0?n:{},i[L][s]=.5),v.title&&(i.offset=(r=i.offset)!==null&&r!==void 0?r:{},i.offset[s==="row"?"rowTitle":"columnTitle"]=10)}}return i}assembleDefaultLayout(){const{column:t,row:n}=this.facet,r=t?this.columnDistinctSignal():n?1:void 0;let i="all";return(n||this.component.resolve.scale.x!=="independent")&&(t||this.component.resolve.scale.y!=="independent")||(i="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),r?{columns:r}:{}),{bounds:"full",align:i})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof M2))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroup(t){return this.parent&&this.parent instanceof M2?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:Fi(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],r=[];if(this.child instanceof M2){if(this.child.channelHasField("column")){const i=Fi(this.child.facet.column);t.push(i),n.push("distinct"),r.push(`distinct_${i}`)}}else for(const i of W0){const s=this.child.component.scales[i];if(s&&!s.merged){const f=s.get("type"),v=s.get("range");if(Cg(f)&&Y1(v)){const w=zO(z_(this.child,i));w?(t.push(w),n.push("distinct"),r.push(`distinct_${w}`)):_i(`Unknown field for ${i}. Cannot calculate view size.`)}}}return{fields:t,ops:n,as:r}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:r,column:i}=this.facet,{fields:s,ops:f,as:v}=this.getCardinalityAggregateForChild(),w=[];for(const N of U0){const L=this.facet[N];if(L){w.push(Fi(L));const{bin:Y,sort:ie}=L;if(Nc(Y)&&w.push(Fi(L,{binSuffix:"end"})),Wv(ie)){const{field:fe,op:ve=s_}=ie,Be=HO(L,ie);r&&i?(s.push(Be),f.push("max"),v.push(Be)):(s.push(fe),f.push(ve),v.push(Be))}else if($o(ie)){const fe=Rb(L,N);s.push(fe),f.push("max"),v.push(fe)}}}const O=!!r&&!!i;return Object.assign({name:t,data:n,groupby:w},O||s.length>0?{aggregate:Object.assign(Object.assign({},O?{cross:O}:{}),s.length?{fields:s,ops:f,as:v}:{})}:{})}facetSortFields(t){const{facet:n}=this,r=n[t];return r?Wv(r.sort)?[HO(r,r.sort,{expr:"datum"})]:$o(r.sort)?[Rb(r,t,{expr:"datum"})]:[Fi(r,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,r=n[t];if(r){const{sort:i}=r;return[(Wv(i)?i.order:!$o(i)&&i)||"ascending"]}return[]}assembleLabelTitle(){const{facet:t,config:n}=this;if(t.facet)return SO(t.facet,"facet",n);const r={row:["top","bottom"],column:["left","right"]};for(const i of AO)if(t[i]){const s=Mb("labelOrient",t[i],n,i);if(Yo(r[i],s))return SO(t[i],i,n)}}assembleMarks(){const{child:t}=this,n=function(f){const v=[],w=XR(v);for(const O of f.children)w(O,{source:f.name,name:null,transform:[]});return v}(this.component.data.facetRoot),r=t.assembleGroupEncodeEntry(!1),i=this.assembleLabelTitle()||t.assembleTitle(),s=t.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},i?{title:i}:{}),s?{style:s}:{}),{from:{facet:this.assembleFacet()},sort:{field:U0.map(f=>this.facetSortFields(f)).flat(),order:U0.map(f=>this.facetSortOrder(f)).flat()}}),n.length>0?{data:n}:{}),r?{encode:{update:r}}:{}),t.assembleGroup(function(f,v){if(f.component.selection&&Si(f.component.selection).length){const w=Ws(f.getName("cell"));v.unshift({name:"facet",value:{},on:[{events:Sy("mousemove","scope"),update:`isTuple(facet) ? facet : group(${w}).datum`}]})}return fO(v)}(this,[])))]}getMapping(){return this.facet}}function QR(e,t){var n,r,i,s,f,v,w,O,N,L;for(const Y of t){const ie=Y.data;if((!e.name||!Y.hasName()||e.name===Y.dataName)&&!(((n=e.format)===null||n===void 0?void 0:n.mesh)&&((r=ie.format)===null||r===void 0?void 0:r.feature)||(((i=e.format)===null||i===void 0?void 0:i.feature)||((s=ie.format)===null||s===void 0?void 0:s.feature))&&((f=e.format)===null||f===void 0?void 0:f.feature)!==((v=ie.format)===null||v===void 0?void 0:v.feature)||(((w=e.format)===null||w===void 0?void 0:w.mesh)||((O=ie.format)===null||O===void 0?void 0:O.mesh))&&((N=e.format)===null||N===void 0?void 0:N.mesh)!==((L=ie.format)===null||L===void 0?void 0:L.mesh))){if(w_(e)&&w_(ie)){if(t2(e.values,ie.values))return Y}else if(v2(e)&&v2(ie)){if(e.url===ie.url)return Y}else if(h5(e)&&e.name===Y.dataName)return Y}}return null}function WV(e,t){if(e.data||!e.parent){if(e.data===null){const r=new jb({values:[]});return t.push(r),r}const n=QR(e.data,t);if(n)return Hy(e.data)||(n.data.format=function(r,...i){for(const s of i)UP(r,s!=null?s:{});return r}({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const r=new jb(e.data);return t.push(r),r}}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function Y_(e){var t,n,r,i,s,f,v,w,O,N;let L=WV(e,e.component.data.sources);const{outputNodes:Y,outputNodeRefCounts:ie}=e.component.data,fe=e.parent?e.parent.component.data.ancestorParse.clone():new OU,ve=e.data;Hy(ve)?(d5(ve)?L=new N2(L,ve.sequence):oO(ve)&&(L=new T2(L,ve.graticule)),fe.parseNothing=!0):((t=ve==null?void 0:ve.format)===null||t===void 0?void 0:t.parse)===null&&(fe.parseNothing=!0),L=(n=jp.makeExplicit(L,e,fe))!==null&&n!==void 0?n:L,L=new oy(L);const Be=e.parent&&Lb(e.parent);(Jl(e)||vv(e))&&Be&&(L=(r=Kv.makeFromEncoding(L,e))!==null&&r!==void 0?r:L),e.transforms.length>0&&(L=function(wt,dn,Dn){var wn,Xn;let Kn=0;for(const ir of dn.transforms){let sr,gr;if(PU(ir))sr=wt=new Fb(wt,ir),gr="derived";else if(m5(ir)){const Vr=vV(ir);sr=wt=(wn=jp.makeWithAncestors(wt,{},Vr,Dn))!==null&&wn!==void 0?wn:wt,wt=new Ib(wt,dn,ir.filter)}else if(LU(ir))sr=wt=Kv.makeFromTransform(wt,ir,dn),gr="number";else if(UU(ir))gr="date",Dn.getWithExplicit(ir.field).value===void 0&&(wt=new jp(wt,{[ir.field]:gr}),Dn.set(ir.field,gr,!1)),sr=wt=Gv.makeFromTransform(wt,ir);else if(WU(ir))sr=wt=mv.makeFromTransform(wt,ir),gr="number",dO(dn)&&(wt=new oy(wt));else if(SU(ir))sr=wt=R2.make(wt,dn,ir,Kn++),gr="derived";else if(MU(ir))sr=wt=new Pb(wt,ir),gr="number";else if(jU(ir))sr=wt=new Jy(wt,ir),gr="number";else if(VU(ir))sr=wt=_1.makeFromTransform(wt,ir),gr="derived";else if(qU(ir))sr=wt=new V_(wt,ir),gr="derived";else if(BU(ir))sr=wt=new W_(wt,ir),gr="derived";else if(DU(ir))sr=wt=new $_(wt,ir),gr="derived";else if(RU(ir))wt=new K_(wt,ir);else if(zU(ir))sr=wt=Qy.makeFromTransform(wt,ir),gr="derived";else if(TU(ir))sr=wt=new U_(wt,ir),gr="derived";else if(NU(ir))sr=wt=new H_(wt,ir),gr="derived";else if(IU(ir))sr=wt=new G_(wt,ir),gr="derived";else{if(!FU(ir)){_i(me.invalidTransformIgnored(ir));continue}sr=wt=new q_(wt,ir),gr="derived"}if(sr&&gr!==void 0)for(const Vr of(Xn=sr.producedFields())!==null&&Xn!==void 0?Xn:[])Dn.set(Vr,gr,!1)}return wt}(L,e,fe));const We=function(wt){const dn={};if(Jl(wt)&&wt.component.selection)for(const Dn of Si(wt.component.selection)){const wn=wt.component.selection[Dn];for(const Xn of wn.project.items)!Xn.channel&&o2(Xn.field)>1&&(dn[Xn.field]="flatten")}return dn}(e),Ve=yV(e);L=(i=jp.makeWithAncestors(L,{},Object.assign(Object.assign({},We),Ve),fe))!==null&&i!==void 0?i:L,Jl(e)&&(L=zb.parseAll(L,e),L=F2.parseAll(L,e)),(Jl(e)||vv(e))&&(Be||(L=(s=Kv.makeFromEncoding(L,e))!==null&&s!==void 0?s:L),L=(f=Gv.makeFromEncoding(L,e))!==null&&f!==void 0?f:L,L=Fb.parseAllForSortIndex(L,e));const ct=e.getName(k_),lt=new Fm(L,ct,k_,ie);if(Y[ct]=lt,L=lt,Jl(e)){const wt=mv.makeFromEncoding(L,e);wt&&(L=wt,dO(e)&&(L=new oy(L))),L=(v=Qy.makeFromEncoding(L,e))!==null&&v!==void 0?v:L,L=(w=_1.makeFromEncoding(L,e))!==null&&w!==void 0?w:L}Jl(e)&&(L=(O=I2.make(L,e))!==null&&O!==void 0?O:L);const mt=e.getName(Np),dt=new Fm(L,mt,Np,ie);Y[mt]=dt,L=dt,Jl(e)&&function(wt,dn){$y(wt,Dn=>{const wn=Dn.name,Xn=wt.getName(`lookup_${wn}`);wt.component.data.outputNodes[Xn]=Dn.materialized=new Fm(new Ib(dn,wt,{selection:wn}),Xn,"lookup",wt.component.data.outputNodeRefCounts)})}(e,dt);let kt=null;if(vv(e)){const wt=e.getName("facet");L=(N=function(dn,Dn){const{row:wn,column:Xn}=Dn;if(wn&&Xn){let Kn=null;for(const ir of[wn,Xn])if(Wv(ir.sort)){const{field:sr,op:gr=s_}=ir.sort;dn=Kn=new Jy(dn,{joinaggregate:[{op:gr,field:sr,as:HO(ir,ir.sort,{forAs:!0})}],groupby:[Fi(ir)]})}return Kn}return null}(L,e.facet))!==null&&N!==void 0?N:L,kt=new Bb(L,e,wt,dt.getSource()),Y[wt]=kt}return Object.assign(Object.assign({},e.component.data),{outputNodes:Y,outputNodeRefCounts:ie,raw:lt,main:dt,facetRoot:kt,ancestorParse:fe})}class VV extends VO{constructor(t,n,r,i){var s,f,v,w;super(t,"concat",n,r,i,t.resolve),((f=(s=t.resolve)===null||s===void 0?void 0:s.axis)===null||f===void 0?void 0:f.x)!=="shared"&&((w=(v=t.resolve)===null||v===void 0?void 0:v.axis)===null||w===void 0?void 0:w.y)!=="shared"||_i(me.CONCAT_CANNOT_SHARE_AXIS),this.children=this.getChildren(t).map((O,N)=>XO(O,this,this.getName("concat_"+N),void 0,i))}parseData(){this.component.data=Y_(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of Si(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return v_(t)?t.vconcat:ZA(t)?t.hconcat:t.concat}parseLayoutSize(){zV(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,r)=>r.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=DO(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,r)=>r.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),r=t.assembleGroupStyle(),i=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},n?{title:n}:{}),r?{style:r}:{}),i?{encode:{update:i}}:{}),t.assembleGroup())})}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},t!=null?{columns:t}:{}),{bounds:"full",align:"each"})}}const qV=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},mI),{labelExpr:1,encode:1}),ZR=Si(qV);class GO extends y1{constructor(t={},n={},r=!1){super(),this.explicit=t,this.implicit=n,this.mainExtracted=r}clone(){return new GO(ls(this.explicit),ls(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"||(t==="grid"||t==="title"?!!this.get(t):!function(n){return n===!1||n===null}(this.get(t)))}hasOrientSignalRef(){return xa(this.explicit.orient)}}function HV(e){return W0.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[function(r,i){var s,f,v;let w=i.axis(r);const O=new GO,N=Th(i.encoding[r]),{mark:L,config:Y}=i,ie=(w==null?void 0:w.orient)||((s=Y[r==="x"?"axisX":"axisY"])===null||s===void 0?void 0:s.orient)||((f=Y.axis)===null||f===void 0?void 0:f.orient)||function(mt){return mt==="x"?"bottom":"left"}(r),fe=i.getScaleComponent(r).get("type"),ve=eV(r,fe,ie,i.config),Be=w!==void 0?!w:EO("disable",Y,w==null?void 0:w.style,ve).configValue;if(O.set("disable",Be,w!==void 0),Be)return O;const We=function(mt,dt,kt,wt,dn){const Dn=dt==null?void 0:dt.labelAngle;if(Dn!==void 0)return xa(Dn)?Dn:Uk(Dn);{const{configValue:wn}=EO("labelAngle",mt.config,dt==null?void 0:dt.style,dn);return wn!==void 0?Uk(wn):kt===Ol&&Yo([AA,CA],wt.type)?270:void 0}}(i,w=w||{},r,N,ve),Ve={fieldOrDatumDef:N,axis:w,channel:r,model:i,scaleType:fe,orient:ie,labelAngle:We,mark:L,config:Y};for(const mt of ZR){const dt=mt in oR?oR[mt](Ve):gI(mt)?w[mt]:void 0,kt=dt!==void 0,wt=XV(dt,mt,w,i,r);if(kt&&wt)O.set(mt,dt,wt);else{const{configValue:dn,configFrom:Dn}=gI(mt)&&mt!=="values"?EO(mt,i.config,w.style,ve):{},wn=dn!==void 0;kt&&!wn?O.set(mt,dt,wt):(Dn!=="vgAxisConfig"||YV.has(mt)&&wn||sA(dn)||xa(dn))&&O.set(mt,dn,!1)}}const ct=(v=w.encoding)!==null&&v!==void 0?v:{},lt=pI.reduce((mt,dt)=>{var kt;if(!O.hasAxisPart(dt))return mt;const wt=mR((kt=ct[dt])!==null&&kt!==void 0?kt:{},i),dn=dt==="labels"?function(Dn,wn,Xn){var Kn;const{encoding:ir,config:sr}=Dn,gr=(Kn=Th(ir[wn]))!==null&&Kn!==void 0?Kn:Th(ir[Pv(wn)]),Vr=Dn.axis(wn)||{},{format:hi,formatType:Qr}=Vr;return Ly(Qr)?Object.assign({text:NA({fieldOrDatumDef:gr,field:"datum.value",format:hi,formatType:Qr,config:sr})},Xn):Xn}(i,r,wt):wt;return dn===void 0||bc(dn)||(mt[dt]={update:dn}),mt},{});return bc(lt)||O.set("encode",lt,!!w.encoding||w.labelAngle!==void 0),O}(n,e)]),t),{})}const GV={bottom:"top",top:"bottom",left:"right",right:"left"};function $V(e,t){if(!e)return t.map(n=>n.clone());{if(e.length!==t.length)return;const n=e.length;for(let r=0;r<n;r++){const i=e[r],s=t[r];if(!!i!=!!s)return;if(i&&s){const f=i.getWithExplicit("orient"),v=s.getWithExplicit("orient");if(f.explicit&&v.explicit&&f.value!==v.value)return;e[r]=KV(i,s)}}}return e}function KV(e,t){for(const n of ZR){const r=ty(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(i,s)=>{switch(n){case"title":return IF(i,s);case"gridScale":return{explicit:i.explicit,value:$f(i.value,s.value)}}return x_(i,s,n,"axis")});e.setWithExplicit(n,r)}return e}function XV(e,t,n,r,i){if(t==="disable")return n!==void 0;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(xa(n.labelAngle)?n.labelAngle:Uk(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===uR(r,i))return!0}return e===n[t]}const YV=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function JV(e,t,n,{graticule:r}){const i=Nv(e)?Object.assign({},e):{type:e},s=Ou("orient",i,n);if(i.orient=function(f,v,w){switch(f){case Hk:case cA:case lA:case yI:case KP:case $P:return}const{x:O,y:N,x2:L,y2:Y}=v;switch(f){case Vk:if(Vi(O)&&(Nm(O.bin)||Vi(N)&&N.aggregate&&!O.aggregate))return"vertical";if(Vi(N)&&(Nm(N.bin)||Vi(O)&&O.aggregate&&!N.aggregate))return"horizontal";if(Y||L){if(w)return w;if(!L&&(Vi(O)&&O.type===By&&!Nc(O.bin)||jA(O)))return"horizontal";if(!Y&&(Vi(N)&&N.type===By&&!Nc(N.bin)||jA(N)))return"vertical"}case Gk:if(L&&(!Vi(O)||!Nm(O.bin))&&Y&&(!Vi(N)||!Nm(N.bin)))return;case Wk:if(Y)return Vi(N)&&Nm(N.bin)?"horizontal":"vertical";if(L)return Vi(O)&&Nm(O.bin)?"vertical":"horizontal";if(f===Gk){if(O&&!N)return"vertical";if(N&&!O)return"horizontal"}case qk:case uA:{const ie=Vv(O),fe=Vv(N);if(ie&&!fe)return f!=="tick"?"horizontal":"vertical";if(!ie&&fe)return f!=="tick"?"vertical":"horizontal";if(ie&&fe){const ve=O,Be=N,We=ve.type===Ob,Ve=Be.type===Ob;return We&&!Ve?f!=="tick"?"vertical":"horizontal":!We&&Ve?f!=="tick"?"horizontal":"vertical":!ve.aggregate&&Be.aggregate?f!=="tick"?"vertical":"horizontal":ve.aggregate&&!Be.aggregate?f!=="tick"?"horizontal":"vertical":w||"vertical"}return w||void 0}}return"vertical"}(i.type,t,s),s!==void 0&&s!==i.orient&&_i(me.orientOverridden(i.orient,s)),i.type==="bar"&&i.orient){const f=Ou("cornerRadiusEnd",i,n);if(f!==void 0){const v=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:JP[i.orient];for(const w of v)i[w]=f;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}return Ou("opacity",i,n)===void 0&&(i.opacity=function(f,v){if(Yo([Hk,uA,cA,lA],f)&&!WA(v))return .7}(i.type,t)),i.filled===void 0&&(i.filled=!r&&function(f,v){const w=Wy("filled",f,v),O=f.type;return $f(w,O!==Hk&&O!==qk&&O!==Gk)}(i,n)),Ou("cursor",i,n)===void 0&&(i.cursor=function(f,v,w){return v.href||f.href||Ou("href",f,w)?"pointer":f.cursor}(i,t,n)),i}function $O(e,t){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},q0(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Ip("x",e,{defaultPos:"mid"})),Ip("y",e,{defaultPos:"mid"})),gd("size",e)),gd("angle",e)),function(n,r,i){return i?{shape:{value:i}}:gd("shape",n)}(e,0,t))}const J_={arc:{vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},q0(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Ip("x",e,{defaultPos:"mid"})),Ip("y",e,{defaultPos:"mid"})),ny(e,"radius","arc")),ny(e,"theta","arc"))},area:{vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},q0(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),C_("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),C_("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),uO(e))},bar:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},q0(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),ny(e,"x","bar")),ny(e,"y","bar"))},circle:{vgMark:"symbol",encodeEntry:e=>$O(e,"circle")},geoshape:{vgMark:"shape",encodeEntry:e=>Object.assign({},q0(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&Vi(n)&&n.type===Sb?{field:Fi(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},q0(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),ny(e,"x","image")),ny(e,"y","image")),aO(e,"url"))},line:{vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},q0(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Ip("x",e,{defaultPos:"mid"})),Ip("y",e,{defaultPos:"mid"})),gd("size",e,{vgChannel:"strokeWidth"})),uO(e))},point:{vgMark:"symbol",encodeEntry:e=>$O(e)},rect:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},q0(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),ny(e,"x","rect")),ny(e,"y","rect"))},rule:{vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},q0(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),C_("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),C_("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),gd("size",e,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:e=>$O(e,"square")},text:{vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},q0(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),Ip("x",e,{defaultPos:"mid"})),Ip("y",e,{defaultPos:"mid"})),aO(e)),gd("size",e,{vgChannel:"fontSize"})),gd("angle",e)),E5("align",function(r,i,s){if(Ou("align",r,s)===void 0)return"center"}(e.markDef,0,t))),E5("baseline",function(r,i,s){if(Ou("baseline",r,s)===void 0)return"middle"}(e.markDef,0,t))),Ip("radius",e,{defaultPos:null,isMidPoint:!0})),Ip("theta",e,{defaultPos:null,isMidPoint:!0}))}},tick:{vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,r=n.orient,i=r==="horizontal"?"width":"height",s=r==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},q0(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Ip("x",e,{defaultPos:"mid",vgChannel:"xc"})),Ip("y",e,{defaultPos:"mid",vgChannel:"yc"})),gd("size",e,{defaultValue:function(f){var v;const{config:w,markDef:O}=f,{orient:N}=O,L=N==="horizontal"?"width":"height",Y=f.getScaleComponent(N==="horizontal"?"x":"y"),ie=(v=Ou("size",O,w,{vgChannel:L}))!==null&&v!==void 0?v:w.tick.bandSize;if(ie!==void 0)return ie;{const fe=Y?Y.get("range"):void 0;if(fe&&Y1(fe)&&Gf(fe.step))return 3*fe.step/4;const ve=y_(w.view,L);return 3*ve/4}}(e),vgChannel:i})),{[s]:Ef(Ou("thickness",n,t))})}},trail:{vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},q0(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Ip("x",e,{defaultPos:"mid"})),Ip("y",e,{defaultPos:"mid"})),gd("size",e)),uO(e))}};function QV(e){return Yo([qk,Wk,XP],e.mark)?function(t){const n=RF(t.mark,t.encoding),r=Q_(t,{fromPrefix:n.length>0?eM:""});return n.length>0?[{name:t.getName("pathgroup"),type:"group",from:{facet:{name:eM+t.requestDataName(Np),data:t.requestDataName(Np),groupby:n}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:r}]:r}(e):Yo([Vk],e.mark)?function(t){const n=xA.some(r=>Ou(r,t.markDef,t.config));if(t.stack&&!t.fieldDef("size")&&n){const[r]=Q_(t,{fromPrefix:tM}),i=t.scaleName(t.stack.fieldChannel),s=(Y={})=>t.vgField(t.stack.fieldChannel,Y),f=(Y,ie)=>{const fe=[s({prefix:"min",suffix:"start",expr:ie}),s({prefix:"max",suffix:"start",expr:ie}),s({prefix:"min",suffix:"end",expr:ie}),s({prefix:"max",suffix:"end",expr:ie})];return`${Y}(${fe.map(ve=>`scale('${i}',${ve})`).join(",")})`};let v,w;t.stack.fieldChannel==="x"?(v=Object.assign(Object.assign({},n2(r.encode.update,["y","yc","y2","height",...xA])),{x:{signal:f("min","datum")},x2:{signal:f("max","datum")},clip:{value:!0}}),w={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},r.encode.update=Object.assign(Object.assign({},u1(r.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(v=Object.assign(Object.assign({},n2(r.encode.update,["x","xc","x2","width"])),{y:{signal:f("min","datum")},y2:{signal:f("max","datum")},clip:{value:!0}}),w={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},r.encode.update=Object.assign(Object.assign({},u1(r.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const Y of xA){const ie=Wy(Y,t.markDef,t.config);r.encode.update[Y]?(v[Y]=r.encode.update[Y],delete r.encode.update[Y]):ie&&(v[Y]=Ef(ie)),ie&&(r.encode.update[Y]={value:0})}const O=t.fieldDef(t.stack.groupbyChannel),N=Fi(O)?[Fi(O)]:[];return((O==null?void 0:O.bin)||(O==null?void 0:O.timeUnit))&&N.push(Fi(O,{binSuffix:"end"})),(v=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((Y,ie)=>{if(r.encode.update[ie])return Object.assign(Object.assign({},Y),{[ie]:r.encode.update[ie]});{const fe=Wy(ie,t.markDef,t.config);return fe!==void 0?Object.assign(Object.assign({},Y),{[ie]:Ef(fe)}):Y}},v)).stroke&&(v.strokeForeground={value:!0},v.strokeOffset={value:0}),[{type:"group",from:{facet:{data:t.requestDataName(Np),name:tM+t.requestDataName(Np),groupby:N,aggregate:{fields:[s({suffix:"start"}),s({suffix:"start"}),s({suffix:"end"}),s({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:v},marks:[{type:"group",encode:{update:w},marks:[r]}]}]}return Q_(t)}(e):Q_(e)}const eM="faceted_path_",tM="stack_group_";function Q_(e,t={fromPrefix:""}){const{mark:n,markDef:r,config:i}=e,s=$f(r.clip,function(Y){const ie=Y.getScaleComponent("x"),fe=Y.getScaleComponent("y");return!!(ie&&ie.get("selectionExtent")||fe&&fe.get("selectionExtent"))||void 0}(e),function(Y){const ie=Y.component.projection;return!(!ie||ie.isFit)||void 0}(e)),f=OF(r),v=e.encoding.key,w=function(Y){const{encoding:ie,stack:fe,mark:ve,markDef:Be,config:We}=Y,Ve=ie.order;if(!(!$o(Ve)&&g1(Ve)&&oI(Ve.value)||!Ve&&oI(Ou("order",Be,We)))){if(($o(Ve)||Vi(Ve))&&!fe)return DF(Ve,{expr:"datum"});if(Iy(ve)){const ct=Be.orient==="horizontal"?"y":"x",lt=ie[ct];if(Vi(lt)){const mt=lt.sort;return $o(mt)?{field:Fi(lt,{prefix:ct,suffix:"sort_index",expr:"datum"})}:Wv(mt)?{field:Fi({aggregate:WA(Y.encoding)?mt.op:void 0,field:mt.field},{expr:"datum"})}:fF(mt)?{field:Fi(Y.fieldDef(mt.encoding),{expr:"datum"}),order:mt.order}:mt===null?void 0:{field:Fi(lt,{binSuffix:Y.stack&&Y.stack.impute?"mid":void 0,expr:"datum"})}}}}}(e),O=function(Y){if(!Y.component.selection)return null;const ie=Si(Y.component.selection).length;let fe=ie,ve=Y.parent;for(;ve&&fe===0;)fe=Si(ve.component.selection).length,ve=ve.parent;return fe?{interactive:ie>0}:null}(e),N=Ou("aria",r,i),L=J_[n].postEncodingTransform?J_[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:J_[n].vgMark},s?{clip:!0}:{}),f?{style:f}:{}),v?{key:v.field}:{}),w?{sort:w}:{}),O||{}),N===!1?{aria:N}:{}),{from:{data:t.fromPrefix+e.requestDataName(Np)},encode:{update:J_[n].encodeEntry(e)}}),L?{transform:L}:{})]}class nM extends KR{constructor(t,n,r,i={},s){var f,v;super(t,"unit",n,r,s,void 0,KF(t)?t.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const w=Nv(t.mark)?t.mark.type:t.mark;this.markDef=JV(t.mark,(f=t.encoding)!==null&&f!==void 0?f:{},s,{graticule:t.data&&oO(t.data)});const O=this.encoding=rU((v=t.encoding)!==null&&v!==void 0?v:{},this.markDef,s);this.size=function({encoding:N,size:L}){for(const Y of W0){const ie=Lv(Y);Hv(L[ie])&&Vv(N[Y])&&(delete L[ie],_i(me.stepDropped(ie)))}return L}({encoding:O,size:KF(t)?Object.assign(Object.assign(Object.assign({},i),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):i}),this.stack=e5(w,O),this.specifiedScales=this.initScales(w,O),this.specifiedAxes=this.initAxes(O),this.specifiedLegends=this.initLegend(O),this.specifiedProjection=t.projection,this.selection=t.selection}get hasProjection(){const{encoding:t}=this,n=this.mark===bI,r=t&&oL.some(i=>Na(t[i]));return n||r}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return e_.reduce((r,i)=>{var s;const f=Th(n[i]);return f&&(r[i]=(s=f.scale)!==null&&s!==void 0?s:{}),r},{})}initAxes(t){return W0.reduce((n,r)=>{const i=t[r];if(Na(i)||r===Ol&&Na(t.x2)||r===Dh&&Na(t.y2)){const s=Na(i)?i.axis:void 0;n[r]=s&&Object.assign({},s)}return n},{})}initLegend(t){return hL.reduce((n,r)=>{const i=Th(t[r]);if(i&&function(s){switch(s){case _g:case jv:case Bv:case p1:case Eg:case m1:case H1:case G1:return!0;case V1:case q1:case Ry:return!1}}(r)){const s=i.legend;n[r]=s&&Object.assign({},s)}return n},{})}parseData(){this.component.data=Y_(this)}parseLayoutSize(){(function(t){const{size:n,component:r}=t;for(const i of W0){const s=Lv(i);if(n[s]){const f=n[s];r.layoutSize.set(s,Hv(f)?"step":f,!0)}else{const f=UV(t,s);r.layoutSize.set(s,f,!1)}}})(this)}parseSelections(){this.component.selection=function(t,n){var r;const i={},s=t.config.selection;for(const f of Si(n!=null?n:{})){const v=ls(n[f]),w=s[v.type],O=Bo(w,["fields","encodings"]);for(const Y in O)Y==="encodings"&&v.fields||Y==="fields"&&v.encodings||(Y==="mark"&&(v[Y]=Object.assign(Object.assign({},O[Y]),v[Y])),v[Y]!==void 0&&v[Y]!==!0||(v[Y]=(r=O[Y])!==null&&r!==void 0?r:v[Y]));const N=dl(f),L=i[N]=Object.assign(Object.assign({},v),{name:N,events:cs(v.on)?Sy(v.on,"scope"):ls(v.on)});O_(L,Y=>{Y.has(L)&&Y.parse&&Y.parse(t,L,v,n[f])})}return i}(this,this.selection)}parseMarkGroup(){this.component.mark=QV(this)}parseAxesAndHeaders(){this.component.axes=HV(this)}assembleSelectionTopLevelSignals(t){return function(n,r){let i=!1;return $y(n,(s,f)=>{const v=s.name,w=Ws(v+Gy);if(r.filter(O=>O.name===v).length===0){const O=s.resolve==="global"?"union":s.resolve,N=s.type==="multi"?", true)":")";r.push({name:s.name,update:`${P5}(${w}, ${Ws(O)}${N}`})}i=!0,f.topLevelSignals&&(r=f.topLevelSignals(n,s,r)),O_(s,O=>{O.topLevelSignals&&(r=O.topLevelSignals(n,s,r))})}),i&&r.filter(s=>s.name==="unit").length===0&&r.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),fO(r)}(this,t)}assembleSignals(){return[...tR(this),...function(t,n){return $y(t,(r,i)=>{const s=r.name;let f=i.modifyExpr(t,r);n.push(...i.signals(t,r)),O_(r,v=>{v.signals&&(n=v.signals(t,r,n)),v.modifyExpr&&(f=v.modifyExpr(t,r,f))}),n.push({name:s+eW,on:[{events:{signal:r.name+$v},update:`modify(${Ws(r.name+Gy)}, ${f})`}]})}),fO(n)}(this,[])]}assembleSelectionData(t){return function(n,r){const i=[...r];return $y(n,s=>{const f={name:s.name+Gy};if(s.init){const v=s.project.items.map(O=>Bo(O,["signals"])),w=s.init.map(O=>Tb(O,!1));f.values=s.type==="interval"?[{unit:b1(n,{escape:!1}),fields:v,values:w}]:w.map(O=>({unit:b1(n,{escape:!1}),fields:v,values:O}))}i.filter(v=>v.name===s.name+Gy).length||i.push(f)}),i}(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return DO(this)}assembleMarks(){var t;let n=(t=this.component.mark)!==null&&t!==void 0?t:[];return this.parent&&Lb(this.parent)||(n=M5(this,n)),n.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return Vy(this.encoding,t)}fieldDef(t){return qv(this.encoding[t])}typedFieldDef(t){const n=this.fieldDef(t);return o0(n)?n:null}}class KO extends VO{constructor(t,n,r,i,s){super(t,"layer",n,r,s,t.resolve,t.view);const f=Object.assign(Object.assign(Object.assign({},i),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map((v,w)=>{if(b_(v))return new KO(v,this,this.getName("layer_"+w),f,s);if(c1(v))return new nM(v,this,this.getName("layer_"+w),f,s);throw new Error(me.invalidSpec(v))})}parseData(){this.component.data=Y_(this);for(const t of this.children)t.parseData()}parseLayoutSize(){(function(t){qO(t),X_(t,"width"),X_(t,"height")})(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of Si(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){(function(t){var n;const{axes:r,resolve:i}=t.component,s={top:0,bottom:0,right:0,left:0};for(const f of t.children){f.parseAxesAndHeaders();for(const v of Si(f.component.axes))i.axis[v]=TO(t.component.resolve,v),i.axis[v]==="shared"&&(r[v]=$V(r[v],f.component.axes[v]),r[v]||(i.axis[v]="independent",delete r[v]))}for(const f of W0){for(const v of t.children)if(v.component.axes[f]){if(i.axis[f]==="independent"){r[f]=((n=r[f])!==null&&n!==void 0?n:[]).concat(v.component.axes[f]);for(const w of v.component.axes[f]){const{value:O,explicit:N}=w.getWithExplicit("orient");if(!xa(O)){if(s[O]>0&&!N){const L=GV[O];s[O]>s[L]&&w.set("orient",L,!1)}s[O]++}}}delete v.component.axes[f]}if(i.axis[f]==="independent"&&r[f]&&r[f].length>1)for(const v of r[f])v.get("grid")&&!v.explicit.grid&&(v.implicit.grid=!1)}})(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,r)=>r.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),tR(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),DO(this))}assembleSelectionData(t){return this.children.reduce((n,r)=>r.assembleSelectionData(n),t)}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle())return t}assembleLayout(){return null}assembleMarks(){return function(t,n){for(const r of t.children)Jl(r)&&(n=M5(r,n));return n}(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),AR(this))}}function XO(e,t,n,r,i){if(u_(e))return new M2(e,t,n,i);if(b_(e))return new KO(e,t,n,r,i);if(c1(e))return new nM(e,t,n,r,i);if(function(s){return v_(s)||ZA(s)||QA(s)}(e))return new VV(e,t,n,i);throw new Error(me.invalidSpec(e))}function ZV(e,t={}){t.logger&&function(n){r_=n}(t.logger),t.fieldTitle&&wF(t.fieldTitle);try{const n=JF(iI(t.config,e.config)),r=u5(e,n),i=XO(r,null,"",void 0,n);return i.parse(),function(s,f){FO(s.sources);let v=0,w=0;for(let O=0;O<L_&&RR(s,f);O++)v++;s.sources.map(MO);for(let O=0;O<L_&&RR(s,f);O++)w++;FO(s.sources),Math.max(v,w)===L_&&_i(`Maximum optimization runs(${L_}) reached.`)}(i.component.data,i),{spec:function(s,f,v={},w){const O=s.config?vU(s.config):void 0,N=[].concat(s.assembleSelectionData([]),function(Be,We){var Ve,ct;const lt=[],mt=XR(lt);let dt=0;for(const wt of Be.sources)wt.hasName()||(wt.dataName=`source_${dt++}`),mt(wt,wt.assemble());for(const wt of lt)wt.transform.length===0&&delete wt.transform;let kt=0;for(const[wt,dn]of lt.entries())((Ve=dn.transform)!==null&&Ve!==void 0?Ve:[]).length!==0||dn.source||lt.splice(kt++,0,lt.splice(wt,1)[0]);for(const wt of lt)for(const dn of(ct=wt.transform)!==null&&ct!==void 0?ct:[])dn.type==="lookup"&&(dn.from=Be.outputNodes[dn.from].getSource());for(const wt of lt)wt.name in We&&(wt.values=We[wt.name]);return lt}(s.component.data,v)),L=s.assembleProjections(),Y=s.assembleTitle(),ie=s.assembleGroupStyle(),fe=s.assembleGroupEncodeEntry(!0);let ve=s.assembleLayoutSignals();return ve=ve.filter(Be=>Be.name!=="width"&&Be.name!=="height"||Be.value===void 0||(f[Be.name]=+Be.value,!1)),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},s.description?{description:s.description}:{}),f),Y?{title:Y}:{}),ie?{style:ie}:{}),fe?{encode:{update:fe}}:{}),{data:N}),L.length>0?{projections:L}:{}),s.assembleGroup([...ve,...s.assembleSelectionTopLevelSignals([])])),O?{config:O}:{}),w?{usermeta:w}:{})}(i,function(s,f,v,w){const O=w.component.layoutSize.get("width"),N=w.component.layoutSize.get("height");if(f===void 0?(f={type:"pad"},w.hasAxisOrientSignalRef()&&(f.resize=!0)):cs(f)&&(f={type:f}),O&&N&&function(L){return L==="fit"||L==="fit-x"||L==="fit-y"}(f.type)){if(O==="step"&&N==="step")_i(me.droppingFit()),f.type="pad";else if(O==="step"||N==="step"){const L=O==="step"?"width":"height";_i(me.droppingFit(Zk(L)));const Y=L==="width"?"height":"width";f.type=function(ie){return ie?`fit-${Zk(ie)}`:"fit"}(Y)}}return Object.assign(Object.assign(Object.assign({},Si(f).length===1&&f.type?f.type==="pad"?{}:{autosize:f.type}:{autosize:f}),l5(v)),l5(s))}(e,r.autosize,n,i),e.datasets,e.usermeta),normalized:r}}finally{t.logger&&Rz(),t.fieldTitle&&wF(bF)}}const eq=new class extends QF{mapUnit(e,{config:t}){if(e.encoding){const{encoding:n,transform:r}=e,{bins:i,timeUnits:s,aggregate:f,groupby:v,encoding:w}=VA(n,t),O=[...r||[],...i,...s,...f.length===0?[]:[{aggregate:f,groupby:v}]];return Object.assign(Object.assign(Object.assign({},e),O.length>0?{transform:O}:{}),{encoding:w})}return e}};function tq(e,t){return eq.map(e,{config:t})}const nq=OP.version;var rM=function(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}};const rq={background:"#333",title:{color:"#fff",subtitleColor:"#fff"},style:{"guide-label":{fill:"#fff"},"guide-title":{fill:"#fff"}},axis:{domainColor:"#fff",gridColor:"#888",tickColor:"#fff"}},iq={background:"#fff",arc:{fill:"#4572a7"},area:{fill:"#4572a7"},line:{stroke:"#4572a7",strokeWidth:2},path:{stroke:"#4572a7"},rect:{fill:"#4572a7"},shape:{stroke:"#4572a7"},symbol:{fill:"#4572a7",strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},oq={arc:{fill:"#30a2da"},area:{fill:"#30a2da"},axis:{domainColor:"#cbcbcb",grid:!0,gridColor:"#cbcbcb",gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:"#cbcbcb",tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:"#f0f0f0",group:{fill:"#f0f0f0"},legend:{labelColor:"#333",labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:"#333",titleFontSize:14,titlePadding:10},line:{stroke:"#30a2da",strokeWidth:2},path:{stroke:"#30a2da",strokeWidth:.5},rect:{fill:"#30a2da"},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:"#30a2da"},bar:{binSpacing:2,fill:"#30a2da",stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},aq={group:{fill:"#e5e5e5"},arc:{fill:"#000"},area:{fill:"#000"},line:{stroke:"#000"},path:{stroke:"#000"},rect:{fill:"#000"},shape:{stroke:"#000"},symbol:{fill:"#000",size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},YO="Benton Gothic Bold, sans-serif",j2={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},sq={background:"#ffffff",title:{anchor:"start",color:"#000000",font:YO,fontSize:22,fontWeight:"normal"},arc:{fill:"#82c6df"},area:{fill:"#82c6df"},line:{stroke:"#82c6df",strokeWidth:2},path:{stroke:"#82c6df"},rect:{fill:"#82c6df"},shape:{stroke:"#82c6df"},symbol:{fill:"#82c6df",size:30},axis:{labelFont:"Benton Gothic, sans-serif",labelFontSize:11.5,labelFontWeight:"normal",titleFont:YO,titleFontSize:13,titleFontWeight:"normal"},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:"Benton Gothic, sans-serif",labelFontSize:11.5,symbolType:"square",titleFont:YO,titleFontSize:13,titleFontWeight:"normal"},range:{category:j2["category-6"],diverging:j2["fireandice-6"],heatmap:j2["fire-7"],ordinal:j2["fire-7"],ramp:j2["fire-7"]}},uq={background:"#f9f9f9",arc:{fill:"#ab5787"},area:{fill:"#ab5787"},line:{stroke:"#ab5787"},path:{stroke:"#ab5787"},rect:{fill:"#ab5787"},shape:{stroke:"#ab5787"},symbol:{fill:"#ab5787",size:30},axis:{domainColor:"#979797",domainWidth:.5,gridWidth:.2,labelColor:"#979797",tickColor:"#979797",tickWidth:.2,titleColor:"#979797"},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},cq={background:"#fff",arc:{fill:"#3e5c69"},area:{fill:"#3e5c69"},line:{stroke:"#3e5c69"},path:{stroke:"#3e5c69"},rect:{fill:"#3e5c69"},shape:{stroke:"#3e5c69"},symbol:{fill:"#3e5c69"},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},B2={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},lq={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:"Lato"},axisX:{domain:!0,domainColor:"#000000",domainWidth:1,grid:!1,labelFontSize:12,labelFont:"Lato",labelAngle:0,tickColor:"#000000",tickSize:5,titleFontSize:12,titlePadding:10,titleFont:"Lato"},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:"Lato",labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:"Lato",titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:"Lato",symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:"Lato",orient:"right",offset:10},view:{stroke:"transparent"},range:{category:B2["six-groups-cat-1"],diverging:B2["diverging-colors"],heatmap:B2["diverging-colors"],ordinal:B2["six-groups-seq"],ramp:B2["shades-blue"]},area:{fill:"#1696d2"},rect:{fill:"#1696d2"},line:{color:"#1696d2",stroke:"#1696d2",strokeWidth:5},trail:{color:"#1696d2",stroke:"#1696d2",strokeWidth:0,size:1},path:{stroke:"#1696d2",strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:"#1696d2",fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:"#1696d2",stroke:null}},arc:{fill:"#1696d2"},shape:{stroke:"#1696d2"},symbol:{fill:"#1696d2",size:30}},fq={arc:{fill:"#3366CC"},area:{fill:"#3366CC"},path:{stroke:"#3366CC"},rect:{fill:"#3366CC"},shape:{stroke:"#3366CC"},symbol:{stroke:"#3366CC"},circle:{fill:"#3366CC"},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:"Arial, sans-serif",fontSize:12},"guide-title":{font:"Arial, sans-serif",fontSize:12},"group-title":{font:"Arial, sans-serif",fontSize:12}},title:{font:"Arial, sans-serif",fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:"#ccc",tickColor:"#ccc",domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},hq="2.10.0";var dq=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black; }
  #vg-tooltip-element.visible {
    visibility: visible; }
  #vg-tooltip-element h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 13px; }
  #vg-tooltip-element img {
    max-width: 200px;
    max-height: 200px; }
  #vg-tooltip-element table {
    border-spacing: 0; }
    #vg-tooltip-element table tr {
      border: none; }
      #vg-tooltip-element table tr td {
        overflow: hidden;
        text-overflow: ellipsis;
        padding-top: 2px;
        padding-bottom: 2px; }
        #vg-tooltip-element table tr td.key {
          color: #808080;
          max-width: 150px;
          text-align: right;
          padding-right: 4px; }
        #vg-tooltip-element table tr td.value {
          display: block;
          max-width: 300px;
          max-height: 7em;
          text-align: left; }
  #vg-tooltip-element.dark-theme {
    background-color: rgba(32, 32, 32, 0.9);
    border: 1px solid #f5f5f5;
    color: white; }
    #vg-tooltip-element.dark-theme td.key {
      color: #bfbfbf; }
`;const iM="vg-tooltip-element",pq={offsetX:10,offsetY:10,id:iM,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2};function mq(e,t,n){if(Object(we.B)(e))return`[${e.map(r=>t(Object(we.J)(r)?r:oM(r,n))).join(", ")}]`;if(Object(we.H)(e)){let r="";const i=e,{title:s,image:f}=i,v=function(O,N){var L={};for(var Y in O)Object.prototype.hasOwnProperty.call(O,Y)&&N.indexOf(Y)<0&&(L[Y]=O[Y]);if(O!=null&&typeof Object.getOwnPropertySymbols=="function"){var ie=0;for(Y=Object.getOwnPropertySymbols(O);ie<Y.length;ie++)N.indexOf(Y[ie])<0&&Object.prototype.propertyIsEnumerable.call(O,Y[ie])&&(L[Y[ie]]=O[Y[ie]])}return L}(i,["title","image"]);s&&(r+=`<h2>${t(s)}</h2>`),f&&(r+=`<img src="${t(f)}">`);const w=Object.keys(v);if(w.length>0){r+="<table>";for(const O of w){let N=v[O];N!==void 0&&(Object(we.H)(N)&&(N=oM(N,n)),r+=`<tr><td class="key">${t(O)}:</td><td class="value">${t(N)}</td></tr>`)}r+="</table>"}return r||"{}"}return t(e)}function oM(e,t){return JSON.stringify(e,function(n){const r=[];return function(i,s){if(typeof s!="object"||s===null)return s;const f=r.indexOf(this)+1;return r.length=f,r.length>n?"[Object]":r.indexOf(s)>=0?"[Circular]":(r.push(s),s)}}(t))}class gq{constructor(t){this.options=Object.assign(Object.assign({},pq),t);const n=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const r=document.createElement("style");r.setAttribute("id",this.options.styleId),r.innerHTML=function(s){if(!/^[A-Za-z]+[-:.\w]*$/.test(s))throw new Error("Invalid HTML ID");return dq.toString().replace(iM,s)}(n);const i=document.head;i.childNodes.length>0?i.insertBefore(r,i.childNodes[0]):i.appendChild(r)}}tooltipHandler(t,n,r,i){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el)),(document.fullscreenElement!=null?document.fullscreenElement:document.body).appendChild(this.el),i==null||i==="")return void this.el.classList.remove("visible",`${this.options.theme}-theme`);this.el.innerHTML=mq(i,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:s,y:f}=function(v,w,O,N){let L=v.clientX+O;L+w.width>window.innerWidth&&(L=+v.clientX-O-w.width);let Y=v.clientY+N;return Y+w.height>window.innerHeight&&(Y=+v.clientY-N-w.height),{x:L,y:Y}}(n,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${f}px; left: ${s}px`)}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Z_(e,t,n,r){return new(n||(n=Promise))(function(i,s){function f(O){try{w(r.next(O))}catch(N){s(N)}}function v(O){try{w(r.throw(O))}catch(N){s(N)}}function w(O){O.done?i(O.value):function(N){return N instanceof n?N:new n(function(L){L(N)})}(O.value).then(f,v)}w((r=r.apply(e,t||[])).next())})}o.d(m,"DEFAULT_ACTIONS",function(){return sM}),o.d(m,"guessMode",function(){return cM}),o.d(m,"vega",function(){return E1}),o.d(m,"vegaLite",function(){return Ub});var JO,vq=`.vega-embed {
  position: relative;
  display: inline-block;
  box-sizing: border-box; }
  .vega-embed.has-actions {
    padding-right: 38px; }
  .vega-embed details:not([open]) > :not(summary) {
    display: none !important; }
  .vega-embed summary {
    list-style: none;
    position: absolute;
    top: 0;
    right: 0;
    padding: 6px;
    z-index: 1000;
    background: white;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    color: #1b1e23;
    border: 1px solid #aaa;
    border-radius: 999px;
    opacity: 0.2;
    transition: opacity 0.4s ease-in;
    outline: none;
    cursor: pointer;
    line-height: 0px; }
    .vega-embed summary::-webkit-details-marker {
      display: none; }
    .vega-embed summary:active {
      box-shadow: #aaa 0px 0px 0px 1px inset; }
    .vega-embed summary svg {
      width: 14px;
      height: 14px; }
  .vega-embed details[open] summary {
    opacity: 0.7; }
  .vega-embed:hover summary,
  .vega-embed:focus summary {
    opacity: 1 !important;
    transition: opacity 0.2s ease; }
  .vega-embed .vega-actions {
    position: absolute;
    z-index: 1001;
    top: 35px;
    right: -9px;
    display: flex;
    flex-direction: column;
    padding-bottom: 8px;
    padding-top: 8px;
    border-radius: 4px;
    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
    border: 1px solid #d9d9d9;
    background: white;
    animation-duration: 0.15s;
    animation-name: scale-in;
    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
    text-align: left; }
    .vega-embed .vega-actions a {
      padding: 8px 16px;
      font-family: sans-serif;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      color: #434a56;
      text-decoration: none; }
      .vega-embed .vega-actions a:hover {
        background-color: #f7f7f9;
        color: black; }
    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
      content: "";
      display: inline-block;
      position: absolute; }
    .vega-embed .vega-actions::before {
      left: auto;
      right: 14px;
      top: -16px;
      border: 8px solid #0000;
      border-bottom-color: #d9d9d9; }
    .vega-embed .vega-actions::after {
      left: auto;
      right: 15px;
      top: -14px;
      border: 7px solid #0000;
      border-bottom-color: #fff; }
  .vega-embed .chart-wrapper {
    width: 100%;
    height: 100%; }

.vega-embed-wrapper {
  max-width: 100%;
  overflow: auto;
  padding-right: 14px; }

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6); }
  to {
    opacity: 1;
    transform: scale(1); } }
`;function aM(e,...t){for(const n of t)yq(e,n);return e}function yq(e,t){for(const n of Object.keys(t))Object(we.La)(e,n,t[n],!0)}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});const E1=J;let Ub=pe;const eE=typeof window!="undefined"?window:void 0;Ub===void 0&&((JO=eE==null?void 0:eE.vl)===null||JO===void 0?void 0:JO.compile)&&(Ub=eE.vl);const sM={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},bq={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},P2={vega:"Vega","vega-lite":"Vega-Lite"},tE={vega:E1.version,"vega-lite":Ub?Ub.version:"not available"},xq={vega:e=>e,"vega-lite":(e,t)=>Ub.compile(e,{config:t}).spec},wq=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`,kq="chart-wrapper";function uM(e,t,n,r){const i=`<html><head>${t}</head><body><pre><code class="json">`,s=`</code></pre>${n}</body></html>`,f=window.open("");f.document.write(i+e+s),f.document.title=`${P2[r]} JSON Source`}function cM(e,t){var n;if(e.$schema){const r=rM(e.$schema);t&&t!==r.library&&console.warn(`The given visualization spec is written in ${P2[r.library]}, but mode argument sets ${(n=P2[t])!==null&&n!==void 0?n:t}.`);const i=r.library;return Object(ar.satisfies)(tE[i],`^${r.version.slice(1)}`)||console.warn(`The input spec uses ${P2[i]} ${r.version}, but the current version of ${P2[i]} is v${tE[i]}.`),i}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":t!=null?t:"vega"}function lM(e){return function(t){return!!(t&&"load"in t)}(e)?e:E1.loader(e)}function fM(e){var t;return(t=e.usermeta&&e.usermeta.embedOptions)!==null&&t!==void 0?t:{}}function hM(e,t){var n;return Z_(this,void 0,void 0,function*(){const r=Object(we.J)(e.config)?JSON.parse(yield t.load(e.config)):(n=e.config)!==null&&n!==void 0?n:{},i=Object(we.J)(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),i?{patch:i}:{}),r?{config:r}:{})})}m.default=function(e,t,n={}){var r,i,s;return Z_(this,void 0,void 0,function*(){let f,v;Object(we.J)(t)?(v=lM(n.loader),f=JSON.parse(yield v.load(t))):f=t;const w=fM(f).loader;v&&!w||(v=lM((r=n.loader)!==null&&r!==void 0?r:w));const O=yield hM(fM(f),v),N=yield hM(n,v),L=Object.assign(Object.assign({},aM(N,O)),{config:Object(we.P)((i=N.config)!==null&&i!==void 0?i:{},(s=O.config)!==null&&s!==void 0?s:{})});return yield function(Y,ie,fe={},ve){var Be,We,Ve,ct,lt,mt;return Z_(this,void 0,void 0,function*(){const dt=fe.theme?Object(we.P)(Oe[fe.theme],(Be=fe.config)!==null&&Be!==void 0?Be:{}):fe.config,kt=Object(we.C)(fe.actions)?fe.actions:aM({},sM,(We=fe.actions)!==null&&We!==void 0?We:{}),wt=Object.assign(Object.assign({},bq),fe.i18n),dn=(Ve=fe.renderer)!==null&&Ve!==void 0?Ve:"canvas",Dn=(ct=fe.logLevel)!==null&&ct!==void 0?ct:E1.Warn,wn=(lt=fe.downloadFileName)!==null&&lt!==void 0?lt:"visualization",Xn=typeof Y=="string"?document.querySelector(Y):Y;if(!Xn)throw new Error(`${Y} does not exist`);if(fe.defaultStyle!==!1){const oo="vega-embed-style",{root:Po,rootContainer:ho}=function(ao){var xo;const _a=ao.getRootNode?ao.getRootNode():document;return _a instanceof ShadowRoot?{root:_a,rootContainer:_a}:{root:document,rootContainer:(xo=document.head)!==null&&xo!==void 0?xo:document.body}}(Xn);if(!Po.getElementById(oo)){const ao=document.createElement("style");ao.id=oo,ao.innerText=fe.defaultStyle===void 0||fe.defaultStyle===!0?vq.toString():fe.defaultStyle,ho.appendChild(ao)}}const Kn=cM(ie,fe.mode);let ir=xq[Kn](ie,dt);if(Kn==="vega-lite"&&ir.$schema){const oo=rM(ir.$schema);Object(ar.satisfies)(tE.vega,`^${oo.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${oo.version}, but current version is v${tE.vega}.`)}Xn.classList.add("vega-embed"),kt&&Xn.classList.add("has-actions"),Xn.innerHTML="";let sr=Xn;if(kt){const oo=document.createElement("div");oo.classList.add(kq),Xn.appendChild(oo),sr=oo}const gr=fe.patch;gr&&(ir=gr instanceof Function?gr(ir):En(ir,gr,!0,!1).newDocument),fe.formatLocale&&E1.formatLocale(fe.formatLocale),fe.timeFormatLocale&&E1.timeFormatLocale(fe.timeFormatLocale);const{ast:Vr}=fe,hi=E1.parse(ir,Kn==="vega-lite"?{}:dt,{ast:Vr}),Qr=new(fe.viewClass||E1.View)(hi,Object.assign({loader:ve,logLevel:Dn,renderer:dn},Vr?{expr:E1.expressionInterpreter}:{}));if(fe.tooltip!==!1){let oo;oo=function(Po){return typeof Po=="function"}(fe.tooltip)?fe.tooltip:new gq(fe.tooltip===!0?{}:fe.tooltip).call,Qr.tooltip(oo)}let Ni,{hover:ro}=fe;if(ro===void 0&&(ro=Kn==="vega"),ro){const{hoverSet:oo,updateSet:Po}=typeof ro=="boolean"?{}:ro;Qr.hover(oo,Po)}if(fe&&(fe.width!=null&&Qr.width(fe.width),fe.height!=null&&Qr.height(fe.height),fe.padding!=null&&Qr.padding(fe.padding)),yield Qr.initialize(sr,fe.bind).runAsync(),kt!==!1){let oo=Xn;if(fe.defaultStyle!==!1){const ho=document.createElement("details");ho.title=wt.CLICK_TO_VIEW_ACTIONS,Xn.append(ho),oo=ho;const ao=document.createElement("summary");ao.innerHTML=wq,ho.append(ao),Ni=xo=>{ho.contains(xo.target)||ho.removeAttribute("open")},document.addEventListener("click",Ni)}const Po=document.createElement("div");if(oo.append(Po),Po.classList.add("vega-actions"),kt===!0||kt.export!==!1){for(const ho of["svg","png"])if(kt===!0||kt.export===!0||kt.export[ho]){const ao=wt[`${ho.toUpperCase()}_ACTION`],xo=document.createElement("a");xo.text=ao,xo.href="#",xo.target="_blank",xo.download=`${wn}.${ho}`,xo.addEventListener("mousedown",function(_a){return Z_(this,void 0,void 0,function*(){_a.preventDefault();const ys=yield Qr.toImageURL(ho,fe.scaleFactor);this.href=ys})}),Po.append(xo)}}if(kt===!0||kt.source!==!1){const ho=document.createElement("a");ho.text=wt.SOURCE_ACTION,ho.href="#",ho.addEventListener("click",function(ao){var xo,_a;uM(Cn()(ie),(xo=fe.sourceHeader)!==null&&xo!==void 0?xo:"",(_a=fe.sourceFooter)!==null&&_a!==void 0?_a:"",Kn),ao.preventDefault()}),Po.append(ho)}if(Kn==="vega-lite"&&(kt===!0||kt.compiled!==!1)){const ho=document.createElement("a");ho.text=wt.COMPILED_ACTION,ho.href="#",ho.addEventListener("click",function(ao){var xo,_a;uM(Cn()(ir),(xo=fe.sourceHeader)!==null&&xo!==void 0?xo:"",(_a=fe.sourceFooter)!==null&&_a!==void 0?_a:"","vega"),ao.preventDefault()}),Po.append(ho)}if(kt===!0||kt.editor!==!1){const ho=(mt=fe.editorUrl)!==null&&mt!==void 0?mt:"https://vega.github.io/editor/",ao=document.createElement("a");ao.text=wt.EDITOR_ACTION,ao.href="#",ao.addEventListener("click",function(xo){(function(_a,ys,Lo){const Vs=_a.open(ys),qs=250,{origin:Su}=new URL(ys);let Ic=~~(1e4/qs);_a.addEventListener("message",function Fc(xc){xc.source===Vs&&(Ic=0,_a.removeEventListener("message",Fc,!1))},!1),setTimeout(function Fc(){Ic<=0||(Vs.postMessage(Lo,Su),setTimeout(Fc,qs),Ic-=1)},qs)})(window,ho,{config:dt,mode:Kn,renderer:dn,spec:Cn()(ie)}),xo.preventDefault()}),Po.append(ao)}}return{view:Qr,spec:ie,vgSpec:ir,finalize:function(){Ni&&document.removeEventListener("click",Ni),Qr.finalize()}}})}(e,f,L,v)})}},function(j,m,o){const{MAX_LENGTH:g}=o(117),{re:z,t:I}=o(90),A=o(32),X=o(115);j.exports=(K,M)=>{if(M=X(M),K instanceof A)return K;if(typeof K!="string"||K.length>g||!(M.loose?z[I.LOOSE]:z[I.FULL]).test(K))return null;try{return new A(K,M)}catch{return null}}},function(j,m,o){const{MAX_SAFE_COMPONENT_LENGTH:g}=o(117),z=o(116),I=(m=j.exports={}).re=[],A=m.src=[],X=m.t={};let K=0;const M=(V,$,W)=>{const te=K++;z(te,$),X[V]=te,A[te]=$,I[te]=new RegExp($,W?"g":void 0)};M("NUMERICIDENTIFIER","0|[1-9]\\d*"),M("NUMERICIDENTIFIERLOOSE","[0-9]+"),M("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),M("MAINVERSION",`(${A[X.NUMERICIDENTIFIER]})\\.(${A[X.NUMERICIDENTIFIER]})\\.(${A[X.NUMERICIDENTIFIER]})`),M("MAINVERSIONLOOSE",`(${A[X.NUMERICIDENTIFIERLOOSE]})\\.(${A[X.NUMERICIDENTIFIERLOOSE]})\\.(${A[X.NUMERICIDENTIFIERLOOSE]})`),M("PRERELEASEIDENTIFIER",`(?:${A[X.NUMERICIDENTIFIER]}|${A[X.NONNUMERICIDENTIFIER]})`),M("PRERELEASEIDENTIFIERLOOSE",`(?:${A[X.NUMERICIDENTIFIERLOOSE]}|${A[X.NONNUMERICIDENTIFIER]})`),M("PRERELEASE",`(?:-(${A[X.PRERELEASEIDENTIFIER]}(?:\\.${A[X.PRERELEASEIDENTIFIER]})*))`),M("PRERELEASELOOSE",`(?:-?(${A[X.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${A[X.PRERELEASEIDENTIFIERLOOSE]})*))`),M("BUILDIDENTIFIER","[0-9A-Za-z-]+"),M("BUILD",`(?:\\+(${A[X.BUILDIDENTIFIER]}(?:\\.${A[X.BUILDIDENTIFIER]})*))`),M("FULLPLAIN",`v?${A[X.MAINVERSION]}${A[X.PRERELEASE]}?${A[X.BUILD]}?`),M("FULL",`^${A[X.FULLPLAIN]}$`),M("LOOSEPLAIN",`[v=\\s]*${A[X.MAINVERSIONLOOSE]}${A[X.PRERELEASELOOSE]}?${A[X.BUILD]}?`),M("LOOSE",`^${A[X.LOOSEPLAIN]}$`),M("GTLT","((?:<|>)?=?)"),M("XRANGEIDENTIFIERLOOSE",`${A[X.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),M("XRANGEIDENTIFIER",`${A[X.NUMERICIDENTIFIER]}|x|X|\\*`),M("XRANGEPLAIN",`[v=\\s]*(${A[X.XRANGEIDENTIFIER]})(?:\\.(${A[X.XRANGEIDENTIFIER]})(?:\\.(${A[X.XRANGEIDENTIFIER]})(?:${A[X.PRERELEASE]})?${A[X.BUILD]}?)?)?`),M("XRANGEPLAINLOOSE",`[v=\\s]*(${A[X.XRANGEIDENTIFIERLOOSE]})(?:\\.(${A[X.XRANGEIDENTIFIERLOOSE]})(?:\\.(${A[X.XRANGEIDENTIFIERLOOSE]})(?:${A[X.PRERELEASELOOSE]})?${A[X.BUILD]}?)?)?`),M("XRANGE",`^${A[X.GTLT]}\\s*${A[X.XRANGEPLAIN]}$`),M("XRANGELOOSE",`^${A[X.GTLT]}\\s*${A[X.XRANGEPLAINLOOSE]}$`),M("COERCE",`(^|[^\\d])(\\d{1,${g}})(?:\\.(\\d{1,${g}}))?(?:\\.(\\d{1,${g}}))?(?:$|[^\\d])`),M("COERCERTL",A[X.COERCE],!0),M("LONETILDE","(?:~>?)"),M("TILDETRIM",`(\\s*)${A[X.LONETILDE]}\\s+`,!0),m.tildeTrimReplace="$1~",M("TILDE",`^${A[X.LONETILDE]}${A[X.XRANGEPLAIN]}$`),M("TILDELOOSE",`^${A[X.LONETILDE]}${A[X.XRANGEPLAINLOOSE]}$`),M("LONECARET","(?:\\^)"),M("CARETTRIM",`(\\s*)${A[X.LONECARET]}\\s+`,!0),m.caretTrimReplace="$1^",M("CARET",`^${A[X.LONECARET]}${A[X.XRANGEPLAIN]}$`),M("CARETLOOSE",`^${A[X.LONECARET]}${A[X.XRANGEPLAINLOOSE]}$`),M("COMPARATORLOOSE",`^${A[X.GTLT]}\\s*(${A[X.LOOSEPLAIN]})$|^$`),M("COMPARATOR",`^${A[X.GTLT]}\\s*(${A[X.FULLPLAIN]})$|^$`),M("COMPARATORTRIM",`(\\s*)${A[X.GTLT]}\\s*(${A[X.LOOSEPLAIN]}|${A[X.XRANGEPLAIN]})`,!0),m.comparatorTrimReplace="$1$2$3",M("HYPHENRANGE",`^\\s*(${A[X.XRANGEPLAIN]})\\s+-\\s+(${A[X.XRANGEPLAIN]})\\s*$`),M("HYPHENRANGELOOSE",`^\\s*(${A[X.XRANGEPLAINLOOSE]})\\s+-\\s+(${A[X.XRANGEPLAINLOOSE]})\\s*$`),M("STAR","(<|>)?=?\\s*\\*"),M("GTE0","^\\s*>=\\s*0.0.0\\s*$"),M("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(25),z=o(103),I=o(29),A=o(21),X=o(373),K=o(28);function M(W,te,F,ue){if(ue==null&&(ue=A.inferDtype(W)),ue==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!A.isTypedArray(W)&&!Array.isArray(W)&&typeof W!="number"&&typeof W!="boolean"&&typeof W!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(te!=null){A.assertNonNegativeIntegerDimensions(te);var se=A.sizeFromShape(te),J=A.sizeFromShape(F);A.assert(se===J,function(){return"Based on the provided shape, ["+te+"], the tensor should have "+se+" values but has "+J});for(var me=0;me<F.length;++me){var pe=F[me],Oe=me!==F.length-1||pe!==A.sizeFromShape(te.slice(me));A.assert(F[me]===te[me]||!Oe,function(){return"Error creating a new Tensor. Inferred shape ("+F+") does not match the provided shape ("+te+"). "})}}return A.isTypedArray(W)||Array.isArray(W)||(W=[W]),te=te||F,W=ue!=="string"?A.toTypedArray(W,ue,z.env().getBool("DEBUG")):A.flatten(W,[],!0),g.ENGINE.makeTensor(W,te,ue)}function V(W,te){A.assertNonNull(W);var F=I.inferShape(W,te);if(F.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return M(W,null,F,te)}function $(W,te){if(te===void 0&&(te="float32"),te==="complex64"){var F=$(W,"float32"),ue=$(W,"float32");return X.complex(F,ue)}var se=A.makeZerosTypedArray(A.sizeFromShape(W),te);return g.ENGINE.makeTensor(se,W,te)}m.tensor=function(W,te,F){return M(W,te,I.inferShape(W,F),F)},m.scalar=function(W,te){if((A.isTypedArray(W)&&te!=="string"||Array.isArray(W))&&te!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(te==="string"&&A.isTypedArray(W)&&!(W instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return M(W,[],[],te)},m.tensor1d=V,m.tensor2d=function(W,te,F){if(A.assertNonNull(W),te!=null&&te.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var ue=I.inferShape(W,F);if(ue.length!==2&&ue.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(ue.length===1&&te==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return M(W,te,ue,F)},m.tensor3d=function(W,te,F){if(A.assertNonNull(W),te!=null&&te.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var ue=I.inferShape(W,F);if(ue.length!==3&&ue.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(ue.length===1&&te==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return M(W,te,ue,F)},m.tensor4d=function(W,te,F){if(A.assertNonNull(W),te!=null&&te.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var ue=I.inferShape(W,F);if(ue.length!==4&&ue.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(ue.length===1&&te==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return M(W,te,ue,F)},m.tensor5d=function(W,te,F){if(A.assertNonNull(W),te!=null&&te.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var ue=I.inferShape(W,F);if(ue.length!==5&&ue.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(ue.length===1&&te==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return M(W,te,ue,F)},m.tensor6d=function(W,te,F){if(A.assertNonNull(W),te!=null&&te.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var ue=I.inferShape(W,F);if(ue.length!==6&&ue.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(ue.length===1&&te==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return M(W,te=te||ue,ue,F)},m.variable=function(W,te,F,ue){return te===void 0&&(te=!0),g.ENGINE.makeVariable(W,te,F,ue)},m.ones=function W(te,F){if(F===void 0&&(F="float32"),F==="complex64"){var ue=W(te,"float32"),se=$(te,"float32");return X.complex(ue,se)}var J=A.makeOnesTypedArray(A.sizeFromShape(te),F);return g.ENGINE.makeTensor(J,te,F)},m.zeros=$,m.fill=function(W,te,F){return g.ENGINE.runKernelFunc(function(ue){return ue.fill(W,te,F)},{})},m.linspace=function(W,te,F){if(F<=0)throw new Error("The number of values should be positive.");return g.ENGINE.runKernelFunc(function(ue){return ue.linspace(W,te,F)},{})},m.range=function(W,te,F,ue){if(F===void 0&&(F=1),ue===void 0&&(ue="float32"),F===0)throw new Error("Cannot have a step of zero");if(W===te||W<te&&F<0||te<W&&F>1)return $([0],ue);var se=Math.abs(Math.ceil((te-W)/F)),J=A.makeZerosTypedArray(se,ue);te<W&&F===1&&(F=-1),J[0]=W;for(var me=1;me<J.length;me++)J[me]=J[me-1]+F;return V(J,ue)},m.onesLike=K.op({onesLike_:function(W){var te=I.convertToTensor(W,"x","onesLike");if(te.dtype==="complex64"){var F=m.onesLike(X.real(te)),ue=m.zerosLike(X.imag(te));return X.complex(F,ue)}return g.ENGINE.runKernelFunc(function(se){return se.onesLike(te)},{x:te},function(se,J){return{x:function(){return m.zerosLike(se)}}},"OnesLike")}}),m.zerosLike=K.op({zerosLike_:function(W){var te=I.convertToTensor(W,"x","zerosLike");return g.ENGINE.runKernelFunc(function(F){return F.zerosLike(te)},{x:te},function(F,ue){return{x:function(){return m.zerosLike(F)}}},"ZerosLike")}})},function(j,m,o){(function(g){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */var z=o(394),I=o(393),A=o(392);function X(){return M.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function K($e,et){if(X()<et)throw new RangeError("Invalid typed array length");return M.TYPED_ARRAY_SUPPORT?($e=new Uint8Array(et)).__proto__=M.prototype:($e===null&&($e=new M(et)),$e.length=et),$e}function M($e,et,Ke){if(!(M.TYPED_ARRAY_SUPPORT||this instanceof M))return new M($e,et,Ke);if(typeof $e=="number"){if(typeof et=="string")throw new Error("If encoding is specified then the first argument must be a string");return W(this,$e)}return V(this,$e,et,Ke)}function V($e,et,Ke,yt){if(typeof et=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer!="undefined"&&et instanceof ArrayBuffer?function(Dt,Lt,zn,Cn){if(Lt.byteLength,zn<0||Lt.byteLength<zn)throw new RangeError("'offset' is out of bounds");if(Lt.byteLength<zn+(Cn||0))throw new RangeError("'length' is out of bounds");return Lt=zn===void 0&&Cn===void 0?new Uint8Array(Lt):Cn===void 0?new Uint8Array(Lt,zn):new Uint8Array(Lt,zn,Cn),M.TYPED_ARRAY_SUPPORT?(Dt=Lt).__proto__=M.prototype:Dt=te(Dt,Lt),Dt}($e,et,Ke,yt):typeof et=="string"?function(Dt,Lt,zn){if(typeof zn=="string"&&zn!==""||(zn="utf8"),!M.isEncoding(zn))throw new TypeError('"encoding" must be a valid string encoding');var Cn=0|ue(Lt,zn),ar=(Dt=K(Dt,Cn)).write(Lt,zn);return ar!==Cn&&(Dt=Dt.slice(0,ar)),Dt}($e,et,Ke):function(Dt,Lt){if(M.isBuffer(Lt)){var zn=0|F(Lt.length);return(Dt=K(Dt,zn)).length===0||Lt.copy(Dt,0,0,zn),Dt}if(Lt){if(typeof ArrayBuffer!="undefined"&&Lt.buffer instanceof ArrayBuffer||"length"in Lt)return typeof Lt.length!="number"||function(Cn){return Cn!=Cn}(Lt.length)?K(Dt,0):te(Dt,Lt);if(Lt.type==="Buffer"&&A(Lt.data))return te(Dt,Lt.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}($e,et)}function $($e){if(typeof $e!="number")throw new TypeError('"size" argument must be a number');if($e<0)throw new RangeError('"size" argument must not be negative')}function W($e,et){if($(et),$e=K($e,et<0?0:0|F(et)),!M.TYPED_ARRAY_SUPPORT)for(var Ke=0;Ke<et;++Ke)$e[Ke]=0;return $e}function te($e,et){var Ke=et.length<0?0:0|F(et.length);$e=K($e,Ke);for(var yt=0;yt<Ke;yt+=1)$e[yt]=255&et[yt];return $e}function F($e){if($e>=X())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+X().toString(16)+" bytes");return 0|$e}function ue($e,et){if(M.isBuffer($e))return $e.length;if(typeof ArrayBuffer!="undefined"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView($e)||$e instanceof ArrayBuffer))return $e.byteLength;typeof $e!="string"&&($e=""+$e);var Ke=$e.length;if(Ke===0)return 0;for(var yt=!1;;)switch(et){case"ascii":case"latin1":case"binary":return Ke;case"utf8":case"utf-8":case void 0:return Hn($e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*Ke;case"hex":return Ke>>>1;case"base64":return tr($e).length;default:if(yt)return Hn($e).length;et=(""+et).toLowerCase(),yt=!0}}function se($e,et,Ke){var yt=$e[et];$e[et]=$e[Ke],$e[Ke]=yt}function J($e,et,Ke,yt,Dt){if($e.length===0)return-1;if(typeof Ke=="string"?(yt=Ke,Ke=0):Ke>2147483647?Ke=2147483647:Ke<-2147483648&&(Ke=-2147483648),Ke=+Ke,isNaN(Ke)&&(Ke=Dt?0:$e.length-1),Ke<0&&(Ke=$e.length+Ke),Ke>=$e.length){if(Dt)return-1;Ke=$e.length-1}else if(Ke<0){if(!Dt)return-1;Ke=0}if(typeof et=="string"&&(et=M.from(et,yt)),M.isBuffer(et))return et.length===0?-1:me($e,et,Ke,yt,Dt);if(typeof et=="number")return et&=255,M.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?Dt?Uint8Array.prototype.indexOf.call($e,et,Ke):Uint8Array.prototype.lastIndexOf.call($e,et,Ke):me($e,[et],Ke,yt,Dt);throw new TypeError("val must be string, number or Buffer")}function me($e,et,Ke,yt,Dt){var Lt,zn=1,Cn=$e.length,ar=et.length;if(yt!==void 0&&((yt=String(yt).toLowerCase())==="ucs2"||yt==="ucs-2"||yt==="utf16le"||yt==="utf-16le")){if($e.length<2||et.length<2)return-1;zn=2,Cn/=2,ar/=2,Ke/=2}function we(qr,Gr){return zn===1?qr[Gr]:qr.readUInt16BE(Gr*zn)}if(Dt){var lr=-1;for(Lt=Ke;Lt<Cn;Lt++)if(we($e,Lt)===we(et,lr===-1?0:Lt-lr)){if(lr===-1&&(lr=Lt),Lt-lr+1===ar)return lr*zn}else lr!==-1&&(Lt-=Lt-lr),lr=-1}else for(Ke+ar>Cn&&(Ke=Cn-ar),Lt=Ke;Lt>=0;Lt--){for(var Rr=!0,Tr=0;Tr<ar;Tr++)if(we($e,Lt+Tr)!==we(et,Tr)){Rr=!1;break}if(Rr)return Lt}return-1}function pe($e,et,Ke,yt){Ke=Number(Ke)||0;var Dt=$e.length-Ke;yt?(yt=Number(yt))>Dt&&(yt=Dt):yt=Dt;var Lt=et.length;if(Lt%2!=0)throw new TypeError("Invalid hex string");yt>Lt/2&&(yt=Lt/2);for(var zn=0;zn<yt;++zn){var Cn=parseInt(et.substr(2*zn,2),16);if(isNaN(Cn))return zn;$e[Ke+zn]=Cn}return zn}function Oe($e,et,Ke,yt){return pn(Hn(et,$e.length-Ke),$e,Ke,yt)}function Fe($e,et,Ke,yt){return pn(function(Dt){for(var Lt=[],zn=0;zn<Dt.length;++zn)Lt.push(255&Dt.charCodeAt(zn));return Lt}(et),$e,Ke,yt)}function Le($e,et,Ke,yt){return Fe($e,et,Ke,yt)}function Ae($e,et,Ke,yt){return pn(tr(et),$e,Ke,yt)}function ft($e,et,Ke,yt){return pn(function(Dt,Lt){for(var zn,Cn,ar,we=[],lr=0;lr<Dt.length&&!((Lt-=2)<0);++lr)zn=Dt.charCodeAt(lr),Cn=zn>>8,ar=zn%256,we.push(ar),we.push(Cn);return we}(et,$e.length-Ke),$e,Ke,yt)}function Mt($e,et,Ke){return et===0&&Ke===$e.length?z.fromByteArray($e):z.fromByteArray($e.slice(et,Ke))}function Xt($e,et,Ke){Ke=Math.min($e.length,Ke);for(var yt=[],Dt=et;Dt<Ke;){var Lt,zn,Cn,ar,we=$e[Dt],lr=null,Rr=we>239?4:we>223?3:we>191?2:1;if(Dt+Rr<=Ke)switch(Rr){case 1:we<128&&(lr=we);break;case 2:(192&(Lt=$e[Dt+1]))==128&&(ar=(31&we)<<6|63&Lt)>127&&(lr=ar);break;case 3:Lt=$e[Dt+1],zn=$e[Dt+2],(192&Lt)==128&&(192&zn)==128&&(ar=(15&we)<<12|(63&Lt)<<6|63&zn)>2047&&(ar<55296||ar>57343)&&(lr=ar);break;case 4:Lt=$e[Dt+1],zn=$e[Dt+2],Cn=$e[Dt+3],(192&Lt)==128&&(192&zn)==128&&(192&Cn)==128&&(ar=(15&we)<<18|(63&Lt)<<12|(63&zn)<<6|63&Cn)>65535&&ar<1114112&&(lr=ar)}lr===null?(lr=65533,Rr=1):lr>65535&&(lr-=65536,yt.push(lr>>>10&1023|55296),lr=56320|1023&lr),yt.push(lr),Dt+=Rr}return function(Tr){var qr=Tr.length;if(qr<=tn)return String.fromCharCode.apply(String,Tr);for(var Gr="",hn=0;hn<qr;)Gr+=String.fromCharCode.apply(String,Tr.slice(hn,hn+=tn));return Gr}(yt)}m.Buffer=M,m.SlowBuffer=function($e){return+$e!=$e&&($e=0),M.alloc(+$e)},m.INSPECT_MAX_BYTES=50,M.TYPED_ARRAY_SUPPORT=g.TYPED_ARRAY_SUPPORT!==void 0?g.TYPED_ARRAY_SUPPORT:function(){try{var $e=new Uint8Array(1);return $e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},$e.foo()===42&&typeof $e.subarray=="function"&&$e.subarray(1,1).byteLength===0}catch{return!1}}(),m.kMaxLength=X(),M.poolSize=8192,M._augment=function($e){return $e.__proto__=M.prototype,$e},M.from=function($e,et,Ke){return V(null,$e,et,Ke)},M.TYPED_ARRAY_SUPPORT&&(M.prototype.__proto__=Uint8Array.prototype,M.__proto__=Uint8Array,typeof Symbol!="undefined"&&Symbol.species&&M[Symbol.species]===M&&Object.defineProperty(M,Symbol.species,{value:null,configurable:!0})),M.alloc=function($e,et,Ke){return function(yt,Dt,Lt,zn){return $(Dt),Dt<=0?K(yt,Dt):Lt!==void 0?typeof zn=="string"?K(yt,Dt).fill(Lt,zn):K(yt,Dt).fill(Lt):K(yt,Dt)}(null,$e,et,Ke)},M.allocUnsafe=function($e){return W(null,$e)},M.allocUnsafeSlow=function($e){return W(null,$e)},M.isBuffer=function($e){return!($e==null||!$e._isBuffer)},M.compare=function($e,et){if(!M.isBuffer($e)||!M.isBuffer(et))throw new TypeError("Arguments must be Buffers");if($e===et)return 0;for(var Ke=$e.length,yt=et.length,Dt=0,Lt=Math.min(Ke,yt);Dt<Lt;++Dt)if($e[Dt]!==et[Dt]){Ke=$e[Dt],yt=et[Dt];break}return Ke<yt?-1:yt<Ke?1:0},M.isEncoding=function($e){switch(String($e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},M.concat=function($e,et){if(!A($e))throw new TypeError('"list" argument must be an Array of Buffers');if($e.length===0)return M.alloc(0);var Ke;if(et===void 0)for(et=0,Ke=0;Ke<$e.length;++Ke)et+=$e[Ke].length;var yt=M.allocUnsafe(et),Dt=0;for(Ke=0;Ke<$e.length;++Ke){var Lt=$e[Ke];if(!M.isBuffer(Lt))throw new TypeError('"list" argument must be an Array of Buffers');Lt.copy(yt,Dt),Dt+=Lt.length}return yt},M.byteLength=ue,M.prototype._isBuffer=!0,M.prototype.swap16=function(){var $e=this.length;if($e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var et=0;et<$e;et+=2)se(this,et,et+1);return this},M.prototype.swap32=function(){var $e=this.length;if($e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var et=0;et<$e;et+=4)se(this,et,et+3),se(this,et+1,et+2);return this},M.prototype.swap64=function(){var $e=this.length;if($e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var et=0;et<$e;et+=8)se(this,et,et+7),se(this,et+1,et+6),se(this,et+2,et+5),se(this,et+3,et+4);return this},M.prototype.toString=function(){var $e=0|this.length;return $e===0?"":arguments.length===0?Xt(this,0,$e):function(et,Ke,yt){var Dt=!1;if((Ke===void 0||Ke<0)&&(Ke=0),Ke>this.length||((yt===void 0||yt>this.length)&&(yt=this.length),yt<=0)||(yt>>>=0)<=(Ke>>>=0))return"";for(et||(et="utf8");;)switch(et){case"hex":return en(this,Ke,yt);case"utf8":case"utf-8":return Xt(this,Ke,yt);case"ascii":return Ce(this,Ke,yt);case"latin1":case"binary":return Wt(this,Ke,yt);case"base64":return Mt(this,Ke,yt);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ut(this,Ke,yt);default:if(Dt)throw new TypeError("Unknown encoding: "+et);et=(et+"").toLowerCase(),Dt=!0}}.apply(this,arguments)},M.prototype.equals=function($e){if(!M.isBuffer($e))throw new TypeError("Argument must be a Buffer");return this===$e||M.compare(this,$e)===0},M.prototype.inspect=function(){var $e="",et=m.INSPECT_MAX_BYTES;return this.length>0&&($e=this.toString("hex",0,et).match(/.{2}/g).join(" "),this.length>et&&($e+=" ... ")),"<Buffer "+$e+">"},M.prototype.compare=function($e,et,Ke,yt,Dt){if(!M.isBuffer($e))throw new TypeError("Argument must be a Buffer");if(et===void 0&&(et=0),Ke===void 0&&(Ke=$e?$e.length:0),yt===void 0&&(yt=0),Dt===void 0&&(Dt=this.length),et<0||Ke>$e.length||yt<0||Dt>this.length)throw new RangeError("out of range index");if(yt>=Dt&&et>=Ke)return 0;if(yt>=Dt)return-1;if(et>=Ke)return 1;if(et>>>=0,Ke>>>=0,yt>>>=0,Dt>>>=0,this===$e)return 0;for(var Lt=Dt-yt,zn=Ke-et,Cn=Math.min(Lt,zn),ar=this.slice(yt,Dt),we=$e.slice(et,Ke),lr=0;lr<Cn;++lr)if(ar[lr]!==we[lr]){Lt=ar[lr],zn=we[lr];break}return Lt<zn?-1:zn<Lt?1:0},M.prototype.includes=function($e,et,Ke){return this.indexOf($e,et,Ke)!==-1},M.prototype.indexOf=function($e,et,Ke){return J(this,$e,et,Ke,!0)},M.prototype.lastIndexOf=function($e,et,Ke){return J(this,$e,et,Ke,!1)},M.prototype.write=function($e,et,Ke,yt){if(et===void 0)yt="utf8",Ke=this.length,et=0;else if(Ke===void 0&&typeof et=="string")yt=et,Ke=this.length,et=0;else{if(!isFinite(et))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");et|=0,isFinite(Ke)?(Ke|=0,yt===void 0&&(yt="utf8")):(yt=Ke,Ke=void 0)}var Dt=this.length-et;if((Ke===void 0||Ke>Dt)&&(Ke=Dt),$e.length>0&&(Ke<0||et<0)||et>this.length)throw new RangeError("Attempt to write outside buffer bounds");yt||(yt="utf8");for(var Lt=!1;;)switch(yt){case"hex":return pe(this,$e,et,Ke);case"utf8":case"utf-8":return Oe(this,$e,et,Ke);case"ascii":return Fe(this,$e,et,Ke);case"latin1":case"binary":return Le(this,$e,et,Ke);case"base64":return Ae(this,$e,et,Ke);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ft(this,$e,et,Ke);default:if(Lt)throw new TypeError("Unknown encoding: "+yt);yt=(""+yt).toLowerCase(),Lt=!0}},M.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var tn=4096;function Ce($e,et,Ke){var yt="";Ke=Math.min($e.length,Ke);for(var Dt=et;Dt<Ke;++Dt)yt+=String.fromCharCode(127&$e[Dt]);return yt}function Wt($e,et,Ke){var yt="";Ke=Math.min($e.length,Ke);for(var Dt=et;Dt<Ke;++Dt)yt+=String.fromCharCode($e[Dt]);return yt}function en($e,et,Ke){var yt=$e.length;(!et||et<0)&&(et=0),(!Ke||Ke<0||Ke>yt)&&(Ke=yt);for(var Dt="",Lt=et;Lt<Ke;++Lt)Dt+=Tn($e[Lt]);return Dt}function Ut($e,et,Ke){for(var yt=$e.slice(et,Ke),Dt="",Lt=0;Lt<yt.length;Lt+=2)Dt+=String.fromCharCode(yt[Lt]+256*yt[Lt+1]);return Dt}function Qe($e,et,Ke){if($e%1!=0||$e<0)throw new RangeError("offset is not uint");if($e+et>Ke)throw new RangeError("Trying to access beyond buffer length")}function fn($e,et,Ke,yt,Dt,Lt){if(!M.isBuffer($e))throw new TypeError('"buffer" argument must be a Buffer instance');if(et>Dt||et<Lt)throw new RangeError('"value" argument is out of bounds');if(Ke+yt>$e.length)throw new RangeError("Index out of range")}function on($e,et,Ke,yt){et<0&&(et=65535+et+1);for(var Dt=0,Lt=Math.min($e.length-Ke,2);Dt<Lt;++Dt)$e[Ke+Dt]=(et&255<<8*(yt?Dt:1-Dt))>>>8*(yt?Dt:1-Dt)}function Ct($e,et,Ke,yt){et<0&&(et=4294967295+et+1);for(var Dt=0,Lt=Math.min($e.length-Ke,4);Dt<Lt;++Dt)$e[Ke+Dt]=et>>>8*(yt?Dt:3-Dt)&255}function Vt($e,et,Ke,yt,Dt,Lt){if(Ke+yt>$e.length)throw new RangeError("Index out of range");if(Ke<0)throw new RangeError("Index out of range")}function En($e,et,Ke,yt,Dt){return Dt||Vt($e,0,Ke,4),I.write($e,et,Ke,yt,23,4),Ke+4}function Pt($e,et,Ke,yt,Dt){return Dt||Vt($e,0,Ke,8),I.write($e,et,Ke,yt,52,8),Ke+8}M.prototype.slice=function($e,et){var Ke,yt=this.length;if($e=~~$e,et=et===void 0?yt:~~et,$e<0?($e+=yt)<0&&($e=0):$e>yt&&($e=yt),et<0?(et+=yt)<0&&(et=0):et>yt&&(et=yt),et<$e&&(et=$e),M.TYPED_ARRAY_SUPPORT)(Ke=this.subarray($e,et)).__proto__=M.prototype;else{var Dt=et-$e;Ke=new M(Dt,void 0);for(var Lt=0;Lt<Dt;++Lt)Ke[Lt]=this[Lt+$e]}return Ke},M.prototype.readUIntLE=function($e,et,Ke){$e|=0,et|=0,Ke||Qe($e,et,this.length);for(var yt=this[$e],Dt=1,Lt=0;++Lt<et&&(Dt*=256);)yt+=this[$e+Lt]*Dt;return yt},M.prototype.readUIntBE=function($e,et,Ke){$e|=0,et|=0,Ke||Qe($e,et,this.length);for(var yt=this[$e+--et],Dt=1;et>0&&(Dt*=256);)yt+=this[$e+--et]*Dt;return yt},M.prototype.readUInt8=function($e,et){return et||Qe($e,1,this.length),this[$e]},M.prototype.readUInt16LE=function($e,et){return et||Qe($e,2,this.length),this[$e]|this[$e+1]<<8},M.prototype.readUInt16BE=function($e,et){return et||Qe($e,2,this.length),this[$e]<<8|this[$e+1]},M.prototype.readUInt32LE=function($e,et){return et||Qe($e,4,this.length),(this[$e]|this[$e+1]<<8|this[$e+2]<<16)+16777216*this[$e+3]},M.prototype.readUInt32BE=function($e,et){return et||Qe($e,4,this.length),16777216*this[$e]+(this[$e+1]<<16|this[$e+2]<<8|this[$e+3])},M.prototype.readIntLE=function($e,et,Ke){$e|=0,et|=0,Ke||Qe($e,et,this.length);for(var yt=this[$e],Dt=1,Lt=0;++Lt<et&&(Dt*=256);)yt+=this[$e+Lt]*Dt;return yt>=(Dt*=128)&&(yt-=Math.pow(2,8*et)),yt},M.prototype.readIntBE=function($e,et,Ke){$e|=0,et|=0,Ke||Qe($e,et,this.length);for(var yt=et,Dt=1,Lt=this[$e+--yt];yt>0&&(Dt*=256);)Lt+=this[$e+--yt]*Dt;return Lt>=(Dt*=128)&&(Lt-=Math.pow(2,8*et)),Lt},M.prototype.readInt8=function($e,et){return et||Qe($e,1,this.length),128&this[$e]?-1*(255-this[$e]+1):this[$e]},M.prototype.readInt16LE=function($e,et){et||Qe($e,2,this.length);var Ke=this[$e]|this[$e+1]<<8;return 32768&Ke?4294901760|Ke:Ke},M.prototype.readInt16BE=function($e,et){et||Qe($e,2,this.length);var Ke=this[$e+1]|this[$e]<<8;return 32768&Ke?4294901760|Ke:Ke},M.prototype.readInt32LE=function($e,et){return et||Qe($e,4,this.length),this[$e]|this[$e+1]<<8|this[$e+2]<<16|this[$e+3]<<24},M.prototype.readInt32BE=function($e,et){return et||Qe($e,4,this.length),this[$e]<<24|this[$e+1]<<16|this[$e+2]<<8|this[$e+3]},M.prototype.readFloatLE=function($e,et){return et||Qe($e,4,this.length),I.read(this,$e,!0,23,4)},M.prototype.readFloatBE=function($e,et){return et||Qe($e,4,this.length),I.read(this,$e,!1,23,4)},M.prototype.readDoubleLE=function($e,et){return et||Qe($e,8,this.length),I.read(this,$e,!0,52,8)},M.prototype.readDoubleBE=function($e,et){return et||Qe($e,8,this.length),I.read(this,$e,!1,52,8)},M.prototype.writeUIntLE=function($e,et,Ke,yt){$e=+$e,et|=0,Ke|=0,yt||fn(this,$e,et,Ke,Math.pow(2,8*Ke)-1,0);var Dt=1,Lt=0;for(this[et]=255&$e;++Lt<Ke&&(Dt*=256);)this[et+Lt]=$e/Dt&255;return et+Ke},M.prototype.writeUIntBE=function($e,et,Ke,yt){$e=+$e,et|=0,Ke|=0,yt||fn(this,$e,et,Ke,Math.pow(2,8*Ke)-1,0);var Dt=Ke-1,Lt=1;for(this[et+Dt]=255&$e;--Dt>=0&&(Lt*=256);)this[et+Dt]=$e/Lt&255;return et+Ke},M.prototype.writeUInt8=function($e,et,Ke){return $e=+$e,et|=0,Ke||fn(this,$e,et,1,255,0),M.TYPED_ARRAY_SUPPORT||($e=Math.floor($e)),this[et]=255&$e,et+1},M.prototype.writeUInt16LE=function($e,et,Ke){return $e=+$e,et|=0,Ke||fn(this,$e,et,2,65535,0),M.TYPED_ARRAY_SUPPORT?(this[et]=255&$e,this[et+1]=$e>>>8):on(this,$e,et,!0),et+2},M.prototype.writeUInt16BE=function($e,et,Ke){return $e=+$e,et|=0,Ke||fn(this,$e,et,2,65535,0),M.TYPED_ARRAY_SUPPORT?(this[et]=$e>>>8,this[et+1]=255&$e):on(this,$e,et,!1),et+2},M.prototype.writeUInt32LE=function($e,et,Ke){return $e=+$e,et|=0,Ke||fn(this,$e,et,4,4294967295,0),M.TYPED_ARRAY_SUPPORT?(this[et+3]=$e>>>24,this[et+2]=$e>>>16,this[et+1]=$e>>>8,this[et]=255&$e):Ct(this,$e,et,!0),et+4},M.prototype.writeUInt32BE=function($e,et,Ke){return $e=+$e,et|=0,Ke||fn(this,$e,et,4,4294967295,0),M.TYPED_ARRAY_SUPPORT?(this[et]=$e>>>24,this[et+1]=$e>>>16,this[et+2]=$e>>>8,this[et+3]=255&$e):Ct(this,$e,et,!1),et+4},M.prototype.writeIntLE=function($e,et,Ke,yt){if($e=+$e,et|=0,!yt){var Dt=Math.pow(2,8*Ke-1);fn(this,$e,et,Ke,Dt-1,-Dt)}var Lt=0,zn=1,Cn=0;for(this[et]=255&$e;++Lt<Ke&&(zn*=256);)$e<0&&Cn===0&&this[et+Lt-1]!==0&&(Cn=1),this[et+Lt]=($e/zn>>0)-Cn&255;return et+Ke},M.prototype.writeIntBE=function($e,et,Ke,yt){if($e=+$e,et|=0,!yt){var Dt=Math.pow(2,8*Ke-1);fn(this,$e,et,Ke,Dt-1,-Dt)}var Lt=Ke-1,zn=1,Cn=0;for(this[et+Lt]=255&$e;--Lt>=0&&(zn*=256);)$e<0&&Cn===0&&this[et+Lt+1]!==0&&(Cn=1),this[et+Lt]=($e/zn>>0)-Cn&255;return et+Ke},M.prototype.writeInt8=function($e,et,Ke){return $e=+$e,et|=0,Ke||fn(this,$e,et,1,127,-128),M.TYPED_ARRAY_SUPPORT||($e=Math.floor($e)),$e<0&&($e=255+$e+1),this[et]=255&$e,et+1},M.prototype.writeInt16LE=function($e,et,Ke){return $e=+$e,et|=0,Ke||fn(this,$e,et,2,32767,-32768),M.TYPED_ARRAY_SUPPORT?(this[et]=255&$e,this[et+1]=$e>>>8):on(this,$e,et,!0),et+2},M.prototype.writeInt16BE=function($e,et,Ke){return $e=+$e,et|=0,Ke||fn(this,$e,et,2,32767,-32768),M.TYPED_ARRAY_SUPPORT?(this[et]=$e>>>8,this[et+1]=255&$e):on(this,$e,et,!1),et+2},M.prototype.writeInt32LE=function($e,et,Ke){return $e=+$e,et|=0,Ke||fn(this,$e,et,4,2147483647,-2147483648),M.TYPED_ARRAY_SUPPORT?(this[et]=255&$e,this[et+1]=$e>>>8,this[et+2]=$e>>>16,this[et+3]=$e>>>24):Ct(this,$e,et,!0),et+4},M.prototype.writeInt32BE=function($e,et,Ke){return $e=+$e,et|=0,Ke||fn(this,$e,et,4,2147483647,-2147483648),$e<0&&($e=4294967295+$e+1),M.TYPED_ARRAY_SUPPORT?(this[et]=$e>>>24,this[et+1]=$e>>>16,this[et+2]=$e>>>8,this[et+3]=255&$e):Ct(this,$e,et,!1),et+4},M.prototype.writeFloatLE=function($e,et,Ke){return En(this,$e,et,!0,Ke)},M.prototype.writeFloatBE=function($e,et,Ke){return En(this,$e,et,!1,Ke)},M.prototype.writeDoubleLE=function($e,et,Ke){return Pt(this,$e,et,!0,Ke)},M.prototype.writeDoubleBE=function($e,et,Ke){return Pt(this,$e,et,!1,Ke)},M.prototype.copy=function($e,et,Ke,yt){if(Ke||(Ke=0),yt||yt===0||(yt=this.length),et>=$e.length&&(et=$e.length),et||(et=0),yt>0&&yt<Ke&&(yt=Ke),yt===Ke||$e.length===0||this.length===0)return 0;if(et<0)throw new RangeError("targetStart out of bounds");if(Ke<0||Ke>=this.length)throw new RangeError("sourceStart out of bounds");if(yt<0)throw new RangeError("sourceEnd out of bounds");yt>this.length&&(yt=this.length),$e.length-et<yt-Ke&&(yt=$e.length-et+Ke);var Dt,Lt=yt-Ke;if(this===$e&&Ke<et&&et<yt)for(Dt=Lt-1;Dt>=0;--Dt)$e[Dt+et]=this[Dt+Ke];else if(Lt<1e3||!M.TYPED_ARRAY_SUPPORT)for(Dt=0;Dt<Lt;++Dt)$e[Dt+et]=this[Dt+Ke];else Uint8Array.prototype.set.call($e,this.subarray(Ke,Ke+Lt),et);return Lt},M.prototype.fill=function($e,et,Ke,yt){if(typeof $e=="string"){if(typeof et=="string"?(yt=et,et=0,Ke=this.length):typeof Ke=="string"&&(yt=Ke,Ke=this.length),$e.length===1){var Dt=$e.charCodeAt(0);Dt<256&&($e=Dt)}if(yt!==void 0&&typeof yt!="string")throw new TypeError("encoding must be a string");if(typeof yt=="string"&&!M.isEncoding(yt))throw new TypeError("Unknown encoding: "+yt)}else typeof $e=="number"&&($e&=255);if(et<0||this.length<et||this.length<Ke)throw new RangeError("Out of range index");if(Ke<=et)return this;var Lt;if(et>>>=0,Ke=Ke===void 0?this.length:Ke>>>0,$e||($e=0),typeof $e=="number")for(Lt=et;Lt<Ke;++Lt)this[Lt]=$e;else{var zn=M.isBuffer($e)?$e:Hn(new M($e,yt).toString()),Cn=zn.length;for(Lt=0;Lt<Ke-et;++Lt)this[Lt+et]=zn[Lt%Cn]}return this};var Rt=/[^+\/0-9A-Za-z-_]/g;function Tn($e){return $e<16?"0"+$e.toString(16):$e.toString(16)}function Hn($e,et){var Ke;et=et||1/0;for(var yt=$e.length,Dt=null,Lt=[],zn=0;zn<yt;++zn){if((Ke=$e.charCodeAt(zn))>55295&&Ke<57344){if(!Dt){if(Ke>56319){(et-=3)>-1&&Lt.push(239,191,189);continue}if(zn+1===yt){(et-=3)>-1&&Lt.push(239,191,189);continue}Dt=Ke;continue}if(Ke<56320){(et-=3)>-1&&Lt.push(239,191,189),Dt=Ke;continue}Ke=65536+(Dt-55296<<10|Ke-56320)}else Dt&&(et-=3)>-1&&Lt.push(239,191,189);if(Dt=null,Ke<128){if((et-=1)<0)break;Lt.push(Ke)}else if(Ke<2048){if((et-=2)<0)break;Lt.push(Ke>>6|192,63&Ke|128)}else if(Ke<65536){if((et-=3)<0)break;Lt.push(Ke>>12|224,Ke>>6&63|128,63&Ke|128)}else{if(!(Ke<1114112))throw new Error("Invalid code point");if((et-=4)<0)break;Lt.push(Ke>>18|240,Ke>>12&63|128,Ke>>6&63|128,63&Ke|128)}}return Lt}function tr($e){return z.toByteArray(function(et){if((et=function(Ke){return Ke.trim?Ke.trim():Ke.replace(/^\s+|\s+$/g,"")}(et).replace(Rt,"")).length<2)return"";for(;et.length%4!=0;)et+="=";return et}($e))}function pn($e,et,Ke,yt){for(var Dt=0;Dt<yt&&!(Dt+Ke>=et.length||Dt>=$e.length);++Dt)et[Dt+Ke]=$e[Dt];return Dt}}).call(this,o(59))},function(j,m,o){var g=o(38);j.exports=function(z,I,A){for(var X in I)g(z,X,I[X],A);return z}},function(j,m){j.exports=function(o,g,z,I){if(!(o instanceof g)||I!==void 0&&I in o)throw TypeError(z+": incorrect invocation!");return o}},function(j,m,o){var g=o(16),z=o(26),I=o(27),A=o(19)("species");j.exports=function(X){var K=g[X];I&&K&&!K[A]&&z.f(K,A,{configurable:!0,get:function(){return this}})}},function(j,m){j.exports={}},function(j,m,o){var g=o(8),z=o(61),I=o(15),A=o(169),X="["+A+"]",K=RegExp("^"+X+X+"*"),M=RegExp(X+X+"*$"),V=function(W,te,F){var ue={},se=I(function(){return!!A[W]()||"\u200B\x85"[W]()!="\u200B\x85"}),J=ue[W]=se?te($):A[W];F&&(ue[F]=J),g(g.P+g.F*se,"String",ue)},$=V.trim=function(W,te){return W=String(z(W)),1&te&&(W=W.replace(K,"")),2&te&&(W=W.replace(M,"")),W};j.exports=V},function(j,m,o){var g=o(26).f,z=o(43),I=o(19)("toStringTag");j.exports=function(A,X,K){A&&!z(A=K?A:A.prototype,I)&&g(A,I,{configurable:!0,value:X})}},function(j,m,o){var g,z=typeof Reflect=="object"?Reflect:null,I=z&&typeof z.apply=="function"?z.apply:function(J,me,pe){return Function.prototype.apply.call(J,me,pe)};g=z&&typeof z.ownKeys=="function"?z.ownKeys:Object.getOwnPropertySymbols?function(J){return Object.getOwnPropertyNames(J).concat(Object.getOwnPropertySymbols(J))}:function(J){return Object.getOwnPropertyNames(J)};var A=Number.isNaN||function(J){return J!=J};function X(){X.init.call(this)}j.exports=X,j.exports.once=function(J,me){return new Promise(function(pe,Oe){function Fe(Ae){J.removeListener(me,Le),Oe(Ae)}function Le(){typeof J.removeListener=="function"&&J.removeListener("error",Fe),pe([].slice.call(arguments))}se(J,me,Le,{once:!0}),me!=="error"&&function(Ae,ft,Mt){typeof Ae.on=="function"&&se(Ae,"error",ft,Mt)}(J,Fe,{once:!0})})},X.EventEmitter=X,X.prototype._events=void 0,X.prototype._eventsCount=0,X.prototype._maxListeners=void 0;var K=10;function M(J){if(typeof J!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof J)}function V(J){return J._maxListeners===void 0?X.defaultMaxListeners:J._maxListeners}function $(J,me,pe,Oe){var Fe,Le,Ae;if(M(pe),(Le=J._events)===void 0?(Le=J._events=Object.create(null),J._eventsCount=0):(Le.newListener!==void 0&&(J.emit("newListener",me,pe.listener?pe.listener:pe),Le=J._events),Ae=Le[me]),Ae===void 0)Ae=Le[me]=pe,++J._eventsCount;else if(typeof Ae=="function"?Ae=Le[me]=Oe?[pe,Ae]:[Ae,pe]:Oe?Ae.unshift(pe):Ae.push(pe),(Fe=V(J))>0&&Ae.length>Fe&&!Ae.warned){Ae.warned=!0;var ft=new Error("Possible EventEmitter memory leak detected. "+Ae.length+" "+String(me)+" listeners added. Use emitter.setMaxListeners() to increase limit");ft.name="MaxListenersExceededWarning",ft.emitter=J,ft.type=me,ft.count=Ae.length,function(Mt){console&&console.warn&&console.warn(Mt)}(ft)}return J}function W(J,me,pe){var Oe={fired:!1,wrapFn:void 0,target:J,type:me,listener:pe},Fe=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(Oe);return Fe.listener=pe,Oe.wrapFn=Fe,Fe}function te(J,me,pe){var Oe=J._events;if(Oe===void 0)return[];var Fe=Oe[me];return Fe===void 0?[]:typeof Fe=="function"?pe?[Fe.listener||Fe]:[Fe]:pe?function(Le){for(var Ae=new Array(Le.length),ft=0;ft<Ae.length;++ft)Ae[ft]=Le[ft].listener||Le[ft];return Ae}(Fe):ue(Fe,Fe.length)}function F(J){var me=this._events;if(me!==void 0){var pe=me[J];if(typeof pe=="function")return 1;if(pe!==void 0)return pe.length}return 0}function ue(J,me){for(var pe=new Array(me),Oe=0;Oe<me;++Oe)pe[Oe]=J[Oe];return pe}function se(J,me,pe,Oe){if(typeof J.on=="function")Oe.once?J.once(me,pe):J.on(me,pe);else{if(typeof J.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof J);J.addEventListener(me,function Fe(Le){Oe.once&&J.removeEventListener(me,Fe),pe(Le)})}}Object.defineProperty(X,"defaultMaxListeners",{enumerable:!0,get:function(){return K},set:function(J){if(typeof J!="number"||J<0||A(J))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+J+".");K=J}}),X.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},X.prototype.setMaxListeners=function(J){if(typeof J!="number"||J<0||A(J))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+J+".");return this._maxListeners=J,this},X.prototype.getMaxListeners=function(){return V(this)},X.prototype.emit=function(J){for(var me=[],pe=1;pe<arguments.length;pe++)me.push(arguments[pe]);var Oe=J==="error",Fe=this._events;if(Fe!==void 0)Oe=Oe&&Fe.error===void 0;else if(!Oe)return!1;if(Oe){var Le;if(me.length>0&&(Le=me[0]),Le instanceof Error)throw Le;var Ae=new Error("Unhandled error."+(Le?" ("+Le.message+")":""));throw Ae.context=Le,Ae}var ft=Fe[J];if(ft===void 0)return!1;if(typeof ft=="function")I(ft,this,me);else{var Mt=ft.length,Xt=ue(ft,Mt);for(pe=0;pe<Mt;++pe)I(Xt[pe],this,me)}return!0},X.prototype.addListener=function(J,me){return $(this,J,me,!1)},X.prototype.on=X.prototype.addListener,X.prototype.prependListener=function(J,me){return $(this,J,me,!0)},X.prototype.once=function(J,me){return M(me),this.on(J,W(this,J,me)),this},X.prototype.prependOnceListener=function(J,me){return M(me),this.prependListener(J,W(this,J,me)),this},X.prototype.removeListener=function(J,me){var pe,Oe,Fe,Le,Ae;if(M(me),(Oe=this._events)===void 0)return this;if((pe=Oe[J])===void 0)return this;if(pe===me||pe.listener===me)--this._eventsCount==0?this._events=Object.create(null):(delete Oe[J],Oe.removeListener&&this.emit("removeListener",J,pe.listener||me));else if(typeof pe!="function"){for(Fe=-1,Le=pe.length-1;Le>=0;Le--)if(pe[Le]===me||pe[Le].listener===me){Ae=pe[Le].listener,Fe=Le;break}if(Fe<0)return this;Fe===0?pe.shift():function(ft,Mt){for(;Mt+1<ft.length;Mt++)ft[Mt]=ft[Mt+1];ft.pop()}(pe,Fe),pe.length===1&&(Oe[J]=pe[0]),Oe.removeListener!==void 0&&this.emit("removeListener",J,Ae||me)}return this},X.prototype.off=X.prototype.removeListener,X.prototype.removeAllListeners=function(J){var me,pe,Oe;if((pe=this._events)===void 0)return this;if(pe.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):pe[J]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete pe[J]),this;if(arguments.length===0){var Fe,Le=Object.keys(pe);for(Oe=0;Oe<Le.length;++Oe)(Fe=Le[Oe])!=="removeListener"&&this.removeAllListeners(Fe);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(me=pe[J])=="function")this.removeListener(J,me);else if(me!==void 0)for(Oe=me.length-1;Oe>=0;Oe--)this.removeListener(J,me[Oe]);return this},X.prototype.listeners=function(J){return te(this,J,!0)},X.prototype.rawListeners=function(J){return te(this,J,!1)},X.listenerCount=function(J,me){return typeof J.listenerCount=="function"?J.listenerCount(me):F.call(J,me)},X.prototype.listenerCount=F,X.prototype.eventNames=function(){return this._eventsCount>0?g(this._events):[]}},function(j,m,o){o.d(m,"a",function(){return z}),o.d(m,"b",function(){return I}),o.d(m,"c",function(){return A}),o.d(m,"d",function(){return X});var g,z,I,A,X,K=o(246);(function(M){g=Object(K.a)(M),z=g.format,I=g.parse,A=g.utcFormat,X=g.utcParse})({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.default=function(z){return typeof z=="string"&&g.test(z)};var g=/-webkit-|-moz-|-ms-/;j.exports=m.default},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.compose=m.merge=m.$=m.style=m.presets=m.keyframes=m.fontFace=m.insertGlobal=m.insertRule=m.plugins=m.styleSheet=void 0,m.speedy=function(Ke){return $.speedy(Ke)},m.simulations=function(){var Ke=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];se=!!Ke},m.simulate=function(){for(var Ke=arguments.length,yt=Array(Ke),Dt=0;Dt<Ke;Dt++)yt[Dt]=arguments[Dt];return(yt=(0,A.default)(yt))?se?yt.reduce(function(Lt,zn){return Lt["data-simulate-"+Oe(zn)]="",Lt},{}):(J||(console.warn("can't simulate without once calling simulations(true)"),J=!0),te||F||me||(console.warn("don't use simulation outside dev"),me=!0),{}):{}},m.cssLabels=function(Ke){pe=!!Ke},m.isLikeRule=Le,m.idFor=Ae,m.css=tr,m.rehydrate=function(Ke){(0,g.default)(en,Ke.reduce(function(yt,Dt){return yt[Dt]=!0,yt},{}))},m.flush=function(){en=$.inserted={},Ut=$.registered={},fn={},$.flush(),$.inject()},m.select=$e,m.parent=function(Ke){for(var yt=arguments.length,Dt=Array(yt>1?yt-1:0),Lt=1;Lt<yt;Lt++)Dt[Lt-1]=arguments[Lt];return tr(V({},Ke+" &",Dt))},m.media=function(Ke){for(var yt=arguments.length,Dt=Array(yt>1?yt-1:0),Lt=1;Lt<yt;Lt++)Dt[Lt-1]=arguments[Lt];return tr(V({},"@media "+Ke,Dt))},m.pseudo=et,m.active=function(Ke){return et(":active",Ke)},m.any=function(Ke){return et(":any",Ke)},m.checked=function(Ke){return et(":checked",Ke)},m.disabled=function(Ke){return et(":disabled",Ke)},m.empty=function(Ke){return et(":empty",Ke)},m.enabled=function(Ke){return et(":enabled",Ke)},m._default=function(Ke){return et(":default",Ke)},m.first=function(Ke){return et(":first",Ke)},m.firstChild=function(Ke){return et(":first-child",Ke)},m.firstOfType=function(Ke){return et(":first-of-type",Ke)},m.fullscreen=function(Ke){return et(":fullscreen",Ke)},m.focus=function(Ke){return et(":focus",Ke)},m.hover=function(Ke){return et(":hover",Ke)},m.indeterminate=function(Ke){return et(":indeterminate",Ke)},m.inRange=function(Ke){return et(":in-range",Ke)},m.invalid=function(Ke){return et(":invalid",Ke)},m.lastChild=function(Ke){return et(":last-child",Ke)},m.lastOfType=function(Ke){return et(":last-of-type",Ke)},m.left=function(Ke){return et(":left",Ke)},m.link=function(Ke){return et(":link",Ke)},m.onlyChild=function(Ke){return et(":only-child",Ke)},m.onlyOfType=function(Ke){return et(":only-of-type",Ke)},m.optional=function(Ke){return et(":optional",Ke)},m.outOfRange=function(Ke){return et(":out-of-range",Ke)},m.readOnly=function(Ke){return et(":read-only",Ke)},m.readWrite=function(Ke){return et(":read-write",Ke)},m.required=function(Ke){return et(":required",Ke)},m.right=function(Ke){return et(":right",Ke)},m.root=function(Ke){return et(":root",Ke)},m.scope=function(Ke){return et(":scope",Ke)},m.target=function(Ke){return et(":target",Ke)},m.valid=function(Ke){return et(":valid",Ke)},m.visited=function(Ke){return et(":visited",Ke)},m.dir=function(Ke,yt){return et(":dir("+Ke+")",yt)},m.lang=function(Ke,yt){return et(":lang("+Ke+")",yt)},m.not=function(Ke,yt){var Dt=Ke.split(",").map(function(Lt){return Lt.trim()}).map(function(Lt){return":not("+Lt+")"});return Dt.length===1?et(":not("+Ke+")",yt):$e(Dt.join(""),yt)},m.nthChild=function(Ke,yt){return et(":nth-child("+Ke+")",yt)},m.nthLastChild=function(Ke,yt){return et(":nth-last-child("+Ke+")",yt)},m.nthLastOfType=function(Ke,yt){return et(":nth-last-of-type("+Ke+")",yt)},m.nthOfType=function(Ke,yt){return et(":nth-of-type("+Ke+")",yt)},m.after=function(Ke){return et("::after",Ke)},m.before=function(Ke){return et("::before",Ke)},m.firstLetter=function(Ke){return et("::first-letter",Ke)},m.firstLine=function(Ke){return et("::first-line",Ke)},m.selection=function(Ke){return et("::selection",Ke)},m.backdrop=function(Ke){return et("::backdrop",Ke)},m.placeholder=function(Ke){return tr({"::placeholder":Ke})},m.cssFor=function(){for(var Ke=arguments.length,yt=Array(Ke),Dt=0;Dt<Ke;Dt++)yt[Dt]=arguments[Dt];return(yt=(0,A.default)(yt))?yt.map(function(Lt){var zn={label:[]};return En(zn,{src:Lt}),Wt(Fe(zn),Ce(zn)).join("")}).join(""):""},m.attribsFor=function(){for(var Ke=arguments.length,yt=Array(Ke),Dt=0;Dt<Ke;Dt++)yt[Dt]=arguments[Dt];return(yt=(0,A.default)(yt))?yt.map(function(Lt){Ae(Lt);var zn=Object.keys(Lt)[0],Cn=Lt[zn];return zn+'="'+(Cn||"")+'"'}).join(" "):""};var g=M(o(139)),z=o(320),I=o(201),A=M(o(311)),X=o(310),K=M(o(293));function M(Ke){return Ke&&Ke.__esModule?Ke:{default:Ke}}function V(Ke,yt,Dt){return yt in Ke?Object.defineProperty(Ke,yt,{value:Dt,enumerable:!0,configurable:!0,writable:!0}):Ke[yt]=Dt,Ke}var $=m.styleSheet=new z.StyleSheet;$.inject();var W=m.plugins=$.plugins=new X.PluginSet([X.prefixes,X.contentWrap,X.fallbacks]);W.media=new X.PluginSet,W.fontFace=new X.PluginSet,W.keyframes=new X.PluginSet([X.prefixes,X.fallbacks]);var te=!1,F=!1,ue=typeof window!="undefined",se=te,J=!1,me=!1,pe=te;function Oe(Ke){var yt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return Ke.toLowerCase().replace(/[^a-z0-9]/g,yt)}function Fe(Ke){var yt=JSON.stringify(Ke),Dt=(0,K.default)(yt).toString(36);return Ke.label&&Ke.label.length>0&&te?Oe(Ke.label.join("."),"-")+"-"+Dt:Dt}function Le(Ke){var yt=Object.keys(Ke).filter(function(Dt){return Dt!=="toString"});return yt.length===1&&!!/data\-css\-([a-zA-Z0-9\-_]+)/.exec(yt[0])}function Ae(Ke){var yt=Object.keys(Ke).filter(function(Lt){return Lt!=="toString"});if(yt.length!==1)throw new Error("not a rule");var Dt=/data\-css\-([a-zA-Z0-9\-_]+)/.exec(yt[0]);if(!Dt)throw new Error("not a rule");return Dt[1]}var ft=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g;function Mt(Ke){if(Ke.indexOf(",")===-1)return[Ke];for(var yt,Dt=[],Lt=[],zn=0;yt=ft.exec(Ke);)switch(yt[0]){case"(":zn++;break;case")":zn--;break;case",":if(zn)break;Dt.push(yt.index)}for(yt=Dt.length;yt--;)Lt.unshift(Ke.slice(Dt[yt]+1)),Ke=Ke.slice(0,Dt[yt]);return Lt.unshift(Ke),Lt}function Xt(Ke,yt){if(!Ke)return yt.replace(/\&/g,"");if(!yt)return".css-"+Ke+",[data-css-"+Ke+"]";var Dt=Mt(yt).map(function(Lt){return Lt.indexOf("&")>=0?[Lt.replace(/\&/gm,".css-"+Ke),Lt.replace(/\&/gm,"[data-css-"+Ke+"]")].join(","):".css-"+Ke+Lt+",[data-css-"+Ke+"]"+Lt}).join(",");return se&&/^\&\:/.exec(yt)&&!/\s/.exec(yt)&&(Dt+=",.css-"+Ke+"[data-simulate-"+Oe(yt)+"],[data-css-"+Ke+"][data-simulate-"+Oe(yt)+"]"),Dt}function tn(Ke){var yt=Ke.selector,Dt=Ke.style,Lt=W.transform({selector:yt,style:Dt});return Lt.selector+"{"+(0,I.createMarkupForStyles)(Lt.style)+"}"}function Ce(Ke){var yt=void 0,Dt=void 0,Lt=void 0,zn=void 0;return Object.keys(Ke).forEach(function(Cn){Cn.indexOf("&")>=0?(Dt=Dt||{})[Cn]=Ke[Cn]:Cn.indexOf("@media")===0?(Lt=Lt||{})[Cn]=Ce(Ke[Cn]):Cn.indexOf("@supports")===0?(zn=zn||{})[Cn]=Ce(Ke[Cn]):Cn==="label"?Ke.label.length>0&&((yt=yt||{}).label=pe?Ke.label.join("."):""):(yt=yt||{})[Cn]=Ke[Cn]}),{plain:yt,selects:Dt,medias:Lt,supports:zn}}function Wt(Ke,yt){var Dt=[],Lt=yt.plain,zn=yt.selects,Cn=yt.medias,ar=yt.supports;return Lt&&Dt.push(tn({style:Lt,selector:Xt(Ke)})),zn&&Object.keys(zn).forEach(function(we){return Dt.push(tn({style:zn[we],selector:Xt(Ke,we)}))}),Cn&&Object.keys(Cn).forEach(function(we){return Dt.push(we+"{"+Wt(Ke,Cn[we]).join("")+"}")}),ar&&Object.keys(ar).forEach(function(we){return Dt.push(we+"{"+Wt(Ke,ar[we]).join("")+"}")}),Dt}var en=$.inserted={},Ut=$.registered={};function Qe(Ke){Ut[Ke.id]||(Ut[Ke.id]=Ke)}var fn={};function on(Ke){if(Qe(Ke),function(Dt){if(!en[Dt.id]){en[Dt.id]=!0;var Lt=Ce(Dt.style),zn=Wt(Dt.id,Lt);en[Dt.id]=!!ue||zn,zn.forEach(function(Cn){return $.insert(Cn)})}}(Ke),fn[Ke.id])return fn[Ke.id];var yt=V({},"data-css-"+Ke.id,pe&&Ke.label||"");return Object.defineProperty(yt,"toString",{enumerable:!1,value:function(){return"css-"+Ke.id}}),fn[Ke.id]=yt,yt}function Ct(Ke,yt){var Dt=Mt(Ke).map(function(Lt){return Lt.indexOf("&")>=0?Lt:"&"+Lt});return Mt(yt).map(function(Lt){return Lt.indexOf("&")>=0?Lt:"&"+Lt}).reduce(function(Lt,zn){return Lt.concat(Dt.map(function(Cn){return zn.replace(/\&/g,Cn)}))},[]).join(",")}var Vt={"::placeholder":["::-webkit-input-placeholder","::-moz-placeholder","::-ms-input-placeholder"],":fullscreen":[":-webkit-full-screen",":-moz-full-screen",":-ms-fullscreen"]};function En(Ke,yt){var Dt=yt.selector,Lt=Dt===void 0?"":Dt,zn=yt.mq,Cn=zn===void 0?"":zn,ar=yt.supp,we=ar===void 0?"":ar,lr=yt.src,Rr=lr===void 0?{}:lr;Array.isArray(Rr)||(Rr=[Rr]),(Rr=function Tr(qr){for(var Gr=[],hn=0;hn<qr.length;hn++)Gr=Array.isArray(qr[hn])?Gr.concat(Tr(qr[hn])):Gr.concat(qr[hn]);return Gr}(Rr)).forEach(function(Tr){if(Le(Tr)){var qr=function(Gr){if(Le(Gr)){var hn=Ut[Ae(Gr)];if(hn==null)throw new Error("[glamor] an unexpected rule cache miss occurred. This is probably a sign of multiple glamor instances in your app. See https://github.com/threepointone/glamor/issues/79");return hn}return Gr}(Tr);if(qr.type!=="css")throw new Error("cannot merge this rule");Tr=qr.style}(Tr=(0,A.default)(Tr))&&Tr.composes&&En(Ke,{selector:Lt,mq:Cn,supp:we,src:Tr.composes}),Object.keys(Tr||{}).forEach(function(Gr){if(function(nn){for(var an=[":",".","[",">"," "],or=!1,jn=nn.charAt(0),Fr=0;Fr<an.length;Fr++)if(jn===an[Fr]){or=!0;break}return or||nn.indexOf("&")>=0}(Gr))Vt[Gr]&&Vt[Gr].forEach(function(nn){return En(Ke,{selector:Ct(Lt,nn),mq:Cn,supp:we,src:Tr[Gr]})}),En(Ke,{selector:Ct(Lt,Gr),mq:Cn,supp:we,src:Tr[Gr]});else if(function(nn){return nn.indexOf("@media")===0}(Gr))En(Ke,{selector:Lt,mq:function(nn,an){return nn?"@media "+nn.substring(6)+" and "+an.substring(6):an}(Cn,Gr),supp:we,src:Tr[Gr]});else if(function(nn){return nn.indexOf("@supports")===0}(Gr))En(Ke,{selector:Lt,mq:Cn,supp:function(nn,an){return nn?"@supports "+nn.substring(9)+" and "+an.substring(9):an}(we,Gr),src:Tr[Gr]});else if(Gr!=="composes"){var hn=Ke;we&&(hn[we]=hn[we]||{},hn=hn[we]),Cn&&(hn[Cn]=hn[Cn]||{},hn=hn[Cn]),Lt&&(hn[Lt]=hn[Lt]||{},hn=hn[Lt]),Gr==="label"?pe&&(Ke.label=Ke.label.concat(Tr.label)):hn[Gr]=Tr[Gr]}})})}function Pt(Ke){var yt={label:[]};return En(yt,{src:Ke}),on({id:Fe(yt),style:yt,label:pe?yt.label.join("."):"",type:"css"})}var Rt={};Object.defineProperty(Rt,"toString",{enumerable:!1,value:function(){return"css-nil"}});var Tn=typeof WeakMap!="undefined"?[Rt,new WeakMap,new WeakMap,new WeakMap]:[Rt],Hn=typeof WeakMap!="undefined"?function(Ke){return function(yt){if(Tn[yt.length]){for(var Dt=Tn[yt.length],Lt=0;Lt<yt.length-1;)Dt.has(yt[Lt])||Dt.set(yt[Lt],new WeakMap),Dt=Dt.get(yt[Lt]),Lt++;if(Dt.has(yt[yt.length-1])){var zn=Dt.get(yt[Lt]);if(Ut[zn.toString().substring(4)])return zn}}var Cn=Ke(yt);if(Tn[yt.length]){for(var ar=0,we=Tn[yt.length];ar<yt.length-1;)we=we.get(yt[ar]),ar++;try{we.set(yt[ar],Cn)}catch{}}return Cn}}(Pt):Pt;function tr(){for(var Ke=arguments.length,yt=Array(Ke),Dt=0;Dt<Ke;Dt++)yt[Dt]=arguments[Dt];if(yt[0]&&yt[0].length&&yt[0].raw)throw new Error("you forgot to include glamor/babel in your babel plugins.");return(yt=(0,A.default)(yt))?Hn(yt):Rt}tr.insert=function(Ke){var yt={id:Fe(Ke),css:Ke,type:"raw"};Qe(yt),en[yt.id]||($.insert(yt.css),en[yt.id]=!!ue||[yt.css])},m.insertRule=tr.insert,tr.global=function(Ke,yt){if(yt=(0,A.default)(yt))return tr.insert(tn({selector:Ke,style:yt}))},m.insertGlobal=tr.global,tr.keyframes=function(Ke,yt){yt||(yt=Ke,Ke="animation");var Dt={id:Fe({name:Ke,kfs:yt=(0,A.default)(yt)||{}}),type:"keyframes",name:Ke,keyframes:yt};return Qe(Dt),function(Lt){if(!en[Lt.id]){var zn=Object.keys(Lt.keyframes).map(function(ar){var we=W.keyframes.transform({id:Lt.id,name:ar,style:Lt.keyframes[ar]});return we.name+"{"+(0,I.createMarkupForStyles)(we.style)+"}"}).join(""),Cn=["-webkit-","-moz-","-o-",""].map(function(ar){return"@"+ar+"keyframes "+Lt.name+"_"+Lt.id+"{"+zn+"}"});Cn.forEach(function(ar){return $.insert(ar)}),en[Lt.id]=!!ue||Cn}}(Dt),Ke+"_"+Dt.id},tr.fontFace=function(Ke){var yt={id:Fe(Ke=(0,A.default)(Ke)),type:"font-face",font:Ke};return Qe(yt),function(Dt){if(!en[Dt.id]){var Lt="@font-face{"+(0,I.createMarkupForStyles)(Dt.font)+"}";$.insert(Lt),en[Dt.id]=!!ue||[Lt]}}(yt),Ke.fontFamily},m.fontFace=tr.fontFace,m.keyframes=tr.keyframes,m.presets={mobile:"(min-width: 400px)",Mobile:"@media (min-width: 400px)",phablet:"(min-width: 550px)",Phablet:"@media (min-width: 550px)",tablet:"(min-width: 750px)",Tablet:"@media (min-width: 750px)",desktop:"(min-width: 1000px)",Desktop:"@media (min-width: 1000px)",hd:"(min-width: 1200px)",Hd:"@media (min-width: 1200px)"};var pn=m.style=tr;function $e(Ke){for(var yt=arguments.length,Dt=Array(yt>1?yt-1:0),Lt=1;Lt<yt;Lt++)Dt[Lt-1]=arguments[Lt];return Ke?tr(V({},Ke,Dt)):pn(Dt)}m.$=$e,m.merge=tr,m.compose=tr;function et(Ke){for(var yt=arguments.length,Dt=Array(yt>1?yt-1:0),Lt=1;Lt<yt;Lt++)Dt[Lt-1]=arguments[Lt];return tr(V({},Ke,Dt))}},function(j,m,o){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=function(){function I(A){this.global=A,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return I.prototype.setPlatform=function(A,X){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+X+"."),this.platformName=A,this.platform=X},I.prototype.registerFlag=function(A,X,K){if(this.flagRegistry[A]={evaluationFn:X,setHook:K},this.urlFlags[A]!=null){var M=this.urlFlags[A];console.warn("Setting feature override from URL "+A+": "+M+"."),this.set(A,M)}},I.prototype.get=function(A){return A in this.flags?this.flags[A]:(this.flags[A]=this.evaluateFlag(A),this.flags[A])},I.prototype.getNumber=function(A){return this.get(A)},I.prototype.getBool=function(A){return this.get(A)},I.prototype.getFlags=function(){return this.flags},Object.defineProperty(I.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),I.prototype.set=function(A,X){if(this.flagRegistry[A]==null)throw new Error("Cannot set flag "+A+" as it has not been registered.");this.flags[A]=X,this.flagRegistry[A].setHook!=null&&this.flagRegistry[A].setHook(X)},I.prototype.evaluateFlag=function(A){if(this.flagRegistry[A]==null)throw new Error("Cannot evaluate flag '"+A+"': no evaluation function found.");return this.flagRegistry[A].evaluationFn()},I.prototype.setFlags=function(A){this.flags=Object.assign({},A)},I.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},I.prototype.populateURLFlags=function(){var A=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var X=z(this.global.location.search);"tfjsflags"in X&&X.tfjsflags.split(",").forEach(function(K){var M=K.split(":"),V=M[0],$=M[1];A.urlFlags[V]=function(W,te){if((te=te.toLowerCase())==="true"||te==="false")return te==="true";if(""+ +te===te)return+te;throw new Error("Could not parse value flag value "+te+" for flag "+W+".")}(V,$)})}},I}();function z(I){var A={};return I.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(X){for(var K=[],M=1;M<arguments.length;M++)K[M-1]=arguments[M];return function(V,$,W){V[decodeURIComponent($)]=decodeURIComponent(W||"")}(A,K[0],K[1]),K.join("=")}),A}m.Environment=g,m.getQueryParams=z,m.env=function(){return m.ENV},m.ENV=null,m.setEnvironmentGlobal=function(I){m.ENV=I}},function(j,m,o){var g=o(14),z=o(55),I=o(19)("species");j.exports=function(A,X){var K,M=g(A).constructor;return M===void 0||(K=g(M)[I])==null?X:z(K)}},function(j,m,o){var g=o(62),z=o(19)("toStringTag"),I=g(function(){return arguments}())=="Arguments";j.exports=function(A){var X,K,M;return A===void 0?"Undefined":A===null?"Null":typeof(K=function(V,$){try{return V[$]}catch{}}(X=Object(A),z))=="string"?K:I?g(X):(M=g(X))=="Object"&&typeof X.callee=="function"?"Arguments":M}},function(j,m){m.f={}.propertyIsEnumerable},function(j,m,o){var g=o(62);j.exports=Object("z").propertyIsEnumerable(0)?Object:function(z){return g(z)=="String"?z.split(""):Object(z)}},function(j,m,o){var g=o(87);m.a=function(z){let I=z,A=z;function X(K,M,V,$){for(V==null&&(V=0),$==null&&($=K.length);V<$;){const W=V+$>>>1;A(K[W],M)<0?V=W+1:$=W}return V}return z.length===1&&(I=(K,M)=>z(K)-M,A=function(K){return(M,V)=>Object(g.a)(K(M),V)}(z)),{left:X,center:function(K,M,V,$){V==null&&(V=0),$==null&&($=K.length);const W=X(K,M,V,$-1);return W>V&&I(K[W-1],M)>-I(K[W],M)?W-1:W},right:function(K,M,V,$){for(V==null&&(V=0),$==null&&($=K.length);V<$;){const W=V+$>>>1;A(K[W],M)>0?$=W:V=W+1}return V}}}},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});const g=o(50),z=o(247),I=o(102),A=o(46);m.table=function(K,M,V={}){if(M&&M.headers==null)throw new Error('Data to render must have a "headers" property');if(M&&M.values==null)throw new Error('Data to render must have a "values" property');const $=A.getDrawArea(K),W=Object.assign({},X,V);let te=z.select($).select("table.tf-table");const F=I.css({fontSize:W.fontSize||".875rem",width:"100%",maxWidth:"64rem",marginRight:"auto",marginLeft:"auto"});if(te.size()===0&&((te=z.select($).append("table")).attr("class",` ${F} tf-table`),te.append("thead").append("tr"),te.append("tbody")),te.size()!==1)throw new Error("Error inserting table");const ue=I.css({fontWeight:"600",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )",textAlign:"left",paddingBottom:"1rem",paddingRight:"1rem",backgroundColor:"#fff"}),se=te.select("thead").select("tr").selectAll("th").data(M.headers),J=se.enter().append("th").attr("class",`${ue}`);se.merge(J).html(ft=>ft),se.exit().remove();const me=g.format(",.4~f"),pe=te.select("tbody").selectAll("tr").data(M.values),Oe=pe.enter().append("tr"),Fe=I.css({padding:"0.25rem",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )"}),Le=pe.merge(Oe).selectAll("td").data(ft=>ft),Ae=Le.enter().append("td").attr("class",`${Fe}`);Le.merge(Ae).html(ft=>typeof ft=="number"?me(ft):ft),Le.exit().remove(),pe.exit().remove()};const X={fontSize:14}},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var g=this&&this.__awaiter||function(A,X,K,M){return new(K||(K=Promise))(function(V,$){function W(ue){try{F(M.next(ue))}catch(se){$(se)}}function te(ue){try{F(M.throw(ue))}catch(se){$(se)}}function F(ue){ue.done?V(ue.value):new K(function(se){se(ue.value)}).then(W,te)}F((M=M.apply(A,X||[])).next())})};Object.defineProperty(m,"__esModule",{value:!0});const z=o(0),I=o(111);m.arrayStats=function(A){if(!Array.isArray(A))throw new Error("input must be an array");if(A.length===0)return{numVals:0,numNans:0,numZeros:0,max:void 0,min:void 0};const X=A.length;let K=-1/0,M=1/0,V=0,$=0,W=0;for(let F=0;F<X;F++){const ue=A[F];ue>K&&(K=ue),ue<M&&(M=ue),ue===0&&(V+=1),isNaN(ue)?$+=1:isFinite(ue)||(W+=1)}const te={numVals:X,numZeros:V,numNans:$,max:K,min:M,numInfs:W};return te.max===-1/0&&(te.max=NaN),te.min===1/0&&(te.min=NaN),te},m.tensorStats=function(A){return g(this,void 0,void 0,function*(){const[X,K,M]=z.tidy(()=>{const V=z.scalar(0,A.dtype);return[A.min(),A.max(),A.equal(V).sum()]});return Promise.all([A.data(),X.data(),K.data(),M.data()]).then(([V,$,W,te])=>{const F=V.length;let ue=0,se=0;for(let pe=0;pe<F;pe++){const Oe=V[pe];isNaN(Oe)?ue+=1:isFinite(Oe)||(se+=1)}let J=$[0],me=W[0];return ue===F&&(J=NaN,me=NaN),{numVals:F,numZeros:te[0],numNans:ue,min:J,max:me,numInfs:se}})})},m.confusionMatrix=function(A,X,K,M){return g(this,void 0,void 0,function*(){I.assert(A.rank===1,"labels must be a 1D tensor"),I.assert(X.rank===1,"predictions must be a 1D tensor"),I.assert(A.size===X.size,"labels and predictions must be the same length"),M!=null&&I.assert(M.size===X.size,"labels and predictions must be the same length");const V=A.cast("int32"),$=X.cast("int32");K==null&&(K=z.tidy(()=>z.maximum(V.max(),$.max()).cast("int32").dataSync()[0]+1));let W=Promise.resolve(null);return M!=null&&(W=M.data()),Promise.all([V.data(),$.data(),W]).then(([te,F,ue])=>{const se=Array(K).fill(0);for(let J=0;J<K;J++)se[J]=Array(K).fill(0);for(let J=0;J<te.length;J++){const me=te[J],pe=F[J];se[me][pe]+=ue!=null?ue[J]:1}return se})})},m.accuracy=function(A,X){return g(this,void 0,void 0,function*(){I.assertShapesMatch(A.shape,X.shape,"Error computing accuracy.");const K=A.equal(X),M=K.mean(),V=(yield M.data())[0];return z.dispose([K,M]),V})},m.perClassAccuracy=function(A,X,K){return g(this,void 0,void 0,function*(){return I.assert(A.rank===1,"labels must be a 1D tensor"),I.assert(X.rank===1,"predictions must be a 1D tensor"),I.assert(A.size===X.size,"labels and predictions must be the same length"),K==null&&(K=z.tidy(()=>z.maximum(A.max(),X.max()).dataSync()[0]+1)),Promise.all([A.data(),X.data()]).then(([M,V])=>{const $=Array(K).fill(0),W=Array(K).fill(0);for(let F=0;F<M.length;F++){const ue=M[F],se=V[F];$[ue]+=1,ue===se&&(W[ue]+=1)}const te=[];for(let F=0;F<$.length;F++)te.push({count:$[F],accuracy:$[F]===0?0:W[F]/$[F]});return te})})}},function(j,m,o){/*
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function g(I,A){if(!I)throw new Error(typeof A=="string"?A:A())}function z(I,A){if(I.length!==A.length)return!1;for(let X=0;X<I.length;X++)if(I[X]!==A[X])return!1;return!0}Object.defineProperty(m,"__esModule",{value:!0}),m.assert=g,m.assertShapesMatch=function(I,A,X=""){g(z(I,A),X+` Shapes ${I} and ${A} must match`)},m.arraysEqual=z,m.DECIMAL_PLACES_TO_CHECK=4},function(j,m,o){const g=o(47);j.exports=(z,I,A)=>{try{I=new g(I,A)}catch{return!1}return I.test(z)}},function(j,m,o){const g=Symbol("SemVer ANY");class z{static get ANY(){return g}constructor(te,F){if(F=I(F),te instanceof z){if(te.loose===!!F.loose)return te;te=te.value}M("comparator",te,F),this.options=F,this.loose=!!F.loose,this.parse(te),this.semver===g?this.value="":this.value=this.operator+this.semver.version,M("comp",this)}parse(te){const F=this.options.loose?A[X.COMPARATORLOOSE]:A[X.COMPARATOR],ue=te.match(F);if(!ue)throw new TypeError(`Invalid comparator: ${te}`);this.operator=ue[1]!==void 0?ue[1]:"",this.operator==="="&&(this.operator=""),ue[2]?this.semver=new V(ue[2],this.options.loose):this.semver=g}toString(){return this.value}test(te){if(M("Comparator.test",te,this.options.loose),this.semver===g||te===g)return!0;if(typeof te=="string")try{te=new V(te,this.options)}catch{return!1}return K(te,this.operator,this.semver,this.options)}intersects(te,F){if(!(te instanceof z))throw new TypeError("a Comparator is required");if(F&&typeof F=="object"||(F={loose:!!F,includePrerelease:!1}),this.operator==="")return this.value===""||new $(te.value,F).test(this.value);if(te.operator==="")return te.value===""||new $(this.value,F).test(te.semver);const ue=!(this.operator!==">="&&this.operator!==">"||te.operator!==">="&&te.operator!==">"),se=!(this.operator!=="<="&&this.operator!=="<"||te.operator!=="<="&&te.operator!=="<"),J=this.semver.version===te.semver.version,me=!(this.operator!==">="&&this.operator!=="<="||te.operator!==">="&&te.operator!=="<="),pe=K(this.semver,"<",te.semver,F)&&(this.operator===">="||this.operator===">")&&(te.operator==="<="||te.operator==="<"),Oe=K(this.semver,">",te.semver,F)&&(this.operator==="<="||this.operator==="<")&&(te.operator===">="||te.operator===">");return ue||se||J&&me||pe||Oe}}j.exports=z;const I=o(115),{re:A,t:X}=o(90),K=o(203),M=o(116),V=o(32),$=o(47)},function(j,m,o){const g=o(48);j.exports=(z,I,A)=>g(z,I,A)>0},function(j,m){const o=["includePrerelease","loose","rtl"];j.exports=g=>g?typeof g!="object"?{loose:!0}:o.filter(z=>g[z]).reduce((z,I)=>(z[I]=!0,z),{}):{}},function(j,m,o){(function(g){const z=typeof g=="object"&&g.env&&g.env.NODE_DEBUG&&/\bsemver\b/i.test(g.env.NODE_DEBUG)?(...I)=>console.error("SEMVER",...I):()=>{};j.exports=z}).call(this,o(75))},function(j,m){const o=Number.MAX_SAFE_INTEGER||9007199254740991;j.exports={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:o,MAX_SAFE_COMPONENT_LENGTH:16}},function(j,m,o){for(var g,z=o(16),I=o(42),A=o(84),X=A("typed_array"),K=A("view"),M=!(!z.ArrayBuffer||!z.DataView),V=M,$=0,W="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");$<9;)(g=z[W[$++]])?(I(g.prototype,X,!0),I(g.prototype,K,!0)):V=!1;j.exports={ABV:M,CONSTR:V,TYPED:X,VIEW:K}},function(j,m,o){var g=o(16),z=o(8),I=o(38),A=o(93),X=o(65),K=o(121),M=o(94),V=o(13),$=o(15),W=o(125),te=o(98),F=o(168);j.exports=function(ue,se,J,me,pe,Oe){var Fe=g[ue],Le=Fe,Ae=pe?"set":"add",ft=Le&&Le.prototype,Mt={},Xt=function(Qe){var fn=ft[Qe];I(ft,Qe,Qe=="delete"?function(on){return!(Oe&&!V(on))&&fn.call(this,on===0?0:on)}:Qe=="has"?function(on){return!(Oe&&!V(on))&&fn.call(this,on===0?0:on)}:Qe=="get"?function(on){return Oe&&!V(on)?void 0:fn.call(this,on===0?0:on)}:Qe=="add"?function(on){return fn.call(this,on===0?0:on),this}:function(on,Ct){return fn.call(this,on===0?0:on,Ct),this})};if(typeof Le=="function"&&(Oe||ft.forEach&&!$(function(){new Le().entries().next()}))){var tn=new Le,Ce=tn[Ae](Oe?{}:-0,1)!=tn,Wt=$(function(){tn.has(1)}),en=W(function(Qe){new Le(Qe)}),Ut=!Oe&&$(function(){for(var Qe=new Le,fn=5;fn--;)Qe[Ae](fn,fn);return!Qe.has(-0)});en||((Le=se(function(Qe,fn){M(Qe,Le,ue);var on=F(new Fe,Qe,Le);return fn!=null&&K(fn,pe,on[Ae],on),on})).prototype=ft,ft.constructor=Le),(Wt||Ut)&&(Xt("delete"),Xt("has"),pe&&Xt("get")),(Ut||Ce)&&Xt(Ae),Oe&&ft.clear&&delete ft.clear}else Le=me.getConstructor(se,ue,pe,Ae),A(Le.prototype,J),X.NEED=!0;return te(Le,ue),Mt[ue]=Le,z(z.G+z.W+z.F*(Le!=Fe),Mt),Oe||me.setStrong(Le,ue,pe),Le}},function(j,m,o){var g=o(16).navigator;j.exports=g&&g.userAgent||""},function(j,m,o){var g=o(56),z=o(225),I=o(159),A=o(14),X=o(22),K=o(157),M={},V={};(m=j.exports=function($,W,te,F,ue){var se,J,me,pe,Oe=ue?function(){return $}:K($),Fe=g(te,F,W?2:1),Le=0;if(typeof Oe!="function")throw TypeError($+" is not iterable!");if(I(Oe)){for(se=X($.length);se>Le;Le++)if((pe=W?Fe(A(J=$[Le])[0],J[1]):Fe($[Le]))===M||pe===V)return pe}else for(me=Oe.call($);!(J=me.next()).done;)if((pe=z(me,Fe,J.value,W))===M||pe===V)return pe}).BREAK=M,m.RETURN=V},function(j,m,o){o(220);var g=o(38),z=o(42),I=o(15),A=o(61),X=o(19),K=o(154),M=X("species"),V=!I(function(){var W=/./;return W.exec=function(){var te=[];return te.groups={a:"7"},te},"".replace(W,"$<a>")!=="7"}),$=function(){var W=/(?:)/,te=W.exec;W.exec=function(){return te.apply(this,arguments)};var F="ab".split(W);return F.length===2&&F[0]==="a"&&F[1]==="b"}();j.exports=function(W,te,F){var ue=X(W),se=!I(function(){var Le={};return Le[ue]=function(){return 7},""[W](Le)!=7}),J=se?!I(function(){var Le=!1,Ae=/a/;return Ae.exec=function(){return Le=!0,null},W==="split"&&(Ae.constructor={},Ae.constructor[M]=function(){return Ae}),Ae[ue](""),!Le}):void 0;if(!se||!J||W==="replace"&&!V||W==="split"&&!$){var me=/./[ue],pe=F(A,ue,""[W],function(Le,Ae,ft,Mt,Xt){return Ae.exec===K?se&&!Xt?{done:!0,value:me.call(Ae,ft,Mt)}:{done:!0,value:Le.call(ft,Ae,Mt)}:{done:!1}}),Oe=pe[0],Fe=pe[1];g(String.prototype,W,Oe),z(RegExp.prototype,ue,te==2?function(Le,Ae){return Fe.call(Le,this,Ae)}:function(Le){return Fe.call(Le,this)})}}},function(j,m,o){var g=o(105),z=RegExp.prototype.exec;j.exports=function(I,A){var X=I.exec;if(typeof X=="function"){var K=X.call(I,A);if(typeof K!="object")throw new TypeError("RegExp exec method returned something other than an Object or null");return K}if(g(I)!=="RegExp")throw new TypeError("RegExp#exec called on incompatible receiver");return z.call(I,A)}},function(j,m,o){var g=o(14);j.exports=function(){var z=g(this),I="";return z.global&&(I+="g"),z.ignoreCase&&(I+="i"),z.multiline&&(I+="m"),z.unicode&&(I+="u"),z.sticky&&(I+="y"),I}},function(j,m,o){var g=o(19)("iterator"),z=!1;try{var I=[7][g]();I.return=function(){z=!0},Array.from(I,function(){throw 2})}catch{}j.exports=function(A,X){if(!X&&!z)return!1;var K=!1;try{var M=[7],V=M[g]();V.next=function(){return{done:K=!0}},M[g]=function(){return V},A(M)}catch{}return K}},function(j,m,o){var g=o(62);j.exports=Array.isArray||function(z){return g(z)=="Array"}},function(j,m){m.f=Object.getOwnPropertySymbols},function(j,m,o){var g=o(41),z=o(22),I=o(81);j.exports=function(A){return function(X,K,M){var V,$=g(X),W=z($.length),te=I(M,W);if(A&&K!=K){for(;W>te;)if((V=$[te++])!=V)return!0}else for(;W>te;te++)if((A||te in $)&&$[te]===K)return A||te||0;return!A&&-1}}},function(j,m,o){var g=o(24),z=o(16),I=z["__core-js_shared__"]||(z["__core-js_shared__"]={});(j.exports=function(A,X){return I[A]||(I[A]=X!==void 0?X:{})})("versions",[]).push({version:g.version,mode:o(83)?"pure":"global",copyright:"\xA9 2020 Denis Pushkarev (zloirock.ru)"})},function(j,m,o){o.r(m),function(g,z){o.d(m,"array",function(){return zn}),o.d(m,"Dataset",function(){return Dt}),o.d(m,"zip",function(){return Cn}),o.d(m,"CSVDataset",function(){return hn}),o.d(m,"TextLineDataset",function(){return we}),o.d(m,"csv",function(){return Ei}),o.d(m,"func",function(){return mo}),o.d(m,"generator",function(){return Gi}),o.d(m,"microphone",function(){return Ot}),o.d(m,"webcam",function(){return Ui}),o.d(m,"FileDataSource",function(){return Dr}),o.d(m,"URLDataSource",function(){return ki}),o.d(m,"version_data",function(){return $r});var I=o(0),A=function($t,xe){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ge,ke){ge.__proto__=ke}||function(ge,ke){for(var Ne in ke)ke.hasOwnProperty(Ne)&&(ge[Ne]=ke[Ne])})($t,xe)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X($t,xe){function ge(){this.constructor=$t}A($t,xe),$t.prototype=xe===null?Object.create(xe):(ge.prototype=xe.prototype,new ge)}function K($t,xe,ge,ke){return new(ge||(ge=Promise))(function(Ne,ot){function xt(dr){try{yn(ke.next(dr))}catch(_n){ot(_n)}}function Ht(dr){try{yn(ke.throw(dr))}catch(_n){ot(_n)}}function yn(dr){dr.done?Ne(dr.value):new ge(function(_n){_n(dr.value)}).then(xt,Ht)}yn((ke=ke.apply($t,xe||[])).next())})}function M($t,xe){var ge,ke,Ne,ot,xt={label:0,sent:function(){if(1&Ne[0])throw Ne[1];return Ne[1]},trys:[],ops:[]};return ot={next:Ht(0),throw:Ht(1),return:Ht(2)},typeof Symbol=="function"&&(ot[Symbol.iterator]=function(){return this}),ot;function Ht(yn){return function(dr){return function(_n){if(ge)throw new TypeError("Generator is already executing.");for(;xt;)try{if(ge=1,ke&&(Ne=2&_n[0]?ke.return:_n[0]?ke.throw||((Ne=ke.return)&&Ne.call(ke),0):ke.next)&&!(Ne=Ne.call(ke,_n[1])).done)return Ne;switch(ke=0,Ne&&(_n=[2&_n[0],Ne.value]),_n[0]){case 0:case 1:Ne=_n;break;case 4:return xt.label++,{value:_n[1],done:!1};case 5:xt.label++,ke=_n[1],_n=[0];continue;case 7:_n=xt.ops.pop(),xt.trys.pop();continue;default:if(!(Ne=(Ne=xt.trys).length>0&&Ne[Ne.length-1])&&(_n[0]===6||_n[0]===2)){xt=0;continue}if(_n[0]===3&&(!Ne||_n[1]>Ne[0]&&_n[1]<Ne[3])){xt.label=_n[1];break}if(_n[0]===6&&xt.label<Ne[1]){xt.label=Ne[1],Ne=_n;break}if(Ne&&xt.label<Ne[2]){xt.label=Ne[2],xt.ops.push(_n);break}Ne[2]&&xt.ops.pop(),xt.trys.pop();continue}_n=xe.call($t,xt)}catch(In){_n=[6,In],ke=0}finally{ge=Ne=0}if(5&_n[0])throw _n[1];return{value:_n[0]?_n[1]:void 0,done:!0}}([yn,dr])}}}function V($t,xe){return $t(xe={exports:{}},xe.exports),xe.exports}var $=V(function($t){(function(xe,ge,ke){function Ne(xt,Ht){return Ht.c=xt.c,Ht.s0=xt.s0,Ht.s1=xt.s1,Ht.s2=xt.s2,Ht}function ot(xt,Ht){var yn=new function(In){var Gn,Nt=this,Ft=(Gn=4022871197,function(bn){bn=bn.toString();for(var Yt=0;Yt<bn.length;Yt++){var He=.02519603282416938*(Gn+=bn.charCodeAt(Yt));He-=Gn=He>>>0,Gn=(He*=Gn)>>>0,Gn+=4294967296*(He-=Gn)}return 23283064365386963e-26*(Gn>>>0)});Nt.next=function(){var bn=2091639*Nt.s0+23283064365386963e-26*Nt.c;return Nt.s0=Nt.s1,Nt.s1=Nt.s2,Nt.s2=bn-(Nt.c=0|bn)},Nt.c=1,Nt.s0=Ft(" "),Nt.s1=Ft(" "),Nt.s2=Ft(" "),Nt.s0-=Ft(In),Nt.s0<0&&(Nt.s0+=1),Nt.s1-=Ft(In),Nt.s1<0&&(Nt.s1+=1),Nt.s2-=Ft(In),Nt.s2<0&&(Nt.s2+=1),Ft=null}(xt),dr=Ht&&Ht.state,_n=yn.next;return _n.int32=function(){return 4294967296*yn.next()|0},_n.double=function(){return _n()+11102230246251565e-32*(2097152*_n()|0)},_n.quick=_n,dr&&(typeof dr=="object"&&Ne(dr,yn),_n.state=function(){return Ne(yn,{})}),_n}ge&&ge.exports?ge.exports=ot:this.alea=ot})(0,$t)}),W=V(function($t){(function(xe,ge,ke){function Ne(xt,Ht){return Ht.x=xt.x,Ht.y=xt.y,Ht.z=xt.z,Ht.w=xt.w,Ht}function ot(xt,Ht){var yn=new function(In){var Gn=this,Nt="";Gn.x=0,Gn.y=0,Gn.z=0,Gn.w=0,Gn.next=function(){var bn=Gn.x^Gn.x<<11;return Gn.x=Gn.y,Gn.y=Gn.z,Gn.z=Gn.w,Gn.w^=Gn.w>>>19^bn^bn>>>8},In===(0|In)?Gn.x=In:Nt+=In;for(var Ft=0;Ft<Nt.length+64;Ft++)Gn.x^=0|Nt.charCodeAt(Ft),Gn.next()}(xt),dr=Ht&&Ht.state,_n=function(){return(yn.next()>>>0)/4294967296};return _n.double=function(){do var In=((yn.next()>>>11)+(yn.next()>>>0)/4294967296)/2097152;while(In===0);return In},_n.int32=yn.next,_n.quick=_n,dr&&(typeof dr=="object"&&Ne(dr,yn),_n.state=function(){return Ne(yn,{})}),_n}ge&&ge.exports?ge.exports=ot:this.xor128=ot})(0,$t)}),te=V(function($t){(function(xe,ge,ke){function Ne(xt,Ht){return Ht.x=xt.x,Ht.y=xt.y,Ht.z=xt.z,Ht.w=xt.w,Ht.v=xt.v,Ht.d=xt.d,Ht}function ot(xt,Ht){var yn=new function(In){var Gn=this,Nt="";Gn.next=function(){var bn=Gn.x^Gn.x>>>2;return Gn.x=Gn.y,Gn.y=Gn.z,Gn.z=Gn.w,Gn.w=Gn.v,(Gn.d=Gn.d+362437|0)+(Gn.v=Gn.v^Gn.v<<4^bn^bn<<1)|0},Gn.x=0,Gn.y=0,Gn.z=0,Gn.w=0,Gn.v=0,In===(0|In)?Gn.x=In:Nt+=In;for(var Ft=0;Ft<Nt.length+64;Ft++)Gn.x^=0|Nt.charCodeAt(Ft),Ft==Nt.length&&(Gn.d=Gn.x<<10^Gn.x>>>4),Gn.next()}(xt),dr=Ht&&Ht.state,_n=function(){return(yn.next()>>>0)/4294967296};return _n.double=function(){do var In=((yn.next()>>>11)+(yn.next()>>>0)/4294967296)/2097152;while(In===0);return In},_n.int32=yn.next,_n.quick=_n,dr&&(typeof dr=="object"&&Ne(dr,yn),_n.state=function(){return Ne(yn,{})}),_n}ge&&ge.exports?ge.exports=ot:this.xorwow=ot})(0,$t)}),F=V(function($t){(function(xe,ge,ke){function Ne(xt,Ht){return Ht.x=xt.x.slice(),Ht.i=xt.i,Ht}function ot(xt,Ht){xt==null&&(xt=+new Date);var yn=new function(In){var Gn=this;Gn.next=function(){var Nt,Ft,bn=Gn.x,Yt=Gn.i;return Nt=bn[Yt],Ft=(Nt^=Nt>>>7)^Nt<<24,Ft^=(Nt=bn[Yt+1&7])^Nt>>>10,Ft^=(Nt=bn[Yt+3&7])^Nt>>>3,Ft^=(Nt=bn[Yt+4&7])^Nt<<7,Nt=bn[Yt+7&7],Ft^=(Nt^=Nt<<13)^Nt<<9,bn[Yt]=Ft,Gn.i=Yt+1&7,Ft},function(Nt,Ft){var bn,Yt=[];if(Ft===(0|Ft))Yt[0]=Ft;else for(Ft=""+Ft,bn=0;bn<Ft.length;++bn)Yt[7&bn]=Yt[7&bn]<<15^Ft.charCodeAt(bn)+Yt[bn+1&7]<<13;for(;Yt.length<8;)Yt.push(0);for(bn=0;bn<8&&Yt[bn]===0;++bn);for(bn==8?Yt[7]=-1:Yt[bn],Nt.x=Yt,Nt.i=0,bn=256;bn>0;--bn)Nt.next()}(Gn,In)}(xt),dr=Ht&&Ht.state,_n=function(){return(yn.next()>>>0)/4294967296};return _n.double=function(){do var In=((yn.next()>>>11)+(yn.next()>>>0)/4294967296)/2097152;while(In===0);return In},_n.int32=yn.next,_n.quick=_n,dr&&(dr.x&&Ne(dr,yn),_n.state=function(){return Ne(yn,{})}),_n}ge&&ge.exports?ge.exports=ot:this.xorshift7=ot})(0,$t)}),ue=V(function($t){(function(xe,ge,ke){function Ne(xt,Ht){return Ht.i=xt.i,Ht.w=xt.w,Ht.X=xt.X.slice(),Ht}function ot(xt,Ht){xt==null&&(xt=+new Date);var yn=new function(In){var Gn=this;Gn.next=function(){var Nt,Ft,bn=Gn.w,Yt=Gn.X,He=Gn.i;return Gn.w=bn=bn+1640531527|0,Ft=Yt[He+34&127],Nt=Yt[He=He+1&127],Ft^=Ft<<13,Nt^=Nt<<17,Ft^=Ft>>>15,Nt^=Nt>>>12,Ft=Yt[He]=Ft^Nt,Gn.i=He,Ft+(bn^bn>>>16)|0},function(Nt,Ft){var bn,Yt,He,$n,ur,pr=[],kr=128;for(Ft===(0|Ft)?(Yt=Ft,Ft=null):(Ft+="\0",Yt=0,kr=Math.max(kr,Ft.length)),He=0,$n=-32;$n<kr;++$n)Ft&&(Yt^=Ft.charCodeAt(($n+32)%Ft.length)),$n===0&&(ur=Yt),Yt^=Yt<<10,Yt^=Yt>>>15,Yt^=Yt<<4,Yt^=Yt>>>13,$n>=0&&(ur=ur+1640531527|0,He=(bn=pr[127&$n]^=Yt+ur)==0?He+1:0);for(He>=128&&(pr[127&(Ft&&Ft.length||0)]=-1),He=127,$n=512;$n>0;--$n)Yt=pr[He+34&127],bn=pr[He=He+1&127],Yt^=Yt<<13,bn^=bn<<17,Yt^=Yt>>>15,bn^=bn>>>12,pr[He]=Yt^bn;Nt.w=ur,Nt.X=pr,Nt.i=He}(Gn,In)}(xt),dr=Ht&&Ht.state,_n=function(){return(yn.next()>>>0)/4294967296};return _n.double=function(){do var In=((yn.next()>>>11)+(yn.next()>>>0)/4294967296)/2097152;while(In===0);return In},_n.int32=yn.next,_n.quick=_n,dr&&(dr.X&&Ne(dr,yn),_n.state=function(){return Ne(yn,{})}),_n}ge&&ge.exports?ge.exports=ot:this.xor4096=ot})(0,$t)}),se=V(function($t){(function(xe,ge,ke){function Ne(xt,Ht){return Ht.a=xt.a,Ht.b=xt.b,Ht.c=xt.c,Ht.d=xt.d,Ht}function ot(xt,Ht){var yn=new function(In){var Gn=this,Nt="";Gn.next=function(){var bn=Gn.b,Yt=Gn.c,He=Gn.d,$n=Gn.a;return bn=bn<<25^bn>>>7^Yt,Yt=Yt-He|0,He=He<<24^He>>>8^$n,$n=$n-bn|0,Gn.b=bn=bn<<20^bn>>>12^Yt,Gn.c=Yt=Yt-He|0,Gn.d=He<<16^Yt>>>16^$n,Gn.a=$n-bn|0},Gn.a=0,Gn.b=0,Gn.c=-1640531527,Gn.d=1367130551,In===Math.floor(In)?(Gn.a=In/4294967296|0,Gn.b=0|In):Nt+=In;for(var Ft=0;Ft<Nt.length+20;Ft++)Gn.b^=0|Nt.charCodeAt(Ft),Gn.next()}(xt),dr=Ht&&Ht.state,_n=function(){return(yn.next()>>>0)/4294967296};return _n.double=function(){do var In=((yn.next()>>>11)+(yn.next()>>>0)/4294967296)/2097152;while(In===0);return In},_n.int32=yn.next,_n.quick=_n,dr&&(typeof dr=="object"&&Ne(dr,yn),_n.state=function(){return Ne(yn,{})}),_n}ge&&ge.exports?ge.exports=ot:this.tychei=ot})(0,$t)}),J=V(function($t){(function(xe,ge){var ke,Ne=this,ot=256,xt=6,Ht="random",yn=ge.pow(ot,xt),dr=ge.pow(2,52),_n=2*dr,In=ot-1;function Gn(Yt,He,$n){var ur=[],pr=Ft(function Ir(ji,Do){var Bi,no=[],$i=typeof ji;if(Do&&$i=="object")for(Bi in ji)try{no.push(Ir(ji[Bi],Do-1))}catch{}return no.length?no:$i=="string"?ji:ji+"\0"}((He=He==1?{entropy:!0}:He||{}).entropy?[Yt,bn(xe)]:Yt==null?function(){try{var Ir;return ke&&(Ir=ke.randomBytes)?Ir=Ir(ot):(Ir=new Uint8Array(ot),(Ne.crypto||Ne.msCrypto).getRandomValues(Ir)),bn(Ir)}catch{var ji=Ne.navigator,Do=ji&&ji.plugins;return[+new Date,Ne,Do,Ne.screen,bn(xe)]}}():Yt,3),ur),kr=new function(Ir){var ji,Do=Ir.length,Bi=this,no=0,$i=Bi.i=Bi.j=0,mi=Bi.S=[];for(Do||(Ir=[Do++]);no<ot;)mi[no]=no++;for(no=0;no<ot;no++)mi[no]=mi[$i=In&$i+Ir[no%Do]+(ji=mi[no])],mi[$i]=ji;(Bi.g=function(ai){for(var qn,Di=0,ko=Bi.i,Zr=Bi.j,Wo=Bi.S;ai--;)qn=Wo[ko=In&ko+1],Di=Di*ot+Wo[In&(Wo[ko]=Wo[Zr=In&Zr+qn])+(Wo[Zr]=qn)];return Bi.i=ko,Bi.j=Zr,Di})(ot)}(ur),ui=function(){for(var Ir=kr.g(xt),ji=yn,Do=0;Ir<dr;)Ir=(Ir+Do)*ot,ji*=ot,Do=kr.g(1);for(;Ir>=_n;)Ir/=2,ji/=2,Do>>>=1;return(Ir+Do)/ji};return ui.int32=function(){return 0|kr.g(4)},ui.quick=function(){return kr.g(4)/4294967296},ui.double=ui,Ft(bn(kr.S),xe),(He.pass||$n||function(Ir,ji,Do,Bi){return Bi&&(Bi.S&&Nt(Bi,kr),Ir.state=function(){return Nt(kr,{})}),Do?(ge[Ht]=Ir,ji):Ir})(ui,pr,"global"in He?He.global:this==ge,He.state)}function Nt(Yt,He){return He.i=Yt.i,He.j=Yt.j,He.S=Yt.S.slice(),He}function Ft(Yt,He){for(var $n,ur=Yt+"",pr=0;pr<ur.length;)He[In&pr]=In&($n^=19*He[In&pr])+ur.charCodeAt(pr++);return bn(He)}function bn(Yt){return String.fromCharCode.apply(0,Yt)}if(ge["seed"+Ht]=Gn,Ft(ge.random(),xe),$t.exports){$t.exports=Gn;try{ke=o(387)}catch{}}})([],Math)});J.alea=$,J.xor128=W,J.xorwow=te,J.xorshift7=F,J.xor4096=ue,J.tychei=se;var me=J.alea;function pe($t,xe,ge,ke){if(ge===void 0&&(ge=new Map),ke===void 0&&(ke=new Set),$t==null)return null;if(ke.has($t))throw new Error("Circular references are not supported.");if(ge.has($t))return ge.get($t);var Ne=xe($t);if(Ne.recurse&&Ne.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(Ne.recurse){if(Ae($t)){var ot=Array.isArray($t)?[]:{};for(var xt in ke.add($t),$t){var Ht=pe($t[xt],xe,ge,ke);ot[xt]=Ht}return ke.delete($t),ot}throw new Error("Can't recurse into non-iterable type: "+$t)}return ge.set($t,Ne.value),Ne.value}function Oe($t,xe){return xe===void 0&&(xe=Fe),function ge(ke,Ne,ot){ot===void 0&&(ot=new Set);var xt=ke[0];if(ot.has(xt))throw new Error("Circular references are not supported.");var Ht=Ne(ke);if(Ht.recurse&&Ht.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(Ht.recurse){if(Ae(xt)){var yn=Array.isArray(xt)?[]:{};ot.add(xt);var dr=function(In){var Gn=ge(ke.map(function(Nt){return Nt[In]}),Ne,ot);yn[In]=Gn};for(var _n in xt)dr(_n);return ot.delete(xt),yn}throw new Error("Can't recurse into non-iterable type: "+xt)}return Ht.value}($t,xe)}function Fe($t){return $t===null?null:Ae($t[0])?{value:null,recurse:!0}:{value:$t,recurse:!1}}function Le($t,xe){return K(this,void 0,void 0,function(){var ge,ke,Ne,ot,xt,Ht;return M(this,function(yn){switch(yn.label){case 0:ge=new Map,pe($t,xe,ge),ke=0,Ne=Array.from(ge.keys()),yn.label=1;case 1:return ke<Ne.length?(ot=Ne[ke],(xt=ge.get(ot))instanceof Promise?[4,xt]:[3,3]):[3,4];case 2:Ht=yn.sent(),ge.set(ot,Ht),yn.label=3;case 3:return ke++,[3,1];case 4:return[2,pe($t,xe,ge)]}})})}function Ae($t){return $t!=null&&!ArrayBuffer.isView($t)&&(Array.isArray($t)||typeof $t=="object"&&!($t instanceof I.Tensor))}function ft($t){return function(xe,ge){return pe(xe,ge)}($t,Mt)}function Mt($t){return $t instanceof I.Tensor?{value:$t.clone(),recurse:!1}:Ae($t)?{value:null,recurse:!0}:{value:$t,recurse:!1}}var Xt=function(){function $t(xe){if(this.capacity=xe,this.begin=0,this.end=0,xe==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(xe<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(xe),this.doubledCapacity=2*xe}return $t.prototype.wrap=function(xe){for(;xe<0;)xe+=this.doubledCapacity;return xe%this.doubledCapacity},$t.prototype.get=function(xe){if(xe<0)throw new RangeError("Can't get item at a negative index.");return this.data[xe%this.capacity]},$t.prototype.set=function(xe,ge){if(xe<0)throw new RangeError("Can't set item at a negative index.");this.data[xe%this.capacity]=ge},$t.prototype.length=function(){var xe=this.end-this.begin;return xe<0&&(xe=this.doubledCapacity+xe),xe},$t.prototype.isFull=function(){return this.length()===this.capacity},$t.prototype.isEmpty=function(){return this.length()===0},$t.prototype.push=function(xe){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,xe),this.end=this.wrap(this.end+1)},$t.prototype.pushAll=function(xe){for(var ge=0,ke=xe;ge<ke.length;ge++){var Ne=ke[ge];this.push(Ne)}},$t.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var xe=this.get(this.end);return this.set(this.end,void 0),xe},$t.prototype.unshift=function(xe){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,xe)},$t.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var xe=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),xe},$t.prototype.shuffleExcise=function(xe){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var ge=this.wrap(this.begin+xe),ke=this.get(ge);return this.set(ge,this.pop()),ke},$t}(),tn=function($t){function xe(){return $t.call(this,xe.INITIAL_CAPACITY)||this}return X(xe,$t),xe.prototype.isFull=function(){return!1},xe.prototype.push=function(ge){$t.prototype.isFull.call(this)&&this.expand(),$t.prototype.push.call(this,ge)},xe.prototype.unshift=function(ge){$t.prototype.isFull.call(this)&&this.expand(),$t.prototype.unshift.call(this,ge)},xe.prototype.expand=function(){for(var ge=2*this.capacity,ke=new Array(ge),Ne=this.length(),ot=0;ot<Ne;ot++)ke[ot]=this.get(this.wrap(this.begin+ot));this.data=ke,this.capacity=ge,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=Ne},xe.INITIAL_CAPACITY=32,xe}(Xt);function Ce($t){return new Qe($t)}function Wt($t){return new fn($t)}var en,Ut=function(){function $t(){}return $t.prototype.toArray=function(){return K(this,void 0,void 0,function(){var xe,ge;return M(this,function(ke){switch(ke.label){case 0:return xe=[],[4,this.next()];case 1:ge=ke.sent(),ke.label=2;case 2:return ge.done?[3,4]:(xe.push(ge.value),[4,this.next()]);case 3:return ge=ke.sent(),[3,2];case 4:return[2,xe]}})})},$t.prototype.toArrayForTest=function(){return K(this,void 0,void 0,function(){var xe,ge,ke;return M(this,function(Ne){switch(Ne.label){case 0:return xe=this.prefetch(100),ge=[],[4,xe.next()];case 1:ke=Ne.sent(),Ne.label=2;case 2:return ke.done?[3,4]:(ge.push(ke.value),[4,xe.next()]);case 3:return ke=Ne.sent(),[3,2];case 4:return[2,ge]}})})},$t.prototype.resolveFully=function(){return K(this,void 0,void 0,function(){var xe;return M(this,function(ge){switch(ge.label){case 0:return[4,this.next()];case 1:xe=ge.sent(),ge.label=2;case 2:return xe.done?[3,4]:[4,this.next()];case 3:return xe=ge.sent(),[3,2];case 4:return[2]}})})},$t.prototype.resolveWhile=function(xe){return K(this,void 0,void 0,function(){var ge,ke;return M(this,function(Ne){switch(Ne.label){case 0:return[4,this.next()];case 1:ge=Ne.sent(),ke=xe(ge.value),Ne.label=2;case 2:return ge.done||!ke?[3,4]:[4,this.next()];case 3:return ge=Ne.sent(),ke=xe(ge.value),[3,2];case 4:return[2]}})})},$t.prototype.handleErrors=function(xe){return new Tn(this,xe)},$t.prototype.filter=function(xe){return new Pt(this,xe)},$t.prototype.map=function(xe){return new Rt(this,xe)},$t.prototype.mapAsync=function(xe){return new Hn(this,xe)},$t.prototype.serialMapAsync=function(xe){return new Hn(this,xe).serial()},$t.prototype.flatmap=function(xe){return new pn(this,xe)},$t.prototype.forEachAsync=function(xe){return K(this,void 0,void 0,function(){return M(this,function(ge){return[2,this.map(xe).resolveFully()]})})},$t.prototype.serialForEach=function(xe){return K(this,void 0,void 0,function(){return M(this,function(ge){return[2,this.serialMapAsync(xe).resolveWhile(function(ke){return ke===!0})]})})},$t.prototype.rowMajorBatch=function(xe,ge){return ge===void 0&&(ge=!0),new En(this,xe,ge)},$t.prototype.columnMajorBatch=function(xe,ge,ke){return ge===void 0&&(ge=!0),ke===void 0&&(ke=Fe),this.rowMajorBatch(xe,ge).map(function(Ne){return Oe(Ne,ke)})},$t.prototype.concatenate=function(xe,ge){return new $e(Ce([this,xe]),ge)},$t.prototype.take=function(xe){return xe<0||xe==null?this:new Vt(this,xe)},$t.prototype.skip=function(xe){return xe<0||xe==null?this:new Ct(this,xe)},$t.prototype.prefetch=function(xe){return new Ke(this,xe)},$t.prototype.shuffle=function(xe,ge){return new yt(this,xe,ge)},$t.prototype.serial=function(){return new on(this)},$t}(),Qe=function($t){function xe(ge){var ke=$t.call(this)||this;return ke.items=ge,ke.trav=0,ke}return X(xe,$t),xe.prototype.summary=function(){return"Array of "+this.items.length+" items"},xe.prototype.next=function(){return K(this,void 0,void 0,function(){var ge;return M(this,function(ke){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(ge=this.items[this.trav],this.trav++,[2,{value:ft(ge),done:!1}])})})},xe}(Ut),fn=function($t){function xe(ge){var ke=$t.call(this)||this;return ke.nextFn=ge,ke}return X(xe,$t),xe.prototype.summary=function(){return"Function call"},xe.prototype.next=function(){return K(this,void 0,void 0,function(){return M(this,function(ge){try{return[2,this.nextFn()]}catch(ke){throw ke.message="Error thrown while iterating through a dataset: "+ke.message,ke}return[2]})})},xe}(Ut),on=function($t){function xe(ge){var ke=$t.call(this)||this;return ke.upstream=ge,ke.lastRead=Promise.resolve({value:null,done:!1}),ke}return X(xe,$t),xe.prototype.summary=function(){return this.upstream.summary()+" -> Serial"},xe.prototype.next=function(){return K(this,void 0,void 0,function(){var ge=this;return M(this,function(ke){return this.lastRead=this.lastRead.then(function(){return ge.serialNext()}),[2,this.lastRead]})})},xe.prototype.serialNext=function(){return K(this,void 0,void 0,function(){return M(this,function(ge){return[2,this.upstream.next()]})})},xe}(Ut),Ct=function($t){function xe(ge,ke){var Ne=$t.call(this)||this;return Ne.upstream=ge,Ne.maxCount=ke,Ne.count=0,Ne.lastRead=Promise.resolve({value:null,done:!1}),Ne}return X(xe,$t),xe.prototype.summary=function(){return this.upstream.summary()+" -> Skip"},xe.prototype.next=function(){return K(this,void 0,void 0,function(){var ge=this;return M(this,function(ke){return this.lastRead=this.lastRead.then(function(){return ge.serialNext()}),[2,this.lastRead]})})},xe.prototype.serialNext=function(){return K(this,void 0,void 0,function(){var ge;return M(this,function(ke){switch(ke.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return(ge=ke.sent()).done?[2,ge]:(Object(I.dispose)(ge.value),[3,0]);case 2:return[2,this.upstream.next()]}})})},xe}(Ut),Vt=function($t){function xe(ge,ke){var Ne=$t.call(this)||this;return Ne.upstream=ge,Ne.maxCount=ke,Ne.count=0,Ne}return X(xe,$t),xe.prototype.summary=function(){return this.upstream.summary()+" -> Take"},xe.prototype.next=function(){return K(this,void 0,void 0,function(){return M(this,function(ge){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]})})},xe}(Ut),En=function($t){function xe(ge,ke,Ne){Ne===void 0&&(Ne=!0);var ot=$t.call(this)||this;return ot.upstream=ge,ot.batchSize=ke,ot.enableSmallLastBatch=Ne,ot.lastRead=Promise.resolve({value:null,done:!1}),ot}return X(xe,$t),xe.prototype.summary=function(){return this.upstream.summary()+" -> RowMajorBatch"},xe.prototype.next=function(){return K(this,void 0,void 0,function(){var ge=this;return M(this,function(ke){return this.lastRead=this.lastRead.then(function(){return ge.serialNext()}),[2,this.lastRead]})})},xe.prototype.serialNext=function(){return K(this,void 0,void 0,function(){var ge,ke;return M(this,function(Ne){switch(Ne.label){case 0:ge=[],Ne.label=1;case 1:return ge.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return(ke=Ne.sent()).done?this.enableSmallLastBatch&&ge.length>0?[2,{value:ge,done:!1}]:[2,{value:null,done:!0}]:(ge.push(ke.value),[3,1]);case 3:return[2,{value:ge,done:!1}]}})})},xe}(Ut),Pt=function($t){function xe(ge,ke){var Ne=$t.call(this)||this;return Ne.upstream=ge,Ne.predicate=ke,Ne.lastRead=Promise.resolve({value:null,done:!1}),Ne}return X(xe,$t),xe.prototype.summary=function(){return this.upstream.summary()+" -> Filter"},xe.prototype.next=function(){return K(this,void 0,void 0,function(){var ge=this;return M(this,function(ke){return this.lastRead=this.lastRead.then(function(){return ge.serialNext()}),[2,this.lastRead]})})},xe.prototype.serialNext=function(){return K(this,void 0,void 0,function(){var ge;return M(this,function(ke){switch(ke.label){case 0:return[4,this.upstream.next()];case 1:return(ge=ke.sent()).done||this.predicate(ge.value)?[2,ge]:(Object(I.dispose)(ge.value),[3,0]);case 2:return[2]}})})},xe}(Ut),Rt=function($t){function xe(ge,ke){var Ne=$t.call(this)||this;return Ne.upstream=ge,Ne.transform=ke,Ne}return X(xe,$t),xe.prototype.summary=function(){return this.upstream.summary()+" -> Map"},xe.prototype.next=function(){return K(this,void 0,void 0,function(){var ge,ke,Ne,ot,xt,Ht,yn;return M(this,function(dr){switch(dr.label){case 0:return[4,this.upstream.next()];case 1:if((ge=dr.sent()).done)return[2,{value:null,done:!0}];for(ke=I.tensor_util.getTensorsInContainer(ge.value),Ne=this.transform(ge.value),ot=I.tensor_util.getTensorsInContainer(Ne),xt=0,Ht=ke;xt<Ht.length;xt++)yn=Ht[xt],I.tensor_util.isTensorInList(yn,ot)||yn.dispose();return[2,{value:Ne,done:!1}]}})})},xe}(Ut),Tn=function($t){function xe(ge,ke){var Ne=$t.call(this)||this;return Ne.upstream=ge,Ne.handler=ke,Ne.count=0,Ne.lastRead=Promise.resolve({value:null,done:!1}),Ne}return X(xe,$t),xe.prototype.summary=function(){return this.upstream.summary()+" -> handleErrors"},xe.prototype.next=function(){return K(this,void 0,void 0,function(){var ge=this;return M(this,function(ke){return this.lastRead=this.lastRead.then(function(){return ge.serialNext()}),[2,this.lastRead]})})},xe.prototype.serialNext=function(){return K(this,void 0,void 0,function(){var ge;return M(this,function(ke){switch(ke.label){case 0:ke.label=1;case 1:return ke.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,ke.sent()];case 3:return ge=ke.sent(),this.handler(ge)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}})})},xe}(Ut),Hn=function($t){function xe(ge,ke){var Ne=$t.call(this)||this;return Ne.upstream=ge,Ne.transform=ke,Ne}return X(xe,$t),xe.prototype.summary=function(){return this.upstream.summary()+" -> AsyncMap"},xe.prototype.next=function(){return K(this,void 0,void 0,function(){var ge,ke,Ne,ot,xt,Ht,yn;return M(this,function(dr){switch(dr.label){case 0:return[4,this.upstream.next()];case 1:return(ge=dr.sent()).done?[2,{value:null,done:!0}]:(ke=I.tensor_util.getTensorsInContainer(ge.value),[4,this.transform(ge.value)]);case 2:for(Ne=dr.sent(),ot=I.tensor_util.getTensorsInContainer(Ne),xt=0,Ht=ke;xt<Ht.length;xt++)yn=Ht[xt],I.tensor_util.isTensorInList(yn,ot)||yn.dispose();return[2,{value:Ne,done:!1}]}})})},xe}(Ut),tr=function($t){function xe(){var ge=$t.call(this)||this;return ge.outputQueue=new tn,ge.lastRead=Promise.resolve({value:null,done:!1}),ge}return X(xe,$t),xe.prototype.next=function(){return K(this,void 0,void 0,function(){var ge=this;return M(this,function(ke){return this.lastRead=this.lastRead.then(function(){return ge.serialNext()}),[2,this.lastRead]})})},xe.prototype.serialNext=function(){return K(this,void 0,void 0,function(){return M(this,function(ge){switch(ge.label){case 0:return this.outputQueue.length()!==0?[3,2]:[4,this.pump()];case 1:return ge.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}})})},xe}(Ut),pn=function($t){function xe(ge,ke){var Ne=$t.call(this)||this;return Ne.upstream=ge,Ne.transform=ke,Ne}return X(xe,$t),xe.prototype.summary=function(){return this.upstream.summary()+" -> Flatmap"},xe.prototype.pump=function(){return K(this,void 0,void 0,function(){var ge,ke,Ne,ot,xt,Ht,yn;return M(this,function(dr){switch(dr.label){case 0:return[4,this.upstream.next()];case 1:if((ge=dr.sent()).done)return[2,!1];for(ke=I.tensor_util.getTensorsInContainer(ge.value),Ne=this.transform(ge.value),ot=I.tensor_util.getTensorsInContainer(Ne),this.outputQueue.pushAll(Ne),xt=0,Ht=ke;xt<Ht.length;xt++)yn=Ht[xt],I.tensor_util.isTensorInList(yn,ot)||yn.dispose();return[2,!0]}})})},xe}(tr),$e=function($t){function xe(ge,ke){var Ne=$t.call(this)||this;return Ne.baseErrorHandler=ke,Ne.lastRead=null,Ne.iterator=null,Ne.moreIterators=ge,Ne}return X(xe,$t),xe.prototype.summary=function(){return"TODO: fill in upstream of chained summaries -> Chained"},xe.prototype.next=function(){return K(this,void 0,void 0,function(){return M(this,function(ge){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]})})},xe.prototype.readFromChain=function(ge){return K(this,void 0,void 0,function(){var ke,Ne;return M(this,function(ot){switch(ot.label){case 0:return[4,ge];case 1:return ot.sent(),this.iterator!=null?[3,3]:[4,this.moreIterators.next()];case 2:if((ke=ot.sent()).done)return[2,{value:null,done:!0}];this.iterator=ke.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),ot.label=3;case 3:return[4,this.iterator.next()];case 4:return(Ne=ot.sent()).done?(this.iterator=null,[2,this.readFromChain(ge)]):[2,Ne]}})})},xe}(Ut);(function($t){$t[$t.FAIL=0]="FAIL",$t[$t.SHORTEST=1]="SHORTEST",$t[$t.LONGEST=2]="LONGEST"})(en||(en={}));var et=function($t){function xe(ge,ke){ke===void 0&&(ke=en.FAIL);var Ne=$t.call(this)||this;return Ne.iterators=ge,Ne.mismatchMode=ke,Ne.count=0,Ne.currentPromise=null,Ne}return X(xe,$t),xe.prototype.summary=function(){return"{TODO: fill in upstream of zip summaries} -> Zip"},xe.prototype.nextState=function(ge){return K(this,void 0,void 0,function(){function ke(Ht){return Ht instanceof Ut?{value:Ht.next().then(function(yn){return Ne++,yn.done&&ot++,yn.value}),recurse:!1}:{value:null,recurse:!0}}var Ne,ot,xt;return M(this,function(Ht){switch(Ht.label){case 0:return[4,ge];case 1:return Ht.sent(),Ne=0,ot=0,[4,Le(this.iterators,ke)];case 2:if(xt=Ht.sent(),Ne===ot)return[2,{value:null,done:!0}];if(ot>0)switch(this.mismatchMode){case en.FAIL:throw new Error("Zipped streams should have the same length. Mismatched at element "+this.count+".");case en.SHORTEST:return[2,{value:null,done:!0}];case en.LONGEST:}return this.count++,[2,{value:xt,done:!1}]}})})},xe.prototype.next=function(){return K(this,void 0,void 0,function(){return M(this,function(ge){return this.currentPromise=this.nextState(this.currentPromise),[2,this.currentPromise]})})},xe}(Ut),Ke=function($t){function xe(ge,ke){var Ne=$t.call(this)||this;return Ne.upstream=ge,Ne.bufferSize=ke,Ne.buffer=new Xt(ke),Ne}return X(xe,$t),xe.prototype.summary=function(){return this.upstream.summary()+" -> Prefetch"},xe.prototype.refill=function(){for(;!this.buffer.isFull();){var ge=this.upstream.next();this.buffer.push(ge)}},xe.prototype.next=function(){return this.refill(),this.buffer.shift()},xe}(Ut),yt=function($t){function xe(ge,ke,Ne){var ot=$t.call(this,ge,ke)||this;return ot.upstream=ge,ot.windowSize=ke,ot.upstreamExhausted=!1,ot.random=me(Ne||I.util.now().toString()),ot.lastRead=Promise.resolve({value:null,done:!1}),ot}return X(xe,$t),xe.prototype.next=function(){return K(this,void 0,void 0,function(){var ge=this;return M(this,function(ke){return this.lastRead=this.lastRead.then(function(){return ge.serialNext()}),[2,this.lastRead]})})},xe.prototype.randomInt=function(ge){return Math.floor(this.random()*ge)},xe.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},xe.prototype.serialNext=function(){return K(this,void 0,void 0,function(){var ge,ke;return M(this,function(Ne){switch(Ne.label){case 0:this.upstreamExhausted||this.refill(),Ne.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(ge=this.chooseIndex(),[4,this.buffer.shuffleExcise(ge)]);case 2:return(ke=Ne.sent()).done?(this.upstreamExhausted=!0,[3,1]):(this.refill(),[2,ke]);case 3:return[2,{value:null,done:!0}]}})})},xe}(Ke),Dt=function(){function $t(){this.size=null}return $t.prototype.batch=function(xe,ge){var ke=this;ge===void 0&&(ge=!0);var Ne=this;return I.util.assert(xe>0,function(){return`batchSize needs to be positive, but it is
      `+xe}),Lt(function(){return K(ke,void 0,void 0,function(){return M(this,function(ot){switch(ot.label){case 0:return[4,Ne.iterator()];case 1:return[2,ot.sent().columnMajorBatch(xe,ge,ar)]}})})},this.size===1/0||this.size==null?this.size:ge?Math.ceil(this.size/xe):Math.floor(this.size/xe))},$t.prototype.concatenate=function(xe){var ge=this,ke=this;return Lt(function(){return K(ge,void 0,void 0,function(){var Ne,ot;return M(this,function(xt){switch(xt.label){case 0:return[4,ke.iterator()];case 1:return ot=(Ne=xt.sent()).concatenate,[4,xe.iterator()];case 2:return[2,ot.apply(Ne,[xt.sent()])]}})})},this.size===1/0||xe.size===1/0?1/0:this.size!=null&&xe.size!=null?this.size+xe.size:null)},$t.prototype.filter=function(xe){var ge=this,ke=this;return Lt(function(){return K(ge,void 0,void 0,function(){return M(this,function(Ne){switch(Ne.label){case 0:return[4,ke.iterator()];case 1:return[2,Ne.sent().filter(function(ot){return Object(I.tidy)(function(){return xe(ot)})})]}})})},this.size===1/0?1/0:null)},$t.prototype.forEachAsync=function(xe){return K(this,void 0,void 0,function(){return M(this,function(ge){switch(ge.label){case 0:return[4,this.iterator()];case 1:return[2,ge.sent().forEachAsync(xe)]}})})},$t.prototype.forEach=function(xe){return K(this,void 0,void 0,function(){return M(this,function(ge){return Object(I.deprecationWarn)("dataset.forEach() is deprecated and will be removed. Please use dataset.forEachAsync() instead"),[2,this.forEachAsync(xe)]})})},$t.prototype.map=function(xe){var ge=this,ke=this;return Lt(function(){return K(ge,void 0,void 0,function(){return M(this,function(Ne){switch(Ne.label){case 0:return[4,ke.iterator()];case 1:return[2,Ne.sent().map(function(ot){return Object(I.tidy)(function(){return xe(ot)})})]}})})},this.size)},$t.prototype.mapAsync=function(xe){var ge=this,ke=this;return Lt(function(){return K(ge,void 0,void 0,function(){return M(this,function(Ne){switch(Ne.label){case 0:return[4,ke.iterator()];case 1:return[2,Ne.sent().mapAsync(xe)]}})})},this.size)},$t.prototype.prefetch=function(xe){var ge=this;if(xe==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var ke=this;return Lt(function(){return K(ge,void 0,void 0,function(){return M(this,function(Ne){switch(Ne.label){case 0:return[4,ke.iterator()];case 1:return[2,Ne.sent().prefetch(xe)]}})})},this.size)},$t.prototype.repeat=function(xe){var ge=this,ke=this;return Lt(function(){return K(ge,void 0,void 0,function(){var Ne=this;return M(this,function(ot){return[2,function(xt,Ht){return new $e(xt,Ht)}(Wt(function(){return K(Ne,void 0,void 0,function(){var xt;return M(this,function(Ht){switch(Ht.label){case 0:return xt={},[4,ke.iterator()];case 1:return[2,(xt.value=Ht.sent(),xt.done=!1,xt)]}})})}).take(xe))]})})},this.size!=null&&xe>0?this.size*xe:xe===0?0:this.size!=null&&(xe===void 0||xe<0)?1/0:null)},$t.prototype.skip=function(xe){var ge=this,ke=this;return Lt(function(){return K(ge,void 0,void 0,function(){return M(this,function(Ne){switch(Ne.label){case 0:return[4,ke.iterator()];case 1:return[2,Ne.sent().skip(xe)]}})})},this.size!=null&&xe>=0&&this.size>=xe?this.size-xe:this.size!=null&&(this.size<xe||xe===void 0||xe<0)?0:null)},$t.prototype.shuffle=function(xe,ge,ke){var Ne=this;if(ke===void 0&&(ke=!0),xe==null||xe<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size ("+this.size+" elements)");var ot=this,xt=me(ge||I.util.now().toString());return Lt(function(){return K(Ne,void 0,void 0,function(){var Ht;return M(this,function(yn){switch(yn.label){case 0:return Ht=xt.int32(),ke&&(Ht+=xt.int32()),[4,ot.iterator()];case 1:return[2,yn.sent().shuffle(xe,Ht.toString())]}})})},this.size)},$t.prototype.take=function(xe){var ge=this,ke=this;return Lt(function(){return K(ge,void 0,void 0,function(){return M(this,function(Ne){switch(Ne.label){case 0:return[4,ke.iterator()];case 1:return[2,Ne.sent().take(xe)]}})})},this.size!=null&&this.size>xe?xe:this.size!=null&&this.size<=xe?this.size:null)},$t.prototype.toArray=function(){return K(this,void 0,void 0,function(){return M(this,function(xe){switch(xe.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,xe.sent().toArray()]}})})},$t.prototype.toArrayForTest=function(){return K(this,void 0,void 0,function(){return M(this,function(xe){switch(xe.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,xe.sent().toArrayForTest()]}})})},$t.MAX_BUFFER_SIZE=1e4,$t}();function Lt($t,xe){return xe===void 0&&(xe=null),new(function(ge){function ke(){var Ne=ge!==null&&ge.apply(this,arguments)||this;return Ne.size=xe,Ne}return X(ke,ge),ke.prototype.iterator=function(){return K(this,void 0,void 0,function(){return M(this,function(Ne){return[2,$t()]})})},ke}(Dt))}function zn($t){var xe=this;return Lt(function(){return K(xe,void 0,void 0,function(){return M(this,function(ge){return[2,Ce($t)]})})},$t.length)}function Cn($t){var xe,ge=this;if(!Ae($t))throw new Error("The argument to zip() must be an object or array.");if(Array.isArray($t))for(var ke=0;ke<$t.length;ke++)xe=xe==null?$t[ke].size:Math.min(xe,$t[ke].size);else if($t instanceof Object)for(var Ne in $t)xe=xe==null?$t[Ne].size:Math.min(xe,$t[Ne].size);return Lt(function(){return K(ge,void 0,void 0,function(){return M(this,function(ot){switch(ot.label){case 0:return[4,Le($t,function(xt){if(xt instanceof Dt)return{value:xt.iterator(),recurse:!1};if(Ae(xt))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")})];case 1:return[2,function(xt,Ht){return Ht===void 0&&(Ht=en.FAIL),new et(xt,Ht)}(ot.sent(),en.SHORTEST)]}})})},xe)}function ar($t){return $t===null?null:function(xe){return xe==null||function(ge){return ge===null||typeof ge!="object"&&typeof ge!="function"}(xe)||Array.isArray(xe)||typeof xe=="object"&&xe instanceof I.Tensor||I.util.isTypedArray(xe)}($t[0])?{value:function(xe){if(xe.length===0)throw new Error("Can't make a batch of zero elements.");return xe[0]instanceof I.Tensor?Object(I.stack)(xe):Object(I.tensor)(xe)}($t),recurse:!1}:{value:null,recurse:!0}}var we=function($t){function xe(ge){var ke=$t.call(this)||this;return ke.input=ge,ke}return X(xe,$t),xe.prototype.iterator=function(){return K(this,void 0,void 0,function(){var ge;return M(this,function(ke){switch(ke.label){case 0:return[4,this.input.iterator()];case 1:return ge=ke.sent(),[2,ge.decodeUTF8().split(`
`).map(function(Ne){return Ne.endsWith("\r")&&(Ne=Ne.slice(0,-1)),Ne})]}})})},xe}(Dt),lr=Symbol("out"),Rr=Symbol("field"),Tr=Symbol("quote"),qr=Symbol("quoteafterquote"),Gr=Symbol("quoteinquote"),hn=function($t){function xe(ge,ke){var Ne=$t.call(this)||this;return Ne.input=ge,Ne.hasHeader=!0,Ne.fullColumnNames=null,Ne.columnNamesValidated=!1,Ne.columnConfigs=null,Ne.configuredColumnsOnly=!1,Ne.delimiter=",",Ne.delimWhitespace=!1,Ne.base=new we(ge),ke||(ke={}),Ne.hasHeader=ke.hasHeader!==!1,Ne.fullColumnNames=ke.columnNames,Ne.columnConfigs=ke.columnConfigs,Ne.configuredColumnsOnly=ke.configuredColumnsOnly,ke.delimWhitespace?(I.util.assert(ke.delimiter==null,function(){return"Delimiter should not be provided when delimWhitespace is true."}),Ne.delimWhitespace=!0,Ne.delimiter=" "):Ne.delimiter=ke.delimiter?ke.delimiter:",",Ne}return X(xe,$t),xe.prototype.columnNames=function(){return K(this,void 0,void 0,function(){return M(this,function(ge){switch(ge.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:ge.sent(),ge.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}})})},xe.prototype.setColumnNames=function(){return K(this,void 0,void 0,function(){var ge,ke,Ne,ot,xt,Ht,yn=this;return M(this,function(dr){switch(dr.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(ge=dr.sent(),!this.fullColumnNames&&!ge)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&ge&&I.util.assert(ge.length===this.fullColumnNames.length,function(){return"The length of provided columnNames ("+yn.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+ge.length.toString()+")."}),this.fullColumnNames||(this.fullColumnNames=ge),ke=this.fullColumnNames.reduce(function(_n,In){return _n[In]=_n[In]+1||1,_n},{}),Ne=Object.keys(ke).filter(function(_n){return ke[_n]>1}),I.util.assert(Ne.length===0,function(){return"Duplicate column names found: "+Ne.toString()}),this.columnConfigs){for(ot=0,xt=Object.keys(this.columnConfigs);ot<xt.length;ot++)if(Ht=xt[ot],this.fullColumnNames.indexOf(Ht)===-1)throw new Error('The key "'+Ht+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}return this.columnNamesValidated=!0,[2]}})})},xe.prototype.maybeReadHeaderLine=function(){return K(this,void 0,void 0,function(){var ge,ke;return M(this,function(Ne){switch(Ne.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return[4,Ne.sent().next()];case 2:if((ge=Ne.sent()).done)throw new Error("No data was found for CSV parsing.");return ke=ge.value,[2,this.parseRow(ke,!1)];case 3:return[2,null]}})})},xe.prototype.iterator=function(){return K(this,void 0,void 0,function(){var ge,ke=this;return M(this,function(Ne){switch(Ne.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:Ne.sent(),Ne.label=2;case 2:return[4,this.base.iterator()];case 3:return ge=Ne.sent(),this.hasHeader&&(ge=ge.skip(1)),[2,ge.map(function(ot){return ke.makeDataElement(ot)})]}})})},xe.prototype.makeDataElement=function(ge){for(var ke=this.parseRow(ge),Ne={},ot={},xt=0;xt<this.fullColumnNames.length;xt++){var Ht=this.fullColumnNames[xt],yn=this.columnConfigs?this.columnConfigs[Ht]:null;if(!this.configuredColumnsOnly||yn){var dr=ke[xt],_n=null;if(dr==="")if(yn&&yn.default!==void 0)_n=yn.default;else{if(yn&&(yn.required||yn.isLabel))throw new Error("Required column "+Ht+" is empty in this line: "+ge);_n=void 0}else{var In=Number(dr);if(isNaN(In))_n=yn&&yn.dtype==="bool"?this.getBoolean(dr):dr;else if(yn&&yn.dtype)switch(yn.dtype){case"float32":_n=In;break;case"int32":_n=Math.floor(In);break;case"bool":_n=this.getBoolean(dr);break;default:_n=In}else _n=In}yn&&yn.isLabel?ot[Ht]=_n:Ne[Ht]=_n}}return Object.keys(ot).length===0?Ne:{xs:Ne,ys:ot}},xe.prototype.getBoolean=function(ge){return ge==="1"||ge.toLowerCase()==="true"?1:0},xe.prototype.parseRow=function(ge,ke){ke===void 0&&(ke=!0);for(var Ne=[],ot=0,xt=ge.length,Ht=lr,yn=0;yn<xt;yn++)switch(Ht){case lr:switch(ge.charAt(yn)){case'"':ot=yn+1,Ht=Tr;break;case this.delimiter:if(ot=yn+1,this.delimiter===" "&&this.delimWhitespace)break;Ne.push(""),Ht=lr;break;default:Ht=Rr,ot=yn}break;case Rr:switch(ge.charAt(yn)){case this.delimiter:Ne.push(ge.substring(ot,yn)),Ht=lr,ot=yn+1}break;case Tr:switch(ge.charAt(yn)){case'"':Ht=qr}break;case qr:switch(ge.charAt(yn)){case this.delimiter:Ne.push(ge.substring(ot,yn-1)),Ht=lr,ot=yn+1;break;case'"':Ht=Tr;break;default:Ht=Gr}break;case Gr:switch(ge.charAt(yn)){case'"':Ht=Tr}}if(Ht===qr?Ne.push(ge.substring(ot,xt-1)):Ne.push(ge.substring(ot)),ke&&Ne.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have "+this.fullColumnNames.length+" elements in a row, but got "+Ne);return Ne},xe}(Dt),nn=function($t){function xe(ge){var ke=$t.call(this)||this;ke.microphoneConfig=ge,ke.isClosed=!1,ke.fftSize=ge.fftSize||1024;var Ne=Math.log2(ke.fftSize);if(ke.fftSize<0||Ne<4||Ne>14||!Number.isInteger(Ne))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got "+ke.fftSize);if(ke.numFrames=ge.numFramesPerSpectrogram||43,ke.sampleRateHz=ge.sampleRateHz,ke.columnTruncateLength=ge.columnTruncateLength||ke.fftSize,ke.audioTrackConstraints=ge.audioTrackConstraints,ke.smoothingTimeConstant=ge.smoothingTimeConstant||0,ke.includeSpectrogram=ge.includeSpectrogram!==!1,ke.includeWaveform=ge.includeWaveform===!0,!ke.includeSpectrogram&&!ke.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return ke}return X(xe,$t),xe.prototype.summary=function(){return"microphone"},xe.create=function(ge){return ge===void 0&&(ge={}),K(this,void 0,void 0,function(){var ke;return M(this,function(Ne){switch(Ne.label){case 0:if(Object(I.env)().get("IS_NODE"))throw new Error("microphone API is only supported in browser environment.");return[4,(ke=new xe(ge)).start()];case 1:return Ne.sent(),[2,ke]}})})},xe.prototype.start=function(){return K(this,void 0,void 0,function(){var ge,ke,Ne,ot;return M(this,function(xt){switch(xt.label){case 0:return xt.trys.push([0,2,,3]),ge=this,[4,navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null||this.audioTrackConstraints,video:!1})];case 1:return ge.stream=xt.sent(),[3,3];case 2:throw ke=xt.sent(),new Error("Error thrown while initializing video stream: "+ke.message);case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(Ne=window.AudioContext||window.webkitAudioContext,this.audioContext=new Ne,this.sampleRateHz){if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: Expected: "+this.sampleRateHz+"; Actual: "+this.audioContext.sampleRate)}else this.sampleRateHz=this.audioContext.sampleRate;return ot=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,ot.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}})})},xe.prototype.next=function(){return K(this,void 0,void 0,function(){var ge,ke,Ne,ot,xt;return M(this,function(Ht){switch(Ht.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return Ne=Ht.sent(),this.includeSpectrogram&&(ot=this.flattenQueue(Ne.freqDataQueue),ge=this.getTensorFromAudioDataArray(ot,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(xt=this.flattenQueue(Ne.timeDataQueue),ke=this.getTensorFromAudioDataArray(xt,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:ge,waveform:ke},done:!1}]}})})},xe.prototype.capture=function(){return K(this,void 0,void 0,function(){return M(this,function(ge){switch(ge.label){case 0:return[4,this.next()];case 1:return[2,ge.sent().value]}})})},xe.prototype.getAudioData=function(){return K(this,void 0,void 0,function(){var ge,ke,Ne,ot=this;return M(this,function(xt){return ge=[],ke=[],Ne=0,[2,new Promise(function(Ht){var yn=setInterval(function(){ot.includeSpectrogram&&(ot.analyser.getFloatFrequencyData(ot.freqData),ot.freqData[0]===-1/0&&Ht({freqDataQueue:ge,timeDataQueue:ke}),ge.push(ot.freqData.slice(0,ot.columnTruncateLength))),ot.includeWaveform&&(ot.analyser.getFloatTimeDomainData(ot.timeData),ke.push(ot.timeData.slice())),++Ne===ot.numFrames&&(clearInterval(yn),Ht({freqDataQueue:ge,timeDataQueue:ke}))},ot.fftSize/ot.sampleRateHz*1e3)})]})})},xe.prototype.stop=function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())},xe.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},xe.prototype.getSampleRate=function(){return this.sampleRateHz},xe.prototype.flattenQueue=function(ge){var ke=ge[0].length,Ne=new Float32Array(ge.length*ke);return ge.forEach(function(ot,xt){return Ne.set(ot,xt*ke)}),Ne},xe.prototype.getTensorFromAudioDataArray=function(ge,ke){var Ne=new Float32Array(I.util.sizeFromShape(ke));return Ne.set(ge,Ne.length-ge.length),Object(I.tensor)(Ne,ke)},xe}(Ut),an=function($t){function xe(ge,ke){var Ne=$t.call(this)||this;if(Ne.webcamVideoElement=ge,Ne.webcamConfig=ke,Ne.isClosed=!0,Ne.resize=!1,Ne.needToResize())if(Ne.resize=!0,Ne.cropSize=[Ne.webcamConfig.resizeHeight,Ne.webcamConfig.resizeWidth],Ne.cropBoxInd=Object(I.tensor1d)([0],"int32"),Ne.webcamConfig.centerCrop){var ot=1*Ne.webcamConfig.resizeWidth/Ne.webcamVideoElement.width,xt=1*Ne.webcamConfig.resizeHeight/Ne.webcamVideoElement.height,Ht=(1-ot)/2,yn=(1-xt)/2,dr=Ht+ot,_n=xt+yn;Ne.cropBox=Object(I.tensor2d)([yn,Ht,_n,dr],[1,4])}else Ne.cropBox=Object(I.tensor2d)([0,0,1,1],[1,4]);return Ne}return X(xe,$t),xe.prototype.summary=function(){return"webcam"},xe.create=function(ge,ke){return ke===void 0&&(ke={}),K(this,void 0,void 0,function(){var Ne;return M(this,function(ot){switch(ot.label){case 0:if(Object(I.env)().get("IS_NODE"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!ge){if(ge=document.createElement("video"),!ke.resizeWidth||!ke.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");ge.width=ke.resizeWidth,ge.height=ke.resizeHeight}return[4,(Ne=new xe(ge,ke)).start()];case 1:return ot.sent(),[2,Ne]}})})},xe.prototype.start=function(){return K(this,void 0,void 0,function(){var ge,ke,Ne=this;return M(this,function(ot){switch(ot.label){case 0:this.webcamConfig.facingMode&&I.util.assert(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",function(){return"Invalid webcam facing mode: "+Ne.webcamConfig.facingMode+". Please provide 'user' or 'environment'"}),ot.label=1;case 1:return ot.trys.push([1,3,,4]),ge=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return ge.stream=ot.sent(),[3,4];case 3:throw(ke=ot.sent()).message="Error thrown while initializing video stream: "+ke.message,ke;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(xt){console.log(xt),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise(function(xt){Ne.webcamVideoElement.onloadedmetadata=function(){xt()}})]}})})},xe.prototype.next=function(){return K(this,void 0,void 0,function(){var ge;return M(this,function(ke){if(this.isClosed)return[2,{value:null,done:!0}];try{ge=I.browser.fromPixels(this.webcamVideoElement)}catch(Ne){throw new Error("Error thrown converting video to pixels: "+JSON.stringify(Ne))}if(!this.resize)return[2,{value:ge,done:!1}];try{return[2,{value:this.cropAndResizeFrame(ge),done:!1}]}catch(Ne){throw new Error("Error thrown cropping the video: "+Ne.message)}finally{ge.dispose()}return[2]})})},xe.prototype.needToResize=function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)},xe.prototype.cropAndResizeFrame=function(ge){var ke=this;return Object(I.tidy)(function(){var Ne,ot=ge.toFloat().expandDims(0),xt=(Ne=I.image.cropAndResize(ot,ke.cropBox,ke.cropBoxInd,ke.cropSize,"bilinear")).shape;return Ne.reshape(xt.slice(1))})},xe.prototype.capture=function(){return K(this,void 0,void 0,function(){return M(this,function(ge){switch(ge.label){case 0:return[4,this.next()];case 1:return[2,ge.sent().value]}})})},xe.prototype.stop=function(){this.stream.getTracks().forEach(function(ge){return ge.stop()});try{this.webcamVideoElement.srcObject=null}catch(ge){console.log(ge),this.webcamVideoElement.src=null}this.isClosed=!0},xe.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")},xe}(Ut),or=function(){},jn=function($t){function xe(){return $t!==null&&$t.apply(this,arguments)||this}return X(xe,$t),xe.prototype.split=function(ge){return new Fr(this,ge)},xe}(Ut),Fr=function($t){function xe(ge,ke){var Ne=$t.call(this)||this;return Ne.upstream=ge,Ne.impl=new Pr(ge,ke),Ne}return X(xe,$t),xe.prototype.summary=function(){return this.impl.summary()},xe.prototype.next=function(){return K(this,void 0,void 0,function(){return M(this,function(ge){return[2,this.impl.next()]})})},xe}(jn),Pr=function($t){function xe(ge,ke){var Ne=$t.call(this)||this;return Ne.upstream=ge,Ne.separator=ke,Ne.carryover="",Ne}return X(xe,$t),xe.prototype.summary=function(){return this.upstream.summary()+" -> Split('"+this.separator+"')"},xe.prototype.pump=function(){return K(this,void 0,void 0,function(){var ge,ke,Ne,ot,xt;return M(this,function(Ht){switch(Ht.label){case 0:return[4,this.upstream.next()];case 1:if((ge=Ht.sent()).done)return this.carryover===""?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);for((ke=ge.value.split(this.separator))[0]=this.carryover+ke[0],Ne=0,ot=ke.slice(0,-1);Ne<ot.length;Ne++)xt=ot[Ne],this.outputQueue.push(xt);return this.carryover=ke[ke.length-1],[2,!0]}})})},xe}(tr),Br=function($t){function xe(){return $t!==null&&$t.apply(this,arguments)||this}return X(xe,$t),xe.prototype.decodeUTF8=function(){return new wi(this)},xe}(Ut),wi=function($t){function xe(ge){var ke=$t.call(this)||this;return ke.upstream=ge,ke.impl=new Ai(ge),ke}return X(xe,$t),xe.prototype.summary=function(){return this.impl.summary()},xe.prototype.next=function(){return K(this,void 0,void 0,function(){return M(this,function(ge){return[2,this.impl.next()]})})},xe}(jn),Ai=function($t){function xe(ge){var ke=$t.call(this)||this;if(ke.upstream=ge,Object(I.env)().get("IS_BROWSER"))ke.decoder=new TextDecoder("utf-8");else{var Ne=o(386).StringDecoder;ke.decoder=new Ne("utf8")}return ke}return X(xe,$t),xe.prototype.summary=function(){return this.upstream.summary()+" -> Utf8"},xe.prototype.pump=function(){return K(this,void 0,void 0,function(){var ge,ke,Ne;return M(this,function(ot){switch(ot.label){case 0:return[4,this.upstream.next()];case 1:return(ge=ot.sent()).done?[2,!1]:(ke=ge.value,Ne=Object(I.env)().get("IS_BROWSER")?this.decoder.decode(ke,{stream:!0}):this.decoder.write(z.from(ke.buffer)),this.outputQueue.push(Ne),[2,!0])}})})},xe}(tr),Jn=function($t){function xe(ge,ke){ke===void 0&&(ke={});var Ne=$t.call(this)||this;return Ne.file=ge,Ne.options=ke,I.util.assert(ge instanceof Uint8Array||!!Object(I.env)().get("IS_BROWSER")&&(ge instanceof File||ge instanceof Blob),function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."}),Ne.offset=ke.offset||0,Ne.chunkSize=ke.chunkSize||1048576,Ne}return X(xe,$t),xe.prototype.summary=function(){return"FileChunks "+this.file},xe.prototype.next=function(){return K(this,void 0,void 0,function(){var ge,ke,Ne=this;return M(this,function(ot){switch(ot.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(ge=new Promise(function(xt,Ht){var yn=Ne.offset+Ne.chunkSize;if(Ne.file instanceof Uint8Array)xt(new Uint8Array(Ne.file.slice(Ne.offset,yn)));else{var dr=new FileReader;dr.onload=function(In){var Gn=dr.result;if(Gn instanceof ArrayBuffer&&(Gn=new Uint8Array(Gn)),!(Gn instanceof Uint8Array))return Ht(new TypeError("FileReader returned unknown type."));xt(Gn)},dr.onabort=function(In){return Ht(new Error("Aborted"))},dr.onerror=function(In){return Ht(new Error(In.type))};var _n=Ne.file.slice(Ne.offset,yn);dr.readAsArrayBuffer(_n)}Ne.offset=yn}),ke={},[4,ge]);case 1:return[2,(ke.value=ot.sent(),ke.done=!1,ke)]}})})},xe}(Br),di=function($t){return{method:$t.method,headers:$t.headers,body:$t.body,mode:$t.mode,credentials:$t.credentials,cache:$t.cache,redirect:$t.redirect,referrer:$t.referrer,integrity:$t.integrity}};function ri($t){return typeof $t=="string"&&$t.substr(0,7)==="file://"}var Dr=function($t){function xe(ge,ke){ke===void 0&&(ke={});var Ne=$t.call(this)||this;return Ne.input=ge,Ne.options=ke,Ne}return X(xe,$t),xe.prototype.iterator=function(){return K(this,void 0,void 0,function(){var ge;return M(this,function(ke){return ri(this.input)&&Object(I.env)().get("IS_NODE")&&(ge=o(385),this.input=ge.readFileSync(this.input.substr(7))),[2,new Jn(this.input,this.options)]})})},xe}(or),ki=function($t){function xe(ge,ke){ke===void 0&&(ke={});var Ne=$t.call(this)||this;return Ne.url=ge,Ne.fileOptions=ke,Ne}return X(xe,$t),xe.prototype.iterator=function(){return K(this,void 0,void 0,function(){return M(this,function(ge){return ri(this.url)?[2,new Dr(this.url,this.fileOptions).iterator()]:[2,function(ke,Ne){return Ne===void 0&&(Ne={}),K(this,void 0,void 0,function(){var ot,xt,Ht,yn,dr;return M(this,function(_n){switch(_n.label){case 0:return typeof ke=="string"?ot=ke:(ot=ke.url,xt=di(ke)),[4,I.util.fetch(ot,xt)];case 1:return(Ht=_n.sent()).ok?(dr=Uint8Array.bind,[4,Ht.arrayBuffer()]):[3,3];case 2:return yn=new(dr.apply(Uint8Array,[void 0,_n.sent()])),[2,new Jn(yn,Ne)];case 3:throw new Error(Ht.statusText)}})})}(this.url,this.fileOptions)]})})},xe}(or);function Ei($t,xe){return xe===void 0&&(xe={}),new hn(new ki($t),xe)}function mo($t){var xe=this,ge=Wt($t);return Lt(function(){return K(xe,void 0,void 0,function(){return M(this,function(ke){return[2,ge]})})})}function Gi($t){var xe=this;return Lt(function(){return K(xe,void 0,void 0,function(){var ge;return M(this,function(ke){switch(ke.label){case 0:return[4,$t()];case 1:return ge=ke.sent(),[2,Wt(function(){return ge.next()})]}})})})}function Ui($t,xe){return K(this,void 0,void 0,function(){return M(this,function(ge){return[2,an.create($t,xe)]})})}function Ot($t){return K(this,void 0,void 0,function(){return M(this,function(xe){return[2,nn.create($t)]})})}var $r="1.7.4"}.call(this,o(59),o(92).Buffer)},function(j,m,o){function g(z){var I="";if(!z)try{z=o(185)}catch(A){I=A.toString()}return{readFile:z?function(A){return new Promise(function(X,K){z.readFile(A,function(M,V){return M?K(M):X(V)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+I)}}}o.d(m,"a",function(){return g})},function(j){j.exports={a:"0.12.2"}},function(j,m,o){var g=/("(?:[^\\"]|\\.)*")|[:,]/g;j.exports=function(z,I){var A,X,K;return I=I||{},A=JSON.stringify([1],void 0,I.indent===void 0?2:I.indent).slice(2,-3),X=A===""?1/0:I.maxLength===void 0?80:I.maxLength,K=I.replacer,function M(V,$,W){var te,F,ue,se,J,me,pe,Oe,Fe,Le,Ae,ft;if(V&&typeof V.toJSON=="function"&&(V=V.toJSON()),(Ae=JSON.stringify(V,K))===void 0)return Ae;if(pe=X-$.length-W,Ae.length<=pe&&(Fe=Ae.replace(g,function(Mt,Xt){return Xt||Mt+" "})).length<=pe)return Fe;if(K!=null&&(V=JSON.parse(Ae),K=void 0),typeof V=="object"&&V!==null){if(Oe=$+A,ue=[],F=0,Array.isArray(V))for(Le="[",te="]",pe=V.length;F<pe;F++)ue.push(M(V[F],Oe,F===pe-1?0:1)||"null");else for(Le="{",te="}",pe=(me=Object.keys(V)).length;F<pe;F++)se=me[F],J=JSON.stringify(se)+": ",(ft=M(V[se],Oe,J.length+(F===pe-1?0:1)))!==void 0&&ue.push(J+ft);if(ue.length>0)return[Le,A+ue.join(`,
`+Oe),te].join(`
`+$)}return Ae}(z,"",0)}},function(j,m,o){var g=o(31),z=Object(g.a)(function(I){I.setUTCDate(1),I.setUTCHours(0,0,0,0)},function(I,A){I.setUTCMonth(I.getUTCMonth()+A)},function(I,A){return A.getUTCMonth()-I.getUTCMonth()+12*(A.getUTCFullYear()-I.getUTCFullYear())},function(I){return I.getUTCMonth()});m.a=z,z.range},function(j,m,o){var g=o(31),z=Object(g.a)(function(I){I.setDate(1),I.setHours(0,0,0,0)},function(I,A){I.setMonth(I.getMonth()+A)},function(I,A){return A.getMonth()-I.getMonth()+12*(A.getFullYear()-I.getFullYear())},function(I){return I.getMonth()});m.a=z,z.range},function(j,m,o){(function(g){var z=o(36),I=o(275),A=o(193),X={"Content-Type":"application/x-www-form-urlencoded"};function K(V,$){!z.isUndefined(V)&&z.isUndefined(V["Content-Type"])&&(V["Content-Type"]=$)}var M={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:function(){var V;return(typeof XMLHttpRequest!="undefined"||g!==void 0&&Object.prototype.toString.call(g)==="[object process]")&&(V=o(192)),V}(),transformRequest:[function(V,$){return I($,"Accept"),I($,"Content-Type"),z.isFormData(V)||z.isArrayBuffer(V)||z.isBuffer(V)||z.isStream(V)||z.isFile(V)||z.isBlob(V)?V:z.isArrayBufferView(V)?V.buffer:z.isURLSearchParams(V)?(K($,"application/x-www-form-urlencoded;charset=utf-8"),V.toString()):z.isObject(V)||$&&$["Content-Type"]==="application/json"?(K($,"application/json"),function(W,te,F){if(z.isString(W))try{return(te||JSON.parse)(W),z.trim(W)}catch(ue){if(ue.name!=="SyntaxError")throw ue}return(F||JSON.stringify)(W)}(V)):V}],transformResponse:[function(V){var $=this.transitional,W=$&&$.silentJSONParsing,te=$&&$.forcedJSONParsing,F=!W&&this.responseType==="json";if(F||te&&z.isString(V)&&V.length)try{return JSON.parse(V)}catch(ue){if(F)throw ue.name==="SyntaxError"?A(ue,this,"E_JSON_PARSE"):ue}return V}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(V){return V>=200&&V<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};z.forEach(["delete","get","head"],function(V){M.headers[V]={}}),z.forEach(["post","put","patch"],function(V){M.headers[V]=z.merge(X)}),j.exports=M}).call(this,o(75))},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var g=this&&this.__awaiter||function($,W,te,F){return new(te||(te=Promise))(function(ue,se){function J(Oe){try{pe(F.next(Oe))}catch(Fe){se(Fe)}}function me(Oe){try{pe(F.throw(Oe))}catch(Fe){se(Fe)}}function pe(Oe){Oe.done?ue(Oe.value):new te(function(Fe){Fe(Oe.value)}).then(J,me)}pe((F=F.apply($,W||[])).next())})},z=this&&this.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(m,"__esModule",{value:!0});const I=o(50),A=z(o(88)),X=o(64),K=o(110),M=o(109),V={maxBins:12,fontSize:11};m.histogram=function($,W,te={}){return g(this,void 0,void 0,function*(){const F=function(pe){if(pe.length==null)throw new Error("input data must be an array");if(pe.length===0)return[];if(typeof pe[0]=="object"){if(pe[0].value==null)throw new Error("input data must have a value field");return pe}{const Oe=Array(pe.length);for(let Fe=0;Fe<pe.length;Fe++)Oe[Fe]={value:pe[Fe]};return Oe}}(W),ue=Object.assign({},V,te),se=X.subSurface($,"histogram");if(te.stats!==!1){const pe=X.subSurface($,"stats",{prepend:!0});(function(Oe,Fe,Le){const Ae=I.format(",.4~f"),ft=I.format(".4~p"),Mt=[],Xt=[];if(Oe.numVals!=null&&(Mt.push("Num Vals"),Xt.push(Ae(Oe.numVals))),Oe.min!=null&&(Mt.push("Min"),Xt.push(Ae(Oe.min))),Oe.max!=null&&(Mt.push("Max"),Xt.push(Ae(Oe.max))),Oe.numZeros!=null){Mt.push("# Zeros");let tn="";Oe.numVals&&(tn=Oe.numZeros>0?`(${ft(Oe.numZeros/Oe.numVals)})`:""),Xt.push(`${Ae(Oe.numZeros)} ${tn}`)}if(Oe.numNans!=null){Mt.push("# NaNs");let tn="";Oe.numVals&&(tn=Oe.numNans>0?`(${ft(Oe.numNans/Oe.numVals)})`:""),Xt.push(`${Ae(Oe.numNans)} ${tn}`)}if(Oe.numInfs!=null){Mt.push("# Infinity");let tn="";Oe.numVals&&(tn=Oe.numInfs>0?`(${ft(Oe.numInfs/Oe.numVals)})`:""),Xt.push(`${Ae(Oe.numInfs)} ${tn}`)}M.table(Fe,{headers:Mt,values:[Xt]},Le)})(te.stats?te.stats:K.arrayStats(F.map(Oe=>Oe.value)),pe,{fontSize:ue.fontSize})}if(F.length===0)return;const J=[];for(let pe=0;pe<F.length;pe++){const Oe=F[pe].value;Oe!=null&&isFinite(Oe)&&J.push(F[pe])}const me={width:ue.width||X.getDefaultWidth(se),height:ue.height||X.getDefaultHeight(se),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},data:{values:J},mark:{type:"bar",tooltip:!0},config:{axis:{labelFontSize:ue.fontSize,titleFontSize:ue.fontSize},text:{fontSize:ue.fontSize},legend:{labelFontSize:ue.fontSize,titleFontSize:ue.fontSize}},encoding:{x:{bin:{maxbins:ue.maxBins},field:"value",type:"quantitative"},y:{aggregate:"count",type:"quantitative"},color:{value:ue.color||"#001B44"}}};return A.default(se,me,{actions:!1,mode:"vega-lite",defaultStyle:!1})})}},function(j,m,o){o.r(m),o.d(m,"h",function(){return A}),o.d(m,"createElement",function(){return A}),o.d(m,"cloneElement",function(){return M}),o.d(m,"Component",function(){return Ct}),o.d(m,"render",function(){return Vt}),o.d(m,"rerender",function(){return te}),o.d(m,"options",function(){return g});var g={},z=[],I=[];function A(Pt,Rt){var Tn,Hn,tr,pn,$e=I;for(pn=arguments.length;pn-- >2;)z.push(arguments[pn]);for(Rt&&Rt.children!=null&&(z.length||z.push(Rt.children),delete Rt.children);z.length;)if((Hn=z.pop())&&Hn.pop!==void 0)for(pn=Hn.length;pn--;)z.push(Hn[pn]);else typeof Hn=="boolean"&&(Hn=null),(tr=typeof Pt!="function")&&(Hn==null?Hn="":typeof Hn=="number"?Hn=String(Hn):typeof Hn!="string"&&(tr=!1)),tr&&Tn?$e[$e.length-1]+=Hn:$e===I?$e=[Hn]:$e.push(Hn),Tn=tr;var et=new function(){};return et.nodeName=Pt,et.children=$e,et.attributes=Rt==null?void 0:Rt,et.key=Rt==null?void 0:Rt.key,g.vnode!==void 0&&g.vnode(et),et}function X(Pt,Rt){for(var Tn in Rt)Pt[Tn]=Rt[Tn];return Pt}var K=typeof Promise=="function"?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function M(Pt,Rt){return A(Pt.nodeName,X(X({},Pt.attributes),Rt),arguments.length>2?[].slice.call(arguments,2):Pt.children)}var V=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,$=[];function W(Pt){!Pt._dirty&&(Pt._dirty=!0)&&$.push(Pt)==1&&(g.debounceRendering||K)(te)}function te(){var Pt,Rt=$;for($=[];Pt=Rt.pop();)Pt._dirty&&fn(Pt)}function F(Pt,Rt,Tn){return typeof Rt=="string"||typeof Rt=="number"?Pt.splitText!==void 0:typeof Rt.nodeName=="string"?!Pt._componentConstructor&&ue(Pt,Rt.nodeName):Tn||Pt._componentConstructor===Rt.nodeName}function ue(Pt,Rt){return Pt.normalizedNodeName===Rt||Pt.nodeName.toLowerCase()===Rt.toLowerCase()}function se(Pt){var Rt=X({},Pt.attributes);Rt.children=Pt.children;var Tn=Pt.nodeName.defaultProps;if(Tn!==void 0)for(var Hn in Tn)Rt[Hn]===void 0&&(Rt[Hn]=Tn[Hn]);return Rt}function J(Pt){var Rt=Pt.parentNode;Rt&&Rt.removeChild(Pt)}function me(Pt,Rt,Tn,Hn,tr){if(Rt==="className"&&(Rt="class"),Rt!=="key")if(Rt==="ref")Tn&&Tn(null),Hn&&Hn(Pt);else if(Rt!=="class"||tr)if(Rt==="style"){if(Hn&&typeof Hn!="string"&&typeof Tn!="string"||(Pt.style.cssText=Hn||""),Hn&&typeof Hn=="object"){if(typeof Tn!="string")for(var pn in Tn)pn in Hn||(Pt.style[pn]="");for(var pn in Hn)Pt.style[pn]=typeof Hn[pn]=="number"&&V.test(pn)===!1?Hn[pn]+"px":Hn[pn]}}else if(Rt==="dangerouslySetInnerHTML")Hn&&(Pt.innerHTML=Hn.__html||"");else if(Rt[0]=="o"&&Rt[1]=="n"){var $e=Rt!==(Rt=Rt.replace(/Capture$/,""));Rt=Rt.toLowerCase().substring(2),Hn?Tn||Pt.addEventListener(Rt,pe,$e):Pt.removeEventListener(Rt,pe,$e),(Pt._listeners||(Pt._listeners={}))[Rt]=Hn}else if(Rt!=="list"&&Rt!=="type"&&!tr&&Rt in Pt)(function(Ke,yt,Dt){try{Ke[yt]=Dt}catch{}})(Pt,Rt,Hn==null?"":Hn),Hn!=null&&Hn!==!1||Pt.removeAttribute(Rt);else{var et=tr&&Rt!==(Rt=Rt.replace(/^xlink:?/,""));Hn==null||Hn===!1?et?Pt.removeAttributeNS("http://www.w3.org/1999/xlink",Rt.toLowerCase()):Pt.removeAttribute(Rt):typeof Hn!="function"&&(et?Pt.setAttributeNS("http://www.w3.org/1999/xlink",Rt.toLowerCase(),Hn):Pt.setAttribute(Rt,Hn))}else Pt.className=Hn||""}function pe(Pt){return this._listeners[Pt.type](g.event&&g.event(Pt)||Pt)}var Oe=[],Fe=0,Le=!1,Ae=!1;function ft(){for(var Pt;Pt=Oe.pop();)g.afterMount&&g.afterMount(Pt),Pt.componentDidMount&&Pt.componentDidMount()}function Mt(Pt,Rt,Tn,Hn,tr,pn){Fe++||(Le=tr!=null&&tr.ownerSVGElement!==void 0,Ae=Pt!=null&&!("__preactattr_"in Pt));var $e=Xt(Pt,Rt,Tn,Hn,pn);return tr&&$e.parentNode!==tr&&tr.appendChild($e),--Fe||(Ae=!1,pn||ft()),$e}function Xt(Pt,Rt,Tn,Hn,tr){var pn=Pt,$e=Le;if(Rt!=null&&typeof Rt!="boolean"||(Rt=""),typeof Rt=="string"||typeof Rt=="number")return Pt&&Pt.splitText!==void 0&&Pt.parentNode&&(!Pt._component||tr)?Pt.nodeValue!=Rt&&(Pt.nodeValue=Rt):(pn=document.createTextNode(Rt),Pt&&(Pt.parentNode&&Pt.parentNode.replaceChild(pn,Pt),tn(Pt,!0))),pn.__preactattr_=!0,pn;var et=Rt.nodeName;if(typeof et=="function")return function(Cn,ar,we,lr){for(var Rr=Cn&&Cn._component,Tr=Rr,qr=Cn,Gr=Rr&&Cn._componentConstructor===ar.nodeName,hn=Gr,nn=se(ar);Rr&&!hn&&(Rr=Rr._parentComponent);)hn=Rr.constructor===ar.nodeName;return Rr&&hn&&(!lr||Rr._component)?(Qe(Rr,nn,3,we,lr),Cn=Rr.base):(Tr&&!Gr&&(on(Tr),Cn=qr=null),Rr=en(ar.nodeName,nn,we),Cn&&!Rr.nextBase&&(Rr.nextBase=Cn,qr=null),Qe(Rr,nn,1,we,lr),Cn=Rr.base,qr&&Cn!==qr&&(qr._component=null,tn(qr,!1))),Cn}(Pt,Rt,Tn,Hn);if(Le=et==="svg"||et!=="foreignObject"&&Le,et=String(et),(!Pt||!ue(Pt,et))&&(pn=function(Cn,ar){var we=ar?document.createElementNS("http://www.w3.org/2000/svg",Cn):document.createElement(Cn);return we.normalizedNodeName=Cn,we}(et,Le),Pt)){for(;Pt.firstChild;)pn.appendChild(Pt.firstChild);Pt.parentNode&&Pt.parentNode.replaceChild(pn,Pt),tn(Pt,!0)}var Ke=pn.firstChild,yt=pn.__preactattr_,Dt=Rt.children;if(yt==null){yt=pn.__preactattr_={};for(var Lt=pn.attributes,zn=Lt.length;zn--;)yt[Lt[zn].name]=Lt[zn].value}return!Ae&&Dt&&Dt.length===1&&typeof Dt[0]=="string"&&Ke!=null&&Ke.splitText!==void 0&&Ke.nextSibling==null?Ke.nodeValue!=Dt[0]&&(Ke.nodeValue=Dt[0]):(Dt&&Dt.length||Ke!=null)&&function(Cn,ar,we,lr,Rr){var Tr,qr,Gr,hn,nn,an=Cn.childNodes,or=[],jn={},Fr=0,Pr=0,Br=an.length,wi=0,Ai=ar?ar.length:0;if(Br!==0)for(var Jn=0;Jn<Br;Jn++){var di=an[Jn],ri=di.__preactattr_,Dr=Ai&&ri?di._component?di._component.__key:ri.key:null;Dr!=null?(Fr++,jn[Dr]=di):(ri||(di.splitText!==void 0?!Rr||di.nodeValue.trim():Rr))&&(or[wi++]=di)}if(Ai!==0)for(var Jn=0;Jn<Ai;Jn++){hn=ar[Jn],nn=null;var Dr=hn.key;if(Dr!=null)Fr&&jn[Dr]!==void 0&&(nn=jn[Dr],jn[Dr]=void 0,Fr--);else if(!nn&&Pr<wi){for(Tr=Pr;Tr<wi;Tr++)if(or[Tr]!==void 0&&F(qr=or[Tr],hn,Rr)){nn=qr,or[Tr]=void 0,Tr===wi-1&&wi--,Tr===Pr&&Pr++;break}}nn=Xt(nn,hn,we,lr),Gr=an[Jn],nn&&nn!==Cn&&nn!==Gr&&(Gr==null?Cn.appendChild(nn):nn===Gr.nextSibling?J(Gr):Cn.insertBefore(nn,Gr))}if(Fr)for(var Jn in jn)jn[Jn]!==void 0&&tn(jn[Jn],!1);for(;Pr<=wi;)(nn=or[wi--])!==void 0&&tn(nn,!1)}(pn,Dt,Tn,Hn,Ae||yt.dangerouslySetInnerHTML!=null),function(Cn,ar,we){var lr;for(lr in we)ar&&ar[lr]!=null||we[lr]==null||me(Cn,lr,we[lr],we[lr]=void 0,Le);for(lr in ar)lr==="children"||lr==="innerHTML"||lr in we&&ar[lr]===(lr==="value"||lr==="checked"?Cn[lr]:we[lr])||me(Cn,lr,we[lr],we[lr]=ar[lr],Le)}(pn,Rt.attributes,yt),Le=$e,pn}function tn(Pt,Rt){var Tn=Pt._component;Tn?on(Tn):(Pt.__preactattr_!=null&&Pt.__preactattr_.ref&&Pt.__preactattr_.ref(null),Rt!==!1&&Pt.__preactattr_!=null||J(Pt),Ce(Pt))}function Ce(Pt){for(Pt=Pt.lastChild;Pt;){var Rt=Pt.previousSibling;tn(Pt,!0),Pt=Rt}}var Wt={};function en(Pt,Rt,Tn){var Hn,tr=Wt[Pt.name];if(Pt.prototype&&Pt.prototype.render?(Hn=new Pt(Rt,Tn),Ct.call(Hn,Rt,Tn)):((Hn=new Ct(Rt,Tn)).constructor=Pt,Hn.render=Ut),tr){for(var pn=tr.length;pn--;)if(tr[pn].constructor===Pt){Hn.nextBase=tr[pn].nextBase,tr.splice(pn,1);break}}return Hn}function Ut(Pt,Rt,Tn){return this.constructor(Pt,Tn)}function Qe(Pt,Rt,Tn,Hn,tr){Pt._disable||(Pt._disable=!0,(Pt.__ref=Rt.ref)&&delete Rt.ref,(Pt.__key=Rt.key)&&delete Rt.key,!Pt.base||tr?Pt.componentWillMount&&Pt.componentWillMount():Pt.componentWillReceiveProps&&Pt.componentWillReceiveProps(Rt,Hn),Hn&&Hn!==Pt.context&&(Pt.prevContext||(Pt.prevContext=Pt.context),Pt.context=Hn),Pt.prevProps||(Pt.prevProps=Pt.props),Pt.props=Rt,Pt._disable=!1,Tn!==0&&(Tn!==1&&g.syncComponentUpdates===!1&&Pt.base?W(Pt):fn(Pt,1,tr)),Pt.__ref&&Pt.__ref(Pt))}function fn(Pt,Rt,Tn,Hn){if(!Pt._disable){var tr,pn,$e,et=Pt.props,Ke=Pt.state,yt=Pt.context,Dt=Pt.prevProps||et,Lt=Pt.prevState||Ke,zn=Pt.prevContext||yt,Cn=Pt.base,ar=Pt.nextBase,we=Cn||ar,lr=Pt._component,Rr=!1;if(Cn&&(Pt.props=Dt,Pt.state=Lt,Pt.context=zn,Rt!==2&&Pt.shouldComponentUpdate&&Pt.shouldComponentUpdate(et,Ke,yt)===!1?Rr=!0:Pt.componentWillUpdate&&Pt.componentWillUpdate(et,Ke,yt),Pt.props=et,Pt.state=Ke,Pt.context=yt),Pt.prevProps=Pt.prevState=Pt.prevContext=Pt.nextBase=null,Pt._dirty=!1,!Rr){tr=Pt.render(et,Ke,yt),Pt.getChildContext&&(yt=X(X({},yt),Pt.getChildContext()));var Tr,qr,Gr=tr&&tr.nodeName;if(typeof Gr=="function"){var hn=se(tr);(pn=lr)&&pn.constructor===Gr&&hn.key==pn.__key?Qe(pn,hn,1,yt,!1):(Tr=pn,Pt._component=pn=en(Gr,hn,yt),pn.nextBase=pn.nextBase||ar,pn._parentComponent=Pt,Qe(pn,hn,0,yt,!1),fn(pn,1,Tn,!0)),qr=pn.base}else $e=we,(Tr=lr)&&($e=Pt._component=null),(we||Rt===1)&&($e&&($e._component=null),qr=Mt($e,tr,yt,Tn||!Cn,we&&we.parentNode,!0));if(we&&qr!==we&&pn!==lr){var nn=we.parentNode;nn&&qr!==nn&&(nn.replaceChild(qr,we),Tr||(we._component=null,tn(we,!1)))}if(Tr&&on(Tr),Pt.base=qr,qr&&!Hn){for(var an=Pt,or=Pt;or=or._parentComponent;)(an=or).base=qr;qr._component=an,qr._componentConstructor=an.constructor}}if(!Cn||Tn?Oe.unshift(Pt):Rr||(Pt.componentDidUpdate&&Pt.componentDidUpdate(Dt,Lt,zn),g.afterUpdate&&g.afterUpdate(Pt)),Pt._renderCallbacks!=null)for(;Pt._renderCallbacks.length;)Pt._renderCallbacks.pop().call(Pt);Fe||Hn||ft()}}function on(Pt){g.beforeUnmount&&g.beforeUnmount(Pt);var Rt=Pt.base;Pt._disable=!0,Pt.componentWillUnmount&&Pt.componentWillUnmount(),Pt.base=null;var Tn=Pt._component;Tn?on(Tn):Rt&&(Rt.__preactattr_&&Rt.__preactattr_.ref&&Rt.__preactattr_.ref(null),Pt.nextBase=Rt,J(Rt),function(Hn){var tr=Hn.constructor.name;(Wt[tr]||(Wt[tr]=[])).push(Hn)}(Pt),Ce(Rt)),Pt.__ref&&Pt.__ref(null)}function Ct(Pt,Rt){this._dirty=!0,this.context=Rt,this.props=Pt,this.state=this.state||{}}function Vt(Pt,Rt,Tn){return Mt(Tn,Pt,{},!1,Rt,!1)}X(Ct.prototype,{setState:function(Pt,Rt){var Tn=this.state;this.prevState||(this.prevState=X({},Tn)),X(Tn,typeof Pt=="function"?Pt(Tn,this.props):Pt),Rt&&(this._renderCallbacks=this._renderCallbacks||[]).push(Rt),W(this)},forceUpdate:function(Pt){Pt&&(this._renderCallbacks=this._renderCallbacks||[]).push(Pt),fn(this,2)},render:function(){}});var En={h:A,createElement:A,cloneElement:M,Component:Ct,render:Vt,rerender:te,options:g};m.default=En},function(j,m,o){/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var g=Object.getOwnPropertySymbols,z=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;j.exports=function(){try{if(!Object.assign)return!1;var A=new String("abc");if(A[5]="de",Object.getOwnPropertyNames(A)[0]==="5")return!1;for(var X={},K=0;K<10;K++)X["_"+String.fromCharCode(K)]=K;if(Object.getOwnPropertyNames(X).map(function(V){return X[V]}).join("")!=="0123456789")return!1;var M={};return"abcdefghijklmnopqrst".split("").forEach(function(V){M[V]=V}),Object.keys(Object.assign({},M)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}()?Object.assign:function(A,X){for(var K,M,V=function(F){if(F==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(F)}(A),$=1;$<arguments.length;$++){for(var W in K=Object(arguments[$]))z.call(K,W)&&(V[W]=K[W]);if(g){M=g(K);for(var te=0;te<M.length;te++)I.call(K,M[te])&&(V[M[te]]=K[M[te]])}}return V}},function(j,m,o){const g=o(32),z=o(113),{ANY:I}=z,A=o(47),X=o(112),K=o(114),M=o(143),V=o(141),$=o(142);j.exports=(W,te,F,ue)=>{let se,J,me,pe,Oe;switch(W=new g(W,ue),te=new A(te,ue),F){case">":se=K,J=V,me=M,pe=">",Oe=">=";break;case"<":se=M,J=$,me=K,pe="<",Oe="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(X(W,te,ue))return!1;for(let Fe=0;Fe<te.set.length;++Fe){let Le=null,Ae=null;if(te.set[Fe].forEach(ft=>{ft.semver===I&&(ft=new z(">=0.0.0")),Le=Le||ft,Ae=Ae||ft,se(ft.semver,Le.semver,ue)?Le=ft:me(ft.semver,Ae.semver,ue)&&(Ae=ft)}),Le.operator===pe||Le.operator===Oe||(!Ae.operator||Ae.operator===pe)&&J(W,Ae.semver)||Ae.operator===Oe&&me(W,Ae.semver))return!1}return!0}},function(j,m,o){const g=o(48);j.exports=(z,I,A)=>g(z,I,A)<=0},function(j,m,o){const g=o(48);j.exports=(z,I,A)=>g(z,I,A)>=0},function(j,m,o){const g=o(48);j.exports=(z,I,A)=>g(z,I,A)<0},function(j,m,o){const g=o(32);j.exports=(z,I,A)=>{const X=new g(z,A),K=new g(I,A);return X.compare(K)||X.compareBuild(K)}},function(j,m,o){const g=o(48);j.exports=(z,I,A)=>g(z,I,A)===0},function(j,m){const o=/^[0-9]+$/,g=(z,I)=>{const A=o.test(z),X=o.test(I);return A&&X&&(z=+z,I=+I),z===I?0:A&&!X?-1:X&&!A?1:z<I?-1:1};j.exports={compareIdentifiers:g,rcompareIdentifiers:(z,I)=>g(I,z)}},function(j,m,o){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0}),m.getBroadcastDims=function(g,z){for(var I=g.length,A=[],X=0;X<I;X++){var K=I-1-X,M=g[K]||1;(z[z.length-1-X]||1)>1&&M===1&&A.unshift(K)}return A},m.getReductionAxes=function(g,z){for(var I=[],A=0;A<z.length;A++){var X=g[g.length-A-1],K=z.length-A-1,M=z[K];(X==null||X===1&&M>1)&&I.unshift(K)}return I},m.assertAndGetBroadcastShape=function(g,z){for(var I=[],A=Math.max(g.length,z.length),X=0;X<A;X++){var K=g[g.length-X-1];K==null&&(K=1);var M=z[z.length-X-1];if(M==null&&(M=1),K===1)I.unshift(M);else if(M===1)I.unshift(K);else{if(K!==M)throw Error("Operands could not be broadcast together with shapes "+g+" and "+z+".");I.unshift(K)}}return I}},function(j,m,o){j.exports=!o(208)(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},function(j,m){j.exports=function(o){return typeof o=="object"?o!==null:typeof o=="function"}},function(j,m){var o=j.exports=typeof window!="undefined"&&window.Math==Math?window:typeof self!="undefined"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=o)},function(j,m,o){var g=o(16),z=o(27),I=o(83),A=o(118),X=o(42),K=o(93),M=o(15),V=o(94),$=o(54),W=o(22),te=o(213),F=o(79).f,ue=o(26).f,se=o(156),J=o(98),me="prototype",pe="Wrong index!",Oe=g.ArrayBuffer,Fe=g.DataView,Le=g.Math,Ae=g.RangeError,ft=g.Infinity,Mt=Oe,Xt=Le.abs,tn=Le.pow,Ce=Le.floor,Wt=Le.log,en=Le.LN2,Ut=z?"_b":"buffer",Qe=z?"_l":"byteLength",fn=z?"_o":"byteOffset";function on(Cn,ar,we){var lr,Rr,Tr,qr=new Array(we),Gr=8*we-ar-1,hn=(1<<Gr)-1,nn=hn>>1,an=ar===23?tn(2,-24)-tn(2,-77):0,or=0,jn=Cn<0||Cn===0&&1/Cn<0?1:0;for((Cn=Xt(Cn))!=Cn||Cn===ft?(Rr=Cn!=Cn?1:0,lr=hn):(lr=Ce(Wt(Cn)/en),Cn*(Tr=tn(2,-lr))<1&&(lr--,Tr*=2),(Cn+=lr+nn>=1?an/Tr:an*tn(2,1-nn))*Tr>=2&&(lr++,Tr/=2),lr+nn>=hn?(Rr=0,lr=hn):lr+nn>=1?(Rr=(Cn*Tr-1)*tn(2,ar),lr+=nn):(Rr=Cn*tn(2,nn-1)*tn(2,ar),lr=0));ar>=8;qr[or++]=255&Rr,Rr/=256,ar-=8);for(lr=lr<<ar|Rr,Gr+=ar;Gr>0;qr[or++]=255&lr,lr/=256,Gr-=8);return qr[--or]|=128*jn,qr}function Ct(Cn,ar,we){var lr,Rr=8*we-ar-1,Tr=(1<<Rr)-1,qr=Tr>>1,Gr=Rr-7,hn=we-1,nn=Cn[hn--],an=127&nn;for(nn>>=7;Gr>0;an=256*an+Cn[hn],hn--,Gr-=8);for(lr=an&(1<<-Gr)-1,an>>=-Gr,Gr+=ar;Gr>0;lr=256*lr+Cn[hn],hn--,Gr-=8);if(an===0)an=1-qr;else{if(an===Tr)return lr?NaN:nn?-ft:ft;lr+=tn(2,ar),an-=qr}return(nn?-1:1)*lr*tn(2,an-ar)}function Vt(Cn){return Cn[3]<<24|Cn[2]<<16|Cn[1]<<8|Cn[0]}function En(Cn){return[255&Cn]}function Pt(Cn){return[255&Cn,Cn>>8&255]}function Rt(Cn){return[255&Cn,Cn>>8&255,Cn>>16&255,Cn>>24&255]}function Tn(Cn){return on(Cn,52,8)}function Hn(Cn){return on(Cn,23,4)}function tr(Cn,ar,we){ue(Cn[me],ar,{get:function(){return this[we]}})}function pn(Cn,ar,we,lr){var Rr=te(+we);if(Rr+ar>Cn[Qe])throw Ae(pe);var Tr=Cn[Ut]._b,qr=Rr+Cn[fn],Gr=Tr.slice(qr,qr+ar);return lr?Gr:Gr.reverse()}function $e(Cn,ar,we,lr,Rr,Tr){var qr=te(+we);if(qr+ar>Cn[Qe])throw Ae(pe);for(var Gr=Cn[Ut]._b,hn=qr+Cn[fn],nn=lr(+Rr),an=0;an<ar;an++)Gr[hn+an]=nn[Tr?an:ar-an-1]}if(A.ABV){if(!M(function(){Oe(1)})||!M(function(){new Oe(-1)})||M(function(){return new Oe,new Oe(1.5),new Oe(NaN),Oe.name!="ArrayBuffer"})){for(var et,Ke=(Oe=function(Cn){return V(this,Oe),new Mt(te(Cn))})[me]=Mt[me],yt=F(Mt),Dt=0;yt.length>Dt;)(et=yt[Dt++])in Oe||X(Oe,et,Mt[et]);I||(Ke.constructor=Oe)}var Lt=new Fe(new Oe(2)),zn=Fe[me].setInt8;Lt.setInt8(0,2147483648),Lt.setInt8(1,2147483649),!Lt.getInt8(0)&&Lt.getInt8(1)||K(Fe[me],{setInt8:function(Cn,ar){zn.call(this,Cn,ar<<24>>24)},setUint8:function(Cn,ar){zn.call(this,Cn,ar<<24>>24)}},!0)}else Oe=function(Cn){V(this,Oe,"ArrayBuffer");var ar=te(Cn);this._b=se.call(new Array(ar),0),this[Qe]=ar},Fe=function(Cn,ar,we){V(this,Fe,"DataView"),V(Cn,Oe,"DataView");var lr=Cn[Qe],Rr=$(ar);if(Rr<0||Rr>lr)throw Ae("Wrong offset!");if(Rr+(we=we===void 0?lr-Rr:W(we))>lr)throw Ae("Wrong length!");this[Ut]=Cn,this[fn]=Rr,this[Qe]=we},z&&(tr(Oe,"byteLength","_l"),tr(Fe,"buffer","_b"),tr(Fe,"byteLength","_l"),tr(Fe,"byteOffset","_o")),K(Fe[me],{getInt8:function(Cn){return pn(this,1,Cn)[0]<<24>>24},getUint8:function(Cn){return pn(this,1,Cn)[0]},getInt16:function(Cn){var ar=pn(this,2,Cn,arguments[1]);return(ar[1]<<8|ar[0])<<16>>16},getUint16:function(Cn){var ar=pn(this,2,Cn,arguments[1]);return ar[1]<<8|ar[0]},getInt32:function(Cn){return Vt(pn(this,4,Cn,arguments[1]))},getUint32:function(Cn){return Vt(pn(this,4,Cn,arguments[1]))>>>0},getFloat32:function(Cn){return Ct(pn(this,4,Cn,arguments[1]),23,4)},getFloat64:function(Cn){return Ct(pn(this,8,Cn,arguments[1]),52,8)},setInt8:function(Cn,ar){$e(this,1,Cn,En,ar)},setUint8:function(Cn,ar){$e(this,1,Cn,En,ar)},setInt16:function(Cn,ar){$e(this,2,Cn,Pt,ar,arguments[2])},setUint16:function(Cn,ar){$e(this,2,Cn,Pt,ar,arguments[2])},setInt32:function(Cn,ar){$e(this,4,Cn,Rt,ar,arguments[2])},setUint32:function(Cn,ar){$e(this,4,Cn,Rt,ar,arguments[2])},setFloat32:function(Cn,ar){$e(this,4,Cn,Hn,ar,arguments[2])},setFloat64:function(Cn,ar){$e(this,8,Cn,Tn,ar,arguments[2])}});J(Oe,"ArrayBuffer"),J(Fe,"DataView"),X(Fe[me],A.VIEW,!0),m.ArrayBuffer=Oe,m.DataView=Fe},function(j,m,o){var g,z,I,A=o(56),X=o(232),K=o(171),M=o(175),V=o(16),$=V.process,W=V.setImmediate,te=V.clearImmediate,F=V.MessageChannel,ue=V.Dispatch,se=0,J={},me=function(){var Oe=+this;if(J.hasOwnProperty(Oe)){var Fe=J[Oe];delete J[Oe],Fe()}},pe=function(Oe){me.call(Oe.data)};W&&te||(W=function(Oe){for(var Fe=[],Le=1;arguments.length>Le;)Fe.push(arguments[Le++]);return J[++se]=function(){X(typeof Oe=="function"?Oe:Function(Oe),Fe)},g(se),se},te=function(Oe){delete J[Oe]},o(62)($)=="process"?g=function(Oe){$.nextTick(A(me,Oe,1))}:ue&&ue.now?g=function(Oe){ue.now(A(me,Oe,1))}:F?(I=(z=new F).port2,z.port1.onmessage=pe,g=A(I.postMessage,I,1)):V.addEventListener&&typeof postMessage=="function"&&!V.importScripts?(g=function(Oe){V.postMessage(Oe+"","*")},V.addEventListener("message",pe,!1)):g="onreadystatechange"in M("script")?function(Oe){K.appendChild(M("script")).onreadystatechange=function(){K.removeChild(this),me.call(Oe)}}:function(Oe){setTimeout(A(me,Oe,1),0)}),j.exports={set:W,clear:te}},function(j,m,o){var g=o(164)(!0);j.exports=function(z,I,A){return I+(A?g(z,I).length:1)}},function(j,m,o){var g=o(124),z=RegExp.prototype.exec,I=String.prototype.replace,A=z,X=function(){var M=/a/,V=/b*/g;return z.call(M,"a"),z.call(V,"a"),M.lastIndex!==0||V.lastIndex!==0}(),K=/()??/.exec("")[1]!==void 0;(X||K)&&(A=function(M){var V,$,W,te,F=this;return K&&($=new RegExp("^"+F.source+"$(?!\\s)",g.call(F))),X&&(V=F.lastIndex),W=z.call(F,M),X&&W&&(F.lastIndex=F.global?W.index+W[0].length:V),K&&W&&W.length>1&&I.call(W[0],$,function(){for(te=1;te<arguments.length-2;te++)arguments[te]===void 0&&(W[te]=void 0)}),W}),j.exports=A},function(j,m,o){var g=o(77),z=o(221),I=o(96),A=o(41);j.exports=o(163)(Array,"Array",function(X,K){this._t=A(X),this._i=0,this._k=K},function(){var X=this._t,K=this._k,M=this._i++;return!X||M>=X.length?(this._t=void 0,z(1)):z(0,K=="keys"?M:K=="values"?X[M]:[M,X[M]])},"values"),I.Arguments=I.Array,g("keys"),g("values"),g("entries")},function(j,m,o){var g=o(34),z=o(81),I=o(22);j.exports=function(A){for(var X=g(this),K=I(X.length),M=arguments.length,V=z(M>1?arguments[1]:void 0,K),$=M>2?arguments[2]:void 0,W=$===void 0?K:z($,K);W>V;)X[V++]=A;return X}},function(j,m,o){var g=o(105),z=o(19)("iterator"),I=o(96);j.exports=o(24).getIteratorMethod=function(A){if(A!=null)return A[z]||A["@@iterator"]||I[g(A)]}},function(j,m,o){var g=o(26),z=o(85);j.exports=function(I,A,X){A in I?g.f(I,A,z(0,X)):I[A]=X}},function(j,m,o){var g=o(96),z=o(19)("iterator"),I=Array.prototype;j.exports=function(A){return A!==void 0&&(g.Array===A||I[z]===A)}},function(j,m,o){var g=o(19)("match");j.exports=function(z){var I=/./;try{"/./"[z](I)}catch{try{return I[g]=!1,!"/./"[z](I)}catch{}}return!0}},function(j,m,o){var g=o(13),z=o(62),I=o(19)("match");j.exports=function(A){var X;return g(A)&&((X=A[I])!==void 0?!!X:z(A)=="RegExp")}},function(j,m,o){var g=o(161),z=o(61);j.exports=function(I,A,X){if(g(A))throw TypeError("String#"+X+" doesn't accept regex!");return String(z(I))}},function(j,m,o){var g=o(83),z=o(8),I=o(38),A=o(42),X=o(96),K=o(226),M=o(98),V=o(78),$=o(19)("iterator"),W=!([].keys&&"next"in[].keys()),te=function(){return this};j.exports=function(F,ue,se,J,me,pe,Oe){K(se,ue,J);var Fe,Le,Ae,ft=function(fn){if(!W&&fn in Ce)return Ce[fn];switch(fn){case"keys":case"values":return function(){return new se(this,fn)}}return function(){return new se(this,fn)}},Mt=ue+" Iterator",Xt=me=="values",tn=!1,Ce=F.prototype,Wt=Ce[$]||Ce["@@iterator"]||me&&Ce[me],en=Wt||ft(me),Ut=me?Xt?ft("entries"):en:void 0,Qe=ue=="Array"&&Ce.entries||Wt;if(Qe&&(Ae=V(Qe.call(new F)))!==Object.prototype&&Ae.next&&(M(Ae,Mt,!0),g||typeof Ae[$]=="function"||A(Ae,$,te)),Xt&&Wt&&Wt.name!=="values"&&(tn=!0,en=function(){return Wt.call(this)}),g&&!Oe||!W&&!tn&&Ce[$]||A(Ce,$,en),X[ue]=en,X[Mt]=te,me)if(Fe={values:Xt?en:ft("values"),keys:pe?en:ft("keys"),entries:Ut},Oe)for(Le in Fe)Le in Ce||I(Ce,Le,Fe[Le]);else z(z.P+z.F*(W||tn),ue,Fe);return Fe}},function(j,m,o){var g=o(54),z=o(61);j.exports=function(I){return function(A,X){var K,M,V=String(z(A)),$=g(X),W=V.length;return $<0||$>=W?I?"":void 0:(K=V.charCodeAt($))<55296||K>56319||$+1===W||(M=V.charCodeAt($+1))<56320||M>57343?I?V.charAt($):K:I?V.slice($,$+2):M-56320+(K-55296<<10)+65536}}},function(j,m){var o=Math.expm1;j.exports=!o||o(10)>22025.465794806718||o(10)<22025.465794806718||o(-2e-17)!=-2e-17?function(g){return(g=+g)==0?g:g>-1e-6&&g<1e-6?g+g*g/2:Math.exp(g)-1}:o},function(j,m){j.exports=Math.sign||function(o){return(o=+o)==0||o!=o?o:o<0?-1:1}},function(j,m,o){var g=o(54),z=o(61);j.exports=function(I){var A=String(z(this)),X="",K=g(I);if(K<0||K==1/0)throw RangeError("Count can't be negative");for(;K>0;(K>>>=1)&&(A+=A))1&K&&(X+=A);return X}},function(j,m,o){var g=o(13),z=o(170).set;j.exports=function(I,A,X){var K,M=A.constructor;return M!==X&&typeof M=="function"&&(K=M.prototype)!==X.prototype&&g(K)&&z&&z(I,K),I}},function(j,m){j.exports=`	
\v\f\r \xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF`},function(j,m,o){var g=o(13),z=o(14),I=function(A,X){if(z(A),!g(X)&&X!==null)throw TypeError(X+": can't set as prototype!")};j.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(A,X,K){try{(K=o(56)(Function.call,o(53).f(Object.prototype,"__proto__").set,2))(A,[]),X=!(A instanceof Array)}catch{X=!0}return function(M,V){return I(M,V),X?M.__proto__=V:K(M,V),M}}({},!1):void 0),check:I}},function(j,m,o){var g=o(16).document;j.exports=g&&g.documentElement},function(j,m){j.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(j,m,o){var g=o(129)("keys"),z=o(84);j.exports=function(I){return g[I]||(g[I]=z(I))}},function(j,m,o){m.f=o(19)},function(j,m,o){var g=o(13),z=o(16).document,I=g(z)&&g(z.createElement);j.exports=function(A){return I?z.createElement(A):{}}},function(j,m,o){var g=function(pe){return pe},z=function(pe){if(pe==null)return g;var Oe,Fe,Le=pe.scale[0],Ae=pe.scale[1],ft=pe.translate[0],Mt=pe.translate[1];return function(Xt,tn){tn||(Oe=Fe=0);var Ce=2,Wt=Xt.length,en=new Array(Wt);for(en[0]=(Oe+=Xt[0])*Le+ft,en[1]=(Fe+=Xt[1])*Ae+Mt;Ce<Wt;)en[Ce]=Xt[Ce],++Ce;return en}},I=function(pe){var Oe,Fe=z(pe.transform),Le=1/0,Ae=Le,ft=-Le,Mt=-Le;function Xt(Ce){(Ce=Fe(Ce))[0]<Le&&(Le=Ce[0]),Ce[0]>ft&&(ft=Ce[0]),Ce[1]<Ae&&(Ae=Ce[1]),Ce[1]>Mt&&(Mt=Ce[1])}function tn(Ce){switch(Ce.type){case"GeometryCollection":Ce.geometries.forEach(tn);break;case"Point":Xt(Ce.coordinates);break;case"MultiPoint":Ce.coordinates.forEach(Xt)}}for(Oe in pe.arcs.forEach(function(Ce){for(var Wt,en=-1,Ut=Ce.length;++en<Ut;)(Wt=Fe(Ce[en],en))[0]<Le&&(Le=Wt[0]),Wt[0]>ft&&(ft=Wt[0]),Wt[1]<Ae&&(Ae=Wt[1]),Wt[1]>Mt&&(Mt=Wt[1])}),pe.objects)tn(pe.objects[Oe]);return[Le,Ae,ft,Mt]},A=function(pe,Oe){for(var Fe,Le=pe.length,Ae=Le-Oe;Ae<--Le;)Fe=pe[Ae],pe[Ae++]=pe[Le],pe[Le]=Fe},X=function(pe,Oe){return typeof Oe=="string"&&(Oe=pe.objects[Oe]),Oe.type==="GeometryCollection"?{type:"FeatureCollection",features:Oe.geometries.map(function(Fe){return K(pe,Fe)})}:K(pe,Oe)};function K(pe,Oe){var Fe=Oe.id,Le=Oe.bbox,Ae=Oe.properties==null?{}:Oe.properties,ft=M(pe,Oe);return Fe==null&&Le==null?{type:"Feature",properties:Ae,geometry:ft}:Le==null?{type:"Feature",id:Fe,properties:Ae,geometry:ft}:{type:"Feature",id:Fe,bbox:Le,properties:Ae,geometry:ft}}function M(pe,Oe){var Fe=z(pe.transform),Le=pe.arcs;function Ae(Ce,Wt){Wt.length&&Wt.pop();for(var en=Le[Ce<0?~Ce:Ce],Ut=0,Qe=en.length;Ut<Qe;++Ut)Wt.push(Fe(en[Ut],Ut));Ce<0&&A(Wt,Qe)}function ft(Ce){return Fe(Ce)}function Mt(Ce){for(var Wt=[],en=0,Ut=Ce.length;en<Ut;++en)Ae(Ce[en],Wt);return Wt.length<2&&Wt.push(Wt[0]),Wt}function Xt(Ce){for(var Wt=Mt(Ce);Wt.length<4;)Wt.push(Wt[0]);return Wt}function tn(Ce){return Ce.map(Xt)}return function Ce(Wt){var en,Ut=Wt.type;switch(Ut){case"GeometryCollection":return{type:Ut,geometries:Wt.geometries.map(Ce)};case"Point":en=ft(Wt.coordinates);break;case"MultiPoint":en=Wt.coordinates.map(ft);break;case"LineString":en=Mt(Wt.arcs);break;case"MultiLineString":en=Wt.arcs.map(Mt);break;case"Polygon":en=tn(Wt.arcs);break;case"MultiPolygon":en=Wt.arcs.map(tn);break;default:return null}return{type:Ut,coordinates:en}}(Oe)}var V=function(pe,Oe){var Fe={},Le={},Ae={},ft=[],Mt=-1;function Xt(tn,Ce){for(var Wt in tn){var en=tn[Wt];delete Ce[en.start],delete en.start,delete en.end,en.forEach(function(Ut){Fe[Ut<0?~Ut:Ut]=1}),ft.push(en)}}return Oe.forEach(function(tn,Ce){var Wt,en=pe.arcs[tn<0?~tn:tn];en.length<3&&!en[1][0]&&!en[1][1]&&(Wt=Oe[++Mt],Oe[Mt]=tn,Oe[Ce]=Wt)}),Oe.forEach(function(tn){var Ce,Wt,en=function(Ct){var Vt,En=pe.arcs[Ct<0?~Ct:Ct],Pt=En[0];return pe.transform?(Vt=[0,0],En.forEach(function(Rt){Vt[0]+=Rt[0],Vt[1]+=Rt[1]})):Vt=En[En.length-1],Ct<0?[Vt,Pt]:[Pt,Vt]}(tn),Ut=en[0],Qe=en[1];if(Ce=Ae[Ut])if(delete Ae[Ce.end],Ce.push(tn),Ce.end=Qe,Wt=Le[Qe]){delete Le[Wt.start];var fn=Wt===Ce?Ce:Ce.concat(Wt);Le[fn.start=Ce.start]=Ae[fn.end=Wt.end]=fn}else Le[Ce.start]=Ae[Ce.end]=Ce;else if(Ce=Le[Qe])if(delete Le[Ce.start],Ce.unshift(tn),Ce.start=Ut,Wt=Ae[Ut]){delete Ae[Wt.end];var on=Wt===Ce?Ce:Wt.concat(Ce);Le[on.start=Wt.start]=Ae[on.end=Ce.end]=on}else Le[Ce.start]=Ae[Ce.end]=Ce;else Le[(Ce=[tn]).start=Ut]=Ae[Ce.end=Qe]=Ce}),Xt(Ae,Le),Xt(Le,Ae),Oe.forEach(function(tn){Fe[tn<0?~tn:tn]||ft.push([tn])}),ft},$=function(pe){return M(pe,W.apply(this,arguments))};function W(pe,Oe,Fe){var Le,Ae,ft;if(arguments.length>1)Le=function(Mt,Xt,tn){var Ce,Wt=[],en=[];function Ut(on){var Ct=on<0?~on:on;(en[Ct]||(en[Ct]=[])).push({i:on,g:Ce})}function Qe(on){on.forEach(Ut)}function fn(on){on.forEach(Qe)}return function on(Ct){switch(Ce=Ct,Ct.type){case"GeometryCollection":Ct.geometries.forEach(on);break;case"LineString":Qe(Ct.arcs);break;case"MultiLineString":case"Polygon":fn(Ct.arcs);break;case"MultiPolygon":(function(Vt){Vt.forEach(fn)})(Ct.arcs)}}(Xt),en.forEach(tn==null?function(on){Wt.push(on[0].i)}:function(on){tn(on[0].g,on[on.length-1].g)&&Wt.push(on[0].i)}),Wt}(0,Oe,Fe);else for(Ae=0,Le=new Array(ft=pe.arcs.length);Ae<ft;++Ae)Le[Ae]=Ae;return{type:"MultiLineString",arcs:V(pe,Le)}}var te=function(pe){return M(pe,F.apply(this,arguments))};function F(pe,Oe){var Fe={},Le=[],Ae=[];function ft(Xt){Xt.forEach(function(tn){tn.forEach(function(Ce){(Fe[Ce=Ce<0?~Ce:Ce]||(Fe[Ce]=[])).push(Xt)})}),Le.push(Xt)}function Mt(Xt){return function(tn){for(var Ce,Wt=-1,en=tn.length,Ut=tn[en-1],Qe=0;++Wt<en;)Ce=Ut,Ut=tn[Wt],Qe+=Ce[0]*Ut[1]-Ce[1]*Ut[0];return Math.abs(Qe)}(M(pe,{type:"Polygon",arcs:[Xt]}).coordinates[0])}return Oe.forEach(function Xt(tn){switch(tn.type){case"GeometryCollection":tn.geometries.forEach(Xt);break;case"Polygon":ft(tn.arcs);break;case"MultiPolygon":tn.arcs.forEach(ft)}}),Le.forEach(function(Xt){if(!Xt._){var tn=[],Ce=[Xt];for(Xt._=1,Ae.push(tn);Xt=Ce.pop();)tn.push(Xt),Xt.forEach(function(Wt){Wt.forEach(function(en){Fe[en<0?~en:en].forEach(function(Ut){Ut._||(Ut._=1,Ce.push(Ut))})})})}}),Le.forEach(function(Xt){delete Xt._}),{type:"MultiPolygon",arcs:Ae.map(function(Xt){var tn,Ce=[];if(Xt.forEach(function(fn){fn.forEach(function(on){on.forEach(function(Ct){Fe[Ct<0?~Ct:Ct].length<2&&Ce.push(Ct)})})}),(tn=(Ce=V(pe,Ce)).length)>1)for(var Wt,en,Ut=1,Qe=Mt(Ce[0]);Ut<tn;++Ut)(Wt=Mt(Ce[Ut]))>Qe&&(en=Ce[0],Ce[0]=Ce[Ut],Ce[Ut]=en,Qe=Wt);return Ce}).filter(function(Xt){return Xt.length>0})}}var ue=function(pe,Oe){for(var Fe=0,Le=pe.length;Fe<Le;){var Ae=Fe+Le>>>1;pe[Ae]<Oe?Fe=Ae+1:Le=Ae}return Fe},se=function(pe){var Oe={},Fe=pe.map(function(){return[]});function Le(fn,on){fn.forEach(function(Ct){Ct<0&&(Ct=~Ct);var Vt=Oe[Ct];Vt?Vt.push(on):Oe[Ct]=[on]})}function Ae(fn,on){fn.forEach(function(Ct){Le(Ct,on)})}var ft={LineString:Le,MultiLineString:Ae,Polygon:Ae,MultiPolygon:function(fn,on){fn.forEach(function(Ct){Ae(Ct,on)})}};for(var Mt in pe.forEach(function fn(on,Ct){on.type==="GeometryCollection"?on.geometries.forEach(function(Vt){fn(Vt,Ct)}):on.type in ft&&ft[on.type](on.arcs,Ct)}),Oe)for(var Xt=Oe[Mt],tn=Xt.length,Ce=0;Ce<tn;++Ce)for(var Wt=Ce+1;Wt<tn;++Wt){var en,Ut=Xt[Ce],Qe=Xt[Wt];(en=Fe[Ut])[Mt=ue(en,Qe)]!==Qe&&en.splice(Mt,0,Qe),(en=Fe[Qe])[Mt=ue(en,Ut)]!==Ut&&en.splice(Mt,0,Ut)}return Fe},J=function(pe){if(pe==null)return g;var Oe,Fe,Le=pe.scale[0],Ae=pe.scale[1],ft=pe.translate[0],Mt=pe.translate[1];return function(Xt,tn){tn||(Oe=Fe=0);var Ce=2,Wt=Xt.length,en=new Array(Wt),Ut=Math.round((Xt[0]-ft)/Le),Qe=Math.round((Xt[1]-Mt)/Ae);for(en[0]=Ut-Oe,Oe=Ut,en[1]=Qe-Fe,Fe=Qe;Ce<Wt;)en[Ce]=Xt[Ce],++Ce;return en}},me=function(pe,Oe){if(pe.transform)throw new Error("already quantized");if(Oe&&Oe.scale)Xt=pe.bbox;else{if(!((Fe=Math.floor(Oe))>=2))throw new Error("n must be \u22652");var Fe,Le=(Xt=pe.bbox||I(pe))[0],Ae=Xt[1],ft=Xt[2],Mt=Xt[3];Oe={scale:[ft-Le?(ft-Le)/(Fe-1):1,Mt-Ae?(Mt-Ae)/(Fe-1):1],translate:[Le,Ae]}}var Xt,tn,Ce=J(Oe),Wt=pe.objects,en={};function Ut(fn){return Ce(fn)}function Qe(fn){var on;switch(fn.type){case"GeometryCollection":on={type:"GeometryCollection",geometries:fn.geometries.map(Qe)};break;case"Point":on={type:"Point",coordinates:Ut(fn.coordinates)};break;case"MultiPoint":on={type:"MultiPoint",coordinates:fn.coordinates.map(Ut)};break;default:return fn}return fn.id!=null&&(on.id=fn.id),fn.bbox!=null&&(on.bbox=fn.bbox),fn.properties!=null&&(on.properties=fn.properties),on}for(tn in Wt)en[tn]=Qe(Wt[tn]);return{type:"Topology",bbox:Xt,transform:Oe,objects:en,arcs:pe.arcs.map(function(fn){var on,Ct=0,Vt=1,En=fn.length,Pt=new Array(En);for(Pt[0]=Ce(fn[0],0);++Ct<En;)((on=Ce(fn[Ct],Ct))[0]||on[1])&&(Pt[Vt++]=on);return Vt===1&&(Pt[Vt++]=[0,0]),Pt.length=Vt,Pt})}};o.d(m,!1,function(){return I}),o.d(m,"a",function(){return X}),o.d(m,"b",function(){return $}),o.d(m,!1,function(){return W}),o.d(m,!1,function(){return te}),o.d(m,!1,function(){return F}),o.d(m,!1,function(){return se}),o.d(m,!1,function(){return me}),o.d(m,!1,function(){return z}),o.d(m,!1,function(){return J})},function(j,m,o){(function(g,z){function I(){return typeof g=="object"&&j!==void 0&&z!==void 0&&!!z.version}o.d(m,"a",function(){return I})}).call(this,o(59),o(75))},function(j,m,o){(function(g){o.d(m,"a",function(){return A});var z=o(5),I=o(131);function A(){var X=g.Canvas||g.HTMLCanvasElement,K=g.Image||g.HTMLImageElement,M=g.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},V=Object(I.a)();return Object(z.a)({Canvas:X||function(){return function(){}}(),CanvasRenderingContext2D:g.CanvasRenderingContext2D||function(){return function(){}}(),Image:K||function(){return function(){}}(),ImageData:g.ImageData||function(){return function(){}}(),Video:g.HTMLVideoElement||function(){return function(){}}(),createCanvasElement:function(){if(X)return new X;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(K)return new K;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:M},V)}}).call(this,o(59))},function(j,m,o){const g=o(90);j.exports={re:g.re,src:g.src,tokens:g.t,SEMVER_SPEC_VERSION:o(117).SEMVER_SPEC_VERSION,SemVer:o(32),compareIdentifiers:o(146).compareIdentifiers,rcompareIdentifiers:o(146).rcompareIdentifiers,parse:o(89),valid:o(348),clean:o(347),inc:o(346),diff:o(345),major:o(344),minor:o(343),patch:o(342),prerelease:o(341),compare:o(48),rcompare:o(340),compareLoose:o(339),compareBuild:o(144),sort:o(338),rsort:o(337),gt:o(114),lt:o(143),eq:o(145),neq:o(204),gte:o(142),lte:o(141),cmp:o(203),coerce:o(336),Comparator:o(113),Range:o(47),satisfies:o(112),toComparators:o(332),maxSatisfying:o(331),minSatisfying:o(330),minVersion:o(329),validRange:o(328),outside:o(140),gtr:o(327),ltr:o(326),intersects:o(325),simplifyRange:o(324),subset:o(323)}},function(j,m,o){var g=o(31),z=o(12),I=Object(g.a)(function(A){A.setUTCSeconds(0,0)},function(A,X){A.setTime(+A+X*z.c)},function(A,X){return(X-A)/z.c},function(A){return A.getUTCMinutes()});m.a=I,I.range},function(j,m,o){var g=o(31),z=o(12),I=Object(g.a)(function(A){A.setUTCMinutes(0,0,0)},function(A,X){A.setTime(+A+X*z.b)},function(A,X){return(X-A)/z.b},function(A){return A.getUTCHours()});m.a=I,I.range},function(j,m,o){var g=o(31),z=Object(g.a)(function(){},function(I,A){I.setTime(+I+A)},function(I,A){return A-I});z.every=function(I){return I=Math.floor(I),isFinite(I)&&I>0?I>1?Object(g.a)(function(A){A.setTime(Math.floor(A/I)*I)},function(A,X){A.setTime(+A+X*I)},function(A,X){return(X-A)/I}):z:null},m.a=z,z.range},function(j,m,o){var g=o(31),z=o(12),I=Object(g.a)(function(A){A.setTime(A-A.getMilliseconds()-A.getSeconds()*z.e)},function(A,X){A.setTime(+A+X*z.c)},function(A,X){return(X-A)/z.c},function(A){return A.getMinutes()});m.a=I,I.range},function(j,m,o){var g=o(31),z=o(12),I=Object(g.a)(function(A){A.setTime(A-A.getMilliseconds()-A.getSeconds()*z.e-A.getMinutes()*z.c)},function(A,X){A.setTime(+A+X*z.b)},function(A,X){return(X-A)/z.b},function(A){return A.getHours()});m.a=I,I.range},function(j,m){},function(j,m){j.exports=function(o,g){(g==null||g>o.length)&&(g=o.length);for(var z=0,I=new Array(g);z<g;z++)I[z]=o[z];return I},j.exports.__esModule=!0,j.exports.default=j.exports},function(j,m,o){var g=o(186);j.exports=function(z,I){if(z){if(typeof z=="string")return g(z,I);var A=Object.prototype.toString.call(z).slice(8,-1);return A==="Object"&&z.constructor&&(A=z.constructor.name),A==="Map"||A==="Set"?Array.from(z):A==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(A)?g(z,I):void 0}},j.exports.__esModule=!0,j.exports.default=j.exports},function(j,m,o){function g(z){this.message=z}g.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},g.prototype.__CANCEL__=!0,j.exports=g},function(j,m,o){var g=o(36);j.exports=function(z,I){I=I||{};var A={},X=["url","method","data"],K=["headers","auth","proxy","params"],M=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],V=["validateStatus"];function $(ue,se){return g.isPlainObject(ue)&&g.isPlainObject(se)?g.merge(ue,se):g.isPlainObject(se)?g.merge({},se):g.isArray(se)?se.slice():se}function W(ue){g.isUndefined(I[ue])?g.isUndefined(z[ue])||(A[ue]=$(void 0,z[ue])):A[ue]=$(z[ue],I[ue])}g.forEach(X,function(ue){g.isUndefined(I[ue])||(A[ue]=$(void 0,I[ue]))}),g.forEach(K,W),g.forEach(M,function(ue){g.isUndefined(I[ue])?g.isUndefined(z[ue])||(A[ue]=$(void 0,z[ue])):A[ue]=$(void 0,I[ue])}),g.forEach(V,function(ue){ue in I?A[ue]=$(z[ue],I[ue]):ue in z&&(A[ue]=$(void 0,z[ue]))});var te=X.concat(K).concat(M).concat(V),F=Object.keys(z).concat(Object.keys(I)).filter(function(ue){return te.indexOf(ue)===-1});return g.forEach(F,W),A}},function(j,m,o){j.exports=function(g){return!(!g||!g.__CANCEL__)}},function(j,m,o){var g=o(193);j.exports=function(z,I,A,X,K){var M=new Error(z);return g(M,I,A,X,K)}},function(j,m,o){var g=o(36),z=o(274),I=o(273),A=o(194),X=o(272),K=o(269),M=o(268),V=o(191);j.exports=function($){return new Promise(function(W,te){var F=$.data,ue=$.headers,se=$.responseType;g.isFormData(F)&&delete ue["Content-Type"];var J=new XMLHttpRequest;if($.auth){var me=$.auth.username||"",pe=$.auth.password?unescape(encodeURIComponent($.auth.password)):"";ue.Authorization="Basic "+btoa(me+":"+pe)}var Oe=X($.baseURL,$.url);function Fe(){if(J){var Ae="getAllResponseHeaders"in J?K(J.getAllResponseHeaders()):null,ft={data:se&&se!=="text"&&se!=="json"?J.response:J.responseText,status:J.status,statusText:J.statusText,headers:Ae,config:$,request:J};z(W,te,ft),J=null}}if(J.open($.method.toUpperCase(),A(Oe,$.params,$.paramsSerializer),!0),J.timeout=$.timeout,"onloadend"in J?J.onloadend=Fe:J.onreadystatechange=function(){J&&J.readyState===4&&(J.status!==0||J.responseURL&&J.responseURL.indexOf("file:")===0)&&setTimeout(Fe)},J.onabort=function(){J&&(te(V("Request aborted",$,"ECONNABORTED",J)),J=null)},J.onerror=function(){te(V("Network Error",$,null,J)),J=null},J.ontimeout=function(){var Ae="timeout of "+$.timeout+"ms exceeded";$.timeoutErrorMessage&&(Ae=$.timeoutErrorMessage),te(V(Ae,$,$.transitional&&$.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",J)),J=null},g.isStandardBrowserEnv()){var Le=($.withCredentials||M(Oe))&&$.xsrfCookieName?I.read($.xsrfCookieName):void 0;Le&&(ue[$.xsrfHeaderName]=Le)}"setRequestHeader"in J&&g.forEach(ue,function(Ae,ft){F===void 0&&ft.toLowerCase()==="content-type"?delete ue[ft]:J.setRequestHeader(ft,Ae)}),g.isUndefined($.withCredentials)||(J.withCredentials=!!$.withCredentials),se&&se!=="json"&&(J.responseType=$.responseType),typeof $.onDownloadProgress=="function"&&J.addEventListener("progress",$.onDownloadProgress),typeof $.onUploadProgress=="function"&&J.upload&&J.upload.addEventListener("progress",$.onUploadProgress),$.cancelToken&&$.cancelToken.promise.then(function(Ae){J&&(J.abort(),te(Ae),J=null)}),F||(F=null),J.send(F)})}},function(j,m,o){j.exports=function(g,z,I,A,X){return g.config=z,I&&(g.code=I),g.request=A,g.response=X,g.isAxiosError=!0,g.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},g}},function(j,m,o){var g=o(36);function z(I){return encodeURIComponent(I).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}j.exports=function(I,A,X){if(!A)return I;var K;if(X)K=X(A);else if(g.isURLSearchParams(A))K=A.toString();else{var M=[];g.forEach(A,function($,W){$!=null&&(g.isArray($)?W+="[]":$=[$],g.forEach($,function(te){g.isDate(te)?te=te.toISOString():g.isObject(te)&&(te=JSON.stringify(te)),M.push(z(W)+"="+z(te))}))}),K=M.join("&")}if(K){var V=I.indexOf("#");V!==-1&&(I=I.slice(0,V)),I+=(I.indexOf("?")===-1?"?":"&")+K}return I}},function(j,m,o){j.exports=function(g,z){return function(){for(var I=new Array(arguments.length),A=0;A<I.length;A++)I[A]=arguments[A];return g.apply(z,I)}}},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var g=this&&this.__awaiter||function(V,$,W,te){return new(W||(W=Promise))(function(F,ue){function se(pe){try{me(te.next(pe))}catch(Oe){ue(Oe)}}function J(pe){try{me(te.throw(pe))}catch(Oe){ue(Oe)}}function me(pe){pe.done?F(pe.value):new W(function(Oe){Oe(pe.value)}).then(se,J)}me((te=te.apply(V,$||[])).next())})},z=this&&this.__importDefault||function(V){return V&&V.__esModule?V:{default:V}};Object.defineProperty(m,"__esModule",{value:!0});const I=z(o(88)),A=o(64),X=o(111),K=o(46);m.linechart=function(V,$,W={}){return g(this,void 0,void 0,function*(){const te=Array.isArray($.values[0])?$.values:[$.values],F=te[0].length,ue=$.series?$.series:te.map((Le,Ae)=>`Series ${Ae+1}`);X.assert(ue.length===te.length,"Must have an equal number of series labels as there are data series"),W.seriesColors!=null&&X.assert(W.seriesColors.length===te.length,"Must have an equal number of series colors as there are data series");const se=[];for(let Le=0;Le<F;Le++){const Ae={x:Le};ue.forEach((ft,Mt)=>{const Xt=te[Mt][Le].y;Ae[ft]=Xt,Ae[`${ft}-name`]=ft}),se.push(Ae)}const J=Object.assign({},M,W),me={x:{field:"x",type:J.xType,title:J.xLabel},tooltip:[{field:"x",type:"quantitative"},...ue.map(Le=>({field:Le,type:"quantitative"}))]},pe=ue.map(Le=>({data:void 0,mark:{type:"line",clip:!0},encoding:{y:{field:Le,type:J.yType,title:J.yLabel,scale:J.zoomToFit?{zero:!1}:J.yAxisDomain!=null?{domain:J.yAxisDomain}:void 0},color:{field:`${Le}-name`,type:"nominal",legend:{values:ue,title:null},scale:{range:J.seriesColors}}}})),Oe=K.getDrawArea(V),Fe={width:J.width||A.getDefaultWidth(Oe),height:J.height||A.getDefaultHeight(Oe),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:J.fontSize,titleFontSize:J.fontSize},text:{fontSize:J.fontSize},legend:{labelFontSize:J.fontSize,titleFontSize:J.fontSize}},data:{values:se},encoding:me,layer:[...pe,{mark:"rule",selection:{hover:{type:"single",on:"mouseover",nearest:!0,clear:"mouseout"}},encoding:{color:{value:"grey",condition:{selection:{not:"hover"},value:"transparent"}}}}]};return yield I.default(Oe,Fe,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()})};const M={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});const g=o(292);let z;const I="Visor",A="tfjs-visor-container";m.visor=function(){if(typeof document=="undefined")throw new Error("No document defined. This library needs a browser/dom to work");if(document.getElementById(A)&&z!=null)return z;let K,M=document.getElementById(A);function V(te,F){let ue=null;return K=g.VisorComponent.render(te,K,{ref:se=>ue=se,surfaceList:Array.from(F.values())}),ue}M==null&&((M=document.createElement("div")).id=A,document.body.appendChild(M));const $=new Map,W=V(M,$);return z=new X(W,M,$,V)};class X{constructor(M,V,$,W){this.visorComponent=M,this.el=V,this.surfaceList=$,this.renderVisor=W}surface(M){const{name:V}=M,$=M.tab==null?I:M.tab;if(V==null||!(typeof V=="string"||V instanceof String))throw new Error("You must pass a config object with a 'name' property to create or retrieve a surface");const W=Object.assign({},M,{tab:$}),te=`${V}-${$}`;return this.surfaceList.has(te)||this.surfaceList.set(te,W),this.renderVisor(this.el,this.surfaceList),this.visorComponent.getSurface(V,$)}isFullscreen(){return this.visorComponent.isFullscreen()}isOpen(){return this.visorComponent.isOpen()}close(){return this.visorComponent.close()}open(){return this.visorComponent.open()}toggle(){return this.visorComponent.toggle()}toggleFullScreen(){return this.visorComponent.toggleFullScreen()}bindKeys(){return this.visorComponent.bindKeys()}unbindKeys(){return this.visorComponent.unbindKeys()}setActiveTab(M){if(!this.visorComponent.state.tabs.has(M))throw new Error(`Tab '${M}' does not exist`);this.visorComponent.setState({activeTab:M})}}m.Visor=X},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.isSurfaceInfo=function(g){return g.name!=null},m.isSurface=function(g){return g.drawArea instanceof HTMLElement}},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.default=function(g){return g.charAt(0).toUpperCase()+g.slice(1)},j.exports=m.default},function(j,m,o){var g=o(315);j.exports=g},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.processStyleName=void 0,m.createMarkupForStyles=function(K,M){var V="";for(var $ in K){var W=$.indexOf("--")===0;if(K.hasOwnProperty($)&&$!=="label"){var te=K[$];te!=null&&(W?V+=$+":"+te+";":(V+=X($)+":",V+=(0,g.default)($,te,M)+";"))}}return V||null},A(o(319));var g=A(o(317)),z=A(o(314)),I=A(o(312));A(o(200));function A(K){return K&&K.__esModule?K:{default:K}}var X=m.processStyleName=(0,I.default)(z.default)},function(j,m,o){o.r(m),o.d(m,"default",function(){return A}),o.d(m,"point",function(){return X});var g=o(null),z=o(null),I=o(null);function A(){var K,M,V=Object(I.a)().unknown(void 0),$=V.domain,W=V.range,te=0,F=1,ue=!1,se=0,J=0,me=.5;function pe(){var Oe=$().length,Fe=F<te,Le=Fe?F:te,Ae=Fe?te:F;K=(Ae-Le)/Math.max(1,Oe-se+2*J),ue&&(K=Math.floor(K)),Le+=(Ae-Le-K*(Oe-se))*me,M=K*(1-se),ue&&(Le=Math.round(Le),M=Math.round(M));var ft=Object(g.a)(Oe).map(function(Mt){return Le+K*Mt});return W(Fe?ft.reverse():ft)}return delete V.unknown,V.domain=function(Oe){return arguments.length?($(Oe),pe()):$()},V.range=function(Oe){return arguments.length?([te,F]=Oe,te=+te,F=+F,pe()):[te,F]},V.rangeRound=function(Oe){return[te,F]=Oe,te=+te,F=+F,ue=!0,pe()},V.bandwidth=function(){return M},V.step=function(){return K},V.round=function(Oe){return arguments.length?(ue=!!Oe,pe()):ue},V.padding=function(Oe){return arguments.length?(se=Math.min(1,J=+Oe),pe()):se},V.paddingInner=function(Oe){return arguments.length?(se=Math.min(1,Oe),pe()):se},V.paddingOuter=function(Oe){return arguments.length?(J=+Oe,pe()):J},V.align=function(Oe){return arguments.length?(me=Math.max(0,Math.min(1,Oe)),pe()):me},V.copy=function(){return A($(),[te,F]).round(ue).paddingInner(se).paddingOuter(J).align(me)},z.a.apply(pe(),arguments)}function X(){return function K(M){var V=M.copy;return M.padding=M.paddingOuter,delete M.paddingInner,delete M.paddingOuter,M.copy=function(){return K(V())},M}(A.apply(null,arguments).paddingInner(1))}},function(j,m,o){const g=o(145),z=o(204),I=o(114),A=o(142),X=o(143),K=o(141);j.exports=(M,V,$,W)=>{switch(V){case"===":return typeof M=="object"&&(M=M.version),typeof $=="object"&&($=$.version),M===$;case"!==":return typeof M=="object"&&(M=M.version),typeof $=="object"&&($=$.version),M!==$;case"":case"=":case"==":return g(M,$,W);case"!=":return z(M,$,W);case">":return I(M,$,W);case">=":return A(M,$,W);case"<":return X(M,$,W);case"<=":return K(M,$,W);default:throw new TypeError(`Invalid operator: ${V}`)}}},function(j,m,o){const g=o(48);j.exports=(z,I,A)=>g(z,I,A)!==0},function(j,m,o){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(25),z=o(73),I=o(74),A=o(29),X=o(374),K=o(28);m.div=K.op({div_:function(M,V){var $,W=A.convertToTensor(M,"a","div"),te=A.convertToTensor(V,"b","div");if($=I.makeTypesMatch(W,te),W=$[0],te=$[1],W.dtype==="int32"&&te.dtype==="int32")return X.floorDiv(W,te);var F={a:W,b:te};return g.ENGINE.runKernelFunc(function(ue,se){var J=ue.realDivide(W,te);return se([W,te]),J},F,null,z.Div,{})}})},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var g=o(25),z=o(73),I=o(74),A=o(29),X=o(28);m.add=X.op({add_:function(K,M){var V,$=A.convertToTensor(K,"a","add"),W=A.convertToTensor(M,"b","add");V=I.makeTypesMatch($,W),$=V[0],W=V[1];var te={a:$,b:W};return g.ENGINE.runKernelFunc(function(F,ue){var se=F.add($,W);return ue([$,W]),se},te,null,z.Add)}})},function(j,m,o){(function(g){var z=g!==void 0&&g||typeof self!="undefined"&&self||window,I=Function.prototype.apply;function A(X,K){this._id=X,this._clearFn=K}m.setTimeout=function(){return new A(I.call(setTimeout,z,arguments),clearTimeout)},m.setInterval=function(){return new A(I.call(setInterval,z,arguments),clearInterval)},m.clearTimeout=m.clearInterval=function(X){X&&X.close()},A.prototype.unref=A.prototype.ref=function(){},A.prototype.close=function(){this._clearFn.call(z,this._id)},m.enroll=function(X,K){clearTimeout(X._idleTimeoutId),X._idleTimeout=K},m.unenroll=function(X){clearTimeout(X._idleTimeoutId),X._idleTimeout=-1},m._unrefActive=m.active=function(X){clearTimeout(X._idleTimeoutId);var K=X._idleTimeout;K>=0&&(X._idleTimeoutId=setTimeout(function(){X._onTimeout&&X._onTimeout()},K))},o(391),m.setImmediate=typeof self!="undefined"&&self.setImmediate||g!==void 0&&g.setImmediate||this&&this.setImmediate,m.clearImmediate=typeof self!="undefined"&&self.clearImmediate||g!==void 0&&g.clearImmediate||this&&this.clearImmediate}).call(this,o(59))},function(j,m){j.exports=function(o){try{return!!o()}catch{return!0}}},function(j,m){var o=j.exports={version:"2.6.12"};typeof __e=="number"&&(__e=o)},function(j,m,o){var g=o(27),z=o(82),I=o(41),A=o(106).f;j.exports=function(X){return function(K){for(var M,V=I(K),$=z(V),W=$.length,te=0,F=[];W>te;)M=$[te++],g&&!A.call(V,M)||F.push(X?[M,V[M]]:V[M]);return F}}},function(j,m,o){var g=o(22),z=o(167),I=o(61);j.exports=function(A,X,K,M){var V=String(I(A)),$=V.length,W=K===void 0?" ":String(K),te=g(X);if(te<=$||W=="")return V;var F=te-$,ue=z.call(W,Math.ceil(F/W.length));return ue.length>F&&(ue=ue.slice(0,F)),M?ue+V:V+ue}},function(j,m,o){var g=o(79),z=o(127),I=o(14),A=o(16).Reflect;j.exports=A&&A.ownKeys||function(X){var K=g.f(I(X)),M=z.f;return M?K.concat(M(X)):K}},function(j,m,o){var g=o(54),z=o(22);j.exports=function(I){if(I===void 0)return 0;var A=g(I),X=z(A);if(A!==X)throw RangeError("Wrong length!");return X}},function(j,m,o){var g=o(93),z=o(65).getWeak,I=o(14),A=o(13),X=o(94),K=o(121),M=o(51),V=o(43),$=o(76),W=M(5),te=M(6),F=0,ue=function(me){return me._l||(me._l=new se)},se=function(){this.a=[]},J=function(me,pe){return W(me.a,function(Oe){return Oe[0]===pe})};se.prototype={get:function(me){var pe=J(this,me);if(pe)return pe[1]},has:function(me){return!!J(this,me)},set:function(me,pe){var Oe=J(this,me);Oe?Oe[1]=pe:this.a.push([me,pe])},delete:function(me){var pe=te(this.a,function(Oe){return Oe[0]===me});return~pe&&this.a.splice(pe,1),!!~pe}},j.exports={getConstructor:function(me,pe,Oe,Fe){var Le=me(function(Ae,ft){X(Ae,Le,pe,"_i"),Ae._t=pe,Ae._i=F++,Ae._l=void 0,ft!=null&&K(ft,Oe,Ae[Fe],Ae)});return g(Le.prototype,{delete:function(Ae){if(!A(Ae))return!1;var ft=z(Ae);return ft===!0?ue($(this,pe)).delete(Ae):ft&&V(ft,this._i)&&delete ft[this._i]},has:function(Ae){if(!A(Ae))return!1;var ft=z(Ae);return ft===!0?ue($(this,pe)).has(Ae):ft&&V(ft,this._i)}}),Le},def:function(me,pe,Oe){var Fe=z(I(pe),!0);return Fe===!0?ue(me).set(pe,Oe):Fe[me._i]=Oe,me},ufstore:ue}},function(j,m,o){var g=o(26).f,z=o(80),I=o(93),A=o(56),X=o(94),K=o(121),M=o(163),V=o(221),$=o(95),W=o(27),te=o(65).fastKey,F=o(76),ue=W?"_s":"size",se=function(J,me){var pe,Oe=te(me);if(Oe!=="F")return J._i[Oe];for(pe=J._f;pe;pe=pe.n)if(pe.k==me)return pe};j.exports={getConstructor:function(J,me,pe,Oe){var Fe=J(function(Le,Ae){X(Le,Fe,me,"_i"),Le._t=me,Le._i=z(null),Le._f=void 0,Le._l=void 0,Le[ue]=0,Ae!=null&&K(Ae,pe,Le[Oe],Le)});return I(Fe.prototype,{clear:function(){for(var Le=F(this,me),Ae=Le._i,ft=Le._f;ft;ft=ft.n)ft.r=!0,ft.p&&(ft.p=ft.p.n=void 0),delete Ae[ft.i];Le._f=Le._l=void 0,Le[ue]=0},delete:function(Le){var Ae=F(this,me),ft=se(Ae,Le);if(ft){var Mt=ft.n,Xt=ft.p;delete Ae._i[ft.i],ft.r=!0,Xt&&(Xt.n=Mt),Mt&&(Mt.p=Xt),Ae._f==ft&&(Ae._f=Mt),Ae._l==ft&&(Ae._l=Xt),Ae[ue]--}return!!ft},forEach:function(Le){F(this,me);for(var Ae,ft=A(Le,arguments.length>1?arguments[1]:void 0,3);Ae=Ae?Ae.n:this._f;)for(ft(Ae.v,Ae.k,this);Ae&&Ae.r;)Ae=Ae.p},has:function(Le){return!!se(F(this,me),Le)}}),W&&g(Fe.prototype,"size",{get:function(){return F(this,me)[ue]}}),Fe},def:function(J,me,pe){var Oe,Fe,Le=se(J,me);return Le?Le.v=pe:(J._l=Le={i:Fe=te(me,!0),k:me,v:pe,p:Oe=J._l,n:void 0,r:!1},J._f||(J._f=Le),Oe&&(Oe.n=Le),J[ue]++,Fe!=="F"&&(J._i[Fe]=Le)),J},getEntry:se,setStrong:function(J,me,pe){M(J,me,function(Oe,Fe){this._t=F(Oe,me),this._k=Fe,this._l=void 0},function(){for(var Oe=this._k,Fe=this._l;Fe&&Fe.r;)Fe=Fe.p;return this._t&&(this._l=Fe=Fe?Fe.n:this._t._f)?V(0,Oe=="keys"?Fe.k:Oe=="values"?Fe.v:[Fe.k,Fe.v]):(this._t=void 0,V(1))},pe?"entries":"values",!pe,!0),$(me)}}},function(j,m,o){var g=o(14),z=o(13),I=o(217);j.exports=function(A,X){if(g(A),z(X)&&X.constructor===A)return X;var K=I.f(A);return(0,K.resolve)(X),K.promise}},function(j,m,o){var g=o(55);j.exports.f=function(z){return new function(I){var A,X;this.promise=new I(function(K,M){if(A!==void 0||X!==void 0)throw TypeError("Bad Promise constructor");A=K,X=M}),this.resolve=g(A),this.reject=g(X)}(z)}},function(j,m,o){var g,z,I,A,X=o(83),K=o(16),M=o(56),V=o(105),$=o(8),W=o(13),te=o(55),F=o(94),ue=o(121),se=o(104),J=o(152).set,me=o(466)(),pe=o(217),Oe=o(465),Fe=o(120),Le=o(216),Ae=K.TypeError,ft=K.process,Mt=ft&&ft.versions,Xt=Mt&&Mt.v8||"",tn=K.Promise,Ce=V(ft)=="process",Wt=function(){},en=z=pe.f,Ut=!!function(){try{var Rt=tn.resolve(1),Tn=(Rt.constructor={})[o(19)("species")]=function(Hn){Hn(Wt,Wt)};return(Ce||typeof PromiseRejectionEvent=="function")&&Rt.then(Wt)instanceof Tn&&Xt.indexOf("6.6")!==0&&Fe.indexOf("Chrome/66")===-1}catch{}}(),Qe=function(Rt){var Tn;return!(!W(Rt)||typeof(Tn=Rt.then)!="function")&&Tn},fn=function(Rt,Tn){if(!Rt._n){Rt._n=!0;var Hn=Rt._c;me(function(){for(var tr=Rt._v,pn=Rt._s==1,$e=0,et=function(Ke){var yt,Dt,Lt,zn=pn?Ke.ok:Ke.fail,Cn=Ke.resolve,ar=Ke.reject,we=Ke.domain;try{zn?(pn||(Rt._h==2&&Vt(Rt),Rt._h=1),zn===!0?yt=tr:(we&&we.enter(),yt=zn(tr),we&&(we.exit(),Lt=!0)),yt===Ke.promise?ar(Ae("Promise-chain cycle")):(Dt=Qe(yt))?Dt.call(yt,Cn,ar):Cn(yt)):ar(tr)}catch(lr){we&&!Lt&&we.exit(),ar(lr)}};Hn.length>$e;)et(Hn[$e++]);Rt._c=[],Rt._n=!1,Tn&&!Rt._h&&on(Rt)})}},on=function(Rt){J.call(K,function(){var Tn,Hn,tr,pn=Rt._v,$e=Ct(Rt);if($e&&(Tn=Oe(function(){Ce?ft.emit("unhandledRejection",pn,Rt):(Hn=K.onunhandledrejection)?Hn({promise:Rt,reason:pn}):(tr=K.console)&&tr.error&&tr.error("Unhandled promise rejection",pn)}),Rt._h=Ce||Ct(Rt)?2:1),Rt._a=void 0,$e&&Tn.e)throw Tn.v})},Ct=function(Rt){return Rt._h!==1&&(Rt._a||Rt._c).length===0},Vt=function(Rt){J.call(K,function(){var Tn;Ce?ft.emit("rejectionHandled",Rt):(Tn=K.onrejectionhandled)&&Tn({promise:Rt,reason:Rt._v})})},En=function(Rt){var Tn=this;Tn._d||(Tn._d=!0,(Tn=Tn._w||Tn)._v=Rt,Tn._s=2,Tn._a||(Tn._a=Tn._c.slice()),fn(Tn,!0))},Pt=function(Rt){var Tn,Hn=this;if(!Hn._d){Hn._d=!0,Hn=Hn._w||Hn;try{if(Hn===Rt)throw Ae("Promise can't be resolved itself");(Tn=Qe(Rt))?me(function(){var tr={_w:Hn,_d:!1};try{Tn.call(Rt,M(Pt,tr,1),M(En,tr,1))}catch(pn){En.call(tr,pn)}}):(Hn._v=Rt,Hn._s=1,fn(Hn,!1))}catch(tr){En.call({_w:Hn,_d:!1},tr)}}};Ut||(tn=function(Rt){F(this,tn,"Promise","_h"),te(Rt),g.call(this);try{Rt(M(Pt,this,1),M(En,this,1))}catch(Tn){En.call(this,Tn)}},(g=function(Rt){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=o(93)(tn.prototype,{then:function(Rt,Tn){var Hn=en(se(this,tn));return Hn.ok=typeof Rt!="function"||Rt,Hn.fail=typeof Tn=="function"&&Tn,Hn.domain=Ce?ft.domain:void 0,this._c.push(Hn),this._a&&this._a.push(Hn),this._s&&fn(this,!1),Hn.promise},catch:function(Rt){return this.then(void 0,Rt)}}),I=function(){var Rt=new g;this.promise=Rt,this.resolve=M(Pt,Rt,1),this.reject=M(En,Rt,1)},pe.f=en=function(Rt){return Rt===tn||Rt===A?new I(Rt):z(Rt)}),$($.G+$.W+$.F*!Ut,{Promise:tn}),o(98)(tn,"Promise"),o(95)("Promise"),A=o(24).Promise,$($.S+$.F*!Ut,"Promise",{reject:function(Rt){var Tn=en(this);return(0,Tn.reject)(Rt),Tn.promise}}),$($.S+$.F*(X||!Ut),"Promise",{resolve:function(Rt){return Le(X&&this===A?tn:this,Rt)}}),$($.S+$.F*!(Ut&&o(125)(function(Rt){tn.all(Rt).catch(Wt)})),"Promise",{all:function(Rt){var Tn=this,Hn=en(Tn),tr=Hn.resolve,pn=Hn.reject,$e=Oe(function(){var et=[],Ke=0,yt=1;ue(Rt,!1,function(Dt){var Lt=Ke++,zn=!1;et.push(void 0),yt++,Tn.resolve(Dt).then(function(Cn){zn||(zn=!0,et[Lt]=Cn,--yt||tr(et))},pn)}),--yt||tr(et)});return $e.e&&pn($e.v),Hn.promise},race:function(Rt){var Tn=this,Hn=en(Tn),tr=Hn.reject,pn=Oe(function(){ue(Rt,!1,function($e){Tn.resolve($e).then(Hn.resolve,tr)})});return pn.e&&tr(pn.v),Hn.promise}})},function(j,m,o){o(27)&&/./g.flags!="g"&&o(26).f(RegExp.prototype,"flags",{configurable:!0,get:o(124)})},function(j,m,o){var g=o(154);o(8)({target:"RegExp",proto:!0,forced:g!==/./.exec},{exec:g})},function(j,m){j.exports=function(o,g){return{value:g,done:!!o}}},function(j,m,o){var g=o(34),z=o(81),I=o(22);j.exports=[].copyWithin||function(A,X){var K=g(this),M=I(K.length),V=z(A,M),$=z(X,M),W=arguments.length>2?arguments[2]:void 0,te=Math.min((W===void 0?M:z(W,M))-$,M-V),F=1;for($<V&&V<$+te&&(F=-1,$+=te-1,V+=te-1);te-- >0;)$ in K?K[V]=K[$]:delete K[V],V+=F,$+=F;return K}},function(j,m,o){var g=o(55),z=o(34),I=o(107),A=o(22);j.exports=function(X,K,M,V,$){g(K);var W=z(X),te=I(W),F=A(W.length),ue=$?F-1:0,se=$?-1:1;if(M<2)for(;;){if(ue in te){V=te[ue],ue+=se;break}if(ue+=se,$?ue<0:F<=ue)throw TypeError("Reduce of empty array with no initial value")}for(;$?ue>=0:F>ue;ue+=se)ue in te&&(V=K(V,te[ue],ue,W));return V}},function(j,m,o){var g=o(486);j.exports=function(z,I){return new(g(z))(I)}},function(j,m,o){var g=o(14);j.exports=function(z,I,A,X){try{return X?I(g(A)[0],A[1]):I(A)}catch(M){var K=z.return;throw K!==void 0&&g(K.call(z)),M}}},function(j,m,o){var g=o(80),z=o(85),I=o(98),A={};o(42)(A,o(19)("iterator"),function(){return this}),j.exports=function(X,K,M){X.prototype=g(A,{next:z(1,M)}),I(X,K+" Iterator")}},function(j,m){j.exports=Math.log1p||function(o){return(o=+o)>-1e-8&&o<1e-8?o-o*o/2:Math.log(1+o)}},function(j,m,o){var g=o(13),z=Math.floor;j.exports=function(I){return!g(I)&&isFinite(I)&&z(I)===I}},function(j,m,o){var g=o(62);j.exports=function(z,I){if(typeof z!="number"&&g(z)!="Number")throw TypeError(I);return+z}},function(j,m,o){var g=o(16).parseFloat,z=o(97).trim;j.exports=1/g(o(169)+"-0")!=-1/0?function(I){var A=z(String(I),3),X=g(A);return X===0&&A.charAt(0)=="-"?-0:X}:g},function(j,m,o){var g=o(16).parseInt,z=o(97).trim,I=o(169),A=/^[-+]?0[xX]/;j.exports=g(I+"08")!==8||g(I+"0x16")!==22?function(X,K){var M=z(String(X),3);return g(M,K>>>0||(A.test(M)?16:10))}:g},function(j,m){j.exports=function(o,g,z){var I=z===void 0;switch(g.length){case 0:return I?o():o.call(z);case 1:return I?o(g[0]):o.call(z,g[0]);case 2:return I?o(g[0],g[1]):o.call(z,g[0],g[1]);case 3:return I?o(g[0],g[1],g[2]):o.call(z,g[0],g[1],g[2]);case 4:return I?o(g[0],g[1],g[2],g[3]):o.call(z,g[0],g[1],g[2],g[3])}return o.apply(z,g)}},function(j,m,o){var g=o(55),z=o(13),I=o(232),A=[].slice,X={};j.exports=Function.bind||function(K){var M=g(this),V=A.call(arguments,1),$=function(){var W=V.concat(A.call(arguments));return this instanceof $?function(te,F,ue){if(!(F in X)){for(var se=[],J=0;J<F;J++)se[J]="a["+J+"]";X[F]=Function("F,a","return new F("+se.join(",")+")")}return X[F](te,ue)}(M,W.length,W):I(M,W,K)};return z(M.prototype)&&($.prototype=M.prototype),$}},function(j,m){j.exports=Object.is||function(o,g){return o===g?o!==0||1/o==1/g:o!=o&&g!=g}},function(j,m,o){var g=o(27),z=o(82),I=o(127),A=o(106),X=o(34),K=o(107),M=Object.assign;j.exports=!M||o(15)(function(){var V={},$={},W=Symbol(),te="abcdefghijklmnopqrst";return V[W]=7,te.split("").forEach(function(F){$[F]=F}),M({},V)[W]!=7||Object.keys(M({},$)).join("")!=te})?function(V,$){for(var W=X(V),te=arguments.length,F=1,ue=I.f,se=A.f;te>F;)for(var J,me=K(arguments[F++]),pe=ue?z(me).concat(ue(me)):z(me),Oe=pe.length,Fe=0;Oe>Fe;)J=pe[Fe++],g&&!se.call(me,J)||(W[J]=me[J]);return W}:M},function(j,m,o){var g=o(41),z=o(79).f,I={}.toString,A=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];j.exports.f=function(X){return A&&I.call(X)=="[object Window]"?function(K){try{return z(K)}catch{return A.slice()}}(X):z(g(X))}},function(j,m,o){var g=o(26),z=o(14),I=o(82);j.exports=o(27)?Object.defineProperties:function(A,X){z(A);for(var K,M=I(X),V=M.length,$=0;V>$;)g.f(A,K=M[$++],X[K]);return A}},function(j,m,o){var g=o(43),z=o(41),I=o(128)(!1),A=o(173)("IE_PROTO");j.exports=function(X,K){var M,V=z(X),$=0,W=[];for(M in V)M!=A&&g(V,M)&&W.push(M);for(;K.length>$;)g(V,M=K[$++])&&(~I(W,M)||W.push(M));return W}},function(j,m,o){var g=o(16),z=o(24),I=o(83),A=o(174),X=o(26).f;j.exports=function(K){var M=z.Symbol||(z.Symbol=I?{}:g.Symbol||{});K.charAt(0)=="_"||K in M||X(M,K,{value:A.f(K)})}},function(j,m,o){j.exports=!o(27)&&!o(15)(function(){return Object.defineProperty(o(175)("div"),"a",{get:function(){return 7}}).a!=7})},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0});var g=o(2);m.tf=g,function(z){for(var I in z)m.hasOwnProperty(I)||(m[I]=z[I])}(o(257))},function(j,m,o){/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(function(g,z,I){const A={1:{name:"/m/01g317",id:1,displayName:"person"},2:{name:"/m/0199g",id:2,displayName:"bicycle"},3:{name:"/m/0k4j",id:3,displayName:"car"},4:{name:"/m/04_sv",id:4,displayName:"motorcycle"},5:{name:"/m/05czz6l",id:5,displayName:"airplane"},6:{name:"/m/01bjv",id:6,displayName:"bus"},7:{name:"/m/07jdr",id:7,displayName:"train"},8:{name:"/m/07r04",id:8,displayName:"truck"},9:{name:"/m/019jd",id:9,displayName:"boat"},10:{name:"/m/015qff",id:10,displayName:"traffic light"},11:{name:"/m/01pns0",id:11,displayName:"fire hydrant"},13:{name:"/m/02pv19",id:13,displayName:"stop sign"},14:{name:"/m/015qbp",id:14,displayName:"parking meter"},15:{name:"/m/0cvnqh",id:15,displayName:"bench"},16:{name:"/m/015p6",id:16,displayName:"bird"},17:{name:"/m/01yrx",id:17,displayName:"cat"},18:{name:"/m/0bt9lr",id:18,displayName:"dog"},19:{name:"/m/03k3r",id:19,displayName:"horse"},20:{name:"/m/07bgp",id:20,displayName:"sheep"},21:{name:"/m/01xq0k1",id:21,displayName:"cow"},22:{name:"/m/0bwd_0j",id:22,displayName:"elephant"},23:{name:"/m/01dws",id:23,displayName:"bear"},24:{name:"/m/0898b",id:24,displayName:"zebra"},25:{name:"/m/03bk1",id:25,displayName:"giraffe"},27:{name:"/m/01940j",id:27,displayName:"backpack"},28:{name:"/m/0hnnb",id:28,displayName:"umbrella"},31:{name:"/m/080hkjn",id:31,displayName:"handbag"},32:{name:"/m/01rkbr",id:32,displayName:"tie"},33:{name:"/m/01s55n",id:33,displayName:"suitcase"},34:{name:"/m/02wmf",id:34,displayName:"frisbee"},35:{name:"/m/071p9",id:35,displayName:"skis"},36:{name:"/m/06__v",id:36,displayName:"snowboard"},37:{name:"/m/018xm",id:37,displayName:"sports ball"},38:{name:"/m/02zt3",id:38,displayName:"kite"},39:{name:"/m/03g8mr",id:39,displayName:"baseball bat"},40:{name:"/m/03grzl",id:40,displayName:"baseball glove"},41:{name:"/m/06_fw",id:41,displayName:"skateboard"},42:{name:"/m/019w40",id:42,displayName:"surfboard"},43:{name:"/m/0dv9c",id:43,displayName:"tennis racket"},44:{name:"/m/04dr76w",id:44,displayName:"bottle"},46:{name:"/m/09tvcd",id:46,displayName:"wine glass"},47:{name:"/m/08gqpm",id:47,displayName:"cup"},48:{name:"/m/0dt3t",id:48,displayName:"fork"},49:{name:"/m/04ctx",id:49,displayName:"knife"},50:{name:"/m/0cmx8",id:50,displayName:"spoon"},51:{name:"/m/04kkgm",id:51,displayName:"bowl"},52:{name:"/m/09qck",id:52,displayName:"banana"},53:{name:"/m/014j1m",id:53,displayName:"apple"},54:{name:"/m/0l515",id:54,displayName:"sandwich"},55:{name:"/m/0cyhj_",id:55,displayName:"orange"},56:{name:"/m/0hkxq",id:56,displayName:"broccoli"},57:{name:"/m/0fj52s",id:57,displayName:"carrot"},58:{name:"/m/01b9xk",id:58,displayName:"hot dog"},59:{name:"/m/0663v",id:59,displayName:"pizza"},60:{name:"/m/0jy4k",id:60,displayName:"donut"},61:{name:"/m/0fszt",id:61,displayName:"cake"},62:{name:"/m/01mzpv",id:62,displayName:"chair"},63:{name:"/m/02crq1",id:63,displayName:"couch"},64:{name:"/m/03fp41",id:64,displayName:"potted plant"},65:{name:"/m/03ssj5",id:65,displayName:"bed"},67:{name:"/m/04bcr3",id:67,displayName:"dining table"},70:{name:"/m/09g1w",id:70,displayName:"toilet"},72:{name:"/m/07c52",id:72,displayName:"tv"},73:{name:"/m/01c648",id:73,displayName:"laptop"},74:{name:"/m/020lf",id:74,displayName:"mouse"},75:{name:"/m/0qjjc",id:75,displayName:"remote"},76:{name:"/m/01m2v",id:76,displayName:"keyboard"},77:{name:"/m/050k8",id:77,displayName:"cell phone"},78:{name:"/m/0fx9l",id:78,displayName:"microwave"},79:{name:"/m/029bxz",id:79,displayName:"oven"},80:{name:"/m/01k6s3",id:80,displayName:"toaster"},81:{name:"/m/0130jx",id:81,displayName:"sink"},82:{name:"/m/040b_t",id:82,displayName:"refrigerator"},84:{name:"/m/0bt_c3",id:84,displayName:"book"},85:{name:"/m/01x3z",id:85,displayName:"clock"},86:{name:"/m/02s195",id:86,displayName:"vase"},87:{name:"/m/01lsmm",id:87,displayName:"scissors"},88:{name:"/m/0kmg4",id:88,displayName:"teddy bear"},89:{name:"/m/03wvsk",id:89,displayName:"hair drier"},90:{name:"/m/012xff",id:90,displayName:"toothbrush"}};class X{constructor(M,V){this.modelPath=V||`https://storage.googleapis.com/tfjs-models/savedmodel/${this.getPrefix(M)}/model.json`}getPrefix(M){return M==="lite_mobilenet_v2"?`ssd${M}`:`ssd_${M}`}async load(){this.model=await z.loadGraphModel(this.modelPath);const M=I.zeros([1,300,300,3],"int32"),V=await this.model.executeAsync(M);await Promise.all(V.map($=>$.data())),V.map($=>$.dispose()),M.dispose()}async infer(M,V,$){const W=I.tidy(()=>(M instanceof I.Tensor||(M=I.browser.fromPixels(M)),I.expandDims(M))),te=W.shape[1],F=W.shape[2],ue=await this.model.executeAsync(W),se=ue[0].dataSync(),J=ue[1].dataSync();W.dispose(),I.dispose(ue);const[me,pe]=this.calculateMaxScores(se,ue[0].shape[1],ue[0].shape[2]),Oe=I.getBackend();I.getBackend()==="webgl"&&I.setBackend("cpu");const Fe=I.tidy(()=>{const Ae=I.tensor2d(J,[ue[1].shape[1],ue[1].shape[3]]);return I.image.nonMaxSuppression(Ae,me,V,$,$)}),Le=Fe.dataSync();return Fe.dispose(),Oe!==I.getBackend()&&I.setBackend(Oe),this.buildDetectedObjects(F,te,J,me,Le,pe)}buildDetectedObjects(M,V,$,W,te,F){const ue=te.length,se=[];for(let J=0;J<ue;J++){const me=[];for(let Ae=0;Ae<4;Ae++)me[Ae]=$[4*te[J]+Ae];const pe=me[0]*V,Oe=me[1]*M,Fe=me[2]*V,Le=me[3]*M;me[0]=Oe,me[1]=pe,me[2]=Le-Oe,me[3]=Fe-pe,se.push({bbox:me,class:A[F[te[J]]+1].displayName,score:W[te[J]]})}return se}calculateMaxScores(M,V,$){const W=[],te=[];for(let F=0;F<V;F++){let ue=Number.MIN_VALUE,se=-1;for(let J=0;J<$;J++)M[F*$+J]>ue&&(ue=M[F*$+J],se=J);W[F]=ue,te[F]=se}return[W,te]}async detect(M,V=20,$=.5){return this.infer(M,V,$)}dispose(){this.model!=null&&this.model.dispose()}}g.ObjectDetection=X,g.load=async function(K={}){if(I==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");const M=K.base||"lite_mobilenet_v2",V=K.modelUrl;if(["mobilenet_v1","mobilenet_v2","lite_mobilenet_v2"].indexOf(M)===-1)throw new Error(`ObjectDetection constructed with invalid base model ${M}. Valid names are 'mobilenet_v1', 'mobilenet_v2' and 'lite_mobilenet_v2'.`);const $=new X(M,V);return await $.load(),$},g.version="2.2.2",Object.defineProperty(g,"__esModule",{value:!0})})(m,o(20),o(0))},function(j,m,o){j.exports=function g(z,I){if(z===I)return!0;if(z&&I&&typeof z=="object"&&typeof I=="object"){if(z.constructor!==I.constructor)return!1;var A,X,K;if(Array.isArray(z)){if((A=z.length)!=I.length)return!1;for(X=A;X--!=0;)if(!g(z[X],I[X]))return!1;return!0}if(z.constructor===RegExp)return z.source===I.source&&z.flags===I.flags;if(z.valueOf!==Object.prototype.valueOf)return z.valueOf()===I.valueOf();if(z.toString!==Object.prototype.toString)return z.toString()===I.toString();if((A=(K=Object.keys(z)).length)!==Object.keys(I).length)return!1;for(X=A;X--!=0;)if(!Object.prototype.hasOwnProperty.call(I,K[X]))return!1;for(X=A;X--!=0;){var M=K[X];if(!g(z[M],I[M]))return!1}return!0}return z!=z&&I!=I}},function(j,m,o){(function(g){var z=function(){function I(W,te){return te!=null&&W instanceof te}var A,X,K;try{A=Map}catch{A=function(){}}try{X=Set}catch{X=function(){}}try{K=Promise}catch{K=function(){}}function M(W,te,F,ue,se){typeof te=="object"&&(F=te.depth,ue=te.prototype,se=te.includeNonEnumerable,te=te.circular);var J=[],me=[],pe=g!==void 0;return te===void 0&&(te=!0),F===void 0&&(F=1/0),function Oe(Fe,Le){if(Fe===null)return null;if(Le===0)return Fe;var Ae,ft;if(typeof Fe!="object")return Fe;if(I(Fe,A))Ae=new A;else if(I(Fe,X))Ae=new X;else if(I(Fe,K))Ae=new K(function(fn,on){Fe.then(function(Ct){fn(Oe(Ct,Le-1))},function(Ct){on(Oe(Ct,Le-1))})});else if(M.__isArray(Fe))Ae=[];else if(M.__isRegExp(Fe))Ae=new RegExp(Fe.source,$(Fe)),Fe.lastIndex&&(Ae.lastIndex=Fe.lastIndex);else if(M.__isDate(Fe))Ae=new Date(Fe.getTime());else{if(pe&&g.isBuffer(Fe))return Ae=g.allocUnsafe?g.allocUnsafe(Fe.length):new g(Fe.length),Fe.copy(Ae),Ae;I(Fe,Error)?Ae=Object.create(Fe):ue===void 0?(ft=Object.getPrototypeOf(Fe),Ae=Object.create(ft)):(Ae=Object.create(ue),ft=ue)}if(te){var Mt=J.indexOf(Fe);if(Mt!=-1)return me[Mt];J.push(Fe),me.push(Ae)}for(var Xt in I(Fe,A)&&Fe.forEach(function(fn,on){var Ct=Oe(on,Le-1),Vt=Oe(fn,Le-1);Ae.set(Ct,Vt)}),I(Fe,X)&&Fe.forEach(function(fn){var on=Oe(fn,Le-1);Ae.add(on)}),Fe){var tn;ft&&(tn=Object.getOwnPropertyDescriptor(ft,Xt)),tn&&tn.set==null||(Ae[Xt]=Oe(Fe[Xt],Le-1))}if(Object.getOwnPropertySymbols){var Ce=Object.getOwnPropertySymbols(Fe);for(Xt=0;Xt<Ce.length;Xt++){var Wt=Ce[Xt];(!(Ut=Object.getOwnPropertyDescriptor(Fe,Wt))||Ut.enumerable||se)&&(Ae[Wt]=Oe(Fe[Wt],Le-1),Ut.enumerable||Object.defineProperty(Ae,Wt,{enumerable:!1}))}}if(se){var en=Object.getOwnPropertyNames(Fe);for(Xt=0;Xt<en.length;Xt++){var Ut,Qe=en[Xt];(Ut=Object.getOwnPropertyDescriptor(Fe,Qe))&&Ut.enumerable||(Ae[Qe]=Oe(Fe[Qe],Le-1),Object.defineProperty(Ae,Qe,{enumerable:!1}))}}return Ae}(W,F)}function V(W){return Object.prototype.toString.call(W)}function $(W){var te="";return W.global&&(te+="g"),W.ignoreCase&&(te+="i"),W.multiline&&(te+="m"),te}return M.clonePrototype=function(W){if(W===null)return null;var te=function(){};return te.prototype=W,new te},M.__objToStr=V,M.__isDate=function(W){return typeof W=="object"&&V(W)==="[object Date]"},M.__isArray=function(W){return typeof W=="object"&&V(W)==="[object Array]"},M.__isRegExp=function(W){return typeof W=="object"&&V(W)==="[object RegExp]"},M.__getRegExpFlags=$,M}();typeof j=="object"&&j.exports&&(j.exports=z)}).call(this,o(92).Buffer)},function(j){j.exports={name:"vega-lite",author:'Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',version:"4.13.1",collaborators:["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],homepage:"https://vega.github.io/vega-lite/",description:"Vega-Lite is a concise high-level language for interactive visualization.",main:"build/vega-lite.js",unpkg:"build/vega-lite.min.js",jsdelivr:"build/vega-lite.min.js",module:"build/src/index",types:"build/src/index.d.ts",bin:{vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},directories:{test:"test"},scripts:{changelog:"conventional-changelog -p angular -r 2",build:"yarn build:only","build:only":"yarn tsc:src && rollup -c",postbuild:"terser build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && yarn schema && babel build/vega-lite.js --out-dir build-es5 --config-file ./babel.config.js","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"yarn tsc:site && rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"find build ! -name 'vega-lite-schema.json' -type f -delete && rm -rf site/data/* && rm -f examples/compiled/*.png && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"pushd site && bundle exec jekyll serve -I -l && popd","tsc:src":"tsc -b src/tsconfig.src.json","tsc:site":"tsc -b site/tsconfig.site.json",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",test:"jest test/ && yarn lint && yarn schema && jest examples/ && yarn test:runtime","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand test","test:runtime":"TZ=America/Los_Angeles jest test-runtime/","test:runtime:generate":"yarn build:only && rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime","watch:build":"yarn build:only && concurrently --kill-others -n Typescript,Rollup 'yarn tsc:src -w' 'rollup -c -w'","watch:site":"concurrently --kill-others -n Typescript,Rollup 'yarn tsc:site -w' 'rollup -c site/rollup.config.js -w'","watch:test":"jest --watch"},repository:{type:"git",url:"https://github.com/vega/vega-lite.git"},license:"BSD-3-Clause",bugs:{url:"https://github.com/vega/vega-lite/issues"},devDependencies:{"@babel/cli":"^7.10.1","@babel/core":"^7.10.1","@babel/preset-env":"^7.10.1","@rollup/plugin-commonjs":"12.0.0","@rollup/plugin-json":"^4.0.3","@rollup/plugin-node-resolve":"^8.0.0","@types/chai":"^4.2.11","@types/d3":"^5.7.2","@types/jest":"^25.2.3","@types/mkdirp":"^1.0.0","@types/puppeteer":"^3.0.0","@typescript-eslint/eslint-plugin":"^3.0.2","@typescript-eslint/parser":"^3.0.2",ajv:"^6.12.2",chai:"^4.2.0",cheerio:"^1.0.0-rc.3",codecov:"^3.7.0",concurrently:"^5.2.0","conventional-changelog-cli":"^2.0.34",d3:"^5.16.0",eslint:"^7.1.0","eslint-config-prettier":"^6.11.0","eslint-plugin-jest":"^23.13.2","eslint-plugin-prettier":"^3.1.3","gh-pages":"^2.2.0","highlight.js":"^10.0.3","http-server":"^0.12.3",jest:"^26.0.1","jest-puppeteer":"^4.4.0",mkdirp:"^1.0.4",prettier:"^2.0.5",puppeteer:"^3.1.0",rollup:"^2.11.0","rollup-plugin-sourcemaps":"^0.6.2","rollup-plugin-terser":"^6.1.0","svg2png-many":"^0.0.7",terser:"^4.7.0","ts-jest":"^26.0.0","ts-json-schema-generator":"^0.68.1",typescript:"~3.9.3","vega-cli":"^5.12.1","vega-datasets":"^1.30.2","vega-embed":"^6.8.0","vega-tooltip":"^0.23.0","vega-typings":"^0.17.0","yaml-front-matter":"^4.1.0"},dependencies:{"@types/clone":"~0.1.30","@types/fast-json-stable-stringify":"^2.0.0","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.1","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~2.0.0",tslib:"~2.0.0","vega-event-selector":"~2.0.3","vega-expression":"~2.6.5","vega-util":"~1.14.0",yargs:"~15.3.1"},peerDependencies:{vega:"^5.12.1"},jest:{preset:"jest-puppeteer",transform:{"^.+\\.tsx?$":"ts-jest"},testRegex:"(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",moduleFileExtensions:["ts","tsx","js","jsx","json","node"],testPathIgnorePatterns:["<rootDir>/node_modules","<rootDir>/build","<rootDir>/_site","<rootDir>/src"],coverageDirectory:"./coverage/",collectCoverage:!1}}},function(j,m,o){o.d(m,"a",function(){return W});var g=o(39),z=o(71),I=o(40),A=o(72),X=o(70),K=o(68);function M(Ne){if(0<=Ne.y&&Ne.y<100){var ot=new Date(-1,Ne.m,Ne.d,Ne.H,Ne.M,Ne.S,Ne.L);return ot.setFullYear(Ne.y),ot}return new Date(Ne.y,Ne.m,Ne.d,Ne.H,Ne.M,Ne.S,Ne.L)}function V(Ne){if(0<=Ne.y&&Ne.y<100){var ot=new Date(Date.UTC(-1,Ne.m,Ne.d,Ne.H,Ne.M,Ne.S,Ne.L));return ot.setUTCFullYear(Ne.y),ot}return new Date(Date.UTC(Ne.y,Ne.m,Ne.d,Ne.H,Ne.M,Ne.S,Ne.L))}function $(Ne,ot,xt){return{y:Ne,m:ot,d:xt,H:0,M:0,S:0,L:0}}function W(Ne){var ot=Ne.dateTime,xt=Ne.date,Ht=Ne.time,yn=Ne.periods,dr=Ne.days,_n=Ne.shortDays,In=Ne.months,Gn=Ne.shortMonths,Nt=pe(yn),Ft=Oe(yn),bn=pe(dr),Yt=Oe(dr),He=pe(_n),$n=Oe(_n),ur=pe(In),pr=Oe(In),kr=pe(Gn),ui=Oe(Gn),Ir={a:function(mi){return _n[mi.getDay()]},A:function(mi){return dr[mi.getDay()]},b:function(mi){return Gn[mi.getMonth()]},B:function(mi){return In[mi.getMonth()]},c:null,d:Hn,e:Hn,f:Ke,g:qr,G:hn,H:tr,I:pn,j:$e,L:et,m:yt,M:Dt,p:function(mi){return yn[+(mi.getHours()>=12)]},q:function(mi){return 1+~~(mi.getMonth()/3)},Q:ge,s:ke,S:Lt,u:zn,U:Cn,V:we,w:lr,W:Rr,x:null,X:null,y:Tr,Y:Gr,Z:nn,"%":xe},ji={a:function(mi){return _n[mi.getUTCDay()]},A:function(mi){return dr[mi.getUTCDay()]},b:function(mi){return Gn[mi.getUTCMonth()]},B:function(mi){return In[mi.getUTCMonth()]},c:null,d:an,e:an,f:Br,g:Ui,G:$r,H:or,I:jn,j:Fr,L:Pr,m:wi,M:Ai,p:function(mi){return yn[+(mi.getUTCHours()>=12)]},q:function(mi){return 1+~~(mi.getUTCMonth()/3)},Q:ge,s:ke,S:Jn,u:di,U:ri,V:ki,w:Ei,W:mo,x:null,X:null,y:Gi,Y:Ot,Z:$t,"%":xe},Do={a:function(mi,ai,qn){var Di=He.exec(ai.slice(qn));return Di?(mi.w=$n.get(Di[0].toLowerCase()),qn+Di[0].length):-1},A:function(mi,ai,qn){var Di=bn.exec(ai.slice(qn));return Di?(mi.w=Yt.get(Di[0].toLowerCase()),qn+Di[0].length):-1},b:function(mi,ai,qn){var Di=kr.exec(ai.slice(qn));return Di?(mi.m=ui.get(Di[0].toLowerCase()),qn+Di[0].length):-1},B:function(mi,ai,qn){var Di=ur.exec(ai.slice(qn));return Di?(mi.m=pr.get(Di[0].toLowerCase()),qn+Di[0].length):-1},c:function(mi,ai,qn){return $i(mi,ot,ai,qn)},d:Ut,e:Ut,f:En,g:tn,G:Xt,H:fn,I:fn,j:Qe,L:Vt,m:en,M:on,p:function(mi,ai,qn){var Di=Nt.exec(ai.slice(qn));return Di?(mi.p=Ft.get(Di[0].toLowerCase()),qn+Di[0].length):-1},q:Wt,Q:Rt,s:Tn,S:Ct,u:Le,U:Ae,V:ft,w:Fe,W:Mt,x:function(mi,ai,qn){return $i(mi,xt,ai,qn)},X:function(mi,ai,qn){return $i(mi,Ht,ai,qn)},y:tn,Y:Xt,Z:Ce,"%":Pt};function Bi(mi,ai){return function(qn){var Di,ko,Zr,Wo=[],Oo=-1,So=0,To=mi.length;for(qn instanceof Date||(qn=new Date(+qn));++Oo<To;)mi.charCodeAt(Oo)===37&&(Wo.push(mi.slice(So,Oo)),(ko=te[Di=mi.charAt(++Oo)])!=null?Di=mi.charAt(++Oo):ko=Di==="e"?" ":"0",(Zr=ai[Di])&&(Di=Zr(qn,ko)),Wo.push(Di),So=Oo+1);return Wo.push(mi.slice(So,Oo)),Wo.join("")}}function no(mi,ai){return function(qn){var Di,ko,Zr=$(1900,void 0,1);if($i(Zr,mi,qn+="",0)!=qn.length)return null;if("Q"in Zr)return new Date(Zr.Q);if("s"in Zr)return new Date(1e3*Zr.s+("L"in Zr?Zr.L:0));if(!ai||"Z"in Zr||(Zr.Z=0),"p"in Zr&&(Zr.H=Zr.H%12+12*Zr.p),Zr.m===void 0&&(Zr.m="q"in Zr?Zr.q:0),"V"in Zr){if(Zr.V<1||Zr.V>53)return null;"w"in Zr||(Zr.w=1),"Z"in Zr?(Di=(ko=(Di=V($(Zr.y,0,1))).getUTCDay())>4||ko===0?g.a.ceil(Di):Object(g.a)(Di),Di=z.a.offset(Di,7*(Zr.V-1)),Zr.y=Di.getUTCFullYear(),Zr.m=Di.getUTCMonth(),Zr.d=Di.getUTCDate()+(Zr.w+6)%7):(Di=(ko=(Di=M($(Zr.y,0,1))).getDay())>4||ko===0?I.a.ceil(Di):Object(I.a)(Di),Di=A.a.offset(Di,7*(Zr.V-1)),Zr.y=Di.getFullYear(),Zr.m=Di.getMonth(),Zr.d=Di.getDate()+(Zr.w+6)%7)}else("W"in Zr||"U"in Zr)&&("w"in Zr||(Zr.w="u"in Zr?Zr.u%7:"W"in Zr?1:0),ko="Z"in Zr?V($(Zr.y,0,1)).getUTCDay():M($(Zr.y,0,1)).getDay(),Zr.m=0,Zr.d="W"in Zr?(Zr.w+6)%7+7*Zr.W-(ko+5)%7:Zr.w+7*Zr.U-(ko+6)%7);return"Z"in Zr?(Zr.H+=Zr.Z/100|0,Zr.M+=Zr.Z%100,V(Zr)):M(Zr)}}function $i(mi,ai,qn,Di){for(var ko,Zr,Wo=0,Oo=ai.length,So=qn.length;Wo<Oo;){if(Di>=So)return-1;if((ko=ai.charCodeAt(Wo++))===37){if(ko=ai.charAt(Wo++),!(Zr=Do[ko in te?ai.charAt(Wo++):ko])||(Di=Zr(mi,qn,Di))<0)return-1}else if(ko!=qn.charCodeAt(Di++))return-1}return Di}return Ir.x=Bi(xt,Ir),Ir.X=Bi(Ht,Ir),Ir.c=Bi(ot,Ir),ji.x=Bi(xt,ji),ji.X=Bi(Ht,ji),ji.c=Bi(ot,ji),{format:function(mi){var ai=Bi(mi+="",Ir);return ai.toString=function(){return mi},ai},parse:function(mi){var ai=no(mi+="",!1);return ai.toString=function(){return mi},ai},utcFormat:function(mi){var ai=Bi(mi+="",ji);return ai.toString=function(){return mi},ai},utcParse:function(mi){var ai=no(mi+="",!0);return ai.toString=function(){return mi},ai}}}var te={"-":"",_:" ",0:"0"},F=/^\s*\d+/,ue=/^%/,se=/[\\^$*+?|[\]().{}]/g;function J(Ne,ot,xt){var Ht=Ne<0?"-":"",yn=(Ht?-Ne:Ne)+"",dr=yn.length;return Ht+(dr<xt?new Array(xt-dr+1).join(ot)+yn:yn)}function me(Ne){return Ne.replace(se,"\\$&")}function pe(Ne){return new RegExp("^(?:"+Ne.map(me).join("|")+")","i")}function Oe(Ne){return new Map(Ne.map((ot,xt)=>[ot.toLowerCase(),xt]))}function Fe(Ne,ot,xt){var Ht=F.exec(ot.slice(xt,xt+1));return Ht?(Ne.w=+Ht[0],xt+Ht[0].length):-1}function Le(Ne,ot,xt){var Ht=F.exec(ot.slice(xt,xt+1));return Ht?(Ne.u=+Ht[0],xt+Ht[0].length):-1}function Ae(Ne,ot,xt){var Ht=F.exec(ot.slice(xt,xt+2));return Ht?(Ne.U=+Ht[0],xt+Ht[0].length):-1}function ft(Ne,ot,xt){var Ht=F.exec(ot.slice(xt,xt+2));return Ht?(Ne.V=+Ht[0],xt+Ht[0].length):-1}function Mt(Ne,ot,xt){var Ht=F.exec(ot.slice(xt,xt+2));return Ht?(Ne.W=+Ht[0],xt+Ht[0].length):-1}function Xt(Ne,ot,xt){var Ht=F.exec(ot.slice(xt,xt+4));return Ht?(Ne.y=+Ht[0],xt+Ht[0].length):-1}function tn(Ne,ot,xt){var Ht=F.exec(ot.slice(xt,xt+2));return Ht?(Ne.y=+Ht[0]+(+Ht[0]>68?1900:2e3),xt+Ht[0].length):-1}function Ce(Ne,ot,xt){var Ht=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(ot.slice(xt,xt+6));return Ht?(Ne.Z=Ht[1]?0:-(Ht[2]+(Ht[3]||"00")),xt+Ht[0].length):-1}function Wt(Ne,ot,xt){var Ht=F.exec(ot.slice(xt,xt+1));return Ht?(Ne.q=3*Ht[0]-3,xt+Ht[0].length):-1}function en(Ne,ot,xt){var Ht=F.exec(ot.slice(xt,xt+2));return Ht?(Ne.m=Ht[0]-1,xt+Ht[0].length):-1}function Ut(Ne,ot,xt){var Ht=F.exec(ot.slice(xt,xt+2));return Ht?(Ne.d=+Ht[0],xt+Ht[0].length):-1}function Qe(Ne,ot,xt){var Ht=F.exec(ot.slice(xt,xt+3));return Ht?(Ne.m=0,Ne.d=+Ht[0],xt+Ht[0].length):-1}function fn(Ne,ot,xt){var Ht=F.exec(ot.slice(xt,xt+2));return Ht?(Ne.H=+Ht[0],xt+Ht[0].length):-1}function on(Ne,ot,xt){var Ht=F.exec(ot.slice(xt,xt+2));return Ht?(Ne.M=+Ht[0],xt+Ht[0].length):-1}function Ct(Ne,ot,xt){var Ht=F.exec(ot.slice(xt,xt+2));return Ht?(Ne.S=+Ht[0],xt+Ht[0].length):-1}function Vt(Ne,ot,xt){var Ht=F.exec(ot.slice(xt,xt+3));return Ht?(Ne.L=+Ht[0],xt+Ht[0].length):-1}function En(Ne,ot,xt){var Ht=F.exec(ot.slice(xt,xt+6));return Ht?(Ne.L=Math.floor(Ht[0]/1e3),xt+Ht[0].length):-1}function Pt(Ne,ot,xt){var Ht=ue.exec(ot.slice(xt,xt+1));return Ht?xt+Ht[0].length:-1}function Rt(Ne,ot,xt){var Ht=F.exec(ot.slice(xt));return Ht?(Ne.Q=+Ht[0],xt+Ht[0].length):-1}function Tn(Ne,ot,xt){var Ht=F.exec(ot.slice(xt));return Ht?(Ne.s=+Ht[0],xt+Ht[0].length):-1}function Hn(Ne,ot){return J(Ne.getDate(),ot,2)}function tr(Ne,ot){return J(Ne.getHours(),ot,2)}function pn(Ne,ot){return J(Ne.getHours()%12||12,ot,2)}function $e(Ne,ot){return J(1+A.a.count(Object(X.a)(Ne),Ne),ot,3)}function et(Ne,ot){return J(Ne.getMilliseconds(),ot,3)}function Ke(Ne,ot){return et(Ne,ot)+"000"}function yt(Ne,ot){return J(Ne.getMonth()+1,ot,2)}function Dt(Ne,ot){return J(Ne.getMinutes(),ot,2)}function Lt(Ne,ot){return J(Ne.getSeconds(),ot,2)}function zn(Ne){var ot=Ne.getDay();return ot===0?7:ot}function Cn(Ne,ot){return J(I.b.count(Object(X.a)(Ne)-1,Ne),ot,2)}function ar(Ne){var ot=Ne.getDay();return ot>=4||ot===0?Object(I.c)(Ne):I.c.ceil(Ne)}function we(Ne,ot){return Ne=ar(Ne),J(I.c.count(Object(X.a)(Ne),Ne)+(Object(X.a)(Ne).getDay()===4),ot,2)}function lr(Ne){return Ne.getDay()}function Rr(Ne,ot){return J(I.a.count(Object(X.a)(Ne)-1,Ne),ot,2)}function Tr(Ne,ot){return J(Ne.getFullYear()%100,ot,2)}function qr(Ne,ot){return J((Ne=ar(Ne)).getFullYear()%100,ot,2)}function Gr(Ne,ot){return J(Ne.getFullYear()%1e4,ot,4)}function hn(Ne,ot){var xt=Ne.getDay();return J((Ne=xt>=4||xt===0?Object(I.c)(Ne):I.c.ceil(Ne)).getFullYear()%1e4,ot,4)}function nn(Ne){var ot=Ne.getTimezoneOffset();return(ot>0?"-":(ot*=-1,"+"))+J(ot/60|0,"0",2)+J(ot%60,"0",2)}function an(Ne,ot){return J(Ne.getUTCDate(),ot,2)}function or(Ne,ot){return J(Ne.getUTCHours(),ot,2)}function jn(Ne,ot){return J(Ne.getUTCHours()%12||12,ot,2)}function Fr(Ne,ot){return J(1+z.a.count(Object(K.a)(Ne),Ne),ot,3)}function Pr(Ne,ot){return J(Ne.getUTCMilliseconds(),ot,3)}function Br(Ne,ot){return Pr(Ne,ot)+"000"}function wi(Ne,ot){return J(Ne.getUTCMonth()+1,ot,2)}function Ai(Ne,ot){return J(Ne.getUTCMinutes(),ot,2)}function Jn(Ne,ot){return J(Ne.getUTCSeconds(),ot,2)}function di(Ne){var ot=Ne.getUTCDay();return ot===0?7:ot}function ri(Ne,ot){return J(g.b.count(Object(K.a)(Ne)-1,Ne),ot,2)}function Dr(Ne){var ot=Ne.getUTCDay();return ot>=4||ot===0?Object(g.c)(Ne):g.c.ceil(Ne)}function ki(Ne,ot){return Ne=Dr(Ne),J(g.c.count(Object(K.a)(Ne),Ne)+(Object(K.a)(Ne).getUTCDay()===4),ot,2)}function Ei(Ne){return Ne.getUTCDay()}function mo(Ne,ot){return J(g.a.count(Object(K.a)(Ne)-1,Ne),ot,2)}function Gi(Ne,ot){return J(Ne.getUTCFullYear()%100,ot,2)}function Ui(Ne,ot){return J((Ne=Dr(Ne)).getUTCFullYear()%100,ot,2)}function Ot(Ne,ot){return J(Ne.getUTCFullYear()%1e4,ot,4)}function $r(Ne,ot){var xt=Ne.getUTCDay();return J((Ne=xt>=4||xt===0?Object(g.c)(Ne):g.c.ceil(Ne)).getUTCFullYear()%1e4,ot,4)}function $t(){return"+0000"}function xe(){return"%"}function ge(Ne){return+Ne}function ke(Ne){return Math.floor(+Ne/1e3)}},function(j,m,o){o.r(m);var g="http://www.w3.org/1999/xhtml",z={svg:"http://www.w3.org/2000/svg",xhtml:g,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},I=function(hn){var nn=hn+="",an=nn.indexOf(":");return an>=0&&(nn=hn.slice(0,an))!=="xmlns"&&(hn=hn.slice(an+1)),z.hasOwnProperty(nn)?{space:z[nn],local:hn}:hn},A=function(hn){var nn=I(hn);return(nn.local?function(an){return function(){return this.ownerDocument.createElementNS(an.space,an.local)}}:function(an){return function(){var or=this.ownerDocument,jn=this.namespaceURI;return jn===g&&or.documentElement.namespaceURI===g?or.createElement(an):or.createElementNS(jn,an)}})(nn)};function X(){}var K=function(hn){return hn==null?X:function(){return this.querySelector(hn)}};function M(){return[]}var V=function(hn){return hn==null?M:function(){return this.querySelectorAll(hn)}},$=function(hn){return function(){return this.matches(hn)}};if(typeof document!="undefined"){var W=document.documentElement;if(!W.matches){var te=W.webkitMatchesSelector||W.msMatchesSelector||W.mozMatchesSelector||W.oMatchesSelector;$=function(hn){return function(){return te.call(this,hn)}}}}var F=$,ue=function(hn){return new Array(hn.length)};function se(hn,nn){this.ownerDocument=hn.ownerDocument,this.namespaceURI=hn.namespaceURI,this._next=null,this._parent=hn,this.__data__=nn}se.prototype={constructor:se,appendChild:function(hn){return this._parent.insertBefore(hn,this._next)},insertBefore:function(hn,nn){return this._parent.insertBefore(hn,nn)},querySelector:function(hn){return this._parent.querySelector(hn)},querySelectorAll:function(hn){return this._parent.querySelectorAll(hn)}};var J="$";function me(hn,nn,an,or,jn,Fr){for(var Pr,Br=0,wi=nn.length,Ai=Fr.length;Br<Ai;++Br)(Pr=nn[Br])?(Pr.__data__=Fr[Br],or[Br]=Pr):an[Br]=new se(hn,Fr[Br]);for(;Br<wi;++Br)(Pr=nn[Br])&&(jn[Br]=Pr)}function pe(hn,nn,an,or,jn,Fr,Pr){var Br,wi,Ai,Jn={},di=nn.length,ri=Fr.length,Dr=new Array(di);for(Br=0;Br<di;++Br)(wi=nn[Br])&&(Dr[Br]=Ai=J+Pr.call(wi,wi.__data__,Br,nn),Ai in Jn?jn[Br]=wi:Jn[Ai]=wi);for(Br=0;Br<ri;++Br)(wi=Jn[Ai=J+Pr.call(hn,Fr[Br],Br,Fr)])?(or[Br]=wi,wi.__data__=Fr[Br],Jn[Ai]=null):an[Br]=new se(hn,Fr[Br]);for(Br=0;Br<di;++Br)(wi=nn[Br])&&Jn[Dr[Br]]===wi&&(jn[Br]=wi)}function Oe(hn,nn){return hn<nn?-1:hn>nn?1:hn>=nn?0:NaN}var Fe=function(hn){return hn.ownerDocument&&hn.ownerDocument.defaultView||hn.document&&hn||hn.defaultView};function Le(hn,nn){return hn.style.getPropertyValue(nn)||Fe(hn).getComputedStyle(hn,null).getPropertyValue(nn)}function Ae(hn){return hn.trim().split(/^|\s+/)}function ft(hn){return hn.classList||new Mt(hn)}function Mt(hn){this._node=hn,this._names=Ae(hn.getAttribute("class")||"")}function Xt(hn,nn){for(var an=ft(hn),or=-1,jn=nn.length;++or<jn;)an.add(nn[or])}function tn(hn,nn){for(var an=ft(hn),or=-1,jn=nn.length;++or<jn;)an.remove(nn[or])}Mt.prototype={add:function(hn){this._names.indexOf(hn)<0&&(this._names.push(hn),this._node.setAttribute("class",this._names.join(" ")))},remove:function(hn){var nn=this._names.indexOf(hn);nn>=0&&(this._names.splice(nn,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(hn){return this._names.indexOf(hn)>=0}};function Ce(){this.textContent=""}function Wt(){this.innerHTML=""}function en(){this.nextSibling&&this.parentNode.appendChild(this)}function Ut(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Qe(){return null}function fn(){var hn=this.parentNode;hn&&hn.removeChild(this)}function on(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function Ct(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}var Vt={},En=null;typeof document!="undefined"&&("onmouseenter"in document.documentElement||(Vt={mouseenter:"mouseover",mouseleave:"mouseout"}));function Pt(hn,nn,an){return hn=Rt(hn,nn,an),function(or){var jn=or.relatedTarget;jn&&(jn===this||8&jn.compareDocumentPosition(this))||hn.call(this,or)}}function Rt(hn,nn,an){return function(or){var jn=En;En=or;try{hn.call(this,this.__data__,nn,an)}finally{En=jn}}}function Tn(hn){return function(){var nn=this.__on;if(nn){for(var an,or=0,jn=-1,Fr=nn.length;or<Fr;++or)an=nn[or],hn.type&&an.type!==hn.type||an.name!==hn.name?nn[++jn]=an:this.removeEventListener(an.type,an.listener,an.capture);++jn?nn.length=jn:delete this.__on}}}function Hn(hn,nn,an){var or=Vt.hasOwnProperty(hn.type)?Pt:Rt;return function(jn,Fr,Pr){var Br,wi=this.__on,Ai=or(nn,Fr,Pr);if(wi){for(var Jn=0,di=wi.length;Jn<di;++Jn)if((Br=wi[Jn]).type===hn.type&&Br.name===hn.name)return this.removeEventListener(Br.type,Br.listener,Br.capture),this.addEventListener(Br.type,Br.listener=Ai,Br.capture=an),void(Br.value=nn)}this.addEventListener(hn.type,Ai,an),Br={type:hn.type,name:hn.name,value:nn,listener:Ai,capture:an},wi?wi.push(Br):this.__on=[Br]}}function tr(hn,nn,an,or){var jn=En;hn.sourceEvent=En,En=hn;try{return nn.apply(an,or)}finally{En=jn}}function pn(hn,nn,an){var or=Fe(hn),jn=or.CustomEvent;typeof jn=="function"?jn=new jn(nn,an):(jn=or.document.createEvent("Event"),an?(jn.initEvent(nn,an.bubbles,an.cancelable),jn.detail=an.detail):jn.initEvent(nn,!1,!1)),hn.dispatchEvent(jn)}var $e=[null];function et(hn,nn){this._groups=hn,this._parents=nn}function Ke(){return new et([[document.documentElement]],$e)}et.prototype=Ke.prototype={constructor:et,select:function(hn){typeof hn!="function"&&(hn=K(hn));for(var nn=this._groups,an=nn.length,or=new Array(an),jn=0;jn<an;++jn)for(var Fr,Pr,Br=nn[jn],wi=Br.length,Ai=or[jn]=new Array(wi),Jn=0;Jn<wi;++Jn)(Fr=Br[Jn])&&(Pr=hn.call(Fr,Fr.__data__,Jn,Br))&&("__data__"in Fr&&(Pr.__data__=Fr.__data__),Ai[Jn]=Pr);return new et(or,this._parents)},selectAll:function(hn){typeof hn!="function"&&(hn=V(hn));for(var nn=this._groups,an=nn.length,or=[],jn=[],Fr=0;Fr<an;++Fr)for(var Pr,Br=nn[Fr],wi=Br.length,Ai=0;Ai<wi;++Ai)(Pr=Br[Ai])&&(or.push(hn.call(Pr,Pr.__data__,Ai,Br)),jn.push(Pr));return new et(or,jn)},filter:function(hn){typeof hn!="function"&&(hn=F(hn));for(var nn=this._groups,an=nn.length,or=new Array(an),jn=0;jn<an;++jn)for(var Fr,Pr=nn[jn],Br=Pr.length,wi=or[jn]=[],Ai=0;Ai<Br;++Ai)(Fr=Pr[Ai])&&hn.call(Fr,Fr.__data__,Ai,Pr)&&wi.push(Fr);return new et(or,this._parents)},data:function(hn,nn){if(!hn)return Dr=new Array(this.size()),Ai=-1,this.each(function($t){Dr[++Ai]=$t}),Dr;var an=nn?pe:me,or=this._parents,jn=this._groups;typeof hn!="function"&&(hn=function($t){return function(){return $t}}(hn));for(var Fr=jn.length,Pr=new Array(Fr),Br=new Array(Fr),wi=new Array(Fr),Ai=0;Ai<Fr;++Ai){var Jn=or[Ai],di=jn[Ai],ri=di.length,Dr=hn.call(Jn,Jn&&Jn.__data__,Ai,or),ki=Dr.length,Ei=Br[Ai]=new Array(ki),mo=Pr[Ai]=new Array(ki);an(Jn,di,Ei,mo,wi[Ai]=new Array(ri),Dr,nn);for(var Gi,Ui,Ot=0,$r=0;Ot<ki;++Ot)if(Gi=Ei[Ot]){for(Ot>=$r&&($r=Ot+1);!(Ui=mo[$r])&&++$r<ki;);Gi._next=Ui||null}}return(Pr=new et(Pr,or))._enter=Br,Pr._exit=wi,Pr},enter:function(){return new et(this._enter||this._groups.map(ue),this._parents)},exit:function(){return new et(this._exit||this._groups.map(ue),this._parents)},merge:function(hn){for(var nn=this._groups,an=hn._groups,or=nn.length,jn=an.length,Fr=Math.min(or,jn),Pr=new Array(or),Br=0;Br<Fr;++Br)for(var wi,Ai=nn[Br],Jn=an[Br],di=Ai.length,ri=Pr[Br]=new Array(di),Dr=0;Dr<di;++Dr)(wi=Ai[Dr]||Jn[Dr])&&(ri[Dr]=wi);for(;Br<or;++Br)Pr[Br]=nn[Br];return new et(Pr,this._parents)},order:function(){for(var hn=this._groups,nn=-1,an=hn.length;++nn<an;)for(var or,jn=hn[nn],Fr=jn.length-1,Pr=jn[Fr];--Fr>=0;)(or=jn[Fr])&&(Pr&&Pr!==or.nextSibling&&Pr.parentNode.insertBefore(or,Pr),Pr=or);return this},sort:function(hn){function nn(di,ri){return di&&ri?hn(di.__data__,ri.__data__):!di-!ri}hn||(hn=Oe);for(var an=this._groups,or=an.length,jn=new Array(or),Fr=0;Fr<or;++Fr){for(var Pr,Br=an[Fr],wi=Br.length,Ai=jn[Fr]=new Array(wi),Jn=0;Jn<wi;++Jn)(Pr=Br[Jn])&&(Ai[Jn]=Pr);Ai.sort(nn)}return new et(jn,this._parents).order()},call:function(){var hn=arguments[0];return arguments[0]=this,hn.apply(null,arguments),this},nodes:function(){var hn=new Array(this.size()),nn=-1;return this.each(function(){hn[++nn]=this}),hn},node:function(){for(var hn=this._groups,nn=0,an=hn.length;nn<an;++nn)for(var or=hn[nn],jn=0,Fr=or.length;jn<Fr;++jn){var Pr=or[jn];if(Pr)return Pr}return null},size:function(){var hn=0;return this.each(function(){++hn}),hn},empty:function(){return!this.node()},each:function(hn){for(var nn=this._groups,an=0,or=nn.length;an<or;++an)for(var jn,Fr=nn[an],Pr=0,Br=Fr.length;Pr<Br;++Pr)(jn=Fr[Pr])&&hn.call(jn,jn.__data__,Pr,Fr);return this},attr:function(hn,nn){var an=I(hn);if(arguments.length<2){var or=this.node();return an.local?or.getAttributeNS(an.space,an.local):or.getAttribute(an)}return this.each((nn==null?an.local?function(jn){return function(){this.removeAttributeNS(jn.space,jn.local)}}:function(jn){return function(){this.removeAttribute(jn)}}:typeof nn=="function"?an.local?function(jn,Fr){return function(){var Pr=Fr.apply(this,arguments);Pr==null?this.removeAttributeNS(jn.space,jn.local):this.setAttributeNS(jn.space,jn.local,Pr)}}:function(jn,Fr){return function(){var Pr=Fr.apply(this,arguments);Pr==null?this.removeAttribute(jn):this.setAttribute(jn,Pr)}}:an.local?function(jn,Fr){return function(){this.setAttributeNS(jn.space,jn.local,Fr)}}:function(jn,Fr){return function(){this.setAttribute(jn,Fr)}})(an,nn))},style:function(hn,nn,an){return arguments.length>1?this.each((nn==null?function(or){return function(){this.style.removeProperty(or)}}:typeof nn=="function"?function(or,jn,Fr){return function(){var Pr=jn.apply(this,arguments);Pr==null?this.style.removeProperty(or):this.style.setProperty(or,Pr,Fr)}}:function(or,jn,Fr){return function(){this.style.setProperty(or,jn,Fr)}})(hn,nn,an==null?"":an)):Le(this.node(),hn)},property:function(hn,nn){return arguments.length>1?this.each((nn==null?function(an){return function(){delete this[an]}}:typeof nn=="function"?function(an,or){return function(){var jn=or.apply(this,arguments);jn==null?delete this[an]:this[an]=jn}}:function(an,or){return function(){this[an]=or}})(hn,nn)):this.node()[hn]},classed:function(hn,nn){var an=Ae(hn+"");if(arguments.length<2){for(var or=ft(this.node()),jn=-1,Fr=an.length;++jn<Fr;)if(!or.contains(an[jn]))return!1;return!0}return this.each((typeof nn=="function"?function(Pr,Br){return function(){(Br.apply(this,arguments)?Xt:tn)(this,Pr)}}:nn?function(Pr){return function(){Xt(this,Pr)}}:function(Pr){return function(){tn(this,Pr)}})(an,nn))},text:function(hn){return arguments.length?this.each(hn==null?Ce:(typeof hn=="function"?function(nn){return function(){var an=nn.apply(this,arguments);this.textContent=an==null?"":an}}:function(nn){return function(){this.textContent=nn}})(hn)):this.node().textContent},html:function(hn){return arguments.length?this.each(hn==null?Wt:(typeof hn=="function"?function(nn){return function(){var an=nn.apply(this,arguments);this.innerHTML=an==null?"":an}}:function(nn){return function(){this.innerHTML=nn}})(hn)):this.node().innerHTML},raise:function(){return this.each(en)},lower:function(){return this.each(Ut)},append:function(hn){var nn=typeof hn=="function"?hn:A(hn);return this.select(function(){return this.appendChild(nn.apply(this,arguments))})},insert:function(hn,nn){var an=typeof hn=="function"?hn:A(hn),or=nn==null?Qe:typeof nn=="function"?nn:K(nn);return this.select(function(){return this.insertBefore(an.apply(this,arguments),or.apply(this,arguments)||null)})},remove:function(){return this.each(fn)},clone:function(hn){return this.select(hn?Ct:on)},datum:function(hn){return arguments.length?this.property("__data__",hn):this.node().__data__},on:function(hn,nn,an){var or,jn,Fr=function(di){return di.trim().split(/^|\s+/).map(function(ri){var Dr="",ki=ri.indexOf(".");return ki>=0&&(Dr=ri.slice(ki+1),ri=ri.slice(0,ki)),{type:ri,name:Dr}})}(hn+""),Pr=Fr.length;if(!(arguments.length<2)){for(Br=nn?Hn:Tn,an==null&&(an=!1),or=0;or<Pr;++or)this.each(Br(Fr[or],nn,an));return this}var Br=this.node().__on;if(Br){for(var wi,Ai=0,Jn=Br.length;Ai<Jn;++Ai)for(or=0,wi=Br[Ai];or<Pr;++or)if((jn=Fr[or]).type===wi.type&&jn.name===wi.name)return wi.value}},dispatch:function(hn,nn){return this.each((typeof nn=="function"?function(an,or){return function(){return pn(this,an,or.apply(this,arguments))}}:function(an,or){return function(){return pn(this,an,or)}})(hn,nn))}};var yt=Ke,Dt=function(hn){return typeof hn=="string"?new et([[document.querySelector(hn)]],[document.documentElement]):new et([[hn]],$e)},Lt=function(hn){return Dt(A(hn).call(document.documentElement))},zn=0;function Cn(){return new ar}function ar(){this._="@"+(++zn).toString(36)}ar.prototype=Cn.prototype={constructor:ar,get:function(hn){for(var nn=this._;!(nn in hn);)if(!(hn=hn.parentNode))return;return hn[nn]},set:function(hn,nn){return hn[this._]=nn},remove:function(hn){return this._ in hn&&delete hn[this._]},toString:function(){return this._}};var we=function(){for(var hn,nn=En;hn=nn.sourceEvent;)nn=hn;return nn},lr=function(hn,nn){var an=hn.ownerSVGElement||hn;if(an.createSVGPoint){var or=an.createSVGPoint();return or.x=nn.clientX,or.y=nn.clientY,[(or=or.matrixTransform(hn.getScreenCTM().inverse())).x,or.y]}var jn=hn.getBoundingClientRect();return[nn.clientX-jn.left-hn.clientLeft,nn.clientY-jn.top-hn.clientTop]},Rr=function(hn){var nn=we();return nn.changedTouches&&(nn=nn.changedTouches[0]),lr(hn,nn)},Tr=function(hn){return typeof hn=="string"?new et([document.querySelectorAll(hn)],[document.documentElement]):new et([hn==null?[]:hn],$e)},qr=function(hn,nn,an){arguments.length<3&&(an=nn,nn=we().changedTouches);for(var or,jn=0,Fr=nn?nn.length:0;jn<Fr;++jn)if((or=nn[jn]).identifier===an)return lr(hn,or);return null},Gr=function(hn,nn){nn==null&&(nn=we().touches);for(var an=0,or=nn?nn.length:0,jn=new Array(or);an<or;++an)jn[an]=lr(hn,nn[an]);return jn};o.d(m,"create",function(){return Lt}),o.d(m,"creator",function(){return A}),o.d(m,"local",function(){return Cn}),o.d(m,"matcher",function(){return F}),o.d(m,"mouse",function(){return Rr}),o.d(m,"namespace",function(){return I}),o.d(m,"namespaces",function(){return z}),o.d(m,"clientPoint",function(){return lr}),o.d(m,"select",function(){return Dt}),o.d(m,"selectAll",function(){return Tr}),o.d(m,"selection",function(){return yt}),o.d(m,"selector",function(){return K}),o.d(m,"selectorAll",function(){return V}),o.d(m,"style",function(){return Le}),o.d(m,"touch",function(){return qr}),o.d(m,"touches",function(){return Gr}),o.d(m,"window",function(){return Fe}),o.d(m,"event",function(){return En}),o.d(m,"customEvent",function(){return tr})},function(j,m,o){o.r(m);var g={};o.d(g,"load",function(){return Pt});var z={};o.d(z,"Darknet",function(){return Ke}),o.d(z,"load",function(){return yt});var I={};o.d(I,"Doodlenet",function(){return lr}),o.d(I,"load",function(){return Rr});var A={};o.d(A,"array3DToImage",function(){return hn}),o.d(A,"processVideo",function(){return Gr}),o.d(A,"cropImage",function(){return nn}),o.d(A,"imgToTensor",function(){return or}),o.d(A,"isInstanceOfSupportedElement",function(){return jn}),o.d(A,"flipImage",function(){return an}),o.d(A,"imgToPixelArray",function(){return Fr});var X={};o.d(X,"SpeechCommands",function(){return kr}),o.d(X,"load",function(){return ui});var K={};o.d(K,"isTensor",function(){return Fo}),o.d(K,"isTensor1D",function(){return cf}),o.d(K,"isTensor2D",function(){return jl}),o.d(K,"isTensor3D",function(){return wr}),o.d(K,"isTensor4D",function(){return fu}),o.d(K,"isFloat",function(){return Ds}),o.d(K,"isEven",function(){return Ro}),o.d(K,"round",function(){return yl}),o.d(K,"isDimensions",function(){return nl}),o.d(K,"computeReshapedDimensions",function(){return wu}),o.d(K,"getCenterPoint",function(){return Bl}),o.d(K,"range",function(){return Kt}),o.d(K,"isValidNumber",function(){return fc}),o.d(K,"isValidProbablitiy",function(){return Mu});var M={};o.d(M,"drawContour",function(){return Ju}),o.d(M,"drawDetections",function(){return br}),o.d(M,"drawFaceExpressions",function(){return Dc}),o.d(M,"DrawBoxOptions",function(){return rr}),o.d(M,"DrawBox",function(){return Yn}),o.d(M,"DrawFaceLandmarksOptions",function(){return hu}),o.d(M,"DrawFaceLandmarks",function(){return Ps}),o.d(M,"drawFaceLandmarks",function(){return rl}),o.d(M,"AnchorPosition",function(){return qt}),o.d(M,"DrawTextFieldOptions",function(){return Pn}),o.d(M,"DrawTextField",function(){return Vn});var V={};o.d(V,"draw",function(){return M}),o.d(V,"utils",function(){return K}),o.d(V,"tf",function(){return ln}),o.d(V,"env",function(){return Jt}),o.d(V,"FaceLandmarkNet",function(){return sa}),o.d(V,"createFaceRecognitionNet",function(){return op}),o.d(V,"createMtcnn",function(){return dp}),o.d(V,"sigmoid",function(){return hc}),o.d(V,"inverseSigmoid",function(){return tp}),o.d(V,"createSsdMobilenetv1",function(){return Ig}),o.d(V,"createFaceDetectionNet",function(){return Fg}),o.d(V,"FaceDetectionNet",function(){return yv}),o.d(V,"createTinyFaceDetector",function(){return am}),o.d(V,"TinyYolov2",function(){return Dd}),o.d(V,"createTinyYolov2",function(){return H0}),o.d(V,"euclideanDistance",function(){return Ym}),o.d(V,"NeuralNetwork",function(){return co}),o.d(V,"resizeResults",function(){return gf}),o.d(V,"AgeGenderNet",function(){return Bm}),o.d(V,"Gender",function(){return uh}),o.d(V,"BoundingBox",function(){return js}),o.d(V,"Box",function(){return uo}),o.d(V,"Dimensions",function(){return ru}),o.d(V,"FaceDetection",function(){return ts}),o.d(V,"FaceLandmarks",function(){return Sc}),o.d(V,"FaceLandmarks5",function(){return wl}),o.d(V,"FaceLandmarks68",function(){return kl}),o.d(V,"FaceMatch",function(){return Ys}),o.d(V,"LabeledBox",function(){return np}),o.d(V,"LabeledFaceDescriptors",function(){return _d}),o.d(V,"ObjectDetection",function(){return ju}),o.d(V,"Point",function(){return po}),o.d(V,"PredictedBox",function(){return Ed}),o.d(V,"Rect",function(){return oh}),o.d(V,"awaitMediaLoaded",function(){return Lr}),o.d(V,"bufferToImage",function(){return Hr}),o.d(V,"createCanvas",function(){return zr}),o.d(V,"createCanvasFromMedia",function(){return li}),o.d(V,"extractFaces",function(){return Vo}),o.d(V,"extractFaceTensors",function(){return qo}),o.d(V,"fetchImage",function(){return Ao}),o.d(V,"fetchJson",function(){return Ho}),o.d(V,"fetchNetWeights",function(){return zo}),o.d(V,"fetchOrThrow",function(){return Ia}),o.d(V,"getContext2dOrThrow",function(){return Nn}),o.d(V,"getMediaDimensions",function(){return yi}),o.d(V,"imageTensorToCanvas",function(){return pi}),o.d(V,"imageToSquare",function(){return qi}),o.d(V,"isMediaElement",function(){return Pi}),o.d(V,"isMediaLoaded",function(){return xr}),o.d(V,"loadWeightMap",function(){return Xa}),o.d(V,"matchDimensions",function(){return Zi}),o.d(V,"NetInput",function(){return bi}),o.d(V,"resolveInput",function(){return pt}),o.d(V,"toNetInput",function(){return Oi}),o.d(V,"FaceExpressionNet",function(){return Zo}),o.d(V,"FACE_EXPRESSION_LABELS",function(){return Qu}),o.d(V,"FaceExpressions",function(){return Pu}),o.d(V,"FaceLandmark68Net",function(){return Kp}),o.d(V,"FaceLandmark68TinyNet",function(){return Xp}),o.d(V,"FaceRecognitionNet",function(){return Jp}),o.d(V,"extendWithFaceDescriptor",function(){return Qp}),o.d(V,"isWithFaceDetection",function(){return qh}),o.d(V,"extendWithFaceDetection",function(){return Cd}),o.d(V,"isWithFaceExpressions",function(){return Lu}),o.d(V,"extendWithFaceExpressions",function(){return Qs}),o.d(V,"isWithFaceLandmarks",function(){return Ll}),o.d(V,"extendWithFaceLandmarks",function(){return Va}),o.d(V,"isWithAge",function(){return l0}),o.d(V,"extendWithAge",function(){return Lm}),o.d(V,"isWithGender",function(){return ec}),o.d(V,"extendWithGender",function(){return il}),o.d(V,"allFacesSsdMobilenetv1",function(){return fp}),o.d(V,"allFacesTinyYolov2",function(){return Rd}),o.d(V,"allFacesMtcnn",function(){return td}),o.d(V,"allFaces",function(){return om}),o.d(V,"ComposableTask",function(){return Ff}),o.d(V,"ComputeFaceDescriptorsTaskBase",function(){return nm}),o.d(V,"ComputeAllFaceDescriptorsTask",function(){return zc}),o.d(V,"ComputeSingleFaceDescriptorTask",function(){return Qh}),o.d(V,"detectSingleFace",function(){return im}),o.d(V,"detectAllFaces",function(){return ed}),o.d(V,"DetectFacesTaskBase",function(){return Km}),o.d(V,"DetectAllFacesTask",function(){return Xm}),o.d(V,"DetectSingleFaceTask",function(){return zg}),o.d(V,"DetectFaceLandmarksTaskBase",function(){return Zh}),o.d(V,"DetectAllFaceLandmarksTask",function(){return rm}),o.d(V,"DetectSingleFaceLandmarksTask",function(){return $m}),o.d(V,"FaceMatcher",function(){return hp}),o.d(V,"nets",function(){return Ko}),o.d(V,"ssdMobilenetv1",function(){return hh}),o.d(V,"tinyFaceDetector",function(){return up}),o.d(V,"tinyYolov2",function(){return $0}),o.d(V,"mtcnn",function(){return dh}),o.d(V,"detectFaceLandmarks",function(){return cp}),o.d(V,"detectFaceLandmarksTiny",function(){return Mf}),o.d(V,"computeFaceDescriptor",function(){return hf}),o.d(V,"recognizeFaceExpressions",function(){return Yh}),o.d(V,"predictAgeAndGender",function(){return df}),o.d(V,"loadSsdMobilenetv1Model",function(){return to}),o.d(V,"loadTinyFaceDetectorModel",function(){return pf}),o.d(V,"loadMtcnnModel",function(){return jf}),o.d(V,"loadTinyYolov2Model",function(){return zu}),o.d(V,"loadFaceLandmarkModel",function(){return lp}),o.d(V,"loadFaceLandmarkTinyModel",function(){return ph}),o.d(V,"loadFaceRecognitionModel",function(){return Bf}),o.d(V,"loadFaceExpressionModel",function(){return Ts}),o.d(V,"loadAgeGenderModel",function(){return Id}),o.d(V,"loadFaceDetectionModel",function(){return Gm}),o.d(V,"locateFaces",function(){return Jh}),o.d(V,"detectLandmarks",function(){return Pf}),o.d(V,"Mtcnn",function(){return Nd}),o.d(V,"MtcnnOptions",function(){return zl}),o.d(V,"iou",function(){return iu}),o.d(V,"minBbox",function(){return bl}),o.d(V,"nonMaxSuppression",function(){return Pl}),o.d(V,"normalize",function(){return lf}),o.d(V,"padToSquare",function(){return xl}),o.d(V,"shuffleArray",function(){return ih}),o.d(V,"SsdMobilenetv1",function(){return Wl}),o.d(V,"SsdMobilenetv1Options",function(){return If}),o.d(V,"TinyFaceDetector",function(){return Xh}),o.d(V,"TinyFaceDetectorOptions",function(){return Wm}),o.d(V,"TinyYolov2SizeType",function(){return em}),o.d(V,"TinyYolov2Options",function(){return ch}),o.d(V,"validateConfig",function(){return jg});var $={};o.d($,"getRobin",function(){return gm}),o.d($,"getImageData",function(){return J0});var W=o(18),te=o.n(W),F=o(2),ue=o(67),se=o(6),J=o.n(se),me=o(10),pe=o.n(me),Oe=o(9),Fe=o.n(Oe),Le=o(4),Ae=o.n(Le);function ft(P,E){return E?new Promise(function(_,k){P.then(function(D){E(void 0,D),_(D)}).catch(function(D){E(D),k(D)})}):P}var Mt=function(){function P(E,_,k,D){pe()(this,P),this.model=E,this.audioContext=_,this.stream=k,this.frequency=null,this.ready=ft(this.loadModel(E),D)}return Fe()(P,[{key:"loadModel",value:function(){var E=J()(Ae.a.mark(function _(k){return Ae.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.next=2,F.loadLayersModel("".concat(k,"/model.json"));case 2:if(this.model=D.sent,!this.audioContext){D.next=8;break}return D.next=6,this.processStream();case 6:D.next=9;break;case 8:throw new Error("Could not access microphone - getUserMedia not available");case 9:return D.abrupt("return",this);case 10:case"end":return D.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"processStream",value:function(){var E=J()(Ae.a.mark(function _(){var k,D,q,ee,de;return Ae.a.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:return _e.next=2,F.nextFrame();case 2:for(k=this.audioContext.createMediaStreamSource(this.stream),D=this.audioContext.sampleRate/16e3*1024,q=4;q<D;)q*=2;(ee=this.audioContext.createScriptProcessor(q,1,1)).onaudioprocess=this.processMicrophoneBuffer.bind(this),(de=this.audioContext.createGain()).gain.setValueAtTime(0,this.audioContext.currentTime),k.connect(ee),ee.connect(de),de.connect(this.audioContext.destination),this.audioContext.state!=="running"&&console.warn("User gesture needed to start AudioContext, please click");case 14:case"end":return _e.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()},{key:"processMicrophoneBuffer",value:function(){var E=J()(Ae.a.mark(function _(k){var D=this;return Ae.a.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.next=2,F.nextFrame();case 2:this.results={},P.resample(k.inputBuffer,function(ee){F.tidy(function(){var de=F.add(F.linspace(0,7180,360),F.tensor(1997.379408437619));D.running=!0;var _e=F.tensor(ee.slice(0,1024)),Re=F.sub(_e,F.mean(_e)),De=F.tensor(F.norm(Re).dataSync()/Math.sqrt(1024)),tt=F.div(Re,De).reshape([1,1024]),st=D.model.predict([tt]).reshape([360]),It=st.max().dataSync()[0],Bt=st.argMax().dataSync()[0];D.results.confidence=It.toFixed(3);var mn=Math.max(0,Bt-4),xn=Math.min(360,Bt+5),Fn=st.slice([mn],[xn-mn]),Rn=de.slice([mn],[xn-mn]),Ln=F.mul(Fn,Rn).dataSync().reduce(function(Sr,Ur){return Sr+Ur},0)/Fn.dataSync().reduce(function(Sr,Ur){return Sr+Ur},0),Zn=10*Math.pow(2,Ln/1200),An=It>.5?Zn:null;D.frequency=An})});case 4:case"end":return q.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"getPitch",value:function(){var E=J()(Ae.a.mark(function _(k){var D;return Ae.a.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.next=2,this.ready;case 2:return q.next=4,F.nextFrame();case 4:return D=this.frequency,k&&k(void 0,D),q.abrupt("return",D);case 7:case"end":return q.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()}],[{key:"resample",value:function(E,_){for(var k=E.sampleRate%16e3!=0,D=E.sampleRate/16e3,q=E.getChannelData(0),ee=new Float32Array(1024),de=0;de<1024;de+=1)if(k){var _e=Math.floor(de*D),Re=_e+1,De=de*D-_e;ee[de]=(1-De)*q[_e]+De*q[Re]}else ee[de]=q[de*D];_(ee)}}]),P}(),Xt=function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"./",E=arguments.length>1?arguments[1]:void 0,_=arguments.length>2?arguments[2]:void 0,k=arguments.length>3?arguments[3]:void 0;return new Mt(P,E,_,k)},tn=o(7),Ce=o.n(tn),Wt=o(17),en=o.n(Wt),Ut=o(20),Qe=o(0);/**
    * @license
    * Copyright 2019 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function fn(P,E,_,k){return new(_||(_=Promise))(function(D,q){function ee(Re){try{_e(k.next(Re))}catch(De){q(De)}}function de(Re){try{_e(k.throw(Re))}catch(De){q(De)}}function _e(Re){Re.done?D(Re.value):new _(function(De){De(Re.value)}).then(ee,de)}_e((k=k.apply(P,E||[])).next())})}function on(P,E){var _,k,D,q,ee={label:0,sent:function(){if(1&D[0])throw D[1];return D[1]},trys:[],ops:[]};return q={next:de(0),throw:de(1),return:de(2)},typeof Symbol=="function"&&(q[Symbol.iterator]=function(){return this}),q;function de(_e){return function(Re){return function(De){if(_)throw new TypeError("Generator is already executing.");for(;ee;)try{if(_=1,k&&(D=2&De[0]?k.return:De[0]?k.throw||((D=k.return)&&D.call(k),0):k.next)&&!(D=D.call(k,De[1])).done)return D;switch(k=0,D&&(De=[2&De[0],D.value]),De[0]){case 0:case 1:D=De;break;case 4:return ee.label++,{value:De[1],done:!1};case 5:ee.label++,k=De[1],De=[0];continue;case 7:De=ee.ops.pop(),ee.trys.pop();continue;default:if(!(D=(D=ee.trys).length>0&&D[D.length-1])&&(De[0]===6||De[0]===2)){ee=0;continue}if(De[0]===3&&(!D||De[1]>D[0]&&De[1]<D[3])){ee.label=De[1];break}if(De[0]===6&&ee.label<D[1]){ee.label=D[1],D=De;break}if(D&&ee.label<D[2]){ee.label=D[2],ee.ops.push(De);break}D[2]&&ee.ops.pop(),ee.trys.pop();continue}De=E.call(P,ee)}catch(tt){De=[6,tt],k=0}finally{_=D=0}if(5&De[0])throw De[1];return{value:De[0]?De[1]:void 0,done:!0}}([_e,Re])}}}var Ct={0:"tench, Tinca tinca",1:"goldfish, Carassius auratus",2:"great white shark, white shark, man-eater, man-eating shark, Carcharodon carcharias",3:"tiger shark, Galeocerdo cuvieri",4:"hammerhead, hammerhead shark",5:"electric ray, crampfish, numbfish, torpedo",6:"stingray",7:"cock",8:"hen",9:"ostrich, Struthio camelus",10:"brambling, Fringilla montifringilla",11:"goldfinch, Carduelis carduelis",12:"house finch, linnet, Carpodacus mexicanus",13:"junco, snowbird",14:"indigo bunting, indigo finch, indigo bird, Passerina cyanea",15:"robin, American robin, Turdus migratorius",16:"bulbul",17:"jay",18:"magpie",19:"chickadee",20:"water ouzel, dipper",21:"kite",22:"bald eagle, American eagle, Haliaeetus leucocephalus",23:"vulture",24:"great grey owl, great gray owl, Strix nebulosa",25:"European fire salamander, Salamandra salamandra",26:"common newt, Triturus vulgaris",27:"eft",28:"spotted salamander, Ambystoma maculatum",29:"axolotl, mud puppy, Ambystoma mexicanum",30:"bullfrog, Rana catesbeiana",31:"tree frog, tree-frog",32:"tailed frog, bell toad, ribbed toad, tailed toad, Ascaphus trui",33:"loggerhead, loggerhead turtle, Caretta caretta",34:"leatherback turtle, leatherback, leathery turtle, Dermochelys coriacea",35:"mud turtle",36:"terrapin",37:"box turtle, box tortoise",38:"banded gecko",39:"common iguana, iguana, Iguana iguana",40:"American chameleon, anole, Anolis carolinensis",41:"whiptail, whiptail lizard",42:"agama",43:"frilled lizard, Chlamydosaurus kingi",44:"alligator lizard",45:"Gila monster, Heloderma suspectum",46:"green lizard, Lacerta viridis",47:"African chameleon, Chamaeleo chamaeleon",48:"Komodo dragon, Komodo lizard, dragon lizard, giant lizard, Varanus komodoensis",49:"African crocodile, Nile crocodile, Crocodylus niloticus",50:"American alligator, Alligator mississipiensis",51:"triceratops",52:"thunder snake, worm snake, Carphophis amoenus",53:"ringneck snake, ring-necked snake, ring snake",54:"hognose snake, puff adder, sand viper",55:"green snake, grass snake",56:"king snake, kingsnake",57:"garter snake, grass snake",58:"water snake",59:"vine snake",60:"night snake, Hypsiglena torquata",61:"boa constrictor, Constrictor constrictor",62:"rock python, rock snake, Python sebae",63:"Indian cobra, Naja naja",64:"green mamba",65:"sea snake",66:"horned viper, cerastes, sand viper, horned asp, Cerastes cornutus",67:"diamondback, diamondback rattlesnake, Crotalus adamanteus",68:"sidewinder, horned rattlesnake, Crotalus cerastes",69:"trilobite",70:"harvestman, daddy longlegs, Phalangium opilio",71:"scorpion",72:"black and gold garden spider, Argiope aurantia",73:"barn spider, Araneus cavaticus",74:"garden spider, Aranea diademata",75:"black widow, Latrodectus mactans",76:"tarantula",77:"wolf spider, hunting spider",78:"tick",79:"centipede",80:"black grouse",81:"ptarmigan",82:"ruffed grouse, partridge, Bonasa umbellus",83:"prairie chicken, prairie grouse, prairie fowl",84:"peacock",85:"quail",86:"partridge",87:"African grey, African gray, Psittacus erithacus",88:"macaw",89:"sulphur-crested cockatoo, Kakatoe galerita, Cacatua galerita",90:"lorikeet",91:"coucal",92:"bee eater",93:"hornbill",94:"hummingbird",95:"jacamar",96:"toucan",97:"drake",98:"red-breasted merganser, Mergus serrator",99:"goose",100:"black swan, Cygnus atratus",101:"tusker",102:"echidna, spiny anteater, anteater",103:"platypus, duckbill, duckbilled platypus, duck-billed platypus, Ornithorhynchus anatinus",104:"wallaby, brush kangaroo",105:"koala, koala bear, kangaroo bear, native bear, Phascolarctos cinereus",106:"wombat",107:"jelly fish",108:"sea anemone, anemone",109:"brain coral",110:"flatworm, platyhelminth",111:"nematode, nematode worm, roundworm",112:"conch",113:"snail",114:"slug",115:"sea slug, nudibranch",116:"chiton, coat-of-mail shell, sea cradle, polyplacophore",117:"chambered nautilus, pearly nautilus, nautilus",118:"Dungeness crab, Cancer magister",119:"rock crab, Cancer irroratus",120:"fiddler crab",121:"king crab, Alaska crab, Alaskan king crab, Alaska king crab, Paralithodes camtschatica",122:"American lobster, Northern lobster, Maine lobster, Homarus americanus",123:"spiny lobster, langouste, rock lobster, crawfish, crayfish, sea crawfish",124:"crayfish, crawfish, crawdad, crawdaddy",125:"hermit crab",126:"isopod",127:"white stork, Ciconia ciconia",128:"black stork, Ciconia nigra",129:"spoonbill",130:"flamingo",131:"little blue heron, Egretta caerulea",132:"American egret, great white heron, Egretta albus",133:"bittern",134:"crane",135:"limpkin, Aramus pictus",136:"European gallinule, Porphyrio porphyrio",137:"American coot, marsh hen, mud hen, water hen, Fulica americana",138:"bustard",139:"ruddy turnstone, Arenaria interpres",140:"red-backed sandpiper, dunlin, Erolia alpina",141:"redshank, Tringa totanus",142:"dowitcher",143:"oystercatcher, oyster catcher",144:"pelican",145:"king penguin, Aptenodytes patagonica",146:"albatross, mollymawk",147:"grey whale, gray whale, devilfish, Eschrichtius gibbosus, Eschrichtius robustus",148:"killer whale, killer, orca, grampus, sea wolf, Orcinus orca",149:"dugong, Dugong dugon",150:"sea lion",151:"Chihuahua",152:"Japanese spaniel",153:"Maltese dog, Maltese terrier, Maltese",154:"Pekinese, Pekingese, Peke",155:"Shih-Tzu",156:"Blenheim spaniel",157:"papillon",158:"toy terrier",159:"Rhodesian ridgeback",160:"Afghan hound, Afghan",161:"basset, basset hound",162:"beagle",163:"bloodhound, sleuthhound",164:"bluetick",165:"black-and-tan coonhound",166:"Walker hound, Walker foxhound",167:"English foxhound",168:"redbone",169:"borzoi, Russian wolfhound",170:"Irish wolfhound",171:"Italian greyhound",172:"whippet",173:"Ibizan hound, Ibizan Podenco",174:"Norwegian elkhound, elkhound",175:"otterhound, otter hound",176:"Saluki, gazelle hound",177:"Scottish deerhound, deerhound",178:"Weimaraner",179:"Staffordshire bullterrier, Staffordshire bull terrier",180:"American Staffordshire terrier, Staffordshire terrier, American pit bull terrier, pit bull terrier",181:"Bedlington terrier",182:"Border terrier",183:"Kerry blue terrier",184:"Irish terrier",185:"Norfolk terrier",186:"Norwich terrier",187:"Yorkshire terrier",188:"wire-haired fox terrier",189:"Lakeland terrier",190:"Sealyham terrier, Sealyham",191:"Airedale, Airedale terrier",192:"cairn, cairn terrier",193:"Australian terrier",194:"Dandie Dinmont, Dandie Dinmont terrier",195:"Boston bull, Boston terrier",196:"miniature schnauzer",197:"giant schnauzer",198:"standard schnauzer",199:"Scotch terrier, Scottish terrier, Scottie",200:"Tibetan terrier, chrysanthemum dog",201:"silky terrier, Sydney silky",202:"soft-coated wheaten terrier",203:"West Highland white terrier",204:"Lhasa, Lhasa apso",205:"flat-coated retriever",206:"curly-coated retriever",207:"golden retriever",208:"Labrador retriever",209:"Chesapeake Bay retriever",210:"German short-haired pointer",211:"vizsla, Hungarian pointer",212:"English setter",213:"Irish setter, red setter",214:"Gordon setter",215:"Brittany spaniel",216:"clumber, clumber spaniel",217:"English springer, English springer spaniel",218:"Welsh springer spaniel",219:"cocker spaniel, English cocker spaniel, cocker",220:"Sussex spaniel",221:"Irish water spaniel",222:"kuvasz",223:"schipperke",224:"groenendael",225:"malinois",226:"briard",227:"kelpie",228:"komondor",229:"Old English sheepdog, bobtail",230:"Shetland sheepdog, Shetland sheep dog, Shetland",231:"collie",232:"Border collie",233:"Bouvier des Flandres, Bouviers des Flandres",234:"Rottweiler",235:"German shepherd, German shepherd dog, German police dog, alsatian",236:"Doberman, Doberman pinscher",237:"miniature pinscher",238:"Greater Swiss Mountain dog",239:"Bernese mountain dog",240:"Appenzeller",241:"EntleBucher",242:"boxer",243:"bull mastiff",244:"Tibetan mastiff",245:"French bulldog",246:"Great Dane",247:"Saint Bernard, St Bernard",248:"Eskimo dog, husky",249:"malamute, malemute, Alaskan malamute",250:"Siberian husky",251:"dalmatian, coach dog, carriage dog",252:"affenpinscher, monkey pinscher, monkey dog",253:"basenji",254:"pug, pug-dog",255:"Leonberg",256:"Newfoundland, Newfoundland dog",257:"Great Pyrenees",258:"Samoyed, Samoyede",259:"Pomeranian",260:"chow, chow chow",261:"keeshond",262:"Brabancon griffon",263:"Pembroke, Pembroke Welsh corgi",264:"Cardigan, Cardigan Welsh corgi",265:"toy poodle",266:"miniature poodle",267:"standard poodle",268:"Mexican hairless",269:"timber wolf, grey wolf, gray wolf, Canis lupus",270:"white wolf, Arctic wolf, Canis lupus tundrarum",271:"red wolf, maned wolf, Canis rufus, Canis niger",272:"coyote, prairie wolf, brush wolf, Canis latrans",273:"dingo, warrigal, warragal, Canis dingo",274:"dhole, Cuon alpinus",275:"African hunting dog, hyena dog, Cape hunting dog, Lycaon pictus",276:"hyena, hyaena",277:"red fox, Vulpes vulpes",278:"kit fox, Vulpes macrotis",279:"Arctic fox, white fox, Alopex lagopus",280:"grey fox, gray fox, Urocyon cinereoargenteus",281:"tabby, tabby cat",282:"tiger cat",283:"Persian cat",284:"Siamese cat, Siamese",285:"Egyptian cat",286:"cougar, puma, catamount, mountain lion, painter, panther, Felis concolor",287:"lynx, catamount",288:"leopard, Panthera pardus",289:"snow leopard, ounce, Panthera uncia",290:"jaguar, panther, Panthera onca, Felis onca",291:"lion, king of beasts, Panthera leo",292:"tiger, Panthera tigris",293:"cheetah, chetah, Acinonyx jubatus",294:"brown bear, bruin, Ursus arctos",295:"American black bear, black bear, Ursus americanus, Euarctos americanus",296:"ice bear, polar bear, Ursus Maritimus, Thalarctos maritimus",297:"sloth bear, Melursus ursinus, Ursus ursinus",298:"mongoose",299:"meerkat, mierkat",300:"tiger beetle",301:"ladybug, ladybeetle, lady beetle, ladybird, ladybird beetle",302:"ground beetle, carabid beetle",303:"long-horned beetle, longicorn, longicorn beetle",304:"leaf beetle, chrysomelid",305:"dung beetle",306:"rhinoceros beetle",307:"weevil",308:"fly",309:"bee",310:"ant, emmet, pismire",311:"grasshopper, hopper",312:"cricket",313:"walking stick, walkingstick, stick insect",314:"cockroach, roach",315:"mantis, mantid",316:"cicada, cicala",317:"leafhopper",318:"lacewing, lacewing fly",319:"dragonfly, darning needle, devil's darning needle, sewing needle, snake feeder, snake doctor, mosquito hawk, skeeter hawk",320:"damselfly",321:"admiral",322:"ringlet, ringlet butterfly",323:"monarch, monarch butterfly, milkweed butterfly, Danaus plexippus",324:"cabbage butterfly",325:"sulphur butterfly, sulfur butterfly",326:"lycaenid, lycaenid butterfly",327:"starfish, sea star",328:"sea urchin",329:"sea cucumber, holothurian",330:"wood rabbit, cottontail, cottontail rabbit",331:"hare",332:"Angora, Angora rabbit",333:"hamster",334:"porcupine, hedgehog",335:"fox squirrel, eastern fox squirrel, Sciurus niger",336:"marmot",337:"beaver",338:"guinea pig, Cavia cobaya",339:"sorrel",340:"zebra",341:"hog, pig, grunter, squealer, Sus scrofa",342:"wild boar, boar, Sus scrofa",343:"warthog",344:"hippopotamus, hippo, river horse, Hippopotamus amphibius",345:"ox",346:"water buffalo, water ox, Asiatic buffalo, Bubalus bubalis",347:"bison",348:"ram, tup",349:"bighorn, bighorn sheep, cimarron, Rocky Mountain bighorn, Rocky Mountain sheep, Ovis canadensis",350:"ibex, Capra ibex",351:"hartebeest",352:"impala, Aepyceros melampus",353:"gazelle",354:"Arabian camel, dromedary, Camelus dromedarius",355:"llama",356:"weasel",357:"mink",358:"polecat, fitch, foulmart, foumart, Mustela putorius",359:"black-footed ferret, ferret, Mustela nigripes",360:"otter",361:"skunk, polecat, wood pussy",362:"badger",363:"armadillo",364:"three-toed sloth, ai, Bradypus tridactylus",365:"orangutan, orang, orangutang, Pongo pygmaeus",366:"gorilla, Gorilla gorilla",367:"chimpanzee, chimp, Pan troglodytes",368:"gibbon, Hylobates lar",369:"siamang, Hylobates syndactylus, Symphalangus syndactylus",370:"guenon, guenon monkey",371:"patas, hussar monkey, Erythrocebus patas",372:"baboon",373:"macaque",374:"langur",375:"colobus, colobus monkey",376:"proboscis monkey, Nasalis larvatus",377:"marmoset",378:"capuchin, ringtail, Cebus capucinus",379:"howler monkey, howler",380:"titi, titi monkey",381:"spider monkey, Ateles geoffroyi",382:"squirrel monkey, Saimiri sciureus",383:"Madagascar cat, ring-tailed lemur, Lemur catta",384:"indri, indris, Indri indri, Indri brevicaudatus",385:"Indian elephant, Elephas maximus",386:"African elephant, Loxodonta africana",387:"lesser panda, red panda, panda, bear cat, cat bear, Ailurus fulgens",388:"giant panda, panda, panda bear, coon bear, Ailuropoda melanoleuca",389:"barracouta, snoek",390:"eel",391:"coho, cohoe, coho salmon, blue jack, silver salmon, Oncorhynchus kisutch",392:"rock beauty, Holocanthus tricolor",393:"anemone fish",394:"sturgeon",395:"gar, garfish, garpike, billfish, Lepisosteus osseus",396:"lionfish",397:"puffer, pufferfish, blowfish, globefish",398:"abacus",399:"abaya",400:"academic gown, academic robe, judge's robe",401:"accordion, piano accordion, squeeze box",402:"acoustic guitar",403:"aircraft carrier, carrier, flattop, attack aircraft carrier",404:"airliner",405:"airship, dirigible",406:"altar",407:"ambulance",408:"amphibian, amphibious vehicle",409:"analog clock",410:"apiary, bee house",411:"apron",412:"ashcan, trash can, garbage can, wastebin, ash bin, ash-bin, ashbin, dustbin, trash barrel, trash bin",413:"assault rifle, assault gun",414:"backpack, back pack, knapsack, packsack, rucksack, haversack",415:"bakery, bakeshop, bakehouse",416:"balance beam, beam",417:"balloon",418:"ballpoint, ballpoint pen, ballpen, Biro",419:"Band Aid",420:"banjo",421:"bannister, banister, balustrade, balusters, handrail",422:"barbell",423:"barber chair",424:"barbershop",425:"barn",426:"barometer",427:"barrel, cask",428:"barrow, garden cart, lawn cart, wheelbarrow",429:"baseball",430:"basketball",431:"bassinet",432:"bassoon",433:"bathing cap, swimming cap",434:"bath towel",435:"bathtub, bathing tub, bath, tub",436:"beach wagon, station wagon, wagon, estate car, beach waggon, station waggon, waggon",437:"beacon, lighthouse, beacon light, pharos",438:"beaker",439:"bearskin, busby, shako",440:"beer bottle",441:"beer glass",442:"bell cote, bell cot",443:"bib",444:"bicycle-built-for-two, tandem bicycle, tandem",445:"bikini, two-piece",446:"binder, ring-binder",447:"binoculars, field glasses, opera glasses",448:"birdhouse",449:"boathouse",450:"bobsled, bobsleigh, bob",451:"bolo tie, bolo, bola tie, bola",452:"bonnet, poke bonnet",453:"bookcase",454:"bookshop, bookstore, bookstall",455:"bottlecap",456:"bow",457:"bow tie, bow-tie, bowtie",458:"brass, memorial tablet, plaque",459:"brassiere, bra, bandeau",460:"breakwater, groin, groyne, mole, bulwark, seawall, jetty",461:"breastplate, aegis, egis",462:"broom",463:"bucket, pail",464:"buckle",465:"bulletproof vest",466:"bullet train, bullet",467:"butcher shop, meat market",468:"cab, hack, taxi, taxicab",469:"caldron, cauldron",470:"candle, taper, wax light",471:"cannon",472:"canoe",473:"can opener, tin opener",474:"cardigan",475:"car mirror",476:"carousel, carrousel, merry-go-round, roundabout, whirligig",477:"carpenter's kit, tool kit",478:"carton",479:"car wheel",480:"cash machine, cash dispenser, automated teller machine, automatic teller machine, automated teller, automatic teller, ATM",481:"cassette",482:"cassette player",483:"castle",484:"catamaran",485:"CD player",486:"cello, violoncello",487:"cellular telephone, cellular phone, cellphone, cell, mobile phone",488:"chain",489:"chainlink fence",490:"chain mail, ring mail, mail, chain armor, chain armour, ring armor, ring armour",491:"chain saw, chainsaw",492:"chest",493:"chiffonier, commode",494:"chime, bell, gong",495:"china cabinet, china closet",496:"Christmas stocking",497:"church, church building",498:"cinema, movie theater, movie theatre, movie house, picture palace",499:"cleaver, meat cleaver, chopper",500:"cliff dwelling",501:"cloak",502:"clog, geta, patten, sabot",503:"cocktail shaker",504:"coffee mug",505:"coffeepot",506:"coil, spiral, volute, whorl, helix",507:"combination lock",508:"computer keyboard, keypad",509:"confectionery, confectionary, candy store",510:"container ship, containership, container vessel",511:"convertible",512:"corkscrew, bottle screw",513:"cornet, horn, trumpet, trump",514:"cowboy boot",515:"cowboy hat, ten-gallon hat",516:"cradle",517:"crane",518:"crash helmet",519:"crate",520:"crib, cot",521:"Crock Pot",522:"croquet ball",523:"crutch",524:"cuirass",525:"dam, dike, dyke",526:"desk",527:"desktop computer",528:"dial telephone, dial phone",529:"diaper, nappy, napkin",530:"digital clock",531:"digital watch",532:"dining table, board",533:"dishrag, dishcloth",534:"dishwasher, dish washer, dishwashing machine",535:"disk brake, disc brake",536:"dock, dockage, docking facility",537:"dogsled, dog sled, dog sleigh",538:"dome",539:"doormat, welcome mat",540:"drilling platform, offshore rig",541:"drum, membranophone, tympan",542:"drumstick",543:"dumbbell",544:"Dutch oven",545:"electric fan, blower",546:"electric guitar",547:"electric locomotive",548:"entertainment center",549:"envelope",550:"espresso maker",551:"face powder",552:"feather boa, boa",553:"file, file cabinet, filing cabinet",554:"fireboat",555:"fire engine, fire truck",556:"fire screen, fireguard",557:"flagpole, flagstaff",558:"flute, transverse flute",559:"folding chair",560:"football helmet",561:"forklift",562:"fountain",563:"fountain pen",564:"four-poster",565:"freight car",566:"French horn, horn",567:"frying pan, frypan, skillet",568:"fur coat",569:"garbage truck, dustcart",570:"gasmask, respirator, gas helmet",571:"gas pump, gasoline pump, petrol pump, island dispenser",572:"goblet",573:"go-kart",574:"golf ball",575:"golfcart, golf cart",576:"gondola",577:"gong, tam-tam",578:"gown",579:"grand piano, grand",580:"greenhouse, nursery, glasshouse",581:"grille, radiator grille",582:"grocery store, grocery, food market, market",583:"guillotine",584:"hair slide",585:"hair spray",586:"half track",587:"hammer",588:"hamper",589:"hand blower, blow dryer, blow drier, hair dryer, hair drier",590:"hand-held computer, hand-held microcomputer",591:"handkerchief, hankie, hanky, hankey",592:"hard disc, hard disk, fixed disk",593:"harmonica, mouth organ, harp, mouth harp",594:"harp",595:"harvester, reaper",596:"hatchet",597:"holster",598:"home theater, home theatre",599:"honeycomb",600:"hook, claw",601:"hoopskirt, crinoline",602:"horizontal bar, high bar",603:"horse cart, horse-cart",604:"hourglass",605:"iPod",606:"iron, smoothing iron",607:"jack-o'-lantern",608:"jean, blue jean, denim",609:"jeep, landrover",610:"jersey, T-shirt, tee shirt",611:"jigsaw puzzle",612:"jinrikisha, ricksha, rickshaw",613:"joystick",614:"kimono",615:"knee pad",616:"knot",617:"lab coat, laboratory coat",618:"ladle",619:"lampshade, lamp shade",620:"laptop, laptop computer",621:"lawn mower, mower",622:"lens cap, lens cover",623:"letter opener, paper knife, paperknife",624:"library",625:"lifeboat",626:"lighter, light, igniter, ignitor",627:"limousine, limo",628:"liner, ocean liner",629:"lipstick, lip rouge",630:"Loafer",631:"lotion",632:"loudspeaker, speaker, speaker unit, loudspeaker system, speaker system",633:"loupe, jeweler's loupe",634:"lumbermill, sawmill",635:"magnetic compass",636:"mailbag, postbag",637:"mailbox, letter box",638:"maillot",639:"maillot, tank suit",640:"manhole cover",641:"maraca",642:"marimba, xylophone",643:"mask",644:"matchstick",645:"maypole",646:"maze, labyrinth",647:"measuring cup",648:"medicine chest, medicine cabinet",649:"megalith, megalithic structure",650:"microphone, mike",651:"microwave, microwave oven",652:"military uniform",653:"milk can",654:"minibus",655:"miniskirt, mini",656:"minivan",657:"missile",658:"mitten",659:"mixing bowl",660:"mobile home, manufactured home",661:"Model T",662:"modem",663:"monastery",664:"monitor",665:"moped",666:"mortar",667:"mortarboard",668:"mosque",669:"mosquito net",670:"motor scooter, scooter",671:"mountain bike, all-terrain bike, off-roader",672:"mountain tent",673:"mouse, computer mouse",674:"mousetrap",675:"moving van",676:"muzzle",677:"nail",678:"neck brace",679:"necklace",680:"nipple",681:"notebook, notebook computer",682:"obelisk",683:"oboe, hautboy, hautbois",684:"ocarina, sweet potato",685:"odometer, hodometer, mileometer, milometer",686:"oil filter",687:"organ, pipe organ",688:"oscilloscope, scope, cathode-ray oscilloscope, CRO",689:"overskirt",690:"oxcart",691:"oxygen mask",692:"packet",693:"paddle, boat paddle",694:"paddlewheel, paddle wheel",695:"padlock",696:"paintbrush",697:"pajama, pyjama, pj's, jammies",698:"palace",699:"panpipe, pandean pipe, syrinx",700:"paper towel",701:"parachute, chute",702:"parallel bars, bars",703:"park bench",704:"parking meter",705:"passenger car, coach, carriage",706:"patio, terrace",707:"pay-phone, pay-station",708:"pedestal, plinth, footstall",709:"pencil box, pencil case",710:"pencil sharpener",711:"perfume, essence",712:"Petri dish",713:"photocopier",714:"pick, plectrum, plectron",715:"pickelhaube",716:"picket fence, paling",717:"pickup, pickup truck",718:"pier",719:"piggy bank, penny bank",720:"pill bottle",721:"pillow",722:"ping-pong ball",723:"pinwheel",724:"pirate, pirate ship",725:"pitcher, ewer",726:"plane, carpenter's plane, woodworking plane",727:"planetarium",728:"plastic bag",729:"plate rack",730:"plow, plough",731:"plunger, plumber's helper",732:"Polaroid camera, Polaroid Land camera",733:"pole",734:"police van, police wagon, paddy wagon, patrol wagon, wagon, black Maria",735:"poncho",736:"pool table, billiard table, snooker table",737:"pop bottle, soda bottle",738:"pot, flowerpot",739:"potter's wheel",740:"power drill",741:"prayer rug, prayer mat",742:"printer",743:"prison, prison house",744:"projectile, missile",745:"projector",746:"puck, hockey puck",747:"punching bag, punch bag, punching ball, punchball",748:"purse",749:"quill, quill pen",750:"quilt, comforter, comfort, puff",751:"racer, race car, racing car",752:"racket, racquet",753:"radiator",754:"radio, wireless",755:"radio telescope, radio reflector",756:"rain barrel",757:"recreational vehicle, RV, R.V.",758:"reel",759:"reflex camera",760:"refrigerator, icebox",761:"remote control, remote",762:"restaurant, eating house, eating place, eatery",763:"revolver, six-gun, six-shooter",764:"rifle",765:"rocking chair, rocker",766:"rotisserie",767:"rubber eraser, rubber, pencil eraser",768:"rugby ball",769:"rule, ruler",770:"running shoe",771:"safe",772:"safety pin",773:"saltshaker, salt shaker",774:"sandal",775:"sarong",776:"sax, saxophone",777:"scabbard",778:"scale, weighing machine",779:"school bus",780:"schooner",781:"scoreboard",782:"screen, CRT screen",783:"screw",784:"screwdriver",785:"seat belt, seatbelt",786:"sewing machine",787:"shield, buckler",788:"shoe shop, shoe-shop, shoe store",789:"shoji",790:"shopping basket",791:"shopping cart",792:"shovel",793:"shower cap",794:"shower curtain",795:"ski",796:"ski mask",797:"sleeping bag",798:"slide rule, slipstick",799:"sliding door",800:"slot, one-armed bandit",801:"snorkel",802:"snowmobile",803:"snowplow, snowplough",804:"soap dispenser",805:"soccer ball",806:"sock",807:"solar dish, solar collector, solar furnace",808:"sombrero",809:"soup bowl",810:"space bar",811:"space heater",812:"space shuttle",813:"spatula",814:"speedboat",815:"spider web, spider's web",816:"spindle",817:"sports car, sport car",818:"spotlight, spot",819:"stage",820:"steam locomotive",821:"steel arch bridge",822:"steel drum",823:"stethoscope",824:"stole",825:"stone wall",826:"stopwatch, stop watch",827:"stove",828:"strainer",829:"streetcar, tram, tramcar, trolley, trolley car",830:"stretcher",831:"studio couch, day bed",832:"stupa, tope",833:"submarine, pigboat, sub, U-boat",834:"suit, suit of clothes",835:"sundial",836:"sunglass",837:"sunglasses, dark glasses, shades",838:"sunscreen, sunblock, sun blocker",839:"suspension bridge",840:"swab, swob, mop",841:"sweatshirt",842:"swimming trunks, bathing trunks",843:"swing",844:"switch, electric switch, electrical switch",845:"syringe",846:"table lamp",847:"tank, army tank, armored combat vehicle, armoured combat vehicle",848:"tape player",849:"teapot",850:"teddy, teddy bear",851:"television, television system",852:"tennis ball",853:"thatch, thatched roof",854:"theater curtain, theatre curtain",855:"thimble",856:"thresher, thrasher, threshing machine",857:"throne",858:"tile roof",859:"toaster",860:"tobacco shop, tobacconist shop, tobacconist",861:"toilet seat",862:"torch",863:"totem pole",864:"tow truck, tow car, wrecker",865:"toyshop",866:"tractor",867:"trailer truck, tractor trailer, trucking rig, rig, articulated lorry, semi",868:"tray",869:"trench coat",870:"tricycle, trike, velocipede",871:"trimaran",872:"tripod",873:"triumphal arch",874:"trolleybus, trolley coach, trackless trolley",875:"trombone",876:"tub, vat",877:"turnstile",878:"typewriter keyboard",879:"umbrella",880:"unicycle, monocycle",881:"upright, upright piano",882:"vacuum, vacuum cleaner",883:"vase",884:"vault",885:"velvet",886:"vending machine",887:"vestment",888:"viaduct",889:"violin, fiddle",890:"volleyball",891:"waffle iron",892:"wall clock",893:"wallet, billfold, notecase, pocketbook",894:"wardrobe, closet, press",895:"warplane, military plane",896:"washbasin, handbasin, washbowl, lavabo, wash-hand basin",897:"washer, automatic washer, washing machine",898:"water bottle",899:"water jug",900:"water tower",901:"whiskey jug",902:"whistle",903:"wig",904:"window screen",905:"window shade",906:"Windsor tie",907:"wine bottle",908:"wing",909:"wok",910:"wooden spoon",911:"wool, woolen, woollen",912:"worm fence, snake fence, snake-rail fence, Virginia fence",913:"wreck",914:"yawl",915:"yurt",916:"web site, website, internet site, site",917:"comic book",918:"crossword puzzle, crossword",919:"street sign",920:"traffic light, traffic signal, stoplight",921:"book jacket, dust cover, dust jacket, dust wrapper",922:"menu",923:"plate",924:"guacamole",925:"consomme",926:"hot pot, hotpot",927:"trifle",928:"ice cream, icecream",929:"ice lolly, lolly, lollipop, popsicle",930:"French loaf",931:"bagel, beigel",932:"pretzel",933:"cheeseburger",934:"hotdog, hot dog, red hot",935:"mashed potato",936:"head cabbage",937:"broccoli",938:"cauliflower",939:"zucchini, courgette",940:"spaghetti squash",941:"acorn squash",942:"butternut squash",943:"cucumber, cuke",944:"artichoke, globe artichoke",945:"bell pepper",946:"cardoon",947:"mushroom",948:"Granny Smith",949:"strawberry",950:"orange",951:"lemon",952:"fig",953:"pineapple, ananas",954:"banana",955:"jackfruit, jak, jack",956:"custard apple",957:"pomegranate",958:"hay",959:"carbonara",960:"chocolate sauce, chocolate syrup",961:"dough",962:"meat loaf, meatloaf",963:"pizza, pizza pie",964:"potpie",965:"burrito",966:"red wine",967:"espresso",968:"cup",969:"eggnog",970:"alp",971:"bubble",972:"cliff, drop, drop-off",973:"coral reef",974:"geyser",975:"lakeside, lakeshore",976:"promontory, headland, head, foreland",977:"sandbar, sand bar",978:"seashore, coast, seacoast, sea-coast",979:"valley, vale",980:"volcano",981:"ballplayer, baseball player",982:"groom, bridegroom",983:"scuba diver",984:"rapeseed",985:"daisy",986:"yellow lady's slipper, yellow lady-slipper, Cypripedium calceolus, Cypripedium parviflorum",987:"corn",988:"acorn",989:"hip, rose hip, rosehip",990:"buckeye, horse chestnut, conker",991:"coral fungus",992:"agaric",993:"gyromitra",994:"stinkhorn, carrion fungus",995:"earthstar",996:"hen-of-the-woods, hen of the woods, Polyporus frondosus, Grifola frondosa",997:"bolete",998:"ear, spike, capitulum",999:"toilet tissue, toilet paper, bathroom tissue"},Vt={"1.00":"module_apply_default/MobilenetV1/Logits/global_pool","2.00":"module_apply_default/MobilenetV2/Logits/AvgPool"},En={"1.00":{.25:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1",inputRange:[0,1]},"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1",inputRange:[0,1]}},"2.00":{"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2",inputRange:[0,1]}}};function Pt(P){return P===void 0&&(P={version:1,alpha:1}),fn(this,void 0,void 0,function(){var E,_,k,D,q,ee;return on(this,function(de){switch(de.label){case 0:if(Qe==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");if(_=P.version.toFixed(2),k=P.alpha?P.alpha.toFixed(2):"",D=-1,q=1,P.modelUrl==null){if(!(_ in En))throw new Error("Invalid version of MobileNet. Valid versions are: "+Object.keys(En));if(!(k in En[_]))throw new Error("MobileNet constructed with invalid alpha "+P.alpha+". Valid multipliers for this version are: "+Object.keys(En[_])+".");E=En[_][k].inputRange,D=E[0],q=E[1]}return[4,(ee=new Rt(_,k,P.modelUrl,D,q)).load()];case 1:return de.sent(),[2,ee]}})})}var Rt=function(){function P(E,_,k,D,q){D===void 0&&(D=-1),q===void 0&&(q=1),this.version=E,this.alpha=_,this.modelUrl=k,this.inputMin=D,this.inputMax=q,this.inputRange=q-D}return P.prototype.load=function(){return fn(this,void 0,void 0,function(){var E,_,k,D,q=this;return on(this,function(ee){switch(ee.label){case 0:return this.modelUrl?(E=this,[4,Object(Ut.loadGraphModel)(this.modelUrl)]):[3,2];case 1:return E.model=ee.sent(),[3,4];case 2:return _=En[this.version][this.alpha].url,k=this,[4,Object(Ut.loadGraphModel)(_,{fromTFHub:!0})];case 3:k.model=ee.sent(),ee.label=4;case 4:return[4,(D=Object(Qe.tidy)(function(){return q.model.predict(Object(Qe.zeros)([1,224,224,3]))})).data()];case 5:return ee.sent(),D.dispose(),[2]}})})},P.prototype.infer=function(E,_){var k=this;return _===void 0&&(_=!1),Object(Qe.tidy)(function(){E instanceof Qe.Tensor||(E=Qe.browser.fromPixels(E));var D=E.toFloat().mul(k.inputRange).add(k.inputMin),q=D;E.shape[0]===224&&E.shape[1]===224||(q=Qe.image.resizeBilinear(D,[224,224],!0));var ee,de=q.reshape([-1,224,224,3]);if(_){var _e=Vt[k.version];ee=k.model.execute(de,_e).squeeze([1,2])}else ee=k.model.predict(de).slice([0,1],[-1,1e3]);return ee})},P.prototype.classify=function(E,_){return _===void 0&&(_=3),fn(this,void 0,void 0,function(){var k,D;return on(this,function(q){switch(q.label){case 0:return[4,function(ee,de){return fn(this,void 0,void 0,function(){var _e,Re,De,tt,st,It,Bt;return on(this,function(mn){switch(mn.label){case 0:return[4,(_e=ee.softmax()).data()];case 1:for(Re=mn.sent(),_e.dispose(),De=[],Bt=0;Bt<Re.length;Bt++)De.push({value:Re[Bt],index:Bt});for(De.sort(function(xn,Fn){return Fn.value-xn.value}),tt=new Float32Array(de),st=new Int32Array(de),Bt=0;Bt<de;Bt++)tt[Bt]=De[Bt].value,st[Bt]=De[Bt].index;for(It=[],Bt=0;Bt<st.length;Bt++)It.push({className:Ct[st[Bt]],probability:tt[Bt]});return[2,It]}})})}(k=this.infer(E),_)];case 1:return D=q.sent(),k.dispose(),[2,D]}})})},P}();function Tn(P,E,_){for(var k=[],D=0;D<P.length;D+=1)k.push({value:P[D],index:D});k.sort(function(De,tt){return tt.value-De.value});for(var q=new Float32Array(E),ee=new Int32Array(E),de=0;de<E;de+=1)q[de]=k[de].value,ee[de]=k[de].index;for(var _e=[],Re=0;Re<ee.length;Re+=1)_e.push({className:_[ee[Re]],probability:q[Re]});return _e}function Hn(P,E,_){return tr.apply(this,arguments)}function tr(){return(tr=J()(Ae.a.mark(function P(E,_,k){var D;return Ae.a.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.next=2,E.data();case 2:return D=q.sent,q.abrupt("return",Tn(D,_,k));case 4:case"end":return q.stop()}},P)}))).apply(this,arguments)}var pn=["kit fox","English setter","Siberian husky","Australian terrier","English springer","grey whale","lesser panda","Egyptian cat","ibex","Persian cat","cougar","gazelle","porcupine","sea lion","malamute","badger","Great Dane","Walker hound","Welsh springer spaniel","whippet","Scottish deerhound","killer whale","mink","African elephant","Weimaraner","soft-coated wheaten terrier","Dandie Dinmont","red wolf","Old English sheepdog","jaguar","otterhound","bloodhound","Airedale","hyena","meerkat","giant schnauzer","titi","three-toed sloth","sorrel","black-footed ferret","dalmatian","black-and-tan coonhound","papillon","skunk","Staffordshire bullterrier","Mexican hairless","Bouvier des Flandres","weasel","miniature poodle","Cardigan","malinois","bighorn","fox squirrel","colobus","tiger cat","Lhasa","impala","coyote","Yorkshire terrier","Newfoundland","brown bear","red fox","Norwegian elkhound","Rottweiler","hartebeest","Saluki","grey fox","schipperke","Pekinese","Brabancon griffon","West Highland white terrier","Sealyham terrier","guenon","mongoose","indri","tiger","Irish wolfhound","wild boar","EntleBucher","zebra","ram","French bulldog","orangutan","basenji","leopard","Bernese mountain dog","Maltese dog","Norfolk terrier","toy terrier","vizsla","cairn","squirrel monkey","groenendael","clumber","Siamese cat","chimpanzee","komondor","Afghan hound","Japanese spaniel","proboscis monkey","guinea pig","white wolf","ice bear","gorilla","borzoi","toy poodle","Kerry blue terrier","ox","Scotch terrier","Tibetan mastiff","spider monkey","Doberman","Boston bull","Greater Swiss Mountain dog","Appenzeller","Shih-Tzu","Irish water spaniel","Pomeranian","Bedlington terrier","warthog","Arabian camel","siamang","miniature schnauzer","collie","golden retriever","Irish terrier","affenpinscher","Border collie","hare","boxer","silky terrier","beagle","Leonberg","German short-haired pointer","patas","dhole","baboon","macaque","Chesapeake Bay retriever","bull mastiff","kuvasz","capuchin","pug","curly-coated retriever","Norwich terrier","flat-coated retriever","hog","keeshond","Eskimo dog","Brittany spaniel","standard poodle","Lakeland terrier","snow leopard","Gordon setter","dingo","standard schnauzer","hamster","Tibetan terrier","Arctic fox","wire-haired fox terrier","basset","water buffalo","American black bear","Angora","bison","howler monkey","hippopotamus","chow","giant panda","American Staffordshire terrier","Shetland sheepdog","Great Pyrenees","Chihuahua","tabby","marmoset","Labrador retriever","Saint Bernard","armadillo","Samoyed","bluetick","redbone","polecat","marmot","kelpie","gibbon","llama","miniature pinscher","wood rabbit","Italian greyhound","lion","cocker spaniel","Irish setter","dugong","Indian elephant","beaver","Sussex spaniel","Pembroke","Blenheim spaniel","Madagascar cat","Rhodesian ridgeback","lynx","African hunting dog","langur","Ibizan hound","timber wolf","cheetah","English foxhound","briard","sloth bear","Border terrier","German shepherd","otter","koala","tusker","echidna","wallaby","platypus","wombat","revolver","umbrella","schooner","soccer ball","accordion","ant","starfish","chambered nautilus","grand piano","laptop","strawberry","airliner","warplane","airship","balloon","space shuttle","fireboat","gondola","speedboat","lifeboat","canoe","yawl","catamaran","trimaran","container ship","liner","pirate","aircraft carrier","submarine","wreck","half track","tank","missile","bobsled","dogsled","bicycle-built-for-two","mountain bike","freight car","passenger car","barrow","shopping cart","motor scooter","forklift","electric locomotive","steam locomotive","amphibian","ambulance","beach wagon","cab","convertible","jeep","limousine","minivan","Model T","racer","sports car","go-kart","golfcart","moped","snowplow","fire engine","garbage truck","pickup","tow truck","trailer truck","moving van","police van","recreational vehicle","streetcar","snowmobile","tractor","mobile home","tricycle","unicycle","horse cart","jinrikisha","oxcart","bassinet","cradle","crib","four-poster","bookcase","china cabinet","medicine chest","chiffonier","table lamp","file","park bench","barber chair","throne","folding chair","rocking chair","studio couch","toilet seat","desk","pool table","dining table","entertainment center","wardrobe","Granny Smith","orange","lemon","fig","pineapple","banana","jackfruit","custard apple","pomegranate","acorn","hip","ear","rapeseed","corn","buckeye","organ","upright","chime","drum","gong","maraca","marimba","steel drum","banjo","cello","violin","harp","acoustic guitar","electric guitar","cornet","French horn","trombone","harmonica","ocarina","panpipe","bassoon","oboe","sax","flute","daisy","yellow lady's slipper","cliff","valley","alp","volcano","promontory","sandbar","coral reef","lakeside","seashore","geyser","hatchet","cleaver","letter opener","plane","power drill","lawn mower","hammer","corkscrew","can opener","plunger","screwdriver","shovel","plow","chain saw","cock","hen","ostrich","brambling","goldfinch","house finch","junco","indigo bunting","robin","bulbul","jay","magpie","chickadee","water ouzel","kite","bald eagle","vulture","great grey owl","black grouse","ptarmigan","ruffed grouse","prairie chicken","peacock","quail","partridge","African grey","macaw","sulphur-crested cockatoo","lorikeet","coucal","bee eater","hornbill","hummingbird","jacamar","toucan","drake","red-breasted merganser","goose","black swan","white stork","black stork","spoonbill","flamingo","American egret","little blue heron","bittern","crane","limpkin","American coot","bustard","ruddy turnstone","red-backed sandpiper","redshank","dowitcher","oystercatcher","European gallinule","pelican","king penguin","albatross","great white shark","tiger shark","hammerhead","electric ray","stingray","barracouta","coho","tench","goldfish","eel","rock beauty","anemone fish","lionfish","puffer","sturgeon","gar","loggerhead","leatherback turtle","mud turtle","terrapin","box turtle","banded gecko","common iguana","American chameleon","whiptail","agama","frilled lizard","alligator lizard","Gila monster","green lizard","African chameleon","Komodo dragon","triceratops","African crocodile","American alligator","thunder snake","ringneck snake","hognose snake","green snake","king snake","garter snake","water snake","vine snake","night snake","boa constrictor","rock python","Indian cobra","green mamba","sea snake","horned viper","diamondback","sidewinder","European fire salamander","common newt","eft","spotted salamander","axolotl","bullfrog","tree frog","tailed frog","whistle","wing","paintbrush","hand blower","oxygen mask","snorkel","loudspeaker","microphone","screen","mouse","electric fan","oil filter","strainer","space heater","stove","guillotine","barometer","rule","odometer","scale","analog clock","digital clock","wall clock","hourglass","sundial","parking meter","stopwatch","digital watch","stethoscope","syringe","magnetic compass","binoculars","projector","sunglasses","loupe","radio telescope","bow","cannon","assault rifle","rifle","projectile","computer keyboard","typewriter keyboard","crane","lighter","abacus","cash machine","slide rule","desktop computer","hand-held computer","notebook","web site","harvester","thresher","printer","slot","vending machine","sewing machine","joystick","switch","hook","car wheel","paddlewheel","pinwheel","potter's wheel","gas pump","carousel","swing","reel","radiator","puck","hard disc","sunglass","pick","car mirror","solar dish","remote control","disk brake","buckle","hair slide","knot","combination lock","padlock","nail","safety pin","screw","muzzle","seat belt","ski","candle","jack-o'-lantern","spotlight","torch","neck brace","pier","tripod","maypole","mousetrap","spider web","trilobite","harvestman","scorpion","black and gold garden spider","barn spider","garden spider","black widow","tarantula","wolf spider","tick","centipede","isopod","Dungeness crab","rock crab","fiddler crab","king crab","American lobster","spiny lobster","crayfish","hermit crab","tiger beetle","ladybug","ground beetle","long-horned beetle","leaf beetle","dung beetle","rhinoceros beetle","weevil","fly","bee","grasshopper","cricket","walking stick","cockroach","mantis","cicada","leafhopper","lacewing","dragonfly","damselfly","admiral","ringlet","monarch","cabbage butterfly","sulphur butterfly","lycaenid","jellyfish","sea anemone","brain coral","flatworm","nematode","conch","snail","slug","sea slug","chiton","sea urchin","sea cucumber","iron","espresso maker","microwave","Dutch oven","rotisserie","toaster","waffle iron","vacuum","dishwasher","refrigerator","washer","Crock Pot","frying pan","wok","caldron","coffeepot","teapot","spatula","altar","triumphal arch","patio","steel arch bridge","suspension bridge","viaduct","barn","greenhouse","palace","monastery","library","apiary","boathouse","church","mosque","stupa","planetarium","restaurant","cinema","home theater","lumbermill","coil","obelisk","totem pole","castle","prison","grocery store","bakery","barbershop","bookshop","butcher shop","confectionery","shoe shop","tobacco shop","toyshop","fountain","cliff dwelling","yurt","dock","brass","megalith","bannister","breakwater","dam","chainlink fence","picket fence","worm fence","stone wall","grille","sliding door","turnstile","mountain tent","scoreboard","honeycomb","plate rack","pedestal","beacon","mashed potato","bell pepper","head cabbage","broccoli","cauliflower","zucchini","spaghetti squash","acorn squash","butternut squash","cucumber","artichoke","cardoon","mushroom","shower curtain","jean","carton","handkerchief","sandal","ashcan","safe","plate","necklace","croquet ball","fur coat","thimble","pajama","running shoe","cocktail shaker","chest","manhole cover","modem","tub","tray","balance beam","bagel","prayer rug","kimono","hot pot","whiskey jug","knee pad","book jacket","spindle","ski mask","beer bottle","crash helmet","bottlecap","tile roof","mask","maillot","Petri dish","football helmet","bathing cap","teddy","holster","pop bottle","photocopier","vestment","crossword puzzle","golf ball","trifle","suit","water tower","feather boa","cloak","red wine","drumstick","shield","Christmas stocking","hoopskirt","menu","stage","bonnet","meat loaf","baseball","face powder","scabbard","sunscreen","beer glass","hen-of-the-woods","guacamole","lampshade","wool","hay","bow tie","mailbag","water jug","bucket","dishrag","soup bowl","eggnog","mortar","trench coat","paddle","chain","swab","mixing bowl","potpie","wine bottle","shoji","bulletproof vest","drilling platform","binder","cardigan","sweatshirt","pot","birdhouse","hamper","ping-pong ball","pencil box","pay-phone","consomme","apron","punching bag","backpack","groom","bearskin","pencil sharpener","broom","mosquito net","abaya","mortarboard","poncho","crutch","Polaroid camera","space bar","cup","racket","traffic light","quill","radio","dough","cuirass","military uniform","lipstick","shower cap","monitor","oscilloscope","mitten","brassiere","French loaf","vase","milk can","rugby ball","paper towel","earthstar","envelope","miniskirt","cowboy hat","trolleybus","perfume","bathtub","hotdog","coral fungus","bullet train","pillow","toilet tissue","cassette","carpenter's kit","ladle","stinkhorn","lotion","hair spray","academic gown","dome","crate","wig","burrito","pill bottle","chain mail","theater curtain","window shade","barrel","washbasin","ballpoint","basketball","bath towel","cowboy boot","gown","window screen","agaric","cellular telephone","nipple","barbell","mailbox","lab coat","fire screen","minibus","packet","maze","pole","horizontal bar","sombrero","pickelhaube","rain barrel","wallet","cassette player","comic book","piggy bank","street sign","bell cote","fountain pen","Windsor tie","volleyball","overskirt","sarong","purse","bolo tie","bib","parachute","sleeping bag","television","swimming trunks","measuring cup","espresso","pizza","breastplate","shopping basket","wooden spoon","saltshaker","chocolate sauce","ballplayer","goblet","gyromitra","stretcher","water bottle","dial telephone","soap dispenser","jersey","school bus","jigsaw puzzle","plastic bag","reflex camera","diaper","Band Aid","ice lolly","velvet","tennis ball","gasmask","doormat","Loafer","ice cream","pretzel","quilt","maillot","tape player","clog","iPod","bolete","scuba diver","pitcher","matchstick","bikini","sock","CD player","lens cap","thatch","vault","beaker","bubble","cheeseburger","parallel bars","flagpole","coffee mug","rubber eraser","stole","carbonara","dumbbell"],$e={DARKNET_URL:"https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/darknetclassifier/darknetreference/model.json",DARKNET_TINY_URL:"https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/darknetclassifier/darknettiny/model.json",IMAGE_SIZE_DARKNET:256,IMAGE_SIZE_DARKNET_TINY:224};function et(P,E){var _;P instanceof F.Tensor?_=P:P instanceof HTMLImageElement||P instanceof HTMLVideoElement||P instanceof HTMLCanvasElement||P instanceof ImageData?_=F.browser.fromPixels(P):Ce()(P)==="object"&&(P.elt instanceof HTMLImageElement||P.elt instanceof HTMLVideoElement||P.elt instanceof HTMLCanvasElement||P.elt instanceof ImageData)&&(_=F.browser.fromPixels(P.elt));var k=_.toFloat().div(F.scalar(255)),D=k;return(k.shape[0]!==E||k.shape[1]!==E)&&(D=F.image.resizeBilinear(k,[E,E],!0)),D.reshape([1,E,E,3])}var Ke=function(){function P(E){switch(pe()(this,P),this.version=E,this.version){case"reference":this.imgSize=$e.IMAGE_SIZE_DARKNET;break;case"tiny":this.imgSize=$e.IMAGE_SIZE_DARKNET_TINY}}return Fe()(P,[{key:"load",value:function(){var E=J()(Ae.a.mark(function _(){var k,D=this;return Ae.a.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:q.t0=this.version,q.next=q.t0==="reference"?3:q.t0==="tiny"?7:11;break;case 3:return q.next=5,F.loadLayersModel($e.DARKNET_URL);case 5:return this.model=q.sent,q.abrupt("break",12);case 7:return q.next=9,F.loadLayersModel($e.DARKNET_TINY_URL);case 9:return this.model=q.sent,q.abrupt("break",12);case 11:return q.abrupt("break",12);case 12:return k=F.tidy(function(){return D.model.predict(F.zeros([1,D.imgSize,D.imgSize,3]))}),q.next=15,k.data();case 15:k.dispose();case 16:case"end":return q.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee,de=this,_e=arguments;return Ae.a.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return D=_e.length>1&&_e[1]!==void 0?_e[1]:3,q=F.tidy(function(){var De=et(k,de.imgSize),tt=de.model.predict(De);return F.softmax(tt)}),Re.next=4,Hn(q,D,pn);case 4:return ee=Re.sent,q.dispose(),Re.abrupt("return",ee);case 7:case"end":return Re.stop()}},_)}));return function(_){return E.apply(this,arguments)}}()}]),P}();function yt(P){return Dt.apply(this,arguments)}function Dt(){return(Dt=J()(Ae.a.mark(function P(E){var _,k;return Ae.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if((_=E.version)==="reference"||_==="tiny"){D.next=3;break}throw new Error("Please select a version: darknet-reference or darknet-tiny");case 3:return k=new Ke(_),D.next=6,k.load();case 6:return D.abrupt("return",k);case 7:case"end":return D.stop()}},P)}))).apply(this,arguments)}var Lt=o(23),zn=o.n(Lt),Cn=["flashlight","belt","mushroom","pond","strawberry","pineapple","sun","cow","ear","bush","pliers","watermelon","apple","baseball","feather","shoe","leaf","lollipop","crown","ocean","horse","mountain","mosquito","mug","hospital","saw","castle","angel","underwear","traffic_light","cruise_ship","marker","blueberry","flamingo","face","hockey_stick","bucket","campfire","asparagus","skateboard","door","suitcase","skull","cloud","paint_can","hockey_puck","steak","house_plant","sleeping_bag","bench","snowman","arm","crayon","fan","shovel","leg","washing_machine","harp","toothbrush","tree","bear","rake","megaphone","knee","guitar","calculator","hurricane","grapes","paintbrush","couch","nose","square","wristwatch","penguin","bridge","octagon","submarine","screwdriver","rollerskates","ladder","wine_bottle","cake","bracelet","broom","yoga","finger","fish","line","truck","snake","bus","stitches","snorkel","shorts","bowtie","pickup_truck","tooth","snail","foot","crab","school_bus","train","dresser","sock","tractor","map","hedgehog","coffee_cup","computer","matches","beard","frog","crocodile","bathtub","rain","moon","bee","knife","boomerang","lighthouse","chandelier","jail","pool","stethoscope","frying_pan","cell_phone","binoculars","purse","lantern","birthday_cake","clarinet","palm_tree","aircraft_carrier","vase","eraser","shark","skyscraper","bicycle","sink","teapot","circle","tornado","bird","stereo","mouth","key","hot_dog","spoon","laptop","cup","bottlecap","The_Great_Wall_of_China","The_Mona_Lisa","smiley_face","waterslide","eyeglasses","ceiling_fan","lobster","moustache","carrot","garden","police_car","postcard","necklace","helmet","blackberry","beach","golf_club","car","panda","alarm_clock","t-shirt","dog","bread","wine_glass","lighter","flower","bandage","drill","butterfly","swan","owl","raccoon","squiggle","calendar","giraffe","elephant","trumpet","rabbit","trombone","sheep","onion","church","flip_flops","spreadsheet","pear","clock","roller_coaster","parachute","kangaroo","duck","remote_control","compass","monkey","rainbow","tennis_racquet","lion","pencil","string_bean","oven","star","cat","pizza","soccer_ball","syringe","flying_saucer","eye","cookie","floor_lamp","mouse","toilet","toaster","The_Eiffel_Tower","airplane","stove","cello","stop_sign","tent","diving_board","light_bulb","hammer","scorpion","headphones","basket","spider","paper_clip","sweater","ice_cream","envelope","sea_turtle","donut","hat","hourglass","broccoli","jacket","backpack","book","lightning","drums","snowflake","radio","banana","camel","canoe","toothpaste","chair","picture_frame","parrot","sandwich","lipstick","pants","violin","brain","power_outlet","triangle","hamburger","dragon","bulldozer","cannon","dolphin","zebra","animal_migration","camouflage","scissors","basketball","elbow","umbrella","windmill","table","rifle","hexagon","potato","anvil","sword","peanut","axe","television","rhinoceros","baseball_bat","speedboat","sailboat","zigzag","garden_hose","river","house","pillow","ant","tiger","stairs","cooler","see_saw","piano","fireplace","popsicle","dumbbell","mailbox","barn","hot_tub","teddy-bear","fork","dishwasher","peas","hot_air_balloon","keyboard","microwave","wheel","fire_hydrant","van","camera","whale","candle","octopus","pig","swing_set","helicopter","saxophone","passport","bat","ambulance","diamond","goatee","fence","grass","mermaid","motorbike","microphone","toe","cactus","nail","telephone","hand","squirrel","streetlight","bed","firetruck"],ar={DOODLENET_URL:"https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/doodlenet/model.json",IMAGE_SIZE_DOODLENET:28};function we(P,E){var _;P instanceof F.Tensor?_=P:P instanceof HTMLImageElement||P instanceof HTMLVideoElement||P instanceof HTMLCanvasElement||P instanceof ImageData?_=F.browser.fromPixels(P):Ce()(P)==="object"&&(P.elt instanceof HTMLImageElement||P.elt instanceof HTMLVideoElement||P.elt instanceof HTMLCanvasElement||P.elt instanceof ImageData)&&(_=F.browser.fromPixels(P.elt));var k=F.scalar(1).sub(_.toFloat().div(F.scalar(255))),D=k;k.shape[0]===E&&k.shape[1]===E||(D=F.image.resizeBilinear(k,[E,E]));var q=F.split(D,3,3),ee=zn()(q,3),de=ee[0],_e=ee[1],Re=ee[2];return de.add(_e).add(Re).div(F.scalar(3)).floor().reshape([1,E,E,1])}var lr=function(){function P(){pe()(this,P),this.imgSize=ar.IMAGE_SIZE_DOODLENET}return Fe()(P,[{key:"load",value:function(){var E=J()(Ae.a.mark(function _(){var k,D=this;return Ae.a.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.next=2,F.loadLayersModel(ar.DOODLENET_URL);case 2:return this.model=q.sent,k=F.tidy(function(){return D.model.predict(F.zeros([1,D.imgSize,D.imgSize,1]))}),q.next=6,k.data();case 6:k.dispose();case 7:case"end":return q.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee,de=this,_e=arguments;return Ae.a.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return D=_e.length>1&&_e[1]!==void 0?_e[1]:10,q=F.tidy(function(){var De=we(k,de.imgSize);return de.model.predict(De)}),Re.next=4,Hn(q,D,Cn);case 4:return ee=Re.sent,q.dispose(),Re.abrupt("return",ee);case 7:case"end":return Re.stop()}},_)}));return function(_){return E.apply(this,arguments)}}()}]),P}();function Rr(){return Tr.apply(this,arguments)}function Tr(){return(Tr=J()(Ae.a.mark(function P(){var E;return Ae.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return E=new lr,_.next=3,E.load();case 3:return _.abrupt("return",E);case 4:case"end":return _.stop()}},P)}))).apply(this,arguments)}var qr=new(function(){function P(){pe()(this,P),typeof window!="undefined"&&(this.m_p5Instance=window)}return Fe()(P,[{key:"setP5Instance",value:function(E){this.m_p5Instance=E}},{key:"p5Instance",get:function(){return this.m_p5Instance!==void 0&&typeof this.m_p5Instance.loadImage=="function"?this.m_p5Instance:this.m_p5Instance.p5!==void 0&&this.m_p5Instance.p5.Image!==void 0&&typeof this.m_p5Instance.p5.Image=="function"?this.m_p5Instance.p5:void 0}},{key:"checkP5",value:function(){return!!this.p5Instance}},{key:"getBlob",value:function(E){return new Promise(function(_,k){E.toBlob(function(D){D?_(D):k(new Error("Canvas could not be converted to Blob."))})})}},{key:"loadAsync",value:function(E){var _=this;return new Promise(function(k,D){_.p5Instance.loadImage(E,function(q){k(q)},function(){D(new Error("Could not load image from url ".concat(E)))})})}},{key:"rawToBlob",value:function(){var E=J()(Ae.a.mark(function _(k,D,q){var ee,de,_e,Re,De,tt;return Ae.a.wrap(function(st){for(;;)switch(st.prev=st.next){case 0:for(ee=Array.from(k),de=document.createElement("canvas"),_e=de.getContext("2d"),de.width=D,de.height=q,Re=_e.createImageData(D,q),De=Re.data,tt=0;tt<D*q*4;tt+=1)De[tt]=ee[tt];return _e.putImageData(Re,0,0),st.abrupt("return",this.getBlob(de));case 10:case"end":return st.stop()}},_,this)}));return function(_,k,D){return E.apply(this,arguments)}}()},{key:"blobToP5Image",value:function(){var E=J()(Ae.a.mark(function _(k){return Ae.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(!this.checkP5()||typeof URL=="undefined"){D.next=2;break}return D.abrupt("return",this.loadAsync(URL.createObjectURL(k)));case 2:return D.abrupt("return",null);case 3:case"end":return D.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()}]),P}()),Gr=function(P,E){var _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){},k=P,D=document.createElement("video");return k.onplay=function(){var q=k.captureStream();D.srcObject=q,D.width=E,D.height=E,D.autoplay=!0,D.playsinline=!0,D.muted=!0,_()},D},hn=function(P){var E=zn()(P.shape,2),_=E[0],k=E[1],D=P.dataSync(),q=document.createElement("canvas");q.width=k,q.height=_;for(var ee=q.getContext("2d"),de=ee.getImageData(0,0,q.width,q.height),_e=0;_e<k*_;_e+=1){var Re=4*_e,De=3*_e;de.data[Re+0]=Math.floor(256*D[De+0]),de.data[Re+1]=Math.floor(256*D[De+1]),de.data[Re+2]=Math.floor(256*D[De+2]),de.data[Re+3]=255}ee.putImageData(de,0,0);var tt=q.toDataURL(),st=document.createElement("img");return st.src=tt,st.style.width=k,st.style.height=_,P.dispose(),st},nn=function(P){var E=Math.min(P.shape[0],P.shape[1]),_=P.shape[0]/2-E/2,k=P.shape[1]/2-E/2;return P.slice([_,k,0],[E,E,3])},an=function(P){var E,_,k;if(k=P instanceof HTMLImageElement||P instanceof HTMLCanvasElement||P instanceof HTMLVideoElement||P instanceof ImageData?P:Ce()(P)==="object"&&(P.elt instanceof HTMLImageElement||P.elt instanceof HTMLCanvasElement||P.elt instanceof HTMLVideoElement||P.elt instanceof ImageData)?P.elt:Ce()(P)==="object"&&P.canvas instanceof HTMLCanvasElement?P.canvas:P,E=k.width,_=k.height,qr.checkP5()){var D=qr.p5Instance.createGraphics(E,_);return D.push(),D.translate(E,0),D.scale(-1,1),D.image(P,0,0,E,_),D.pop(),D}var q=document.createElement("canvas");q.width=E,q.height=_;var ee=q.getContext("2d");return ee.drawImage(k,0,0,E,_),ee.translate(E,0),ee.scale(-1,1),ee.drawImage(q,-1*E,0,E,_),q};function or(P){var E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return F.tidy(function(){var _=F.browser.fromPixels(P);return E&&(_=F.image.resizeBilinear(_,E)),nn(_).expandDims(0).toFloat().div(F.scalar(127)).sub(F.scalar(1))})}function jn(P){return P instanceof HTMLVideoElement||P instanceof HTMLImageElement||P instanceof HTMLCanvasElement||P instanceof ImageData}function Fr(P){var E,_,k;k=P instanceof HTMLImageElement||P instanceof HTMLCanvasElement||P instanceof HTMLVideoElement||P instanceof ImageData?P:Ce()(P)==="object"&&(P.elt instanceof HTMLImageElement||P.elt instanceof HTMLCanvasElement||P.elt instanceof HTMLVideoElement||P.elt instanceof ImageData)?P.elt:Ce()(P)==="object"&&P.canvas instanceof HTMLCanvasElement?P.canvas:P,E=k.width,_=k.height;var D=document.createElement("canvas");D.width=E,D.height=_;var q=D.getContext("2d");q.drawImage(k,0,0,E,_);var ee=q.getImageData(0,0,E,_);return Array.from(ee.data)}var Pr={mobilenet:{version:2,alpha:1,topk:3}},Br=["mobilenet","darknet","darknet-tiny","doodlenet"],wi=function(){function P(E,_,k,D){if(pe()(this,P),this.video=_,this.model=null,this.mapStringToIndex=[],typeof E=="string")if(Br.includes(E))switch(this.modelName=E,this.modelUrl=null,this.modelName){case"mobilenet":this.modelToUse=g,this.version=k.version||Pr.mobilenet.version,this.alpha=k.alpha||Pr.mobilenet.alpha,this.topk=k.topk||Pr.mobilenet.topk;break;case"darknet":this.version="reference",this.modelToUse=z;break;case"darknet-tiny":this.version="tiny",this.modelToUse=z;break;case"doodlenet":this.modelToUse=I;break;default:this.modelToUse=null}else this.modelUrl=E,this.modelUrl.endsWith("/")&&(this.modelUrl+="model.json");this.ready=ft(this.loadModel(this.modelUrl),D)}return Fe()(P,[{key:"loadModel",value:function(){var E=J()(Ae.a.mark(function _(k){return Ae.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(!k){D.next=6;break}return D.next=3,this.loadModelFrom(k);case 3:this.model=D.sent,D.next=9;break;case 6:return D.next=8,this.modelToUse.load({version:this.version,alpha:this.alpha});case 8:this.model=D.sent;case 9:return D.abrupt("return",this);case 10:case"end":return D.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"loadModelFrom",value:function(){var E=J()(Ae.a.mark(function _(){var k,D,q,ee,de,_e,Re,De,tt=arguments;return Ae.a.wrap(function(st){for(;;)switch(st.prev=st.next){case 0:if(k=tt.length>0&&tt[0]!==void 0?tt[0]:null,st.prev=1,k===null){st.next=7;break}return st.next=5,en.a.get(k);case 5:q=st.sent,D=q.data;case 7:if(D.ml5Specs&&(this.mapStringToIndex=D.ml5Specs.mapStringToIndex),this.mapStringToIndex.length!==0){st.next=16;break}return ee=k.split("/"),de=ee.slice(0,ee.length-1).join("/"),_e="".concat(de,"/metadata.json"),st.next=14,en.a.get(_e).catch(function(It){console.log("Tried to fetch metadata.json, but it seems to be missing.",It)});case 14:(Re=st.sent)&&(De=Re.data).labels&&(this.mapStringToIndex=De.labels);case 16:return st.next=18,F.loadLayersModel(k);case 18:return this.model=st.sent,st.abrupt("return",this.model);case 22:return st.prev=22,st.t0=st.catch(1),console.error(st.t0),st.abrupt("return",st.t0);case 26:case"end":return st.stop()}},_,this,[[1,22]])}));return function(){return E.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var E=J()(Ae.a.mark(function _(k,D){var q,ee,de,_e,Re,De,tt=this;return Ae.a.wrap(function(st){for(;;)switch(st.prev=st.next){case 0:return st.next=2,this.ready;case 2:return st.next=4,F.nextFrame();case 4:if(!(k instanceof HTMLVideoElement&&k.readyState===0)){st.next=8;break}return q=k,st.next=8,new Promise(function(It){q.onloadeddata=function(){return It()}});case 8:if(!this.video||this.video.readyState!==0){st.next=11;break}return st.next=11,new Promise(function(It){tt.video.onloadeddata=function(){return It()}});case 11:if(ee=[224,224],!this.modelUrl){st.next=20;break}return st.next=15,F.nextFrame();case 15:return de=F.tidy(function(){var It=or(k,ee),Bt=tt.model.predict(It);return Array.from(Bt.as1D().dataSync())}),st.next=18,de.map(function(It,Bt){return{label:tt.mapStringToIndex.length>0&&tt.mapStringToIndex[Bt]?tt.mapStringToIndex[Bt]:Bt,confidence:It}}).sort(function(It,Bt){return Bt.confidence-It.confidence});case 18:return _e=st.sent,st.abrupt("return",_e);case 20:return Re=or(k,ee),De=this.model.classify(Re,D).then(function(It){return It.map(function(Bt){return{label:Bt.className,confidence:Bt.probability}})}),Re.dispose(),st.abrupt("return",De);case 24:case"end":return st.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee,de,_e,Re=arguments;return Ae.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(D=Re.length>1&&Re[1]!==void 0?Re[1]:null,q=Re.length>2?Re[2]:void 0,ee=this.video,de=this.topk,typeof k!="function"){De.next=9;break}ee=this.video,_e=k,De.next=28;break;case 9:if(typeof k!="number"){De.next=14;break}ee=this.video,de=k,De.next=28;break;case 14:if(!(k instanceof HTMLVideoElement||k instanceof HTMLImageElement||k instanceof HTMLCanvasElement||k instanceof ImageData)){De.next=18;break}ee=k,De.next=28;break;case 18:if(Ce()(k)!=="object"||!(k.elt instanceof HTMLVideoElement||k.elt instanceof HTMLImageElement||k.elt instanceof HTMLCanvasElement||k.elt instanceof ImageData)){De.next=22;break}ee=k.elt,De.next=28;break;case 22:if(!(Ce()(k)==="object"&&k.canvas instanceof HTMLCanvasElement)){De.next=26;break}ee=k.canvas,De.next=28;break;case 26:if(this.video instanceof HTMLVideoElement){De.next=28;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 28:return typeof D=="number"?de=D:typeof D=="function"&&(_e=D),typeof q=="function"&&(_e=q),De.abrupt("return",ft(this.classifyInternal(ee,de),_e));case 31:case"end":return De.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"predict",value:function(){var E=J()(Ae.a.mark(function _(k,D,q){return Ae.a.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return ee.abrupt("return",this.classify(k,D||null,q));case 1:case"end":return ee.stop()}},_,this)}));return function(_,k,D){return E.apply(this,arguments)}}()}]),P}(),Ai=function(P,E,_,k){var D,q={},ee=k,de=P;if(typeof de!="string")throw new Error('Please specify a model to use. E.g: "MobileNet"');de.indexOf("http")===-1&&(de=P.toLowerCase()),E instanceof HTMLVideoElement?D=E:Ce()(E)==="object"&&E.elt instanceof HTMLVideoElement?D=E.elt:Ce()(E)==="object"?q=E:typeof E=="function"&&(ee=E),Ce()(_)==="object"?q=_:typeof _=="function"&&(ee=_);var _e=new wi(de,D,q,ee);return ee?_e:_e.ready},Jn=function(P,E){return(Jn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,k){_.__proto__=k}||function(_,k){for(var D in k)k.hasOwnProperty(D)&&(_[D]=k[D])})(P,E)},di=function(){return(di=Object.assign||function(P){for(var E,_=1,k=arguments.length;_<k;_++)for(var D in E=arguments[_])Object.prototype.hasOwnProperty.call(E,D)&&(P[D]=E[D]);return P}).apply(this,arguments)};function ri(P,E,_,k){return new(_||(_=Promise))(function(D,q){function ee(Re){try{_e(k.next(Re))}catch(De){q(De)}}function de(Re){try{_e(k.throw(Re))}catch(De){q(De)}}function _e(Re){Re.done?D(Re.value):new _(function(De){De(Re.value)}).then(ee,de)}_e((k=k.apply(P,E||[])).next())})}function Dr(P,E){var _,k,D,q,ee={label:0,sent:function(){if(1&D[0])throw D[1];return D[1]},trys:[],ops:[]};return q={next:de(0),throw:de(1),return:de(2)},typeof Symbol=="function"&&(q[Symbol.iterator]=function(){return this}),q;function de(_e){return function(Re){return function(De){if(_)throw new TypeError("Generator is already executing.");for(;ee;)try{if(_=1,k&&(D=2&De[0]?k.return:De[0]?k.throw||((D=k.return)&&D.call(k),0):k.next)&&!(D=D.call(k,De[1])).done)return D;switch(k=0,D&&(De=[2&De[0],D.value]),De[0]){case 0:case 1:D=De;break;case 4:return ee.label++,{value:De[1],done:!1};case 5:ee.label++,k=De[1],De=[0];continue;case 7:De=ee.ops.pop(),ee.trys.pop();continue;default:if(!(D=(D=ee.trys).length>0&&D[D.length-1])&&(De[0]===6||De[0]===2)){ee=0;continue}if(De[0]===3&&(!D||De[1]>D[0]&&De[1]<D[3])){ee.label=De[1];break}if(De[0]===6&&ee.label<D[1]){ee.label=D[1],D=De;break}if(D&&ee.label<D[2]){ee.label=D[2],ee.ops.push(De);break}D[2]&&ee.ops.pop(),ee.trys.pop();continue}De=E.call(P,ee)}catch(tt){De=[6,tt],k=0}finally{_=D=0}if(5&De[0])throw De[1];return{value:De[0]?De[1]:void 0,done:!0}}([_e,Re])}}}function ki(P){var E=typeof Symbol=="function"&&P[Symbol.iterator],_=0;return E?E.call(P):{next:function(){return P&&_>=P.length&&(P=void 0),{value:P&&P[_++],done:!P}}}}function Ei(P,E){var _=typeof Symbol=="function"&&P[Symbol.iterator];if(!_)return P;var k,D,q=_.call(P),ee=[];try{for(;(E===void 0||E-- >0)&&!(k=q.next()).done;)ee.push(k.value)}catch(de){D={error:de}}finally{try{k&&!k.done&&(_=q.return)&&_.call(q)}finally{if(D)throw D.error}}return ee}function mo(){for(var P=[],E=0;E<arguments.length;E++)P=P.concat(Ei(arguments[E]));return P}var Gi=null;function Ui(P){return Gi==null&&(Gi=Object(F.backend)().epsilon()),Object(F.tidy)(function(){var E=Object(F.moments)(P),_=E.mean,k=E.variance;return P.sub(_).div(k.sqrt().add(Gi))})}var Ot=function(){function P(E){var _=this;if(E==null)throw new Error("Required configuration object is missing for BrowserFftFeatureExtractor constructor");if(E.spectrogramCallback==null)throw new Error("spectrogramCallback cannot be null or undefined");if(!(E.numFramesPerSpectrogram>0))throw new Error("Invalid value in numFramesPerSpectrogram: "+E.numFramesPerSpectrogram);if(E.suppressionTimeMillis<0)throw new Error("Expected suppressionTimeMillis to be >= 0, but got "+E.suppressionTimeMillis);if(this.suppressionTimeMillis=E.suppressionTimeMillis,this.spectrogramCallback=E.spectrogramCallback,this.numFrames=E.numFramesPerSpectrogram,this.sampleRateHz=E.sampleRateHz||44100,this.fftSize=E.fftSize||1024,this.frameDurationMillis=this.fftSize/this.sampleRateHz*1e3,this.columnTruncateLength=E.columnTruncateLength||this.fftSize,this.overlapFactor=E.overlapFactor,this.includeRawAudio=E.includeRawAudio,F.util.assert(this.overlapFactor>=0&&this.overlapFactor<1,function(){return"Expected overlapFactor to be >= 0 and < 1, but got "+_.overlapFactor}),this.columnTruncateLength>this.fftSize)throw new Error("columnTruncateLength "+this.columnTruncateLength+" exceeds fftSize ("+this.fftSize+").");this.audioContextConstructor=window.AudioContext||window.webkitAudioContext}return P.prototype.start=function(E){return ri(this,void 0,void 0,function(){var _,k,D;return Dr(this,function(q){switch(q.label){case 0:if(this.frameIntervalTask!=null)throw new Error("Cannot start already-started BrowserFftFeatureExtractor");return _=this,[4,function(ee){return ri(this,void 0,void 0,function(){return Dr(this,function(de){switch(de.label){case 0:return[4,navigator.mediaDevices.getUserMedia({audio:ee==null||ee,video:!1})];case 1:return[2,de.sent()]}})})}(E)];case 1:return _.stream=q.sent(),this.audioContext=new this.audioContextConstructor,this.audioContext.sampleRate!==this.sampleRateHz&&console.warn("Mismatch in sampling rate: Expected: "+this.sampleRateHz+"; Actual: "+this.audioContext.sampleRate),k=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=0,k.connect(this.analyser),this.freqDataQueue=[],this.freqData=new Float32Array(this.fftSize),this.includeRawAudio&&(this.timeDataQueue=[],this.timeData=new Float32Array(this.fftSize)),D=Math.max(1,Math.round(this.numFrames*(1-this.overlapFactor))),this.tracker=new xe(D,Math.round(this.suppressionTimeMillis/this.frameDurationMillis)),this.frameIntervalTask=setInterval(this.onAudioFrame.bind(this),this.fftSize/this.sampleRateHz*1e3),[2]}})})},P.prototype.onAudioFrame=function(){return ri(this,void 0,void 0,function(){var E,_,k,D;return Dr(this,function(q){switch(q.label){case 0:return this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0?[2]:(this.freqDataQueue.push(this.freqData.slice(0,this.columnTruncateLength)),this.includeRawAudio&&(this.analyser.getFloatTimeDomainData(this.timeData),this.timeDataQueue.push(this.timeData.slice())),this.freqDataQueue.length>this.numFrames&&this.freqDataQueue.shift(),this.tracker.tick()?(E=$r(this.freqDataQueue),_=$t(E,[1,this.numFrames,this.columnTruncateLength,1]),k=void 0,this.includeRawAudio&&(D=$r(this.timeDataQueue),k=$t(D,[1,this.numFrames*this.fftSize])),[4,this.spectrogramCallback(_,k)]):[3,2]);case 1:q.sent()&&this.tracker.suppress(),Object(F.dispose)([_,k]),q.label=2;case 2:return[2]}})})},P.prototype.stop=function(){return ri(this,void 0,void 0,function(){return Dr(this,function(E){if(this.frameIntervalTask==null)throw new Error("Cannot stop because there is no ongoing streaming activity.");return clearInterval(this.frameIntervalTask),this.frameIntervalTask=null,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop(),[2]})})},P.prototype.setConfig=function(E){throw new Error("setConfig() is not implemented for BrowserFftFeatureExtractor.")},P.prototype.getFeatures=function(){throw new Error("getFeatures() is not implemented for BrowserFftFeatureExtractor. Use the spectrogramCallback field of the constructor config instead.")},P}();function $r(P){var E=P[0].length,_=new Float32Array(P.length*E);return P.forEach(function(k,D){return _.set(k,D*E)}),_}function $t(P,E){var _=new Float32Array(F.util.sizeFromShape(E));return _.set(P,_.length-P.length),Object(F.tensor)(_,E)}var xe=function(){function P(E,_){var k=this;this.period=E,this.suppressionTime=_==null?0:_,this.counter=0,F.util.assert(this.period>0,function(){return"Expected period to be positive, but got "+k.period})}return P.prototype.tick=function(){return this.counter++,this.counter%this.period==0&&(this.suppressionOnset==null||this.counter-this.suppressionOnset>this.suppressionTime)},P.prototype.suppress=function(){this.suppressionOnset=this.counter},P}();function ge(P){var E=0;P.forEach(function(D){E+=D.byteLength});var _=new Uint8Array(E),k=0;return P.forEach(function(D){_.set(new Uint8Array(D),k),k+=D.byteLength}),_.buffer}function ke(P){var E=0;P.forEach(function(D){return E+=D.length});var _=new Float32Array(E),k=0;return P.forEach(function(D){_.set(D,k),k+=D.length}),_}function Ne(P){if(P==null)throw new Error("Received null or undefind string");for(var E=unescape(encodeURIComponent(P)),_=new Uint8Array(E.length),k=0;k<E.length;++k)_[k]=E.charCodeAt(k);return _.buffer}function ot(P){if(P==null)throw new Error("Received null or undefind buffer");var E=new Uint8Array(P);return decodeURIComponent(escape(String.fromCharCode.apply(String,mo(E))))}var xt="TFJSSCDS",Ht=1,yn=function(){function P(E){if(this.examples={},this.label2Ids={},E!=null)for(var _=function(de){F.util.assert(de!=null,function(){return"Received null or undefined buffer"});var _e=0,Re=ot(de.slice(_e,xt.length));F.util.assert(Re===xt,function(){return"Deserialization error: Invalid descriptor"}),_e+=xt.length,_e+=4;var De=new Uint32Array(de,_e,1),tt=_e+=4;_e=tt+De[0];var st=ot(de.slice(tt,_e));return{manifest:JSON.parse(st),data:de.slice(_e)}}(E),k=0,D=0;D<_.manifest.length;++D){var q=_.manifest[D],ee=q.spectrogramNumFrames*q.spectrogramFrameSize;q.rawAudioNumSamples!=null&&(ee+=q.rawAudioNumSamples),ee*=4,this.addExample(_n({spec:q,data:_.data.slice(k,k+ee)})),k+=ee}}return P.prototype.addExample=function(E){F.util.assert(E!=null,function(){return"Got null or undefined example"}),F.util.assert(E.label!=null&&E.label.length>0,function(){return"Expected label to be a non-empty string, but got "+JSON.stringify(E.label)});var _=function(){function k(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return k()+k()+"-"+k()+"-"+k()+"-"+k()+"-"+k()+k()+k()}();return this.examples[_]=E,E.label in this.label2Ids||(this.label2Ids[E.label]=[]),this.label2Ids[E.label].push(_),_},P.prototype.merge=function(E){var _,k,D,q;F.util.assert(E!==this,function(){return"Cannot merge a dataset into itself"});var ee=E.getVocabulary();try{for(var de=ki(ee),_e=de.next();!_e.done;_e=de.next()){var Re=_e.value,De=E.getExamples(Re);try{for(var tt=ki(De),st=tt.next();!st.done;st=tt.next()){var It=st.value;this.addExample(It.example)}}catch(Bt){D={error:Bt}}finally{try{st&&!st.done&&(q=tt.return)&&q.call(tt)}finally{if(D)throw D.error}}}}catch(Bt){_={error:Bt}}finally{try{_e&&!_e.done&&(k=de.return)&&k.call(de)}finally{if(_)throw _.error}}},P.prototype.getExampleCounts=function(){var E={};for(var _ in this.examples){var k=this.examples[_];k.label in E||(E[k.label]=0),E[k.label]++}return E},P.prototype.getExamples=function(E){var _=this;F.util.assert(E!=null,function(){return"Expected label to be a string, but got "+JSON.stringify(E)}),F.util.assert(E in this.label2Ids,function(){return'No example of label "'+E+'" exists in dataset'});var k=[];return this.label2Ids[E].forEach(function(D){k.push({uid:D,example:_.examples[D]})}),k},P.prototype.getData=function(E,_){var k=this;F.util.assert(this.size()>0,function(){return"Cannot get spectrograms as tensors because the dataset is empty"});var D=this.getVocabulary();E!=null?F.util.assert(D.indexOf(E)!==-1,function(){return"Label "+E+" is not in the vocabulary ("+JSON.stringify(D)+")"}):F.util.assert(D.length>1,function(){return"One-hot encoding of labels requires the vocabulary to have at least two words, but it has only "+D.length+" word."}),_==null&&(_={});var q,ee,de=this.getSortedUniqueNumFrames();de.length===1?(q=_.numFrames==null?de[0]:_.numFrames,ee=_.hopFrames==null?1:_.hopFrames):(q=_.numFrames,F.util.assert(q!=null&&Number.isInteger(q)&&q>0,function(){return"There are "+de.length+" unique lengths among the "+k.size()+" examples of this Dataset, hence numFrames is required. But it is not provided."}),F.util.assert(q<=de[0],function(){return"numFrames ("+q+") exceeds the minimum numFrames ("+de[0]+") among the examples of the Dataset."}),ee=_.hopFrames,F.util.assert(ee!=null&&Number.isInteger(ee)&&ee>0,function(){return"There are "+de.length+" unique lengths among the "+k.size()+" examples of this Dataset, hence hopFrames is required. But it is not provided."}));var _e=_.normalize==null||_.normalize;return Object(F.tidy)(function(){for(var Re,De,tt,st=[],It=[],Bt=[],mn=0;mn<D.length;++mn){var xn=D[mn];if(E==null||xn===E){var Fn=k.label2Ids[xn],Rn=function(Ji){var Hi,mu,os=k.examples[Ji].spectrogram,ya=os.frameSize;tt==null?tt=ya:F.util.assert(ya===tt,function(){return"Mismatch in frameSize  ("+ya+" vs "+tt+")"});var cl=os.data.length/ya,gu=null;xn!=="_background_noise_"&&(gu=os.keyFrameIndex==null?Gn(os).dataSync()[0]:os.keyFrameIndex);var ll=Object(F.tensor3d)(os.data,[cl,ya,1]),xp=In(cl,gu,q,ee),Ld=function(xf){var Gl=Object(F.tidy)(function(){var Ja=ll.slice([xf[0],0,0],[xf[1]-xf[0],-1,-1]);return _e?Ui(Ja):Ja});_.getDataset?It.push(Gl.dataSync()):st.push(Gl),E==null&&Bt.push(mn)};try{for(var kh=ki(xp),ud=kh.next();!ud.done;ud=kh.next())Ld(ud.value)}catch(xf){Hi={error:xf}}finally{try{ud&&!ud.done&&(mu=kh.return)&&mu.call(kh)}finally{if(Hi)throw Hi.error}}Object(F.dispose)(ll)};try{for(var Ln=ki(Fn),Zn=Ln.next();!Zn.done;Zn=Ln.next())Rn(Zn.value)}catch(Ji){Re={error:Ji}}finally{try{Zn&&!Zn.done&&(De=Ln.return)&&De.call(Ln)}finally{if(Re)throw Re.error}}}}_.augmentByMixingNoiseRatio!=null&&k.augmentByMixingNoise(_.getDataset?It:st,Bt,_.augmentByMixingNoiseRatio);var An=_.shuffle==null||_.shuffle;if(_.getDataset){var Sr=_.datasetBatchSize==null?32:_.datasetBatchSize,Ur=_.datasetValidationSplit==null?.15:_.datasetValidationSplit;F.util.assert(Ur>0&&Ur<1,function(){return"Invalid dataset validation split: "+Ur});var Wr=It.map(function(Ji,Hi){return[Ji,Bt[Hi]]});F.util.shuffle(Wr),It=Wr.map(function(Ji){return Ji[0]});var ci=Wr.map(function(Ji){return Ji[1]}),Jr=function(Ji,Hi,mu){var os,ya,cl,gu,ll,xp,Ld,kh;F.util.assert(mu>0&&mu<1,function(){return"validationSplit is expected to be >0 and <1, but got "+mu});for(var ud=!Array.isArray(Ji[0]),xf=Hi,Gl=[],Ja=0;Ja<xf.length;++Ja){var _h=xf[Ja];Gl[_h]==null&&(Gl[_h]=[]),Gl[_h].push(Ja)}var Uf=Gl.length,gs=[],as=[];for(Gl.map(function(Wc){return F.util.shuffle(Wc)}),Ja=0;Ja<Uf;++Ja)for(var Au=Gl[Ja],zd=Math.round(Au.length*(1-mu)),wp=0;wp<Au.length;++wp)wp<zd?gs.push(Au[wp]):as.push(Au[wp]);if(ud){var kp=[],Wf=[],vm=[],$l=[];try{for(var Wu=ki(gs),pc=Wu.next();!pc.done;pc=Wu.next()){var vu=pc.value;kp.push(Ji[vu]),Wf.push(Hi[vu])}}catch(Wc){os={error:Wc}}finally{try{pc&&!pc.done&&(ya=Wu.return)&&ya.call(Wu)}finally{if(os)throw os.error}}try{for(var Eh=ki(as),cd=Eh.next();!cd.done;cd=Eh.next())vu=cd.value,vm.push(Ji[vu]),$l.push(Hi[vu])}catch(Wc){cl={error:Wc}}finally{try{cd&&!cd.done&&(gu=Eh.return)&&gu.call(Eh)}finally{if(cl)throw cl.error}}return{trainXs:kp,trainYs:Wf,valXs:vm,valYs:$l}}kp=[],Wf=[],vm=[],$l=[];try{for(var Ch=ki(gs),Vu=Ch.next();!Vu.done;Vu=Ch.next())vu=Vu.value,kp.push(Ji[vu]),Wf.push(Hi[vu])}catch(Wc){ll={error:Wc}}finally{try{Vu&&!Vu.done&&(xp=Ch.return)&&xp.call(Ch)}finally{if(ll)throw ll.error}}try{for(var Vf=ki(as),Ah=Vf.next();!Ah.done;Ah=Vf.next())vu=Ah.value,vm.push(Ji[vu]),$l.push(Hi[vu])}catch(Wc){Ld={error:Wc}}finally{try{Ah&&!Ah.done&&(kh=Vf.return)&&kh.call(Vf)}finally{if(Ld)throw Ld.error}}return{trainXs:kp,trainYs:Wf,valXs:vm,valYs:$l}}(It,ci,Ur),Xi=Jr.trainXs,lo=Jr.trainYs,io=Jr.valXs,ga=Jr.valYs,Ya=F.data.array(Xi).map(function(Ji){return Object(F.tensor3d)(Ji,[q,tt,1])}),Ta=F.data.array(lo).map(function(Ji){return Object(F.oneHot)([Ji],D.length).squeeze([0])}),Aa=F.data.zip({xs:Ya,ys:Ta});An&&(Aa=Aa.shuffle(It.length)),Aa=Aa.batch(Sr).prefetch(4);var Ma=F.data.array(io).map(function(Ji){return Object(F.tensor3d)(Ji,[q,tt,1])}),rs=F.data.array(ga).map(function(Ji){return Object(F.oneHot)([Ji],D.length).squeeze([0])}),va=F.data.zip({xs:Ma,ys:rs});return[Aa,va=va.batch(Sr).prefetch(4)]}if(An){var Ns=[];st.forEach(function(Ji,Hi){Ns.push({x:Ji,y:Bt[Hi]})}),F.util.shuffle(Ns),st=Ns.map(function(Ji){return Ji.x}),Bt=Ns.map(function(Ji){return Ji.y})}var Tc=E==null?Object(F.oneHot)(Object(F.tensor1d)(Bt,"int32"),D.length).asType("float32"):void 0;return{xs:Object(F.stack)(st),ys:Tc}})},P.prototype.augmentByMixingNoise=function(E,_,k){var D,q;if(E==null||E.length===0)throw new Error("Cannot perform augmentation because data is null or empty");for(var ee=E[0]instanceof Float32Array,de=this.getVocabulary(),_e=[],Re=[],De=0;De<_.length;++De)de[_[De]]==="_background_noise_"?_e.push(De):Re.push(De);if(_e.length===0)throw new Error("Cannot perform augmentation by mixing with noise when there is no example with label _background_noise_");var tt=[],st=[],It=function(xn){var Fn=_e[function(An,Sr){return Math.floor((Sr-An)*Math.random())+An}(0,_e.length)],Rn=ee?Object(F.tensor1d)(E[xn]):E[xn],Ln=ee?Object(F.tensor1d)(E[Fn]):E[Fn],Zn=Object(F.tidy)(function(){return Ui(Rn.add(Ln.mul(k)))});ee?tt.push(Zn.dataSync()):tt.push(Zn),st.push(_[xn])};try{for(var Bt=ki(Re),mn=Bt.next();!mn.done;mn=Bt.next())It(mn.value)}catch(xn){D={error:xn}}finally{try{mn&&!mn.done&&(q=Bt.return)&&q.call(Bt)}finally{if(D)throw D.error}}console.log("Data augmentation: mixing noise: added "+tt.length+" examples"),tt.forEach(function(xn){return E.push(xn)}),_.push.apply(_,mo(st))},P.prototype.getSortedUniqueNumFrames=function(){for(var E,_,k=new Set,D=this.getVocabulary(),q=0;q<D.length;++q){var ee=D[q],de=this.label2Ids[ee];try{for(var _e=ki(de),Re=_e.next();!Re.done;Re=_e.next()){var De=Re.value,tt=this.examples[De].spectrogram,st=tt.data.length/tt.frameSize;k.add(st)}}catch(Bt){E={error:Bt}}finally{try{Re&&!Re.done&&(_=_e.return)&&_.call(_e)}finally{if(E)throw E.error}}}var It=mo(k);return It.sort(),It},P.prototype.removeExample=function(E){if(!(E in this.examples))throw new Error("Nonexistent example UID: "+E);var _=this.examples[E].label;delete this.examples[E];var k=this.label2Ids[_].indexOf(E);this.label2Ids[_].splice(k,1),this.label2Ids[_].length===0&&delete this.label2Ids[_]},P.prototype.setExampleKeyFrameIndex=function(E,_){if(!(E in this.examples))throw new Error("Nonexistent example UID: "+E);var k=this.examples[E].spectrogram,D=k.data.length/k.frameSize;F.util.assert(_>=0&&_<D&&Number.isInteger(_),function(){return"Invalid keyFrameIndex: "+_+". Must be >= 0, < "+D+", and an integer."}),k.keyFrameIndex=_},P.prototype.size=function(){return Object.keys(this.examples).length},P.prototype.durationMillis=function(){var E=0;for(var _ in this.examples){var k=this.examples[_].spectrogram,D=23.22|k.frameDurationMillis;E+=k.data.length/k.frameSize*D}return E},P.prototype.empty=function(){return this.size()===0},P.prototype.clear=function(){this.examples={}},P.prototype.getVocabulary=function(){var E=new Set;for(var _ in this.examples){var k=this.examples[_];E.add(k.label)}var D=mo(E);return D.sort(),D},P.prototype.serialize=function(E){var _,k,D,q,ee=this.getVocabulary();F.util.assert(!this.empty(),function(){return"Cannot serialize empty Dataset"}),E!=null&&(Array.isArray(E)||(E=[E]),E.forEach(function(Fn){if(ee.indexOf(Fn)===-1)throw new Error('Word label "'+Fn+'" does not exist in the vocabulary of this dataset. The vocabulary is: '+JSON.stringify(ee)+".")}));var de=[],_e=[];try{for(var Re=ki(ee),De=Re.next();!De.done;De=Re.next()){var tt=De.value;if(E==null||E.indexOf(tt)!==-1){var st=this.label2Ids[tt];try{for(var It=ki(st),Bt=It.next();!Bt.done;Bt=It.next()){var mn=Bt.value,xn=dr(this.examples[mn]);de.push(xn.spec),_e.push(xn.data)}}catch(Fn){D={error:Fn}}finally{try{Bt&&!Bt.done&&(q=It.return)&&q.call(It)}finally{if(D)throw D.error}}}}}catch(Fn){_={error:Fn}}finally{try{De&&!De.done&&(k=Re.return)&&k.call(Re)}finally{if(_)throw _.error}}return function(Fn){var Rn=Ne(JSON.stringify(Fn.manifest)),Ln=Ne(xt),Zn=new Uint32Array([Ht]),An=new Uint32Array([Rn.byteLength]);return ge([ge([Ln,Zn.buffer,An.buffer]),Rn,Fn.data])}({manifest:de,data:ge(_e)})},P}();function dr(P){var E=P.rawAudio!=null,_={label:P.label,spectrogramNumFrames:P.spectrogram.data.length/P.spectrogram.frameSize,spectrogramFrameSize:P.spectrogram.frameSize};P.spectrogram.keyFrameIndex!=null&&(_.spectrogramKeyFrameIndex=P.spectrogram.keyFrameIndex);var k=P.spectrogram.data.buffer.slice(0);return E&&(_.rawAudioNumSamples=P.rawAudio.data.length,_.rawAudioSampleRateHz=P.rawAudio.sampleRateHz,k=ge([k,P.rawAudio.data.buffer])),{spec:_,data:k}}function _n(P){var E={frameSize:P.spec.spectrogramFrameSize,data:new Float32Array(P.data.slice(0,4*P.spec.spectrogramFrameSize*P.spec.spectrogramNumFrames))};P.spec.spectrogramKeyFrameIndex!=null&&(E.keyFrameIndex=P.spec.spectrogramKeyFrameIndex);var _={label:P.spec.label,spectrogram:E};return P.spec.rawAudioNumSamples!=null&&(_.rawAudio={sampleRateHz:P.spec.rawAudioSampleRateHz,data:new Float32Array(P.data.slice(4*P.spec.spectrogramFrameSize*P.spec.spectrogramNumFrames))}),_}function In(P,E,_,k){if(F.util.assert(Number.isInteger(P)&&P>0,function(){return"snippetLength must be a positive integer, but got "+P}),E!=null&&F.util.assert(Number.isInteger(E)&&E>=0,function(){return"focusIndex must be a non-negative integer, but got "+E}),F.util.assert(Number.isInteger(_)&&_>0,function(){return"windowLength must be a positive integer, but got "+_}),F.util.assert(Number.isInteger(k)&&k>0,function(){return"windowHop must be a positive integer, but got "+k}),F.util.assert(_<=P,function(){return"windowLength ("+_+") exceeds snippetLength ("+P+")"}),F.util.assert(E<P,function(){return"focusIndex ("+E+") equals or exceeds snippetLength ("+P+")"}),_===P)return[[0,P]];var D=[];if(E==null){for(var q=0;q+_<=P;)D.push([q,q+_]),q+=k;return D}var ee=Math.floor(_/2),de=E-ee;for(de<0?de=0:de+_>P&&(de=P-_);!(de-k<0||E>=de-k+_);)de-=k;for(;de+_<=P&&!(E<de);)D.push([de,de+_]),de+=k;return D}function Gn(P){return Object(F.tidy)(function(){return function(E){return Object(F.tidy)(function(){var _=E.data.length/E.frameSize;return Object(F.tensor2d)(E.data,[_,E.frameSize]).mean(-1)})}(P).argMax()})}var Nt="0.3.9",Ft="tfjs-speech-commands-saved-model-metadata",bn="indexeddb://tfjs-speech-commands-model/",Yt={localStorage:typeof window=="undefined"?null:window.localStorage},He=function(){function P(E,_,k){this.MODEL_URL_PREFIX="https://storage.googleapis.com/tfjs-models/tfjs/speech-commands/v"+function(D){return D.split(".").slice(0,2).join(".")}(Nt)+"/browser_fft",this.SAMPLE_RATE_HZ=44100,this.FFT_SIZE=1024,this.DEFAULT_SUPPRESSION_TIME_MILLIS=0,this.streaming=!1,this.transferRecognizers={},F.util.assert(_==null&&k==null||_!=null&&k!=null,function(){return"modelURL and metadataURL must be both provided or both not provided."}),_==null?(E==null?E=P.DEFAULT_VOCABULARY_NAME:F.util.assert(P.VALID_VOCABULARY_NAMES.indexOf(E)!==-1,function(){return"Invalid vocabulary name: '"+E+"'"}),this.vocabulary=E,this.modelArtifactsOrURL=this.MODEL_URL_PREFIX+"/"+this.vocabulary+"/model.json",this.metadataOrURL=this.MODEL_URL_PREFIX+"/"+this.vocabulary+"/metadata.json"):(F.util.assert(E==null,function(){return"vocabulary name must be null or undefined when modelURL is provided"}),this.modelArtifactsOrURL=_,this.metadataOrURL=k),this.parameters={sampleRateHz:this.SAMPLE_RATE_HZ,fftSize:this.FFT_SIZE}}return P.prototype.listen=function(E,_){return ri(this,void 0,void 0,function(){var k,D,q,ee,de,_e=this;return Dr(this,function(Re){switch(Re.label){case 0:if(this.streaming)throw new Error("Cannot start streaming again when streaming is ongoing.");return[4,this.ensureModelLoaded()];case 1:if(Re.sent(),_==null&&(_={}),k=_.probabilityThreshold==null?0:_.probabilityThreshold,_.includeEmbedding&&(k=0),F.util.assert(k>=0&&k<=1,function(){return"Invalid probabilityThreshold value: "+k}),D=_.invokeCallbackOnNoiseAndUnknown!=null&&_.invokeCallbackOnNoiseAndUnknown,_.includeEmbedding&&(D=!0),_.suppressionTimeMillis<0)throw new Error("suppressionTimeMillis is expected to be >= 0, but got "+_.suppressionTimeMillis);return q=_.overlapFactor==null?.5:_.overlapFactor,F.util.assert(q>=0&&q<1,function(){return"Expected overlapFactor to be >= 0 and < 1, but got "+q}),ee=function(De,tt){return ri(_e,void 0,void 0,function(){var st,It,Bt,mn,xn,Fn,Rn,Ln,Zn,An,Sr;return Dr(this,function(Ur){switch(Ur.label){case 0:return It=Ui(De),_.includeEmbedding?[4,this.ensureModelWithEmbeddingOutputCreated()]:[3,2];case 1:return Ur.sent(),st=Ei(this.modelWithEmbeddingOutput.predict(It),2),Bt=st[0],mn=st[1],[3,3];case 2:Bt=this.model.predict(It),Ur.label=3;case 3:return[4,Bt.data()];case 4:return xn=Ur.sent(),[4,(Fn=Bt.argMax(-1)).data()];case 5:return Rn=Ur.sent()[0],Ln=Math.max.apply(Math,mo(xn)),Object(F.dispose)([Bt,Fn,It]),Ln<k?[2,!1]:[3,6];case 6:return Zn=void 0,_.includeSpectrogram?(An={},[4,De.data()]):[3,8];case 7:An.data=Ur.sent(),An.frameSize=this.nonBatchInputShape[1],Zn=An,Ur.label=8;case 8:return Sr=!0,D||this.words[Rn]!=="_background_noise_"&&this.words[Rn]!=="_unknown_"||(Sr=!1),Sr&&E({scores:xn,spectrogram:Zn,embedding:mn}),[2,Sr]}})})},de=_.suppressionTimeMillis==null?this.DEFAULT_SUPPRESSION_TIME_MILLIS:_.suppressionTimeMillis,this.audioDataExtractor=new Ot({sampleRateHz:this.parameters.sampleRateHz,numFramesPerSpectrogram:this.nonBatchInputShape[0],columnTruncateLength:this.nonBatchInputShape[1],suppressionTimeMillis:de,spectrogramCallback:ee,overlapFactor:q}),[4,this.audioDataExtractor.start(_.audioTrackConstraints)];case 2:return Re.sent(),this.streaming=!0,[2]}})})},P.prototype.ensureModelLoaded=function(){return ri(this,void 0,void 0,function(){var E,_,k,D,q=this;return Dr(this,function(ee){switch(ee.label){case 0:return this.model!=null?[2]:[4,this.ensureMetadataLoaded()];case 1:return ee.sent(),typeof this.modelArtifactsOrURL!="string"?[3,3]:[4,Object(F.loadLayersModel)(this.modelArtifactsOrURL)];case 2:return E=ee.sent(),[3,5];case 3:return[4,Object(F.loadLayersModel)(F.io.fromMemory(this.modelArtifactsOrURL.modelTopology,this.modelArtifactsOrURL.weightSpecs,this.modelArtifactsOrURL.weightData))];case 4:E=ee.sent(),ee.label=5;case 5:if(E.inputs.length!==1)throw new Error("Expected model to have 1 input, but got a model with "+E.inputs.length+" inputs");if(E.inputs[0].shape.length!==4)throw new Error("Expected model to have an input shape of rank 4, but got an input shape of rank "+E.inputs[0].shape.length);if(E.inputs[0].shape[3]!==1)throw new Error("Expected model to have an input shape with 1 as the last dimension, but got input shape"+JSON.stringify(E.inputs[0].shape[3])+"}");if((_=E.outputShape).length!==2)throw new Error("Expected loaded model to have an output shape of rank 2,but received shape "+JSON.stringify(_));if(_[1]!==this.words.length)throw new Error("Mismatch between the last dimension of model's output shape ("+_[1]+") and number of words ("+this.words.length+").");return this.model=E,this.freezeModel(),this.nonBatchInputShape=E.inputs[0].shape.slice(1),this.elementsPerExample=1,E.inputs[0].shape.slice(1).forEach(function(de){return q.elementsPerExample*=de}),this.warmUpModel(),k=this.parameters.fftSize/this.parameters.sampleRateHz*1e3,D=E.inputs[0].shape[1],this.parameters.spectrogramDurationMillis=D*k,[2]}})})},P.prototype.ensureModelWithEmbeddingOutputCreated=function(){return ri(this,void 0,void 0,function(){var E,_;return Dr(this,function(k){switch(k.label){case 0:return this.modelWithEmbeddingOutput!=null?[2]:[4,this.ensureModelLoaded()];case 1:for(k.sent(),_=this.model.layers.length-2;_>=0;--_)if(this.model.layers[_].getClassName()==="Dense"){E=this.model.layers[_];break}if(E==null)throw new Error("Failed to find second last dense layer in the original model.");return this.modelWithEmbeddingOutput=Object(F.model)({inputs:this.model.inputs,outputs:[this.model.outputs[0],E.output]}),[2]}})})},P.prototype.warmUpModel=function(){var E=this;Object(F.tidy)(function(){for(var _=Object(F.zeros)([1].concat(E.nonBatchInputShape)),k=0;k<3;++k)E.model.predict(_)})},P.prototype.ensureMetadataLoaded=function(){return ri(this,void 0,void 0,function(){var E,_,k;return Dr(this,function(D){switch(D.label){case 0:return this.words!=null?[2]:typeof this.metadataOrURL!="string"?[3,2]:[4,function(q){return ri(this,void 0,void 0,function(){return Dr(this,function(ee){return[2,new Promise(function(de,_e){q.indexOf("http://")===0||q.indexOf("https://")===0?fetch(q).then(function(Re){Re.json().then(function(De){return de(De)})}):q.indexOf("file://")===0?o(185).readFile(q.slice(7),{encoding:"utf-8"},function(Re,De){return de(JSON.parse(De))}):_e(new Error("Unsupported URL scheme in metadata URL: "+q+". Supported schemes are: http://, https://, and (node.js-only) file://"))})]})})}(this.metadataOrURL)];case 1:return _=D.sent(),[3,3];case 2:_=this.metadataOrURL,D.label=3;case 3:if((E=_).wordLabels==null){if((k=E.words)==null)throw new Error('Cannot find field "words" or "wordLabels" in metadata JSON file');this.words=k}else this.words=E.wordLabels;return[2]}})})},P.prototype.stopListening=function(){return ri(this,void 0,void 0,function(){return Dr(this,function(E){switch(E.label){case 0:if(!this.streaming)throw new Error("Cannot stop streaming when streaming is not ongoing.");return[4,this.audioDataExtractor.stop()];case 1:return E.sent(),this.streaming=!1,[2]}})})},P.prototype.isListening=function(){return this.streaming},P.prototype.wordLabels=function(){return this.words},P.prototype.params=function(){return this.parameters},P.prototype.modelInputShape=function(){if(this.model==null)throw new Error("Model has not been loaded yet. Load model by calling ensureModelLoaded(), recognize(), or listen().");return this.model.inputs[0].shape},P.prototype.recognize=function(E,_){return ri(this,void 0,void 0,function(){var k,D,q,ee,de,_e,Re,De,tt,st,It,Bt,mn;return Dr(this,function(xn){switch(xn.label){case 0:return _==null&&(_={}),[4,this.ensureModelLoaded()];case 1:return xn.sent(),E!=null?[3,3]:[4,this.recognizeOnline()];case 2:k=xn.sent(),E=k.data,xn.label=3;case 3:if(E instanceof F.Tensor)this.checkInputTensorShape(E),q=E,D=E.shape[0];else{if((E=E).length%this.elementsPerExample)throw new Error("The length of the input Float32Array "+E.length+" is not divisible by the number of tensor elements per per example expected by the model "+this.elementsPerExample+".");D=E.length/this.elementsPerExample,q=Object(F.tensor4d)(E,[D].concat(this.nonBatchInputShape))}return de={scores:null},_.includeEmbedding?[4,this.ensureModelWithEmbeddingOutputCreated()]:[3,5];case 4:return xn.sent(),_e=this.modelWithEmbeddingOutput.predict(q),ee=_e[0],de.embedding=_e[1],[3,6];case 5:ee=this.model.predict(q),xn.label=6;case 6:return D!==1?[3,8]:(Re=de,[4,ee.data()]);case 7:return Re.scores=xn.sent(),[3,10];case 8:return De=Object(F.unstack)(ee),tt=De.map(function(Fn){return Fn.data()}),st=de,[4,Promise.all(tt)];case 9:st.scores=xn.sent(),Object(F.dispose)(De),xn.label=10;case 10:return _.includeSpectrogram?(It=de,Bt={},E instanceof F.Tensor?[4,E.data()]:[3,12]):[3,14];case 11:return mn=xn.sent(),[3,13];case 12:mn=E,xn.label=13;case 13:It.spectrogram=(Bt.data=mn,Bt.frameSize=this.nonBatchInputShape[1],Bt),xn.label=14;case 14:return[2,de]}})})},P.prototype.recognizeOnline=function(){return ri(this,void 0,void 0,function(){var E=this;return Dr(this,function(_){return[2,new Promise(function(k,D){E.audioDataExtractor=new Ot({sampleRateHz:E.parameters.sampleRateHz,numFramesPerSpectrogram:E.nonBatchInputShape[0],columnTruncateLength:E.nonBatchInputShape[1],suppressionTimeMillis:0,spectrogramCallback:function(q){return ri(E,void 0,void 0,function(){var ee,de,_e;return Dr(this,function(Re){switch(Re.label){case 0:return ee=Ui(q),[4,this.audioDataExtractor.stop()];case 1:return Re.sent(),de=k,_e={},[4,ee.data()];case 2:return de.apply(void 0,[(_e.data=Re.sent(),_e.frameSize=this.nonBatchInputShape[1],_e)]),ee.dispose(),[2,!1]}})})},overlapFactor:0}),E.audioDataExtractor.start()})]})})},P.prototype.createTransfer=function(E){if(this.model==null)throw new Error("Model has not been loaded yet. Load model by calling ensureModelLoaded(), recognizer(), or listen().");F.util.assert(E!=null&&typeof E=="string"&&E.length>1,function(){return"Expected the name for a transfer-learning recognized to be a non-empty string, but got "+JSON.stringify(E)}),F.util.assert(this.transferRecognizers[E]==null,function(){return"There is already a transfer-learning model named '"+E+"'"});var _=new $n(E,this.parameters,this.model);return this.transferRecognizers[E]=_,_},P.prototype.freezeModel=function(){var E,_;try{for(var k=ki(this.model.layers),D=k.next();!D.done;D=k.next())D.value.trainable=!1}catch(q){E={error:q}}finally{try{D&&!D.done&&(_=k.return)&&_.call(k)}finally{if(E)throw E.error}}},P.prototype.checkInputTensorShape=function(E){var _=this.model.inputs[0].shape.length;if(E.shape.length!==_)throw new Error("Expected input Tensor to have rank "+_+", but got rank "+E.shape.length+" that differs ");var k=E.shape.slice(1),D=this.model.inputs[0].shape.slice(1);if(!F.util.arraysEqual(k,D))throw new Error("Expected input to have shape [null,"+D+"], but got shape [null,"+k+"]")},P.VALID_VOCABULARY_NAMES=["18w","directional4w"],P.DEFAULT_VOCABULARY_NAME="18w",P}(),$n=function(P){function E(_,k,D){var q=P.call(this)||this;return q.name=_,q.parameters=k,q.baseModel=D,F.util.assert(_!=null&&typeof _=="string"&&_.length>0,function(){return"The name of a transfer model must be a non-empty string, but got "+JSON.stringify(_)}),q.nonBatchInputShape=q.baseModel.inputs[0].shape.slice(1),q.words=null,q.dataset=new yn,q}return function(_,k){function D(){this.constructor=_}Jn(_,k),_.prototype=k===null?Object.create(k):(D.prototype=k.prototype,new D)}(E,P),E.prototype.collectExample=function(_,k){return ri(this,void 0,void 0,function(){var D,q,ee,de,_e=this;return Dr(this,function(Re){if(F.util.assert(!this.streaming,function(){return"Cannot start collection of transfer-learning example because a streaming recognition or transfer-learning example collection is ongoing"}),F.util.assert(_!=null&&typeof _=="string"&&_.length>0,function(){return"Must provide a non-empty string when collecting transfer-learning example"}),k==null&&(k={}),k.durationMultiplier!=null&&k.durationSec!=null)throw new Error("durationMultiplier and durationSec are mutually exclusive, but are both specified.");return k.durationSec!=null?(F.util.assert(k.durationSec>0,function(){return"Expected durationSec to be > 0, but got "+k.durationSec}),q=this.parameters.fftSize/this.parameters.sampleRateHz,D=Math.ceil(k.durationSec/q)):k.durationMultiplier!=null?(F.util.assert(k.durationMultiplier>=1,function(){return"Expected duration multiplier to be >= 1, but got "+k.durationMultiplier}),D=Math.round(this.nonBatchInputShape[0]*k.durationMultiplier)):D=this.nonBatchInputShape[0],k.snippetDurationSec!=null&&(F.util.assert(k.snippetDurationSec>0,function(){return"snippetDurationSec is expected to be > 0, but got "+k.snippetDurationSec}),F.util.assert(k.onSnippet!=null,function(){return"onSnippet must be provided if snippetDurationSec is provided."})),k.onSnippet!=null&&F.util.assert(k.snippetDurationSec!=null,function(){return"snippetDurationSec must be provided if onSnippet is provided."}),ee=this.parameters.fftSize/this.parameters.sampleRateHz,de=ee*D,this.streaming=!0,[2,new Promise(function(De){var tt=k.snippetDurationSec==null?1:k.snippetDurationSec/de,st=1-tt,It=Math.round(1/tt),Bt=0,mn=-1,xn=[];_e.audioDataExtractor=new Ot({sampleRateHz:_e.parameters.sampleRateHz,numFramesPerSpectrogram:D,columnTruncateLength:_e.nonBatchInputShape[1],suppressionTimeMillis:0,spectrogramCallback:function(Fn,Rn){return ri(_e,void 0,void 0,function(){var Ln,Zn,An,Sr,Ur,Wr,ci,Jr,Xi,lo,io,ga,Ya,Ta,Aa,Ma,rs,va,Ns,Tc;return Dr(this,function(Ji){switch(Ji.label){case 0:return k.onSnippet!=null?[3,7]:(Ln=Ui(Fn),An=(Zn=this.dataset).addExample,Sr={label:_},Ur={},[4,Ln.data()]);case 1:return Sr.spectrogram=(Ur.data=Ji.sent(),Ur.frameSize=this.nonBatchInputShape[1],Ur),k.includeRawAudio?(ci={},[4,Rn.data()]):[3,3];case 2:return ci.data=Ji.sent(),ci.sampleRateHz=this.audioDataExtractor.sampleRateHz,Wr=ci,[3,4];case 3:Wr=void 0,Ji.label=4;case 4:return An.apply(Zn,[(Sr.rawAudio=Wr,Sr)]),Ln.dispose(),[4,this.audioDataExtractor.stop()];case 5:return Ji.sent(),this.streaming=!1,this.collateTransferWords(),Jr=De,Xi={},[4,Fn.data()];case 6:return Jr.apply(void 0,[(Xi.data=Ji.sent(),Xi.frameSize=this.nonBatchInputShape[1],Xi)]),[3,13];case 7:return[4,Fn.data()];case 8:for(lo=Ji.sent(),mn===-1&&(mn=lo.length),io=mn-1;lo[io]!==0&&io>=0;)io--;return ga=mn-io-1,mn=io+1,Ya=lo.slice(lo.length-ga,lo.length),xn.push(Ya),k.onSnippet!=null&&k.onSnippet({data:Ya,frameSize:this.nonBatchInputShape[1]}),Bt++!==It?[3,13]:[4,this.audioDataExtractor.stop()];case 9:return Ji.sent(),this.streaming=!1,this.collateTransferWords(),Ta=function(Hi){if(Hi.length<2)throw new Error("Cannot normalize a Float32Array with fewer than 2 elements.");return Gi==null&&(Gi=Object(F.backend)().epsilon()),Object(F.tidy)(function(){var mu=Object(F.moments)(Object(F.tensor1d)(Hi)),os=mu.mean,ya=mu.variance,cl=os.arraySync(),gu=Math.sqrt(ya.arraySync()),ll=Array.from(Hi).map(function(xp){return(xp-cl)/(gu+Gi)});return new Float32Array(ll)})}(ke(xn)),Aa={data:Ta,frameSize:this.nonBatchInputShape[1]},rs=(Ma=this.dataset).addExample,va={label:_,spectrogram:Aa},k.includeRawAudio?(Tc={},[4,Rn.data()]):[3,11];case 10:return Tc.data=Ji.sent(),Tc.sampleRateHz=this.audioDataExtractor.sampleRateHz,Ns=Tc,[3,12];case 11:Ns=void 0,Ji.label=12;case 12:rs.apply(Ma,[(va.rawAudio=Ns,va)]),De(Aa),Ji.label=13;case 13:return[2,!1]}})})},overlapFactor:st,includeRawAudio:k.includeRawAudio}),_e.audioDataExtractor.start(k.audioTrackConstraints)})]})})},E.prototype.clearExamples=function(){var _=this;F.util.assert(this.words!=null&&this.words.length>0&&!this.dataset.empty(),function(){return"No transfer learning examples exist for model name "+_.name}),this.dataset.clear(),this.words=null},E.prototype.countExamples=function(){if(this.dataset.empty())throw new Error("No examples have been collected for transfer-learning model named '"+this.name+"' yet.");return this.dataset.getExampleCounts()},E.prototype.getExamples=function(_){return this.dataset.getExamples(_)},E.prototype.setExampleKeyFrameIndex=function(_,k){this.dataset.setExampleKeyFrameIndex(_,k)},E.prototype.removeExample=function(_){this.dataset.removeExample(_),this.collateTransferWords()},E.prototype.isDatasetEmpty=function(){return this.dataset.empty()},E.prototype.loadExamples=function(_,k){var D,q,ee,de;k===void 0&&(k=!1);var _e=new yn(_);k&&this.clearExamples();var Re=_e.getVocabulary();try{for(var De=ki(Re),tt=De.next();!tt.done;tt=De.next()){var st=tt.value,It=_e.getExamples(st);try{for(var Bt=ki(It),mn=Bt.next();!mn.done;mn=Bt.next()){var xn=mn.value;this.dataset.addExample(xn.example)}}catch(Fn){ee={error:Fn}}finally{try{mn&&!mn.done&&(de=Bt.return)&&de.call(Bt)}finally{if(ee)throw ee.error}}}}catch(Fn){D={error:Fn}}finally{try{tt&&!tt.done&&(q=De.return)&&q.call(De)}finally{if(D)throw D.error}}this.collateTransferWords()},E.prototype.serializeExamples=function(_){return this.dataset.serialize(_)},E.prototype.collateTransferWords=function(){this.words=this.dataset.getVocabulary()},E.prototype.collectTransferDataAsTensors=function(_,k){var D=this.nonBatchInputShape[0];_=_||.25;var q=Math.round(_*D),ee=this.dataset.getData(null,di({numFrames:D,hopFrames:q},k));return{xs:ee.xs,ys:ee.ys}},E.prototype.collectTransferDataAsTfDataset=function(_,k,D,q){k===void 0&&(k=.15),D===void 0&&(D=32);var ee=this.nonBatchInputShape[0];_=_||.25;var de=Math.round(_*ee);return this.dataset.getData(null,di({numFrames:ee,hopFrames:de,getDataset:!0,datasetBatchSize:D,datasetValidationSplit:k},q))},E.prototype.train=function(_){return ri(this,void 0,void 0,function(){var k,D=this;return Dr(this,function(q){switch(q.label){case 0:return F.util.assert(this.words!=null&&this.words.length>0,function(){return"Cannot train transfer-learning model '"+D.name+"' because no transfer learning example has been collected."}),F.util.assert(this.words.length>1,function(){return"Cannot train transfer-learning model '"+D.name+"' because only 1 word label ('"+JSON.stringify(D.words)+"') has been collected for transfer learning. Requires at least 2."}),_.fineTuningEpochs!=null&&F.util.assert(_.fineTuningEpochs>=0&&Number.isInteger(_.fineTuningEpochs),function(){return"If specified, fineTuningEpochs must be a non-negative integer, but received "+_.fineTuningEpochs}),_==null&&(_={}),this.model==null&&this.createTransferModelFromBaseModel(),this.secondLastBaseDenseLayer.trainable=!1,this.model.compile({loss:"categoricalCrossentropy",optimizer:_.optimizer||"sgd",metrics:["acc"]}),k=_.fitDatasetDurationMillisThreshold==null?6e4:_.fitDatasetDurationMillisThreshold,this.dataset.durationMillis()>k?(console.log("Detected large dataset: total duration = "+this.dataset.durationMillis()+" ms > "+k+" ms. Training transfer model using fitDataset() instead of fit()"),[4,this.trainOnDataset(_)]):[3,2];case 1:return[2,q.sent()];case 2:return[4,this.trainOnTensors(_)];case 3:return[2,q.sent()]}})})},E.prototype.trainOnDataset=function(_){return ri(this,void 0,void 0,function(){var k,D,q,ee,de,_e,Re,De,tt;return Dr(this,function(st){switch(st.label){case 0:return F.util.assert(_.epochs>0,function(){return"Invalid config.epochs"}),k=_.batchSize==null?32:_.batchSize,D=_.windowHopRatio||.25,q=Ei(this.collectTransferDataAsTfDataset(D,_.validationSplit,k,{augmentByMixingNoiseRatio:_.augmentByMixingNoiseRatio}),2),ee=q[0],de=q[1],_e=F.util.now(),[4,this.model.fitDataset(ee,{epochs:_.epochs,validationData:_.validationSplit>0?de:null,callbacks:_.callback==null?null:[_.callback]})];case 1:return Re=st.sent(),console.log("fitDataset() took "+(F.util.now()-_e).toFixed(2)+" ms"),_.fineTuningEpochs!=null&&_.fineTuningEpochs>0?(De=F.util.now(),[4,this.fineTuningUsingTfDatasets(_,ee,de)]):[3,3];case 2:return tt=st.sent(),console.log("fitDataset() (fine-tuning) took "+(F.util.now()-De).toFixed(2)+" ms"),[2,[Re,tt]];case 3:return[2,Re]}})})},E.prototype.trainOnTensors=function(_){return ri(this,void 0,void 0,function(){var k,D,q,ee,de,_e,Re,De,tt,st;return Dr(this,function(It){switch(It.label){case 0:k=_.windowHopRatio||.25,D=this.collectTransferDataAsTensors(k,{augmentByMixingNoiseRatio:_.augmentByMixingNoiseRatio}),q=D.xs,ee=D.ys,console.log("Training data: xs.shape = "+q.shape+", ys.shape = "+ee.shape),It.label=1;case 1:return It.trys.push([1,,6,7]),_.validationSplit!=null?(De=function(Bt,mn,xn){return F.util.assert(xn>0&&xn<1,function(){return"validationSplit is expected to be >0 and <1, but got "+xn}),Object(F.tidy)(function(){for(var Fn=mn.argMax(-1).dataSync(),Rn=[],Ln=0;Ln<Fn.length;++Ln){var Zn=Fn[Ln];Rn[Zn]==null&&(Rn[Zn]=[]),Rn[Zn].push(Ln)}var An=Rn.length,Sr=[],Ur=[];for(Rn.map(function(Xi){return F.util.shuffle(Xi)}),Ln=0;Ln<An;++Ln)for(var Wr=Rn[Ln],ci=Math.round(Wr.length*(1-xn)),Jr=0;Jr<Wr.length;++Jr)Jr<ci?Sr.push(Wr[Jr]):Ur.push(Wr[Jr]);return{trainXs:Object(F.gather)(Bt,Sr),trainYs:Object(F.gather)(mn,Sr),valXs:Object(F.gather)(Bt,Ur),valYs:Object(F.gather)(mn,Ur)}})}(q,ee,_.validationSplit),de=De.trainXs,_e=De.trainYs,Re=[De.valXs,De.valYs]):(de=q,_e=ee),[4,this.model.fit(de,_e,{epochs:_.epochs==null?20:_.epochs,validationData:Re,batchSize:_.batchSize,callbacks:_.callback==null?null:[_.callback]})];case 2:return tt=It.sent(),_.fineTuningEpochs!=null&&_.fineTuningEpochs>0?[4,this.fineTuningUsingTensors(_,de,_e,Re)]:[3,4];case 3:return st=It.sent(),[2,[tt,st]];case 4:return[2,tt];case 5:return[3,7];case 6:return Object(F.dispose)([q,ee,de,_e,Re]),[7];case 7:return[2]}})})},E.prototype.fineTuningUsingTfDatasets=function(_,k,D){return ri(this,void 0,void 0,function(){var q,ee,de;return Dr(this,function(_e){switch(_e.label){case 0:return q=this.secondLastBaseDenseLayer.trainable,this.secondLastBaseDenseLayer.trainable=!0,ee=_.fineTuningOptimizer==null?"sgd":_.fineTuningOptimizer,this.model.compile({loss:"categoricalCrossentropy",optimizer:ee,metrics:["acc"]}),[4,this.model.fitDataset(k,{epochs:_.fineTuningEpochs,validationData:D,callbacks:_.callback==null?null:[_.callback]})];case 1:return de=_e.sent(),this.secondLastBaseDenseLayer.trainable=q,[2,de]}})})},E.prototype.fineTuningUsingTensors=function(_,k,D,q){return ri(this,void 0,void 0,function(){var ee,de,_e;return Dr(this,function(Re){switch(Re.label){case 0:return ee=this.secondLastBaseDenseLayer.trainable,this.secondLastBaseDenseLayer.trainable=!0,de=_.fineTuningOptimizer==null?"sgd":_.fineTuningOptimizer,this.model.compile({loss:"categoricalCrossentropy",optimizer:de,metrics:["acc"]}),[4,this.model.fit(k,D,{epochs:_.fineTuningEpochs,validationData:q,batchSize:_.batchSize,callbacks:_.fineTuningCallback==null?null:[_.fineTuningCallback]})];case 1:return _e=Re.sent(),this.secondLastBaseDenseLayer.trainable=ee,[2,_e]}})})},E.prototype.evaluate=function(_){return ri(this,void 0,void 0,function(){var k,D=this;return Dr(this,function(q){return F.util.assert(_.wordProbThresholds!=null&&_.wordProbThresholds.length>0,function(){return"Received null or empty wordProbThresholds"}),k=0,F.util.assert(this.words[k]==="_background_noise_",function(){return"Cannot perform evaluation when the first tag is not _background_noise_"}),[2,Object(F.tidy)(function(){for(var ee=[],de=0,_e=D.collectTransferDataAsTensors(_.windowHopRatio),Re=_e.xs,De=_e.ys.argMax(-1).dataSync(),tt=D.model.predict(Re),st=tt.slice([0,1],[tt.shape[0],tt.shape[1]-1]).max(-1),It=tt.shape[0],Bt=0;Bt<_.wordProbThresholds.length;++Bt){for(var mn=_.wordProbThresholds[Bt],xn=st.greater(Object(F.scalar)(mn)).dataSync(),Fn=0,Rn=0,Ln=0,Zn=0,An=0;An<It;++An)De[An]===k?(Fn++,xn[An]&&Ln++):(Rn++,xn[An]&&Zn++);var Sr=Ln/Fn,Ur=Zn/Rn;ee.push({probThreshold:mn,fpr:Sr,tpr:Ur}),console.log("ROC thresh="+mn+": fpr="+Sr.toFixed(4)+", tpr="+Ur.toFixed(4)),Bt>0&&(de+=Math.abs(ee[Bt-1].fpr-ee[Bt].fpr)*(ee[Bt-1].tpr+ee[Bt].tpr)/2)}return{rocCurve:ee,auc:de}})]})})},E.prototype.createTransferModelFromBaseModel=function(){var _=this;F.util.assert(this.words!=null,function(){return"No word example is available for tranfer-learning model of name "+_.name});for(var k=this.baseModel.layers,D=k.length-2;D>=0&&k[D].getClassName().toLowerCase()!=="dense";)D--;if(D<0)throw new Error("Cannot find a hidden dense layer in the base model.");this.secondLastBaseDenseLayer=k[D];var q=this.secondLastBaseDenseLayer.output;this.transferHead=Object(F.sequential)(),this.transferHead.add(F.layers.dense({units:this.words.length,activation:"softmax",inputShape:q.shape.slice(1),name:"NewHeadDense"}));var ee=this.transferHead.apply(q);this.model=Object(F.model)({inputs:this.baseModel.inputs,outputs:ee})},E.prototype.modelInputShape=function(){return this.baseModel.inputs[0].shape},E.prototype.getMetadata=function(){return{tfjsSpeechCommandsVersion:Nt,modelName:this.name,timeStamp:new Date().toISOString(),wordLabels:this.wordLabels()}},E.prototype.save=function(_){return ri(this,void 0,void 0,function(){var k,D,q;return Dr(this,function(ee){return k=_!=null,_=_||ur(this.name),k||(D=Yt.localStorage.getItem(Ft),(q=D==null?{}:JSON.parse(D))[this.name]=this.getMetadata(),Yt.localStorage.setItem(Ft,JSON.stringify(q))),console.log("Saving model to "+_),[2,this.model.save(_)]})})},E.prototype.load=function(_){return ri(this,void 0,void 0,function(){var k,D,q;return Dr(this,function(ee){switch(ee.label){case 0:if(k=_!=null,_=_||ur(this.name),!k){if((D=JSON.parse(Yt.localStorage.getItem(Ft)))==null||D[this.name]==null)throw new Error("Cannot find metadata for transfer model named "+this.name+'"');this.words=D[this.name].wordLabels,console.log("Loaded word list for model named "+this.name+": "+this.words)}return q=this,[4,Object(F.loadLayersModel)(_)];case 1:return q.model=ee.sent(),console.log("Loaded model from "+_+":"),this.model.summary(),[2]}})})},E.prototype.createTransfer=function(_){throw new Error("Creating transfer-learned recognizer from a transfer-learned recognizer is not supported.")},E}(He);function ur(P){return""+bn+P}function pr(P,E,_,k){if(F.util.assert(_==null&&k==null||_!=null&&k!=null,function(){return"customModelURL and customMetadataURL must be both provided or both not provided."}),_!=null&&F.util.assert(E==null,function(){return"vocabulary name must be null or undefined when modelURL is provided."}),P==="BROWSER_FFT")return new He(E,_,k);throw P==="SOFT_FFT"?new Error("SOFT_FFT SpeechCommandRecognizer has not been implemented yet."):new Error("Invalid fftType: '"+P+"'")}var kr=function(){function P(E){pe()(this,P),this.options=E}return Fe()(P,[{key:"load",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee;return Ae.a.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:return k?(D=k.split("/"),q=D.slice(0,D.length-1).join("/"),ee="".concat(q,"/metadata.json"),this.model=pr("BROWSER_FFT",void 0,k,ee)):this.model=pr("BROWSER_FFT"),de.next=3,this.model.ensureModelLoaded();case 3:this.allLabels=this.model.wordLabels();case 4:case"end":return de.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=this,_=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.allLabels.length,k=arguments.length>1?arguments[1]:void 0;return this.model.listen(function(D){if(D.scores){var q=Tn(D.scores,_,E.allLabels).map(function(ee){return{label:ee.className,confidence:ee.probability}});return k(null,q)}return k("ERROR: Cannot find scores in result: ".concat(D))},this.options).catch(function(D){return k("ERROR: ".concat(D.message))})}}]),P}();function ui(P,E){return Ir.apply(this,arguments)}function Ir(){return(Ir=J()(Ae.a.mark(function P(E,_){var k;return Ae.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return k=new kr(E),D.next=3,k.load(_);case 3:return D.abrupt("return",k);case 4:case"end":return D.stop()}},P)}))).apply(this,arguments)}var ji=["speechcommands18w"],Do=function(){function P(E,_,k){if(pe()(this,P),this.model=null,this.options=_,typeof E=="string")if(ji.includes(E))switch(this.modelName=E,this.modelUrl=null,this.modelName){case"speechcommands18w":this.modelToUse=X;break;default:this.modelToUse=null}else this.modelToUse=X,this.modelUrl=E;this.ready=ft(this.loadModel(_,this.modelUrl),k)}return Fe()(P,[{key:"loadModel",value:function(){var E=J()(Ae.a.mark(function _(k){return Ae.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.next=2,this.modelToUse.load(k,this.modelUrl);case 2:return this.model=D.sent,D.abrupt("return",this);case 4:case"end":return D.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var E=J()(Ae.a.mark(function _(k,D){return Ae.a.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.next=2,this.ready;case 2:return q.next=4,F.nextFrame();case 4:return q.abrupt("return",this.model.classify(k,D));case 5:case"end":return q.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=J()(Ae.a.mark(function _(){var k,D,q,ee,de=arguments;return Ae.a.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:return k=de.length>0&&de[0]!==void 0?de[0]:null,D=de.length>1?de[1]:void 0,q=this.topk,typeof k=="number"?q=k:typeof k=="function"&&(ee=k),typeof D=="function"&&(ee=D),_e.abrupt("return",this.classifyInternal(q,ee));case 6:case"end":return _e.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()}]),P}(),Bi=function(P,E,_){var k={},D=_,q=P;if(typeof q!="string")throw new Error('Please specify a model to use. E.g: "SpeechCommands18w"');q.indexOf("http")===-1&&(q=P.toLowerCase()),Ce()(E)==="object"?k=E:typeof E=="function"&&(D=E);var ee=new Do(q,k,D);return D?ee:ee.ready};function no(P,E){return P==null&&E==null?null:P==null?E.clone():E===null?P.clone():P.concat(E,0)}function $i(P,E){for(var _=[],k=0;k<P.length;k++)_.push({value:P[k],index:k});_.sort(function(ee,de){return de.value-ee.value});var D=new Float32Array(E),q=new Int32Array(E);for(k=0;k<E;k++)D[k]=_[k].value,q[k]=_[k].index;return{values:D,indices:q}}var mi=function(){function P(){this.classDatasetMatrices={},this.classExampleCount={},this.labelToClassId={},this.nextClassId=0}return P.prototype.addExample=function(E,_){var k=this;if(this.exampleShape==null&&(this.exampleShape=E.shape),!Qe.util.arraysEqual(this.exampleShape,E.shape))throw new Error("Example shape provided, "+E.shape+" does not match previously provided example shapes "+this.exampleShape+".");this.clearTrainDatasetMatrix(),_ in this.labelToClassId||(this.labelToClassId[_]=this.nextClassId++),Object(Qe.tidy)(function(){var D=k.normalizeVectorToUnitLength(E.flatten()),q=D.shape[0];if(k.classDatasetMatrices[_]==null)k.classDatasetMatrices[_]=D.as2D(1,q);else{var ee=k.classDatasetMatrices[_].as2D(k.classExampleCount[_],q).concat(D.as2D(1,q),0);k.classDatasetMatrices[_].dispose(),k.classDatasetMatrices[_]=ee}Object(Qe.keep)(k.classDatasetMatrices[_]),k.classExampleCount[_]==null&&(k.classExampleCount[_]=0),k.classExampleCount[_]++})},P.prototype.similarities=function(E){var _=this;return Object(Qe.tidy)(function(){var k=_.normalizeVectorToUnitLength(E.flatten()),D=k.shape[0];if(_.trainDatasetMatrix==null){var q=null;for(var ee in _.classDatasetMatrices)q=no(q,_.classDatasetMatrices[ee]);_.trainDatasetMatrix=q}if(_.trainDatasetMatrix==null)return console.warn("Cannot predict without providing training examples."),null;Object(Qe.keep)(_.trainDatasetMatrix);var de=_.getNumExamples();return _.trainDatasetMatrix.as2D(de,D).matMul(k.as2D(D,1)).as1D()})},P.prototype.predictClass=function(E,_){return _===void 0&&(_=3),function(k,D,q,ee){return new(q||(q=Promise))(function(de,_e){function Re(st){try{tt(ee.next(st))}catch(It){_e(It)}}function De(st){try{tt(ee.throw(st))}catch(It){_e(It)}}function tt(st){st.done?de(st.value):new q(function(It){It(st.value)}).then(Re,De)}tt((ee=ee.apply(k,D||[])).next())})}(this,void 0,void 0,function(){var k,D,q,ee,de=this;return function(_e,Re){var De,tt,st,It,Bt={label:0,sent:function(){if(1&st[0])throw st[1];return st[1]},trys:[],ops:[]};return It={next:mn(0),throw:mn(1),return:mn(2)},typeof Symbol=="function"&&(It[Symbol.iterator]=function(){return this}),It;function mn(xn){return function(Fn){return function(Rn){if(De)throw new TypeError("Generator is already executing.");for(;Bt;)try{if(De=1,tt&&(st=2&Rn[0]?tt.return:Rn[0]?tt.throw||((st=tt.return)&&st.call(tt),0):tt.next)&&!(st=st.call(tt,Rn[1])).done)return st;switch(tt=0,st&&(Rn=[2&Rn[0],st.value]),Rn[0]){case 0:case 1:st=Rn;break;case 4:return Bt.label++,{value:Rn[1],done:!1};case 5:Bt.label++,tt=Rn[1],Rn=[0];continue;case 7:Rn=Bt.ops.pop(),Bt.trys.pop();continue;default:if(!(st=(st=Bt.trys).length>0&&st[st.length-1])&&(Rn[0]===6||Rn[0]===2)){Bt=0;continue}if(Rn[0]===3&&(!st||Rn[1]>st[0]&&Rn[1]<st[3])){Bt.label=Rn[1];break}if(Rn[0]===6&&Bt.label<st[1]){Bt.label=st[1],st=Rn;break}if(st&&Bt.label<st[2]){Bt.label=st[2],Bt.ops.push(Rn);break}st[2]&&Bt.ops.pop(),Bt.trys.pop();continue}Rn=Re.call(_e,Bt)}catch(Ln){Rn=[6,Ln],tt=0}finally{De=st=0}if(5&Rn[0])throw Rn[1];return{value:Rn[0]?Rn[1]:void 0,done:!0}}([xn,Fn])}}}(this,function(_e){switch(_e.label){case 0:if(_<1)throw new Error("Please provide a positive integer k value to predictClass.");if(this.getNumExamples()===0)throw new Error("You have not added any examples to the KNN classifier. Please add examples before calling predictClass.");return k=Object(Qe.tidy)(function(){return de.similarities(E).asType("float32")}),D=Math.min(_,this.getNumExamples()),ee=$i,[4,k.data()];case 1:return q=ee.apply(void 0,[_e.sent(),D]).indices,k.dispose(),[2,this.calculateTopClass(q,D)]}})})},P.prototype.clearClass=function(E){if(this.classDatasetMatrices[E]==null)throw new Error("Cannot clear invalid class "+E);delete this.classDatasetMatrices[E],delete this.classExampleCount[E],this.clearTrainDatasetMatrix()},P.prototype.clearAllClasses=function(){for(var E in this.classDatasetMatrices)this.clearClass(E)},P.prototype.getClassExampleCount=function(){return this.classExampleCount},P.prototype.getClassifierDataset=function(){return this.classDatasetMatrices},P.prototype.getNumClasses=function(){return Object.keys(this.classExampleCount).length},P.prototype.setClassifierDataset=function(E){for(var _ in this.clearTrainDatasetMatrix(),this.classDatasetMatrices=E,E)this.classExampleCount[_]=E[_].shape[0]},P.prototype.calculateTopClass=function(E,_){var k,D={};if(E==null)return{classIndex:this.labelToClassId[k],label:k,confidences:D};var q={},ee=0;for(var de in this.classDatasetMatrices)ee+=this.classExampleCount[de],q[de]=ee;var _e={};for(var de in this.classDatasetMatrices)_e[de]=0;for(var Re=0;Re<E.length;Re++){var De=E[Re];for(var de in this.classDatasetMatrices)if(De<q[de]){_e[de]++;break}}var tt=0;for(var de in this.classDatasetMatrices){var st=_e[de]/_;st>tt&&(tt=st,k=de),D[de]=st}return{classIndex:this.labelToClassId[k],label:k,confidences:D}},P.prototype.clearTrainDatasetMatrix=function(){this.trainDatasetMatrix!=null&&(this.trainDatasetMatrix.dispose(),this.trainDatasetMatrix=null)},P.prototype.normalizeVectorToUnitLength=function(E){return Object(Qe.tidy)(function(){var _=E.norm();return Object(Qe.div)(E,_)})},P.prototype.getNumExamples=function(){var E=0;for(var _ in this.classDatasetMatrices)E+=this.classExampleCount[_];return E},P.prototype.dispose=function(){for(var E in this.clearTrainDatasetMatrix(),this.classDatasetMatrices)this.classDatasetMatrices[E].dispose()},P}(),ai=function(){var P=J()(Ae.a.mark(function E(_,k,D){var q,ee;return Ae.a.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:(q=document.createElement("a")).style.display="none",document.body.appendChild(q),ee=new Blob([_],{type:D}),q.href=URL.createObjectURL(ee),q.download=k,q.click();case 7:case"end":return de.stop()}},E)}));return function(E,_,k){return P.apply(this,arguments)}}(),qn=function(){var P=J()(Ae.a.mark(function E(_,k){return Ae.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.abrupt("return",en.a.get(_).then(function(q){return q.data}).then(function(q){return k&&k(null,q),q}).catch(function(q){throw k&&k(q),console.error("There has been a problem loading the file: ".concat(q.message)),q}));case 1:case"end":return D.stop()}},E)}));return function(E,_){return P.apply(this,arguments)}}(),Di=function(){function P(){pe()(this,P),this.knnClassifier=new mi,this.mapStringToIndex=[]}return Fe()(P,[{key:"addExample",value:function(E,_){var k,D;typeof _=="string"?k=this.mapStringToIndex.includes(_)?this.mapStringToIndex.indexOf(_):this.mapStringToIndex.push(_)-1:typeof _=="number"&&(k=_),D=Array.isArray(E)?F.tensor(E):E,this.knnClassifier.addExample(D,k)}},{key:"classify",value:function(){var E=J()(Ae.a.mark(function _(k,D,q){var ee,de,_e;return Ae.a.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return ee=3,de=q,typeof D=="number"?ee=D:typeof D=="function"&&(de=D),_e=Array.isArray(k)?F.tensor(k):k,Re.abrupt("return",ft(this.classifyInternal(_e,ee),de));case 5:case"end":return Re.stop()}},_,this)}));return function(_,k,D){return E.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var E=J()(Ae.a.mark(function _(k,D){var q,ee,de,_e=this;return Ae.a.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:if(!(this.knnClassifier.getNumClasses()<=0)){Re.next=5;break}throw new Error("There is no example in any class");case 5:return Re.next=7,this.knnClassifier.predictClass(k,D);case 7:return q=Re.sent,this.mapStringToIndex.length>0&&((q.classIndex||q.classIndex===0)&&(ee=this.mapStringToIndex[q.classIndex])&&(q.label=ee),q.confidences&&(q.confidencesByLabel={},de=q.confidences,Object.keys(de).forEach(function(De){var tt=_e.mapStringToIndex[De];q.confidencesByLabel[tt]=de[De]}))),Re.abrupt("return",q);case 10:case"end":return Re.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"clearLabel",value:function(E){var _;typeof E=="string"?this.mapStringToIndex.includes(E)&&(_=this.mapStringToIndex.indexOf(E)):typeof E=="number"&&(_=E),this.knnClassifier.clearClass(_)}},{key:"clearAllLabels",value:function(){this.mapStringToIndex=[],this.knnClassifier.clearAllClasses()}},{key:"getCountByLabel",value:function(){var E=this,_=this.knnClassifier.getClassExampleCount();if(this.mapStringToIndex.length>0){var k={};return Object.keys(_).forEach(function(D){if(E.mapStringToIndex[D]){var q=E.mapStringToIndex[D];k[q]=_[D]}}),k}return _}},{key:"getCount",value:function(){return this.knnClassifier.getClassExampleCount()}},{key:"getClassifierDataset",value:function(){return this.knnClassifier.getClassifierDataset()}},{key:"setClassifierDataset",value:function(E){this.knnClassifier.setClassifierDataset(E)}},{key:"getNumLabels",value:function(){return this.knnClassifier.getNumClasses()}},{key:"dispose",value:function(){this.knnClassifier.dispose()}},{key:"save",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee,de=this;return Ae.a.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:return D=this.knnClassifier.getClassifierDataset(),this.mapStringToIndex.length>0&&Object.keys(D).forEach(function(Re){de.mapStringToIndex[Re]&&(D[Re].label=de.mapStringToIndex[Re])}),q=Object.keys(D).map(function(Re){var De=D[Re];return De?De.dataSync():null}),ee="myKNN.json",k&&(ee=k.endsWith(".json")?k:"".concat(k,".json")),_e.next=7,ai(JSON.stringify({dataset:D,tensors:q}),ee,"application/octet-stream");case 7:case"end":return _e.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"load",value:function(){var E=J()(Ae.a.mark(function _(k,D){var q,ee,de,_e,Re;return Ae.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(Ce()(k)!=="object"){De.next=4;break}q=k,De.next=7;break;case 4:return De.next=6,qn(k);case 6:q=De.sent;case 7:q&&(de=(ee=q).dataset,_e=ee.tensors,this.mapStringToIndex=Object.keys(de).map(function(tt){return de[tt].label}),Re=_e.map(function(tt,st){if(tt){var It=Object.keys(tt).map(function(Bt){return tt[Bt]});return F.tensor(It,de[st].shape,de[st].dtype)}return null}).reduce(function(tt,st,It){return tt[It]=st,tt},{}),this.knnClassifier.setClassifierDataset(Re),D&&D());case 8:case"end":return De.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()}]),P}(),ko=function(){return new Di},Zr=function(){function P(E,_){pe()(this,P),this.videoElt=null,this.size=_,this.videoReady=!1,typeof HTMLVideoElement!="undefined"&&(E instanceof HTMLVideoElement?this.videoElt=E:E!==null&&Ce()(E)==="object"&&E.elt instanceof HTMLVideoElement&&(this.videoElt=E.elt))}return Fe()(P,[{key:"loadVideo",value:function(){var E=J()(Ae.a.mark(function _(){var k,D=this;return Ae.a.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.abrupt("return",new Promise(function(ee,de){D.videoElt||de(new Error("No video was passed to the constructor.")),D.video=document.createElement("video");var _e=navigator.userAgent;k=_e.indexOf("Firefox")>-1?D.videoElt.mozCaptureStream():D.videoElt.captureStream(),D.video.srcObject=k,D.size&&(D.video.width=D.size,D.video.height=D.size),D.video.autoplay=!0,D.video.playsinline=!0,D.video.muted=!0;var Re=D.video.play();Re!==void 0&&Re.then(function(){D.videoReady=!0,ee(D.video)})}));case 1:case"end":return q.stop()}},_)}));return function(){return E.apply(this,arguments)}}()}]),P}(),Wo=224,Oo=[Wo,Wo],So="https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v",To={version:1,alpha:.25,topk:3,learningRate:1e-4,hiddenUnits:100,epochs:20,numLabels:2,batchSize:.4,layer:"conv_pw_13_relu"},ds={1:{.25:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1",.5:"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",.75:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1",1:"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1"},2:{.5:"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",.75:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2",1:"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2"}},As={1:"module_apply_default/MobilenetV1/Logits/global_pool",2:"module_apply_default/MobilenetV2/Logits/AvgPool"},Cf=function(){function P(E,_){pe()(this,P),this.mobilenet=null,this.topKPredictions=10,this.hasAnyTrainedClass=!1,this.customModel=null,this.jointModel=null,this.config={epochs:E.epochs||To.epochs,version:E.version||To.version,hiddenUnits:E.hiddenUnits||To.hiddenUnits,numLabels:E.numLabels||To.numLabels,learningRate:E.learningRate||To.learningRate,batchSize:E.batchSize||To.batchSize,layer:E.layer||To.layer,alpha:E.alpha||To.alpha},this.model=null,this.url=ds[this.config.version][this.config.alpha],this.normalizationOffset=F.scalar(127.5),this.mobilenetURL=E.mobilenetURL||"".concat(So).concat(this.config.version,"_").concat(this.config.alpha,"_").concat(Wo,"/model.json"),this.graphModelURL=E.graphModelURL||this.url,this.isPredicting=!1,this.mapStringToIndex=[],this.usageType=null,this.ready=ft(this.loadModel(),_)}return Fe()(P,[{key:"loadModel",value:function(){var E=J()(Ae.a.mark(function _(){var k;return Ae.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.next=2,F.loadLayersModel(this.mobilenetURL);case 2:if(this.mobilenet=D.sent,!this.graphModelURL.includes("https://tfhub.dev/")){D.next=9;break}return D.next=6,F.loadGraphModel(this.graphModelURL,{fromTFHub:!0});case 6:this.model=D.sent,D.next=12;break;case 9:return D.next=11,F.loadGraphModel(this.graphModelURL,{fromTFHub:!1});case 11:this.model=D.sent;case 12:return k=this.mobilenet.getLayer(this.config.layer),D.next=15,F.model({inputs:this.mobilenet.inputs,outputs:k.output});case 15:if(this.mobilenetFeatures=D.sent,!this.video){D.next=19;break}return D.next=19,this.mobilenetFeatures.predict(or(this.video,Oo));case 19:return D.abrupt("return",this);case 20:case"end":return D.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()},{key:"classification",value:function(E){var _,k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,D=arguments.length>2?arguments[2]:void 0;return this.usageType="classifier",Ce()(k)==="object"?Object.assign(this.config,k):typeof k=="function"&&(_=k),typeof D=="function"&&(_=D),E&&ft(this.loadVideo(E),_),this}},{key:"regression",value:function(E,_){return this.usageType="regressor",E&&ft(this.loadVideo(E),_),this}},{key:"loadVideo",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q;return Ae.a.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:if(D=null,k instanceof HTMLVideoElement?D=k:Ce()(k)==="object"&&k.elt instanceof HTMLVideoElement&&(D=k.elt),!D){ee.next=7;break}return q=new Zr(D,Wo),ee.next=6,q.loadVideo();case 6:this.video=ee.sent;case 7:return ee.abrupt("return",this);case 8:case"end":return ee.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"addImage",value:function(){var E=J()(Ae.a.mark(function _(k,D,q){var ee,de,_e;return Ae.a.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return _e=q,k instanceof HTMLImageElement||k instanceof HTMLVideoElement||k instanceof HTMLCanvasElement||k.elt instanceof ImageData?ee=k:Ce()(k)==="object"&&(k.elt instanceof HTMLImageElement||k.elt instanceof HTMLVideoElement||k.elt instanceof HTMLCanvasElement||k.elt instanceof ImageData)?ee=k.elt:typeof k!="string"&&typeof k!="number"||(ee=this.video,de=k),typeof D=="string"||typeof D=="number"?de=D:typeof D=="function"&&(_e=D),typeof de=="string"&&(de=this.mapStringToIndex.includes(de)?this.mapStringToIndex.indexOf(de):this.mapStringToIndex.push(de)-1),Re.abrupt("return",ft(this.addImageInternal(ee,de),_e));case 5:case"end":return Re.stop()}},_,this)}));return function(_,k,D){return E.apply(this,arguments)}}()},{key:"addImageInternal",value:function(){var E=J()(Ae.a.mark(function _(k,D){var q=this;return Ae.a.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return ee.next=2,this.ready;case 2:return F.tidy(function(){var de,_e=or(k,Oo),Re=q.mobilenetFeatures.predict(_e);if(q.usageType==="classifier"?de=F.tidy(function(){return F.oneHot(F.tensor1d([D],"int32"),q.config.numLabels)}):q.usageType==="regressor"&&(de=F.tensor2d([[D]])),q.xs==null)q.xs=F.keep(Re),q.ys=F.keep(de),q.hasAnyTrainedClass=!0;else{var De=q.xs;q.xs=F.keep(De.concat(Re,0));var tt=q.ys;q.ys=F.keep(tt.concat(de,0)),De.dispose(),tt.dispose(),de.dispose()}}),ee.abrupt("return",this);case 4:case"end":return ee.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"train",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q;return Ae.a.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:if(this.hasAnyTrainedClass){ee.next=2;break}throw new Error("Add some examples before training!");case 2:if(this.isPredicting=!1,this.usageType==="classifier"?(this.loss="categoricalCrossentropy",this.customModel=F.sequential({layers:[F.layers.flatten({inputShape:[7,7,256]}),F.layers.dense({units:this.config.hiddenUnits,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),F.layers.dense({units:this.config.numLabels,kernelInitializer:"varianceScaling",useBias:!1,activation:"softmax"})]})):this.usageType==="regressor"&&(this.loss="meanSquaredError",this.customModel=F.sequential({layers:[F.layers.flatten({inputShape:[7,7,256]}),F.layers.dense({units:this.config.hiddenUnits,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),F.layers.dense({units:1,useBias:!1,kernelInitializer:"Zeros",activation:"linear"})]})),this.jointModel=F.sequential(),this.jointModel.add(this.mobilenetFeatures),this.jointModel.add(this.customModel),D=F.train.adam(this.config.learningRate),this.customModel.compile({optimizer:D,loss:this.loss}),(q=Math.floor(this.xs.shape[0]*this.config.batchSize))>0){ee.next=12;break}throw new Error("Batch size is 0 or NaN. Please choose a non-zero fraction.");case 12:return ee.abrupt("return",this.customModel.fit(this.xs,this.ys,{batchSize:q,epochs:this.config.epochs,callbacks:{onBatchEnd:function(){var de=J()(Ae.a.mark(function _e(Re,De){return Ae.a.wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:return k(De.loss.toFixed(5)),tt.next=3,F.nextFrame();case 3:case"end":return tt.stop()}},_e)}));return function(_e,Re){return de.apply(this,arguments)}}(),onTrainEnd:function(){return k(null)}}}));case 13:case"end":return ee.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=J()(Ae.a.mark(function _(k,D){var q,ee;return Ae.a.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:return k instanceof HTMLImageElement||k instanceof HTMLVideoElement||k instanceof HTMLCanvasElement||k instanceof ImageData?q=k:Ce()(k)==="object"&&(k.elt instanceof HTMLImageElement||k.elt instanceof HTMLVideoElement||k.elt instanceof HTMLCanvasElement||k.elt instanceof ImageData)?q=k.elt:typeof k=="function"&&(q=this.video,ee=k),typeof D=="function"&&(ee=D),de.abrupt("return",ft(this.classifyInternal(q),ee));case 3:case"end":return de.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee=this;return Ae.a.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:if(this.usageType==="classifier"){de.next=2;break}throw new Error("Mobilenet Feature Extraction has not been set to be a classifier.");case 2:return de.next=4,F.nextFrame();case 4:return this.isPredicting=!0,D=F.tidy(function(){var _e=or(k,Oo),Re=ee.jointModel.predict(_e);return Array.from(Re.as1D().dataSync())}),de.next=8,D.map(function(_e,Re){return{label:ee.mapStringToIndex.length>0&&ee.mapStringToIndex[Re]?ee.mapStringToIndex[Re]:Re,confidence:_e}}).sort(function(_e,Re){return Re.confidence-_e.confidence});case 8:return q=de.sent,de.abrupt("return",q);case 10:case"end":return de.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"predict",value:function(){var E=J()(Ae.a.mark(function _(k,D){var q,ee;return Ae.a.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:return k instanceof HTMLImageElement||k instanceof HTMLVideoElement||k instanceof HTMLCanvasElement||k instanceof ImageData?q=k:Ce()(k)==="object"&&(k.elt instanceof HTMLImageElement||k.elt instanceof HTMLVideoElement||k.elt instanceof HTMLCanvasElement||k.elt instanceof ImageData)?q=k.elt:typeof k=="function"&&(q=this.video,ee=k),typeof D=="function"&&(ee=D),de.abrupt("return",ft(this.predictInternal(q),ee));case 3:case"end":return de.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"predictInternal",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee=this;return Ae.a.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:if(this.usageType==="regressor"){de.next=2;break}throw new Error("Mobilenet Feature Extraction has not been set to be a regressor.");case 2:return de.next=4,F.nextFrame();case 4:return this.isPredicting=!0,D=F.tidy(function(){var _e=or(k,Oo);return ee.jointModel.predict(_e).as1D()}),de.next=8,D.data();case 8:return q=de.sent,D.dispose(),de.abrupt("return",{value:q[0]});case 11:case"end":return de.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"load",value:function(){var E=J()(Ae.a.mark(function _(){var k,D,q,ee,de,_e,Re=this,De=arguments;return Ae.a.wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:if(k=De.length>0&&De[0]!==void 0?De[0]:null,D=De.length>1?De[1]:void 0,typeof k=="string"){tt.next=11;break}return q=null,ee=null,Array.from(k).forEach(function(st){if(st.name.includes(".json")){q=st;var It=new FileReader;It.onload=function(Bt){JSON.parse(Bt.target.result).ml5Specs&&(Re.mapStringToIndex=JSON.parse(Bt.target.result).ml5Specs.mapStringToIndex)},It.readAsText(st)}else st.name.includes(".bin")&&(ee=st)}),tt.next=8,F.loadLayersModel(F.io.browserFiles([q,ee]));case 8:this.jointModel=tt.sent,tt.next=20;break;case 11:return tt.next=13,en.a.get(k);case 13:return de=tt.sent,(_e=de.data).ml5Specs&&(this.mapStringToIndex=_e.ml5Specs.mapStringToIndex),tt.next=18,F.loadLayersModel(k);case 18:this.jointModel=tt.sent,D&&D();case 20:return tt.abrupt("return",this.jointModel);case 21:case"end":return tt.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()},{key:"save",value:function(){var E=J()(Ae.a.mark(function _(k,D){var q=this;return Ae.a.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:if(this.jointModel){ee.next=2;break}throw new Error("No model found.");case 2:this.jointModel.save(F.io.withSaveHandler(function(){var de=J()(Ae.a.mark(function _e(Re){var De;return Ae.a.wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:return De="model",D&&(De=D),q.weightsManifest={modelTopology:Re.modelTopology,weightsManifest:[{paths:["./".concat(De,".weights.bin")],weights:Re.weightSpecs}],ml5Specs:{mapStringToIndex:q.mapStringToIndex}},tt.next=5,ai(Re.weightData,"".concat(De,".weights.bin"),"application/octet-stream");case 5:return tt.next=7,ai(JSON.stringify(q.weightsManifest),"".concat(De,".json"),"text/plain");case 7:k&&k();case 8:case"end":return tt.stop()}},_e)}));return function(_e){return de.apply(this,arguments)}}()));case 3:case"end":return ee.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"mobilenetInfer",value:function(E){var _=this,k=arguments.length>1&&arguments[1]!==void 0&&arguments[1],D=E;return D instanceof F.Tensor||D instanceof ImageData||D instanceof HTMLImageElement||D instanceof HTMLCanvasElement||D instanceof HTMLVideoElement?F.tidy(function(){D instanceof F.Tensor||(D=F.browser.fromPixels(D));var q=D.toFloat().sub(_.normalizationOffset).div(_.normalizationOffset),ee=q;(D.shape[0]!==Wo||D.shape[1]!==Wo)&&(ee=F.image.resizeBilinear(q,Oo,!0));var de,_e=ee.reshape([-1,Wo,Wo,3]);if(k){var Re=As[_.config.version];de=_.model.execute(_e,Re).squeeze([1,2])}else de=_.model.predict(_e).slice([0,1],[-1,1e3]);return de}):null}},{key:"infer",value:function(E,_){var k,D;if(E instanceof HTMLImageElement||E instanceof HTMLVideoElement||E instanceof HTMLCanvasElement||E instanceof ImageData)k=E;else{if(Ce()(E)!=="object"||!(E.elt instanceof HTMLImageElement||E.elt instanceof HTMLVideoElement||E.elt instanceof HTMLCanvasElement||E.elt instanceof ImageData))throw new Error("No input image found.");k=E.elt}return D=_&&typeof _=="string"?_:"conv_preds",this.mobilenetInfer(k,D)}}]),P}(),eo=function(P,E,_){var k;if(typeof P!="string")throw new Error('Please specify a model to use. E.g: "MobileNet"');k=P.toLowerCase();var D={},q=_;if(Ce()(E)==="object"?D=E:typeof E=="function"&&(q=E),k==="mobilenet")return new Cf(D,q);throw new Error("".concat(k," is not a valid model."))},bu=function(){console.log("%cword2vec has been disabled","color: #A155FF; font-size: 16px"),console.log("We've intentionally disabled the word2vec function after recognizing it has the potential to produce harmful outputs while using the model files included in our examples. We'll consider reenabling the word2vec function along with changes to address these issues in a future release of ml5.js. You can find further updates about this topic on our Twitter account (https://twitter.com/ml5js/status/1445762321444315147) and GitHub (https://github.com/ml5js/ml5-library/issues/1238).")},wc=o(58),kc=o.n(wc),_c=o(57),ws=o.n(_c),Ql=o(35),Hs=o.n(Ql),Mc=["person","bicycle","car","motorbike","aeroplane","bus","train","truck","boat","traffic light","fire hydrant","stop sign","parking meter","bench","bird","cat","dog","horse","sheep","cow","elephant","bear","zebra","giraffe","backpack","umbrella","handbag","tie","suitcase","frisbee","skis","snowboard","sports ball","kite","baseball bat","baseball glove","skateboard","surfboard","tennis racket","bottle","wine glass","cup","fork","knife","spoon","bowl","banana","apple","sandwich","orange","broccoli","carrot","hot dog","pizza","donut","cake","chair","sofa","pottedplant","bed","diningtable","toilet","tvmonitor","laptop","mouse","remote","keyboard","cell phone","microwave","oven","toaster","sink","refrigerator","book","clock","vase","scissors","teddy bear","hair drier","toothbrush"];function Af(P){return new RegExp("^(?:[a-z]+:)?//","i").test(P)}var Gs={isAbsoluteURL:Af,getModelPath:function(P){return Af(P)||typeof window=="undefined"?P:window.location.pathname+P}},Zl=function(P,E){var _=Math.min(P[3],E[3])-Math.max(P[1],E[1]),k=Math.min(P[2],E[2])-Math.max(P[0],E[0]);return _<0||k<0?0:_*k},pl=function(P,E){return Zl(P,E)/function(_,k){var D=Zl(_,k);return(_[3]-_[1])*(_[2]-_[0])+(k[3]-k[1])*(k[2]-k[0])-D}(P,E)};function ml(P,E,_,k){return Gc.apply(this,arguments)}function Gc(){return(Gc=J()(Ae.a.mark(function P(E,_,k,D){return Ae.a.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.abrupt("return",F.tidy(function(){for(var ee=F.mul(_,k),de=F.argMax(ee,-1),_e=F.max(ee,-1),Re=F.greaterEqual(_e,F.scalar(D)).dataSync(),De=[],tt=0;tt<Re.length;tt+=1)Re[tt]&&De.push(tt);if(De.length===0)return[null,null,null];var st=F.tensor1d(De,"int32");return[F.gather(E.reshape([Re.length,4]),st),F.gather(_e.flatten(),st),F.gather(de.flatten(),st)]}));case 1:case"end":return q.stop()}},P)}))).apply(this,arguments)}var ha=function(P,E){return F.tidy(function(){var _=F.tensor1d([2]),k=F.sub(P,F.div(E,_)),D=F.add(P,F.div(E,_)),q=[k.shape[0],k.shape[1],k.shape[2],1];return F.concat([k.slice([0,0,0,1],q),k.slice([0,0,0,0],q),D.slice([0,0,0,1],q),D.slice([0,0,0,0],q)],3)})},$c=function(P,E,_){return F.tidy(function(){for(var k=[],D=0;D<E.length;D+=1)k.push([E[D],[P[4*D],P[4*D+1],P[4*D+2],P[4*D+3]],D]);var q=[];return k.sort(function(ee,de){return de[0]-ee[0]}).forEach(function(ee){for(var de=!0,_e=0;_e<q.length;_e+=1)if(pl(ee[1],q[_e][1])>_){de=!1;break}de&&q.push(ee)}),[q.map(function(ee){return ee[2]}),q.map(function(ee){return ee[1]}),q.map(function(ee){return ee[0]})]})};function Ga(P,E,_){return F.tidy(function(){var k=E.shape[0],D=F.reshape(E,[1,1,k,2]),q=P.shape.slice(1,3),ee=q[0],de=q[1],_e=F.range(0,q[0]),Re=F.range(0,q[1]);_e=F.tile(_e,[q[1]]),Re=F.tile(F.expandDims(Re,0),[q[0],1]),Re=F.transpose(Re).flatten();var De=F.transpose(F.stack([_e,Re]));De=F.reshape(De,[q[0],q[1],1,2]),De=F.cast(De,P.dtype),P=F.reshape(P,[q[0],q[1],k,_+5]),q=F.cast(F.reshape(F.tensor1d(q),[1,1,1,2]),P.dtype);var tt=F.sigmoid(P.slice([0,0,0,0],[ee,de,k,2])),st=F.exp(P.slice([0,0,0,2],[ee,de,k,2])),It=F.sigmoid(P.slice([0,0,0,4],[ee,de,k,1])),Bt=F.softmax(P.slice([0,0,0,5],[ee,de,k,_]));return[tt=F.div(F.add(tt,De),q),st=F.div(F.mul(st,D),q),It,Bt]})}function Kc(P){var E=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var _,k=Hs()(P);if(E){var D=Hs()(this).constructor;_=Reflect.construct(k,arguments,D)}else _=k.apply(this,arguments);return ws()(this,_)}}var Is={modelUrl:"https://raw.githubusercontent.com/ml5js/ml5-data-and-training/master/models/YOLO/model.json",filterBoxesThreshold:.01,IOUThreshold:.4,classProbThreshold:.4},Ba=416,jc=function(P){kc()(_,P);var E=Kc(_);function _(k,D,q){var ee;return pe()(this,_),(ee=E.call(this,k,Ba)).modelUrl=D.modelUrl||Is.modelUrl,ee.filterBoxesThreshold=D.filterBoxesThreshold||Is.filterBoxesThreshold,ee.IOUThreshold=D.IOUThreshold||Is.IOUThreshold,ee.classProbThreshold=D.classProbThreshold||Is.classProbThreshold,ee.modelReady=!1,ee.isPredicting=!1,ee.callback=q,ee.ready=ft(ee.loadModel(),ee.callback),D.disableDeprecationNotice||console.warn("WARNING! Function YOLO has been deprecated, please use the new ObjectDetector function instead"),ee}return Fe()(_,[{key:"loadModel",value:function(){var k=J()(Ae.a.mark(function D(){var q;return Ae.a.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:if(!this.videoElt||this.video){ee.next=4;break}return ee.next=3,this.loadVideo();case 3:this.video=ee.sent;case 4:if(Gs.isAbsoluteURL(this.modelUrl)!==!0){ee.next=10;break}return ee.next=7,F.loadLayersModel(this.modelUrl);case 7:this.model=ee.sent,ee.next=15;break;case 10:return q=Gs.getModelPath(this.modelUrl),this.modelUrl="".concat(q,"/model.json"),ee.next=14,F.loadLayersModel(this.modelUrl);case 14:this.model=ee.sent;case 15:return this.modelReady=!0,ee.abrupt("return",this);case 17:case"end":return ee.stop()}},D,this)}));return function(){return k.apply(this,arguments)}}()},{key:"detect",value:function(){var k=J()(Ae.a.mark(function D(q,ee){var de,_e;return Ae.a.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return Re.next=2,this.ready;case 2:if(_e=ee,!jn(q)){Re.next=7;break}de=q,Re.next=21;break;case 7:if(Ce()(q)!=="object"||!jn(q.elt)){Re.next=11;break}de=q.elt,Re.next=21;break;case 11:if(Ce()(q)!=="object"||!jn(q.canvas)){Re.next=15;break}de=q.canvas,Re.next=21;break;case 15:if(typeof q!="function"){Re.next=20;break}de=this.video,_e=q,Re.next=21;break;case 20:throw new Error("Detection subject not supported");case 21:return Re.abrupt("return",ft(this.detectInternal(de),_e));case 22:case"end":return Re.stop()}},D,this)}));return function(D,q){return k.apply(this,arguments)}}()},{key:"detectInternal",value:function(){var k=J()(Ae.a.mark(function D(q){var ee,de,_e,Re,De,tt,st,It,Bt,mn,xn,Fn=this;return Ae.a.wrap(function(Rn){for(;;)switch(Rn.prev=Rn.next){case 0:return Rn.next=2,this.ready;case 2:return Rn.next=4,F.nextFrame();case 4:return ee=F.tensor2d([[.57273,.677385],[1.87446,2.06253],[3.33843,5.47434],[7.88282,3.52778],[9.77052,9.16828]]),this.isPredicting=!0,de=F.tidy(function(){var Ln=or(q,[Ba,Ba]),Zn=Ga(Fn.model.predict(Ln),ee,80),An=zn()(Zn,4),Sr=An[0],Ur=An[1],Wr=An[2],ci=An[3];return[ha(Sr,Ur),Wr,ci]}),_e=zn()(de,3),Re=_e[0],De=_e[1],tt=_e[2],Rn.next=9,ml(Re,De,tt,this.filterBoxesThreshold);case 9:if(st=Rn.sent,It=zn()(st,3),Bt=It[0],mn=It[1],xn=It[2],Re.dispose(),De.dispose(),tt.dispose(),Bt!=null){Rn.next=19;break}return Rn.abrupt("return",[]);case 19:return Rn.abrupt("return",F.tidy(function(){var Ln=F.scalar(Ba),Zn=F.scalar(Ba),An=F.stack([Zn,Ln,Zn,Ln]).reshape([1,4]),Sr=F.mul(Bt,An),Ur=Sr.dataSync(),Wr=mn.dataSync(),ci=$c(Ur,Wr,Fn.IOUThreshold),Jr=zn()(ci,3),Xi=Jr[0],lo=Jr[1],io=Jr[2],ga=[];return xn.gather(F.tensor1d(Xi,"int32")).dataSync().forEach(function(Ya,Ta){var Aa=io[Ta];if(!(Aa<Fn.classProbThreshold)){var Ma=Mc[Ya],rs=zn()(lo[Ta],4),va=rs[0],Ns=rs[1],Tc=rs[2],Ji=rs[3];va=Math.max(0,va),Ns=Math.max(0,Ns),Tc=Math.min(Ba,Tc)-va;var Hi={label:Ma,confidence:Aa,x:Ns,y:va,width:Ji=Math.min(Ba,Ji)-Ns,height:Tc,normalized:{x:Ns/Ba,y:va/Ba,width:Ji/Ba,height:Tc/Ba}};ga.push(Hi)}}),Fn.isPredicting=!1,Ln.dispose(),Zn.dispose(),An.dispose(),Sr.dispose(),Bt.dispose(),mn.dispose(),xn.dispose(),ee.dispose(),ga}));case 20:case"end":return Rn.stop()}},D,this)}));return function(D){return k.apply(this,arguments)}}()}]),_}(Zr),ac=function(P,E,_){var k=null,D={},q=_;return P instanceof HTMLVideoElement?k=P:Ce()(P)==="object"&&P.elt instanceof HTMLVideoElement?k=P.elt:typeof P=="function"?q=P:Ce()(P)==="object"&&(D=P),Ce()(E)==="object"?D=E:typeof E=="function"&&(q=E),new jc(k,D,q)},Xc=o(242),eu={base:"lite_mobilenet_v2",modelUrl:void 0},ps=function(){function P(E,_,k){pe()(this,P),this.video=E||null,this.modelReady=!1,this.isPredicting=!1,this.config={base:_.base||eu.base,modelUrl:_.modelUrl||eu.modelUrl},this.callback=k,this.ready=ft(this.loadModel(),this.callback)}return Fe()(P,[{key:"loadModel",value:function(){var E=J()(Ae.a.mark(function _(){return Ae.a.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.next=2,Xc.load(this.config);case 2:return this.model=k.sent,this.modelReady=!0,k.abrupt("return",this);case 5:case"end":return k.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()},{key:"detectInternal",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q;return Ae.a.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return this.isPredicting=!0,ee.next=3,this.model.detect(k);case 3:return D=ee.sent,q=D.map(function(de){return{label:de.class,confidence:de.score,x:de.bbox[0],y:de.bbox[1],width:de.bbox[2],height:de.bbox[3],normalized:{x:de.bbox[0]/k.width,y:de.bbox[1]/k.height,width:de.bbox[2]/k.width,height:de.bbox[3]/k.height}}}),this.isPredicting=!1,ee.abrupt("return",q);case 7:case"end":return ee.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"detect",value:function(){var E=J()(Ae.a.mark(function _(k,D){var q,ee;return Ae.a.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:return de.next=2,this.ready;case 2:return de.next=4,F.nextFrame();case 4:if(ee=D,!jn(k)){de.next=9;break}q=k,de.next=23;break;case 9:if(Ce()(k)!=="object"||!jn(k.elt)){de.next=13;break}q=k.elt,de.next=23;break;case 13:if(Ce()(k)!=="object"||!jn(k.canvas)){de.next=17;break}q=k.canvas,de.next=23;break;case 17:if(typeof k!="function"){de.next=22;break}q=this.video,ee=k,de.next=23;break;case 22:throw new Error("Detection subject not supported");case 23:return de.abrupt("return",ft(this.detectInternal(q),ee));case 24:case"end":return de.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()}]),P}(),ef=function(P,E,_){var k=null,D={},q=_;return P instanceof HTMLVideoElement?k=P:Ce()(P)==="object"&&P.elt instanceof HTMLVideoElement?k=P.elt:typeof P=="function"?q=P:Ce()(P)==="object"&&(D=P),Ce()(E)==="object"?D=E:typeof E=="function"&&(q=E),new ps(k,D,q)};function Yc(P,E){var _=Object.keys(P);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(P);E&&(k=k.filter(function(D){return Object.getOwnPropertyDescriptor(P,D).enumerable})),_.push.apply(_,k)}return _}var na=Fe()(function P(E,_,k,D){switch(pe()(this,P),this.video=_,this.modelNameOrUrl=E,this.options=k||{},this.callback=D,E){case"yolo":return this.model=new ac(this.video,function(q){for(var ee=1;ee<arguments.length;ee++){var de=arguments[ee]!=null?arguments[ee]:{};ee%2?Yc(Object(de),!0).forEach(function(_e){te()(q,_e,de[_e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(de)):Yc(Object(de)).forEach(function(_e){Object.defineProperty(q,_e,Object.getOwnPropertyDescriptor(de,_e))})}return q}({disableDeprecationNotice:!0},this.options),D),this;case"cocossd":default:return this.model=new ef(this.video,this.options,D),this}}),Xf=function(P,E,_,k){var D,q={},ee=k,de=P;if(typeof de!="string")throw new Error('Please specify a model to use. E.g: "YOLO"');de.indexOf("http")===-1&&(de=P.toLowerCase()),E instanceof HTMLVideoElement?D=E:Ce()(E)==="object"&&E.elt instanceof HTMLVideoElement?D=E.elt:Ce()(E)==="object"?q=E:typeof E=="function"&&(ee=E),Ce()(_)==="object"?q=_:typeof _=="function"&&(ee=_);var _e=new na(de,D,q,ee);return _e.model.callback?_e.model:_e.model.ready},Jc=o(99),Of=o.n(Jc),da=function(P,E){return(da=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,k){_.__proto__=k}||function(_,k){for(var D in k)k.hasOwnProperty(D)&&(_[D]=k[D])})(P,E)};function Qi(P,E){function _(){this.constructor=P}da(P,E),P.prototype=E===null?Object.create(E):(_.prototype=E.prototype,new _)}var xi=function(){return(xi=Object.assign||function(P){for(var E,_=1,k=arguments.length;_<k;_++)for(var D in E=arguments[_])Object.prototype.hasOwnProperty.call(E,D)&&(P[D]=E[D]);return P}).apply(this,arguments)};function hr(P,E,_,k){return new(_||(_=Promise))(function(D,q){function ee(Re){try{_e(k.next(Re))}catch(De){q(De)}}function de(Re){try{_e(k.throw(Re))}catch(De){q(De)}}function _e(Re){Re.done?D(Re.value):new _(function(De){De(Re.value)}).then(ee,de)}_e((k=k.apply(P,E||[])).next())})}function is(P,E){var _,k,D,q,ee={label:0,sent:function(){if(1&D[0])throw D[1];return D[1]},trys:[],ops:[]};return q={next:de(0),throw:de(1),return:de(2)},typeof Symbol=="function"&&(q[Symbol.iterator]=function(){return this}),q;function de(_e){return function(Re){return function(De){if(_)throw new TypeError("Generator is already executing.");for(;ee;)try{if(_=1,k&&(D=2&De[0]?k.return:De[0]?k.throw||((D=k.return)&&D.call(k),0):k.next)&&!(D=D.call(k,De[1])).done)return D;switch(k=0,D&&(De=[2&De[0],D.value]),De[0]){case 0:case 1:D=De;break;case 4:return ee.label++,{value:De[1],done:!1};case 5:ee.label++,k=De[1],De=[0];continue;case 7:De=ee.ops.pop(),ee.trys.pop();continue;default:if(!(D=(D=ee.trys).length>0&&D[D.length-1])&&(De[0]===6||De[0]===2)){ee=0;continue}if(De[0]===3&&(!D||De[1]>D[0]&&De[1]<D[3])){ee.label=De[1];break}if(De[0]===6&&ee.label<D[1]){ee.label=D[1],D=De;break}if(D&&ee.label<D[2]){ee.label=D[2],ee.ops.push(De);break}D[2]&&ee.ops.pop(),ee.trys.pop();continue}De=E.call(P,ee)}catch(tt){De=[6,tt],k=0}finally{_=D=0}if(5&De[0])throw De[1];return{value:De[0]?De[1]:void 0,done:!0}}([_e,Re])}}}var Nh=function(){function P(E,_){this.model=E,this.outputStride=_;var k=this.model.inputs[0].shape;Qe.util.assert(k[1]===-1&&k[2]===-1,function(){return"Input shape ["+k[1]+", "+k[2]+"] must both be equal to or -1"})}return P.prototype.predict=function(E){var _=this;return Object(Qe.tidy)(function(){var k=_.preprocessInput(Object(Qe.cast)(E,"float32")),D=Object(Qe.expandDims)(k,0),q=_.model.predict(D).map(function(de){return Object(Qe.squeeze)(de,[0])}),ee=_.nameOutputResults(q);return{heatmapScores:Object(Qe.sigmoid)(ee.heatmap),offsets:ee.offsets,displacementFwd:ee.displacementFwd,displacementBwd:ee.displacementBwd}})},P.prototype.dispose=function(){this.model.dispose()},P}(),No=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Qi(E,P),E.prototype.preprocessInput=function(_){return Object(Qe.tidy)(function(){return Object(Qe.sub)(Object(Qe.div)(_,127.5),1)})},E.prototype.nameOutputResults=function(_){return{offsets:_[0],heatmap:_[1],displacementFwd:_[2],displacementBwd:_[3]}},E}(Nh);function Qc(P){return Math.floor(P/2)}var Yf=function(){function P(E,_){this.priorityQueue=new Array(E),this.numberOfElements=-1,this.getElementValue=_}return P.prototype.enqueue=function(E){this.priorityQueue[++this.numberOfElements]=E,this.swim(this.numberOfElements)},P.prototype.dequeue=function(){var E=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,E},P.prototype.empty=function(){return this.numberOfElements===-1},P.prototype.size=function(){return this.numberOfElements+1},P.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},P.prototype.max=function(){return this.priorityQueue[0]},P.prototype.swim=function(E){for(;E>0&&this.less(Qc(E),E);)this.exchange(E,Qc(E)),E=Qc(E)},P.prototype.sink=function(E){for(;2*E<=this.numberOfElements;){var _=2*E;if(_<this.numberOfElements&&this.less(_,_+1)&&_++,!this.less(E,_))break;this.exchange(E,_),E=_}},P.prototype.getValueAt=function(E){return this.getElementValue(this.priorityQueue[E])},P.prototype.less=function(E,_){return this.getValueAt(E)<this.getValueAt(_)},P.prototype.exchange=function(E,_){var k=this.priorityQueue[E];this.priorityQueue[E]=this.priorityQueue[_],this.priorityQueue[_]=k},P}();function zp(P,E,_,k,D,q){for(var ee=q.shape,de=ee[0],_e=ee[1],Re=!0,De=Math.max(_-D,0),tt=Math.min(_+D+1,de),st=De;st<tt;++st){for(var It=Math.max(k-D,0),Bt=Math.min(k+D+1,_e),mn=It;mn<Bt;++mn)if(q.get(st,mn,P)>E){Re=!1;break}if(!Re)break}return Re}var tu=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],Ih=tu.length,so=tu.reduce(function(P,E,_){return P[E]=_,P},{}),Oa=[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map(function(P){var E=P[0],_=P[1];return[so[E],so[_]]});function Fh(P,E,_,k){return{y:k.get(P,E,_),x:k.get(P,E,_+Ih)}}function Zc(P,E,_){var k=Fh(P.heatmapY,P.heatmapX,P.id,_),D=k.y,q=k.x;return{x:P.heatmapX*E+q,y:P.heatmapY*E+D}}function Rh(P,E,_){return P<E?E:P>_?_:P}function Xd(P,E){return{x:P.x+E.x,y:P.y+E.y}}var Tu=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]].map(function(P){var E=P[0],_=P[1];return[so[E],so[_]]}),Tl=Tu.map(function(P){return P[1]}),Yd=Tu.map(function(P){return P[0]});function Up(P,E,_,k){return{y:Rh(Math.round(P.y/E),0,_-1),x:Rh(Math.round(P.x/E),0,k-1)}}function Ec(P,E,_,k,D,q,ee,de){de===void 0&&(de=2);for(var _e=k.shape,Re=_e[0],De=_e[1],tt=function(Rn,Ln,Zn){var An=Zn.shape[2]/2;return{y:Zn.get(Ln.y,Ln.x,Rn),x:Zn.get(Ln.y,Ln.x,An+Rn)}}(P,Up(E.position,q,Re,De),ee),st=Xd(E.position,tt),It=0;It<de;It++){var Bt=Up(st,q,Re,De),mn=Fh(Bt.y,Bt.x,_,D);st=Xd({x:Bt.x*q,y:Bt.y*q},{x:mn.x,y:mn.y})}var xn=Up(st,q,Re,De),Fn=k.get(xn.y,xn.x,_);return{position:st,part:tu[_],score:Fn}}function Sg(P,E,_,k,D,q){var ee=E.shape[2],de=Tl.length,_e=new Array(ee),Re=P.part,De=P.score,tt=Zc(Re,k,_);_e[Re.id]={score:De,part:tu[Re.id],position:tt};for(var st=de-1;st>=0;--st){var It=Tl[st],Bt=Yd[st];_e[It]&&!_e[Bt]&&(_e[Bt]=Ec(st,_e[It],Bt,E,_,k,q))}for(st=0;st<de;++st)It=Yd[st],Bt=Tl[st],_e[It]&&!_e[Bt]&&(_e[Bt]=Ec(st,_e[It],Bt,E,_,k,D));return _e}function el(P,E,_,k){var D=_.x,q=_.y;return P.some(function(ee){var de=ee.keypoints[k].position;return function(_e,Re,De,tt){var st=De-_e,It=tt-Re;return st*st+It*It}(q,D,de.y,de.x)<=E})}function Jf(P,E,_){return _.reduce(function(k,D,q){var ee=D.position,de=D.score;return el(P,E,ee,q)||(k+=de),k},0)/_.length}var $s=1;function gl(P,E,_,k,D,q,ee,de){ee===void 0&&(ee=.5),de===void 0&&(de=20);for(var _e=[],Re=function(Bt,mn,xn){for(var Fn=xn.shape,Rn=Fn[0],Ln=Fn[1],Zn=Fn[2],An=new Yf(Rn*Ln*Zn,function(Jr){return Jr.score}),Sr=0;Sr<Rn;++Sr)for(var Ur=0;Ur<Ln;++Ur)for(var Wr=0;Wr<Zn;++Wr){var ci=xn.get(Sr,Ur,Wr);ci<Bt||zp(Wr,ci,Sr,Ur,mn,xn)&&An.enqueue({score:ci,part:{heatmapY:Sr,heatmapX:Ur,id:Wr}})}return An}(ee,$s,P),De=de*de;_e.length<q&&!Re.empty();){var tt=Re.dequeue();if(!el(_e,De,Zc(tt.part,D,E),tt.part.id)){var st=Sg(tt,P,E,D,_,k),It=Jf(_e,De,st);_e.push({keypoints:st,score:It})}}return _e}function Ze(P){var E=P.shape,_=E[0],k=E[1],D=E[2];return Object(Qe.tidy)(function(){var q=Object(Qe.reshape)(P,[_*k,D]),ee=Object(Qe.argMax)(q,0),de=Object(Qe.expandDims)(Object(Qe.div)(ee,Object(Qe.scalar)(k,"int32")),1),_e=Object(Qe.expandDims)(function(Re,De){return Object(Qe.tidy)(function(){var tt=Object(Qe.div)(Re,Object(Qe.scalar)(De,"int32"));return Object(Qe.sub)(Re,Object(Qe.mul)(tt,Object(Qe.scalar)(De,"int32")))})}(ee,k),1);return Object(Qe.concat)([de,_e],1)})}function tl(P,E,_,k){return{y:k.get(P,E,_),x:k.get(P,E,_+Ih)}}function es(P,E,_){return Object(Qe.tidy)(function(){var k=function(D,q){for(var ee=[],de=0;de<Ih;de++){var _e=tl(D.get(de,0).valueOf(),D.get(de,1).valueOf(),de,q),Re=_e.x,De=_e.y;ee.push(De),ee.push(Re)}return Object(Qe.tensor2d)(ee,[Ih,2])}(P,_);return Object(Qe.add)(Object(Qe.cast)(Object(Qe.mul)(P.toTensor(),Object(Qe.scalar)(E,"int32")),"float32"),k)})}function Nl(P,E,_){return hr(this,void 0,void 0,function(){var k,D,q,ee,de,_e,Re,De,tt,st;return is(this,function(It){switch(It.label){case 0:return k=0,D=Ze(P),[4,Promise.all([P.buffer(),E.buffer(),D.buffer()])];case 1:return q=It.sent(),ee=q[0],de=q[1],_e=q[2],[4,(Re=es(_e,_,de)).buffer()];case 2:return De=It.sent(),tt=Array.from(function(Bt,mn){for(var xn=mn.shape[0],Fn=new Float32Array(xn),Rn=0;Rn<xn;Rn++){var Ln=mn.get(Rn,0),Zn=mn.get(Rn,1);Fn[Rn]=Bt.get(Ln,Zn,Rn)}return Fn}(ee,_e)),st=tt.map(function(Bt,mn){return k+=Bt,{position:{y:De.get(mn,0),x:De.get(mn,1)},part:tu[mn],score:Bt}}),D.dispose(),Re.dispose(),[2,{keypoints:st,score:k/st.length}]}})})}var pa="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",Ea="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/",La=[-123.15,-115.9,-103.06],Fs=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Qi(E,P),E.prototype.preprocessInput=function(_){return Object(Qe.add)(_,La)},E.prototype.nameOutputResults=function(_){var k=_[0],D=_[1];return{offsets:_[2],heatmap:_[3],displacementFwd:k,displacementBwd:D}},E}(Nh);function vl(P,E){return Tt(P,E)?P:Math.floor(P/E)*E+1}function Rs(P){Qe.util.assert(typeof P=="number"||typeof P=="object",function(){return"Invalid inputResolution "+P+". Should be a number or an object with width and height"}),typeof P=="object"&&(Qe.util.assert(typeof P.width=="number",function(){return"inputResolution.width has a value of "+P.width+" which is invalid; it must be a number"}),Qe.util.assert(typeof P.height=="number",function(){return"inputResolution.height has a value of "+P.height+" which is invalid; it must be a number"}))}function tf(P,E){return Rs(P),typeof P=="object"?[vl(P.height,E),vl(P.width,E)]:[vl(P,E),vl(P,E)]}var Ku=[8,16,32];function Tt(P,E){return(P-1)%E==0}function aa(P){return P instanceof Qe.Tensor?[P.shape[0],P.shape[1]]:[P.height,P.width]}function ms(P,E){var _=E[0],k=E[1],D=aa(P),q=D[0],ee=D[1],de=k/_,_e=[0,0,0,0],Re=_e[0],De=_e[1],tt=_e[2],st=_e[3];return ee/q<de?(Re=0,De=0,tt=Math.round(.5*(de*q-ee)),st=Math.round(.5*(de*q-ee))):(Re=Math.round(.5*(1/de*ee-q)),De=Math.round(.5*(1/de*ee-q)),tt=0,st=0),{resized:Object(Qe.tidy)(function(){var It=function(Bt){return Bt instanceof Qe.Tensor?Bt:Qe.browser.fromPixels(Bt)}(P);return It=Object(Qe.pad3d)(It,[[Re,De],[tt,st],[0,0]]),Qe.image.resizeBilinear(It,[_,k])}),padding:{top:Re,left:tt,right:st,bottom:De}}}function Ks(P,E,_,k,D){var q=E[0],ee=E[1],de=_[0],_e=_[1],Re=function(De,tt,st,It,Bt){return It===void 0&&(It=0),Bt===void 0&&(Bt=0),st===1&&tt===1&&It===0&&Bt===0?De:De.map(function(mn){return function(xn,Fn,Rn,Ln,Zn){return Ln===void 0&&(Ln=0),Zn===void 0&&(Zn=0),{score:xn.score,keypoints:xn.keypoints.map(function(An){var Sr=An.score,Ur=An.part,Wr=An.position;return{score:Sr,part:Ur,position:{x:Wr.x*Rn+Zn,y:Wr.y*Fn+Ln}}})}}(mn,tt,st,It,Bt)})}(P,(q+k.top+k.bottom)/de,(ee+k.left+k.right)/_e,-k.top,-k.left);return D?function(De,tt){return tt<=0?De:De.map(function(st){return function(It,Bt){return{score:It.score,keypoints:It.keypoints.map(function(mn){var xn=mn.score,Fn=mn.part,Rn=mn.position;return{score:xn,part:Fn,position:{x:Bt-1-Rn.x,y:Rn.y}}})}}(st,tt)})}(Re,ee):Re}var la={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:257},xu=["MobileNetV1","ResNet50"],Mr={MobileNetV1:[8,16,32],ResNet50:[32,16]},Cc={MobileNetV1:[.5,.75,1],ResNet50:[1]},sc=[1,2,4],nf={flipHorizontal:!1},Ac={flipHorizontal:!1,maxDetections:5,scoreThreshold:.5,nmsRadius:20},yd=function(){function P(E,_){(function(k){Qe.util.assert(typeof k=="number",function(){return"outputStride is not a number"}),Qe.util.assert(Ku.indexOf(k)>=0,function(){return"outputStride of "+k+" is invalid. It must be either 8, 16, or 32"})})(E.outputStride),function(k,D){Qe.util.assert(typeof k[0]=="number"&&typeof k[1]=="number",function(){return"both resolution values must be a number but had values "+k}),Qe.util.assert(Tt(k[0],D),function(){return"height of "+k[0]+" is invalid for output stride "+D+"."}),Qe.util.assert(Tt(k[1],D),function(){return"width of "+k[1]+" is invalid for output stride "+D+"."})}(_,E.outputStride),this.baseModel=E,this.inputResolution=_}return P.prototype.estimateMultiplePoses=function(E,_){return _===void 0&&(_=Ac),hr(this,void 0,void 0,function(){var k,D,q,ee,de,_e,Re,De,tt,st,It,Bt,mn,xn,Fn,Rn,Ln,Zn,An,Sr,Ur;return is(this,function(Wr){switch(Wr.label){case 0:return k=xi({},Ac,_),function(ci){var Jr=ci.maxDetections,Xi=ci.scoreThreshold,lo=ci.nmsRadius;if(Jr<=0)throw new Error("Invalid maxDetections "+Jr+". Should be > 0");if(Xi<0||Xi>1)throw new Error("Invalid scoreThreshold "+Xi+". Should be in range [0.0, 1.0]");if(lo<=0)throw new Error("Invalid nmsRadius "+lo+".")}(_),D=this.baseModel.outputStride,q=this.inputResolution,ee=aa(E),de=ee[0],_e=ee[1],Re=ms(E,q),De=Re.resized,tt=Re.padding,st=this.baseModel.predict(De),It=st.heatmapScores,Bt=st.offsets,mn=st.displacementFwd,xn=st.displacementBwd,[4,function(ci){return hr(this,void 0,void 0,function(){return is(this,function(Jr){return[2,Promise.all(ci.map(function(Xi){return Xi.buffer()}))]})})}([It,Bt,mn,xn])];case 1:return Fn=Wr.sent(),Rn=Fn[0],Ln=Fn[1],Zn=Fn[2],An=Fn[3],[4,gl(Rn,Ln,Zn,An,D,k.maxDetections,k.scoreThreshold,k.nmsRadius)];case 2:return Sr=Wr.sent(),Ur=Ks(Sr,[de,_e],q,tt,k.flipHorizontal),It.dispose(),Bt.dispose(),mn.dispose(),xn.dispose(),De.dispose(),[2,Ur]}})})},P.prototype.estimateSinglePose=function(E,_){return _===void 0&&(_=nf),hr(this,void 0,void 0,function(){var k,D,q,ee,de,_e,Re,De,tt,st,It,Bt,mn,xn,Fn,Rn;return is(this,function(Ln){switch(Ln.label){case 0:return k=xi({},nf,_),D=this.baseModel.outputStride,q=this.inputResolution,ee=aa(E),de=ee[0],_e=ee[1],Re=ms(E,q),De=Re.resized,tt=Re.padding,st=this.baseModel.predict(De),It=st.heatmapScores,Bt=st.offsets,mn=st.displacementFwd,xn=st.displacementBwd,[4,Nl(It,Bt,D)];case 1:return Fn=Ln.sent(),Rn=Ks([Fn],[de,_e],q,tt,k.flipHorizontal),It.dispose(),Bt.dispose(),mn.dispose(),xn.dispose(),De.dispose(),[2,Rn[0]]}})})},P.prototype.estimatePoses=function(E,_){return hr(this,void 0,void 0,function(){return is(this,function(k){switch(k.label){case 0:return _.decodingMethod!=="single-person"?[3,2]:[4,this.estimateSinglePose(E,_)];case 1:return[2,[k.sent()]];case 2:return[2,this.estimateMultiplePoses(E,_)]}})})},P.prototype.dispose=function(){this.baseModel.dispose()},P}();function uc(P){return hr(this,void 0,void 0,function(){var E,_,k,D,q,ee,de;return is(this,function(_e){switch(_e.label){case 0:if(E=P.outputStride,_=P.quantBytes,k=P.multiplier,Qe==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return D=function(Re,De,tt){var st={1:"100",.75:"075",.5:"050"},It="model-stride"+Re+".json";return tt===4?pa+"float/"+st[De]+"/"+It:pa+"quant"+tt+"/"+st[De]+"/"+It}(E,k,_),[4,Object(Ut.loadGraphModel)(P.modelUrl||D)];case 1:return q=_e.sent(),ee=new No(q,E),de=tf(P.inputResolution,ee.outputStride),[2,new yd(ee,de)]}})})}function bd(P){return hr(this,void 0,void 0,function(){var E,_,k,D,q,ee;return is(this,function(de){switch(de.label){case 0:if(E=P.outputStride,_=P.quantBytes,Qe==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return k=function(_e,Re){var De="model-stride"+_e+".json";return Re===4?Ea+"float/"+De:Ea+"quant"+Re+"/"+De}(E,_),[4,Object(Ut.loadGraphModel)(P.modelUrl||k)];case 1:return D=de.sent(),q=new Fs(D,E),ee=tf(P.inputResolution,q.outputStride),[2,new yd(q,ee)]}})})}function Xu(P){return P===void 0&&(P=la),hr(this,void 0,void 0,function(){return is(this,function(E){return(P=function(_){if((_=_||la).architecture==null&&(_.architecture="MobileNetV1"),xu.indexOf(_.architecture)<0)throw new Error("Invalid architecture "+_.architecture+". Should be one of "+xu);if(_.inputResolution==null&&(_.inputResolution=257),Rs(_.inputResolution),_.outputStride==null&&(_.outputStride=16),Mr[_.architecture].indexOf(_.outputStride)<0)throw new Error("Invalid outputStride "+_.outputStride+". Should be one of "+Mr[_.architecture]+" for architecture "+_.architecture+".");if(_.multiplier==null&&(_.multiplier=1),Cc[_.architecture].indexOf(_.multiplier)<0)throw new Error("Invalid multiplier "+_.multiplier+". Should be one of "+Cc[_.architecture]+" for architecture "+_.architecture+".");if(_.quantBytes==null&&(_.quantBytes=4),sc.indexOf(_.quantBytes)<0)throw new Error("Invalid quantBytes "+_.quantBytes+". Should be one of "+sc+" for architecture "+_.architecture+".");if(_.architecture==="MobileNetV1"&&_.outputStride===32&&_.multiplier!==1)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return _}(P)).architecture==="ResNet50"?[2,bd(P)]:P.architecture==="MobileNetV1"?[2,uc(P)]:[2,null]})})}function Io(P){var E=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var _,k=Hs()(P);if(E){var D=Hs()(this).constructor;_=Reflect.construct(k,arguments,D)}else _=k.apply(this,arguments);return ws()(this,_)}}var Nu={architecture:"MobileNetV1",outputStride:16,flipHorizontal:!1,minConfidence:.5,maxPoseDetections:5,scoreThreshold:.5,nmsRadius:20,detectionType:"multiple",inputResolution:256,multiplier:.75,quantBytes:2,modelUrl:null},Jd=function(P){kc()(_,P);var E=Io(_);function _(k,D,q,ee){var de;return pe()(this,_),(de=E.call(this)).video=k,de.modelUrl=D.modelUrl||null,de.architecture=D.architecture||Nu.architecture,de.detectionType=q||D.detectionType||Nu.detectionType,de.outputStride=D.outputStride||Nu.outputStride,de.flipHorizontal=D.flipHorizontal||Nu.flipHorizontal,de.scoreThreshold=D.scoreThreshold||Nu.scoreThreshold,de.minConfidence=D.minConfidence||Nu.minConfidence,de.maxPoseDetections=D.maxPoseDetections||Nu.maxPoseDetections,de.multiplier=D.multiplier||Nu.multiplier,de.inputResolution=D.inputResolution||Nu.inputResolution,de.quantBytes=D.quantBytes||Nu.quantBytes,de.nmsRadius=D.nmsRadius||Nu.nmsRadius,de.ready=ft(de.load(),ee),de}return Fe()(_,[{key:"load",value:function(){var k=J()(Ae.a.mark(function D(){var q,ee=this;return Ae.a.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:return q=this.architecture.toLowerCase()==="mobilenetv1"?{architecture:this.architecture,outputStride:this.outputStride,inputResolution:this.inputResolution,multiplier:this.multiplier,quantBytes:this.quantBytes,modelUrl:this.modelUrl}:{architecture:this.architecture,outputStride:this.outputStride,inputResolution:this.inputResolution,quantBytes:this.quantBytes},de.next=3,Xu(q);case 3:if(this.net=de.sent,!this.video){de.next=9;break}if(this.video.readyState!==0){de.next=8;break}return de.next=8,new Promise(function(_e){ee.video.onloadeddata=function(){return _e()}});case 8:this.detectionType==="single"?this.singlePose():this.multiPose();case 9:return de.abrupt("return",this);case 10:case"end":return de.stop()}},D,this)}));return function(){return k.apply(this,arguments)}}()},{key:"skeleton",value:function(k){return function(D,q){return Oa.reduce(function(ee,de){var _e=de[0],Re=de[1];return function(De,tt,st){return De<st||tt<st}(D[_e].score,D[Re].score,q)||ee.push([D[_e],D[Re]]),ee},[])}(k,arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.minConfidence)}},{key:"mapParts",value:function(k){var D=JSON.parse(JSON.stringify(k));return D.keypoints.forEach(function(q){D[q.part]={x:q.position.x,y:q.position.y,confidence:q.score}}),D}},{key:"getInput",value:function(k){return k instanceof HTMLImageElement||k instanceof HTMLVideoElement||k instanceof HTMLCanvasElement||k instanceof ImageData?k:Ce()(k)==="object"&&(k.elt instanceof HTMLImageElement||k.elt instanceof HTMLVideoElement||k.elt instanceof ImageData)?k.elt:Ce()(k)==="object"&&k.canvas instanceof HTMLCanvasElement?k.canvas:this.video}},{key:"singlePose",value:function(){var k=J()(Ae.a.mark(function D(q,ee){var de,_e,Re,De,tt=this;return Ae.a.wrap(function(st){for(;;)switch(st.prev=st.next){case 0:return de=this.getInput(q),st.next=3,this.net.estimateSinglePose(de,{flipHorizontal:this.flipHorizontal});case 3:if(_e=st.sent,Re=this.mapParts(_e),De=[{pose:Re,skeleton:this.skeleton(_e.keypoints)}],this.emit("pose",De),!this.video){st.next=9;break}return st.abrupt("return",F.nextFrame().then(function(){return tt.singlePose()}));case 9:return typeof ee=="function"&&ee(De),st.abrupt("return",De);case 11:case"end":return st.stop()}},D,this)}));return function(D,q){return k.apply(this,arguments)}}()},{key:"multiPose",value:function(){var k=J()(Ae.a.mark(function D(q,ee){var de,_e,Re,De,tt=this;return Ae.a.wrap(function(st){for(;;)switch(st.prev=st.next){case 0:return de=this.getInput(q),st.next=3,this.net.estimateMultiplePoses(de,{flipHorizontal:this.flipHorizontal,maxDetections:this.maxPoseDetections,scoreThreshold:this.scoreThreshold,nmsRadius:this.nmsRadius});case 3:if(_e=st.sent,Re=_e.map(function(It){return tt.mapParts(It)}),De=Re.map(function(It){return{pose:It,skeleton:tt.skeleton(It.keypoints)}}),this.emit("pose",De),!this.video){st.next=9;break}return st.abrupt("return",F.nextFrame().then(function(){return tt.multiPose()}));case 9:return typeof ee=="function"&&ee(De),st.abrupt("return",De);case 11:case"end":return st.stop()}},D,this)}));return function(D,q){return k.apply(this,arguments)}}()}]),_}(Of.a),rf=function(P,E,_){var k,D={},q=_,ee=null;return P instanceof HTMLVideoElement?k=P:Ce()(P)==="object"&&P.elt instanceof HTMLVideoElement?k=P.elt:Ce()(P)==="object"?D=P:typeof P=="function"&&(q=P),Ce()(E)==="object"?D=E:typeof E=="string"&&(ee=E),typeof E=="function"&&(q=E),new Jd(k,D,ee,q)},Iu=function(){function P(E){pe()(this,P),this.urlPath=E.endsWith("/")?E:"".concat(E,"/"),this.variables={}}return Fe()(P,[{key:"loadManifest",value:function(){var E=J()(Ae.a.mark(function _(){var k;return Ae.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.prev=0,D.next=3,en.a.get(this.urlPath+"manifest.json");case 3:return k=D.sent,D.abrupt("return",k.data);case 7:throw D.prev=7,D.t0=D.catch(0),new Error("".concat("manifest.json"," not found at ").concat(this.urlPath,". ").concat(D.t0));case 10:case"end":return D.stop()}},_,this,[[0,7]])}));return function(){return E.apply(this,arguments)}}()},{key:"loadVariable",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee,de,_e,Re,De;return Ae.a.wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:return tt.next=2,this.getCheckpointManifest();case 2:if(D=tt.sent,k in D){tt.next=5;break}throw new Error("Cannot load non-existent variable ".concat(k));case 5:return q=D[k],ee=q.filename,de=q.shape,_e=this.urlPath+ee,tt.prev=7,tt.next=10,en.a.get(_e,{responseType:"arraybuffer"});case 10:return Re=tt.sent,De=new Float32Array(Re.data),tt.abrupt("return",F.tensor(De,de));case 15:throw tt.prev=15,tt.t0=tt.catch(7),new Error("Error loading variable ".concat(k," from URL ").concat(_e,": ").concat(tt.t0));case 18:case"end":return tt.stop()}},_,this,[[7,15]])}));return function(_){return E.apply(this,arguments)}}()},{key:"getCheckpointManifest",value:function(){var E=J()(Ae.a.mark(function _(){return Ae.a.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(this.checkpointManifest){k.next=4;break}return k.next=3,this.loadManifest();case 3:this.checkpointManifest=k.sent;case 4:return k.abrupt("return",this.checkpointManifest);case 5:case"end":return k.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()},{key:"getKeys",value:function(){var E=J()(Ae.a.mark(function _(){var k;return Ae.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.next=2,this.getCheckpointManifest();case 2:return k=D.sent,D.abrupt("return",Object.keys(k));case 4:case"end":return D.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()},{key:"getAllVariables",value:function(){var E=J()(Ae.a.mark(function _(){var k,D,q=this;return Ae.a.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return ee.next=2,this.getKeys();case 2:return k=ee.sent,D=k.map(function(de){return q.getVariable(de)}),ee.next=6,Promise.all(D);case 6:return ee.abrupt("return",this.variables);case 7:case"end":return ee.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()},{key:"getVariable",value:function(){var E=J()(Ae.a.mark(function _(k){return Ae.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(this.variables[k]){D.next=4;break}return D.next=3,this.loadVariable(k);case 3:this.variables[k]=D.sent;case 4:return D.abrupt("return",this.variables[k]);case 5:case"end":return D.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()}]),P}();function Ri(P){var E=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var _,k=Hs()(P);if(E){var D=Hs()(this).constructor;_=Reflect.construct(k,arguments,D)}else _=k.apply(this,arguments);return ws()(this,_)}}var $a=200,of=function(P){return new Promise(function(E){var _=new Image($a,$a);_.onload=function(){return E(_)},_.src=P.toDataURL()})},Wp=function(P){kc()(_,P);var E=Ri(_);function _(k,D,q){var ee;return pe()(this,_),(ee=E.call(this,D,$a)).ready=!1,ee.variableDictionary={},ee.timesScalar=F.scalar(150),ee.plusScalar=F.scalar(127.5),ee.epsilonScalar=F.scalar(.001),ee.video=null,ee.ready=ft(ee.load(k),q),ee}return Fe()(_,[{key:"load",value:function(){var k=J()(Ae.a.mark(function D(q){return Ae.a.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:if(!this.videoElt){ee.next=3;break}return ee.next=3,this.loadVideo();case 3:return ee.next=5,this.loadCheckpoints(q);case 5:return ee.abrupt("return",this);case 6:case"end":return ee.stop()}},D,this)}));return function(D){return k.apply(this,arguments)}}()},{key:"loadCheckpoints",value:function(){var k=J()(Ae.a.mark(function D(q){var ee;return Ae.a.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:return ee=new Iu(q),de.next=3,ee.getAllVariables();case 3:this.variables=de.sent;case 4:case"end":return de.stop()}},D,this)}));return function(D){return k.apply(this,arguments)}}()},{key:"instanceNorm",value:function(k,D){var q=this;return F.tidy(function(){var ee=zn()(k.shape,3),de=ee[0],_e=ee[1],Re=ee[2],De=F.moments(k,[0,1]),tt=De.mean,st=De.variance,It=q.variables[_.getVariableName(D)],Bt=q.variables[_.getVariableName(D+1)],mn=q.epsilonScalar,xn=F.div(F.sub(k.asType("float32"),tt),F.sqrt(F.add(st,mn)));return F.add(F.mul(Bt,xn),It).as3D(de,_e,Re)})}},{key:"convLayer",value:function(k,D,q,ee){var de=F.conv2d(k,this.variables[_.getVariableName(ee)],[D,D],"same"),_e=this.instanceNorm(de,ee+1);return q?F.relu(_e):_e}},{key:"residualBlock",value:function(k,D){var q=this.convLayer(k,1,!0,D),ee=this.convLayer(q,1,!1,D+3);return F.add(ee,k)}},{key:"convTransposeLayer",value:function(k,D,q,ee){var de=zn()(k.shape,2),_e=[de[0]*q,de[1]*q,D],Re=F.conv2dTranspose(k,this.variables[_.getVariableName(ee)],_e,[q,q],"same"),De=this.instanceNorm(Re,ee+1);return F.relu(De)}},{key:"transfer",value:function(){var k=J()(Ae.a.mark(function D(q,ee){var de,_e;return Ae.a.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:if(_e=ee,!(q instanceof HTMLVideoElement||q instanceof HTMLImageElement||q instanceof ImageData)){Re.next=5;break}de=q,Re.next=18;break;case 5:if(!(q instanceof HTMLCanvasElement)){Re.next=11;break}return Re.next=8,of(q);case 8:de=Re.sent,Re.next=18;break;case 11:if(!(Ce()(q)==="object"&&q.elt instanceof HTMLCanvasElement)){Re.next=17;break}return Re.next=14,of(q.elt);case 14:de=Re.sent,Re.next=18;break;case 17:Ce()(q)==="object"&&(q.elt instanceof HTMLVideoElement||q.elt instanceof HTMLImageElement||q.elt instanceof ImageData)?de=q.elt:typeof q=="function"&&(de=this.video,_e=q);case 18:return Re.abrupt("return",ft(this.transferInternal(de),_e));case 19:case"end":return Re.stop()}},D,this)}));return function(D,q){return k.apply(this,arguments)}}()},{key:"transferInternal",value:function(){var k=J()(Ae.a.mark(function D(q){var ee,de,_e=this;return Ae.a.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return ee=F.browser.fromPixels(q),de=hn(F.tidy(function(){var De=_e.convLayer(ee,1,!0,0),tt=_e.convLayer(De,2,!0,3),st=_e.convLayer(tt,2,!0,6),It=_e.residualBlock(st,9),Bt=_e.residualBlock(It,15),mn=_e.residualBlock(Bt,21),xn=_e.residualBlock(mn,27),Fn=_e.residualBlock(xn,33),Rn=_e.convTransposeLayer(Fn,64,2,39),Ln=_e.convTransposeLayer(Rn,32,2,42),Zn=_e.convLayer(Ln,1,!1,45),An=F.tanh(Zn),Sr=F.mul(_e.timesScalar,An),Ur=F.add(_e.plusScalar,Sr),Wr=F.clipByValue(Ur,0,255);return F.div(Wr,F.scalar(255))})),ee.dispose(),Re.next=5,F.nextFrame();case 5:return Re.abrupt("return",de);case 6:case"end":return Re.stop()}},D)}));return function(D){return k.apply(this,arguments)}}()}],[{key:"getVariableName",value:function(k){return k===0?"Variable":"Variable_".concat(k)}}]),_}(Zr),Mh=function(P,E,_){var k=_;typeof E=="function"&&(k=E);var D=new Wp(P,E,k);return k?D:D.ready},jh=function(P){for(var E,_=Math.random(),k=0,D=0;D<P.length;D+=1)if(_<(k+=P[D])){E=D;break}return E},_o=/cell_[0-9]|lstm_[0-9]/gi,Ki=/weights|weight|kernel|kernels|w/gi,Ka=/softmax/gi,Vp=function(){function P(E,_){pe()(this,P),this.ready=!1,this.model={},this.cellsAmount=0,this.cells=[],this.zeroState={c:[],h:[]},this.state={c:[],h:[]},this.vocab={},this.vocabSize=0,this.probabilities=[],this.defaults={seed:"a",length:20,temperature:.5,stateful:!1},this.ready=ft(this.loadCheckpoints(E),_)}return Fe()(P,[{key:"resetState",value:function(){this.state=this.zeroState}},{key:"setState",value:function(E){this.state=E}},{key:"getState",value:function(){return this.state}},{key:"loadCheckpoints",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee=this;return Ae.a.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:return D=new Iu(k),de.next=3,D.getAllVariables();case 3:return q=de.sent,Object.keys(q).forEach(function(_e){_e.match(_o)?_e.match(Ki)?(ee.model["Kernel_".concat(_e.match(/[0-9]/)[0])]=q[_e],ee.cellsAmount+=1):ee.model["Bias_".concat(_e.match(/[0-9]/)[0])]=q[_e]:_e.match(Ka)?_e.match(Ki)?ee.model.fullyConnectedWeights=q[_e]:ee.model.fullyConnectedBiases=q[_e]:ee.model[_e]=q[_e]}),de.next=7,this.loadVocab(k);case 7:return de.next=9,this.initCells();case 9:return de.abrupt("return",this);case 10:case"end":return de.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"loadVocab",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q;return Ae.a.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return ee.prev=0,ee.next=3,en.a.get("".concat(k,"/vocab.json"));case 3:return D=ee.sent,q=D.data,this.vocab=q,this.vocabSize=Object.keys(q).length,ee.abrupt("return",this.vocab);case 10:return ee.prev=10,ee.t0=ee.catch(0),ee.abrupt("return",ee.t0);case 13:case"end":return ee.stop()}},_,this,[[0,10]])}));return function(_){return E.apply(this,arguments)}}()},{key:"initCells",value:function(){var E=J()(Ae.a.mark(function _(){var k,D,q,ee=this;return Ae.a.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:for(this.cells=[],this.zeroState={c:[],h:[]},k=F.tensor(1),D=function(_e){return function(Re,De,tt){return F.basicLSTMCell(k,ee.model["Kernel_".concat(_e)],ee.model["Bias_".concat(_e)],Re,De,tt)}},q=0;q<this.cellsAmount;q+=1)this.zeroState.c.push(F.zeros([1,this.model["Bias_".concat(q)].shape[0]/4])),this.zeroState.h.push(F.zeros([1,this.model["Bias_".concat(q)].shape[0]/4])),this.cells.push(D(q));this.state=this.zeroState;case 6:case"end":return de.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()},{key:"generateInternal",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee,de,_e,Re,De,tt,st,It,Bt,mn,xn,Fn,Rn,Ln,Zn,An,Sr,Ur=this;return Ae.a.wrap(function(Wr){for(;;)switch(Wr.prev=Wr.next){case 0:return Wr.next=2,this.ready;case 2:D=k.seed||this.defaults.seed,q=+k.length||this.defaults.length,ee=+k.temperature||this.defaults.temperature,k.stateful||this.defaults.stateful||(this.state=this.zeroState),de=[],_e=Array.from(D),Re=[],_e.forEach(function(ci){Re.push(Ur.vocab[ci])}),De=Re[0],tt=[],st=0;case 14:if(!(st<_e.length+q+-1)){Wr.next=36;break}return Wr.next=17,F.buffer([1,this.vocabSize]);case 17:return(It=Wr.sent).set(1,0,De),Bt=It.toTensor(),mn=void 0,this.model.embedding?(xn=F.matMul(Bt,this.model.embedding),mn=F.multiRNNCell(this.cells,xn,this.state.c,this.state.h)):mn=F.multiRNNCell(this.cells,Bt,this.state.c,this.state.h),this.state.c=mn[0],this.state.h=mn[1],Fn=this.state.h[1],Rn=F.matMul(Fn,this.model.fullyConnectedWeights),Ln=F.add(Rn,this.model.fullyConnectedBiases),Zn=F.div(Ln,F.tensor(ee)),An=F.exp(Zn),Wr.next=31,F.div(An,F.sum(An)).data();case 31:tt=Wr.sent,st<_e.length-1?De=Re[st+1]:(De=jh(tt),de.push(De));case 33:st+=1,Wr.next=14;break;case 36:return Sr="",de.forEach(function(ci){var Jr=Object.keys(Ur.vocab).find(function(Xi){return Ur.vocab[Xi]===ci});Jr&&(Sr+=Jr)}),this.probabilities=tt,Wr.abrupt("return",{sample:Sr,state:this.state});case 40:case"end":return Wr.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"reset",value:function(){this.state=this.zeroState}},{key:"generate",value:function(){var E=J()(Ae.a.mark(function _(k,D){return Ae.a.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return this.reset(),q.abrupt("return",ft(this.generateInternal(k),D));case 2:case"end":return q.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"predict",value:function(){var E=J()(Ae.a.mark(function _(k,D){var q,ee,de,_e,Re,De,tt,st,It,Bt,mn=this;return Ae.a.wrap(function(xn){for(;;)switch(xn.prev=xn.next){case 0:return q=[],ee=k>0?k:.1,de=this.state.h[1],_e=F.matMul(de,this.model.fullyConnectedWeights),Re=F.add(_e,this.model.fullyConnectedBiases),De=F.div(Re,F.tensor(ee)),tt=F.exp(De),xn.next=9,F.div(tt,F.sum(tt)).data();case 9:return q=xn.sent,st=jh(q),It=Object.keys(this.vocab).find(function(Fn){return mn.vocab[Fn]===st}),this.probabilities=q,D&&D(It),Bt=Object.keys(this.vocab).map(function(Fn){return{char:Fn,probability:mn.probabilities[mn.vocab[Fn]]}}),xn.abrupt("return",{sample:It,probabilities:Bt});case 16:case"end":return xn.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"feed",value:function(){var E=J()(Ae.a.mark(function _(k,D){var q,ee,de,_e,Re,De,tt,st,It=this;return Ae.a.wrap(function(Bt){for(;;)switch(Bt.prev=Bt.next){case 0:return Bt.next=2,this.ready;case 2:q=Array.from(k),ee=[],q.forEach(function(mn){ee.push(It.vocab[mn])}),de=ee[0],_e=0;case 7:if(!(_e<q.length)){Bt.next=21;break}return Bt.next=10,F.buffer([1,this.vocabSize]);case 10:(Re=Bt.sent).set(1,0,de),De=Re.toTensor(),tt=void 0,this.model.embedding?(st=F.matMul(De,this.model.embedding),tt=F.multiRNNCell(this.cells,st,this.state.c,this.state.h)):tt=F.multiRNNCell(this.cells,De,this.state.c,this.state.h),this.state.c=tt[0],this.state.h=tt[1],de=ee[_e];case 18:_e+=1,Bt.next=7;break;case 21:D&&D();case 22:case"end":return Bt.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()}]),P}(),qp=function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"./",E=arguments.length>1?arguments[1]:void 0;return new Vp(P,E)},Hp=function(){function P(E){pe()(this,P),this.urlPath=E}return Fe()(P,[{key:"getAllVariables",value:function(){var E=J()(Ae.a.mark(function _(){var k,D,q,ee,de,_e,Re,De,tt,st;return Ae.a.wrap(function(It){for(;;)switch(It.prev=It.next){case 0:return It.next=2,en.a.get(this.urlPath,{responseType:"arraybuffer"}).catch(function(Bt){throw new Error("No model found. Failed with error ".concat(Bt))});case 2:for(k=It.sent,D=k.data,q=[],ee=0;ee<D.byteLength;)de=new Uint8Array(D.slice(ee,ee+4)),ee+=4,_e=(de[0]<<24)+(de[1]<<16)+(de[2]<<8)+de[3],q.push(D.slice(ee,ee+_e)),ee+=_e;return Re=JSON.parse(new TextDecoder("utf8").decode(q[0])),De=new Float32Array(q[1]),tt=new Uint8Array(q[2]),st={},ee=0,Re.forEach(function(Bt){var mn=Bt.shape,xn=Bt.name,Fn=mn.reduce(function(Zn,An){return Zn*An}),Rn=tt.slice(ee,ee+Fn),Ln=new Float32Array(Rn.length);Rn.forEach(function(Zn,An){Ln[An]=De[Zn]}),st[xn]=F.tensor(Ln,mn,"float32"),ee+=Fn}),It.abrupt("return",st);case 14:case"end":return It.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()}]),P}(),Qf=function(){function P(E,_){pe()(this,P),this.ready=ft(this.loadCheckpoints(E),_)}return Fe()(P,[{key:"loadCheckpoints",value:function(){var E=J()(Ae.a.mark(function _(k){var D;return Ae.a.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return D=new Hp(k),q.next=3,D.getAllVariables();case 3:return this.variables=q.sent,q.abrupt("return",this);case 5:case"end":return q.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"transfer",value:function(){var E=J()(Ae.a.mark(function _(k,D){return Ae.a.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.abrupt("return",ft(this.transferInternal(k),D));case 1:case"end":return q.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"transferInternal",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q=this;return Ae.a.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return D=hn(F.tidy(function(){var de=F.browser.fromPixels(k),_e=de.dataSync(),Re=F.tensor3d(_e,de.shape),De=F.div(Re,F.scalar(255)),tt=P.preprocess(De),st=[],It=q.variables["generator/encoder_1/conv2d/kernel"],Bt=q.variables["generator/encoder_1/conv2d/bias"],mn=P.conv2d(tt,It,Bt);st.push(mn);for(var xn=2;xn<=8;xn+=1){var Fn="generator/encoder_".concat(xn.toString());It=q.variables["".concat(Fn,"/conv2d/kernel")];var Rn=q.variables["".concat(Fn,"/conv2d/bias")],Ln=st[st.length-1],Zn=F.leakyRelu(Ln,.2);mn=P.conv2d(Zn,It,Rn);var An=q.variables["".concat(Fn,"/batch_normalization/gamma")],Sr=q.variables["".concat(Fn,"/batch_normalization/beta")],Ur=P.batchnorm(mn,An,Sr);st.push(Ur)}for(var Wr=8;Wr>=2;Wr-=1){var ci=void 0;if(Wr===8)ci=st[st.length-1];else{var Jr=Wr-1;ci=F.concat([st[st.length-1],st[Jr]],2)}var Xi=F.relu(ci),lo="generator/decoder_".concat(Wr.toString());It=q.variables["".concat(lo,"/conv2d_transpose/kernel")],Bt=q.variables["".concat(lo,"/conv2d_transpose/bias")],mn=P.deconv2d(Xi,It,Bt);var io=q.variables["".concat(lo,"/batch_normalization/gamma")],ga=q.variables["".concat(lo,"/batch_normalization/beta")],Ya=P.batchnorm(mn,io,ga);st.push(Ya)}var Ta=F.concat([st[st.length-1],st[0]],2),Aa=F.relu(Ta);It=q.variables["generator/decoder_1/conv2d_transpose/kernel"];var Ma=q.variables["generator/decoder_1/conv2d_transpose/bias"];mn=P.deconv2d(Aa,It,Ma),Aa=F.tanh(mn),st.push(Aa);var rs=st[st.length-1];return P.deprocess(rs)})),ee.next=3,F.nextFrame();case 3:return ee.abrupt("return",D);case 4:case"end":return ee.stop()}},_)}));return function(_){return E.apply(this,arguments)}}()}],[{key:"preprocess",value:function(E){var _=F.tidy(function(){return F.sub(F.mul(E,F.scalar(2)),F.scalar(1))});return E.dispose(),_}},{key:"deprocess",value:function(E){var _=F.tidy(function(){return F.div(F.add(E,F.scalar(1)),F.scalar(2))});return E.dispose(),_}},{key:"batchnorm",value:function(E,_,k){var D=F.tidy(function(){var q=F.moments(E,[0,1]);return F.batchNorm(E,q.mean,q.variance,k,_,1e-5)});return E.dispose(),D}},{key:"conv2d",value:function(E,_){var k=_.clone(),D=F.tidy(function(){return F.conv2d(E,k,[2,2],"same")});return E.dispose(),k.dispose(),D}},{key:"deconv2d",value:function(E,_,k){var D=F.tidy(function(){var q=F.conv2dTranspose(E,_,[2*E.shape[0],2*E.shape[1],_.shape[2]],[2,2],"same");return F.add(q,k)});return E.dispose(),_.dispose(),k.dispose(),D}}]),P}(),nu=function(P,E){var _=new Qf(P,E);return E?_:_.ready},Fu=o(241),Zf=new Set(["alarm_clock","ambulance","angel","ant","antyoga","backpack","barn","basket","bear","bee","beeflower","bicycle","bird","book","brain","bridge","bulldozer","bus","butterfly","cactus","calendar","castle","cat","catbus","catpig","chair","couch","crab","crabchair","crabrabbitfacepig","cruise_ship","diving_board","dog","dogbunny","dolphin","duck","elephant","elephantpig","eye","face","fan","fire_hydrant","firetruck","flamingo","flower","floweryoga","frog","frogsofa","garden","hand","hedgeberry","hedgehog","helicopter","kangaroo","key","lantern","lighthouse","lion","lionsheep","lobster","map","mermaid","monapassport","monkey","mosquito","octopus","owl","paintbrush","palm_tree","parrot","passport","peas","penguin","pig","pigsheep","pineapple","pool","postcard","power_outlet","rabbit","rabbitturtle","radio","radioface","rain","rhinoceros","rifle","roller_coaster","sandwich","scorpion","sea_turtle","sheep","skull","snail","snowflake","speedboat","spider","squirrel","steak","stove","strawberry","swan","swing_set","the_mona_lisa","tiger","toothbrush","toothpaste","tractor","trombone","truck","whale","windmill","yoga","yogabicycle","everything"]),cc={modelPath:"https://storage.googleapis.com/quickdraw-models/sketchRNN/large_models/",modelPath_large:"https://storage.googleapis.com/quickdraw-models/sketchRNN/models/",modelPath_small:"https://storage.googleapis.com/quickdraw-models/sketchRNN/models/",PATH_END:".gen.json",temperature:.65,pixelFactor:3},Bc=function(){function P(E,_){var k=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];pe()(this,P);var D=E;if(this.config={temperature:.65,pixelFactor:3,modelPath:cc.modelPath,modelPath_small:cc.modelPath_small,modelPath_large:cc.modelPath_large,PATH_END:cc.PATH_END},Gs.isAbsoluteURL(D)===!0){var q=Gs.getModelPath(D);this.config.modelPath=q}else{if(!Zf.has(D))return console.log("no model found!"),this;D=(k?this.config.modelPath:this.config.modelPath_small)+D+this.config.PATH_END,this.config.modelPath=D}this.model=new Fu.SketchRNN(this.config.modelPath),this.penState=this.model.zeroInput(),this.ready=ft(this.model.initialize(),_)}return Fe()(P,[{key:"generateInternal",value:function(){var E=J()(Ae.a.mark(function _(k,D){var q,ee,de,_e;return Ae.a.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return q=+k.temperature||this.config.temperature,ee=+k.pixelFactor||this.config.pixelFactor,Re.next=4,this.ready;case 4:return this.rnnState||(this.rnnState=this.model.zeroState(),this.model.setPixelFactor(ee)),Array.isArray(D)&&D.length&&(this.rnnState=this.model.updateStrokes(D,this.rnnState)),this.rnnState=this.model.update(this.penState,this.rnnState),de=this.model.getPDF(this.rnnState,q),this.penState=this.model.sample(de),_e={dx:this.penState[0],dy:this.penState[1]},this.penState[2]===1?_e.pen="down":this.penState[3]===1?_e.pen="up":this.penState[4]===1&&(_e.pen="end"),Re.abrupt("return",_e);case 12:case"end":return Re.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"generate",value:function(){var E=J()(Ae.a.mark(function _(k,D,q){var ee,de,_e,Re;return Ae.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return typeof k=="function"?(de={},_e=[],ee=k):Array.isArray(k)?(de={},_e=k,ee=D):typeof D=="function"?(de=k||{},_e=[],ee=D):(de=k||{},_e=D||[],ee=q),Re=_e.map(function(tt){var st=tt.pen==="up"?1:0,It=tt.pen==="down"?1:0,Bt=tt.pen==="end"?1:0;return[tt.dx,tt.dy,It,st,Bt]}),De.abrupt("return",ft(this.generateInternal(de,Re),ee));case 3:case"end":return De.stop()}},_,this)}));return function(_,k,D){return E.apply(this,arguments)}}()},{key:"reset",value:function(){this.penState=this.model.zeroInput(),this.rnnState&&(this.rnnState=this.model.zeroState())}}]),P}(),Qd=function(P,E){var _=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];return new Bc(P,E,_)},wo={modelPath:"https://raw.githubusercontent.com/zaidalyafeai/HostedModels/master/unet-128/model.json",imageSize:128,returnTensors:!1},Il=function(){function P(E,_,k){pe()(this,P),this.modelReady=!1,this.isPredicting=!1,this.config={modelPath:_.modelPath!==void 0?_.modelPath:wo.modelPath,imageSize:_.imageSize!==void 0?_.imageSize:wo.imageSize,returnTensors:_.returnTensors!==void 0?_.returnTensors:wo.returnTensors},this.ready=ft(this.loadModel(),k)}return Fe()(P,[{key:"loadModel",value:function(){var E=J()(Ae.a.mark(function _(){return Ae.a.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.next=2,F.loadLayersModel(this.config.modelPath);case 2:return this.model=k.sent,this.modelReady=!0,k.abrupt("return",this);case 5:case"end":return k.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()},{key:"segment",value:function(){var E=J()(Ae.a.mark(function _(k,D){var q,ee;return Ae.a.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:return de.next=2,this.ready;case 2:return ee=D,k instanceof HTMLImageElement||k instanceof HTMLVideoElement||k instanceof HTMLCanvasElement||k instanceof ImageData?q=k:Ce()(k)==="object"&&(k.elt instanceof HTMLImageElement||k.elt instanceof HTMLVideoElement||k.elt instanceof HTMLCanvasElement||k.elt instanceof ImageData)?q=k.elt:typeof k=="function"&&(q=this.video,ee=k),de.abrupt("return",ft(this.segmentInternal(q),ee));case 5:case"end":return de.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"convertToP5Image",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q;return Ae.a.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return ee.next=2,qr.rawToBlob(k,this.config.imageSize,this.config.imageSize);case 2:return D=ee.sent,ee.next=5,qr.blobToP5Image(D);case 5:return q=ee.sent,ee.abrupt("return",q);case 7:case"end":return ee.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"segmentInternal",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee,de,_e,Re,De,tt,st,It,Bt,mn,xn,Fn,Rn=this;return Ae.a.wrap(function(Ln){for(;;)switch(Ln.prev=Ln.next){case 0:return Ln.next=2,this.ready;case 2:if(!(k instanceof HTMLVideoElement)){Ln.next=5;break}return Ln.next=5,F.nextFrame();case 5:return this.isPredicting=!0,D=F.tidy(function(){var Zn=F.browser.fromPixels(k).toFloat(),An=F.image.resizeBilinear(Zn,[Rn.config.imageSize,Rn.config.imageSize]).div(F.scalar(255)),Sr=An.expandDims(0),Ur=Rn.model.predict(Sr),Wr=F.ones([128,128,1]).tile([1,1,1]);An=An.concat(Wr,2);var ci=Ur.squeeze([0]),Jr=(ci=(ci=ci.tile([1,1,4])).sub(.3).sign().relu().neg().add(1)).mul(An),Xi=Ur.squeeze([0]),lo=(Xi=(Xi=Xi.tile([1,1,4])).sub(.3).sign().relu()).mul(An),io=F.ones([128,128,1]).tile([1,1,1]).mul(255),ga=Ur.squeeze([0]);return{featureMask:Jr,backgroundMask:lo,segmentation:ga=(ga=F.cast(ga.tile([1,1,3]).sub(.3).sign().relu().mul(255),"int32")).concat(io,2)}}),q=D.featureMask,ee=D.backgroundMask,de=D.segmentation,this.isPredicting=!1,Ln.next=10,F.browser.toPixels(q);case 10:return _e=Ln.sent,Ln.next=13,F.browser.toPixels(ee);case 13:return Re=Ln.sent,Ln.next=16,F.browser.toPixels(de);case 16:if(De=Ln.sent,tt=hn(q),st=hn(ee),It=P.dataURLtoBlob(tt.src),Bt=P.dataURLtoBlob(st.src),!qr.checkP5()){Ln.next=31;break}return Ln.next=24,this.convertToP5Image(_e);case 24:return mn=Ln.sent,Ln.next=27,this.convertToP5Image(Re);case 27:return xn=Ln.sent,Ln.next=30,this.convertToP5Image(De);case 30:Fn=Ln.sent;case 31:return this.config.returnTensors||(q.dispose(),ee.dispose(),de.dispose()),Ln.abrupt("return",{segmentation:De,blob:{featureMask:It,backgroundMask:Bt},tensor:{featureMask:q,backgroundMask:ee},raw:{featureMask:_e,backgroundMask:Re},featureMask:mn,backgroundMask:xn,mask:Fn});case 33:case"end":return Ln.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()}],[{key:"dataURLtoBlob",value:function(E){for(var _=E.split(","),k=_[0].match(/:(.*?);/)[1],D=atob(_[1]),q=D.length,ee=new Uint8Array(q);q;)ee[q]=D.charCodeAt(q),q-=1;return new Blob([ee],{type:k})}}]),P}(),cr=function(P,E,_){var k=null,D={},q=_;return P instanceof HTMLVideoElement?k=P:Ce()(P)==="object"&&P.elt instanceof HTMLVideoElement?k=P.elt:typeof P=="function"?q=P:Ce()(P)==="object"&&(D=P),Ce()(E)==="object"?D=E:typeof E=="function"&&(q=E),new Il(k,D,q)},jr=function(){function P(E,_){var k=this;pe()(this,P),this.ready=!1,this.model={},this.latentDim=F.randomUniform([1,16]);var D=E.split("manifest.json"),q=zn()(D,1)[0];en.a.get(E).then(function(ee){var de=ee.data;k.ready=ft(k.loadCVAEModel(q+de.model),_),k.labels=de.labels,k.labelVector=Array(k.labels.length+1).fill(0)})}return Fe()(P,[{key:"loadCVAEModel",value:function(){var E=J()(Ae.a.mark(function _(k){return Ae.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.next=2,F.loadLayersModel(k);case 2:return this.model=D.sent,D.abrupt("return",this);case 4:case"end":return D.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"generate",value:function(){var E=J()(Ae.a.mark(function _(k,D){return Ae.a.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.abrupt("return",ft(this.generateInternal(k),D));case 1:case"end":return q.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"loadAsync",value:function(E){var _=this;return new Promise(function(k,D){_.ready||D(),loadImage(E,function(q){k(q)})})}},{key:"getBlob",value:function(E){var _=this;return new Promise(function(k,D){_.ready||D(),E.toBlob(function(q){k(q)})})}},{key:"generateInternal",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee,de,_e,Re,De,tt,st,It,Bt,mn,xn=this;return Ae.a.wrap(function(Fn){for(;;)switch(Fn.prev=Fn.next){case 0:return D=F.tidy(function(){xn.latentDim=F.randomUniform([1,16]);var Rn=xn.labels.indexOf(k);if(Rn<0)return console.log("Wrong input of the label!"),[void 0,void 0];xn.labelVector=xn.labelVector.map(function(){return 0}),xn.labelVector[Rn+1]=1;var Ln=F.tensor([xn.labelVector]),Zn=xn.model.predict([xn.latentDim,Ln]);return Zn.reshape([Zn.shape[1],Zn.shape[2],Zn.shape[3]])}),Fn.next=3,F.browser.toPixels(D);case 3:for(q=Fn.sent,D.dispose(),ee=document.createElement("canvas"),de=ee.getContext("2d"),_e=zn()(D.shape,2),Re=_e[0],De=_e[1],ee.width=Re,ee.height=De,tt=de.createImageData(Re,De),st=tt.data,It=0;It<Re*De*4;It+=1)st[It]=q[It];return de.putImageData(tt,0,0),Fn.t0=URL,Fn.next=17,this.getBlob(ee);case 17:if(Fn.t1=Fn.sent,Bt=Fn.t0.createObjectURL.call(Fn.t0,Fn.t1),!qr.checkP5()){Fn.next=23;break}return Fn.next=22,this.loadAsync(Bt);case 22:mn=Fn.sent;case 23:return Fn.abrupt("return",{src:Bt,raws:q,image:mn});case 24:case"end":return Fn.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()}]),P}(),Or=function(P,E){return new jr(P,E)},Mi=function(){function P(E,_,k){pe()(this,P),this.model={},this.modelPath=E,this.modelInfo={},this.modelPathPrefix="",this.modelReady=!1,this.config={returnTensors:_.returnTensors||!1},this.ready=ft(this.loadModel(),k)}return Fe()(P,[{key:"loadModel",value:function(){var E=J()(Ae.a.mark(function _(){var k,D,q,ee,de,_e;return Ae.a.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return Re.next=2,en.a.get(this.modelPath);case 2:return k=Re.sent,D=k.data,this.modelInfo=D,q=this.modelPath.split("manifest.json"),ee=zn()(q,1),de=ee[0],_e=this.isAbsoluteURL(de)?this.modelInfo.model:this.modelPathPrefix+this.modelInfo.model,Re.next=9,F.loadLayersModel(_e);case 9:return this.model=Re.sent,this.modelReady=!0,Re.abrupt("return",this);case 12:case"end":return Re.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()},{key:"generate",value:function(){var E=J()(Ae.a.mark(function _(k,D){return Ae.a.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.next=2,this.ready;case 2:return q.abrupt("return",ft(this.generateInternal(D),k));case 3:case"end":return q.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"compute",value:function(){var E=J()(Ae.a.mark(function _(k,D){var q,ee=this;return Ae.a.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:return q=F.tidy(function(){var _e;if(Array.isArray(D)===!1)_e=F.randomNormal([1,k]);else{for(var Re=F.buffer([1,k]),De=0;De<k;De+=1)Re.set(D[De],0,De);_e=Re.toTensor()}return ee.model.predict(_e).squeeze().transpose([1,2,0]).div(F.scalar(2)).add(F.scalar(.5))}),de.abrupt("return",q);case 2:case"end":return de.stop()}},_)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"generateInternal",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee,de,_e,Re,De,tt,st;return Ae.a.wrap(function(It){for(;;)switch(It.prev=It.next){case 0:return D=this.modelInfo.modelLatentDim,It.next=3,this.compute(D,k);case 3:return q=It.sent,It.next=6,F.browser.toPixels(q);case 6:return ee=It.sent,de=zn()(q.shape,2),_e=de[0],Re=de[1],It.next=10,qr.rawToBlob(ee,Re,_e);case 10:if(De=It.sent,!qr.checkP5()){It.next=15;break}return It.next=14,qr.blobToP5Image(De);case 14:tt=It.sent;case 15:return(st={}).blob=De,st.raw=ee,qr.checkP5()&&(st.image=tt),this.config.returnTensors?st.tensor=q:(st.tensor=null,q.dispose()),It.abrupt("return",st);case 21:case"end":return It.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"isAbsoluteURL",value:function(E){return!!new RegExp("^(?:[a-z]+:)?//","i").test(E)}}]),P}(),go=function(P,E,_){var k,D={};if(typeof P!="string")throw new Error(`Please specify a path to a "manifest.json" file: 

         "models/face/manifest.json" 


         This "manifest.json" file should include:

         {
            "description": "DCGAN, human faces, 64x64",
            "model": "https://raw.githubusercontent.com/viztopia/ml5dcgan/master/model/model.json", // "https://github.com/viztopia/ml5dcgan/blob/master/model/model.json",
            "modelSize": 64,
            "modelLatentDim": 128 
         }
         `);typeof E=="function"?k=E:Ce()(E)==="object"&&(D=E,k=_);var q=new Mi(P,D,k);return k?q:q.ready},Ca=o(30),Eo=o.n(Ca),za=o(132),Sf=0,Zd=function(){function P(E,_){pe()(this,P),this.ready=ft(this.loadModel(E),_)}return Fe()(P,[{key:"loadModel",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee,de;return Ae.a.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(D={model:null,metadata:null},k.toLowerCase()!=="moviereviews"){_e.next=6;break}D.model="https://storage.googleapis.com/tfjs-models/tfjs/sentiment_cnn_v1/model.json",D.metadata="https://storage.googleapis.com/tfjs-models/tfjs/sentiment_cnn_v1/metadata.json",_e.next=14;break;case 6:if(Gs.isAbsoluteURL(k)!==!0){_e.next=12;break}q=Gs.getModelPath(k),D.model="".concat(q,"/model.json"),D.metadata="".concat(q,"/metadata.json"),_e.next=14;break;case 12:return console.error("problem loading model"),_e.abrupt("return",this);case 14:return _e.next=16,F.loadLayersModel(D.model);case 16:return this.model=_e.sent,_e.next=19,en.a.get(D.metadata);case 19:return ee=_e.sent,de=ee.data,this.indexFrom=de.index_from,this.maxLen=de.max_len,this.wordIndex=de.word_index,this.vocabularySize=de.vocabulary_size,_e.abrupt("return",this);case 26:case"end":return _e.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"predict",value:function(E){var _=this,k=function(de,_e){var Re=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"pre",De=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"pre",tt=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Sf;return de.map(function(st){if(st.length>_e&&(De==="pre"?st.splice(0,st.length-_e):st.splice(_e,st.length-_e)),st.length<_e){for(var It=[],Bt=0;Bt<_e-st.length;Bt+=1)It.push(tt);st=Re==="pre"?It.concat(st):st.concat(It)}return st})}([E.trim().toLowerCase().replace(/[.,?!]/g,"").split(" ").map(function(de){var _e=_.wordIndex[de]+_.indexFrom;return _e>_.vocabularySize&&(_e=2),_e})],this.maxLen),D=F.tensor2d(k,[1,this.maxLen]),q=this.model.predict(D),ee=q.dataSync()[0];return q.dispose(),D.dispose(),{score:ee}}}]),P}(),Ru=function(P,E){return new Zd(P,E)};/**
    * @license
    * Copyright 2019 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function Fl(P,E,_,k){return new(_||(_=Promise))(function(D,q){function ee(Re){try{_e(k.next(Re))}catch(De){q(De)}}function de(Re){try{_e(k.throw(Re))}catch(De){q(De)}}function _e(Re){Re.done?D(Re.value):new _(function(De){De(Re.value)}).then(ee,de)}_e((k=k.apply(P,E||[])).next())})}function Df(P,E){var _,k,D,q,ee={label:0,sent:function(){if(1&D[0])throw D[1];return D[1]},trys:[],ops:[]};return q={next:de(0),throw:de(1),return:de(2)},typeof Symbol=="function"&&(q[Symbol.iterator]=function(){return this}),q;function de(_e){return function(Re){return function(De){if(_)throw new TypeError("Generator is already executing.");for(;ee;)try{if(_=1,k&&(D=2&De[0]?k.return:De[0]?k.throw||((D=k.return)&&D.call(k),0):k.next)&&!(D=D.call(k,De[1])).done)return D;switch(k=0,D&&(De=[2&De[0],D.value]),De[0]){case 0:case 1:D=De;break;case 4:return ee.label++,{value:De[1],done:!1};case 5:ee.label++,k=De[1],De=[0];continue;case 7:De=ee.ops.pop(),ee.trys.pop();continue;default:if(!(D=(D=ee.trys).length>0&&D[D.length-1])&&(De[0]===6||De[0]===2)){ee=0;continue}if(De[0]===3&&(!D||De[1]>D[0]&&De[1]<D[3])){ee.label=De[1];break}if(De[0]===6&&ee.label<D[1]){ee.label=D[1],D=De;break}if(D&&ee.label<D[2]){ee.label=D[2],ee.ops.push(De);break}D[2]&&ee.ops.pop(),ee.trys.pop();continue}De=E.call(P,ee)}catch(tt){De=[6,tt],k=0}finally{_=D=0}if(5&De[0])throw De[1];return{value:De[0]?De[1]:void 0,done:!0}}([_e,Re])}}}var af=[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1]],Tf=[8,16,32];function sf(P){Qe.util.assert(typeof P=="number",function(){return"outputStride is not a number"}),Qe.util.assert(Tf.indexOf(P)>=0,function(){return"outputStride of "+P+" is invalid. It must be either 8, 16, or 32"})}var ma={100:[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",2],["separableConv",1]],75:[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1]],50:af,25:af},Dg=function(){function P(E,_){this.PREPROCESS_DIVISOR=Object(Qe.scalar)(127.5),this.ONE=Object(Qe.scalar)(1),this.modelWeights=E,this.convolutionDefinitions=_}return P.prototype.predict=function(E,_){var k=this,D=Object(Qe.div)(E.toFloat(),this.PREPROCESS_DIVISOR),q=Object(Qe.sub)(D,this.ONE);return function(ee,de){var _e=1,Re=1;return ee.map(function(De,tt){var st,It,Bt=De[0],mn=De[1];return _e===de?(st=1,It=Re,Re*=mn):(st=mn,It=1,_e*=mn),{blockId:tt,convType:Bt,stride:st,rate:It,outputStride:_e}})}(this.convolutionDefinitions,_).reduce(function(ee,de){var _e=de.blockId,Re=de.stride,De=de.convType,tt=de.rate;if(De==="conv2d")return k.conv(ee,Re,_e);if(De==="separableConv")return k.separableConv(ee,Re,_e,tt);throw Error("Unknown conv type of "+De)},q)},P.prototype.convToOutput=function(E,_){return E.conv2d(this.weights(_),1,"same").add(this.convBias(_,!1))},P.prototype.conv=function(E,_,k){var D=this.weights("Conv2d_"+String(k));return E.conv2d(D,_,"same").add(this.convBias("Conv2d_"+String(k))).clipByValue(0,6)},P.prototype.separableConv=function(E,_,k,D){D===void 0&&(D=1);var q="Conv2d_"+String(k)+"_depthwise",ee="Conv2d_"+String(k)+"_pointwise";return E.depthwiseConv2D(this.depthwiseWeights(q),_,"same","NHWC",D).add(this.depthwiseBias(q)).clipByValue(0,6).conv2d(this.weights(ee),[1,1],"same").add(this.convBias(ee)).clipByValue(0,6)},P.prototype.weights=function(E){return this.modelWeights.weights(E)},P.prototype.convBias=function(E,_){return _===void 0&&(_=!0),this.modelWeights.convBias(E,_)},P.prototype.depthwiseBias=function(E){return this.modelWeights.depthwiseBias(E)},P.prototype.depthwiseWeights=function(E){return this.modelWeights.depthwiseWeights(E)},P.prototype.dispose=function(){this.modelWeights.dispose()},P}(),eh="https://storage.googleapis.com/tfjs-models/savedmodel/",Ua={1:{url:eh+"posenet_mobilenet_100_partmap/",architecture:ma[100]},.75:{url:eh+"posenet_mobilenet_075_partmap/",architecture:ma[75]},.5:{url:eh+"posenet_mobilenet_050_partmap/",architecture:ma[50]},.25:{url:eh+"posenet_mobilenet_025_partmap/",architecture:ma[25]}};function Ms(P,E){return Object(Qe.tidy)(function(){return P.greater(Object(Qe.scalar)(E)).toInt()})}function Xs(P,E){var _=E.shape,k=_[0],D=_[1],q=_[2];return Object(Qe.tidy)(function(){var ee=function(_e){var Re=_e.shape[2],De=_e.argMax(2).reshape([-1]);return Object(Qe.oneHot)(De,Re)}(E),de=Object(Qe.range)(0,q,1,"int32").expandDims(1);return function(_e,Re){return _e.mul(Re)}(ee.matMul(de).toInt().reshape([k,D]).add(Object(Qe.scalar)(1,"int32")),P).sub(Object(Qe.scalar)(1,"int32"))})}var Co=function(){function P(E){this.graphModel=E}return P.prototype.weights=function(E){return this.getVariable("MobilenetV1/"+E+"/weights")},P.prototype.convBias=function(E,_){return this.getVariable("MobilenetV1/"+E+"/Conv2D_bias")},P.prototype.depthwiseBias=function(E){return this.getVariable("MobilenetV1/"+E+"/depthwise_bias")},P.prototype.depthwiseWeights=function(E){return this.getVariable("MobilenetV1/"+E+"/depthwise_weights")},P.prototype.getVariable=function(E){return this.graphModel.weights[""+E][0]},P.prototype.dispose=function(){this.graphModel.dispose()},P}();function cu(P){return P instanceof Qe.Tensor?P:Qe.browser.fromPixels(P)}function lc(P,E,_){var k=E[0],D=E[1];_===void 0&&(_=!1);var q,ee,de,_e,Re,De,tt=P.shape,st=tt[0],It=tt[1]/st;if(It>D/k){q=D;var Bt=k-(ee=Math.ceil(q/It));de=0,_e=0,Re=Math.floor(Bt/2),De=k-(ee+Re)}else{ee=k;var mn=D-(q=Math.ceil(k*It));de=Math.floor(mn/2),_e=D-(q+de),Re=0,De=0}return{resizedAndPadded:Object(Qe.tidy)(function(){var xn;return xn=_?P.reverse(1).resizeBilinear([ee,q]):P.resizeBilinear([ee,q]),Object(Qe.pad3d)(xn,[[Re,De],[de,_e],[0,0]])}),paddedBy:[[Re,De],[de,_e]]}}function Es(P,E,_,k){var D=E[0],q=E[1],ee=_[0],de=_[1],_e=k[0],Re=_e[0],De=_e[1],tt=k[1],st=tt[0],It=tt[1];return Object(Qe.tidy)(function(){return function(Bt,mn,xn){var Fn=mn[0],Rn=mn[1],Ln=xn[0],Zn=Ln[0],An=Ln[1],Sr=xn[1],Ur=Sr[0],Wr=Sr[1],ci=Bt.shape,Jr=ci[0],Xi=ci[1],lo=Jr-(Zn+An),io=Xi-(Ur+Wr);return Object(Qe.tidy)(function(){return Object(Qe.slice3d)(Bt,[Zn,Ur,0],[lo,io,Bt.shape[2]]).resizeBilinear([Fn,Rn],!0)})}(P.resizeBilinear([ee,de],!0),[D,q],[[Re,De],[st,It]])})}var uf=[353,257],Pc=function(){function P(E){this.mobileNet=E}return P.prototype.predictForSegmentation=function(E,_){var k=this;return _===void 0&&(_=16),sf(_),Object(Qe.tidy)(function(){var D=k.mobileNet.predict(E,_);return k.mobileNet.convToOutput(D,"segment_2").sigmoid()})},P.prototype.predictForPartMap=function(E,_){var k=this;return _===void 0&&(_=16),sf(_),Object(Qe.tidy)(function(){var D=k.mobileNet.predict(E,_),q=k.mobileNet.convToOutput(D,"segment_2"),ee=k.mobileNet.convToOutput(D,"part_heatmap_2");return{segmentScores:q.sigmoid(),partHeatmapScores:ee.sigmoid()}})},P.prototype.estimatePersonSegmentationActivation=function(E,_,k){var D=this;return _===void 0&&(_=16),k===void 0&&(k=.5),sf(_),Object(Qe.tidy)(function(){var q=cu(E),ee=lc(q,uf),de=ee.resizedAndPadded,_e=ee.paddedBy,Re=D.predictForSegmentation(de,_),De=de.shape,tt=De[0],st=De[1],It=q.shape;return Ms(Es(Re,[It[0],It[1]],[tt,st],_e).squeeze(),k)})},P.prototype.estimatePersonSegmentation=function(E,_,k){return _===void 0&&(_=16),k===void 0&&(k=.5),Fl(this,void 0,void 0,function(){var D,q,ee,de,_e;return Df(this,function(Re){switch(Re.label){case 0:return D=this.estimatePersonSegmentationActivation(E,_,k),q=D.shape,ee=q[0],de=q[1],[4,D.data()];case 1:return _e=Re.sent(),D.dispose(),[2,{height:ee,width:de,data:_e}]}})})},P.prototype.estimatePartSegmentationActivation=function(E,_,k){var D=this;return _===void 0&&(_=16),k===void 0&&(k=.5),sf(_),Object(Qe.tidy)(function(){var q=cu(E),ee=lc(q,uf),de=ee.resizedAndPadded,_e=ee.paddedBy,Re=D.predictForPartMap(de,_),De=Re.segmentScores,tt=Re.partHeatmapScores,st=de.shape,It=st[0],Bt=st[1],mn=q.shape,xn=mn[0],Fn=mn[1],Rn=Es(De,[xn,Fn],[It,Bt],_e),Ln=Es(tt,[xn,Fn],[It,Bt],_e);return Xs(Ms(Rn.squeeze(),k),Ln)})},P.prototype.estimatePartSegmentation=function(E,_,k){return _===void 0&&(_=16),k===void 0&&(k=.5),Fl(this,void 0,void 0,function(){var D,q,ee,de,_e;return Df(this,function(Re){switch(Re.label){case 0:return D=this.estimatePartSegmentationActivation(E,_,k),q=D.shape,ee=q[0],de=q[1],[4,D.data()];case 1:return _e=Re.sent(),D.dispose(),[2,{height:ee,width:de,data:_e}]}})})},P.prototype.dispose=function(){this.mobileNet.dispose()},P}();function Bh(P){return P===void 0&&(P=.75),Fl(this,void 0,void 0,function(){var E,_;return Df(this,function(k){switch(k.label){case 0:if(Qe==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");return E=Object.keys(Ua),Qe.util.assert(typeof P=="number",function(){return"got multiplier type of "+typeof P+" when it should be a number."}),Qe.util.assert(E.indexOf(P.toString())>=0,function(){return"invalid multiplier value of "+P+".  No checkpoint exists for that multiplier. Must be one of "+E.join(",")+"."}),[4,Ph.load(P)];case 1:return _=k.sent(),[2,new Pc(_)]}})})}var Ph={load:function(P){return Fl(void 0,void 0,void 0,function(){var E,_,k,D;return Df(this,function(q){switch(q.label){case 0:return E=Ua[P],_=E.url,[4,Object(Ut.loadGraphModel)(_+"model.json")];case 1:return k=q.sent(),D=new Co(k),[2,new Dg(D,E.architecture)]}})})}};function Rl(P,E){E===void 0&&(E=!0);for(var _=P.width,k=P.height,D=P.data,q=new Uint8ClampedArray(_*k*4),ee=0;ee<k*_;++ee){var de=255*(E?1-D[ee]:D[ee]),_e=4*ee;q[_e+0]=0,q[_e+1]=0,q[_e+2]=0,q[_e+3]=Math.round(de)}return new ImageData(q,_,k)}function ep(P,E){for(var _=P.width,k=P.height,D=P.data,q=new Uint8ClampedArray(_*k*4),ee=0;ee<k*_;++ee){var de=Math.round(D[ee]),_e=4*ee;if(de===-1)q[_e+0]=255,q[_e+1]=255,q[_e+2]=255,q[_e+3]=255;else{var Re=E[de];if(!Re)throw new Error("No color could be found for part id "+de);q[_e+0]=Re[0],q[_e+1]=Re[1],q[_e+2]=Re[2],q[_e+3]=255}}return new ImageData(q,_,k)}var Oc={multiplier:.75,outputStride:16,segmentationThreshold:.5,palette:{leftFace:{id:0,color:[110,64,170]},rightFace:{id:1,color:[106,72,183]},rightUpperLegFront:{id:2,color:[100,81,196]},rightLowerLegBack:{id:3,color:[92,91,206]},rightUpperLegBack:{id:4,color:[84,101,214]},leftLowerLegFront:{id:5,color:[75,113,221]},leftUpperLegFront:{id:6,color:[66,125,224]},leftUpperLegBack:{id:7,color:[56,138,226]},leftLowerLegBack:{id:8,color:[48,150,224]},rightFeet:{id:9,color:[40,163,220]},rightLowerLegFront:{id:10,color:[33,176,214]},leftFeet:{id:11,color:[29,188,205]},torsoFront:{id:12,color:[26,199,194]},torsoBack:{id:13,color:[26,210,182]},rightUpperArmFront:{id:14,color:[28,219,169]},rightUpperArmBack:{id:15,color:[33,227,155]},rightLowerArmBack:{id:16,color:[41,234,141]},leftLowerArmFront:{id:17,color:[51,240,128]},leftUpperArmFront:{id:18,color:[64,243,116]},leftUpperArmBack:{id:19,color:[79,246,105]},leftLowerArmBack:{id:20,color:[96,247,97]},rightHand:{id:21,color:[115,246,91]},rightLowerArmFront:{id:22,color:[134,245,88]},leftHand:{id:23,color:[155,243,88]}},returnTensors:!1},th=function(){function P(E,_,k){pe()(this,P),this.video=E,this.model=null,this.modelReady=!1,this.modelPath="",this.config={multiplier:_.multiplier||Oc.multiplier,outputStride:_.outputStride||Oc.outputStride,segmentationThreshold:_.segmentationThreshold||Oc.segmentationThreshold,palette:_.palette||Oc.palette,returnTensors:_.returnTensors||Oc.returnTensors},this.ready=ft(this.loadModel(),k)}return Fe()(P,[{key:"loadModel",value:function(){var E=J()(Ae.a.mark(function _(){return Ae.a.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.next=2,Bh(this.config.multiplier);case 2:return this.model=k.sent,this.modelReady=!0,k.abrupt("return",this);case 5:case"end":return k.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()},{key:"p5Color2RGB",value:function(E){var _=/\(([^)]+)\)/.exec(E.toString("rgb"))[1].split(","),k=zn()(_,3);return[k[0],k[1],k[2]]}},{key:"convertToP5Image",value:function(){var E=J()(Ae.a.mark(function _(k,D,q){var ee,de;return Ae.a.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:return _e.next=2,qr.rawToBlob(k,D,q);case 2:return ee=_e.sent,_e.next=5,qr.blobToP5Image(ee);case 5:return de=_e.sent,_e.abrupt("return",de);case 7:case"end":return _e.stop()}},_)}));return function(_,k,D){return E.apply(this,arguments)}}()},{key:"bodyPartsSpec",value:function(E){var _=this,k=E!==void 0||Object.keys(E).length>=24?E:this.config.palette,D=qr.p5Instance;return D&&k!==void 0&&Object.keys(k).length>=24&&Object.keys(k).forEach(function(q){k[q].color instanceof D.Color&&(k[q].color=_.p5Color2RGB(k[q].color))}),k}},{key:"segmentWithPartsInternal",value:function(){var E=J()(Ae.a.mark(function _(k,D){var q,ee,de,_e,Re,De,tt,st,It,Bt,mn,xn=this;return Ae.a.wrap(function(Fn){for(;;)switch(Fn.prev=Fn.next){case 0:return Fn.next=2,this.ready;case 2:return Fn.next=4,F.nextFrame();case 4:if(!this.video||this.video.readyState!==0){Fn.next=7;break}return Fn.next=7,new Promise(function(Rn){xn.video.onloadeddata=function(){return Rn()}});case 7:return this.config.palette=D.palette||this.config.palette,this.config.outputStride=D.outputStride||this.config.outputStride,this.config.segmentationThreshold=D.segmentationThreshold||this.config.segmentationThreshold,Fn.next=12,this.model.estimatePartSegmentation(k,this.config.outputStride,this.config.segmentationThreshold);case 12:return q=Fn.sent,ee=this.bodyPartsSpec(this.config.palette),de=Object.keys(ee).map(function(Rn){return ee[Rn].color}),(_e={segmentation:q,raw:{personMask:null,backgroundMask:null,partMask:null},tensor:{personMask:null,backgroundMask:null,partMask:null},personMask:null,backgroundMask:null,partMask:null,bodyParts:ee}).raw.backgroundMask=Rl(q,!0),_e.raw.personMask=Rl(q,!1),_e.raw.partMask=ep(q,de),Re=F.tidy(function(){var Rn=F.browser.fromPixels(k),Ln=F.ones([q.height,q.width,1]).tile([1,1,1]).mul(255);Rn=Rn.concat(Ln,2);var Zn=F.tensor(q.data,[q.height,q.width,1]),An=F.tensor(q.data,[q.height,q.width,1]),Sr=F.tensor(Eo()(_e.raw.partMask.data),[q.height,q.width,4]);return{personMask:Zn=F.cast(Zn.add(.2).sign().relu().mul(Rn),"int32"),backgroundMask:An=F.cast(An.add(.2).sign().neg().relu().mul(Rn),"int32"),partMask:Sr=F.cast(Sr,"int32")}}),De=Re.personMask,tt=Re.backgroundMask,st=Re.partMask,Fn.next=22,F.browser.toPixels(De);case 22:return It=Fn.sent,Fn.next=25,F.browser.toPixels(tt);case 25:return Bt=Fn.sent,Fn.next=28,F.browser.toPixels(st);case 28:if(mn=Fn.sent,_e.personMask=It,_e.backgroundMask=Bt,_e.partMask=mn,!qr.checkP5()){Fn.next=42;break}return Fn.next=35,this.convertToP5Image(It,q.width,q.height);case 35:return _e.personMask=Fn.sent,Fn.next=38,this.convertToP5Image(Bt,q.width,q.height);case 38:return _e.backgroundMask=Fn.sent,Fn.next=41,this.convertToP5Image(mn,q.width,q.height);case 41:_e.partMask=Fn.sent;case 42:return this.config.returnTensors?(_e.tensor.personMask=De,_e.tensor.backgroundMask=tt,_e.tensor.partMask=st):(De.dispose(),tt.dispose(),st.dispose()),Fn.abrupt("return",_e);case 44:case"end":return Fn.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"segmentWithParts",value:function(){var E=J()(Ae.a.mark(function _(k,D,q){var ee,de,_e;return Ae.a.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:if(ee=this.video,_e=this.config,typeof k!="function"){Re.next=7;break}ee=this.video,de=k,Re.next=25;break;case 7:if(!(k instanceof HTMLImageElement||k instanceof HTMLCanvasElement||k instanceof HTMLVideoElement||k instanceof ImageData)){Re.next=11;break}ee=k,Re.next=25;break;case 11:if(Ce()(k)!=="object"||!(k.elt instanceof HTMLImageElement||k.elt instanceof HTMLCanvasElement||k.elt instanceof ImageData)){Re.next=15;break}ee=k.elt,Re.next=25;break;case 15:if(!(Ce()(k)==="object"&&k.canvas instanceof HTMLCanvasElement)){Re.next=19;break}ee=k.canvas,Re.next=25;break;case 19:if(!(Ce()(k)==="object"&&k.elt instanceof HTMLVideoElement)){Re.next=23;break}ee=k.elt,Re.next=25;break;case 23:if(this.video instanceof HTMLVideoElement){Re.next=25;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 25:return Ce()(D)==="object"?_e=D:typeof D=="function"&&(de=D),typeof q=="function"&&(de=q),Re.abrupt("return",ft(this.segmentWithPartsInternal(ee,_e),de));case 28:case"end":return Re.stop()}},_,this)}));return function(_,k,D){return E.apply(this,arguments)}}()},{key:"segmentInternal",value:function(){var E=J()(Ae.a.mark(function _(k,D){var q,ee,de,_e,Re,De,tt,st=this;return Ae.a.wrap(function(It){for(;;)switch(It.prev=It.next){case 0:return It.next=2,this.ready;case 2:return It.next=4,F.nextFrame();case 4:if(!this.video||this.video.readyState!==0){It.next=7;break}return It.next=7,new Promise(function(Bt){st.video.onloadeddata=function(){return Bt()}});case 7:return this.config.outputStride=D.outputStride||this.config.outputStride,this.config.segmentationThreshold=D.segmentationThreshold||this.config.segmentationThreshold,It.next=11,this.model.estimatePersonSegmentation(k,this.config.outputStride,this.config.segmentationThreshold);case 11:return q=It.sent,(ee={segmentation:q,raw:{personMask:null,backgroundMask:null},tensor:{personMask:null,backgroundMask:null},personMask:null,backgroundMask:null}).raw.backgroundMask=Rl(q,!0),ee.raw.personMask=Rl(q,!1),de=F.tidy(function(){var Bt=F.browser.fromPixels(k),mn=F.ones([q.height,q.width,1]).tile([1,1,1]).mul(255);Bt=Bt.concat(mn,2);var xn=F.tensor(q.data,[q.height,q.width,1]),Fn=F.tensor(q.data,[q.height,q.width,1]);return{personMask:xn=F.cast(xn.neg().add(1).mul(Bt),"int32"),backgroundMask:Fn=F.cast(Fn.mul(Bt),"int32")}}),_e=de.personMask,Re=de.backgroundMask,It.next=18,F.browser.toPixels(_e);case 18:return De=It.sent,It.next=21,F.browser.toPixels(Re);case 21:if(tt=It.sent,!qr.checkP5()){It.next=31;break}return It.next=25,this.convertToP5Image(De,q.width,q.height);case 25:return ee.personMask=It.sent,It.next=28,this.convertToP5Image(tt,q.width,q.height);case 28:ee.backgroundMask=It.sent,It.next=33;break;case 31:ee.personMask=De,ee.backgroundMask=tt;case 33:return this.config.returnTensors?(ee.tensor.personMask=_e,ee.tensor.backgroundMask=Re):(_e.dispose(),Re.dispose()),It.abrupt("return",ee);case 35:case"end":return It.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"segment",value:function(){var E=J()(Ae.a.mark(function _(k,D,q){var ee,de,_e;return Ae.a.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:if(ee=this.video,_e=this.config,typeof k!="function"){Re.next=7;break}ee=this.video,de=k,Re.next=25;break;case 7:if(!(k instanceof HTMLImageElement||k instanceof HTMLCanvasElement||k instanceof HTMLVideoElement||k instanceof ImageData)){Re.next=11;break}ee=k,Re.next=25;break;case 11:if(Ce()(k)!=="object"||!(k.elt instanceof HTMLImageElement||k.elt instanceof HTMLCanvasElement||k.elt instanceof ImageData)){Re.next=15;break}ee=k.elt,Re.next=25;break;case 15:if(!(Ce()(k)==="object"&&k.canvas instanceof HTMLCanvasElement)){Re.next=19;break}ee=k.canvas,Re.next=25;break;case 19:if(!(Ce()(k)==="object"&&k.elt instanceof HTMLVideoElement)){Re.next=23;break}ee=k.elt,Re.next=25;break;case 23:if(this.video instanceof HTMLVideoElement){Re.next=25;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 25:return Ce()(D)==="object"?_e=D:typeof D=="function"&&(de=D),typeof q=="function"&&(de=q),Re.abrupt("return",ft(this.segmentInternal(ee,_e),de));case 28:case"end":return Re.stop()}},_,this)}));return function(_,k,D){return E.apply(this,arguments)}}()}]),P}(),Lh=function(P,E,_){var k,D={},q=_;P instanceof HTMLVideoElement?k=P:Ce()(P)==="object"&&P.elt instanceof HTMLVideoElement?k=P.elt:Ce()(P)==="object"?D=P:typeof P=="function"&&(q=P),Ce()(E)==="object"?D=E:typeof E=="function"&&(q=E);var ee=new th(k,D,q);return q?ee:ee.ready},zh=function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return Math.random()*(E-P)+P},jm=function(){var P,E,_,k,D,q,ee=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,de=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(q)P=E,q=!1;else{do D=(_=zh(0,2)-1)*_+(k=zh(0,2)-1)*k;while(D>=1);P=_*(D=Math.sqrt(-2*Math.log(D)/D)),E=k*D,q=!0}return P*de+ee},xd=function(P,E){var _;if((arguments.length>2&&arguments[2]!==void 0&&arguments[2])===!0)_=Array.from({length:E},function(){return P[Math.floor(Math.random()*P.length)]});else{if(E>P.length)throw new RangeError("Sample size must be less than or equal to array length when sampling without replacement.");_=P.map(function(k){return[k,Math.random()]}).sort(function(k,D){return k[1]<D[1]?-1:1}).slice(0,E).map(function(k){return k[0]})}return _},Ml=function(){function P(){pe()(this,P),this.isTrained=!1,this.isCompiled=!1,this.isLayered=!1,this.model=null,this.init=this.init.bind(this),this.createModel=this.createModel.bind(this),this.addLayer=this.addLayer.bind(this),this.compile=this.compile.bind(this),this.setOptimizerFunction=this.setOptimizerFunction.bind(this),this.train=this.train.bind(this),this.trainInternal=this.trainInternal.bind(this),this.predict=this.predict.bind(this),this.classify=this.classify.bind(this),this.save=this.save.bind(this),this.load=this.load.bind(this),this.init()}return Fe()(P,[{key:"init",value:function(){this.createModel()}},{key:"createModel",value:function(){switch((arguments.length>0&&arguments[0]!==void 0?arguments[0]:"sequential").toLowerCase()){case"sequential":default:return this.model=F.sequential(),this.model}}},{key:"addLayer",value:function(E){var _=E||{};this.model.add(_),this.model.layers.length>=2&&(this.isLayered=!0)}},{key:"compile",value:function(E){this.model.compile(E),this.isCompiled=!0}},{key:"setOptimizerFunction",value:function(E,_){return _.call(this,E)}},{key:"train",value:function(E,_){return ft(this.trainInternal(E),_)}},{key:"trainInternal",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee,de,_e,Re,De,tt;return Ae.a.wrap(function(st){for(;;)switch(st.prev=st.next){case 0:return q=(D=k).inputs,ee=D.outputs,de=D.batchSize,_e=D.epochs,Re=D.shuffle,De=D.validationSplit,tt=D.whileTraining,st.next=6,this.model.fit(q,ee,{batchSize:de,epochs:_e,shuffle:Re,validationSplit:De,callbacks:tt});case 6:q.dispose(),ee.dispose(),this.isTrained=!0;case 9:case"end":return st.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"predictSync",value:function(E){var _=this,k=F.tidy(function(){return _.model.predict(E)}),D=k.arraySync();return k.dispose(),E.dispose(),D}},{key:"predict",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee=this;return Ae.a.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:return D=F.tidy(function(){return ee.model.predict(k)}),de.next=3,D.array();case 3:return q=de.sent,D.dispose(),k.dispose(),de.abrupt("return",q);case 7:case"end":return de.stop()}},_)}));return function(_){return E.apply(this,arguments)}}()},{key:"classify",value:function(){var E=J()(Ae.a.mark(function _(k){return Ae.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.abrupt("return",this.predict(k));case 1:case"end":return D.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"classifySync",value:function(E){return this.predictSync(E)}},{key:"save",value:function(){var E=J()(Ae.a.mark(function _(k,D){var q,ee,de=this;return Ae.a.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:typeof k=="function"?(q="model",ee=k):typeof k=="string"?(q=k,typeof D=="function"&&(ee=D)):q="model",this.model.save(F.io.withSaveHandler(function(){var Re=J()(Ae.a.mark(function De(tt){return Ae.a.wrap(function(st){for(;;)switch(st.prev=st.next){case 0:return de.weightsManifest={modelTopology:tt.modelTopology,weightsManifest:[{paths:["./".concat(q,".weights.bin")],weights:tt.weightSpecs}]},st.next=3,ai(tt.weightData,"".concat(q,".weights.bin"),"application/octet-stream");case 3:return st.next=5,ai(JSON.stringify(de.weightsManifest),"".concat(q,".json"),"text/plain");case 5:ee&&ee();case 6:case"end":return st.stop()}},De)}));return function(De){return Re.apply(this,arguments)}}()));case 2:case"end":return _e.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"load",value:function(){var E=J()(Ae.a.mark(function _(){var k,D,q,ee,de,_e,Re,De,tt,st,It,Bt=arguments;return Ae.a.wrap(function(mn){for(;;)switch(mn.prev=mn.next){case 0:if(k=Bt.length>0&&Bt[0]!==void 0?Bt[0]:null,D=Bt.length>1?Bt[1]:void 0,!(k instanceof FileList)){mn.next=13;break}return mn.next=5,Promise.all(Array.from(k).map(function(){var xn=J()(Ae.a.mark(function Fn(Rn){var Ln;return Ae.a.wrap(function(Zn){for(;;)switch(Zn.prev=Zn.next){case 0:if(!Rn.name.includes(".json")||Rn.name.includes("_meta")){Zn.next=4;break}return Zn.abrupt("return",{name:"model",file:Rn});case 4:if(!Rn.name.includes(".json")||!Rn.name.includes("_meta.json")){Zn.next=11;break}return Zn.next=7,Rn.text();case 7:return Ln=Zn.sent,Zn.abrupt("return",{name:"metadata",file:Ln});case 11:if(!Rn.name.includes(".bin")){Zn.next=13;break}return Zn.abrupt("return",{name:"weights",file:Rn});case 13:return Zn.abrupt("return",{name:null,file:null});case 14:case"end":return Zn.stop()}},Fn)}));return function(Fn){return xn.apply(this,arguments)}}()));case 5:return q=mn.sent,ee=q.find(function(xn){return xn.name==="model"}).file,de=q.find(function(xn){return xn.name==="weights"}).file,mn.next=10,F.loadLayersModel(F.io.browserFiles([ee,de]));case 10:this.model=mn.sent,mn.next=32;break;case 13:if(!(k instanceof Object)){mn.next=29;break}return mn.next=16,en.a.get(k.model,{responseType:"text"});case 16:return _e=mn.sent,Re=JSON.stringify(_e.data),De=new File([Re],"model.json",{type:"application/json"}),mn.next=21,en.a.get(k.weights,{responseType:"blob"});case 21:return tt=mn.sent,st=tt.data,It=new File([st],"model.weights.bin",{type:"application/macbinary"}),mn.next=26,F.loadLayersModel(F.io.browserFiles([De,It]));case 26:this.model=mn.sent,mn.next=32;break;case 29:return mn.next=31,F.loadLayersModel(k);case 31:this.model=mn.sent;case 32:return this.isCompiled=!0,this.isLayered=!0,this.isTrained=!0,D&&D(),mn.abrupt("return",this.model);case 37:case"end":return mn.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()},{key:"dispose",value:function(){this.model.dispose()}},{key:"mutate",value:function(){var E=this,_=arguments.length>0&&arguments[0]!==void 0?arguments[0]:.1,k=arguments.length>1?arguments[1]:void 0;F.tidy(function(){for(var D=E.model.getWeights(),q=[],ee=0;ee<D.length;ee+=1){for(var de=D[ee],_e=D[ee].shape,Re=de.dataSync().slice(),De=0;De<Re.length;De+=1)Math.random()<_&&(Re[De]=k?k(Re[De]):Math.min(Math.max(Re[De]+jm(),-1),1));var tt=F.tensor(Re,_e);q[ee]=tt}E.model.setWeights(q)})}},{key:"crossover",value:function(E){var _=this;return F.tidy(function(){for(var k=_.model.getWeights(),D=E.model.getWeights(),q=[],ee=0;ee<k.length;ee+=1){for(var de=k[ee],_e=D[ee],Re=k[ee].shape,De=de.dataSync().slice(),tt=_e.dataSync().slice(),st=0;st<De.length;st+=1)Math.random()<.5&&(De[st]=tt[st]);var It=F.tensor(De,Re);q[ee]=It}_.model.setWeights(q)})}}]),P}();function Uh(P,E){var _=Object.keys(P);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(P);E&&(k=k.filter(function(D){return Object.getOwnPropertyDescriptor(P,D).enumerable})),_.push.apply(_,k)}return _}function Wh(P){for(var E=1;E<arguments.length;E++){var _=arguments[E]!=null?arguments[E]:{};E%2?Uh(Object(_),!0).forEach(function(k){te()(P,k,_[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(P,Object.getOwnPropertyDescriptors(_)):Uh(Object(_)).forEach(function(k){Object.defineProperty(P,k,Object.getOwnPropertyDescriptor(_,k))})}return P}var Os=new(function(){function P(E){pe()(this,P),this.options=E||{}}return Fe()(P,[{key:"normalizeValue",value:function(E,_,k){return(E-_)/(k-_)}},{key:"unnormalizeValue",value:function(E,_,k){return E*(k-_)+_}},{key:"getMin",value:function(E){return E.reduce(function(_,k){return Math.min(_,k)})}},{key:"getMax",value:function(E){return E.reduce(function(_,k){return Math.max(_,k)})}},{key:"isJsonOrString",value:function(E){try{JSON.parse(E)}catch{return!1}return!0}},{key:"zipArrays",value:function(E,_){return E.length!==_.length?(console.error("arrays do not have the same length"),[]):Eo()(new Array(E.length).fill(null)).map(function(k,D){return Wh(Wh({},E[D]),_[D])})}},{key:"createLabelsFromArrayValues",value:function(E,_){var k;return Array.isArray(E)&&(k=E.map(function(D,q){return"".concat(_,"_").concat(q)})),k}},{key:"formatDataAsObject",value:function(E,_){var k={};if(Array.isArray(E))return E.forEach(function(D,q){var ee=_[q];k[ee]=D}),k;if(Ce()(E)==="object")return k=E;throw new Error("input provided is not supported or does not match your output label specifications")}},{key:"getDataType",value:function(E){var _=Ce()(E);return _==="object"&&Array.isArray(E)&&(_="array"),_}}]),P}());function nh(P,E){var _=Object.keys(P);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(P);E&&(k=k.filter(function(D){return Object.getOwnPropertyDescriptor(P,D).enumerable})),_.push.apply(_,k)}return _}function Yu(P){for(var E=1;E<arguments.length;E++){var _=arguments[E]!=null?arguments[E]:{};E%2?nh(Object(_),!0).forEach(function(k){te()(P,k,_[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(P,Object.getOwnPropertyDescriptors(_)):nh(Object(_)).forEach(function(k){Object.defineProperty(P,k,Object.getOwnPropertyDescriptor(_,k))})}return P}var Vh=function(){function P(){pe()(this,P),this.meta={inputUnits:null,outputUnits:null,inputs:{},outputs:{},isNormalized:!1},this.isMetadataReady=!1,this.isWarmedUp=!1,this.data={raw:[]},this.createMetadata=this.createMetadata.bind(this),this.getDataStats=this.getDataStats.bind(this),this.getInputMetaStats=this.getInputMetaStats.bind(this),this.getDataUnits=this.getDataUnits.bind(this),this.getInputMetaUnits=this.getInputMetaUnits.bind(this),this.getDTypesFromData=this.getDTypesFromData.bind(this),this.addData=this.addData.bind(this),this.convertRawToTensors=this.convertRawToTensors.bind(this),this.normalizeDataRaw=this.normalizeDataRaw.bind(this),this.normalizeInputData=this.normalizeInputData.bind(this),this.normalizeArray=this.normalizeArray.bind(this),this.unnormalizeArray=this.unnormalizeArray.bind(this),this.applyOneHotEncodingsToDataRaw=this.applyOneHotEncodingsToDataRaw.bind(this),this.getDataOneHot=this.getDataOneHot.bind(this),this.getInputMetaOneHot=this.getInputMetaOneHot.bind(this),this.createOneHotEncodings=this.createOneHotEncodings.bind(this),this.loadDataFromUrl=this.loadDataFromUrl.bind(this),this.loadJSON=this.loadJSON.bind(this),this.loadCSV=this.loadCSV.bind(this),this.loadBlob=this.loadBlob.bind(this),this.loadData=this.loadData.bind(this),this.saveData=this.saveData.bind(this),this.saveMeta=this.saveMeta.bind(this),this.loadMeta=this.loadMeta.bind(this),this.findEntries=this.findEntries.bind(this),this.formatRawData=this.formatRawData.bind(this),this.csvToJSON=this.csvToJSON.bind(this)}return Fe()(P,[{key:"createMetadata",value:function(E){var _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return this.getDTypesFromData(E),this.getDataStats(E),this.getDataOneHot(E),this.getDataUnits(E,_),this.isMetadataReady=!0,Yu({},this.meta)}},{key:"getDataStats",value:function(E){var _=Object.assign({},this.meta),k=this.getInputMetaStats(E,_.inputs,"xs"),D=this.getInputMetaStats(E,_.outputs,"ys");return _.inputs=k,_.outputs=D,this.meta=Yu(Yu({},this.meta),_),_}},{key:"getInputMetaStats",value:function(E,_,k){var D=Object.assign({},_);return Object.keys(D).forEach(function(q){if(D[q].dtype==="string")D[q].min=0,D[q].max=1;else if(D[q].dtype==="number"){var ee=E.map(function(_e){return _e[k][q]});D[q].min=Os.getMin(ee),D[q].max=Os.getMax(ee)}else if(D[q].dtype==="array"){var de=E.map(function(_e){return _e[k][q]}).flat();D[q].min=Os.getMin(de),D[q].max=Os.getMax(de)}}),D}},{key:"getDataUnits",value:function(E){var _,k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,D=k!==null?k:void 0,q=Object.assign({},this.meta);_=D||[this.getInputMetaUnits(E,q.inputs)].flat();var ee=this.getInputMetaUnits(E,q.outputs);return q.inputUnits=_,q.outputUnits=ee,this.meta=Yu(Yu({},this.meta),q),q}},{key:"getInputMetaUnits",value:function(E,_){var k=0,D=Object.assign({},_);return Object.entries(D).forEach(function(q){var ee=q[1].dtype;if(ee==="number")k+=1;else if(ee==="string"){var de=q[1].uniqueValues.length;k+=de}else ee==="array"&&(k=[])}),k}},{key:"getDTypesFromData",value:function(E){var _=Yu(Yu({},this.meta),{},{inputs:{},outputs:{}}),k=E[0],D=Object.keys(k.xs),q=Object.keys(k.ys);return D.forEach(function(ee){_.inputs[ee]={dtype:Os.getDataType(k.xs[ee])}}),q.forEach(function(ee){_.outputs[ee]={dtype:Os.getDataType(k.ys[ee])}}),this.meta=_,_}},{key:"addData",value:function(E,_){this.data.raw.push({xs:E,ys:_})}},{key:"convertRawToTensors",value:function(E){var _=Object.assign({},this.meta),k=E.length;return F.tidy(function(){var D=[],q=[];return E.forEach(function(ee){var de=Object.keys(_.inputs).map(function(Re){return ee.xs[Re]}).flat();D.push(de);var _e=Object.keys(_.outputs).map(function(Re){return ee.ys[Re]}).flat();q.push(_e)}),{inputs:F.tensor(D.flat(),[k].concat(Eo()(_.inputUnits))),outputs:F.tensor(q.flat(),[k,_.outputUnits])}})}},{key:"normalizeDataRaw",value:function(E){var _=Object.assign({},this.meta),k=this.normalizeInputData(E,_.inputs,"xs"),D=this.normalizeInputData(E,_.outputs,"ys");return Os.zipArrays(k,D)}},{key:"normalizeInputData",value:function(E,_,k){var D=this,q=E.length,ee=Object.assign({},_),de={};return Object.keys(ee).forEach(function(_e){var Re={min:ee[_e].min,max:ee[_e].max},De=E.map(function(tt){return tt[k][_e]});ee[_e].dtype==="string"?(Re.legend=ee[_e].legend,de[_e]=D.normalizeArray(De,Re)):ee[_e].dtype==="number"?de[_e]=D.normalizeArray(De,Re):ee[_e].dtype==="array"&&(de[_e]=De.map(function(tt){return D.normalizeArray(tt,Re)}))}),Eo()(new Array(q).fill(null)).map(function(_e,Re){var De=te()({},k,{});return Object.keys(ee).forEach(function(tt){De[k][tt]=de[tt][Re]}),De})}},{key:"normalizeArray",value:function(E,_){var k=_.min,D=_.max;if(_.legend)return E.map(function(q){return _.legend[q]?_.legend[q]:q});if(E.every(function(q){return typeof q=="number"}))return E.map(function(q){return Os.normalizeValue(q,k,D)});throw new Error("error in inputArray of normalizeArray() function")}},{key:"unnormalizeArray",value:function(E,_){var k=_.min,D=_.max;if(_.legend)return E.map(function(q){var ee;return Object.entries(_.legend).forEach(function(de){var _e=de[0],Re=de[1];q.map(function(De,tt){return De===Re[tt]}).every(function(De){return De===!0})&&(ee=_e)}),ee});if(E.every(function(q){return typeof q=="number"}))return E.map(function(q){return Os.unnormalizeValue(q,k,D)});throw new Error("error in inputArray of normalizeArray() function")}},{key:"applyOneHotEncodingsToDataRaw",value:function(E){var _=Object.assign({},this.meta);return E.map(function(k){var D=Yu({},k.xs),q=Yu({},k.ys);return Object.keys(_.inputs).forEach(function(ee){_.inputs[ee].legend&&(D[ee]=_.inputs[ee].legend[k.xs[ee]])}),Object.keys(_.outputs).forEach(function(ee){_.outputs[ee].legend&&(q[ee]=_.outputs[ee].legend[k.ys[ee]])}),{xs:D,ys:q}})}},{key:"getDataOneHot",value:function(E){var _=Object.assign({},this.meta),k=this.getInputMetaOneHot(E,_.inputs,"xs"),D=this.getInputMetaOneHot(E,_.outputs,"ys");return _.inputs=k,_.outputs=D,this.meta=Yu(Yu({},this.meta),_),_}},{key:"getInputMetaOneHot",value:function(E,_,k){var D=this,q=Object.assign({},_);return Object.entries(q).forEach(function(ee){var de=ee[0];if(ee[1].dtype==="string"){var _e=Eo()(new Set(E.map(function(De){return De[k][de]}))),Re=D.createOneHotEncodings(_e);q[de]=Yu(Yu({},q[de]),Re)}}),q}},{key:"createOneHotEncodings",value:function(E){return F.tidy(function(){var _={uniqueValues:E,legend:{}},k=E,D=k.map(function(ee,de){return de}),q=F.oneHot(F.tensor1d(D,"int32"),k.length).arraySync();return k.forEach(function(ee,de){_.legend[ee]=q[de]}),_})}},{key:"loadDataFromUrl",value:function(){var E=J()(Ae.a.mark(function _(k,D,q){var ee;return Ae.a.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:if(de.prev=0,!k.endsWith(".csv")){de.next=7;break}return de.next=4,this.loadCSV(k,D,q);case 4:ee=de.sent,de.next=20;break;case 7:if(!k.endsWith(".json")){de.next=13;break}return de.next=10,this.loadJSON(k,D,q);case 10:ee=de.sent,de.next=20;break;case 13:if(!k.includes("blob")){de.next=19;break}return de.next=16,this.loadBlob(k,D,q);case 16:ee=de.sent,de.next=20;break;case 19:throw new Error("Not a valid data format. Must be csv or json");case 20:return de.abrupt("return",ee);case 23:throw de.prev=23,de.t0=de.catch(0),console.error(de.t0),new Error(de.t0);case 27:case"end":return de.stop()}},_,this,[[0,23]])}));return function(_,k,D){return E.apply(this,arguments)}}()},{key:"loadJSON",value:function(){var E=J()(Ae.a.mark(function _(k,D,q){var ee,de,_e,Re;return Ae.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(De.prev=0,!(k instanceof Object)){De.next=5;break}ee=Object.assign({},k),De.next=10;break;case 5:return De.next=7,en.a.get(k);case 7:de=De.sent,_e=de.data,ee=_e;case 10:return Re=this.formatRawData(ee,D,q),De.abrupt("return",Re);case 14:throw De.prev=14,De.t0=De.catch(0),console.error("error loading json"),new Error(De.t0);case 18:case"end":return De.stop()}},_,this,[[0,14]])}));return function(_,k,D){return E.apply(this,arguments)}}()},{key:"loadCSV",value:function(){var E=J()(Ae.a.mark(function _(k,D,q){var ee,de,_e,Re;return Ae.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return De.prev=0,ee=F.data.csv(k),De.next=4,ee.toArray();case 4:return de=De.sent,_e={entries:de},Re=this.formatRawData(_e,D,q),De.abrupt("return",Re);case 10:throw De.prev=10,De.t0=De.catch(0),console.error("error loading csv",De.t0),new Error(De.t0);case 14:case"end":return De.stop()}},_,this,[[0,10]])}));return function(_,k,D){return E.apply(this,arguments)}}()},{key:"loadBlob",value:function(){var E=J()(Ae.a.mark(function _(k,D,q){var ee,de,_e,Re,De,tt;return Ae.a.wrap(function(st){for(;;)switch(st.prev=st.next){case 0:return st.prev=0,st.next=3,en.a.get(k);case 3:if(ee=st.sent,de=ee.data,_e=de,!Os.isJsonOrString(_e)){st.next=13;break}return De=JSON.parse(_e),st.next=10,this.loadJSON(De,D,q);case 10:Re=st.sent,st.next=17;break;case 13:return tt=this.csvToJSON(_e),st.next=16,this.loadJSON(tt,D,q);case 16:Re=st.sent;case 17:return st.abrupt("return",Re);case 20:throw st.prev=20,st.t0=st.catch(0),console.log("mmm might be passing in a string or something!",st.t0),new Error(st.t0);case 24:case"end":return st.stop()}},_,this,[[0,20]])}));return function(_,k,D){return E.apply(this,arguments)}}()},{key:"loadData",value:function(){var E=J()(Ae.a.mark(function _(){var k,D,q,ee,de,_e,Re=arguments;return Ae.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(k=Re.length>0&&Re[0]!==void 0?Re[0]:null,D=Re.length>1?Re[1]:void 0,De.prev=2,typeof k=="string"){De.next=17;break}if(ee=k[0],new FileReader().readAsText(ee),!ee.name.includes(".json")){De.next=14;break}return De.next=10,ee.text();case 10:de=De.sent,q=JSON.parse(de),De.next=15;break;case 14:console.log('data must be a json object containing an array called "data" or "entries');case 15:De.next=22;break;case 17:return De.next=19,en.a.get(k,{responseType:"text"});case 19:q=De.sent,_e=JSON.stringify(q.data),Os.isJsonOrString(_e)?q=JSON.parse(_e):console.log("Whoops! something went wrong. Either this kind of data is not supported yet or there is an issue with .loadData");case 22:this.data.raw=this.findEntries(q),!this.data.raw.length>0&&console.log('data must be a json object containing an array called "data" '),D&&D(),De.next=30;break;case 27:throw De.prev=27,De.t0=De.catch(2),new Error(De.t0);case 30:case"end":return De.stop()}},_,this,[[2,27]])}));return function(){return E.apply(this,arguments)}}()},{key:"saveData",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee,de,_e,Re;return Ae.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return D=new Date,q="".concat(String(D.getFullYear()),"-").concat(String(D.getMonth()+1),"-").concat(String(D.getDate())),ee="".concat(String(D.getHours()),"-").concat(String(D.getMinutes()),"-").concat(String(D.getSeconds())),de="".concat(q,"_").concat(ee),_e=de,k&&(_e=k),Re={data:this.data.raw},De.next=9,ai(JSON.stringify(Re),"".concat(_e,".json"),"text/plain");case 9:case"end":return De.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"saveMeta",value:function(){var E=J()(Ae.a.mark(function _(k,D){var q,ee;return Ae.a.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:return typeof k=="function"?(q="model",ee=k):typeof k=="string"?(q=k,typeof D=="function"&&(ee=D)):q="model",de.next=3,ai(JSON.stringify(this.meta),"".concat(q,"_meta.json"),"text/plain");case 3:ee&&ee();case 4:case"end":return de.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"loadMeta",value:function(){var E=J()(Ae.a.mark(function _(){var k,D,q,ee,de,_e,Re,De=arguments;return Ae.a.wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:if(k=De.length>0&&De[0]!==void 0?De[0]:null,D=De.length>1?De[1]:void 0,!(k instanceof FileList)){tt.next=10;break}return tt.next=5,Promise.all(Array.from(k).map(function(){var st=J()(Ae.a.mark(function It(Bt){var mn;return Ae.a.wrap(function(xn){for(;;)switch(xn.prev=xn.next){case 0:if(!Bt.name.includes(".json")||Bt.name.includes("_meta")){xn.next=4;break}return xn.abrupt("return",{name:"model",file:Bt});case 4:if(!Bt.name.includes(".json")||!Bt.name.includes("_meta.json")){xn.next=11;break}return xn.next=7,Bt.text();case 7:return mn=xn.sent,xn.abrupt("return",{name:"metadata",file:mn});case 11:if(!Bt.name.includes(".bin")){xn.next=13;break}return xn.abrupt("return",{name:"weights",file:Bt});case 13:return xn.abrupt("return",{name:null,file:null});case 14:case"end":return xn.stop()}},It)}));return function(It){return st.apply(this,arguments)}}()));case 5:q=tt.sent,ee=JSON.parse(q.find(function(st){return st.name==="metadata"}).file),this.meta=ee,tt.next=25;break;case 10:if(!(k instanceof Object)){tt.next=19;break}return tt.next=13,en.a.get(k.metadata,{responseType:"text"});case 13:de=tt.sent,de=JSON.stringify(de.data),de=JSON.parse(de),this.meta=de,tt.next=25;break;case 19:return _e="".concat(k.substring(0,k.lastIndexOf("/")),"/model_meta.json"),tt.next=22,en.a.get(_e);case 22:Re=(Re=tt.sent).data,this.meta=Re;case 25:return this.isMetadataReady=!0,this.isWarmedUp=!0,D&&D(),tt.abrupt("return",this.meta);case 29:case"end":return tt.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()},{key:"formatRawData",value:function(E,_,k){var D=this.findEntries(E);!D.length>0&&console.log(`your data must be contained in an array in 

        a property called 'entries' or 'data' of your json object`);var q=D.map(function(ee,de){var _e={xs:{},ys:{}};return _.forEach(function(Re){ee[Re]!==void 0?_e.xs[Re]=ee[Re]:console.error("the input label ".concat(Re," does not exist at row ").concat(de))}),k.forEach(function(Re){ee[Re]!==void 0?_e.ys[Re]=ee[Re]:console.error("the output label ".concat(Re," does not exist at row ").concat(de))}),_e});return this.data.raw=q,q}},{key:"csvToJSON",value:function(E){for(var _=E.split(`
`),k=[],D=_[0].split(","),q=function(de){var _e={},Re=_[de].split(",");D.forEach(function(De,tt){_e[De]=Re[tt]}),k.push(_e)},ee=1;ee<_.length;ee+=1)q(ee);return{entries:k}}},{key:"findEntries",value:function(E){var _=this,k=Object.assign({},E);return k.entries&&k.entries instanceof Array?k.entries:k.data&&k.data instanceof Array?k.data:(Object.keys(k).forEach(function(D){if(Ce()(k[D])==="object")return _.findEntries(k[D])}),k)}},{key:"getData",value:function(){return this.data.raw}}]),P}();function Ss(P,E){var _=Object.keys(P);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(P);E&&(k=k.filter(function(D){return Object.getOwnPropertyDescriptor(P,D).enumerable})),_.push.apply(_,k)}return _}var lu=function(){function P(){pe()(this,P),this.config={height:300}}return Fe()(P,[{key:"modelSummary",value:function(E,_){var k=function(D){for(var q=1;q<arguments.length;q++){var ee=arguments[q]!=null?arguments[q]:{};q%2?Ss(Object(ee),!0).forEach(function(de){te()(D,de,ee[de])}):Object.getOwnPropertyDescriptors?Object.defineProperties(D,Object.getOwnPropertyDescriptors(ee)):Ss(Object(ee)).forEach(function(de){Object.defineProperty(D,de,Object.getOwnPropertyDescriptor(ee,de))})}return D}({},E);ue.show.modelSummary(k,_)}},{key:"scatterplot",value:function(E,_,k){var D=k.map(function(ee){return{x:ee.xs[E],y:ee.ys[_]}}),q={xLabel:"X",yLabel:"Y",height:this.config.height};ue.render.scatterplot({name:"debug mode"},D,q)}},{key:"scatterplotAll",value:function(E,_,k){var D=[];E.forEach(function(ee){_.forEach(function(de){var _e=k.map(function(Re){return{x:Re.xs[ee],y:Re.ys[de]}});D=[].concat(Eo()(D),Eo()(_e))})});var q={xLabel:"X",yLabel:"Y",height:this.config.height};ue.render.scatterplot({name:"debug mode"},D,q)}},{key:"barchart",value:function(E,_,k){var D=k.map(function(ee){return{value:ee.xs[E],index:ee.ys[_]}}),q={xLabel:"label",yLabel:"value",height:this.config.height};console.log(q),ue.render.barchart({name:"Bar chart"},D)}},{key:"trainingVis",value:function(){return ue.show.fitCallbacks({name:"Training Performance"},["loss","accuracy"],{height:this.config.height,callbacks:["onEpochEnd"]})}}]),P}();function Gp(P,E){var _=Object.keys(P);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(P);E&&(k=k.filter(function(D){return Object.getOwnPropertyDescriptor(P,D).enumerable})),_.push.apply(_,k)}return _}function wd(P){for(var E=1;E<arguments.length;E++){var _=arguments[E]!=null?arguments[E]:{};E%2?Gp(Object(_),!0).forEach(function(k){te()(P,k,_[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(P,Object.getOwnPropertyDescriptors(_)):Gp(Object(_)).forEach(function(k){Object.defineProperty(P,k,Object.getOwnPropertyDescriptor(_,k))})}return P}var rh={inputs:[],outputs:[],dataUrl:null,modelUrl:null,layers:[],task:null,debug:!1,learningRate:.2,hiddenUnits:16,noTraining:!1},$p=function(){function P(E,_){pe()(this,P),this.callback=_,E.task==="imageClassification"&&(rh.learningRate=.02),this.options=wd(wd({},rh),E)||rh,this.neuralNetwork=new Ml,this.neuralNetworkData=new Vh,this.neuralNetworkVis=new lu,this.data={training:[]},this.ready=!1,this.init=this.init.bind(this),this.addData=this.addData.bind(this),this.loadDataFromUrl=this.loadDataFromUrl.bind(this),this.loadDataInternal=this.loadDataInternal.bind(this),this.createMetaData=this.createMetaData.bind(this),this.prepareForTraining=this.prepareForTraining.bind(this),this.normalizeData=this.normalizeData.bind(this),this.normalizeInput=this.normalizeInput.bind(this),this.searchAndFormat=this.searchAndFormat.bind(this),this.formatInputItem=this.formatInputItem.bind(this),this.convertTrainingDataToTensors=this.convertTrainingDataToTensors.bind(this),this.formatInputsForPrediction=this.formatInputsForPrediction.bind(this),this.formatInputsForPredictionAll=this.formatInputsForPredictionAll.bind(this),this.isOneHotEncodedOrNormalized=this.isOneHotEncodedOrNormalized.bind(this),this.train=this.train.bind(this),this.trainInternal=this.trainInternal.bind(this),this.addLayer=this.addLayer.bind(this),this.createNetworkLayers=this.createNetworkLayers.bind(this),this.addDefaultLayers=this.addDefaultLayers.bind(this),this.compile=this.compile.bind(this),this.predict=this.predict.bind(this),this.predictMultiple=this.predictMultiple.bind(this),this.classify=this.classify.bind(this),this.classifyMultiple=this.classifyMultiple.bind(this),this.predictInternal=this.predictInternal.bind(this),this.classifyInternal=this.classifyInternal.bind(this),this.saveData=this.saveData.bind(this),this.loadData=this.loadData.bind(this),this.save=this.save.bind(this),this.load=this.load.bind(this),this.dispose=this.dispose.bind(this),this.mutate=this.mutate.bind(this),this.crossover=this.crossover.bind(this),this.init(this.callback)}return Fe()(P,[{key:"init",value:function(E){this.options.noTraining===!0&&this.createLayersNoTraining(),this.options.dataUrl!==null?this.ready=this.loadDataFromUrl(this.options,E):this.options.modelUrl!==null?this.ready=this.load(this.options.modelUrl,E):this.ready=!0}},{key:"createLayersNoTraining",value:function(){var E=this.options,_=E.inputs,k=E.outputs;if(E.task==="classification")for(var D=0;D<k.length;D+=1){var q=new Array(_).fill(0);this.addData(q,[k[D]])}else{var ee=new Array(_).fill(0),de=new Array(k).fill(0);this.addData(ee,de)}this.neuralNetworkData.createMetadata(this.neuralNetworkData.data.raw),this.addDefaultLayers(this.options.task,this.neuralNetworkData.meta)}},{key:"copy",value:function(){var E=this,_=new P(this.options);return F.tidy(function(){for(var k=E.neuralNetwork.model.getWeights(),D=[],q=0;q<k.length;q+=1)D[q]=k[q].clone();return _.neuralNetwork.model.setWeights(D),_})}},{key:"addData",value:function(E,_){var k,D,q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,ee=this.options,de=ee.inputs,_e=ee.outputs;if(q!==null?(k=q.inputLabels,D=q.outputLabels):de.length>0&&_e.length>0?(de.every(function(st){return typeof st=="string"})&&(k=de),_e.every(function(st){return typeof st=="string"})&&(D=_e)):Ce()(E)==="object"&&Ce()(_)==="object"?(k=Object.keys(E),D=Object.keys(_)):(k=Os.createLabelsFromArrayValues(E,"input"),D=Os.createLabelsFromArrayValues(_,"output")),!(k instanceof Array))throw new Error("inputLabels must be an array");if(!(D instanceof Array))throw new Error("outputLabels must be an array");var Re=this.searchAndFormat(E),De=Os.formatDataAsObject(Re,k),tt=Os.formatDataAsObject(_,D);this.neuralNetworkData.addData(De,tt)}},{key:"loadDataFromUrl",value:function(E,_){return ft(this.loadDataInternal(E),_)}},{key:"loadDataInternal",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee,de;return Ae.a.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:return D=k.dataUrl,q=k.inputs,ee=k.outputs,_e.next=3,this.neuralNetworkData.loadDataFromUrl(D,q,ee);case 3:de=_e.sent,this.createMetadata(de),this.prepareForTraining(de);case 6:case"end":return _e.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"createMetaData",value:function(E){var _,k=this.options.inputs;Array.isArray(k)&&k.length>0&&(_=k.every(function(D){return typeof D=="number"})&&k.length>0?k:null),this.neuralNetworkData.createMetadata(E,_)}},{key:"prepareForTraining",value:function(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,_=E===null?this.neuralNetworkData.data.raw:E,k=this.neuralNetworkData.applyOneHotEncodingsToDataRaw(_);return this.data.training=k,this.neuralNetworkData.isWarmedUp=!0,k}},{key:"normalizeData",value:function(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,_=E===null?this.neuralNetworkData.data.raw:E;this.neuralNetworkData.isMetadataReady||this.createMetaData(_),this.neuralNetworkData.isWarmedUp||this.prepareForTraining(_);var k=this.neuralNetworkData.normalizeDataRaw(_);return this.data.training=k,this.neuralNetworkData.meta.isNormalized=!0,k}},{key:"normalizeInput",value:function(E,_,k){var D=k[_],q=D.min,ee=D.max;return Os.normalizeValue(E,q,ee)}},{key:"searchAndFormat",value:function(E){var _,k=this;if(Array.isArray(E))_=E.map(function(q){return k.formatInputItem(q)});else if(Ce()(E)==="object"){var D=Object.assign({},E);Object.keys(E).forEach(function(q){var ee=E[q];D[q]=k.formatInputItem(ee)}),_=D}return _}},{key:"formatInputItem",value:function(E){var _;return jn(E)?_=E:Ce()(E)==="object"&&jn(E.elt)?_=E.elt:Ce()(E)==="object"&&jn(E.canvas)&&(_=E.canvas),_?Fr(_):E}},{key:"convertTrainingDataToTensors",value:function(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,k=E===null?this.data.training:E,D=_===null?this.neuralNetworkData.meta:_;return this.neuralNetworkData.convertRawToTensors(k,D)}},{key:"formatInputsForPrediction",value:function(E,_,k){var D=this,q=[];return E instanceof Array?q=k.map(function(ee,de){return D.isOneHotEncodedOrNormalized(E[de],ee,_.inputs)}):E instanceof Object&&(q=k.map(function(ee){return D.isOneHotEncodedOrNormalized(E[ee],ee,_.inputs)})),q=q.flat()}},{key:"formatInputsForPredictionAll",value:function(E,_,k){var D,q=this;return E instanceof Array&&E.every(function(ee){return Array.isArray(ee)})?(D=E.map(function(ee){return q.formatInputsForPrediction(ee,_,k)}),F.tensor(D,[E.length,k.length])):(D=this.formatInputsForPrediction(E,_,k),F.tensor([D]))}},{key:"isOneHotEncodedOrNormalized",value:function(E,_,k){var D,q=E,ee=_;return typeof E!="number"?D=k[ee].legend[q]:(D=E,this.neuralNetworkData.meta.isNormalized&&(D=this.normalizeInput(E,ee,k))),D}},{key:"train",value:function(E,_,k){var D,q,ee;Ce()(E)==="object"&&typeof _=="function"&&typeof k=="function"?(D=E,q=_,ee=k):Ce()(E)==="object"&&typeof _=="function"?(D=E,q=null,ee=_):typeof E=="function"&&typeof _=="function"?(D={},q=E,ee=_):(D={},q=null,ee=E),this.trainInternal(D,q,ee)}},{key:"trainInternal",value:function(E,_,k){var D=wd({epochs:10,batchSize:32,validationSplit:.1,whileTraining:null},E);if(this.options.debug===!0||this.options.debug==="true"?D.whileTraining=[this.neuralNetworkVis.trainingVis(),{onEpochEnd:_}]:D.whileTraining=[{onEpochEnd:_}],this.neuralNetworkData.isMetadataReady||this.createMetaData(this.neuralNetworkData.data.raw),this.neuralNetworkData.isWarmedUp||this.prepareForTraining(this.neuralNetworkData.data.raw),!D.inputs&&!D.outputs){var q=this.convertTrainingDataToTensors(),ee=q.inputs,de=q.outputs;D.inputs=ee,D.outputs=de}this.neuralNetwork.isLayered||(this.options.layers=this.createNetworkLayers(this.options.layers,this.neuralNetworkData.meta)),this.neuralNetwork.isLayered||(this.options.layers=this.addDefaultLayers(this.options.task,this.neuralNetworkData.meta)),this.neuralNetwork.isCompiled||this.compile(),this.neuralNetwork.train(D,k)}},{key:"addLayer",value:function(E){this.neuralNetwork.addLayer(E)}},{key:"createNetworkLayers",value:function(E,_){var k=this,D=Eo()(E),q=Object.assign({},_),ee=q.inputUnits,de=q.outputUnits,_e=D.length;if(!(D.length>=2))return!1;D[0].inputShape=D[0].inputShape?D[0].inputShape:ee;var Re=D[_e-1];return Re.units=Re.units?Re.units:de,D.forEach(function(De){k.addLayer(F.layers[De.type](De))}),D}},{key:"addDefaultLayers",value:function(E,_){var k;switch(E.toLowerCase()){case"classification":return k=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"softmax"}],this.createNetworkLayers(k,_);case"regression":return k=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"sigmoid"}],this.createNetworkLayers(k,_);case"imageclassification":return k=[{type:"conv2d",filters:8,kernelSize:5,strides:1,activation:"relu",kernelInitializer:"varianceScaling"},{type:"maxPooling2d",poolSize:[2,2],strides:[2,2]},{type:"conv2d",filters:16,kernelSize:5,strides:1,activation:"relu",kernelInitializer:"varianceScaling"},{type:"maxPooling2d",poolSize:[2,2],strides:[2,2]},{type:"flatten"},{type:"dense",kernelInitializer:"varianceScaling",activation:"softmax"}],this.createNetworkLayers(k,_);default:return console.log("no imputUnits or outputUnits defined"),k=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"sigmoid"}],this.createNetworkLayers(k,_)}}},{key:"compile",value:function(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,k=_===null?this.options.learningRate:_,D={};E!==null?D=wd({},E):this.options.task==="classification"||this.options.task==="imageClassification"?D={loss:"categoricalCrossentropy",optimizer:F.train.sgd,metrics:["accuracy"]}:this.options.task==="regression"&&(D={loss:"meanSquaredError",optimizer:F.train.adam,metrics:["accuracy"]}),D.optimizer=D.optimizer?this.neuralNetwork.setOptimizerFunction(k,D.optimizer):this.neuralNetwork.setOptimizerFunction(k,F.train.sgd),this.neuralNetwork.compile(D),this.options.debug&&this.neuralNetworkVis.modelSummary({name:"Model Summary"},this.neuralNetwork.model)}},{key:"predictSync",value:function(E){return this.predictSyncInternal(E)}},{key:"predict",value:function(E,_){return ft(this.predictInternal(E),_)}},{key:"predictMultiple",value:function(E,_){return ft(this.predictInternal(E),_)}},{key:"classifySync",value:function(E){return this.classifySyncInternal(E)}},{key:"classify",value:function(E,_){return ft(this.classifyInternal(E),_)}},{key:"classifyMultiple",value:function(E,_){return ft(this.classifyInternal(E),_)}},{key:"predictSyncInternal",value:function(E){var _=this.neuralNetworkData.meta,k=Object.keys(_.inputs),D=this.formatInputsForPredictionAll(E,_,k),q=this.neuralNetwork.predictSync(D);if(D.dispose(),_!==null){var ee=Object.keys(_.outputs),de=q.map(function(_e){return ee.map(function(Re,De){var tt,st,It;if(_.isNormalized){var Bt=_.outputs[Re],mn=Bt.min,xn=Bt.max;st=Os.unnormalizeValue(_e[De],mn,xn),It=_e[De]}else st=_e[De];var Fn=(tt={},te()(tt,ee[De],st),te()(tt,"label",Re),te()(tt,"value",st),tt);return It&&(Fn.unNormalizedValue=It),Fn})});return de.length<2?de[0]:de}return q}},{key:"predictInternal",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee,de,_e,Re;return Ae.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return D=this.neuralNetworkData.meta,q=Object.keys(D.inputs),ee=this.formatInputsForPredictionAll(k,D,q),De.next=5,this.neuralNetwork.predict(ee);case 5:if(de=De.sent,ee.dispose(),D===null){De.next=13;break}if(_e=Object.keys(D.outputs),!((Re=de.map(function(tt){return _e.map(function(st,It){var Bt,mn,xn;if(D.isNormalized){var Fn=D.outputs[st],Rn=Fn.min,Ln=Fn.max;mn=Os.unnormalizeValue(tt[It],Rn,Ln),xn=tt[It]}else mn=tt[It];var Zn=(Bt={},te()(Bt,_e[It],mn),te()(Bt,"label",st),te()(Bt,"value",mn),Bt);return xn&&(Zn.unNormalizedValue=xn),Zn})})).length<2)){De.next=12;break}return De.abrupt("return",Re[0]);case 12:return De.abrupt("return",Re);case 13:return De.abrupt("return",de);case 14:case"end":return De.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"classifySyncInternal",value:function(E){var _,k=this.neuralNetworkData.meta,D=Object.keys(k.inputs);if(this.options.task==="imageClassification"){if(_=this.searchAndFormat(E),_=Array.isArray(_)?_.flat():_[D[0]],k.isNormalized){var q=k.inputs[D[0]],ee=q.min,de=q.max;_=this.neuralNetworkData.normalizeArray(Array.from(_),{min:ee,max:de})}else _=Array.from(_);_=F.tensor([_],[1].concat(Eo()(k.inputUnits)))}else _=this.formatInputsForPredictionAll(E,k,D);var _e=this.neuralNetwork.classifySync(_);if(_.dispose(),k!==null){var Re=Object.keys(k.outputs)[0],De=Object.entries(k.outputs[Re].legend),tt=_e.map(function(st){return De.map(function(It,Bt){var mn;return mn={},te()(mn,It[0],st[Bt]),te()(mn,"label",It[0]),te()(mn,"confidence",st[Bt]),mn}).sort(function(It,Bt){return Bt.confidence-It.confidence})});return tt.length<2?tt[0]:tt}return _e}},{key:"classifyInternal",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee,de,_e,Re,De,tt,st,It;return Ae.a.wrap(function(Bt){for(;;)switch(Bt.prev=Bt.next){case 0:return D=this.neuralNetworkData.meta,q=Object.keys(D.inputs),this.options.task==="imageClassification"?(ee=this.searchAndFormat(k),ee=Array.isArray(ee)?ee.flat():ee[q[0]],D.isNormalized?(de=D.inputs[q[0]],_e=de.min,Re=de.max,ee=this.neuralNetworkData.normalizeArray(Array.from(ee),{min:_e,max:Re})):ee=Array.from(ee),ee=F.tensor([ee],[1].concat(Eo()(D.inputUnits)))):ee=this.formatInputsForPredictionAll(k,D,q),Bt.next=5,this.neuralNetwork.classify(ee);case 5:if(De=Bt.sent,ee.dispose(),D===null){Bt.next=14;break}if(tt=Object.keys(D.outputs)[0],st=Object.entries(D.outputs[tt].legend),!((It=De.map(function(mn){return st.map(function(xn,Fn){var Rn;return Rn={},te()(Rn,xn[0],mn[Fn]),te()(Rn,"label",xn[0]),te()(Rn,"confidence",mn[Fn]),Rn}).sort(function(xn,Fn){return Fn.confidence-xn.confidence})})).length<2)){Bt.next=13;break}return Bt.abrupt("return",It[0]);case 13:return Bt.abrupt("return",It);case 14:return Bt.abrupt("return",De);case 15:case"end":return Bt.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"saveData",value:function(E){this.neuralNetworkData.saveData(E)}},{key:"loadData",value:function(){var E=J()(Ae.a.mark(function _(){var k,D,q=arguments;return Ae.a.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:k=q.length>0&&q[0]!==void 0?q[0]:null,D=q.length>1?q[1]:void 0,this.neuralNetworkData.loadData(k,D);case 3:case"end":return ee.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()},{key:"save",value:function(E,_){var k,D,q=this;typeof E=="function"?(k="model",D=E):typeof E=="string"?(k=E,typeof _=="function"&&(D=_)):k="model",this.neuralNetwork.save(k,function(){q.neuralNetworkData.saveMeta(k,D)})}},{key:"load",value:function(){var E=J()(Ae.a.mark(function _(){var k,D,q,ee=this,de=arguments;return Ae.a.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:k=de.length>0&&de[0]!==void 0?de[0]:null,(D=de.length>1?de[1]:void 0)&&(q=D),this.neuralNetwork.load(k,function(){return ee.neuralNetworkData.loadMeta(k,q),ee.neuralNetwork.model});case 4:case"end":return _e.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()},{key:"dispose",value:function(){this.neuralNetwork.dispose()}},{key:"mutate",value:function(E,_){this.neuralNetwork.mutate(E,_)}},{key:"crossover",value:function(E){var _=this.copy();return _.neuralNetwork.crossover(E.neuralNetwork),_}}]),P}(),kd=function(P,E,_){var k,D;return P instanceof Object?(k=P,D=E):(k={inputs:P,outputs:E},D=_),new $p(k,D)},ln=o(3);function Ju(P,E,_){if(_===void 0&&(_=!1),P.beginPath(),E.slice(1).forEach(function(q,ee){var de=q.x,_e=q.y,Re=E[ee];P.moveTo(Re.x,Re.y),P.lineTo(de,_e)}),_){var k=E[E.length-1],D=E[0];if(!k||!D)return;P.moveTo(k.x,k.y),P.lineTo(D.x,D.y)}P.stroke()}var er=o(5),ru=function(){function P(E,_){if(!fc(E)||!fc(_))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:E,height:_}));this._width=E,this._height=_}return Object.defineProperty(P.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),P.prototype.reverse=function(){return new P(1/this.width,1/this.height)},P}();function Fo(P,E){return P instanceof ln.Tensor&&P.shape.length===E}function cf(P){return Fo(P,1)}function jl(P){return Fo(P,2)}function wr(P){return Fo(P,3)}function fu(P){return Fo(P,4)}function Ds(P){return P%1!=0}function Ro(P){return P%2==0}function yl(P,E){E===void 0&&(E=2);var _=Math.pow(10,E);return Math.floor(P*_)/_}function nl(P){return P&&P.width&&P.height}function wu(P,E){var _=P.width,k=P.height,D=E/Math.max(k,_);return new ru(Math.round(_*D),Math.round(k*D))}function Bl(P){return P.reduce(function(E,_){return E.add(_)},new po(0,0)).div(new po(P.length,P.length))}function Kt(P,E,_){return Array(P).fill(0).map(function(k,D){return E+D*_})}function fc(P){return!!P&&P!==1/0&&P!==-1/0&&!isNaN(P)||P===0}function Mu(P){return fc(P)&&0<=P&&P<=1}var po=function(){function P(E,_){this._x=E,this._y=_}return Object.defineProperty(P.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),P.prototype.add=function(E){return new P(this.x+E.x,this.y+E.y)},P.prototype.sub=function(E){return new P(this.x-E.x,this.y-E.y)},P.prototype.mul=function(E){return new P(this.x*E.x,this.y*E.y)},P.prototype.div=function(E){return new P(this.x/E.x,this.y/E.y)},P.prototype.abs=function(){return new P(Math.abs(this.x),Math.abs(this.y))},P.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},P.prototype.floor=function(){return new P(Math.floor(this.x),Math.floor(this.y))},P}(),uo=function(){function P(E,_){_===void 0&&(_=!0);var k=E||{},D=[k.left,k.top,k.right,k.bottom].every(fc),q=[k.x,k.y,k.width,k.height].every(fc);if(!q&&!D)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(k));var ee=q?[k.x,k.y,k.width,k.height]:[k.left,k.top,k.right-k.left,k.bottom-k.top],de=ee[0],_e=ee[1],Re=ee[2],De=ee[3];P.assertIsValidBox({x:de,y:_e,width:Re,height:De},"Box.constructor",_),this._x=de,this._y=_e,this._width=Re,this._height=De}return P.isRect=function(E){return!!E&&[E.x,E.y,E.width,E.height].every(fc)},P.assertIsValidBox=function(E,_,k){if(k===void 0&&(k=!1),!P.isRect(E))throw new Error(_+" - invalid box: "+JSON.stringify(E)+", expected object with properties x, y, width, height");if(!k&&(E.width<0||E.height<0))throw new Error(_+" - width ("+E.width+") and height ("+E.height+") must be positive numbers")},Object.defineProperty(P.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"topLeft",{get:function(){return new po(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"topRight",{get:function(){return new po(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"bottomLeft",{get:function(){return new po(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"bottomRight",{get:function(){return new po(this.right,this.bottom)},enumerable:!0,configurable:!0}),P.prototype.round=function(){var E=[this.x,this.y,this.width,this.height].map(function(_){return Math.round(_)});return new P({x:E[0],y:E[1],width:E[2],height:E[3]})},P.prototype.floor=function(){var E=[this.x,this.y,this.width,this.height].map(function(_){return Math.floor(_)});return new P({x:E[0],y:E[1],width:E[2],height:E[3]})},P.prototype.toSquare=function(){var E=this.x,_=this.y,k=this.width,D=this.height,q=Math.abs(k-D);return k<D&&(E-=q/2,k+=q),D<k&&(_-=q/2,D+=q),new P({x:E,y:_,width:k,height:D})},P.prototype.rescale=function(E){var _=nl(E)?E.width:E,k=nl(E)?E.height:E;return new P({x:this.x*_,y:this.y*k,width:this.width*_,height:this.height*k})},P.prototype.pad=function(E,_){var k=[this.x-E/2,this.y-_/2,this.width+E,this.height+_];return new P({x:k[0],y:k[1],width:k[2],height:k[3]})},P.prototype.clipAtImageBorders=function(E,_){var k=this.x,D=this.y,q=this.right,ee=this.bottom,de=Math.max(k,0),_e=Math.max(D,0),Re=q-de,De=ee-_e;return new P({x:de,y:_e,width:Math.min(Re,E-de),height:Math.min(De,_-_e)}).floor()},P.prototype.shift=function(E,_){var k=this.width,D=this.height;return new P({x:this.x+E,y:this.y+_,width:k,height:D})},P.prototype.padAtBorders=function(E,_){var k=this.width+1,D=this.height+1,q=k,ee=D,de=this.left,_e=this.top,Re=this.right,De=this.bottom;return Re>_&&(q=-Re+_+k,Re=_),De>E&&(ee=-De+E+D,De=E),de<1&&(ee=2-de,de=1),_e<1&&(ee=2-_e,_e=1),{dy:1,edy:ee,dx:1,edx:q,y:_e,ey:De,x:de,ex:Re,w:k,h:D}},P.prototype.calibrate=function(E){return new P({left:this.left+E.left*this.width,top:this.top+E.top*this.height,right:this.right+E.right*this.width,bottom:this.bottom+E.bottom*this.height}).toSquare().round()},P}(),js=function(P){function E(_,k,D,q,ee){return ee===void 0&&(ee=!1),P.call(this,{left:_,top:k,right:D,bottom:q},ee)||this}return Object(er.c)(E,P),E}(uo),ju=function(){function P(E,_,k,D,q){this._imageDims=new ru(q.width,q.height),this._score=E,this._classScore=_,this._className=k,this._box=new uo(D).rescale(this._imageDims)}return Object.defineProperty(P.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"relativeBox",{get:function(){return new uo(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),P.prototype.forSize=function(E,_){return new P(this.score,this.classScore,this.className,this.relativeBox,{width:E,height:_})},P}(),ts=function(P){function E(_,k,D){return P.call(this,_,_,"",k,D)||this}return Object(er.c)(E,P),E.prototype.forSize=function(_,k){var D=P.prototype.forSize.call(this,_,k);return new E(D.score,D.relativeBox,D.imageDims)},E}(ju);function iu(P,E,_){_===void 0&&(_=!0);var k=Math.max(0,Math.min(P.right,E.right)-Math.max(P.left,E.left))*Math.max(0,Math.min(P.bottom,E.bottom)-Math.max(P.top,E.top));return _?k/(P.area+E.area-k):k/Math.min(P.area,E.area)}function bl(P){var E=P.map(function(de){return de.x}),_=P.map(function(de){return de.y}),k=E.reduce(function(de,_e){return _e<de?_e:de},1/0),D=_.reduce(function(de,_e){return _e<de?_e:de},1/0),q=E.reduce(function(de,_e){return de<_e?_e:de},0),ee=_.reduce(function(de,_e){return de<_e?_e:de},0);return new js(k,D,q,ee)}function Pl(P,E,_,k){k===void 0&&(k=!0);for(var D=E.map(function(de,_e){return{score:de,boxIndex:_e}}).sort(function(de,_e){return de.score-_e.score}).map(function(de){return de.boxIndex}),q=[],ee=function(){var de=D.pop();q.push(de);for(var _e=D,Re=[],De=0;De<_e.length;De++){var tt=_e[De],st=P[de],It=P[tt];Re.push(iu(st,It,k))}D=D.filter(function(Bt,mn){return Re[mn]<=_})};D.length>0;)ee();return q}function lf(P,E){return ln.tidy(function(){var _=E[0],k=E[1],D=E[2],q=ln.fill(Object(er.e)(P.shape.slice(0,3),[1]),_),ee=ln.fill(Object(er.e)(P.shape.slice(0,3),[1]),k),de=ln.fill(Object(er.e)(P.shape.slice(0,3),[1]),D),_e=ln.concat([q,ee,de],3);return ln.sub(P,_e)})}function xl(P,E){return E===void 0&&(E=!1),ln.tidy(function(){var _=P.shape.slice(1),k=_[0],D=_[1];if(k===D)return P;var q=Math.abs(k-D),ee=Math.round(q*(E?.5:1)),de=k>D?2:1,_e=function(st){var It=P.shape.slice();return It[de]=st,ln.fill(It,0)},Re=_e(ee),De=q-Re.shape[de],tt=[E&&De?_e(De):null,P,Re].filter(function(st){return!!st}).map(function(st){return st.toFloat()});return ln.concat(tt,de)})}function ih(P){for(var E=P.slice(),_=E.length-1;_>0;_--){var k=Math.floor(Math.random()*(_+1)),D=E[_];E[_]=E[k],E[k]=D}return E}function hc(P){return 1/(1+Math.exp(-P))}function tp(P){return Math.log(P/(1-P))}var oh=function(P){function E(_,k,D,q,ee){return ee===void 0&&(ee=!1),P.call(this,{x:_,y:k,width:D,height:q},ee)||this}return Object(er.c)(E,P),E}(uo),Sc=function(){function P(E,_,k){k===void 0&&(k=new po(0,0));var D=_.width,q=_.height;this._imgDims=new ru(D,q),this._shift=k,this._positions=E.map(function(ee){return ee.mul(new po(D,q)).add(k)})}return Object.defineProperty(P.prototype,"shift",{get:function(){return new po(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"relativePositions",{get:function(){var E=this;return this._positions.map(function(_){return _.sub(E._shift).div(new po(E.imageWidth,E.imageHeight))})},enumerable:!0,configurable:!0}),P.prototype.forSize=function(E,_){return new this.constructor(this.relativePositions,{width:E,height:_})},P.prototype.shiftBy=function(E,_){return new this.constructor(this.relativePositions,this._imgDims,new po(E,_))},P.prototype.shiftByPoint=function(E){return this.shiftBy(E.x,E.y)},P.prototype.align=function(E,_){if(_===void 0&&(_={}),E){var k=E instanceof ts?E.box.floor():new uo(E);return this.shiftBy(k.x,k.y).align(null,_)}var D=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},_),q=D.useDlibAlignment,ee=D.minBoxPadding;return q?this.alignDlib():this.alignMinBbox(ee)},P.prototype.alignDlib=function(){var E=this.getRefPointsForAlignment(),_=E[0],k=E[1],D=E[2],q=function(tt){return D.sub(tt).magnitude()},ee=(q(_)+q(k))/2,de=Math.floor(ee/.45),_e=Bl(E),Re=Math.floor(Math.max(0,_e.x-.5*de)),De=Math.floor(Math.max(0,_e.y-.43*de));return new oh(Re,De,Math.min(de,this.imageWidth+Re),Math.min(de,this.imageHeight+De))},P.prototype.alignMinBbox=function(E){var _=bl(this.positions);return _.pad(_.width*E,_.height*E)},P.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},P}(),wl=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Object(er.c)(E,P),E.prototype.getRefPointsForAlignment=function(){var _=this.positions;return[_[0],_[1],Bl([_[3],_[4]])]},E}(Sc),kl=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Object(er.c)(E,P),E.prototype.getJawOutline=function(){return this.positions.slice(0,17)},E.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},E.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},E.prototype.getNose=function(){return this.positions.slice(27,36)},E.prototype.getLeftEye=function(){return this.positions.slice(36,42)},E.prototype.getRightEye=function(){return this.positions.slice(42,48)},E.prototype.getMouth=function(){return this.positions.slice(48,68)},E.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Bl)},E}(Sc),Ys=function(){function P(E,_){this._label=E,this._distance=_}return Object.defineProperty(P.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),P.prototype.toString=function(E){return E===void 0&&(E=!0),this.label+(E?" ("+yl(this.distance)+")":"")},P}(),np=function(P){function E(_,k){var D=P.call(this,_)||this;return D._label=k,D}return Object(er.c)(E,P),E.assertIsValidLabeledBox=function(_,k){if(uo.assertIsValidBox(_,k),!fc(_.label))throw new Error(k+" - expected property label ("+_.label+") to be a number")},Object.defineProperty(E.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),E}(uo),_d=function(){function P(E,_){if(typeof E!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(_)||_.some(function(k){return!(k instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=E,this._descriptors=_}return Object.defineProperty(P.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),P.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(E){return Array.from(E)})}},P.fromJSON=function(E){var _=E.descriptors.map(function(k){return new Float32Array(k)});return new P(E.label,_)},P}(),Ed=function(P){function E(_,k,D,q){var ee=P.call(this,_,k)||this;return ee._score=D,ee._classScore=q,ee}return Object(er.c)(E,P),E.assertIsValidPredictedBox=function(_,k){if(np.assertIsValidLabeledBox(_,k),!Mu(_.score)||!Mu(_.classScore))throw new Error(k+" - expected properties score ("+_.score+") and ("+_.classScore+") to be a number between [0, 1]")},Object.defineProperty(E.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),E}(np);function qh(P){return P.detection instanceof ts}function Cd(P,E){var _={detection:E};return Object.assign({},P,_)}function re(){var P=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:P,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}var Q=o(131),C=o(178);function R(){return typeof window=="object"&&typeof document!="undefined"&&typeof HTMLImageElement!="undefined"&&typeof HTMLCanvasElement!="undefined"&&typeof HTMLVideoElement!="undefined"&&typeof ImageData!="undefined"&&typeof CanvasRenderingContext2D!="undefined"}var oe,Ue=o(177);function Je(P){oe=P}function vt(){R()&&Je(re()),Object(Ue.a)()&&Je(Object(C.a)())}var qt,Jt={getEnv:function(){if(!oe)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return oe},setEnv:Je,initialize:vt,createBrowserEnv:re,createFileSystem:Q.a,createNodejsEnv:C.a,monkeyPatch:function(P){if(oe||vt(),!oe)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var E=P.Canvas,_=E===void 0?oe.Canvas:E,k=P.Image,D=k===void 0?oe.Image:k;oe.Canvas=_,oe.Image=D,oe.createCanvasElement=P.createCanvasElement||function(){return new _},oe.createImageElement=P.createImageElement||function(){return new D},oe.ImageData=P.ImageData||oe.ImageData,oe.Video=P.Video||oe.Video,oe.fetch=P.fetch||oe.fetch,oe.readFile=P.readFile||oe.readFile},isBrowser:R,isNodejs:Ue.a};function pt(P){return Jt.isNodejs()||typeof P!="string"?P:document.getElementById(P)}function Nn(P){var E=Jt.getEnv(),_=E.Canvas;if(P instanceof E.CanvasRenderingContext2D)return P;var k=pt(P);if(!(k instanceof _))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var D=k.getContext("2d");if(!D)throw new Error("resolveContext2d - canvas 2d context is null");return D}vt(),function(P){P.TOP_LEFT="TOP_LEFT",P.TOP_RIGHT="TOP_RIGHT",P.BOTTOM_LEFT="BOTTOM_LEFT",P.BOTTOM_RIGHT="BOTTOM_RIGHT"}(qt||(qt={}));var Pn=function(){return function(P){P===void 0&&(P={});var E=P.anchorPosition,_=P.backgroundColor,k=P.fontColor,D=P.fontSize,q=P.fontStyle,ee=P.padding;this.anchorPosition=E||qt.TOP_LEFT,this.backgroundColor=_||"rgba(0, 0, 0, 0.5)",this.fontColor=k||"rgba(255, 255, 255, 1)",this.fontSize=D||14,this.fontStyle=q||"Georgia",this.padding=ee||4}}(),Vn=function(){function P(E,_,k){k===void 0&&(k={}),this.text=typeof E=="string"?[E]:E instanceof P?E.text:E,this.anchor=_,this.options=new Pn(k)}return P.prototype.measureWidth=function(E){var _=this.options.padding;return this.text.map(function(k){return E.measureText(k).width}).reduce(function(k,D){return k<D?D:k},0)+2*_},P.prototype.measureHeight=function(){var E=this.options,_=E.fontSize,k=E.padding;return this.text.length*_+2*k},P.prototype.getUpperLeft=function(E,_){var k=this.options.anchorPosition,D=k===qt.BOTTOM_RIGHT||k===qt.TOP_RIGHT,q=k===qt.BOTTOM_LEFT||k===qt.BOTTOM_RIGHT,ee=this.measureWidth(E),de=this.measureHeight(),_e=D?this.anchor.x-ee:this.anchor.x,Re=q?this.anchor.y-de:this.anchor.y;if(_){var De=_.width,tt=_.height;return{x:Math.max(Math.min(_e,De-ee),0),y:Math.max(Math.min(Re,tt-de),0)}}return{x:_e,y:Re}},P.prototype.draw=function(E){var _=pt(E),k=Nn(_),D=this.options,q=D.backgroundColor,ee=D.fontColor,de=D.fontSize,_e=D.fontStyle,Re=D.padding;k.font=de+"px "+_e;var De=this.measureWidth(k),tt=this.measureHeight();k.fillStyle=q;var st=this.getUpperLeft(k,_);k.fillRect(st.x,st.y,De,tt),k.fillStyle=ee,this.text.forEach(function(It,Bt){var mn=Re+st.x,xn=Re+st.y+(Bt+1)*de;k.fillText(It,mn,xn)})},P}(),rr=function(){return function(P){P===void 0&&(P={});var E=P.boxColor,_=P.lineWidth,k=P.label,D=P.drawLabelOptions;this.boxColor=E||"rgba(0, 0, 255, 1)",this.lineWidth=_||2,this.label=k;var q={anchorPosition:qt.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new Pn(Object.assign({},q,D))}}(),Yn=function(){function P(E,_){_===void 0&&(_={}),this.box=new uo(E),this.options=new rr(_)}return P.prototype.draw=function(E){var _=Nn(E),k=this.options,D=k.boxColor,q=k.lineWidth,ee=this.box,de=ee.x,_e=ee.y,Re=ee.width,De=ee.height;_.strokeStyle=D,_.lineWidth=q,_.strokeRect(de,_e,Re,De);var tt=this.options.label;tt&&new Vn([tt],{x:de-q/2,y:_e},this.options.drawLabelOptions).draw(E)},P}();function br(P,E){(Array.isArray(E)?E:[E]).forEach(function(_){var k=_ instanceof ts?_.score:qh(_)?_.detection.score:void 0,D=_ instanceof ts?_.box:qh(_)?_.detection.box:new uo(_),q=k?""+yl(k):void 0;new Yn(D,{label:q}).draw(P)})}function xr(P){var E=Jt.getEnv(),_=E.Image,k=E.Video;return P instanceof _&&P.complete||P instanceof k&&P.readyState>=3}function Lr(P){return new Promise(function(E,_){if(P instanceof Jt.getEnv().Canvas||xr(P))return E();function k(q){q.currentTarget&&(q.currentTarget.removeEventListener("load",k),q.currentTarget.removeEventListener("error",D),E(q))}function D(q){q.currentTarget&&(q.currentTarget.removeEventListener("load",k),q.currentTarget.removeEventListener("error",D),_(q))}P.addEventListener("load",k),P.addEventListener("error",D)})}function Hr(P){return new Promise(function(E,_){if(!(P instanceof Blob))return _("bufferToImage - expected buf to be of type: Blob");var k=new FileReader;k.onload=function(){if(typeof k.result!="string")return _("bufferToImage - expected reader.result to be a string, in onload");var D=Jt.getEnv().createImageElement();D.onload=function(){return E(D)},D.onerror=_,D.src=k.result},k.onerror=_,k.readAsDataURL(P)})}function yi(P){var E=Jt.getEnv(),_=E.Image,k=E.Video;return P instanceof _?new ru(P.naturalWidth,P.naturalHeight):P instanceof k?new ru(P.videoWidth,P.videoHeight):new ru(P.width,P.height)}function zr(P){var E=P.width,_=P.height,k=(0,Jt.getEnv().createCanvasElement)();return k.width=E,k.height=_,k}function li(P,E){var _=Jt.getEnv().ImageData;if(!(P instanceof _||xr(P)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var k=E||yi(P),D=k.width,q=k.height,ee=zr({width:D,height:q});return P instanceof _?Nn(ee).putImageData(P,0,0):Nn(ee).drawImage(P,0,0,D,q),ee}function pi(P,E){return Object(er.b)(this,void 0,void 0,function(){var _,k,D,q,ee,de;return Object(er.d)(this,function(_e){switch(_e.label){case 0:return _=E||Jt.getEnv().createCanvasElement(),k=P.shape.slice(fu(P)?1:0),D=k[0],q=k[1],ee=k[2],de=ln.tidy(function(){return P.as3D(D,q,ee).toInt()}),[4,ln.browser.toPixels(de,_)];case 1:return _e.sent(),de.dispose(),[2,_]}})})}function Pi(P){var E=Jt.getEnv(),_=E.Image,k=E.Canvas,D=E.Video;return P instanceof _||P instanceof k||P instanceof D}function qi(P,E,_){_===void 0&&(_=!1);var k=Jt.getEnv(),D=k.Image,q=k.Canvas;if(!(P instanceof D||P instanceof q))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var ee=yi(P),de=E/Math.max(ee.height,ee.width),_e=de*ee.width,Re=de*ee.height,De=zr({width:E,height:E}),tt=P instanceof q?P:li(P),st=Math.abs(_e-Re)/2,It=_&&_e<Re?st:0,Bt=_&&Re<_e?st:0;return Nn(De).drawImage(tt,It,Bt,_e,Re),De}var bi=function(){function P(E,_){var k=this;if(_===void 0&&(_=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(E))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+E);this._treatAsBatchInput=_,this._batchSize=E.length,E.forEach(function(D,q){if(wr(D))return k._imageTensors[q]=D,void(k._inputDimensions[q]=D.shape);if(fu(D)){var ee=D.shape[0];if(ee!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+ee+" passed, but not supported in input array");return k._imageTensors[q]=D,void(k._inputDimensions[q]=D.shape.slice(1))}var de=D instanceof Jt.getEnv().Canvas?D:li(D);k._canvases[q]=de,k._inputDimensions[q]=[de.height,de.width,3]})}return Object.defineProperty(P.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"reshapedInputDimensions",{get:function(){var E=this;return Kt(this.batchSize,0,1).map(function(_,k){return E.getReshapedInputDimensions(k)})},enumerable:!0,configurable:!0}),P.prototype.getInput=function(E){return this.canvases[E]||this.imageTensors[E]},P.prototype.getInputDimensions=function(E){return this._inputDimensions[E]},P.prototype.getInputHeight=function(E){return this._inputDimensions[E][0]},P.prototype.getInputWidth=function(E){return this._inputDimensions[E][1]},P.prototype.getReshapedInputDimensions=function(E){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return wu({width:this.getInputWidth(E),height:this.getInputHeight(E)},this.inputSize)},P.prototype.toBatchTensor=function(E,_){var k=this;return _===void 0&&(_=!0),this._inputSize=E,ln.tidy(function(){var D=Kt(k.batchSize,0,1).map(function(q){var ee=k.getInput(q);if(ee instanceof ln.Tensor){var de=fu(ee)?ee:ee.expandDims();return(de=xl(de,_)).shape[1]===E&&de.shape[2]===E||(de=ln.image.resizeBilinear(de,[E,E])),de.as3D(E,E,3)}if(ee instanceof Jt.getEnv().Canvas)return ln.browser.fromPixels(qi(ee,E,_));throw new Error("toBatchTensor - at batchIdx "+q+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+ee)});return ln.stack(D.map(function(q){return q.toFloat()})).as4D(k.batchSize,E,E,3)})},P}();function Oi(P){return Object(er.b)(this,void 0,void 0,function(){var E,_,k;return Object(er.d)(this,function(D){switch(D.label){case 0:if(P instanceof bi)return[2,P];if(!(E=Array.isArray(P)?P:[P]).length)throw new Error("toNetInput - empty array passed as input");return _=function(q){return Array.isArray(P)?" at input index "+q+":":""},(k=E.map(pt)).forEach(function(q,ee){if(!Pi(q)&&!wr(q)&&!fu(q))throw typeof E[ee]=="string"?new Error("toNetInput -"+_(ee)+" string passed, but could not resolve HTMLElement for element id "+E[ee]):new Error("toNetInput -"+_(ee)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(fu(q)){var de=q.shape[0];if(de!==1)throw new Error("toNetInput -"+_(ee)+" tf.Tensor4D with batchSize "+de+" passed, but not supported in input array")}}),[4,Promise.all(k.map(function(q){return Pi(q)&&Lr(q)}))];case 1:return D.sent(),[2,new bi(k,Array.isArray(P))]}})})}function Vo(P,E){return Object(er.b)(this,void 0,void 0,function(){var _,k,D,q,ee,de;return Object(er.d)(this,function(_e){switch(_e.label){case 0:return _=Jt.getEnv().Canvas,k=P,P instanceof _?[3,5]:[4,Oi(P)];case 1:if((D=_e.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(q=D.getInput(0))instanceof _?(ee=q,[3,4]):[3,2];case 2:return[4,pi(q)];case 3:ee=_e.sent(),_e.label=4;case 4:k=ee,_e.label=5;case 5:return de=Nn(k),[2,E.map(function(Re){return Re instanceof ts?Re.forSize(k.width,k.height).box.floor():Re}).map(function(Re){return Re.clipAtImageBorders(k.width,k.height)}).map(function(Re){var De=Re.x,tt=Re.y,st=Re.width,It=Re.height,Bt=zr({width:st,height:It});return Nn(Bt).putImageData(de.getImageData(De,tt,st,It),0,0),Bt})]}})})}function qo(P,E){return Object(er.b)(this,void 0,void 0,function(){return Object(er.d)(this,function(_){if(!wr(P)&&!fu(P))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(fu(P)&&P.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,ln.tidy(function(){var k=P.shape.slice(fu(P)?1:0),D=k[0],q=k[1],ee=k[2];return E.map(function(de){return de instanceof ts?de.forSize(q,D).box:de}).map(function(de){return de.clipAtImageBorders(q,D)}).map(function(de){var _e=de.x,Re=de.y,De=de.width,tt=de.height;return ln.slice3d(P.as3D(D,q,ee),[Re,_e,0],[tt,De,ee])})})]})})}function Ia(P,E){return Object(er.b)(this,void 0,void 0,function(){var _;return Object(er.d)(this,function(k){switch(k.label){case 0:return[4,(0,Jt.getEnv().fetch)(P,E)];case 1:if(!((_=k.sent()).status<400))throw new Error("failed to fetch: ("+_.status+") "+_.statusText+", from url: "+_.url);return[2,_]}})})}function Ao(P){return Object(er.b)(this,void 0,void 0,function(){var E,_;return Object(er.d)(this,function(k){switch(k.label){case 0:return[4,Ia(P)];case 1:return[4,(E=k.sent()).blob()];case 2:if(!(_=k.sent()).type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+_.type+", for url: "+E.url);return[2,Hr(_)]}})})}function Ho(P){return Object(er.b)(this,void 0,void 0,function(){return Object(er.d)(this,function(E){switch(E.label){case 0:return[4,Ia(P)];case 1:return[2,E.sent().json()]}})})}function zo(P){return Object(er.b)(this,void 0,void 0,function(){var E;return Object(er.d)(this,function(_){switch(_.label){case 0:return E=Float32Array.bind,[4,Ia(P)];case 1:return[4,_.sent().arrayBuffer()];case 2:return[2,new(E.apply(Float32Array,[void 0,_.sent()]))]}})})}function Sa(P,E){var _=E+"-weights_manifest.json";if(!P)return{modelBaseUri:"",manifestUri:_};if(P==="/")return{modelBaseUri:"/",manifestUri:"/"+_};var k=P.startsWith("http://")?"http://":P.startsWith("https://")?"https://":"",D=(P=P.replace(k,"")).split("/").filter(function(de){return de}),q=P.endsWith(".json")?D[D.length-1]:_,ee=k+(P.endsWith(".json")?D.slice(0,D.length-1):D).join("/");return{modelBaseUri:ee=P.startsWith("/")?"/"+ee:ee,manifestUri:ee==="/"?"/"+q:ee+"/"+q}}function Xa(P,E){return Object(er.b)(this,void 0,void 0,function(){var _,k,D,q;return Object(er.d)(this,function(ee){switch(ee.label){case 0:return _=Sa(P,E),k=_.manifestUri,D=_.modelBaseUri,[4,Ho(k)];case 1:return q=ee.sent(),[2,ln.io.loadWeights(q,D)]}})})}function Zi(P,E,_){_===void 0&&(_=!1);var k=_?yi(E):E,D=k.width,q=k.height;return P.width=D,P.height=q,{width:D,height:q}}var co=function(){function P(E){this._name=E,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(P.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),P.prototype.getParamFromPath=function(E){var _=this.traversePropertyPath(E);return _.obj[_.objProp]},P.prototype.reassignParamFromPath=function(E,_){var k=this.traversePropertyPath(E),D=k.obj,q=k.objProp;D[q].dispose(),D[q]=_},P.prototype.getParamList=function(){var E=this;return this._paramMappings.map(function(_){var k=_.paramPath;return{path:k,tensor:E.getParamFromPath(k)}})},P.prototype.getTrainableParams=function(){return this.getParamList().filter(function(E){return E.tensor instanceof ln.Variable})},P.prototype.getFrozenParams=function(){return this.getParamList().filter(function(E){return!(E.tensor instanceof ln.Variable)})},P.prototype.variable=function(){var E=this;this.getFrozenParams().forEach(function(_){var k=_.path,D=_.tensor;E.reassignParamFromPath(k,D.variable())})},P.prototype.freeze=function(){var E=this;this.getTrainableParams().forEach(function(_){var k=_.path,D=_.tensor,q=ln.tensor(D.dataSync());D.dispose(),E.reassignParamFromPath(k,q)})},P.prototype.dispose=function(E){E===void 0&&(E=!0),this.getParamList().forEach(function(_){if(E&&_.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+_.path);_.tensor.dispose()}),this._params=void 0},P.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(E){var _=E.tensor;return Array.from(_.dataSync())}).reduce(function(E,_){return E.concat(_)}))},P.prototype.load=function(E){return Object(er.b)(this,void 0,void 0,function(){return Object(er.d)(this,function(_){switch(_.label){case 0:return E instanceof Float32Array?(this.extractWeights(E),[2]):[4,this.loadFromUri(E)];case 1:return _.sent(),[2]}})})},P.prototype.loadFromUri=function(E){return Object(er.b)(this,void 0,void 0,function(){var _;return Object(er.d)(this,function(k){switch(k.label){case 0:if(E&&typeof E!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,Xa(E,this.getDefaultModelName())];case 1:return _=k.sent(),this.loadFromWeightMap(_),[2]}})})},P.prototype.loadFromDisk=function(E){return Object(er.b)(this,void 0,void 0,function(){var _,k,D,q,ee,de,_e,Re,De,tt;return Object(er.d)(this,function(st){switch(st.label){case 0:if(E&&typeof E!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return _=Jt.getEnv().readFile,k=Sa(E,this.getDefaultModelName()),D=k.manifestUri,q=k.modelBaseUri,ee=function(It){return Promise.all(It.map(function(Bt){return _(Bt).then(function(mn){return mn.buffer})}))},de=ln.io.weightsLoaderFactory(ee),De=(Re=JSON).parse,[4,_(D)];case 1:return _e=De.apply(Re,[st.sent().toString()]),[4,de(_e,q)];case 2:return tt=st.sent(),this.loadFromWeightMap(tt),[2]}})})},P.prototype.loadFromWeightMap=function(E){var _=this.extractParamsFromWeigthMap(E),k=_.paramMappings,D=_.params;this._paramMappings=k,this._params=D},P.prototype.extractWeights=function(E){var _=this.extractParams(E),k=_.paramMappings,D=_.params;this._paramMappings=k,this._params=D},P.prototype.traversePropertyPath=function(E){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var _=E.split("/").reduce(function(q,ee){if(!q.nextObj.hasOwnProperty(ee))throw new Error("traversePropertyPath - object does not have property "+ee+", for path "+E);return{obj:q.nextObj,objProp:ee,nextObj:q.nextObj[ee]}},{nextObj:this.params}),k=_.obj,D=_.objProp;if(!(k&&D&&k[D]instanceof ln.Tensor))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+E);return{obj:k,objProp:D}},P}();function Jo(P,E,_){return ln.tidy(function(){var k=ln.separableConv2d(P,E.depthwise_filter,E.pointwise_filter,_,"same");return k=ln.add(k,E.bias)})}function Pa(P,E,_){return _===void 0&&(_=!1),ln.tidy(function(){var k=ln.relu(_?ln.add(ln.conv2d(P,E.conv0.filters,[2,2],"same"),E.conv0.bias):Jo(P,E.conv0,[2,2])),D=Jo(k,E.conv1,[1,1]),q=Jo(ln.relu(ln.add(k,D)),E.conv2,[1,1]);return ln.relu(ln.add(k,ln.add(D,q)))})}function ks(P,E,_,k){return _===void 0&&(_=!1),k===void 0&&(k=!0),ln.tidy(function(){var D=ln.relu(_?ln.add(ln.conv2d(P,E.conv0.filters,k?[2,2]:[1,1],"same"),E.conv0.bias):Jo(P,E.conv0,k?[2,2]:[1,1])),q=Jo(D,E.conv1,[1,1]),ee=Jo(ln.relu(ln.add(D,q)),E.conv2,[1,1]),de=Jo(ln.relu(ln.add(D,ln.add(q,ee))),E.conv3,[1,1]);return ln.relu(ln.add(D,ln.add(q,ln.add(ee,de))))})}function Qo(P,E,_,k){return _===void 0&&(_="same"),k===void 0&&(k=!1),ln.tidy(function(){var D=ln.add(ln.conv2d(P,E.filters,[1,1],_),E.bias);return k?ln.relu(D):D})}function Wa(P,E){Object.keys(P).forEach(function(_){E.some(function(k){return k.originalPath===_})||P[_].dispose()})}function ku(P,E){return function(_,k,D,q){var ee=ln.tensor4d(P(_*k*D*D),[D,D,_,k]),de=ln.tensor1d(P(k));return E.push({paramPath:q+"/filters"},{paramPath:q+"/bias"}),{filters:ee,bias:de}}}function Cs(P,E){return function(_,k,D){var q=ln.tensor2d(P(_*k),[_,k]),ee=ln.tensor1d(P(k));return E.push({paramPath:D+"/weights"},{paramPath:D+"/bias"}),{weights:q,bias:ee}}}var fa=function(){return function(P,E,_){this.depthwise_filter=P,this.pointwise_filter=E,this.bias=_}}();function _s(P,E){return function(_,k,D){var q=ln.tensor4d(P(9*_),[3,3,_,1]),ee=ln.tensor4d(P(_*k),[1,1,_,k]),de=ln.tensor1d(P(k));return E.push({paramPath:D+"/depthwise_filter"},{paramPath:D+"/pointwise_filter"},{paramPath:D+"/bias"}),new fa(q,ee,de)}}function _l(P){return function(E){var _=P(E+"/depthwise_filter",4),k=P(E+"/pointwise_filter",4),D=P(E+"/bias",1);return new fa(_,k,D)}}function Js(P,E){return function(_,k,D){var q=P[_];if(!Fo(q,k))throw new Error("expected weightMap["+_+"] to be a Tensor"+k+"D, instead have "+q);return E.push({originalPath:_,paramPath:D||_}),q}}function Bs(P){var E=P;return{extractWeights:function(_){var k=E.slice(0,_);return E=E.slice(_),k},getRemainingWeights:function(){return E}}}function Fa(P,E){var _=ku(P,E),k=_s(P,E);function D(q,ee,de,_e){return _e===void 0&&(_e=!1),{conv0:_e?_(q,ee,3,de+"/conv0"):k(q,ee,de+"/conv0"),conv1:k(ee,ee,de+"/conv1"),conv2:k(ee,ee,de+"/conv2")}}return{extractDenseBlock3Params:D,extractDenseBlock4Params:function(q,ee,de,_e){_e===void 0&&(_e=!1);var Re=D(q,ee,de,_e);return{conv0:Re.conv0,conv1:Re.conv1,conv2:Re.conv2,conv3:k(ee,ee,de+"/conv3")}}}}function ff(P){return function(E){return{filters:P(E+"/filters",4),bias:P(E+"/bias",1)}}}function _u(P,E){var _=Js(P,E),k=ff(_),D=_l(_);return{extractDenseBlock3Params:function(q,ee){return ee===void 0&&(ee=!1),{conv0:ee?k(q+"/conv0"):D(q+"/conv0"),conv1:D(q+"/conv1"),conv2:D(q+"/conv2")}},extractDenseBlock4Params:function(q,ee){return ee===void 0&&(ee=!1),{conv0:ee?k(q+"/conv0"):D(q+"/conv0"),conv1:D(q+"/conv1"),conv2:D(q+"/conv2"),conv3:D(q+"/conv3")}}}}var dc=function(P){function E(){return P.call(this,"FaceFeatureExtractor")||this}return Object(er.c)(E,P),E.prototype.forwardInput=function(_){var k=this.params;if(!k)throw new Error("FaceFeatureExtractor - load model before inference");return ln.tidy(function(){var D=ks(lf(_.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(ln.scalar(255)),k.dense0,!0);return D=ks(D=ks(D=ks(D,k.dense1),k.dense2),k.dense3),D=ln.avgPool(D,[7,7],[2,2],"valid")})},E.prototype.forward=function(_){return Object(er.b)(this,void 0,void 0,function(){var k;return Object(er.d)(this,function(D){switch(D.label){case 0:return k=this.forwardInput,[4,Oi(_)];case 1:return[2,k.apply(this,[D.sent()])]}})})},E.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},E.prototype.extractParamsFromWeigthMap=function(_){return function(k){var D=[],q=_u(k,D).extractDenseBlock4Params,ee={dense0:q("dense0",!0),dense1:q("dense1"),dense2:q("dense2"),dense3:q("dense3")};return Wa(k,D),{params:ee,paramMappings:D}}(_)},E.prototype.extractParams=function(_){return function(k){var D=[],q=Bs(k),ee=q.extractWeights,de=q.getRemainingWeights,_e=Fa(ee,D).extractDenseBlock4Params,Re=_e(3,32,"dense0",!0),De=_e(32,64,"dense1"),tt=_e(64,128,"dense2"),st=_e(128,256,"dense3");if(de().length!==0)throw new Error("weights remaing after extract: "+de().length);return{paramMappings:D,params:{dense0:Re,dense1:De,dense2:tt,dense3:st}}}(_)},E}(co);function ns(P,E){return ln.tidy(function(){return ln.add(ln.matMul(P,E.weights),E.bias)})}function Bu(P){var E={},_={};return Object.keys(P).forEach(function(k){(k.startsWith("fc")?_:E)[k]=P[k]}),{featureExtractorMap:E,classifierMap:_}}var Da=function(P){function E(_,k){var D=P.call(this,_)||this;return D._faceFeatureExtractor=k,D}return Object(er.c)(E,P),Object.defineProperty(E.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),E.prototype.runNet=function(_){var k=this,D=this.params;if(!D)throw new Error(this._name+" - load model before inference");return ln.tidy(function(){var q=_ instanceof bi?k.faceFeatureExtractor.forwardInput(_):_;return ns(q.as2D(q.shape[0],-1),D.fc)})},E.prototype.dispose=function(_){_===void 0&&(_=!0),this.faceFeatureExtractor.dispose(_),P.prototype.dispose.call(this,_)},E.prototype.loadClassifierParams=function(_){var k=this.extractClassifierParams(_),D=k.params,q=k.paramMappings;this._params=D,this._paramMappings=q},E.prototype.extractClassifierParams=function(_){return function(k,D,q){var ee=[],de=Bs(k),_e=de.extractWeights,Re=de.getRemainingWeights,De=Cs(_e,ee)(D,q,"fc");if(Re().length!==0)throw new Error("weights remaing after extract: "+Re().length);return{paramMappings:ee,params:{fc:De}}}(_,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},E.prototype.extractParamsFromWeigthMap=function(_){var k=Bu(_),D=k.featureExtractorMap,q=k.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(D),function(ee){var de=[],_e=Js(ee,de),Re={fc:function(De){return{weights:_e(De+"/weights",2),bias:_e(De+"/bias",1)}}("fc")};return Wa(ee,de),{params:Re,paramMappings:de}}(q)},E.prototype.extractParams=function(_){var k=this.getClassifierChannelsIn(),D=this.getClassifierChannelsOut(),q=D*k+D,ee=_.slice(0,_.length-q),de=_.slice(_.length-q);return this.faceFeatureExtractor.extractWeights(ee),this.extractClassifierParams(de)},E}(co),Qu=["neutral","happy","sad","angry","fearful","disgusted","surprised"],Pu=function(){function P(E){var _=this;if(E.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+E.length);Qu.forEach(function(k,D){_[k]=E[D]})}return P.prototype.asSortedArray=function(){var E=this;return Qu.map(function(_){return{expression:_,probability:E[_]}}).sort(function(_,k){return k.probability-_.probability})},P}(),Zo=function(P){function E(_){return _===void 0&&(_=new dc),P.call(this,"FaceExpressionNet",_)||this}return Object(er.c)(E,P),E.prototype.forwardInput=function(_){var k=this;return ln.tidy(function(){return ln.softmax(k.runNet(_))})},E.prototype.forward=function(_){return Object(er.b)(this,void 0,void 0,function(){var k;return Object(er.d)(this,function(D){switch(D.label){case 0:return k=this.forwardInput,[4,Oi(_)];case 1:return[2,k.apply(this,[D.sent()])]}})})},E.prototype.predictExpressions=function(_){return Object(er.b)(this,void 0,void 0,function(){var k,D,q,ee,de=this;return Object(er.d)(this,function(_e){switch(_e.label){case 0:return[4,Oi(_)];case 1:return k=_e.sent(),[4,this.forwardInput(k)];case 2:return D=_e.sent(),[4,Promise.all(ln.unstack(D).map(function(Re){return Object(er.b)(de,void 0,void 0,function(){var De;return Object(er.d)(this,function(tt){switch(tt.label){case 0:return[4,Re.data()];case 1:return De=tt.sent(),Re.dispose(),[2,De]}})})}))];case 3:return q=_e.sent(),D.dispose(),ee=q.map(function(Re){return new Pu(Re)}),[2,k.isBatchInput?ee:ee[0]]}})})},E.prototype.getDefaultModelName=function(){return"face_expression_model"},E.prototype.getClassifierChannelsIn=function(){return 256},E.prototype.getClassifierChannelsOut=function(){return 7},E}(Da);function Lu(P){return P.expressions instanceof Pu}function Qs(P,E){var _={expressions:E};return Object.assign({},P,_)}function Dc(P,E,_,k){_===void 0&&(_=.1),(Array.isArray(E)?E:[E]).forEach(function(D){var q=D instanceof Pu?D:Lu(D)?D.expressions:void 0;if(!q)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var ee=q.asSortedArray().filter(function(_e){return _e.probability>_}),de=qh(D)?D.detection.box.bottomLeft:k||new po(0,0);new Vn(ee.map(function(_e){return _e.expression+" ("+yl(_e.probability)+")"}),de).draw(P)})}function Ll(P){return qh(P)&&P.landmarks instanceof Sc&&P.unshiftedLandmarks instanceof Sc&&P.alignedRect instanceof ts}function Va(P,E){var _=P.detection.box,k=E.shiftBy(_.x,_.y),D=k.align(),q=P.detection.imageDims,ee={landmarks:k,unshiftedLandmarks:E,alignedRect:new ts(P.detection.score,D.rescale(q.reverse()),q)};return Object.assign({},P,ee)}var hu=function(){return function(P){P===void 0&&(P={});var E=P.drawLines,_=E===void 0||E,k=P.drawPoints,D=k===void 0||k,q=P.lineWidth,ee=P.lineColor,de=P.pointSize,_e=P.pointColor;this.drawLines=_,this.drawPoints=D,this.lineWidth=q||1,this.pointSize=de||2,this.lineColor=ee||"rgba(0, 255, 255, 1)",this.pointColor=_e||"rgba(255, 0, 255, 1)"}}(),Ps=function(){function P(E,_){_===void 0&&(_={}),this.faceLandmarks=E,this.options=new hu(_)}return P.prototype.draw=function(E){var _=Nn(E),k=this.options,D=k.drawLines,q=k.drawPoints,ee=k.lineWidth,de=k.lineColor,_e=k.pointSize,Re=k.pointColor;D&&this.faceLandmarks instanceof kl&&(_.strokeStyle=de,_.lineWidth=ee,Ju(_,this.faceLandmarks.getJawOutline()),Ju(_,this.faceLandmarks.getLeftEyeBrow()),Ju(_,this.faceLandmarks.getRightEyeBrow()),Ju(_,this.faceLandmarks.getNose()),Ju(_,this.faceLandmarks.getLeftEye(),!0),Ju(_,this.faceLandmarks.getRightEye(),!0),Ju(_,this.faceLandmarks.getMouth(),!0)),q&&(_.strokeStyle=Re,_.fillStyle=Re,this.faceLandmarks.positions.forEach(function(De){_.beginPath(),_.arc(De.x,De.y,_e,0,2*Math.PI),_.fill()}))},P}();function rl(P,E){(Array.isArray(E)?E:[E]).forEach(function(_){var k=_ instanceof Sc?_:Ll(_)?_.landmarks:void 0;if(!k)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new Ps(k).draw(P)})}function ah(P,E){var _=[],k=Bs(P),D=k.extractWeights,q=k.getRemainingWeights,ee=function(Bt,mn){var xn=ku(Bt,mn),Fn=_s(Bt,mn);return{extractConvParams:xn,extractSeparableConvParams:Fn,extractReductionBlockParams:function(Rn,Ln,Zn){return{separable_conv0:Fn(Rn,Ln,Zn+"/separable_conv0"),separable_conv1:Fn(Ln,Ln,Zn+"/separable_conv1"),expansion_conv:xn(Rn,Ln,1,Zn+"/expansion_conv")}},extractMainBlockParams:function(Rn,Ln){return{separable_conv0:Fn(Rn,Rn,Ln+"/separable_conv0"),separable_conv1:Fn(Rn,Rn,Ln+"/separable_conv1"),separable_conv2:Fn(Rn,Rn,Ln+"/separable_conv2")}}}}(D,_),de=ee.extractConvParams,_e=ee.extractSeparableConvParams,Re=ee.extractReductionBlockParams,De=ee.extractMainBlockParams,tt={conv_in:de(3,32,3,"entry_flow/conv_in"),reduction_block_0:Re(32,64,"entry_flow/reduction_block_0"),reduction_block_1:Re(64,128,"entry_flow/reduction_block_1")},st={};Kt(E,0,1).forEach(function(Bt){st["main_block_"+Bt]=De(128,"middle_flow/main_block_"+Bt)});var It={reduction_block:Re(128,256,"exit_flow/reduction_block"),separable_conv:_e(256,512,"exit_flow/separable_conv")};if(q().length!==0)throw new Error("weights remaing after extract: "+q().length);return{paramMappings:_,params:{entry_flow:tt,middle_flow:st,exit_flow:It}}}function Wi(P,E){var _=[],k=function(tt,st){var It=Js(tt,st),Bt=ff(It),mn=_l(It);return{extractConvParams:Bt,extractSeparableConvParams:mn,extractReductionBlockParams:function(xn){return{separable_conv0:mn(xn+"/separable_conv0"),separable_conv1:mn(xn+"/separable_conv1"),expansion_conv:Bt(xn+"/expansion_conv")}},extractMainBlockParams:function(xn){return{separable_conv0:mn(xn+"/separable_conv0"),separable_conv1:mn(xn+"/separable_conv1"),separable_conv2:mn(xn+"/separable_conv2")}}}}(P,_),D=k.extractConvParams,q=k.extractSeparableConvParams,ee=k.extractReductionBlockParams,de=k.extractMainBlockParams,_e={conv_in:D("entry_flow/conv_in"),reduction_block_0:ee("entry_flow/reduction_block_0"),reduction_block_1:ee("entry_flow/reduction_block_1")},Re={};Kt(E,0,1).forEach(function(tt){Re["main_block_"+tt]=de("middle_flow/main_block_"+tt)});var De={reduction_block:ee("exit_flow/reduction_block"),separable_conv:q("exit_flow/separable_conv")};return Wa(P,_),{params:{entry_flow:_e,middle_flow:Re,exit_flow:De},paramMappings:_}}function rp(P,E,_){return ln.add(ln.conv2d(P,E.filters,_,"same"),E.bias)}function sh(P,E,_){_===void 0&&(_=!0);var k=_?ln.relu(P):P;return k=Jo(k,E.separable_conv0,[1,1]),k=Jo(ln.relu(k),E.separable_conv1,[1,1]),k=ln.maxPool(k,[3,3],[2,2],"same"),k=ln.add(k,rp(P,E.expansion_conv,[2,2]))}var uh,s0=function(P){function E(_){var k=P.call(this,"TinyXception")||this;return k._numMainBlocks=_,k}return Object(er.c)(E,P),E.prototype.forwardInput=function(_){var k=this,D=this.params;if(!D)throw new Error("TinyXception - load model before inference");return ln.tidy(function(){var q=lf(_.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(ln.scalar(256)),ee=ln.relu(rp(q,D.entry_flow.conv_in,[2,2]));return ee=sh(ee=sh(ee,D.entry_flow.reduction_block_0,!1),D.entry_flow.reduction_block_1),Kt(k._numMainBlocks,0,1).forEach(function(de){ee=function(_e,Re){var De=Jo(ln.relu(_e),Re.separable_conv0,[1,1]);return De=Jo(ln.relu(De),Re.separable_conv1,[1,1]),De=Jo(ln.relu(De),Re.separable_conv2,[1,1]),De=ln.add(De,_e)}(ee,D.middle_flow["main_block_"+de])}),ee=sh(ee,D.exit_flow.reduction_block),ee=ln.relu(Jo(ee,D.exit_flow.separable_conv,[1,1]))})},E.prototype.forward=function(_){return Object(er.b)(this,void 0,void 0,function(){var k;return Object(er.d)(this,function(D){switch(D.label){case 0:return k=this.forwardInput,[4,Oi(_)];case 1:return[2,k.apply(this,[D.sent()])]}})})},E.prototype.getDefaultModelName=function(){return"tiny_xception_model"},E.prototype.extractParamsFromWeigthMap=function(_){return Wi(_,this._numMainBlocks)},E.prototype.extractParams=function(_){return ah(_,this._numMainBlocks)},E}(co);(function(P){P.FEMALE="female",P.MALE="male"})(uh||(uh={}));var Bm=function(P){function E(_){_===void 0&&(_=new s0(2));var k=P.call(this,"AgeGenderNet")||this;return k._faceFeatureExtractor=_,k}return Object(er.c)(E,P),Object.defineProperty(E.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),E.prototype.runNet=function(_){var k=this,D=this.params;if(!D)throw new Error(this._name+" - load model before inference");return ln.tidy(function(){var q=_ instanceof bi?k.faceFeatureExtractor.forwardInput(_):_,ee=ln.avgPool(q,[7,7],[2,2],"valid").as2D(q.shape[0],-1);return{age:ns(ee,D.fc.age).as1D(),gender:ns(ee,D.fc.gender)}})},E.prototype.forwardInput=function(_){var k=this;return ln.tidy(function(){var D=k.runNet(_),q=D.age,ee=D.gender;return{age:q,gender:ln.softmax(ee)}})},E.prototype.forward=function(_){return Object(er.b)(this,void 0,void 0,function(){var k;return Object(er.d)(this,function(D){switch(D.label){case 0:return k=this.forwardInput,[4,Oi(_)];case 1:return[2,k.apply(this,[D.sent()])]}})})},E.prototype.predictAgeAndGender=function(_){return Object(er.b)(this,void 0,void 0,function(){var k,D,q,ee,de,_e,Re=this;return Object(er.d)(this,function(De){switch(De.label){case 0:return[4,Oi(_)];case 1:return k=De.sent(),[4,this.forwardInput(k)];case 2:return D=De.sent(),q=ln.unstack(D.age),ee=ln.unstack(D.gender),de=q.map(function(tt,st){return{ageTensor:tt,genderTensor:ee[st]}}),[4,Promise.all(de.map(function(tt){var st=tt.ageTensor,It=tt.genderTensor;return Object(er.b)(Re,void 0,void 0,function(){var Bt,mn,xn,Fn,Rn;return Object(er.d)(this,function(Ln){switch(Ln.label){case 0:return[4,st.data()];case 1:return Bt=Ln.sent()[0],[4,It.data()];case 2:return mn=Ln.sent()[0],Fn=(xn=mn>.5)?uh.MALE:uh.FEMALE,Rn=xn?mn:1-mn,st.dispose(),It.dispose(),[2,{age:Bt,gender:Fn,genderProbability:Rn}]}})})}))];case 3:return _e=De.sent(),D.age.dispose(),D.gender.dispose(),[2,k.isBatchInput?_e:_e[0]]}})})},E.prototype.getDefaultModelName=function(){return"age_gender_model"},E.prototype.dispose=function(_){_===void 0&&(_=!0),this.faceFeatureExtractor.dispose(_),P.prototype.dispose.call(this,_)},E.prototype.loadClassifierParams=function(_){var k=this.extractClassifierParams(_),D=k.params,q=k.paramMappings;this._params=D,this._paramMappings=q},E.prototype.extractClassifierParams=function(_){return function(k){var D=[],q=Bs(k),ee=q.extractWeights,de=q.getRemainingWeights,_e=Cs(ee,D),Re=_e(512,1,"fc/age"),De=_e(512,2,"fc/gender");if(de().length!==0)throw new Error("weights remaing after extract: "+de().length);return{paramMappings:D,params:{fc:{age:Re,gender:De}}}}(_)},E.prototype.extractParamsFromWeigthMap=function(_){var k=Bu(_),D=k.featureExtractorMap,q=k.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(D),function(ee){var de=[],_e=Js(ee,de);function Re(tt){return{weights:_e(tt+"/weights",2),bias:_e(tt+"/bias",1)}}var De={fc:{age:Re("fc/age"),gender:Re("fc/gender")}};return Wa(ee,de),{params:De,paramMappings:de}}(q)},E.prototype.extractParams=function(_){var k=_.slice(0,_.length-1539),D=_.slice(_.length-1539);return this.faceFeatureExtractor.extractWeights(k),this.extractClassifierParams(D)},E}(co),Pm=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Object(er.c)(E,P),E.prototype.postProcess=function(_,k,D){var q=D.map(function(de){var _e=de.width,Re=de.height,De=k/Math.max(Re,_e);return{width:_e*De,height:Re*De}}),ee=q.length;return ln.tidy(function(){var de=function(Re,De){return ln.stack([ln.fill([68],Re),ln.fill([68],De)],1).as2D(1,136).as1D()},_e=function(Re,De){var tt=q[Re],st=tt.width,It=tt.height;return De(st,It)?Math.abs(st-It)/2:0};return _.mul(ln.fill([ee,136],k)).sub(ln.stack(Array.from(Array(ee),function(Re,De){return de(function(tt){return _e(tt,function(st,It){return st<It})}(De),function(tt){return _e(tt,function(st,It){return It<st})}(De))}))).div(ln.stack(Array.from(Array(ee),function(Re,De){return de(q[De].width,q[De].height)})))})},E.prototype.forwardInput=function(_){var k=this;return ln.tidy(function(){var D=k.runNet(_);return k.postProcess(D,_.inputSize,_.inputDimensions.map(function(q){return{height:q[0],width:q[1]}}))})},E.prototype.forward=function(_){return Object(er.b)(this,void 0,void 0,function(){var k;return Object(er.d)(this,function(D){switch(D.label){case 0:return k=this.forwardInput,[4,Oi(_)];case 1:return[2,k.apply(this,[D.sent()])]}})})},E.prototype.detectLandmarks=function(_){return Object(er.b)(this,void 0,void 0,function(){var k,D,q,ee=this;return Object(er.d)(this,function(de){switch(de.label){case 0:return[4,Oi(_)];case 1:return k=de.sent(),D=ln.tidy(function(){return ln.unstack(ee.forwardInput(k))}),[4,Promise.all(D.map(function(_e,Re){return Object(er.b)(ee,void 0,void 0,function(){var De,tt,st,It,Bt;return Object(er.d)(this,function(mn){switch(mn.label){case 0:return st=(tt=Array).from,[4,_e.data()];case 1:return De=st.apply(tt,[mn.sent()]),It=De.filter(function(xn,Fn){return Ro(Fn)}),Bt=De.filter(function(xn,Fn){return!Ro(Fn)}),[2,new kl(Array(68).fill(0).map(function(xn,Fn){return new po(It[Fn],Bt[Fn])}),{height:k.getInputHeight(Re),width:k.getInputWidth(Re)})]}})})}))];case 2:return q=de.sent(),D.forEach(function(_e){return _e.dispose()}),[2,k.isBatchInput?q:q[0]]}})})},E.prototype.getClassifierChannelsOut=function(){return 136},E}(Da),Kp=function(P){function E(_){return _===void 0&&(_=new dc),P.call(this,"FaceLandmark68Net",_)||this}return Object(er.c)(E,P),E.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},E.prototype.getClassifierChannelsIn=function(){return 256},E}(Pm),u0=function(P){function E(){return P.call(this,"TinyFaceFeatureExtractor")||this}return Object(er.c)(E,P),E.prototype.forwardInput=function(_){var k=this.params;if(!k)throw new Error("TinyFaceFeatureExtractor - load model before inference");return ln.tidy(function(){var D=Pa(lf(_.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(ln.scalar(255)),k.dense0,!0);return D=Pa(D=Pa(D,k.dense1),k.dense2),D=ln.avgPool(D,[14,14],[2,2],"valid")})},E.prototype.forward=function(_){return Object(er.b)(this,void 0,void 0,function(){var k;return Object(er.d)(this,function(D){switch(D.label){case 0:return k=this.forwardInput,[4,Oi(_)];case 1:return[2,k.apply(this,[D.sent()])]}})})},E.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},E.prototype.extractParamsFromWeigthMap=function(_){return function(k){var D=[],q=_u(k,D).extractDenseBlock3Params,ee={dense0:q("dense0",!0),dense1:q("dense1"),dense2:q("dense2")};return Wa(k,D),{params:ee,paramMappings:D}}(_)},E.prototype.extractParams=function(_){return function(k){var D=[],q=Bs(k),ee=q.extractWeights,de=q.getRemainingWeights,_e=Fa(ee,D).extractDenseBlock3Params,Re=_e(3,32,"dense0",!0),De=_e(32,64,"dense1"),tt=_e(64,128,"dense2");if(de().length!==0)throw new Error("weights remaing after extract: "+de().length);return{paramMappings:D,params:{dense0:Re,dense1:De,dense2:tt}}}(_)},E}(co),Xp=function(P){function E(_){return _===void 0&&(_=new u0),P.call(this,"FaceLandmark68TinyNet",_)||this}return Object(er.c)(E,P),E.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},E.prototype.getClassifierChannelsIn=function(){return 128},E}(Pm),sa=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Object(er.c)(E,P),E}(Kp);function Ad(P,E,_,k,D){D===void 0&&(D="same");var q=E.conv,ee=q.filters,de=q.bias,_e=ln.conv2d(P,ee,_,D);return _e=function(Re,De){return ln.add(ln.mul(Re,De.weights),De.biases)}(_e=ln.add(_e,de),E.scale),k?ln.relu(_e):_e}function Yp(P,E){return Ad(P,E,[1,1],!1)}function ip(P,E){return Ad(P,E,[2,2],!0,"valid")}function Tg(P,E){function _(D,q,ee,de){var _e=function(De,tt,st){var It=P(De),Bt=It.length/(tt*st*st);if(Ds(Bt))throw new Error("depth has to be an integer: "+Bt+", weights.length: "+It.length+", numFilters: "+tt+", filterSize: "+st);return ln.tidy(function(){return ln.transpose(ln.tensor4d(It,[tt,Bt,st,st]),[2,3,1,0])})}(D,q,ee),Re=ln.tensor1d(P(q));return E.push({paramPath:de+"/filters"},{paramPath:de+"/bias"}),{filters:_e,bias:Re}}function k(D,q,ee,de){return{conv:_(D,q,ee,de+"/conv"),scale:function(_e,Re){var De=ln.tensor1d(P(_e)),tt=ln.tensor1d(P(_e));return E.push({paramPath:Re+"/weights"},{paramPath:Re+"/biases"}),{weights:De,biases:tt}}(q,de+"/scale")}}return{extractConvLayerParams:k,extractResidualLayerParams:function(D,q,ee,de,_e){return _e===void 0&&(_e=!1),{conv1:k((_e?.5:1)*D,q,ee,de+"/conv1"),conv2:k(D,q,ee,de+"/conv2")}}}}function c0(P,E){var _=Js(P,E);function k(D){return{conv:{filters:_(D+"/conv/filters",4),bias:_(D+"/conv/bias",1)},scale:function(q){return{weights:_(q+"/scale/weights",1),biases:_(q+"/scale/biases",1)}}(D)}}return{extractConvLayerParams:k,extractResidualLayerParams:function(D){return{conv1:k(D+"/conv1"),conv2:k(D+"/conv2")}}}}function Nf(P,E){var _=function(k,D){return Ad(k,D,[1,1],!0)}(P,E.conv1);return _=Yp(_,E.conv2),_=ln.add(_,P),_=ln.relu(_)}function Zu(P,E){var _=ip(P,E.conv1);_=Yp(_,E.conv2);var k=ln.avgPool(P,2,2,"valid"),D=ln.zeros(k.shape),q=k.shape[3]!==_.shape[3];if(k.shape[1]!==_.shape[1]||k.shape[2]!==_.shape[2]){var ee=Object(er.e)(_.shape);ee[1]=1;var de=ln.zeros(ee);_=ln.concat([_,de],1);var _e=Object(er.e)(_.shape);_e[2]=1;var Re=ln.zeros(_e);_=ln.concat([_,Re],2)}return k=q?ln.concat([k,D],3):k,_=ln.add(k,_),_=ln.relu(_)}var Jp=function(P){function E(){return P.call(this,"FaceRecognitionNet")||this}return Object(er.c)(E,P),E.prototype.forwardInput=function(_){var k=this.params;if(!k)throw new Error("FaceRecognitionNet - load model before inference");return ln.tidy(function(){var D=ip(lf(_.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(ln.scalar(256)),k.conv32_down),q=(D=Zu(D=Nf(D=Nf(D=Zu(D=Nf(D=Nf(D=Zu(D=Nf(D=Nf(D=Nf(D=Zu(D=Nf(D=Nf(D=Nf(D=ln.maxPool(D,3,2,"valid"),k.conv32_1),k.conv32_2),k.conv32_3),k.conv64_down),k.conv64_1),k.conv64_2),k.conv64_3),k.conv128_down),k.conv128_1),k.conv128_2),k.conv256_down),k.conv256_1),k.conv256_2),k.conv256_down_out)).mean([1,2]);return ln.matMul(q,k.fc)})},E.prototype.forward=function(_){return Object(er.b)(this,void 0,void 0,function(){var k;return Object(er.d)(this,function(D){switch(D.label){case 0:return k=this.forwardInput,[4,Oi(_)];case 1:return[2,k.apply(this,[D.sent()])]}})})},E.prototype.computeFaceDescriptor=function(_){return Object(er.b)(this,void 0,void 0,function(){var k,D,q,ee=this;return Object(er.d)(this,function(de){switch(de.label){case 0:return[4,Oi(_)];case 1:return k=de.sent(),D=ln.tidy(function(){return ln.unstack(ee.forwardInput(k))}),[4,Promise.all(D.map(function(_e){return _e.data()}))];case 2:return q=de.sent(),D.forEach(function(_e){return _e.dispose()}),[2,k.isBatchInput?q:q[0]]}})})},E.prototype.getDefaultModelName=function(){return"face_recognition_model"},E.prototype.extractParamsFromWeigthMap=function(_){return function(k){var D=[],q=c0(k,D),ee=q.extractConvLayerParams,de=q.extractResidualLayerParams,_e=ee("conv32_down"),Re=de("conv32_1"),De=de("conv32_2"),tt=de("conv32_3"),st=de("conv64_down"),It=de("conv64_1"),Bt=de("conv64_2"),mn=de("conv64_3"),xn=de("conv128_down"),Fn=de("conv128_1"),Rn=de("conv128_2"),Ln=de("conv256_down"),Zn=de("conv256_1"),An=de("conv256_2"),Sr=de("conv256_down_out"),Ur=k.fc;if(D.push({originalPath:"fc",paramPath:"fc"}),!jl(Ur))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+Ur);var Wr={conv32_down:_e,conv32_1:Re,conv32_2:De,conv32_3:tt,conv64_down:st,conv64_1:It,conv64_2:Bt,conv64_3:mn,conv128_down:xn,conv128_1:Fn,conv128_2:Rn,conv256_down:Ln,conv256_1:Zn,conv256_2:An,conv256_down_out:Sr,fc:Ur};return Wa(k,D),{params:Wr,paramMappings:D}}(_)},E.prototype.extractParams=function(_){return function(k){var D=Bs(k),q=D.extractWeights,ee=D.getRemainingWeights,de=[],_e=Tg(q,de),Re=_e.extractConvLayerParams,De=_e.extractResidualLayerParams,tt=Re(4704,32,7,"conv32_down"),st=De(9216,32,3,"conv32_1"),It=De(9216,32,3,"conv32_2"),Bt=De(9216,32,3,"conv32_3"),mn=De(36864,64,3,"conv64_down",!0),xn=De(36864,64,3,"conv64_1"),Fn=De(36864,64,3,"conv64_2"),Rn=De(36864,64,3,"conv64_3"),Ln=De(147456,128,3,"conv128_down",!0),Zn=De(147456,128,3,"conv128_1"),An=De(147456,128,3,"conv128_2"),Sr=De(589824,256,3,"conv256_down",!0),Ur=De(589824,256,3,"conv256_1"),Wr=De(589824,256,3,"conv256_2"),ci=De(589824,256,3,"conv256_down_out"),Jr=ln.tidy(function(){return ln.transpose(ln.tensor2d(q(32768),[128,256]),[1,0])});if(de.push({paramPath:"fc"}),ee().length!==0)throw new Error("weights remaing after extract: "+ee().length);return{params:{conv32_down:tt,conv32_1:st,conv32_2:It,conv32_3:Bt,conv64_down:mn,conv64_1:xn,conv64_2:Fn,conv64_3:Rn,conv128_down:Ln,conv128_1:Zn,conv128_2:An,conv256_down:Sr,conv256_1:Ur,conv256_2:Wr,conv256_down_out:ci,fc:Jr},paramMappings:de}}(_)},E}(co);function op(P){var E=new Jp;return E.extractWeights(P),E}function Qp(P,E){var _={descriptor:E};return Object.assign({},P,_)}function l0(P){return typeof P.age=="number"}function Lm(P,E){var _={age:E};return Object.assign({},P,_)}function ec(P){return(P.gender===uh.MALE||P.gender===uh.FEMALE)&&Mu(P.genderProbability)}function il(P,E,_){var k={gender:E,genderProbability:_};return Object.assign({},P,k)}var zl=function(){function P(E){var _=E===void 0?{}:E,k=_.minFaceSize,D=_.scaleFactor,q=_.maxNumScales,ee=_.scoreThresholds,de=_.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=k||20,this._scaleFactor=D||.709,this._maxNumScales=q||10,this._scoreThresholds=ee||[.6,.7,.7],this._scaleSteps=de,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(_e){return typeof _e!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(_e){return typeof _e!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(P.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),P}();function zm(P,E){function _(q,ee,de,_e,Re){var De=ln.tensor4d(P(q*ee*de*de),[de,de,q,ee]),tt=ln.tensor1d(P(ee));return E.push({paramPath:_e+"/filters"},{paramPath:_e+"/"+(Re?"batch_norm_offset":"bias")}),{filters:De,bias:tt}}function k(q,ee,de,_e){var Re=_(q,ee,de,_e,!0);return{filters:Re.filters,batch_norm_offset:Re.bias}}function D(q,ee,de){return{depthwise_conv:function(_e,Re){var De=ln.tensor4d(P(9*_e),[3,3,_e,1]),tt=ln.tensor1d(P(_e)),st=ln.tensor1d(P(_e)),It=ln.tensor1d(P(_e)),Bt=ln.tensor1d(P(_e));return E.push({paramPath:Re+"/filters"},{paramPath:Re+"/batch_norm_scale"},{paramPath:Re+"/batch_norm_offset"},{paramPath:Re+"/batch_norm_mean"},{paramPath:Re+"/batch_norm_variance"}),{filters:De,batch_norm_scale:tt,batch_norm_offset:st,batch_norm_mean:It,batch_norm_variance:Bt}}(q,de+"/depthwise_conv"),pointwise_conv:k(q,ee,1,de+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:k(3,32,3,"mobilenetv1/conv_0"),conv_1:D(32,64,"mobilenetv1/conv_1"),conv_2:D(64,128,"mobilenetv1/conv_2"),conv_3:D(128,128,"mobilenetv1/conv_3"),conv_4:D(128,256,"mobilenetv1/conv_4"),conv_5:D(256,256,"mobilenetv1/conv_5"),conv_6:D(256,512,"mobilenetv1/conv_6"),conv_7:D(512,512,"mobilenetv1/conv_7"),conv_8:D(512,512,"mobilenetv1/conv_8"),conv_9:D(512,512,"mobilenetv1/conv_9"),conv_10:D(512,512,"mobilenetv1/conv_10"),conv_11:D(512,512,"mobilenetv1/conv_11"),conv_12:D(512,1024,"mobilenetv1/conv_12"),conv_13:D(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:k(1024,256,1,"prediction_layer/conv_0"),conv_1:k(256,512,3,"prediction_layer/conv_1"),conv_2:k(512,128,1,"prediction_layer/conv_2"),conv_3:k(128,256,3,"prediction_layer/conv_3"),conv_4:k(256,128,1,"prediction_layer/conv_4"),conv_5:k(128,256,3,"prediction_layer/conv_5"),conv_6:k(256,64,1,"prediction_layer/conv_6"),conv_7:k(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:_(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:_(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:_(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:_(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:_(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:_(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:_(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:_(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:_(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:_(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:_(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:_(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function ap(P){var E=[],_=function(de,_e){var Re=Js(de,_e);function De(Bt,mn,xn){return{filters:Re(Bt+"/Conv2d_"+mn+"_pointwise/weights",4,xn+"/filters"),batch_norm_offset:Re(Bt+"/Conv2d_"+mn+"_pointwise/convolution_bn_offset",1,xn+"/batch_norm_offset")}}function tt(Bt){var mn="mobilenetv1/conv_"+Bt,xn="MobilenetV1/Conv2d_"+Bt+"_depthwise",Fn=mn+"/depthwise_conv",Rn=mn+"/pointwise_conv";return{depthwise_conv:{filters:Re(xn+"/depthwise_weights",4,Fn+"/filters"),batch_norm_scale:Re(xn+"/BatchNorm/gamma",1,Fn+"/batch_norm_scale"),batch_norm_offset:Re(xn+"/BatchNorm/beta",1,Fn+"/batch_norm_offset"),batch_norm_mean:Re(xn+"/BatchNorm/moving_mean",1,Fn+"/batch_norm_mean"),batch_norm_variance:Re(xn+"/BatchNorm/moving_variance",1,Fn+"/batch_norm_variance")},pointwise_conv:De("MobilenetV1",Bt,Rn)}}function st(Bt,mn){return{filters:Re(Bt+"/weights",4,mn+"/filters"),bias:Re(Bt+"/biases",1,mn+"/bias")}}function It(Bt){return{box_encoding_predictor:st("Prediction/BoxPredictor_"+Bt+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+Bt+"/box_encoding_predictor"),class_predictor:st("Prediction/BoxPredictor_"+Bt+"/ClassPredictor","prediction_layer/box_predictor_"+Bt+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:De("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:tt(1),conv_2:tt(2),conv_3:tt(3),conv_4:tt(4),conv_5:tt(5),conv_6:tt(6),conv_7:tt(7),conv_8:tt(8),conv_9:tt(9),conv_10:tt(10),conv_11:tt(11),conv_12:tt(12),conv_13:tt(13)}},extractPredictionLayerParams:function(){return{conv_0:De("Prediction",0,"prediction_layer/conv_0"),conv_1:De("Prediction",1,"prediction_layer/conv_1"),conv_2:De("Prediction",2,"prediction_layer/conv_2"),conv_3:De("Prediction",3,"prediction_layer/conv_3"),conv_4:De("Prediction",4,"prediction_layer/conv_4"),conv_5:De("Prediction",5,"prediction_layer/conv_5"),conv_6:De("Prediction",6,"prediction_layer/conv_6"),conv_7:De("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:It(0),box_predictor_1:It(1),box_predictor_2:It(2),box_predictor_3:It(3),box_predictor_4:It(4),box_predictor_5:It(5)}}}}(P,E),k=_.extractMobilenetV1Params,D=_.extractPredictionLayerParams,q=P["Output/extra_dim"];if(E.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!wr(q))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+q);var ee={mobilenetv1:k(),prediction_layer:D(),output_layer:{extra_dim:q}};return Wa(P,E),{params:ee,paramMappings:E}}function ol(P,E,_){return ln.tidy(function(){var k=ln.conv2d(P,E.filters,_,"same");return k=ln.add(k,E.batch_norm_offset),ln.clipByValue(k,0,6)})}var Zp=.0010000000474974513;function Od(P,E){return ln.tidy(function(){var _=null,k=ol(P,E.conv_0,[2,2]);if([E.conv_1,E.conv_2,E.conv_3,E.conv_4,E.conv_5,E.conv_6,E.conv_7,E.conv_8,E.conv_9,E.conv_10,E.conv_11,E.conv_12,E.conv_13].forEach(function(D,q){var ee=q+1,de=function(_e){return[2,4,6,12].some(function(Re){return Re===_e})?[2,2]:[1,1]}(ee);k=ol(k=function(_e,Re,De){return ln.tidy(function(){var tt=ln.depthwiseConv2d(_e,Re.filters,De,"same");return tt=ln.batchNorm(tt,Re.batch_norm_mean,Re.batch_norm_variance,Re.batch_norm_offset,Re.batch_norm_scale,Zp),ln.clipByValue(tt,0,6)})}(k,D.depthwise_conv,de),D.pointwise_conv,[1,1]),ee===11&&(_=k)}),_===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:k,conv11:_}})}function Sd(P,E,_){var k=P.arraySync(),D=Math.min(k[E][0],k[E][2]),q=Math.min(k[E][1],k[E][3]),ee=Math.max(k[E][0],k[E][2]),de=Math.max(k[E][1],k[E][3]),_e=Math.min(k[_][0],k[_][2]),Re=Math.min(k[_][1],k[_][3]),De=Math.max(k[_][0],k[_][2]),tt=Math.max(k[_][1],k[_][3]),st=(ee-D)*(de-q),It=(De-_e)*(tt-Re);if(st<=0||It<=0)return 0;var Bt=Math.max(D,_e),mn=Math.max(q,Re),xn=Math.min(ee,De),Fn=Math.min(de,tt),Rn=Math.max(xn-Bt,0)*Math.max(Fn-mn,0);return Rn/(st+It-Rn)}function Ng(P,E){var _=function(De){var tt=ln.unstack(ln.transpose(De,[1,0])),st=[ln.sub(tt[2],tt[0]),ln.sub(tt[3],tt[1])];return{sizes:st,centers:[ln.add(tt[0],ln.div(st[0],ln.scalar(2))),ln.add(tt[1],ln.div(st[1],ln.scalar(2)))]}}(P),k=_.sizes,D=_.centers,q=ln.unstack(ln.transpose(E,[1,0])),ee=ln.div(ln.mul(ln.exp(ln.div(q[2],ln.scalar(5))),k[0]),ln.scalar(2)),de=ln.add(ln.mul(ln.div(q[0],ln.scalar(10)),k[0]),D[0]),_e=ln.div(ln.mul(ln.exp(ln.div(q[3],ln.scalar(5))),k[1]),ln.scalar(2)),Re=ln.add(ln.mul(ln.div(q[1],ln.scalar(10)),k[1]),D[1]);return ln.transpose(ln.stack([ln.sub(de,ee),ln.sub(Re,_e),ln.add(de,ee),ln.add(Re,_e)]),[1,0])}function Ul(P,E){return ln.tidy(function(){var _=P.shape[0];return{boxPredictionEncoding:ln.reshape(Qo(P,E.box_encoding_predictor),[_,-1,1,4]),classPrediction:ln.reshape(Qo(P,E.class_predictor),[_,-1,3])}})}var If=function(){function P(E){var _=E===void 0?{}:E,k=_.minConfidence,D=_.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=k||.5,this._maxResults=D||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(P.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),P}(),Wl=function(P){function E(){return P.call(this,"SsdMobilenetv1")||this}return Object(er.c)(E,P),E.prototype.forwardInput=function(_){var k=this.params;if(!k)throw new Error("SsdMobilenetv1 - load model before inference");return ln.tidy(function(){var D=_.toBatchTensor(512,!1).toFloat(),q=Od(ln.sub(ln.mul(D,ln.scalar(.007843137718737125)),ln.scalar(1)),k.mobilenetv1),ee=function(de,_e,Re){return ln.tidy(function(){var De=ol(ol(de,Re.conv_0,[1,1]),Re.conv_1,[2,2]),tt=ol(ol(De,Re.conv_2,[1,1]),Re.conv_3,[2,2]),st=ol(ol(tt,Re.conv_4,[1,1]),Re.conv_5,[2,2]),It=ol(ol(st,Re.conv_6,[1,1]),Re.conv_7,[2,2]),Bt=Ul(_e,Re.box_predictor_0),mn=Ul(de,Re.box_predictor_1),xn=Ul(De,Re.box_predictor_2),Fn=Ul(tt,Re.box_predictor_3),Rn=Ul(st,Re.box_predictor_4),Ln=Ul(It,Re.box_predictor_5);return{boxPredictions:ln.concat([Bt.boxPredictionEncoding,mn.boxPredictionEncoding,xn.boxPredictionEncoding,Fn.boxPredictionEncoding,Rn.boxPredictionEncoding,Ln.boxPredictionEncoding],1),classPredictions:ln.concat([Bt.classPrediction,mn.classPrediction,xn.classPrediction,Fn.classPrediction,Rn.classPrediction,Ln.classPrediction],1)}})}(q.out,q.conv11,k.prediction_layer);return function(de,_e,Re){return ln.tidy(function(){var De=de.shape[0],tt=Ng(ln.reshape(ln.tile(Re.extra_dim,[De,1,1]),[-1,4]),ln.reshape(de,[-1,4]));tt=ln.reshape(tt,[De,tt.shape[0]/De,4]);var st=ln.sigmoid(ln.slice(_e,[0,0,1],[-1,-1,-1])),It=ln.slice(st,[0,0,0],[-1,-1,1]);return It=ln.reshape(It,[De,It.shape[1]]),{boxes:ln.unstack(tt),scores:ln.unstack(It)}})}(ee.boxPredictions,ee.classPredictions,k.output_layer)})},E.prototype.forward=function(_){return Object(er.b)(this,void 0,void 0,function(){var k;return Object(er.d)(this,function(D){switch(D.label){case 0:return k=this.forwardInput,[4,Oi(_)];case 1:return[2,k.apply(this,[D.sent()])]}})})},E.prototype.locateFaces=function(_,k){return k===void 0&&(k={}),Object(er.b)(this,void 0,void 0,function(){var D,q,ee,de,_e,Re,De,tt,st,It,Bt,mn,xn,Fn,Rn,Ln,Zn,An,Sr,Ur;return Object(er.d)(this,function(Wr){switch(Wr.label){case 0:return D=new If(k),q=D.maxResults,ee=D.minConfidence,[4,Oi(_)];case 1:for(de=Wr.sent(),_e=this.forwardInput(de),Re=_e.boxes,De=_e.scores,tt=Re[0],st=De[0],It=1;It<Re.length;It++)Re[It].dispose(),De[It].dispose();return xn=(mn=Array).from,[4,st.data()];case 2:return Bt=xn.apply(mn,[Wr.sent()]),Fn=function(ci,Jr,Xi,lo,io){var ga=ci.shape[0],Ya=Math.min(Xi,ga),Ta=function(Ma){return Ma<=lo?1:0},Aa=[];return Jr.map(function(Ma,rs){return{score:Ma,boxIndex:rs}}).filter(function(Ma){return Ma.score>io}).sort(function(Ma,rs){return rs.score-Ma.score}).forEach(function(Ma){if(!(Aa.length>=Ya)){for(var rs=Ma.score,va=Aa.length-1;va>=0;--va){var Ns=Sd(ci,Ma.boxIndex,Aa[va]);if(Ns!==0&&(Ma.score*=Ta(Ns),Ma.score<=io))break}rs===Ma.score&&Aa.push(Ma.boxIndex)}}),Aa}(tt,Bt,q,.5,ee),Rn=de.getReshapedInputDimensions(0),Ln=de.inputSize,Zn=Ln/Rn.width,An=Ln/Rn.height,Sr=tt.arraySync(),Ur=Fn.map(function(ci){var Jr=[Math.max(0,Sr[ci][0]),Math.min(1,Sr[ci][2])].map(function(Ta){return Ta*An}),Xi=Jr[0],lo=Jr[1],io=[Math.max(0,Sr[ci][1]),Math.min(1,Sr[ci][3])].map(function(Ta){return Ta*Zn}),ga=io[0],Ya=io[1];return new ts(Bt[ci],new oh(ga,Xi,Ya-ga,lo-Xi),{height:de.getInputHeight(0),width:de.getInputWidth(0)})}),tt.dispose(),st.dispose(),[2,Ur]}})})},E.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},E.prototype.extractParamsFromWeigthMap=function(_){return ap(_)},E.prototype.extractParams=function(_){return function(k){var D=[],q=Bs(k),ee=q.extractWeights,de=q.getRemainingWeights,_e=zm(ee,D),Re=_e.extractMobilenetV1Params,De=_e.extractPredictionLayerParams,tt=Re(),st=De(),It={extra_dim:ln.tensor3d(ee(20472),[1,5118,4])};if(D.push({paramPath:"output_layer/extra_dim"}),de().length!==0)throw new Error("weights remaing after extract: "+de().length);return{params:{mobilenetv1:tt,prediction_layer:st,output_layer:It},paramMappings:D}}(_)},E}(co);function Ig(P){var E=new Wl;return E.extractWeights(P),E}function Fg(P){return Ig(P)}var em,yv=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Object(er.c)(E,P),E}(Wl),bv=.4,ra=[new po(.738768,.874946),new po(2.42204,2.65704),new po(4.30971,7.04493),new po(10.246,4.59428),new po(12.6868,11.8741)],Rg=[new po(1.603231,2.094468),new po(6.041143,7.080126),new po(2.882459,3.518061),new po(4.266906,5.178857),new po(9.041765,10.66308)],Mg=[117.001,114.697,97.404],Um=function(P){return typeof P=="number"};function jg(P){if(!P)throw new Error("invalid config: "+P);if(typeof P.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+P.withSeparableConvs);if(!Um(P.iouThreshold)||P.iouThreshold<0||P.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+P.iouThreshold);if(!Array.isArray(P.classes)||!P.classes.length||!P.classes.every(function(E){return typeof E=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(P.classes));if(!Array.isArray(P.anchors)||!P.anchors.length||!P.anchors.map(function(E){return E||{}}).every(function(E){return Um(E.x)&&Um(E.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(P.anchors));if(P.meanRgb&&(!Array.isArray(P.meanRgb)||P.meanRgb.length!==3||!P.meanRgb.every(Um)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(P.meanRgb))}function sp(P){return ln.tidy(function(){var E=ln.mul(P,ln.scalar(.10000000149011612));return ln.add(ln.relu(ln.sub(P,E)),E)})}function ou(P,E){return ln.tidy(function(){var _=ln.pad(P,[[0,0],[1,1],[1,1],[0,0]]);return _=ln.conv2d(_,E.conv.filters,[1,1],"valid"),_=ln.sub(_,E.bn.sub),_=ln.mul(_,E.bn.truediv),sp(_=ln.add(_,E.conv.bias))})}function tc(P,E){return ln.tidy(function(){var _=ln.pad(P,[[0,0],[1,1],[1,1],[0,0]]);return _=ln.separableConv2d(_,E.depthwise_filter,E.pointwise_filter,[1,1],"valid"),sp(_=ln.add(_,E.bias))})}function f0(P,E){var _=ku(P,E),k=_s(P,E);return{extractConvParams:_,extractConvWithBatchNormParams:function(D,q,ee){return{conv:_(D,q,3,ee+"/conv"),bn:function(de,_e){var Re=ln.tensor1d(P(de)),De=ln.tensor1d(P(de));return E.push({paramPath:_e+"/sub"},{paramPath:_e+"/truediv"}),{sub:Re,truediv:De}}(q,ee+"/bn")}},extractSeparableConvParams:k}}function h0(P,E){var _=Js(P,E);function k(D){return{filters:_(D+"/filters",4),bias:_(D+"/bias",1)}}return{extractConvParams:k,extractConvWithBatchNormParams:function(D){return{conv:k(D+"/conv"),bn:function(q){return{sub:_(q+"/sub",1),truediv:_(q+"/truediv",1)}}(D+"/bn")}},extractSeparableConvParams:_l(_)}}(function(P){P[P.XS=224]="XS",P[P.SM=320]="SM",P[P.MD=416]="MD",P[P.LG=608]="LG"})(em||(em={}));var ch=function(){function P(E){var _=E===void 0?{}:E,k=_.inputSize,D=_.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=k||416,this._scoreThreshold=D||.5,typeof this._inputSize!="number"||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(P.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),P}(),Vl=function(P){function E(_){var k=P.call(this,"TinyYolov2")||this;return jg(_),k._config=_,k}return Object(er.c)(E,P),Object.defineProperty(E.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),E.prototype.runTinyYolov2=function(_,k){var D=ou(_,k.conv0);return D=ou(D=ln.maxPool(D,[2,2],[2,2],"same"),k.conv1),D=ou(D=ln.maxPool(D,[2,2],[2,2],"same"),k.conv2),D=ou(D=ln.maxPool(D,[2,2],[2,2],"same"),k.conv3),D=ou(D=ln.maxPool(D,[2,2],[2,2],"same"),k.conv4),D=ou(D=ln.maxPool(D,[2,2],[2,2],"same"),k.conv5),Qo(D=ou(D=ou(D=ln.maxPool(D,[2,2],[1,1],"same"),k.conv6),k.conv7),k.conv8,"valid",!1)},E.prototype.runMobilenet=function(_,k){var D=this.config.isFirstLayerConv2d?sp(Qo(_,k.conv0,"valid",!1)):tc(_,k.conv0);return D=tc(D=ln.maxPool(D,[2,2],[2,2],"same"),k.conv1),D=tc(D=ln.maxPool(D,[2,2],[2,2],"same"),k.conv2),D=tc(D=ln.maxPool(D,[2,2],[2,2],"same"),k.conv3),D=tc(D=ln.maxPool(D,[2,2],[2,2],"same"),k.conv4),D=tc(D=ln.maxPool(D,[2,2],[2,2],"same"),k.conv5),D=ln.maxPool(D,[2,2],[1,1],"same"),D=k.conv6?tc(D,k.conv6):D,Qo(D=k.conv7?tc(D,k.conv7):D,k.conv8,"valid",!1)},E.prototype.forwardInput=function(_,k){var D=this,q=this.params;if(!q)throw new Error("TinyYolov2 - load model before inference");return ln.tidy(function(){var ee=_.toBatchTensor(k,!1).toFloat();return ee=(ee=D.config.meanRgb?lf(ee,D.config.meanRgb):ee).div(ln.scalar(256)),D.config.withSeparableConvs?D.runMobilenet(ee,q):D.runTinyYolov2(ee,q)})},E.prototype.forward=function(_,k){return Object(er.b)(this,void 0,void 0,function(){var D;return Object(er.d)(this,function(q){switch(q.label){case 0:return D=this.forwardInput,[4,Oi(_)];case 1:return[4,D.apply(this,[q.sent(),k])];case 2:return[2,q.sent()]}})})},E.prototype.detect=function(_,k){return k===void 0&&(k={}),Object(er.b)(this,void 0,void 0,function(){var D,q,ee,de,_e,Re,De,tt,st,It,Bt,mn,xn,Fn=this;return Object(er.d)(this,function(Rn){switch(Rn.label){case 0:return D=new ch(k),q=D.inputSize,ee=D.scoreThreshold,[4,Oi(_)];case 1:return de=Rn.sent(),[4,this.forwardInput(de,q)];case 2:return _e=Rn.sent(),Re=ln.tidy(function(){return ln.unstack(_e)[0].expandDims()}),De={width:de.getInputWidth(0),height:de.getInputHeight(0)},[4,this.extractBoxes(Re,de.getReshapedInputDimensions(0),ee)];case 3:return tt=Rn.sent(),_e.dispose(),Re.dispose(),st=tt.map(function(Ln){return Ln.box}),It=tt.map(function(Ln){return Ln.score}),Bt=tt.map(function(Ln){return Ln.classScore}),mn=tt.map(function(Ln){return Fn.config.classes[Ln.label]}),xn=Pl(st.map(function(Ln){return Ln.rescale(q)}),It,this.config.iouThreshold,!0),[2,xn.map(function(Ln){return new ju(It[Ln],Bt[Ln],mn[Ln],st[Ln],De)})]}})})},E.prototype.getDefaultModelName=function(){return""},E.prototype.extractParamsFromWeigthMap=function(_){return function(k,D){var q,ee=[],de=h0(k,ee),_e=de.extractConvParams,Re=de.extractConvWithBatchNormParams,De=de.extractSeparableConvParams;if(D.withSeparableConvs){var tt=D.filterSizes&&D.filterSizes.length||9;q={conv0:D.isFirstLayerConv2d?_e("conv0"):De("conv0"),conv1:De("conv1"),conv2:De("conv2"),conv3:De("conv3"),conv4:De("conv4"),conv5:De("conv5"),conv6:tt>7?De("conv6"):void 0,conv7:tt>8?De("conv7"):void 0,conv8:_e("conv8")}}else q={conv0:Re("conv0"),conv1:Re("conv1"),conv2:Re("conv2"),conv3:Re("conv3"),conv4:Re("conv4"),conv5:Re("conv5"),conv6:Re("conv6"),conv7:Re("conv7"),conv8:_e("conv8")};return Wa(k,ee),{params:q,paramMappings:ee}}(_,this.config)},E.prototype.extractParams=function(_){var k=this.config.filterSizes||E.DEFAULT_FILTER_SIZES,D=k?k.length:void 0;if(D!==7&&D!==8&&D!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+D+" filterSizes in config");return function(q,ee,de,_e){var Re,De=Bs(q),tt=De.extractWeights,st=De.getRemainingWeights,It=[],Bt=f0(tt,It),mn=Bt.extractConvParams,xn=Bt.extractConvWithBatchNormParams,Fn=Bt.extractSeparableConvParams;if(ee.withSeparableConvs){var Rn=_e[0],Ln=_e[1],Zn=_e[2],An=_e[3],Sr=_e[4],Ur=_e[5],Wr=_e[6],ci=_e[7],Jr=_e[8];Re={conv0:ee.isFirstLayerConv2d?mn(Rn,Ln,3,"conv0"):Fn(Rn,Ln,"conv0"),conv1:Fn(Ln,Zn,"conv1"),conv2:Fn(Zn,An,"conv2"),conv3:Fn(An,Sr,"conv3"),conv4:Fn(Sr,Ur,"conv4"),conv5:Fn(Ur,Wr,"conv5"),conv6:ci?Fn(Wr,ci,"conv6"):void 0,conv7:Jr?Fn(ci,Jr,"conv7"):void 0,conv8:mn(Jr||ci||Wr,5*de,1,"conv8")}}else Rn=_e[0],Ln=_e[1],Zn=_e[2],An=_e[3],Sr=_e[4],Ur=_e[5],Wr=_e[6],ci=_e[7],Jr=_e[8],Re={conv0:xn(Rn,Ln,"conv0"),conv1:xn(Ln,Zn,"conv1"),conv2:xn(Zn,An,"conv2"),conv3:xn(An,Sr,"conv3"),conv4:xn(Sr,Ur,"conv4"),conv5:xn(Ur,Wr,"conv5"),conv6:xn(Wr,ci,"conv6"),conv7:xn(ci,Jr,"conv7"),conv8:mn(Jr,5*de,1,"conv8")};if(st().length!==0)throw new Error("weights remaing after extract: "+st().length);return{params:Re,paramMappings:It}}(_,this.config,this.boxEncodingSize,k)},E.prototype.extractBoxes=function(_,k,D){return Object(er.b)(this,void 0,void 0,function(){var q,ee,de,_e,Re,De,tt,st,It,Bt,mn,xn,Fn,Rn,Ln,Zn,An,Sr,Ur,Wr,ci,Jr,Xi,lo,io,ga,Ya,Ta,Aa,Ma=this;return Object(er.d)(this,function(rs){switch(rs.label){case 0:return q=k.width,ee=k.height,de=Math.max(q,ee),_e=de/q,Re=de/ee,De=_.shape[1],tt=this.config.anchors.length,st=ln.tidy(function(){var va=_.reshape([De,De,tt,Ma.boxEncodingSize]);return[va.slice([0,0,0,0],[De,De,tt,4]),va.slice([0,0,0,4],[De,De,tt,1]),Ma.withClassScores?ln.softmax(va.slice([0,0,0,5],[De,De,tt,Ma.config.classes.length]),3):ln.scalar(0)]}),It=st[0],Bt=st[1],mn=st[2],xn=[],[4,Bt.array()];case 1:return Fn=rs.sent(),[4,It.array()];case 2:Rn=rs.sent(),Ln=0,rs.label=3;case 3:if(!(Ln<De))return[3,12];Zn=0,rs.label=4;case 4:if(!(Zn<De))return[3,11];An=0,rs.label=5;case 5:return An<tt?(Sr=hc(Fn[Ln][Zn][An][0]),!D||Sr>D?(Ur=(Zn+hc(Rn[Ln][Zn][An][0]))/De*_e,Wr=(Ln+hc(Rn[Ln][Zn][An][1]))/De*Re,ci=Math.exp(Rn[Ln][Zn][An][2])*this.config.anchors[An].x/De*_e,Jr=Math.exp(Rn[Ln][Zn][An][3])*this.config.anchors[An].y/De*Re,Xi=Ur-ci/2,lo=Wr-Jr/2,io={row:Ln,col:Zn,anchor:An},this.withClassScores?[4,this.extractPredictedClass(mn,io)]:[3,7]):[3,9]):[3,10];case 6:return Aa=rs.sent(),[3,8];case 7:Aa={classScore:1,label:0},rs.label=8;case 8:Ya=(ga=Aa).classScore,Ta=ga.label,xn.push(Object(er.a)({box:new js(Xi,lo,Xi+ci,lo+Jr),score:Sr,classScore:Sr*Ya,label:Ta},io)),rs.label=9;case 9:return An++,[3,5];case 10:return Zn++,[3,4];case 11:return Ln++,[3,3];case 12:return It.dispose(),Bt.dispose(),mn.dispose(),[2,xn]}})})},E.prototype.extractPredictedClass=function(_,k){return Object(er.b)(this,void 0,void 0,function(){var D,q,ee,de;return Object(er.d)(this,function(_e){switch(_e.label){case 0:return D=k.row,q=k.col,ee=k.anchor,[4,_.array()];case 1:return de=_e.sent(),[2,Array(this.config.classes.length).fill(0).map(function(Re,De){return de[D][q][ee][De]}).map(function(Re,De){return{classScore:Re,label:De}}).reduce(function(Re,De){return Re.classScore>De.classScore?Re:De})]}})})},E.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],E}(co),Dd=function(P){function E(_){_===void 0&&(_=!0);var k=Object.assign({},{withSeparableConvs:_,iouThreshold:bv,classes:["face"]},_?{anchors:Rg,meanRgb:Mg}:{anchors:ra,withClassScores:!0});return P.call(this,k)||this}return Object(er.c)(E,P),Object.defineProperty(E.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),E.prototype.locateFaces=function(_,k){return Object(er.b)(this,void 0,void 0,function(){return Object(er.d)(this,function(D){switch(D.label){case 0:return[4,this.detect(_,k)];case 1:return[2,D.sent().map(function(q){return new ts(q.score,q.relativeBox,{width:q.imageWidth,height:q.imageHeight})})]}})})},E.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},E.prototype.extractParamsFromWeigthMap=function(_){return P.prototype.extractParamsFromWeigthMap.call(this,_)},E}(Vl);function H0(P,E){E===void 0&&(E=!0);var _=new Dd(E);return _.extractWeights(P),_}var Wm=function(P){function E(){var _=P!==null&&P.apply(this,arguments)||this;return _._name="TinyFaceDetectorOptions",_}return Object(er.c)(E,P),E}(ch),Ff=function(){function P(){}return P.prototype.then=function(E){return Object(er.b)(this,void 0,void 0,function(){var _;return Object(er.d)(this,function(k){switch(k.label){case 0:return _=E,[4,this.run()];case 1:return[2,_.apply(void 0,[k.sent()])]}})})},P.prototype.run=function(){return Object(er.b)(this,void 0,void 0,function(){return Object(er.d)(this,function(E){throw new Error("ComposableTask - run is not implemented")})})},P}();function nc(P,E,_,k,D){return D===void 0&&(D=function(q){return q.alignedRect}),Object(er.b)(this,void 0,void 0,function(){var q,ee,de,_e,Re;return Object(er.d)(this,function(De){switch(De.label){case 0:return q=P.map(function(tt){return Ll(tt)?D(tt):tt.detection}),(de=k)?[3,5]:E instanceof ln.Tensor?[4,qo(E,q)]:[3,2];case 1:return _e=De.sent(),[3,4];case 2:return[4,Vo(E,q)];case 3:_e=De.sent(),De.label=4;case 4:de=_e,De.label=5;case 5:return[4,_(ee=de)];case 6:return Re=De.sent(),ee.forEach(function(tt){return tt instanceof ln.Tensor&&tt.dispose()}),[2,Re]}})})}function ql(P,E,_,k,D){return Object(er.b)(this,void 0,void 0,function(){var q=this;return Object(er.d)(this,function(ee){return[2,nc([P],E,function(de){return Object(er.b)(q,void 0,void 0,function(){return Object(er.d)(this,function(_e){return[2,_(de[0])]})})},k,D)]})})}var Hh=2,lh=12;function Bg(P){var E=Bs(P),_=E.extractWeights,k=E.getRemainingWeights,D=[],q=function(st,It){var Bt=ku(st,It),mn=Cs(st,It);function xn(Rn,Ln){var Zn=ln.tensor1d(st(Rn));return It.push({paramPath:Ln}),Zn}function Fn(Rn,Ln,Zn){return Zn===void 0&&(Zn=!1),{conv1:Bt(Rn[0],Rn[1],3,Ln+"/conv1"),prelu1_alpha:xn(Rn[1],Ln+"/prelu1_alpha"),conv2:Bt(Rn[1],Rn[2],3,Ln+"/conv2"),prelu2_alpha:xn(Rn[2],Ln+"/prelu2_alpha"),conv3:Bt(Rn[2],Rn[3],Zn?2:3,Ln+"/conv3"),prelu3_alpha:xn(Rn[3],Ln+"/prelu3_alpha")}}return{extractPNetParams:function(){var Rn=Fn([3,10,16,32],"pnet"),Ln=Bt(32,2,1,"pnet/conv4_1"),Zn=Bt(32,4,1,"pnet/conv4_2");return Object(er.a)(Object(er.a)({},Rn),{conv4_1:Ln,conv4_2:Zn})},extractRNetParams:function(){var Rn=Fn([3,28,48,64],"rnet",!0),Ln=mn(576,128,"rnet/fc1"),Zn=xn(128,"rnet/prelu4_alpha"),An=mn(128,2,"rnet/fc2_1"),Sr=mn(128,4,"rnet/fc2_2");return Object(er.a)(Object(er.a)({},Rn),{fc1:Ln,prelu4_alpha:Zn,fc2_1:An,fc2_2:Sr})},extractONetParams:function(){var Rn=Fn([3,32,64,64],"onet"),Ln=Bt(64,128,2,"onet/conv4"),Zn=xn(128,"onet/prelu4_alpha"),An=mn(1152,256,"onet/fc1"),Sr=xn(256,"onet/prelu5_alpha"),Ur=mn(256,2,"onet/fc2_1"),Wr=mn(256,4,"onet/fc2_2"),ci=mn(256,10,"onet/fc2_3");return Object(er.a)(Object(er.a)({},Rn),{conv4:Ln,prelu4_alpha:Zn,fc1:An,prelu5_alpha:Sr,fc2_1:Ur,fc2_2:Wr,fc2_3:ci})}}}(_,D),ee=q.extractPNetParams,de=q.extractRNetParams,_e=q.extractONetParams,Re=ee(),De=de(),tt=_e();if(k().length!==0)throw new Error("weights remaing after extract: "+k().length);return{params:{pnet:Re,rnet:De,onet:tt},paramMappings:D}}function Td(P){var E=[],_=function(Re,De){var tt=Js(Re,De);function st(xn){return{filters:tt(xn+"/weights",4,xn+"/filters"),bias:tt(xn+"/bias",1)}}function It(xn){return{weights:tt(xn+"/weights",2),bias:tt(xn+"/bias",1)}}function Bt(xn){return tt(xn,1)}function mn(xn){return{conv1:st(xn+"/conv1"),prelu1_alpha:Bt(xn+"/prelu1_alpha"),conv2:st(xn+"/conv2"),prelu2_alpha:Bt(xn+"/prelu2_alpha"),conv3:st(xn+"/conv3"),prelu3_alpha:Bt(xn+"/prelu3_alpha")}}return{extractPNetParams:function(){var xn=mn("pnet"),Fn=st("pnet/conv4_1"),Rn=st("pnet/conv4_2");return Object(er.a)(Object(er.a)({},xn),{conv4_1:Fn,conv4_2:Rn})},extractRNetParams:function(){var xn=mn("rnet"),Fn=It("rnet/fc1"),Rn=Bt("rnet/prelu4_alpha"),Ln=It("rnet/fc2_1"),Zn=It("rnet/fc2_2");return Object(er.a)(Object(er.a)({},xn),{fc1:Fn,prelu4_alpha:Rn,fc2_1:Ln,fc2_2:Zn})},extractONetParams:function(){var xn=mn("onet"),Fn=st("onet/conv4"),Rn=Bt("onet/prelu4_alpha"),Ln=It("onet/fc1"),Zn=Bt("onet/prelu5_alpha"),An=It("onet/fc2_1"),Sr=It("onet/fc2_2"),Ur=It("onet/fc2_3");return Object(er.a)(Object(er.a)({},xn),{conv4:Fn,prelu4_alpha:Rn,fc1:Ln,prelu5_alpha:Zn,fc2_1:An,fc2_2:Sr,fc2_3:Ur})}}}(P,E),k=_.extractPNetParams,D=_.extractRNetParams,q=_.extractONetParams,ee=k(),de=D(),_e=q();return Wa(P,E),{params:{pnet:ee,rnet:de,onet:_e},paramMappings:E}}function al(P,E){var _=E[0],k=E[1];return{height:Math.floor(_*P),width:Math.floor(k*P)}}var Lc=function(P){function E(_,k,D,q){return P.call(this,{left:_,top:k,right:D,bottom:q},!0)||this}return Object(er.c)(E,P),E}(uo);function Vm(P){return ln.tidy(function(){return ln.mul(ln.sub(P,ln.scalar(127.5)),ln.scalar(.0078125))})}function Gh(P,E){return ln.tidy(function(){return ln.add(ln.relu(P),ln.mul(E,ln.neg(ln.relu(ln.neg(P)))))})}function Pg(P,E,_){return _===void 0&&(_=!1),ln.tidy(function(){var k=Qo(P,E.conv1,"valid");return k=Gh(k,E.prelu1_alpha),k=Gh(k=Qo(k=ln.maxPool(k,_?[2,2]:[3,3],[2,2],"same"),E.conv2,"valid"),E.prelu2_alpha),k=Gh(k=Qo(k=_?k:ln.maxPool(k,[3,3],[2,2],"valid"),E.conv3,"valid"),E.prelu3_alpha)})}function G0(P,E,_,k,D){D.stage1=[];var q=E.map(function(De){return ln.tidy(function(){var tt={scale:De},st=function(Fn,Rn){return ln.tidy(function(){var Ln=al(Rn,Fn.shape.slice(1)),Zn=Ln.height,An=Ln.width,Sr=Vm(ln.image.resizeBilinear(Fn,[Zn,An]));return ln.transpose(Sr,[0,2,1,3])})}(P,De),It=Date.now(),Bt=function(Fn,Rn){return ln.tidy(function(){var Ln=Pg(Fn,Rn,!0),Zn=Qo(Ln,Rn.conv4_1,"valid"),An=ln.expandDims(ln.max(Zn,3),3);return{prob:ln.softmax(ln.sub(Zn,An),3),regions:Qo(Ln,Rn.conv4_2,"valid")}})}(st,k),mn=Bt.prob,xn=Bt.regions;return tt.pnet=Date.now()-It,{scoresTensor:ln.unstack(ln.unstack(mn,3)[1])[0],regionsTensor:ln.unstack(xn)[0],scale:De,statsForScale:tt}})}).map(function(De){var tt=De.scoresTensor,st=De.regionsTensor,It=De.scale,Bt=De.statsForScale,mn=function(Rn,Ln,Zn,An){for(var Sr=[],Ur=Rn.arraySync(),Wr=0;Wr<Rn.shape[0];Wr++)for(var ci=0;ci<Rn.shape[1];ci++)Ur[Wr][ci]>=An&&Sr.push(new po(ci,Wr));return Sr.map(function(Jr){var Xi=new js(Math.round((Jr.y*Hh+1)/Zn),Math.round((Jr.x*Hh+1)/Zn),Math.round((Jr.y*Hh+lh)/Zn),Math.round((Jr.x*Hh+lh)/Zn)),lo=Ur[Jr.y][Jr.x],io=Ln.arraySync();return{cell:Xi,score:lo,region:new Lc(io[Jr.y][Jr.x][0],io[Jr.y][Jr.x][1],io[Jr.y][Jr.x][2],io[Jr.y][Jr.x][3])}})}(tt,st,It,_);if(tt.dispose(),st.dispose(),!mn.length)return D.stage1.push(Bt),[];var xn=Date.now(),Fn=Pl(mn.map(function(Rn){return Rn.cell}),mn.map(function(Rn){return Rn.score}),.5);return Bt.nms=Date.now()-xn,Bt.numBoxes=Fn.length,D.stage1.push(Bt),Fn.map(function(Rn){return mn[Rn]})}).reduce(function(De,tt){return De.concat(tt)},[]),ee=[],de=[];if(q.length>0){var _e=Date.now(),Re=Pl(q.map(function(De){return De.cell}),q.map(function(De){return De.score}),.7);D.stage1_nms=Date.now()-_e,de=Re.map(function(De){return q[De].score}),ee=Re.map(function(De){return q[De]}).map(function(De){var tt=De.cell,st=De.region;return new js(tt.left+st.left*tt.width,tt.top+st.top*tt.height,tt.right+st.right*tt.width,tt.bottom+st.bottom*tt.height).toSquare().round()})}return{boxes:ee,scores:de}}function qm(P,E,_){var k=_.width,D=_.height;return Object(er.b)(this,void 0,void 0,function(){var q,ee,de,_e=this;return Object(er.d)(this,function(Re){switch(Re.label){case 0:return q=Nn(P),[4,Promise.all(E.map(function(De){return Object(er.b)(_e,void 0,void 0,function(){var tt,st,It,Bt,mn,xn,Fn,Rn;return Object(er.d)(this,function(Ln){return tt=De.padAtBorders(P.height,P.width),st=tt.y,It=tt.ey,Bt=tt.x,mn=tt.ex,xn=Bt-1,Fn=st-1,Rn=q.getImageData(xn,Fn,mn-xn,It-Fn),[2,Jt.isNodejs()?li(Rn):createImageBitmap(Rn)]})})}))];case 1:return ee=Re.sent(),de=[],ee.forEach(function(De){var tt=Nn(zr({width:k,height:D}));tt.drawImage(De,0,0,k,D);for(var st=tt.getImageData(0,0,k,D).data,It=[],Bt=0;Bt<st.length;Bt+=4)It.push(st[Bt+2]),It.push(st[Bt+1]),It.push(st[Bt]);de.push(It)}),[2,de.map(function(De){return ln.tidy(function(){return Vm(ln.transpose(ln.tensor4d(De,[1,k,D,3]),[0,2,1,3]).toFloat())})})]}})})}function fh(P,E,_,k,D){return Object(er.b)(this,void 0,void 0,function(){var q,ee,de,_e,Re,De,tt,st,It,Bt,mn,xn,Fn,Rn;return Object(er.d)(this,function(Ln){switch(Ln.label){case 0:return q=Date.now(),[4,qm(P,E,{width:24,height:24})];case 1:return ee=Ln.sent(),D.stage2_extractImagePatches=Date.now()-q,q=Date.now(),de=ee.map(function(Zn){var An=function(Sr,Ur){return ln.tidy(function(){var Wr=Pg(Sr,Ur),ci=Gh(ns(ln.reshape(Wr,[Wr.shape[0],Ur.fc1.weights.shape[0]]),Ur.fc1),Ur.prelu4_alpha),Jr=ns(ci,Ur.fc2_1),Xi=ln.expandDims(ln.max(Jr,1),1),lo=ln.softmax(ln.sub(Jr,Xi),1),io=ns(ci,Ur.fc2_2);return{scores:ln.unstack(lo,1)[1],regions:io}})}(Zn,k);return Zn.dispose(),An}),D.stage2_rnet=Date.now()-q,_e=de.length>1?ln.concat(de.map(function(Zn){return Zn.scores})):de[0].scores,tt=(De=Array).from,[4,_e.data()];case 2:return Re=tt.apply(De,[Ln.sent()]),_e.dispose(),st=Re.map(function(Zn,An){return{score:Zn,idx:An}}).filter(function(Zn){return Zn.score>_}).map(function(Zn){return Zn.idx}),It=st.map(function(Zn){return E[Zn]}),Bt=st.map(function(Zn){return Re[Zn]}),mn=[],xn=[],It.length>0&&(q=Date.now(),Fn=Pl(It,Bt,.7),D.stage2_nms=Date.now()-q,Rn=Fn.map(function(Zn){var An=de[st[Zn]].regions.arraySync();return new Lc(An[0][0],An[0][1],An[0][2],An[0][3])}),xn=Fn.map(function(Zn){return Bt[Zn]}),mn=Fn.map(function(Zn,An){return It[Zn].calibrate(Rn[An])})),de.forEach(function(Zn){Zn.regions.dispose(),Zn.scores.dispose()}),[2,{boxes:mn,scores:xn}]}})})}function $h(P,E,_,k,D){return Object(er.b)(this,void 0,void 0,function(){var q,ee,de,_e,Re,De,tt,st,It,Bt,mn,xn,Fn,Rn,Ln;return Object(er.d)(this,function(Zn){switch(Zn.label){case 0:return q=Date.now(),[4,qm(P,E,{width:48,height:48})];case 1:return ee=Zn.sent(),D.stage3_extractImagePatches=Date.now()-q,q=Date.now(),de=ee.map(function(An){var Sr=function(Ur,Wr){return ln.tidy(function(){var ci=Pg(Ur,Wr);ci=Gh(ci=Qo(ci=ln.maxPool(ci,[2,2],[2,2],"same"),Wr.conv4,"valid"),Wr.prelu4_alpha);var Jr=Gh(ns(ln.reshape(ci,[ci.shape[0],Wr.fc1.weights.shape[0]]),Wr.fc1),Wr.prelu5_alpha),Xi=ns(Jr,Wr.fc2_1),lo=ln.expandDims(ln.max(Xi,1),1),io=ln.softmax(ln.sub(Xi,lo),1),ga=ns(Jr,Wr.fc2_2),Ya=ns(Jr,Wr.fc2_3);return{scores:ln.unstack(io,1)[1],regions:ga,points:Ya}})}(An,k);return An.dispose(),Sr}),D.stage3_onet=Date.now()-q,_e=de.length>1?ln.concat(de.map(function(An){return An.scores})):de[0].scores,tt=(De=Array).from,[4,_e.data()];case 2:return Re=tt.apply(De,[Zn.sent()]),_e.dispose(),st=Re.map(function(An,Sr){return{score:An,idx:Sr}}).filter(function(An){return An.score>_}).map(function(An){return An.idx}),It=st.map(function(An){var Sr=de[An].regions.arraySync();return new Lc(Sr[0][0],Sr[0][1],Sr[0][2],Sr[0][3])}),Bt=st.map(function(An,Sr){return E[An].calibrate(It[Sr])}),mn=st.map(function(An){return Re[An]}),xn=[],Fn=[],Rn=[],Bt.length>0&&(q=Date.now(),Ln=Pl(Bt,mn,.7,!1),D.stage3_nms=Date.now()-q,xn=Ln.map(function(An){return Bt[An]}),Fn=Ln.map(function(An){return mn[An]}),Rn=Ln.map(function(An,Sr){return Array(5).fill(0).map(function(Ur,Wr){var ci=de[An].points.arraySync();return new po(ci[0][Wr]*(xn[Sr].width+1)+xn[Sr].left,ci[0][Wr+5]*(xn[Sr].height+1)+xn[Sr].top)})})),de.forEach(function(An){An.regions.dispose(),An.scores.dispose(),An.points.dispose()}),[2,{boxes:xn,scores:Fn,points:Rn}]}})})}var Nd=function(P){function E(){return P.call(this,"Mtcnn")||this}return Object(er.c)(E,P),E.prototype.load=function(_){return Object(er.b)(this,void 0,void 0,function(){return Object(er.d)(this,function(k){return console.warn("mtcnn is deprecated and will be removed soon"),[2,P.prototype.load.call(this,_)]})})},E.prototype.loadFromDisk=function(_){return Object(er.b)(this,void 0,void 0,function(){return Object(er.d)(this,function(k){return console.warn("mtcnn is deprecated and will be removed soon"),[2,P.prototype.loadFromDisk.call(this,_)]})})},E.prototype.forwardInput=function(_,k){return k===void 0&&(k={}),Object(er.b)(this,void 0,void 0,function(){var D,q,ee,de,_e,Re,De,tt,st,It,Bt,mn,xn,Fn,Rn,Ln,Zn,An,Sr,Ur,Wr;return Object(er.d)(this,function(ci){switch(ci.label){case 0:if(!(D=this.params))throw new Error("Mtcnn - load model before inference");if(!(q=_.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return ee={},de=Date.now(),_e=ln.tidy(function(){return function(Jr){return ln.tidy(function(){return ln.stack(ln.unstack(Jr,3).reverse(),3)})}(ln.expandDims(ln.browser.fromPixels(q)).toFloat())}),Re=function(Jr){return _e.dispose(),ee.total=Date.now()-de,Jr},De=_e.shape.slice(1),tt=De[0],st=De[1],It=new zl(k),Bt=It.minFaceSize,mn=It.scaleFactor,xn=It.maxNumScales,Fn=It.scoreThresholds,Rn=It.scaleSteps,Ln=(Rn||function(Jr,Xi,lo){for(var io=lo[0],ga=lo[1],Ya=lh/Jr,Ta=[],Aa=Math.min(io,ga)*Ya,Ma=0;Aa>=12;)Ta.push(Ya*Math.pow(Xi,Ma)),Aa*=Xi,Ma+=1;return Ta}(Bt,mn,[tt,st])).filter(function(Jr){var Xi=al(Jr,[tt,st]);return Math.min(Xi.width,Xi.height)>lh}).slice(0,xn),ee.scales=Ln,ee.pyramid=Ln.map(function(Jr){return al(Jr,[tt,st])}),Zn=Date.now(),[4,G0(_e,Ln,Fn[0],D.pnet,ee)];case 1:return An=ci.sent(),ee.total_stage1=Date.now()-Zn,An.boxes.length?(ee.stage2_numInputBoxes=An.boxes.length,Zn=Date.now(),[4,fh(q,An.boxes,Fn[1],D.rnet,ee)]):[2,Re({results:[],stats:ee})];case 2:return Sr=ci.sent(),ee.total_stage2=Date.now()-Zn,Sr.boxes.length?(ee.stage3_numInputBoxes=Sr.boxes.length,Zn=Date.now(),[4,$h(q,Sr.boxes,Fn[2],D.onet,ee)]):[2,Re({results:[],stats:ee})];case 3:return Ur=ci.sent(),ee.total_stage3=Date.now()-Zn,Wr=Ur.boxes.map(function(Jr,Xi){return Va(Cd({},new ts(Ur.scores[Xi],new oh(Jr.left/st,Jr.top/tt,Jr.width/st,Jr.height/tt),{height:tt,width:st})),new wl(Ur.points[Xi].map(function(lo){return lo.sub(new po(Jr.left,Jr.top)).div(new po(Jr.width,Jr.height))}),{width:Jr.width,height:Jr.height}))}),[2,Re({results:Wr,stats:ee})]}})})},E.prototype.forward=function(_,k){return k===void 0&&(k={}),Object(er.b)(this,void 0,void 0,function(){var D;return Object(er.d)(this,function(q){switch(q.label){case 0:return D=this.forwardInput,[4,Oi(_)];case 1:return[4,D.apply(this,[q.sent(),k])];case 2:return[2,q.sent().results]}})})},E.prototype.forwardWithStats=function(_,k){return k===void 0&&(k={}),Object(er.b)(this,void 0,void 0,function(){var D;return Object(er.d)(this,function(q){switch(q.label){case 0:return D=this.forwardInput,[4,Oi(_)];case 1:return[2,D.apply(this,[q.sent(),k])]}})})},E.prototype.getDefaultModelName=function(){return"mtcnn_model"},E.prototype.extractParamsFromWeigthMap=function(_){return Td(_)},E.prototype.extractParams=function(_){return Bg(_)},E}(co),Kh=.4,Rf=[new po(1.603231,2.094468),new po(6.041143,7.080126),new po(2.882459,3.518061),new po(4.266906,5.178857),new po(9.041765,10.66308)],Hm=[117.001,114.697,97.404],Xh=function(P){function E(){var _={withSeparableConvs:!0,iouThreshold:Kh,classes:["face"],anchors:Rf,meanRgb:Hm,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return P.call(this,_)||this}return Object(er.c)(E,P),Object.defineProperty(E.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),E.prototype.locateFaces=function(_,k){return Object(er.b)(this,void 0,void 0,function(){return Object(er.d)(this,function(D){switch(D.label){case 0:return[4,this.detect(_,k)];case 1:return[2,D.sent().map(function(q){return new ts(q.score,q.relativeBox,{width:q.imageWidth,height:q.imageHeight})})]}})})},E.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},E.prototype.extractParamsFromWeigthMap=function(_){return P.prototype.extractParamsFromWeigthMap.call(this,_)},E}(Vl),Ko={ssdMobilenetv1:new Wl,tinyFaceDetector:new Xh,tinyYolov2:new Dd,mtcnn:new Nd,faceLandmark68Net:new Kp,faceLandmark68TinyNet:new Xp,faceRecognitionNet:new Jp,faceExpressionNet:new Zo,ageGenderNet:new Bm},hh=function(P,E){return Ko.ssdMobilenetv1.locateFaces(P,E)},up=function(P,E){return Ko.tinyFaceDetector.locateFaces(P,E)},$0=function(P,E){return Ko.tinyYolov2.locateFaces(P,E)},dh=function(P,E){return Ko.mtcnn.forward(P,E)},cp=function(P){return Ko.faceLandmark68Net.detectLandmarks(P)},Mf=function(P){return Ko.faceLandmark68TinyNet.detectLandmarks(P)},hf=function(P){return Ko.faceRecognitionNet.computeFaceDescriptor(P)},Yh=function(P){return Ko.faceExpressionNet.predictExpressions(P)},df=function(P){return Ko.ageGenderNet.predictAgeAndGender(P)},to=function(P){return Ko.ssdMobilenetv1.load(P)},pf=function(P){return Ko.tinyFaceDetector.load(P)},jf=function(P){return Ko.mtcnn.load(P)},zu=function(P){return Ko.tinyYolov2.load(P)},lp=function(P){return Ko.faceLandmark68Net.load(P)},ph=function(P){return Ko.faceLandmark68TinyNet.load(P)},Bf=function(P){return Ko.faceRecognitionNet.load(P)},Ts=function(P){return Ko.faceExpressionNet.load(P)},Id=function(P){return Ko.ageGenderNet.load(P)},Gm=to,Jh=hh,Pf=cp,du=function(P){function E(_,k,D){var q=P.call(this)||this;return q.parentTask=_,q.input=k,q.extractedFaces=D,q}return Object(er.c)(E,P),E}(Ff),mf=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Object(er.c)(E,P),E.prototype.run=function(){return Object(er.b)(this,void 0,void 0,function(){var _,k,D=this;return Object(er.d)(this,function(q){switch(q.label){case 0:return[4,this.parentTask];case 1:return[4,nc(_=q.sent(),this.input,function(ee){return Object(er.b)(D,void 0,void 0,function(){return Object(er.d)(this,function(de){switch(de.label){case 0:return[4,Promise.all(ee.map(function(_e){return Ko.faceExpressionNet.predictExpressions(_e)}))];case 1:return[2,de.sent()]}})})},this.extractedFaces)];case 2:return k=q.sent(),[2,_.map(function(ee,de){return Qs(ee,k[de])})]}})})},E.prototype.withAgeAndGender=function(){return new tm(this,this.input)},E}(du),El=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Object(er.c)(E,P),E.prototype.run=function(){return Object(er.b)(this,void 0,void 0,function(){var _,k;return Object(er.d)(this,function(D){switch(D.label){case 0:return[4,this.parentTask];case 1:return(_=D.sent())?[4,ql(_,this.input,function(q){return Ko.faceExpressionNet.predictExpressions(q)},this.extractedFaces)]:[2];case 2:return k=D.sent(),[2,Qs(_,k)]}})})},E.prototype.withAgeAndGender=function(){return new Lg(this,this.input)},E}(du),sl=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Object(er.c)(E,P),E.prototype.withAgeAndGender=function(){return new Fd(this,this.input)},E.prototype.withFaceDescriptors=function(){return new zc(this,this.input)},E}(mf),ul=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Object(er.c)(E,P),E.prototype.withAgeAndGender=function(){return new Ra(this,this.input)},E.prototype.withFaceDescriptor=function(){return new Qh(this,this.input)},E}(El),rc=function(P){function E(_,k,D){var q=P.call(this)||this;return q.parentTask=_,q.input=k,q.extractedFaces=D,q}return Object(er.c)(E,P),E}(Ff),tm=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Object(er.c)(E,P),E.prototype.run=function(){return Object(er.b)(this,void 0,void 0,function(){var _,k,D=this;return Object(er.d)(this,function(q){switch(q.label){case 0:return[4,this.parentTask];case 1:return[4,nc(_=q.sent(),this.input,function(ee){return Object(er.b)(D,void 0,void 0,function(){return Object(er.d)(this,function(de){switch(de.label){case 0:return[4,Promise.all(ee.map(function(_e){return Ko.ageGenderNet.predictAgeAndGender(_e)}))];case 1:return[2,de.sent()]}})})},this.extractedFaces)];case 2:return k=q.sent(),[2,_.map(function(ee,de){var _e=k[de],Re=_e.age;return Lm(il(ee,_e.gender,_e.genderProbability),Re)})]}})})},E.prototype.withFaceExpressions=function(){return new mf(this,this.input)},E}(rc),Lg=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Object(er.c)(E,P),E.prototype.run=function(){return Object(er.b)(this,void 0,void 0,function(){var _,k,D,q,ee;return Object(er.d)(this,function(de){switch(de.label){case 0:return[4,this.parentTask];case 1:return(_=de.sent())?[4,ql(_,this.input,function(_e){return Ko.ageGenderNet.predictAgeAndGender(_e)},this.extractedFaces)]:[2];case 2:return k=de.sent(),D=k.age,q=k.gender,ee=k.genderProbability,[2,Lm(il(_,q,ee),D)]}})})},E.prototype.withFaceExpressions=function(){return new El(this,this.input)},E}(rc),Fd=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Object(er.c)(E,P),E.prototype.withFaceExpressions=function(){return new sl(this,this.input)},E.prototype.withFaceDescriptors=function(){return new zc(this,this.input)},E}(tm),Ra=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Object(er.c)(E,P),E.prototype.withFaceExpressions=function(){return new ul(this,this.input)},E.prototype.withFaceDescriptor=function(){return new Qh(this,this.input)},E}(Lg),nm=function(P){function E(_,k){var D=P.call(this)||this;return D.parentTask=_,D.input=k,D}return Object(er.c)(E,P),E}(Ff),zc=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Object(er.c)(E,P),E.prototype.run=function(){return Object(er.b)(this,void 0,void 0,function(){var _;return Object(er.d)(this,function(k){switch(k.label){case 0:return[4,this.parentTask];case 1:return[4,nc(_=k.sent(),this.input,function(D){return Promise.all(D.map(function(q){return Ko.faceRecognitionNet.computeFaceDescriptor(q)}))},null,function(D){return D.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,k.sent().map(function(D,q){return Qp(_[q],D)})]}})})},E.prototype.withFaceExpressions=function(){return new sl(this,this.input)},E.prototype.withAgeAndGender=function(){return new Fd(this,this.input)},E}(nm),Qh=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Object(er.c)(E,P),E.prototype.run=function(){return Object(er.b)(this,void 0,void 0,function(){var _,k;return Object(er.d)(this,function(D){switch(D.label){case 0:return[4,this.parentTask];case 1:return(_=D.sent())?[4,ql(_,this.input,function(q){return Ko.faceRecognitionNet.computeFaceDescriptor(q)},null,function(q){return q.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return k=D.sent(),[2,Qp(_,k)]}})})},E.prototype.withFaceExpressions=function(){return new ul(this,this.input)},E.prototype.withAgeAndGender=function(){return new Ra(this,this.input)},E}(nm),Zh=function(P){function E(_,k,D){var q=P.call(this)||this;return q.parentTask=_,q.input=k,q.useTinyLandmarkNet=D,q}return Object(er.c)(E,P),Object.defineProperty(E.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Ko.faceLandmark68TinyNet:Ko.faceLandmark68Net},enumerable:!0,configurable:!0}),E}(Ff),rm=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Object(er.c)(E,P),E.prototype.run=function(){return Object(er.b)(this,void 0,void 0,function(){var _,k,D,q,ee,de=this;return Object(er.d)(this,function(_e){switch(_e.label){case 0:return[4,this.parentTask];case 1:return _=_e.sent(),k=_.map(function(Re){return Re.detection}),this.input instanceof ln.Tensor?[4,qo(this.input,k)]:[3,3];case 2:return q=_e.sent(),[3,5];case 3:return[4,Vo(this.input,k)];case 4:q=_e.sent(),_e.label=5;case 5:return D=q,[4,Promise.all(D.map(function(Re){return de.landmarkNet.detectLandmarks(Re)}))];case 6:return ee=_e.sent(),D.forEach(function(Re){return Re instanceof ln.Tensor&&Re.dispose()}),[2,_.map(function(Re,De){return Va(Re,ee[De])})]}})})},E.prototype.withFaceExpressions=function(){return new sl(this,this.input)},E.prototype.withAgeAndGender=function(){return new Fd(this,this.input)},E.prototype.withFaceDescriptors=function(){return new zc(this,this.input)},E}(Zh),$m=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Object(er.c)(E,P),E.prototype.run=function(){return Object(er.b)(this,void 0,void 0,function(){var _,k,D,q,ee;return Object(er.d)(this,function(de){switch(de.label){case 0:return[4,this.parentTask];case 1:return(_=de.sent())?(k=_.detection,this.input instanceof ln.Tensor?[4,qo(this.input,[k])]:[3,3]):[2];case 2:return q=de.sent(),[3,5];case 3:return[4,Vo(this.input,[k])];case 4:q=de.sent(),de.label=5;case 5:return D=q,[4,this.landmarkNet.detectLandmarks(D[0])];case 6:return ee=de.sent(),D.forEach(function(_e){return _e instanceof ln.Tensor&&_e.dispose()}),[2,Va(_,ee)]}})})},E.prototype.withFaceExpressions=function(){return new ul(this,this.input)},E.prototype.withAgeAndGender=function(){return new Ra(this,this.input)},E.prototype.withFaceDescriptor=function(){return new Qh(this,this.input)},E}(Zh),Km=function(P){function E(_,k){k===void 0&&(k=new If);var D=P.call(this)||this;return D.input=_,D.options=k,D}return Object(er.c)(E,P),E}(Ff),Xm=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Object(er.c)(E,P),E.prototype.run=function(){return Object(er.b)(this,void 0,void 0,function(){var _,k,D,q;return Object(er.d)(this,function(ee){switch(ee.label){case 0:return k=(_=this).input,(D=_.options)instanceof zl?[4,Ko.mtcnn.forward(k,D)]:[3,2];case 1:return[2,ee.sent().map(function(de){return de.detection})];case 2:if(!(q=D instanceof Wm?function(de){return Ko.tinyFaceDetector.locateFaces(de,D)}:D instanceof If?function(de){return Ko.ssdMobilenetv1.locateFaces(de,D)}:D instanceof ch?function(de){return Ko.tinyYolov2.locateFaces(de,D)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,q(k)]}})})},E.prototype.runAndExtendWithFaceDetections=function(){var _=this;return new Promise(function(k){return Object(er.b)(_,void 0,void 0,function(){var D;return Object(er.d)(this,function(q){switch(q.label){case 0:return[4,this.run()];case 1:return D=q.sent(),[2,k(D.map(function(ee){return Cd({},ee)}))]}})})})},E.prototype.withFaceLandmarks=function(_){return _===void 0&&(_=!1),new rm(this.runAndExtendWithFaceDetections(),this.input,_)},E.prototype.withFaceExpressions=function(){return new mf(this.runAndExtendWithFaceDetections(),this.input)},E.prototype.withAgeAndGender=function(){return new tm(this.runAndExtendWithFaceDetections(),this.input)},E}(Km),zg=function(P){function E(){return P!==null&&P.apply(this,arguments)||this}return Object(er.c)(E,P),E.prototype.run=function(){return Object(er.b)(this,void 0,void 0,function(){var _,k;return Object(er.d)(this,function(D){switch(D.label){case 0:return[4,new Xm(this.input,this.options)];case 1:return _=D.sent(),k=_[0],_.forEach(function(q){q.score>k.score&&(k=q)}),[2,k]}})})},E.prototype.runAndExtendWithFaceDetection=function(){var _=this;return new Promise(function(k){return Object(er.b)(_,void 0,void 0,function(){var D;return Object(er.d)(this,function(q){switch(q.label){case 0:return[4,this.run()];case 1:return D=q.sent(),[2,k(D?Cd({},D):void 0)]}})})})},E.prototype.withFaceLandmarks=function(_){return _===void 0&&(_=!1),new $m(this.runAndExtendWithFaceDetection(),this.input,_)},E.prototype.withFaceExpressions=function(){return new El(this.runAndExtendWithFaceDetection(),this.input)},E.prototype.withAgeAndGender=function(){return new Lg(this.runAndExtendWithFaceDetection(),this.input)},E}(Km);function im(P,E){return E===void 0&&(E=new If),new zg(P,E)}function ed(P,E){return E===void 0&&(E=new If),new Xm(P,E)}function fp(P,E){return Object(er.b)(this,void 0,void 0,function(){return Object(er.d)(this,function(_){switch(_.label){case 0:return console.warn("allFacesSsdMobilenetv1 is deprecated and will be removed soon, use the high level api instead"),[4,ed(P,new If(E?{minConfidence:E}:{})).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,_.sent()]}})})}function Rd(P,E){return E===void 0&&(E={}),Object(er.b)(this,void 0,void 0,function(){return Object(er.d)(this,function(_){switch(_.label){case 0:return console.warn("allFacesTinyYolov2 is deprecated and will be removed soon, use the high level api instead"),[4,ed(P,new ch(E)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,_.sent()]}})})}function td(P,E){return E===void 0&&(E={}),Object(er.b)(this,void 0,void 0,function(){return Object(er.d)(this,function(_){switch(_.label){case 0:return console.warn("allFacesMtcnn is deprecated and will be removed soon, use the high level api instead"),[4,ed(P,new zl(E)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,_.sent()]}})})}var om=fp;function Ym(P,E){if(P.length!==E.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var _=Array.from(P),k=Array.from(E);return Math.sqrt(_.map(function(D,q){return D-k[q]}).reduce(function(D,q){return D+Math.pow(q,2)},0))}var hp=function(){function P(E,_){_===void 0&&(_=.6),this._distanceThreshold=_;var k=Array.isArray(E)?E:[E];if(!k.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var D=1,q=function(){return"person "+D++};this._labeledDescriptors=k.map(function(ee){if(ee instanceof _d)return ee;if(ee instanceof Float32Array)return new _d(q(),[ee]);if(ee.descriptor&&ee.descriptor instanceof Float32Array)return new _d(q(),[ee.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(P.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),P.prototype.computeMeanDistance=function(E,_){return _.map(function(k){return Ym(k,E)}).reduce(function(k,D){return k+D},0)/(_.length||1)},P.prototype.matchDescriptor=function(E){var _=this;return this.labeledDescriptors.map(function(k){var D=k.descriptors,q=k.label;return new Ys(q,_.computeMeanDistance(E,D))}).reduce(function(k,D){return k.distance<D.distance?k:D})},P.prototype.findBestMatch=function(E){var _=this.matchDescriptor(E);return _.distance<this.distanceThreshold?_:new Ys("unknown",_.distance)},P.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(E){return E.toJSON()})}},P.fromJSON=function(E){return new P(E.labeledDescriptors.map(function(_){return _d.fromJSON(_)}),E.distanceThreshold)},P}();function dp(P){var E=new Nd;return E.extractWeights(P),E}function am(P){var E=new Xh;return E.extractWeights(P),E}function gf(P,E){var _=new ru(E.width,E.height),k=_.width,D=_.height;if(k<=0||D<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:k,height:D}));if(Array.isArray(P))return P.map(function(de){return gf(de,{width:k,height:D})});if(Ll(P)){var q=P.detection.forSize(k,D),ee=P.unshiftedLandmarks.forSize(q.box.width,q.box.height);return Va(Cd(P,q),ee)}return qh(P)?Cd(P,P.detection.forSize(k,D)):P instanceof Sc||P instanceof ts?P.forSize(k,D):P}var Uc={withLandmarks:!0,withDescriptors:!0,minConfidence:.5,withTinyNet:!0,MODEL_URLS:{Mobilenetv1Model:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/ssd_mobilenetv1_model-weights_manifest.json",TinyFaceDetectorModel:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/tiny_face_detector_model-weights_manifest.json",FaceLandmarkModel:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_landmark_68_model-weights_manifest.json",FaceLandmark68TinyNet:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_landmark_68_tiny_model-weights_manifest.json",FaceRecognitionModel:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_recognition_model-weights_manifest.json"}},K0=function(){function P(E,_,k){pe()(this,P),this.video=E,this.model=null,this.modelReady=!1,this.detectorOptions=null,this.config={minConfidence:this.checkUndefined(_.minConfidence,Uc.minConfidence),withLandmarks:this.checkUndefined(_.withLandmarks,Uc.withLandmarks),withDescriptors:this.checkUndefined(_.withDescriptors,Uc.withDescriptors),withTinyNet:this.checkUndefined(_.withTinyNet,Uc.withTinyNet),MODEL_URLS:{Mobilenetv1Model:this.checkUndefined(_.Mobilenetv1Model,Uc.MODEL_URLS.Mobilenetv1Model),TinyFaceDetectorModel:this.checkUndefined(_.TinyFaceDetectorModel,Uc.MODEL_URLS.TinyFaceDetectorModel),FaceLandmarkModel:this.checkUndefined(_.FaceLandmarkModel,Uc.MODEL_URLS.FaceLandmarkModel),FaceLandmark68TinyNet:this.checkUndefined(_.FaceLandmark68TinyNet,Uc.MODEL_URLS.FaceLandmark68TinyNet),FaceRecognitionModel:this.checkUndefined(_.FaceRecognitionModel,Uc.MODEL_URLS.FaceRecognitionModel)}},this.ready=ft(this.loadModel(),k)}return Fe()(P,[{key:"loadModel",value:function(){var E=J()(Ae.a.mark(function _(){var k,D,q,ee,de,_e,Re,De=this;return Ae.a.wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:if(k=["Mobilenetv1Model","TinyFaceDetectorModel","FaceLandmarkModel","FaceLandmark68TinyNet","FaceRecognitionModel"],Object.keys(this.config.MODEL_URLS).forEach(function(st){k.includes(st)&&(De.config.MODEL_URLS[st]=Gs.getModelPath(De.config.MODEL_URLS[st]))}),D=this.config.MODEL_URLS,q=D.Mobilenetv1Model,ee=D.TinyFaceDetectorModel,de=D.FaceLandmarkModel,_e=D.FaceRecognitionModel,Re=D.FaceLandmark68TinyNet,this.model=V,this.config.withTinyNet===!0?this.detectorOptions=new Wm({minConfidence:this.minConfidence,inputSize:512}):this.detectorOptions=new If({minConfidence:this.minConfidence}),this.config.withTinyNet!==!0){tt.next=12;break}return tt.next=8,this.model.loadFaceLandmarkTinyModel(Re);case 8:return tt.next=10,this.model.loadTinyFaceDetectorModel(ee);case 10:tt.next=16;break;case 12:return tt.next=14,this.model.loadFaceLandmarkModel(de);case 14:return tt.next=16,this.model.loadSsdMobilenetv1Model(q);case 16:return tt.next=18,this.model.loadFaceRecognitionModel(_e);case 18:return this.modelReady=!0,tt.abrupt("return",this);case 20:case"end":return tt.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()},{key:"detect",value:function(){var E=J()(Ae.a.mark(function _(k,D,q){var ee,de,_e;return Ae.a.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:if(ee=this.video,_e=this.config,typeof k!="function"){Re.next=7;break}ee=this.video,de=k,Re.next=21;break;case 7:if(!(k instanceof HTMLImageElement||k instanceof HTMLCanvasElement||k instanceof HTMLVideoElement||k instanceof ImageData)){Re.next=11;break}ee=k,Re.next=21;break;case 11:if(Ce()(k)!=="object"||!(k.elt instanceof HTMLImageElement||k.elt instanceof HTMLCanvasElement||k.elt instanceof HTMLVideoElement||k.elt instanceof ImageData)){Re.next=15;break}ee=k.elt,Re.next=21;break;case 15:if(!(Ce()(k)==="object"&&k.canvas instanceof HTMLCanvasElement)){Re.next=19;break}ee=k.canvas,Re.next=21;break;case 19:if(this.video instanceof HTMLVideoElement){Re.next=21;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 21:return Ce()(D)==="object"?_e=D:typeof D=="function"&&(de=D),typeof q=="function"&&(de=q),Re.abrupt("return",ft(this.detectInternal(ee,_e),de));case 24:case"end":return Re.stop()}},_,this)}));return function(_,k,D){return E.apply(this,arguments)}}()},{key:"detectInternal",value:function(){var E=J()(Ae.a.mark(function _(k,D){var q,ee,de,_e,Re=this;return Ae.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return De.next=2,this.ready;case 2:return De.next=4,F.nextFrame();case 4:if(!this.video||this.video.readyState!==0){De.next=7;break}return De.next=7,new Promise(function(tt){Re.video.onloadeddata=function(){return tt()}});case 7:if(this.config=this.setReturnOptions(D),q=this.config,ee=q.withLandmarks,de=q.withDescriptors,!ee){De.next=21;break}if(!de){De.next=16;break}return De.next=13,this.model.detectAllFaces(k,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptors();case 13:_e=De.sent,De.next=19;break;case 16:return De.next=18,this.model.detectAllFaces(k,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet);case 18:_e=De.sent;case 19:De.next=30;break;case 21:if(ee){De.next=27;break}return De.next=24,this.model.detectAllFaces(k);case 24:_e=De.sent,De.next=30;break;case 27:return De.next=29,this.model.detectAllFaces(k,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptors();case 29:_e=De.sent;case 30:return _e=this.resizeResults(_e,k.width,k.height),_e=this.landmarkParts(_e),De.abrupt("return",_e);case 33:case"end":return De.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"detectSingle",value:function(){var E=J()(Ae.a.mark(function _(k,D,q){var ee,de,_e;return Ae.a.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:if(ee=this.video,_e=this.config,typeof k!="function"){Re.next=7;break}ee=this.video,de=k,Re.next=21;break;case 7:if(!(k instanceof HTMLImageElement||k instanceof HTMLCanvasElement||k instanceof HTMLVideoElement||k instanceof ImageData)){Re.next=11;break}ee=k,Re.next=21;break;case 11:if(Ce()(k)!=="object"||!(k.elt instanceof HTMLImageElement||k.elt instanceof HTMLCanvasElement||k.elt instanceof HTMLVideoElement||k.elt instanceof ImageData)){Re.next=15;break}ee=k.elt,Re.next=21;break;case 15:if(!(Ce()(k)==="object"&&k.canvas instanceof HTMLCanvasElement)){Re.next=19;break}ee=k.canvas,Re.next=21;break;case 19:if(this.video instanceof HTMLVideoElement){Re.next=21;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 21:return Ce()(D)==="object"?_e=D:typeof D=="function"&&(de=D),typeof q=="function"&&(de=q),Re.abrupt("return",ft(this.detectSingleInternal(ee,_e),de));case 24:case"end":return Re.stop()}},_,this)}));return function(_,k,D){return E.apply(this,arguments)}}()},{key:"detectSingleInternal",value:function(){var E=J()(Ae.a.mark(function _(k,D){var q,ee,de,_e,Re=this;return Ae.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return De.next=2,this.ready;case 2:return De.next=4,F.nextFrame();case 4:if(!this.video||this.video.readyState!==0){De.next=7;break}return De.next=7,new Promise(function(tt){Re.video.onloadeddata=function(){return tt()}});case 7:if(this.config=this.setReturnOptions(D),q=this.config,ee=q.withLandmarks,de=q.withDescriptors,!ee){De.next=21;break}if(!de){De.next=16;break}return De.next=13,this.model.detectSingleFace(k,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptor();case 13:_e=De.sent,De.next=19;break;case 16:return De.next=18,this.model.detectSingleFace(k,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet);case 18:_e=De.sent;case 19:De.next=30;break;case 21:if(ee){De.next=27;break}return De.next=24,this.model.detectSingleFace(k);case 24:_e=De.sent,De.next=30;break;case 27:return De.next=29,this.model.detectSingleFace(k,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptor();case 29:_e=De.sent;case 30:return _e=this.resizeResults(_e,k.width,k.height),_e=this.landmarkParts(_e),De.abrupt("return",_e);case 33:case"end":return De.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"checkUndefined",value:function(E,_){return E!==void 0?E:_}},{key:"setReturnOptions",value:function(E){var _=this,k=Object.assign({},this.config);return["withLandmarks","withDescriptors"].forEach(function(D){E[D]!==void 0?_.config[D]=E[D]:k[D]=_.config[D]}),k}},{key:"resizeResults",value:function(E,_,k){if(_===void 0||k===void 0)throw new Error("width and height must be defined");return this.model.resizeResults(E,{width:_,height:k})}},{key:"landmarkParts",value:function(E){var _;if(Array.isArray(E)===!0)_=E.map(function(D){var q=Object.assign({},D);if(q.landmarks){var ee=q.landmarks;q.parts={mouth:ee.getMouth(),nose:ee.getNose(),leftEye:ee.getLeftEye(),leftEyeBrow:ee.getLeftEyeBrow(),rightEye:ee.getRightEye(),rightEyeBrow:ee.getRightEyeBrow(),jawOutline:ee.getJawOutline()}}else q.parts={mouth:[],nose:[],leftEye:[],leftEyeBrow:[],rightEye:[],rightEyeBrow:[],jawOutline:[]};return q});else if((_=Object.assign({},E)).landmarks){var k=E.landmarks;_.parts={mouth:k.getMouth(),nose:k.getNose(),leftEye:k.getLeftEye(),leftEyeBrow:k.getLeftEyeBrow(),rightEye:k.getRightEye(),rightEyeBrow:k.getRightEyeBrow()}}else _.parts={mouth:[],nose:[],leftEye:[],leftEyeBrow:[],rightEye:[],rightEyeBrow:[]};return _}}]),P}(),Ug=function(P,E,_){var k,D={},q=_;P instanceof HTMLVideoElement?k=P:Ce()(P)==="object"&&P.elt instanceof HTMLVideoElement?k=P.elt:Ce()(P)==="object"?D=P:typeof P=="function"&&(q=P),Ce()(E)==="object"?(D=E,console.log(D)):typeof E=="function"&&(q=E);var ee=new K0(k,D,q);return q?ee:ee.ready},sm={k:3,maxIter:5,threshold:.5};function d0(P){return nd.apply(this,arguments)}function nd(){return(nd=J()(Ae.a.mark(function P(E){var _,k;return Ae.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return _=F.data.csv(E),D.next=3,_.toArray();case 3:return k=D.sent,D.abrupt("return",k);case 5:case"end":return D.stop()}},P)}))).apply(this,arguments)}function p0(P){return um.apply(this,arguments)}function um(){return(um=J()(Ae.a.mark(function P(E){var _,k;return Ae.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(typeof E!="string"){D.next=6;break}return D.next=3,d0(E);case 3:_=D.sent,D.next=7;break;case 6:_=E;case 7:return k=_.map(function(q){return Object.values(q)}),D.abrupt("return",k);case 9:case"end":return D.stop()}},P)}))).apply(this,arguments)}var Jm=function(){function P(E,_,k){pe()(this,P),this.config={k:_.k||sm.k,maxIter:_.maxIter||sm.maxIter,threshold:_.threshold||sm.threshold},this.ready=ft(this.load(E),k)}return Fe()(P,[{key:"load",value:function(){var E=J()(Ae.a.mark(function _(k){var D=this;return Ae.a.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.next=2,p0(k);case 2:return this.dataset=q.sent,F.tidy(function(){D.dataTensor=F.tensor2d(D.dataset),D.dataset.forEach(function(ee){var de=F.tensor1d(Object.values(ee));ee.tensor=de}),D.centroids=F.tensor2d(xd(D.dataset,D.config.k,!1)),D.fit()}),q.abrupt("return",this);case 5:case"end":return q.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"fit",value:function(){this.getClosestCentroids(),this.recenterCentroids();for(var E=P.getEuclidianDistance(this.centroids,this.centroidsOld),_=0;E>this.config.threshold&&_<this.config.maxIter;)this.getClosestCentroids(),this.recenterCentroids(),E=P.getEuclidianDistance(this.centroids,this.centroidsOld),_+=1}},{key:"getClosestCentroids",value:function(){var E=this;this.dataset.forEach(function(_){var k=E.closestCentroid(_.tensor);_.centroid=k})}},{key:"closestCentroid",value:function(E){var _=this;return F.tidy(function(){return _.centroids.squaredDifference(E).sum(1).sqrt().argMin().arraySync()})}},{key:"classify",value:function(E){var _=this;return F.tidy(function(){var k=F.tensor1d(Object.values(E));return _.closestCentroid(k)})}},{key:"recenterCentroids",value:function(){var E=this,_=F.tidy(function(){return E.centroidsOld=E.centroids,F.stack(E.centroids.unstack().map(function(k,D){var q=E.dataset.filter(function(ee){return ee.centroid===D}).map(function(ee){return ee.tensor});return q.length===0?k:q.length===1?q[0]:F.tidy(function(){return F.stack(q).mean(0)})}))});this.centroids=_}}],[{key:"getEuclidianDistance",value:function(E,_){return F.tidy(function(){return F.squaredDifference(E,_).sum().sqrt().dataSync()})[0]}}]),P}(),m0=function(P,E,_){return new Jm(P,E,_)};function g0(P){return Wg.apply(this,arguments)}function Wg(){return(Wg=J()(Ae.a.mark(function P(E){var _,k;return Ae.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return _=F.data.csv(E),D.next=3,_.toArray();case 3:return k=D.sent,D.abrupt("return",k);case 5:case"end":return D.stop()}},P)}))).apply(this,arguments)}function v0(P){return y0.apply(this,arguments)}function y0(){return(y0=J()(Ae.a.mark(function P(E){var _,k;return Ae.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(typeof E!="string"){D.next=6;break}return D.next=3,g0(E);case 3:_=D.sent,D.next=7;break;case 6:_=E;case 7:return k=_.map(function(q){return Object.values(q)}),D.abrupt("return",k);case 9:case"end":return D.stop()}},P)}))).apply(this,arguments)}var rd={eps:50,minPts:3},b0=function(){function P(E,_,k){pe()(this,P),this.config={eps:_.eps||rd.eps,minPts:_.minPts||rd.minPts},this.lastClusterId=0,this.status=[],this.ready=ft(this.load(E),k)}return Fe()(P,[{key:"load",value:function(){var E=J()(Ae.a.mark(function _(k){var D=this;return Ae.a.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.next=2,v0(k);case 2:return this.dataset=q.sent,F.tidy(function(){D.dataTensor=F.tensor2d(D.dataset),D.dataset.forEach(function(ee){var de=F.tensor1d(Object.values(ee));ee.tensor=de}),D.fit()}),q.abrupt("return",this);case 5:case"end":return q.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"fit",value:function(){var E=this;this.dataset.forEach(function(_,k){if(_.status===void 0){_.status=0;var D=E.getNeighboursIndices(_);D.length<E.config.minPts?_.status=0:(E.incrementClusterId(),E.extend(k,D))}})}},{key:"extend",value:function(E,_){var k=this;this.dataset[E].clusterid=this.getClusterId(),this.dataset[E].status=this.dataset[E].clusterid,_.forEach(function(D){if(k.dataset[D].status===void 0){k.dataset[D].status=0;var q=k.getNeighboursIndices(k.dataset[D]);q.length>=k.config.minPts&&k.extend(D,q)}k.dataset[D].status<1&&(k.dataset[D].status=k.dataset[E].clusterid,k.dataset[D].clusterid=k.dataset[E].clusterid)})}},{key:"getClusterId",value:function(){return this.lastClusterId}},{key:"incrementClusterId",value:function(){this.lastClusterId+=1}},{key:"getNeighboursIndices",value:function(E){var _=this;try{return F.tidy(function(){var k=F.squaredDifference(E.tensor,_.dataTensor).sum(1).sqrt().topk(_.dataTensor.shape[0],!0),D=k.values,q=k.indices;return F.stack([D.asType("float32"),q.asType("float32")],1).arraySync().filter(function(ee){return ee[0]<=_.config.eps}).reduce(function(ee,de){return ee.push(de[1]),ee},[])})||[]}catch(k){console.log("error ".concat(k))}return[]}}]),P}(),Vg=function(P,E,_){return new b0(P,E,_)},mh={hosoda:"https://raw.githubusercontent.com/leemengtaiwan/tfjs-models/master/cartoongan/tfjs_json_models/hosoda/model.json",miyazaki:"https://raw.githubusercontent.com/Derek-Wds/training_CartoonGAN/master/tfModels/Miyazaki/model.json"},qg=function(){function P(E,_){pe()(this,P),this.config={modelUrl:E.modelUrl?E.modelUrl:mh.miyazaki,returnTensors:!!E.returnTensors&&E.returnTensors},this.model={},this.ready=!1,this.ready=ft(this.loadModel(this.config.modelUrl),_)}return Fe()(P,[{key:"loadModel",value:function(){var E=J()(Ae.a.mark(function _(k){return Ae.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.next=2,F.loadGraphModel(k);case 2:return this.model=D.sent,D.abrupt("return",this);case 4:case"end":return D.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"generate",value:function(){var E=J()(Ae.a.mark(function _(k,D){var q,ee;return Ae.a.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:if(ee=D,!jn(k)){de.next=5;break}q=k,de.next=19;break;case 5:if(Ce()(k)!=="object"||!jn(k.elt)){de.next=9;break}q=k.elt,de.next=19;break;case 9:if(Ce()(k)!=="object"||!jn(k.canvas)){de.next=13;break}q=k.canvas,de.next=19;break;case 13:if(typeof k!="function"){de.next=18;break}q=this.video,ee=k,de.next=19;break;case 18:throw new Error("Detection subject not supported");case 19:return de.abrupt("return",ft(this.generateInternal(q),ee));case 20:case"end":return de.stop()}},_,this)}));return function(_,k){return E.apply(this,arguments)}}()},{key:"generateInternal",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee,de;return Ae.a.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:return _e.next=2,this.ready;case 2:return _e.next=4,F.nextFrame();case 4:if((D=F.browser.fromPixels(k).resizeBilinear([256,256])).shape[0]===256&&D.shape[1]===256){_e.next=9;break}throw new Error("Input size should be ".concat(256,"*").concat(256," but ").concat(D.shape," is found"));case 9:if(D.shape[2]===3){_e.next=11;break}throw new Error("Input color channel number should be 3 but ".concat(D.shape[2]," is found"));case 11:if(D=D.sub(127.5).div(127.5).reshape([1,256,256,3]),q=F.ones([256,256,1]).tile([1,1,1]).mul(255),ee=(ee=(ee=this.model.predict(D)).add(1).mul(127.5).reshape([256,256,3]).floor()).concat(q,2),de=this.resultFinalize(ee),!this.config.returnTensors){_e.next=19;break}return _e.abrupt("return",de);case 19:return D.dispose(),ee.dispose(),_e.abrupt("return",de);case 22:case"end":return _e.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()},{key:"resultFinalize",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q,ee,de;return Ae.a.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:return D=k,_e.next=3,k.data();case 3:return q=_e.sent,_e.next=6,qr.rawToBlob(q,k.shape[0],k.shape[1]);case 6:return ee=_e.sent,_e.next=9,qr.blobToP5Image(ee);case 9:if(de=_e.sent,!this.config.returnTensors){_e.next=12;break}return _e.abrupt("return",{tensor:D,raw:q,blob:ee,image:de});case 12:return _e.abrupt("return",{raw:q,blob:ee,image:de});case 13:case"end":return _e.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()}]),P}(),x0=function(P,E){var _=Ce()(P)==="object"?P:{},k=typeof P=="function"?P:E;return typeof P=="string"&&(_.modelUrl=P),new qg(_,k)};/**
    * @license
    * Copyright 2021 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function id(P,E,_,k){return new(_||(_=Promise))(function(D,q){function ee(Re){try{_e(k.next(Re))}catch(De){q(De)}}function de(Re){try{_e(k.throw(Re))}catch(De){q(De)}}function _e(Re){var De;Re.done?D(Re.value):(De=Re.value,De instanceof _?De:new _(function(tt){tt(De)})).then(ee,de)}_e((k=k.apply(P,E||[])).next())})}function gh(P,E){var _,k,D,q,ee={label:0,sent:function(){if(1&D[0])throw D[1];return D[1]},trys:[],ops:[]};return q={next:de(0),throw:de(1),return:de(2)},typeof Symbol=="function"&&(q[Symbol.iterator]=function(){return this}),q;function de(_e){return function(Re){return function(De){if(_)throw new TypeError("Generator is already executing.");for(;ee;)try{if(_=1,k&&(D=2&De[0]?k.return:De[0]?k.throw||((D=k.return)&&D.call(k),0):k.next)&&!(D=D.call(k,De[1])).done)return D;switch(k=0,D&&(De=[2&De[0],D.value]),De[0]){case 0:case 1:D=De;break;case 4:return ee.label++,{value:De[1],done:!1};case 5:ee.label++,k=De[1],De=[0];continue;case 7:De=ee.ops.pop(),ee.trys.pop();continue;default:if(!(D=(D=ee.trys).length>0&&D[D.length-1])&&(De[0]===6||De[0]===2)){ee=0;continue}if(De[0]===3&&(!D||De[1]>D[0]&&De[1]<D[3])){ee.label=De[1];break}if(De[0]===6&&ee.label<D[1]){ee.label=D[1],D=De;break}if(D&&ee.label<D[2]){ee.label=D[2],ee.ops.push(De);break}D[2]&&ee.ops.pop(),ee.trys.pop();continue}De=E.call(P,ee)}catch(tt){De=[6,tt],k=0}finally{_=D=0}if(5&De[0])throw De[1];return{value:De[0]?De[1]:void 0,done:!0}}([_e,Re])}}}var Qm=function(P){for(var E=[],_=0,k=P;_<k.length;_++){var D=k[_];E.push(D)}return E},Hg=function(){this.parent=null,this.children={},this.end=!1,this.word=[[],0,0]},vf=function(){function P(){this.root=new Hg}return P.prototype.insert=function(E,_,k){for(var D=this.root,q=Qm(E),ee=0;ee<q.length;ee++)D.children[q[ee]]||(D.children[q[ee]]=new Hg,D.children[q[ee]].parent=D,D.children[q[ee]].word[0]=D.word[0].concat(q[ee])),D=D.children[q[ee]],ee===q.length-1&&(D.end=!0,D.word[1]=_,D.word[2]=k)},P.prototype.commonPrefixSearch=function(E){for(var _=[],k=this.root.children[E[0]],D=0;D<E.length&&k;D++)k.end&&_.push(k.word),k=k.children[E[D+1]];return _.length||_.push([[E[0]],0,0]),_},P}(),Gg="\u2581",w0=6,Uu=function(){function P(E,_){_===void 0&&(_=w0),this.vocabulary=E,this.reservedSymbolsCount=_,this.trie=new vf;for(var k=this.reservedSymbolsCount;k<this.vocabulary.length;k++)this.trie.insert(this.vocabulary[k][0],this.vocabulary[k][1],k)}return P.prototype.encode=function(E){var _=[],k=[],D=[];E=function(An){var Sr=An.normalize("NFKC");return Sr.length>0?Gg+Sr.replace(/ /g,Gg):Sr}(E);for(var q=Qm(E),ee=0;ee<=q.length;ee++)_.push({}),k.push(0),D.push(0);for(ee=0;ee<q.length;ee++)for(var de=this.trie.commonPrefixSearch(q.slice(ee)),_e=0;_e<de.length;_e++){var Re=de[_e],De={key:Re[0],score:Re[1],index:Re[2]};_[ee+(tt=Re[0].length)][ee]==null&&(_[ee+tt][ee]=[]),_[ee+tt][ee].push(De)}for(var tt=0;tt<=q.length;tt++)for(var st in _[tt]){var It=_[tt][st];for(_e=0;_e<It.length;_e++){var Bt=It[_e],mn=Bt.score+D[tt-Bt.key.length];(D[tt]===0||mn>=D[tt])&&(D[tt]=mn,k[tt]=It[_e].index)}}for(var xn=[],Fn=k.length-1;Fn>0;)xn.push(k[Fn]),Fn-=this.vocabulary[k[Fn]][0].length;var Rn=[],Ln=!1;for(ee=0;ee<xn.length;ee++){var Zn=xn[ee];Ln&&Zn===0||Rn.push(Zn),Ln=Zn===0}return Rn.reverse()},P}();function X0(P){return id(this,void 0,void 0,function(){var E;return gh(this,function(_){switch(_.label){case 0:return[4,pp(P)];case 1:return E=_.sent(),[2,new Uu(E)]}})})}function pp(P){return id(this,void 0,void 0,function(){return gh(this,function(E){switch(E.label){case 0:return[4,Qe.util.fetch(P)];case 1:return[2,E.sent().json()]}})})}function mp(P){return id(this,void 0,void 0,function(){var E;return gh(this,function(_){switch(_.label){case 0:return[4,(E=new vh).load(P)];case 1:return _.sent(),[2,E]}})})}var vh=function(){function P(){}return P.prototype.loadModel=function(E){return id(this,void 0,void 0,function(){return gh(this,function(_){return[2,E?Object(Ut.loadGraphModel)(E):Object(Ut.loadGraphModel)("https://tfhub.dev/tensorflow/tfjs-model/universal-sentence-encoder-lite/1/default/1",{fromTFHub:!0})]})})},P.prototype.load=function(E){return E===void 0&&(E={}),id(this,void 0,void 0,function(){var _,k,D;return gh(this,function(q){switch(q.label){case 0:return[4,Promise.all([this.loadModel(E.modelUrl),pp(E.vocabUrl||"https://storage.googleapis.com/tfjs-models/savedmodel/universal_sentence_encoder/vocab.json")])];case 1:return _=q.sent(),k=_[0],D=_[1],this.model=k,this.tokenizer=new Uu(D),[2]}})})},P.prototype.embed=function(E){return id(this,void 0,void 0,function(){var _,k,D,q,ee,de,_e,Re,De=this;return gh(this,function(tt){switch(tt.label){case 0:for(typeof E=="string"&&(E=[E]),_=E.map(function(st){return De.tokenizer.encode(st)}),k=_.map(function(st,It){return st.map(function(Bt,mn){return[It,mn]})}),D=[],q=0;q<k.length;q++)D=D.concat(k[q]);return ee=Object(Qe.tensor2d)(D,[D.length,2],"int32"),de=Object(Qe.tensor1d)(Qe.util.flatten(_),"int32"),_e={indices:ee,values:de},[4,this.model.executeAsync(_e)];case 1:return Re=tt.sent(),ee.dispose(),de.dispose(),[2,Re]}})})},P}(),k0={withTokenizer:!1},Md=function(){function P(E,_){pe()(this,P),this.model=null,this.tokenizer=null,this.config={withTokenizer:E.withTokenizer||k0.withTokenizer},ft(this.loadModel(),_)}return Fe()(P,[{key:"loadModel",value:function(){var E=J()(Ae.a.mark(function _(){return Ae.a.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(this.config.withTokenizer!==!0){k.next=4;break}return k.next=3,X0();case 3:this.tokenizer=k.sent;case 4:return k.next=6,mp();case 6:return this.model=k.sent,k.abrupt("return",this);case 8:case"end":return k.stop()}},_,this)}));return function(){return E.apply(this,arguments)}}()},{key:"predict",value:function(E,_){return ft(this.predictInternal(E),_)}},{key:"predictInternal",value:function(){var E=J()(Ae.a.mark(function _(k){var D,q;return Ae.a.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return ee.prev=0,ee.next=3,this.model.embed(k);case 3:return D=ee.sent,ee.next=6,D.array();case 6:return q=ee.sent,D.dispose(),ee.abrupt("return",q);case 11:return ee.prev=11,ee.t0=ee.catch(0),console.error(ee.t0),ee.abrupt("return",ee.t0);case 15:case"end":return ee.stop()}},_,this,[[0,11]])}));return function(_){return E.apply(this,arguments)}}()},{key:"encode",value:function(E,_){return ft(this.encodeInternal(E),_)}},{key:"encodeInternal",value:function(){var E=J()(Ae.a.mark(function _(k){return Ae.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(this.config.withTokenizer!==!0){D.next=2;break}return D.abrupt("return",this.tokenizer.encode(k));case 2:return console.error('withTokenizer must be set to true - please pass "withTokenizer:true" as an option in the constructor'),D.abrupt("return",!1);case 4:case"end":return D.stop()}},_,this)}));return function(_){return E.apply(this,arguments)}}()}]),P}(),yf=function(P,E){var _=Ce()(P)==="object"?P:{};return new Md(_,typeof P=="function"?P:E)};/**
    * @license
    * Copyright 2020 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */const gp=P=>{P.startEndTensor.dispose(),P.startPoint.dispose(),P.endPoint.dispose()},jd=P=>({startEndTensor:P,startPoint:Object(Qe.slice)(P,[0,0],[-1,2]),endPoint:Object(Qe.slice)(P,[0,2],[-1,2])}),Zm=(P,E)=>{const _=Object(Qe.mul)(P.startPoint,E),k=Object(Qe.mul)(P.endPoint,E),D=Object(Qe.concat2d)([_,k],1);return jd(D)},$g={strides:[8,16],anchors:[2,6]},_0=6;function Eu(P,E){let _,k,D;if(P.topLeft instanceof Qe.Tensor&&P.bottomRight instanceof Qe.Tensor){const[ee,de]=Object(Qe.tidy)(()=>[Object(Qe.concat)([Object(Qe.sub)(E-1,P.topLeft.slice(0,1)),P.topLeft.slice(1,1)]),Object(Qe.concat)([Object(Qe.sub)(E-1,P.bottomRight.slice(0,1)),P.bottomRight.slice(1,1)])]);_=ee,k=de,P.landmarks!=null&&(D=Object(Qe.tidy)(()=>{const _e=Object(Qe.sub)(Object(Qe.tensor1d)([E-1,0]),P.landmarks),Re=Object(Qe.tensor1d)([1,-1]);return Object(Qe.mul)(_e,Re)}))}else{const[ee,de]=P.topLeft,[_e,Re]=P.bottomRight;_=[E-1-ee,de],k=[E-1-_e,Re],P.landmarks!=null&&(D=P.landmarks.map(De=>[E-1-De[0],De[1]]))}const q={topLeft:_,bottomRight:k};return D!=null&&(q.landmarks=D),P.probability!=null&&(q.probability=P.probability instanceof Qe.Tensor?P.probability.clone():P.probability),q}function E0(P,E){return Object(Qe.tidy)(()=>{let _;return _=P.hasOwnProperty("box")?P.box:P,Zm(_,E).startEndTensor.squeeze()})}class vp{constructor(E,_,k,D,q,ee){this.blazeFaceModel=E,this.width=_,this.height=k,this.maxFaces=D,this.anchorsData=function(de,_e,Re){const De=[];for(let tt=0;tt<Re.strides.length;tt++){const st=Re.strides[tt],It=Math.floor((_e+st-1)/st),Bt=Math.floor((de+st-1)/st),mn=Re.anchors[tt];for(let xn=0;xn<It;xn++){const Fn=st*(xn+.5);for(let Rn=0;Rn<Bt;Rn++){const Ln=st*(Rn+.5);for(let Zn=0;Zn<mn;Zn++)De.push([Ln,Fn])}}}return De}(_,k,$g),this.anchors=Object(Qe.tensor2d)(this.anchorsData),this.inputSizeData=[_,k],this.inputSize=Object(Qe.tensor1d)([_,k]),this.iouThreshold=q,this.scoreThreshold=ee}async getBoundingBoxes(E,_,k=!0){const[D,q,ee]=Object(Qe.tidy)(()=>{const mn=E.resizeBilinear([this.width,this.height]),xn=Object(Qe.mul)(Object(Qe.sub)(mn.div(255),.5),2),Fn=this.blazeFaceModel.predict(xn).squeeze(),Rn=function(Zn,An,Sr){const Ur=Object(Qe.slice)(Zn,[0,1],[-1,2]),Wr=Object(Qe.add)(Ur,An),ci=Object(Qe.slice)(Zn,[0,3],[-1,2]),Jr=Object(Qe.div)(ci,Sr),Xi=Object(Qe.div)(Wr,Sr),lo=Object(Qe.div)(Jr,2),io=Object(Qe.sub)(Xi,lo),ga=Object(Qe.add)(Xi,lo),Ya=Object(Qe.mul)(io,Sr),Ta=Object(Qe.mul)(ga,Sr);return Object(Qe.concat2d)([Ya,Ta],1)}(Fn,this.anchors,this.inputSize),Ln=Object(Qe.slice)(Fn,[0,0],[-1,1]);return[Fn,Rn,Object(Qe.sigmoid)(Ln).squeeze()]}),de=console.warn;console.warn=()=>{};const _e=Qe.image.nonMaxSuppression(q,ee,this.maxFaces,this.iouThreshold,this.scoreThreshold);console.warn=de;const Re=await _e.array();_e.dispose();let De=Re.map(mn=>Object(Qe.slice)(q,[mn,0],[1,-1]));_||(De=await Promise.all(De.map(async mn=>{const xn=await mn.array();return mn.dispose(),xn})));const tt=E.shape[1],st=E.shape[2];let It;It=_?Object(Qe.div)([st,tt],this.inputSize):[st/this.inputSizeData[0],tt/this.inputSizeData[1]];const Bt=[];for(let mn=0;mn<De.length;mn++){const xn=De[mn],Fn=Object(Qe.tidy)(()=>{const Rn=jd(xn instanceof Qe.Tensor?xn:Object(Qe.tensor2d)(xn));if(!k)return Rn;const Ln=Re[mn];let Zn;return Zn=_?this.anchors.slice([Ln,0],[1,2]):this.anchorsData[Ln],{box:Rn,landmarks:Object(Qe.slice)(D,[Ln,_0-1],[1,-1]).squeeze().reshape([_0,-1]),probability:Object(Qe.slice)(ee,[Ln],[1]),anchor:Zn}});Bt.push(Fn)}return q.dispose(),ee.dispose(),D.dispose(),{boxes:Bt,scaleFactor:It}}async estimateFaces(E,_=!1,k=!1,D=!0){const[,q]=function(Re){return Re instanceof Qe.Tensor?[Re.shape[0],Re.shape[1]]:[Re.height,Re.width]}(E),ee=Object(Qe.tidy)(()=>(E instanceof Qe.Tensor||(E=Qe.browser.fromPixels(E)),E.toFloat().expandDims(0))),{boxes:de,scaleFactor:_e}=await this.getBoundingBoxes(ee,_,D);return ee.dispose(),_?de.map(Re=>{const De=E0(Re,_e);let tt={topLeft:De.slice([0],[2]),bottomRight:De.slice([2],[2])};if(D){const{landmarks:st,probability:It,anchor:Bt}=Re,mn=st.add(Bt).mul(_e);tt.landmarks=mn,tt.probability=It}return k&&(tt=Eu(tt,q)),tt}):Promise.all(de.map(async Re=>{const De=E0(Re,_e);let tt;if(D){const[st,It,Bt]=await Promise.all([Re.landmarks,De,Re.probability].map(async Ln=>Ln.array())),mn=Re.anchor,[xn,Fn]=_e,Rn=st.map(Ln=>[(Ln[0]+mn[0])*xn,(Ln[1]+mn[1])*Fn]);tt={topLeft:It.slice(0,2),bottomRight:It.slice(2),landmarks:Rn,probability:Bt},gp(Re.box),Re.landmarks.dispose(),Re.probability.dispose()}else{const st=await De.array();tt={topLeft:st.slice(0,2),bottomRight:st.slice(2)}}return De.dispose(),k&&(tt=Eu(tt,q)),tt}))}}const C0="https://tfhub.dev/tensorflow/tfjs-model/blazeface/1/default/1",eg={silhouette:[10,338,297,332,284,251,389,356,454,323,361,288,397,365,379,378,400,377,152,148,176,149,150,136,172,58,132,93,234,127,162,21,54,103,67,109],lipsUpperOuter:[61,185,40,39,37,0,267,269,270,409,291],lipsLowerOuter:[146,91,181,84,17,314,405,321,375,291],lipsUpperInner:[78,191,80,81,82,13,312,311,310,415,308],lipsLowerInner:[78,95,88,178,87,14,317,402,318,324,308],rightEyeUpper0:[246,161,160,159,158,157,173],rightEyeLower0:[33,7,163,144,145,153,154,155,133],rightEyeUpper1:[247,30,29,27,28,56,190],rightEyeLower1:[130,25,110,24,23,22,26,112,243],rightEyeUpper2:[113,225,224,223,222,221,189],rightEyeLower2:[226,31,228,229,230,231,232,233,244],rightEyeLower3:[143,111,117,118,119,120,121,128,245],rightEyebrowUpper:[156,70,63,105,66,107,55,193],rightEyebrowLower:[35,124,46,53,52,65],leftEyeUpper0:[466,388,387,386,385,384,398],leftEyeLower0:[263,249,390,373,374,380,381,382,362],leftEyeUpper1:[467,260,259,257,258,286,414],leftEyeLower1:[359,255,339,254,253,252,256,341,463],leftEyeUpper2:[342,445,444,443,442,441,413],leftEyeLower2:[446,261,448,449,450,451,452,453,464],leftEyeLower3:[372,340,346,347,348,349,350,357,465],leftEyebrowUpper:[383,300,293,334,296,336,285,417],leftEyebrowLower:[265,353,276,283,282,295],midwayBetweenEyes:[168],noseTip:[1],noseBottom:[2],noseRightCorner:[98],noseLeftCorner:[327],rightCheek:[205],leftCheek:[425]};function od(P){P!=null&&P.startPoint!=null&&(P.startEndTensor.dispose(),P.startPoint.dispose(),P.endPoint.dispose())}function cm(P,E,_){return{startEndTensor:P,startPoint:E!=null?E:Object(Qe.slice)(P,[0,0],[-1,2]),endPoint:_!=null?_:Object(Qe.slice)(P,[0,2],[-1,2])}}function yh(P){return Object(Qe.tidy)(()=>{const E=Object(Qe.sub)(P.endPoint,P.startPoint);return Object(Qe.abs)(E)})}function A0(P,E=1.5){return Object(Qe.tidy)(()=>{const _=function(de){return Object(Qe.tidy)(()=>{const _e=Object(Qe.div)(Object(Qe.sub)(de.endPoint,de.startPoint),2);return Object(Qe.add)(de.startPoint,_e)})}(P),k=yh(P),D=Object(Qe.mul)(Object(Qe.div)(k,2),E),q=Object(Qe.sub)(_,D),ee=Object(Qe.add)(_,D);return cm(Object(Qe.concat2d)([q,ee],1),q,ee)})}const tg=468,ng=.25;class Kg{constructor(E,_,k,D,q,ee){this.regionsOfInterest=[],this.runsWithoutFaceDetector=0,this.boundingBoxDetector=E,this.meshDetector=_,this.meshWidth=k,this.meshHeight=D,this.maxContinuousChecks=q,this.maxFaces=ee}async predict(E){if(this.shouldUpdateRegionsOfInterest()){const{boxes:D,scaleFactor:q}=await this.boundingBoxDetector.getBoundingBoxes(E,!0,!1);if(D.length===0)return q.dispose(),this.clearAllRegionsOfInterest(),null;const ee=D.map(de=>A0(function(_e,Re){const De=Object(Qe.mul)(_e.startPoint,Re),tt=Object(Qe.mul)(_e.endPoint,Re);return cm(Object(Qe.concat2d)([De,tt],1))}(de,q)));D.forEach(od),this.updateRegionsOfInterest(ee),this.runsWithoutFaceDetector=0}else this.runsWithoutFaceDetector++;return Object(Qe.tidy)(()=>this.regionsOfInterest.map((_,k)=>{const D=function(tt,st,It){const Bt=st.shape[1],mn=st.shape[2],xn=tt.startEndTensor;return Object(Qe.tidy)(()=>{const Fn=Object(Qe.concat2d)([xn.slice([0,1],[-1,1]),xn.slice([0,0],[-1,1]),xn.slice([0,3],[-1,1]),xn.slice([0,2],[-1,1])],0),Rn=Object(Qe.div)(Fn.transpose(),[Bt,mn,Bt,mn]);return Qe.image.cropAndResize(st,Rn,[0],It)})}(_,E,[this.meshHeight,this.meshWidth]).div(255),[,q,ee]=this.meshDetector.predict(D),de=Object(Qe.reshape)(ee,[-1,3]),_e=Object(Qe.div)(yh(_),[this.meshWidth,this.meshHeight]),Re=Object(Qe.mul)(de,_e.concat(Object(Qe.tensor2d)([1],[1,1]),1)).add(_.startPoint.concat(Object(Qe.tensor2d)([0],[1,1]),1)),De=this.calculateLandmarksBoundingBox(Re);return od(this.regionsOfInterest[k]),this.regionsOfInterest[k]=De,{coords:de,scaledCoords:Re,box:De,flag:q.squeeze()}}))}updateRegionsOfInterest(E){for(let _=0;_<E.length;_++){const k=E[_],D=this.regionsOfInterest[_];let q=0;if(D&&D.startPoint){const[ee,de,_e,Re]=k.startEndTensor.arraySync()[0],[De,tt,st,It]=D.startEndTensor.arraySync()[0],Bt=Math.max(ee,De),mn=Math.max(de,tt),xn=(Math.min(_e,st)-Bt)*(Math.min(Re,It)-mn);q=xn/((_e-ee)*(Re-de)+(st-De)*(It-de)-xn)}q>ng?od(k):(this.regionsOfInterest[_]=k,od(D))}for(let _=E.length;_<this.regionsOfInterest.length;_++)od(this.regionsOfInterest[_]);this.regionsOfInterest=this.regionsOfInterest.slice(0,E.length)}clearRegionOfInterest(E){this.regionsOfInterest[E]!=null&&(od(this.regionsOfInterest[E]),this.regionsOfInterest=[...this.regionsOfInterest.slice(0,E),...this.regionsOfInterest.slice(E+1)])}clearAllRegionsOfInterest(){for(let E=0;E<this.regionsOfInterest.length;E++)od(this.regionsOfInterest[E]);this.regionsOfInterest=[]}shouldUpdateRegionsOfInterest(){const E=this.regionsOfInterest.length,_=E===0;return this.maxFaces===1||_?_:E!==this.maxFaces&&this.runsWithoutFaceDetector>=this.maxContinuousChecks}calculateLandmarksBoundingBox(E){const _=E.slice([0,0],[tg,1]),k=E.slice([0,1],[tg,1]);return A0(cm(Object(Qe.stack)([_.min(),k.min(),_.max(),k.max()]).expandDims(0)))}}const Lf=[[.499976992607117,.652534008026123],[.500025987625122,.547487020492554],[.499974012374878,.602371990680695],[.482113003730774,.471979022026062],[.500150978565216,.527155995368958],[.499909996986389,.498252987861633],[.499523013830185,.40106201171875],[.289712011814117,.380764007568359],[.499954998493195,.312398016452789],[.499987006187439,.269918978214264],[.500023007392883,.107050001621246],[.500023007392883,.666234016418457],[.5000159740448,.679224014282227],[.500023007392883,.692348003387451],[.499976992607117,.695277988910675],[.499976992607117,.70593398809433],[.499976992607117,.719385027885437],[.499976992607117,.737019002437592],[.499967992305756,.781370997428894],[.499816000461578,.562981009483337],[.473773002624512,.573909997940063],[.104906998574734,.254140973091125],[.365929991006851,.409575998783112],[.338757991790771,.41302502155304],[.311120003461838,.409460008144379],[.274657994508743,.389131009578705],[.393361985683441,.403706014156342],[.345234006643295,.344011008739471],[.370094001293182,.346076011657715],[.319321990013123,.347265005111694],[.297903001308441,.353591024875641],[.24779200553894,.410809993743896],[.396889001131058,.842755019664764],[.280097991228104,.375599980354309],[.106310002505779,.399955987930298],[.2099249958992,.391353011131287],[.355807989835739,.534406006336212],[.471751004457474,.65040397644043],[.474155008792877,.680191993713379],[.439785003662109,.657229006290436],[.414617002010345,.66654098033905],[.450374007225037,.680860996246338],[.428770989179611,.682690978050232],[.374971002340317,.727805018424988],[.486716985702515,.547628998756409],[.485300987958908,.527395009994507],[.257764995098114,.314490020275116],[.401223003864288,.455172002315521],[.429818987846375,.548614978790283],[.421351999044418,.533740997314453],[.276895999908447,.532056987285614],[.483370006084442,.499586999416351],[.33721199631691,.282882988452911],[.296391993761063,.293242990970612],[.169294998049736,.193813979625702],[.447580009698868,.302609980106354],[.392390012741089,.353887975215912],[.354490011930466,.696784019470215],[.067304998636246,.730105042457581],[.442739009857178,.572826027870178],[.457098007202148,.584792017936707],[.381974011659622,.694710969924927],[.392388999462128,.694203019142151],[.277076005935669,.271932005882263],[.422551989555359,.563233017921448],[.385919004678726,.281364023685455],[.383103013038635,.255840003490448],[.331431001424789,.119714021682739],[.229923993349075,.232002973556519],[.364500999450684,.189113974571228],[.229622006416321,.299540996551514],[.173287004232407,.278747975826263],[.472878992557526,.666198015213013],[.446828007698059,.668527007102966],[.422762006521225,.673889994621277],[.445307999849319,.580065965652466],[.388103008270264,.693961024284363],[.403039008378983,.706539988517761],[.403629004955292,.693953037261963],[.460041999816895,.557139039039612],[.431158006191254,.692366003990173],[.452181994915009,.692366003990173],[.475387006998062,.692366003990173],[.465828001499176,.779190003871918],[.472328990697861,.736225962638855],[.473087012767792,.717857003211975],[.473122000694275,.704625964164734],[.473033010959625,.695277988910675],[.427942007780075,.695277988910675],[.426479011774063,.703539967536926],[.423162013292313,.711845993995667],[.4183090031147,.720062971115112],[.390094995498657,.639572978019714],[.013953999616206,.560034036636353],[.499913990497589,.58014702796936],[.413199990987778,.69539999961853],[.409626007080078,.701822996139526],[.468080013990402,.601534962654114],[.422728985548019,.585985004901886],[.463079988956451,.593783974647522],[.37211999297142,.47341400384903],[.334562003612518,.496073007583618],[.411671012639999,.546965003013611],[.242175996303558,.14767599105835],[.290776997804642,.201445996761322],[.327338010072708,.256527006626129],[.399509996175766,.748921036720276],[.441727995872498,.261676013469696],[.429764986038208,.187834024429321],[.412198007106781,.108901023864746],[.288955003023148,.398952007293701],[.218936994671822,.435410976409912],[.41278201341629,.398970007896423],[.257135003805161,.355440020561218],[.427684992551804,.437960982322693],[.448339998722076,.536936044692993],[.178560003638268,.45755398273468],[.247308000922203,.457193970680237],[.286267012357712,.467674970626831],[.332827985286713,.460712015628815],[.368755996227264,.447206974029541],[.398963987827301,.432654976844788],[.476410001516342,.405806005001068],[.189241006970406,.523923993110657],[.228962004184723,.348950982093811],[.490725994110107,.562400996685028],[.404670000076294,.485132992267609],[.019469000399113,.401564002037048],[.426243007183075,.420431017875671],[.396993011236191,.548797011375427],[.266469985246658,.376977026462555],[.439121007919312,.51895797252655],[.032313998788595,.644356966018677],[.419054001569748,.387154996395111],[.462783008813858,.505746960639954],[.238978996872902,.779744982719421],[.198220998048782,.831938028335571],[.107550002634525,.540755033493042],[.183610007166862,.740257024765015],[.134409993886948,.333683013916016],[.385764002799988,.883153975009918],[.490967005491257,.579378008842468],[.382384985685349,.508572995662689],[.174399003386497,.397670984268188],[.318785011768341,.39623498916626],[.343364000320435,.400596976280212],[.396100014448166,.710216999053955],[.187885001301765,.588537991046906],[.430987000465393,.944064974784851],[.318993002176285,.898285031318665],[.266247987747192,.869701027870178],[.500023007392883,.190576016902924],[.499976992607117,.954452991485596],[.366169989109039,.398822009563446],[.393207013607025,.39553701877594],[.410373002290726,.391080021858215],[.194993004202843,.342101991176605],[.388664990663528,.362284004688263],[.365961998701096,.355970978736877],[.343364000320435,.355356991291046],[.318785011768341,.35834002494812],[.301414996385574,.363156020641327],[.058132998645306,.319076001644135],[.301414996385574,.387449026107788],[.499987989664078,.618434011936188],[.415838003158569,.624195992946625],[.445681989192963,.566076993942261],[.465844005346298,.620640993118286],[.49992299079895,.351523995399475],[.288718998432159,.819945991039276],[.335278987884521,.852819979190826],[.440512001514435,.902418971061707],[.128294005990028,.791940987110138],[.408771991729736,.373893976211548],[.455606997013092,.451801002025604],[.499877005815506,.908990025520325],[.375436991453171,.924192011356354],[.11421000212431,.615022003650665],[.448662012815475,.695277988910675],[.4480200111866,.704632043838501],[.447111994028091,.715808033943176],[.444831997156143,.730794012546539],[.430011987686157,.766808986663818],[.406787008047104,.685672998428345],[.400738000869751,.681069016456604],[.392399996519089,.677703022956848],[.367855995893478,.663918972015381],[.247923001646996,.601333022117615],[.452769994735718,.420849978923798],[.43639200925827,.359887003898621],[.416164010763168,.368713974952698],[.413385987281799,.692366003990173],[.228018000721931,.683571994304657],[.468268007040024,.352671027183533],[.411361992359161,.804327011108398],[.499989002943039,.469825029373169],[.479153990745544,.442654013633728],[.499974012374878,.439637005329132],[.432112008333206,.493588984012604],[.499886006116867,.866917014122009],[.49991300702095,.821729004383087],[.456548988819122,.819200992584229],[.344549000263214,.745438992977142],[.37890899181366,.574010014533997],[.374292999505997,.780184984207153],[.319687992334366,.570737957954407],[.357154995203018,.604269981384277],[.295284003019333,.621580958366394],[.447750002145767,.862477004528046],[.410986006259918,.508723020553589],[.31395098567009,.775308012962341],[.354128003120422,.812552988529205],[.324548006057739,.703992962837219],[.189096003770828,.646299958229065],[.279776990413666,.71465802192688],[.1338230073452,.682700991630554],[.336768001317978,.644733011722565],[.429883986711502,.466521978378296],[.455527991056442,.548622965812683],[.437114000320435,.558896005153656],[.467287987470627,.529924988746643],[.414712011814117,.335219979286194],[.37704598903656,.322777986526489],[.344107985496521,.320150971412659],[.312875986099243,.32233202457428],[.283526003360748,.333190023899078],[.241245999932289,.382785975933075],[.102986000478268,.468762993812561],[.267612010240555,.424560010433197],[.297879010438919,.433175981044769],[.333433985710144,.433878004550934],[.366427004337311,.426115989685059],[.396012008190155,.416696012020111],[.420121014118195,.41022801399231],[.007561000064015,.480777025222778],[.432949006557465,.569517970085144],[.458638995885849,.479089021682739],[.473466008901596,.545744001865387],[.476087987422943,.563830018043518],[.468472003936768,.555056989192963],[.433990985155106,.582361996173859],[.483518004417419,.562983989715576],[.482482999563217,.57784903049469],[.42645001411438,.389798998832703],[.438998997211456,.39649498462677],[.450067013502121,.400434017181396],[.289712011814117,.368252992630005],[.276670008897781,.363372981548309],[.517862021923065,.471948027610779],[.710287988185883,.380764007568359],[.526226997375488,.573909997940063],[.895093023777008,.254140973091125],[.634069979190826,.409575998783112],[.661242008209229,.41302502155304],[.688880026340485,.409460008144379],[.725341975688934,.389131009578705],[.606630027294159,.40370500087738],[.654766023159027,.344011008739471],[.629905998706818,.346076011657715],[.680678009986877,.347265005111694],[.702096998691559,.353591024875641],[.75221198797226,.410804986953735],[.602918028831482,.842862963676453],[.719901978969574,.375599980354309],[.893692970275879,.399959981441498],[.790081977844238,.391354024410248],[.643998026847839,.534487962722778],[.528249025344849,.65040397644043],[.525849997997284,.680191040039062],[.560214996337891,.657229006290436],[.585384011268616,.66654098033905],[.549625992774963,.680860996246338],[.57122802734375,.682691991329193],[.624852001667023,.72809898853302],[.513050019741058,.547281980514526],[.51509702205658,.527251958847046],[.742246985435486,.314507007598877],[.598631024360657,.454979002475739],[.570338010787964,.548575043678284],[.578631997108459,.533622980117798],[.723087012767792,.532054007053375],[.516445994377136,.499638974666595],[.662801027297974,.282917976379395],[.70362401008606,.293271005153656],[.830704987049103,.193813979625702],[.552385985851288,.302568018436432],[.607609987258911,.353887975215912],[.645429015159607,.696707010269165],[.932694971561432,.730105042457581],[.557260990142822,.572826027870178],[.542901992797852,.584792017936707],[.6180260181427,.694710969924927],[.607590973377228,.694203019142151],[.722943007946014,.271963000297546],[.577413976192474,.563166975975037],[.614082992076874,.281386971473694],[.616907000541687,.255886018276215],[.668509006500244,.119913995265961],[.770092010498047,.232020974159241],[.635536015033722,.189248979091644],[.77039098739624,.299556016921997],[.826722025871277,.278755009174347],[.527121007442474,.666198015213013],[.553171992301941,.668527007102966],[.577238023281097,.673889994621277],[.554691970348358,.580065965652466],[.611896991729736,.693961024284363],[.59696102142334,.706539988517761],[.596370995044708,.693953037261963],[.539958000183105,.557139039039612],[.568841993808746,.692366003990173],[.547818005084991,.692366003990173],[.52461302280426,.692366003990173],[.534089982509613,.779141008853912],[.527670979499817,.736225962638855],[.526912987232208,.717857003211975],[.526877999305725,.704625964164734],[.526966989040375,.695277988910675],[.572058022022247,.695277988910675],[.573521018028259,.703539967536926],[.57683801651001,.711845993995667],[.581691026687622,.720062971115112],[.609944999217987,.639909982681274],[.986046016216278,.560034036636353],[.5867999792099,.69539999961853],[.590372025966644,.701822996139526],[.531915009021759,.601536989212036],[.577268004417419,.585934996604919],[.536915004253387,.593786001205444],[.627542972564697,.473352015018463],[.665585994720459,.495950996875763],[.588353991508484,.546862006187439],[.757824003696442,.14767599105835],[.709249973297119,.201507985591888],[.672684013843536,.256581008434296],[.600408971309662,.74900496006012],[.55826598405838,.261672019958496],[.570303976535797,.187870979309082],[.588165998458862,.109044015407562],[.711045026779175,.398952007293701],[.781069993972778,.435405015945435],[.587247014045715,.398931980133057],[.742869973182678,.355445981025696],[.572156012058258,.437651991844177],[.55186802148819,.536570012569427],[.821442008018494,.457556009292603],[.752701997756958,.457181990146637],[.71375697851181,.467626988887787],[.66711300611496,.460672974586487],[.631101012229919,.447153985500336],[.6008620262146,.432473003864288],[.523481011390686,.405627012252808],[.810747981071472,.523926019668579],[.771045982837677,.348959028720856],[.509127020835876,.562718033790588],[.595292985439301,.485023975372314],[.980530977249146,.401564002037048],[.573499977588654,.420000016689301],[.602994978427887,.548687994480133],[.733529984951019,.376977026462555],[.560611009597778,.519016981124878],[.967685997486115,.644356966018677],[.580985009670258,.387160003185272],[.537728011608124,.505385041236877],[.760966002941132,.779752969741821],[.801778972148895,.831938028335571],[.892440974712372,.54076099395752],[.816350996494293,.740260004997253],[.865594983100891,.333687007427216],[.614073991775513,.883246004581451],[.508952975273132,.579437971115112],[.617941975593567,.508316040039062],[.825608015060425,.397674977779388],[.681214988231659,.39623498916626],[.656635999679565,.400596976280212],[.603900015354156,.710216999053955],[.81208598613739,.588539004325867],[.56801301240921,.944564998149872],[.681007981300354,.898285031318665],[.733752012252808,.869701027870178],[.633830010890961,.398822009563446],[.606792986392975,.39553701877594],[.589659988880157,.391062021255493],[.805015981197357,.342108011245728],[.611334979534149,.362284004688263],[.634037971496582,.355970978736877],[.656635999679565,.355356991291046],[.681214988231659,.35834002494812],[.698584973812103,.363156020641327],[.941866993904114,.319076001644135],[.698584973812103,.387449026107788],[.584177017211914,.624107003211975],[.554318010807037,.566076993942261],[.534153997898102,.62064003944397],[.711217999458313,.819975018501282],[.664629995822906,.852871000766754],[.559099972248077,.902631998062134],[.871706008911133,.791940987110138],[.591234028339386,.373893976211548],[.544341027736664,.451583981513977],[.624562978744507,.924192011356354],[.88577002286911,.615028977394104],[.551338016986847,.695277988910675],[.551980018615723,.704632043838501],[.552887976169586,.715808033943176],[.555167973041534,.730794012546539],[.569944024085999,.767035007476807],[.593203008174896,.685675978660583],[.599261999130249,.681069016456604],[.607599973678589,.677703022956848],[.631937980651855,.663500010967255],[.752032995223999,.601315021514893],[.547226011753082,.420395016670227],[.563543975353241,.359827995300293],[.583841025829315,.368713974952698],[.586614012718201,.692366003990173],[.771915018558502,.683578014373779],[.531597018241882,.352482974529266],[.588370978832245,.804440975189209],[.52079701423645,.442565023899078],[.567984998226166,.493479013442993],[.543282985687256,.819254994392395],[.655317008495331,.745514988899231],[.621008992195129,.574018001556396],[.625559985637665,.78031200170517],[.680198013782501,.570719003677368],[.64276397228241,.604337990283966],[.704662978649139,.621529996395111],[.552012026309967,.862591981887817],[.589071989059448,.508637011051178],[.685944974422455,.775357007980347],[.645735025405884,.812640011310577],[.675342977046967,.703978002071381],[.810858011245728,.646304965019226],[.72012197971344,.714666962623596],[.866151988506317,.682704985141754],[.663187026977539,.644596993923187],[.570082008838654,.466325998306274],[.544561982154846,.548375964164734],[.562758982181549,.558784961700439],[.531987011432648,.530140042304993],[.585271000862122,.335177004337311],[.622952997684479,.32277899980545],[.655896008014679,.320163011550903],[.687132000923157,.322345972061157],[.716481983661652,.333200991153717],[.758756995201111,.382786989212036],[.897013008594513,.468769013881683],[.732392013072968,.424547016620636],[.70211398601532,.433162987232208],[.66652500629425,.433866024017334],[.633504986763,.426087975502014],[.603875994682312,.416586995124817],[.579657971858978,.409945011138916],[.992439985275269,.480777025222778],[.567192018032074,.569419980049133],[.54136598110199,.478899002075195],[.526564002037048,.546118021011353],[.523913025856018,.563830018043518],[.531529009342194,.555056989192963],[.566035985946655,.582329034805298],[.51631098985672,.563053965568542],[.5174720287323,.577877044677734],[.573594987392426,.389806985855103],[.560697972774506,.395331978797913],[.549755990505219,.399751007556915],[.710287988185883,.368252992630005],[.723330020904541,.363372981548309]],rg="https://tfhub.dev/mediapipe/tfjs-model/facemesh/1/default/1",O0=192,bh=192;async function lm({maxContinuousChecks:P=5,detectionConfidence:E=.9,maxFaces:_=10,iouThreshold:k=.3,scoreThreshold:D=.75}={}){const[q,ee]=await Promise.all([async function(de,_e,Re){return async function({maxFaces:De=10,inputWidth:tt=128,inputHeight:st=128,iouThreshold:It=.3,scoreThreshold:Bt=.75}={}){const mn=await Object(Ut.loadGraphModel)(C0,{fromTFHub:!0});return new vp(mn,tt,st,De,It,Bt)}({maxFaces:de,iouThreshold:_e,scoreThreshold:Re})}(_,k,D),async function(){return Object(Ut.loadGraphModel)(rg,{fromTFHub:!0})}()]);return new yp(q,ee,P,E,_)}function xh(P,E){if(P.mesh instanceof Qe.Tensor){const[_,k,D,q]=Object(Qe.tidy)(()=>{const ee=Object(Qe.tensor1d)([E-1,0,0]),de=Object(Qe.tensor1d)([1,-1,1]);return Object(Qe.tidy)(()=>[Object(Qe.concat)([Object(Qe.sub)(E-1,P.boundingBox.topLeft.slice(0,1)),P.boundingBox.topLeft.slice(1,1)]),Object(Qe.concat)([Object(Qe.sub)(E-1,P.boundingBox.bottomRight.slice(0,1)),P.boundingBox.bottomRight.slice(1,1)]),Object(Qe.sub)(ee,P.mesh).mul(de),Object(Qe.sub)(ee,P.scaledMesh).mul(de)])});return Object.assign({},P,{boundingBox:{topLeft:_,bottomRight:k},mesh:D,scaledMesh:q})}return Object.assign({},P,{boundingBox:{topLeft:[E-1-P.boundingBox.topLeft[0],P.boundingBox.topLeft[1]],bottomRight:[E-1-P.boundingBox.bottomRight[0],P.boundingBox.bottomRight[1]]},mesh:P.mesh.map(_=>{const k=_.slice(0);return k[0]=E-1-_[0],k}),scaledMesh:P.scaledMesh.map(_=>{const k=_.slice(0);return k[0]=E-1-_[0],k})})}class yp{constructor(E,_,k,D,q){this.pipeline=new Kg(E,_,O0,bh,k,q),this.detectionConfidence=D}static getAnnotations(){return eg}static getUVCoords(){return Lf}async estimateFaces(E,_=!1,k=!1){const[,D]=function(_e){return _e instanceof Qe.Tensor?[_e.shape[0],_e.shape[1]]:[_e.height,_e.width]}(E),q=Object(Qe.tidy)(()=>(E instanceof Qe.Tensor||(E=Qe.browser.fromPixels(E)),E.toFloat().expandDims(0))),ee=Object(Qe.env)().get("WEBGL_PACK_DEPTHWISECONV");Object(Qe.env)().set("WEBGL_PACK_DEPTHWISECONV",!0);const de=await this.pipeline.predict(q);return Object(Qe.env)().set("WEBGL_PACK_DEPTHWISECONV",ee),q.dispose(),de!=null&&de.length>0?Promise.all(de.map(async(_e,Re)=>{const{coords:De,scaledCoords:tt,box:st,flag:It}=_e;let Bt=[It];_||(Bt=Bt.concat([De,tt,st.startPoint,st.endPoint]));const mn=await Promise.all(Bt.map(async Ur=>Ur.array())),xn=mn[0];if(It.dispose(),xn<this.detectionConfidence&&this.pipeline.clearRegionOfInterest(Re),_){const Ur={faceInViewConfidence:xn,mesh:De,scaledMesh:tt,boundingBox:{topLeft:st.startPoint.squeeze(),bottomRight:st.endPoint.squeeze()}};return k?xh(Ur,D):Ur}const[Fn,Rn,Ln,Zn]=mn.slice(1);tt.dispose(),De.dispose();let An={faceInViewConfidence:xn,boundingBox:{topLeft:Ln,bottomRight:Zn},mesh:Fn,scaledMesh:Rn};k&&(An=xh(An,D));const Sr={};for(const Ur in eg)Sr[Ur]=eg[Ur].map(Wr=>An.scaledMesh[Wr]);return An.annotations=Sr,An})):[]}}function Cu(P){var E=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var _,k=Hs()(P);if(E){var D=Hs()(this).constructor;_=Reflect.construct(k,arguments,D)}else _=k.apply(this,arguments);return ws()(this,_)}}var ig=function(P){kc()(_,P);var E=Cu(_);function _(k,D,q){var ee;return pe()(this,_),(ee=E.call(this)).video=k,ee.model=null,ee.modelReady=!1,ee.config=D,ee.ready=ft(ee.loadModel(),q),ee}return Fe()(_,[{key:"loadModel",value:function(){var k=J()(Ae.a.mark(function D(){var q=this;return Ae.a.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return ee.next=2,lm(this.config);case 2:if(this.model=ee.sent,this.modelReady=!0,!this.video||this.video.readyState!==0){ee.next=7;break}return ee.next=7,new Promise(function(de){q.video.onloadeddata=function(){de()}});case 7:return this.video&&this.predict(),ee.abrupt("return",this);case 9:case"end":return ee.stop()}},D,this)}));return function(){return k.apply(this,arguments)}}()},{key:"predict",value:function(){var k=J()(Ae.a.mark(function D(q,ee){var de,_e,Re,De,tt=this;return Ae.a.wrap(function(st){for(;;)switch(st.prev=st.next){case 0:if(de=this.getInput(q)){st.next=3;break}throw new Error("No input image found.");case 3:return _e=this.config.flipHorizontal,st.next=6,this.model.estimateFaces(de,_e);case 6:if(Re=st.sent,De=Re,this.emit("predict",De),this.emit("face",De),!this.video){st.next=12;break}return st.abrupt("return",F.nextFrame().then(function(){return tt.predict()}));case 12:return typeof ee=="function"&&ee(De),st.abrupt("return",De);case 14:case"end":return st.stop()}},D,this)}));return function(D,q){return k.apply(this,arguments)}}()},{key:"getInput",value:function(k){return k instanceof HTMLImageElement||k instanceof HTMLVideoElement||k instanceof HTMLCanvasElement||k instanceof ImageData?k:Ce()(k)==="object"&&(k.elt instanceof HTMLImageElement||k.elt instanceof HTMLVideoElement||k.elt instanceof ImageData)?k.elt:Ce()(k)==="object"&&k.canvas instanceof HTMLCanvasElement?k.canvas:this.video}}]),_}(Jc.EventEmitter),Xg=function(P,E,_){var k,D={},q=_;P instanceof HTMLVideoElement?k=P:Ce()(P)==="object"&&P.elt instanceof HTMLVideoElement?k=P.elt:Ce()(P)==="object"?D=P:typeof P=="function"&&(q=P),Ce()(E)==="object"?D=E:typeof E=="function"&&(q=E);var ee=new ig(k,D,q);return q?ee:ee.ready};/**
    * @license
    * Copyright 2020 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function fm(P){return[Math.abs(P.endPoint[0]-P.startPoint[0]),Math.abs(P.endPoint[1]-P.startPoint[1])]}function hm(P){return[P.startPoint[0]+(P.endPoint[0]-P.startPoint[0])/2,P.startPoint[1]+(P.endPoint[1]-P.startPoint[1])/2]}function Yg(P,E=1.5){const _=hm(P),k=fm(P),D=[E*k[0]/2,E*k[1]/2];return{startPoint:[_[0]-D[0],_[1]-D[1]],endPoint:[_[0]+D[0],_[1]+D[1]],palmLandmarks:P.palmLandmarks}}function S0(P){const E=hm(P),_=fm(P),k=Math.max(..._)/2;return{startPoint:[E[0]-k,E[1]-k],endPoint:[E[0]+k,E[1]+k],palmLandmarks:P.palmLandmarks}}function Y0(P,E){const _=[P.endPoint[0]-P.startPoint[0],P.endPoint[1]-P.startPoint[1]],k=[_[0]*E[0],_[1]*E[1]];return{startPoint:[P.startPoint[0]+k[0],P.startPoint[1]+k[1]],endPoint:[P.endPoint[0]+k[0],P.endPoint[1]+k[1]],palmLandmarks:P.palmLandmarks}}class bf{constructor(E,_,k,D,q,ee){this.model=E,this.width=_,this.height=k,this.iouThreshold=q,this.scoreThreshold=ee,this.anchors=D.map(de=>[de.x_center,de.y_center]),this.anchorsTensor=Object(Qe.tensor2d)(this.anchors),this.inputSizeTensor=Object(Qe.tensor1d)([_,k]),this.doubleInputSizeTensor=Object(Qe.tensor1d)([2*_,2*k])}normalizeBoxes(E){return Object(Qe.tidy)(()=>{const _=Object(Qe.slice)(E,[0,0],[-1,2]),k=Object(Qe.slice)(E,[0,2],[-1,2]),D=Object(Qe.add)(Object(Qe.div)(_,this.inputSizeTensor),this.anchorsTensor),q=Object(Qe.div)(k,this.doubleInputSizeTensor),ee=Object(Qe.mul)(Object(Qe.sub)(D,q),this.inputSizeTensor),de=Object(Qe.mul)(Object(Qe.add)(D,q),this.inputSizeTensor);return Object(Qe.concat2d)([ee,de],1)})}normalizeLandmarks(E,_){return Object(Qe.tidy)(()=>{const k=Object(Qe.add)(Object(Qe.div)(E.reshape([-1,7,2]),this.inputSizeTensor),this.anchors[_]);return Object(Qe.mul)(k,this.inputSizeTensor)})}getBoundingBoxes(E){return Object(Qe.tidy)(()=>{const _=Object(Qe.mul)(Object(Qe.sub)(E,.5),2),k=Object(Qe.env)().get("WEBGL_PACK_DEPTHWISECONV");Object(Qe.env)().set("WEBGL_PACK_DEPTHWISECONV",!0);const D=this.model.predict(_).squeeze();Object(Qe.env)().set("WEBGL_PACK_DEPTHWISECONV",k);const q=Object(Qe.sigmoid)(Object(Qe.slice)(D,[0,0],[-1,1])).squeeze(),ee=Object(Qe.slice)(D,[0,1],[-1,4]),de=this.normalizeBoxes(ee),_e=console.warn;console.warn=()=>{};const Re=Qe.image.nonMaxSuppression(de,q,1,this.iouThreshold,this.scoreThreshold).arraySync();if(console.warn=_e,Re.length===0)return null;const De=Re[0],tt=Object(Qe.slice)(de,[De,0],[1,-1]),st=Object(Qe.slice)(D,[De,5],[1,14]);return{boxes:tt,palmLandmarks:this.normalizeLandmarks(st,De).reshape([-1,2])}})}estimateHandBounds(E){const _=E.shape[1],k=E.shape[2],D=Object(Qe.tidy)(()=>E.resizeBilinear([this.width,this.height]).div(255)),q=this.getBoundingBoxes(D);if(q===null)return D.dispose(),null;const ee=q.boxes.arraySync(),de=ee[0].slice(0,2),_e=ee[0].slice(2,4),Re=q.palmLandmarks.arraySync();return D.dispose(),q.boxes.dispose(),q.palmLandmarks.dispose(),function(De,tt){return{startPoint:[De.startPoint[0]*tt[0],De.startPoint[1]*tt[1]],endPoint:[De.endPoint[0]*tt[0],De.endPoint[1]*tt[1]],palmLandmarks:De.palmLandmarks.map(st=>[st[0]*tt[0],st[1]*tt[1]])}}({startPoint:de,endPoint:_e,palmLandmarks:Re},[k/this.width,_/this.height])}}const Bd={thumb:[1,2,3,4],indexFinger:[5,6,7,8],middleFinger:[9,10,11,12],ringFinger:[13,14,15,16],pinky:[17,18,19,20],palmBase:[0]};function og(P,E){return function(_){return _-2*Math.PI*Math.floor((_+Math.PI)/(2*Math.PI))}(Math.PI/2-Math.atan2(-(E[1]-P[1]),E[0]-P[0]))}const D0=(P,E)=>[[1,0,P],[0,1,E],[0,0,1]];function zf(P,E){let _=0;for(let k=0;k<P.length;k++)_+=P[k]*E[k];return _}function pu(P,E){const _=[];for(let k=0;k<P.length;k++)_.push(P[k][E]);return _}function bp(P,E){const _=[],k=P.length;for(let D=0;D<k;D++){_.push([]);for(let q=0;q<k;q++)_[D].push(zf(P[D],pu(E,q)))}return _}function dm(P,E){const _=Math.cos(P),k=Math.sin(P),D=[[_,-k,0],[k,_,0],[0,0,1]];return bp(bp(D0(E[0],E[1]),D),D0(-E[0],-E[1]))}function ag(P,E){return[zf(P,E[0]),zf(P,E[1])]}const T0=.8,sg=[0,-.4],ad=3,xv=[0,-.1],ug=1.65,au=[0,5,9,13,17,1,2],pm=0,Pd=2;class cg{constructor(E,_,k,D,q,ee){this.regionsOfInterest=[],this.runsWithoutHandDetector=0,this.boundingBoxDetector=E,this.meshDetector=_,this.maxContinuousChecks=q,this.detectionConfidence=ee,this.meshWidth=k,this.meshHeight=D,this.maxHandsNumber=1}getBoxForPalmLandmarks(E,_){const k=E.map(D=>ag([...D,1],_));return Yg(S0(Y0(this.calculateLandmarksBoundingBox(k),sg)),ad)}getBoxForHandLandmarks(E){const _=Yg(S0(Y0(this.calculateLandmarksBoundingBox(E),xv)),ug),k=[];for(let D=0;D<au.length;D++)k.push(E[au[D]].slice(0,2));return _.palmLandmarks=k,_}transformRawCoords(E,_,k,D){const q=fm(_),ee=[q[0]/this.meshWidth,q[1]/this.meshHeight],de=E.map(It=>[ee[0]*(It[0]-this.meshWidth/2),ee[1]*(It[1]-this.meshHeight/2),It[2]]),_e=dm(k,[0,0]),Re=de.map(It=>[...ag(It,_e),It[2]]),De=function(It){const Bt=[[It[0][0],It[1][0]],[It[0][1],It[1][1]]],mn=[It[0][2],It[1][2]],xn=[-zf(Bt[0],mn),-zf(Bt[1],mn)];return[Bt[0].concat(xn[0]),Bt[1].concat(xn[1]),[0,0,1]]}(D),tt=[...hm(_),1],st=[zf(tt,De[0]),zf(tt,De[1])];return Re.map(It=>[It[0]+st[0],It[1]+st[1],It[2]])}async estimateHand(E){const _=this.shouldUpdateRegionsOfInterest();if(_===!0){const An=this.boundingBoxDetector.estimateHandBounds(E);if(An===null)return E.dispose(),this.regionsOfInterest=[],null;this.updateRegionsOfInterest(An,!0),this.runsWithoutHandDetector=0}else this.runsWithoutHandDetector++;const k=this.regionsOfInterest[0],D=og(k.palmLandmarks[pm],k.palmLandmarks[Pd]),q=hm(k),ee=[q[0]/E.shape[2],q[1]/E.shape[1]];let de;const _e=Object(Qe.getBackend)();if(_e==="webgl")de=function(An,Sr,Ur,Wr){const ci=An.shape,Jr=ci[1],Xi=ci[2],lo=Math.sin(Sr),io=Math.cos(Sr),ga=Math.floor(Xi*(typeof Wr=="number"?Wr:Wr[0])),Ya=Math.floor(Jr*(typeof Wr=="number"?Wr:Wr[1])),Ta={variableNames:["Image"],outputShape:ci,userCode:`
      void main() {
        ivec4 coords = getOutputCoords();
        int x = coords[2];
        int y = coords[1];
        int coordX = int(float(x - ${ga}) * ${io} -
          float(y - ${Ya}) * ${lo});
        int coordY = int(float(x - ${ga}) * ${lo} +
          float(y - ${Ya}) * ${io});
        coordX = int(coordX + ${ga});
        coordY = int(coordY + ${Ya});

        ${typeof Ur=="number"?`float outputValue = ${Ur.toFixed(2)};`:`
      vec3 fill = vec3(${Ur.join(",")});
      float outputValue = fill[coords[3]];`}

        if(coordX > 0 && coordX < ${Xi} && coordY > 0 && coordY < ${Jr}) {
          outputValue = getImage(coords[0], coordY, coordX, coords[3]);
        }

      setOutput(outputValue);
    }`};return Object(Qe.backend)().compileAndRun(Ta,[An])}(E,D,0,ee);else{if(_e!=="cpu")throw new Error(`Handpose is not yet supported by the ${_e} backend - rotation kernel is not defined.`);de=function(An,Sr,Ur,Wr){const ci=Object(Qe.backend)(),Jr=Object(Qe.buffer)(An.shape,An.dtype),[Xi,lo,io,ga]=An.shape,Ya=io*(typeof Wr=="number"?Wr:Wr[0]),Ta=lo*(typeof Wr=="number"?Wr:Wr[1]),Aa=Math.sin(-Sr),Ma=Math.cos(-Sr),rs=ci.readSync(An.dataId);for(let va=0;va<Xi;va++)for(let Ns=0;Ns<lo;Ns++)for(let Tc=0;Tc<io;Tc++)for(let Ji=0;Ji<ga;Ji++){const Hi=[Xi,Ns,Tc,Ji],mu=Hi[2],os=Hi[1];let ya=(mu-Ya)*Ma-(os-Ta)*Aa,cl=(mu-Ya)*Aa+(os-Ta)*Ma;ya=Math.round(ya+Ya),cl=Math.round(cl+Ta);let gu=Ur;typeof Ur!="number"&&(gu=Ji===3?255:Ur[Ji]),ya>=0&&ya<io&&cl>=0&&cl<lo&&(gu=rs[va*io*lo*ga+cl*(io*ga)+ya*ga+Ji]);const ll=va*io*lo*ga+Ns*(io*ga)+Tc*ga+Ji;Jr.values[ll]=gu}return Jr.toTensor()}(E,D,0,ee)}const Re=dm(-D,q);let De;const tt=function(An,Sr,Ur){const Wr=Sr.shape[1],ci=Sr.shape[2],Jr=[[An.startPoint[1]/Wr,An.startPoint[0]/ci,An.endPoint[1]/Wr,An.endPoint[0]/ci]];return Qe.image.cropAndResize(Sr,Jr,[0],Ur)}(De=_===!0?this.getBoxForPalmLandmarks(k.palmLandmarks,Re):k,de,[this.meshWidth,this.meshHeight]),st=tt.div(255);tt.dispose(),de.dispose();const It=Object(Qe.env)().get("WEBGL_PACK_DEPTHWISECONV");Object(Qe.env)().set("WEBGL_PACK_DEPTHWISECONV",!0);const[Bt,mn]=this.meshDetector.predict(st);Object(Qe.env)().set("WEBGL_PACK_DEPTHWISECONV",It),st.dispose();const xn=Bt.dataSync()[0];if(Bt.dispose(),xn<this.detectionConfidence)return mn.dispose(),this.regionsOfInterest=[],null;const Fn=Object(Qe.reshape)(mn,[-1,3]),Rn=Fn.arraySync();mn.dispose(),Fn.dispose();const Ln=this.transformRawCoords(Rn,De,D,Re),Zn=this.getBoxForHandLandmarks(Ln);return this.updateRegionsOfInterest(Zn,!1),{landmarks:Ln,handInViewConfidence:xn,boundingBox:{topLeft:Zn.startPoint,bottomRight:Zn.endPoint}}}calculateLandmarksBoundingBox(E){const _=E.map(D=>D[0]),k=E.map(D=>D[1]);return{startPoint:[Math.min(..._),Math.min(...k)],endPoint:[Math.max(..._),Math.max(...k)]}}updateRegionsOfInterest(E,_){if(_)this.regionsOfInterest=[E];else{const k=this.regionsOfInterest[0];let D=0;if(k!=null&&k.startPoint!=null){const[q,ee]=E.startPoint,[de,_e]=E.endPoint,[Re,De]=k.startPoint,[tt,st]=k.endPoint,It=Math.max(q,Re),Bt=Math.max(ee,De),mn=(Math.min(de,tt)-It)*(Math.min(_e,st)-Bt);D=mn/((de-q)*(_e-ee)+(tt-Re)*(st-ee)-mn)}this.regionsOfInterest[0]=D>T0?k:E}}shouldUpdateRegionsOfInterest(){return this.regionsOfInterest.length!==this.maxHandsNumber||this.runsWithoutHandDetector>=this.maxContinuousChecks}}const mm=256,lg=256;async function fg({maxContinuousChecks:P=1/0,detectionConfidence:E=.8,iouThreshold:_=.3,scoreThreshold:k=.5}={}){const[D,q,ee]=await Promise.all([async function(){return Qe.util.fetch("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1/anchors.json?tfjs-format=file").then(Re=>Re.json())}(),async function(){return Object(Ut.loadGraphModel)("https://tfhub.dev/mediapipe/tfjs-model/handdetector/1/default/1",{fromTFHub:!0})}(),async function(){return Object(Ut.loadGraphModel)("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1",{fromTFHub:!0})}()]),de=new bf(q,mm,lg,D,_,k),_e=new cg(de,ee,mm,lg,P,E);return new sd(_e)}class sd{constructor(E){this.pipeline=E}static getAnnotations(){return Bd}async estimateHands(E,_=!1){const[,k]=function(_e){return _e instanceof Qe.Tensor?[_e.shape[0],_e.shape[1]]:[_e.height,_e.width]}(E),D=Object(Qe.tidy)(()=>(E instanceof Qe.Tensor||(E=Qe.browser.fromPixels(E)),E.toFloat().expandDims(0))),q=await this.pipeline.estimateHand(D);if(D.dispose(),q===null)return[];let ee=q;_===!0&&(ee=function(_e,Re){const{handInViewConfidence:De,landmarks:tt,boundingBox:st}=_e;return{handInViewConfidence:De,landmarks:tt.map(It=>[Re-1-It[0],It[1],It[2]]),boundingBox:{topLeft:[Re-1-st.topLeft[0],st.topLeft[1]],bottomRight:[Re-1-st.bottomRight[0],st.bottomRight[1]]}}}(q,k));const de={};for(const _e of Object.keys(Bd))de[_e]=Bd[_e].map(Re=>ee.landmarks[Re]);return[{handInViewConfidence:ee.handInViewConfidence,boundingBox:ee.boundingBox,landmarks:ee.landmarks,annotations:de}]}}function Hl(P){var E=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var _,k=Hs()(P);if(E){var D=Hs()(this).constructor;_=Reflect.construct(k,arguments,D)}else _=k.apply(this,arguments);return ws()(this,_)}}var N0=function(P){kc()(_,P);var E=Hl(_);function _(k,D,q){var ee;return pe()(this,_),(ee=E.call(this)).video=k,ee.model=null,ee.modelReady=!1,ee.config=D,ee.ready=ft(ee.loadModel(),q),ee}return Fe()(_,[{key:"loadModel",value:function(){var k=J()(Ae.a.mark(function D(){var q=this;return Ae.a.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return ee.next=2,fg(this.config);case 2:if(this.model=ee.sent,this.modelReady=!0,!this.video||this.video.readyState!==0){ee.next=7;break}return ee.next=7,new Promise(function(de){q.video.onloadeddata=function(){de()}});case 7:return this.video&&this.predict(),ee.abrupt("return",this);case 9:case"end":return ee.stop()}},D,this)}));return function(){return k.apply(this,arguments)}}()},{key:"predict",value:function(){var k=J()(Ae.a.mark(function D(q,ee){var de,_e,Re,De,tt=this;return Ae.a.wrap(function(st){for(;;)switch(st.prev=st.next){case 0:if(de=this.getInput(q)){st.next=3;break}throw new Error("No input image found.");case 3:return _e=this.config.flipHorizontal,st.next=6,this.model.estimateHands(de,_e);case 6:if(Re=st.sent,De=Re,this.emit("predict",De),this.emit("hand",De),!this.video){st.next=12;break}return st.abrupt("return",F.nextFrame().then(function(){return tt.predict()}));case 12:return typeof ee=="function"&&ee(De),st.abrupt("return",De);case 14:case"end":return st.stop()}},D,this)}));return function(D,q){return k.apply(this,arguments)}}()},{key:"getInput",value:function(k){return k instanceof HTMLImageElement||k instanceof HTMLVideoElement||k instanceof HTMLCanvasElement||k instanceof ImageData?k:Ce()(k)==="object"&&(k.elt instanceof HTMLImageElement||k.elt instanceof HTMLVideoElement||k.elt instanceof ImageData)?k.elt:Ce()(k)==="object"&&k.canvas instanceof HTMLCanvasElement?k.canvas:this.video}}]),_}(Jc.EventEmitter),I0=function(P,E,_){var k,D={},q=_;P instanceof HTMLVideoElement?k=P:Ce()(P)==="object"&&P.elt instanceof HTMLVideoElement?k=P.elt:Ce()(P)==="object"?D=P:typeof P=="function"&&(q=P),Ce()(E)==="object"?D=E:typeof E=="function"&&(q=E);var ee=new N0(k,D,q);return q?ee:ee.ready},wh=function(){console.log(`
\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}
\u{1F31F} Thank you for using ml5.js v`.concat(za.a,` \u{1F31F}

Please read our community statement to ensure 
that the use of this software reflects the values 
of the ml5.js community:
\u21B3 https://ml5js.org/about

Reporting: 
\u21B3 https://github.com/ml5js/ml5-library/issues
\u21B3 Email: info@ml5js.org 
\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}\u{1F308}`))},gm=function(){var P=J()(Ae.a.mark(function E(){var _;return Ae.a.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return(_=new Image).crossOrigin="",_.src="https://cdn.jsdelivr.net/gh/ml5js/ml5-library@main/assets/bird.jpg",k.next=5,new Promise(function(D){_.onload=D});case 5:return k.abrupt("return",_);case 6:case"end":return k.stop()}},E)}));return function(){return P.apply(this,arguments)}}(),J0=function(){var P=J()(Ae.a.mark(function E(){var _,k,D;return Ae.a.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:for(_=new Uint8ClampedArray(2e4),k=0;k<_.length;k+=4)_[k+0]=0,_[k+1]=190,_[k+2]=0,_[k+3]=255;return D=new ImageData(_,200),q.abrupt("return",D);case 4:case"end":return q.stop()}},E)}));return function(){return P.apply(this,arguments)}}();function Jg(P,E){var _=Object.keys(P);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(P);E&&(k=k.filter(function(D){return Object.getOwnPropertyDescriptor(P,D).enumerable})),_.push.apply(_,k)}return _}function hg(P){for(var E=1;E<arguments.length;E++){var _=arguments[E]!=null?arguments[E]:{};E%2?Jg(Object(_),!0).forEach(function(k){te()(P,k,_[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(P,Object.getOwnPropertyDescriptors(_)):Jg(Object(_)).forEach(function(k){Object.defineProperty(P,k,Object.getOwnPropertyDescriptor(_,k))})}return P}var ii={charRNN:qp,CVAE:Or,cartoon:x0,DCGAN:go,featureExtractor:eo,imageClassifier:Ai,kmeans:m0,dbscan:Vg,soundClassifier:Bi,pitchDetection:Xt,pix2pix:nu,poseNet:rf,sketchRNN:Qd,styleTransfer:Mh,word2vec:bu,YOLO:ac,CocoSsd:ef,objectDetector:Xf,uNet:cr,sentiment:Ru,bodyPix:Lh,faceApi:Ug,universalSentenceEncoder:yf,facemesh:Xg,handpose:I0};wh(),m.default=Object.assign({p5Utils:qr},function(P){if(typeof window=="undefined"||window.p5===void 0||window.p5.prototype===void 0||window.p5.prototype.registerPreloadMethod===void 0)return P;var E=P;return Object.keys(P).forEach(function(_){var k=P[_];E[_]=function(){for(var D=null,q=arguments.length,ee=new Array(q),de=0;de<q;de++)ee[de]=arguments[de];var _e=ee.length;return typeof ee[_e-1]=="function"&&(D=ee[_e-1],_e-=1),k.apply(P,[].concat(Eo()(ee.slice(0,_e)),[function(){try{D&&D()}catch(Re){console.error(Re)}return window._decrementPreload?window._decrementPreload():null}]))},window.p5.prototype.registerPreloadMethod("".concat(_),P)}),P}(ii),hg(hg({KNNClassifier:ko,communityStatement:wh},A),{},{tf:F,tfvis:ue,version:za.a,neuralNetwork:kd,testingUtils:$}))},function(j,m){},function(j,m){},function(j,m){},function(j,m){j.exports=function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)},j.exports.__esModule=!0,j.exports.default=j.exports},function(j,m){j.exports=function(o){if(typeof Symbol!="undefined"&&o[Symbol.iterator]!=null||o["@@iterator"]!=null)return Array.from(o)},j.exports.__esModule=!0,j.exports.default=j.exports},function(j,m,o){var g=o(186);j.exports=function(z){if(Array.isArray(z))return g(z)},j.exports.__esModule=!0,j.exports.default=j.exports},function(j,m,o){function g(V){return new Uint8Array(atob(V).split("").map(function($){return $.charCodeAt(0)}))}Object.defineProperty(m,"__esModule",{value:!0}),m.stringToUint8array=g,m.stringToArray=function(V){var $=g(V);return new Int16Array($.buffer)};var z=!1,I=0;function A(){if(z)return z=!1,I;var V=2*Math.random()-1,$=2*Math.random()-1,W=V*V+$*$;if(W===0||W>1)return A();var te=Math.sqrt(-2*Math.log(W)/W);return I=$*te,z=!0,V*te}function X(V,$){return Math.random()*($-V)+V}function K(V,$){return V+A()*$}function M(V,$){$===void 0&&($=2);var W=$;function te(Xt,tn){return[Xt[0]-tn[0],Xt[1]-tn[1]]}function F(Xt,tn){return Xt[0]*tn[0]+Xt[1]*tn[1]}function ue(Xt){return Xt[0]*Xt[0]+Xt[1]*Xt[1]}function se(Xt,tn){return ue(te(Xt,tn))}var J,me,pe,Oe,Fe=V.length,Le=[],Ae=W*W,ft=[],Mt=[];for(ft[0]=V[0],J=me=1,Oe=0;J<Fe;J++)se(V[J],V[Oe])<Ae||(ft[me++]=V[J],Oe=J);for(Oe<Fe-1&&(ft[me++]=V[Fe-1]),Mt[0]=Mt[me-1]=1,function Xt(tn,Ce,Wt,en,Ut){if(!(en<=Wt+1)){for(var Qe,fn,on,Ct,Vt=Wt,En=0,Pt=tn*tn,Rt=[Ce[Wt],Ce[en]],Tn=te(Rt[1],Rt[0]),Hn=ue(Tn),tr=Wt+1;tr<en;tr++)(on=F(te(Ce[tr],Rt[0]),Tn))<=0?Ct=se(Ce[tr],Rt[0]):Hn<=on?Ct=se(Ce[tr],Rt[1]):(fn=on/Hn,Qe=[Rt[0][0]+fn*Tn[0],Rt[0][1]+fn*Tn[1]],Ct=se(Ce[tr],Qe)),Ct<=En||(Vt=tr,En=Ct);En>Pt&&(Ut[Vt]=1,Xt(tn,Ce,Wt,Vt,Ut),Xt(tn,Ce,Vt,en,Ut))}}(W,ft,0,me-1,Mt),J=pe=0;J<me;J++)Mt[J]&&(Le[pe++]=ft[J]);return Le}m.gaussRandom=A,m.randf=X,m.randi=function(V,$){return Math.floor(Math.random()*($-V)+V)},m.randn=K,m.birandn=function(V,$,W,te,F){var ue=K(0,1),se=K(0,1);return[Math.sqrt(1-F*F)*W*ue+F*W*se+V,te*se+$]},m.sampleSoftmax=function(V){var $,W=X(0,1),te=V.length,F=0;for($=0;$<te;$++)if((F+=V[$])>=W)return $;return console.log("error sampling pi index"),-1},m.simplifyLine=M,m.simplifyLines=function(V,$){var W=[],te=2;$&&(te=$);for(var F=0;F<V.length;F++)W.push(M(V[F],te));return W},m.linesToStrokes=function(V){var $,W,te,F,ue,se,J,me,pe,Oe,Fe=0,Le=0,Ae=[];for(J=0;J<V.length;J++)if((pe=V[J].length)>1)for(me=0;me<pe;me++)$=(Oe=V[J][me])[0],W=Oe[1],me===pe-1?(se=1,ue=0):(se=0,ue=1),te=$-Fe,F=W-Le,Fe=$,Le=W,Ae.push([te,F,ue,se,0]);return Ae.push([0,0,0,0,1]),Ae.slice(1)},m.lineToStroke=function(V,$){var W,te,F,ue,se,J,me,pe,Oe,Fe,Le,Ae=[];if(Oe=$[0],Fe=$[1],(F=V.length)>1)for(Le=0;Le<F;Le++)me=(ue=V[Le])[0],pe=ue[1],Le===F-1?(te=1,W=0):(te=0,W=1),se=me-Oe,J=pe-Fe,Oe=me,Fe=pe,Ae.push([se,J,W,te,0]);return Ae}},function(j,m,o){var g=this&&this.__awaiter||function(K,M,V,$){return new(V||(V=Promise))(function(W,te){function F(J){try{se($.next(J))}catch(me){te(me)}}function ue(J){try{se($.throw(J))}catch(me){te(me)}}function se(J){J.done?W(J.value):new V(function(me){me(J.value)}).then(F,ue)}se(($=$.apply(K,M||[])).next())})},z=this&&this.__generator||function(K,M){var V,$,W,te,F={label:0,sent:function(){if(1&W[0])throw W[1];return W[1]},trys:[],ops:[]};return te={next:ue(0),throw:ue(1),return:ue(2)},typeof Symbol=="function"&&(te[Symbol.iterator]=function(){return this}),te;function ue(se){return function(J){return function(me){if(V)throw new TypeError("Generator is already executing.");for(;F;)try{if(V=1,$&&(W=2&me[0]?$.return:me[0]?$.throw||((W=$.return)&&W.call($),0):$.next)&&!(W=W.call($,me[1])).done)return W;switch($=0,W&&(me=[2&me[0],W.value]),me[0]){case 0:case 1:W=me;break;case 4:return F.label++,{value:me[1],done:!1};case 5:F.label++,$=me[1],me=[0];continue;case 7:me=F.ops.pop(),F.trys.pop();continue;default:if(!(W=(W=F.trys).length>0&&W[W.length-1])&&(me[0]===6||me[0]===2)){F=0;continue}if(me[0]===3&&(!W||me[1]>W[0]&&me[1]<W[3])){F.label=me[1];break}if(me[0]===6&&F.label<W[1]){F.label=W[1],W=me;break}if(W&&F.label<W[2]){F.label=W[2],F.ops.push(me);break}W[2]&&F.ops.pop(),F.trys.pop();continue}me=M.call(K,F)}catch(pe){me=[6,pe],$=0}finally{V=W=0}if(5&me[0])throw me[1];return{value:me[0]?me[1]:void 0,done:!0}}([se,J])}}};Object.defineProperty(m,"__esModule",{value:!0});var I=o(0),A=o(255),X=function(){function K(M){this.NMIXTURE=20,this.checkpointURL=M,this.initialized=!1}return K.prototype.isInitialized=function(){return this.initialized},K.prototype.instantiateFromJSON=function(M,V,$){var W;this.forgetBias=I.scalar(1),this.info=M,this.setPixelFactor(2),this.weightDims=V,this.numUnits=this.weightDims[0][0],this.weights=[];for(var te=0;te<$.length;te++){for(var F=(W=new Float32Array(A.stringToArray($[te]))).length,ue=0;ue<F;ue++)W[ue]=10*W[ue]/32767;this.weights.push(W)}this.outputKernel=I.tensor2d(this.weights[0],[this.weightDims[0][0],this.weightDims[0][1]]),this.outputBias=I.tensor1d(this.weights[1]);var se=I.tensor2d(this.weights[2],[this.weightDims[2][0],this.weightDims[2][1]]),J=I.tensor2d(this.weights[3],[this.weightDims[3][0],this.weightDims[3][1]]);this.lstmKernel=I.concat2d([se,J],0),this.lstmBias=I.tensor1d(this.weights[4]),this.rawVars=[this.outputKernel,this.outputBias,this.lstmKernel,this.lstmBias]},K.prototype.initialize=function(){return g(this,void 0,void 0,function(){var M;return z(this,function(V){switch(V.label){case 0:return this.dispose(),[4,fetch(this.checkpointURL).then(function($){return $.json()})];case 1:return M=V.sent(),this.instantiateFromJSON(M[0],M[1],M[2]),this.initialized=!0,console.log("Initialized SketchRNN."),[2]}})})},K.prototype.dispose=function(){if(this.rawVars){for(var M=0;M<this.rawVars.length;M++)this.rawVars[M].dispose();this.rawVars=void 0}this.forgetBias&&(this.forgetBias.dispose(),this.forgetBias=void 0),this.initialized=!1},K.prototype.setPixelFactor=function(M){this.pixelFactor=M,this.scaleFactor=this.info.scale_factor/this.pixelFactor},K.prototype.update=function(M,V){var $=this,W=I.tidy(function(){var se=$.numUnits,J=$.scaleFactor,me=[M[0]/J,M[1]/J,M[2],M[3],M[4]],pe=I.tensor2d(me,[1,5]),Oe=I.tensor2d(V.c,[1,se]),Fe=I.tensor2d(V.h,[1,se]),Le=I.basicLSTMCell($.forgetBias,$.lstmKernel,$.lstmBias,pe,Oe,Fe);return I.concat(Le,1)}),te=W.dataSync();W.dispose();var F=te.slice(0,this.numUnits),ue=te.slice(this.numUnits,2*this.numUnits);return{c:new Float32Array(F),h:new Float32Array(ue)}},K.prototype.updateStrokes=function(M,V,$){var W=this,te=I.tidy(function(){var J,me,pe,Oe,Fe,Le=W.numUnits,Ae=W.scaleFactor,ft=M.length;$&&(ft=$),pe=I.tensor2d(V.c,[1,Le]),Oe=I.tensor2d(V.h,[1,Le]);for(var Mt=0;Mt<ft;Mt++)J=[M[Mt][0]/Ae,M[Mt][1]/Ae,M[Mt][2],M[Mt][3],M[Mt][4]],me=I.tensor2d(J,[1,5]),pe=(Fe=I.basicLSTMCell(W.forgetBias,W.lstmKernel,W.lstmBias,me,pe,Oe))[0],Oe=Fe[1];return I.concat(Fe,1)}),F=te.dataSync();te.dispose();var ue=F.slice(0,this.numUnits),se=F.slice(this.numUnits,2*this.numUnits);return{c:new Float32Array(ue),h:new Float32Array(se)}},K.prototype.getPDF=function(M,V,$){var W=this;V===void 0&&(V=.65);var te=V,F=.5+.5*te;$&&(F=$);var ue=this.NMIXTURE,se=I.tidy(function(){var me=W.numUnits,pe=I.tensor2d(M.h,[1,me]),Oe=I.scalar(Math.sqrt(te)),Fe=I.scalar(F),Le=I.add(I.matMul(pe,W.outputKernel),W.outputBias).squeeze(),Ae=I.split(Le,[3,6*ue]),ft=Ae[0],Mt=Ae[1],Xt=I.split(Mt,6),tn=Xt[0],Ce=Xt[1],Wt=Xt[2],en=Xt[3],Ut=Xt[4],Qe=Xt[5],fn=I.softmax(ft.div(Fe)),on=[I.softmax(tn.div(Fe)),Ce,Wt,I.exp(en).mul(Oe),I.exp(Ut).mul(Oe),I.tanh(Qe),fn];return I.concat(on)}),J=se.dataSync();return se.dispose(),{pi:new Float32Array(J.slice(0,ue)),muX:new Float32Array(J.slice(1*ue,2*ue)),muY:new Float32Array(J.slice(2*ue,3*ue)),sigmaX:new Float32Array(J.slice(3*ue,4*ue)),sigmaY:new Float32Array(J.slice(4*ue,15*ue)),corr:new Float32Array(J.slice(5*ue,6*ue)),pen:new Float32Array(J.slice(6*ue,6*ue+3))}},K.prototype.zeroState=function(){return{c:new Float32Array(this.numUnits),h:new Float32Array(this.numUnits)}},K.prototype.copyState=function(M){return{c:new Float32Array(M.c),h:new Float32Array(M.h)}},K.prototype.zeroInput=function(){return[0,0,1,0,0]},K.prototype.sample=function(M){var V=A.sampleSoftmax(M.pi),$=M.muX[V],W=M.muY[V],te=M.sigmaX[V],F=M.sigmaY[V],ue=M.corr[V],se=[0,0,0];se[A.sampleSoftmax(M.pen)]=1;var J=A.birandn($,W,te,F,ue);return[J[0]*this.scaleFactor,J[1]*this.scaleFactor,se[0],se[1],se[2]]},K.prototype.simplifyLine=function(M,V){return A.simplifyLine(M,V)},K.prototype.simplifyLines=function(M,V){return A.simplifyLines(M,V)},K.prototype.linesToStroke=function(M){return A.linesToStrokes(M)},K.prototype.lineToStroke=function(M,V){return A.lineToStroke(M,V)},K}();m.SketchRNN=X},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0});var g=o(256);m.SketchRNN=g.SketchRNN},function(j,m){j.exports=function(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o},j.exports.__esModule=!0,j.exports.default=j.exports},function(j,m){function o(g,z){return j.exports=o=Object.setPrototypeOf||function(I,A){return I.__proto__=A,I},j.exports.__esModule=!0,j.exports.default=j.exports,o(g,z)}j.exports=o,j.exports.__esModule=!0,j.exports.default=j.exports},function(j,m){j.exports=function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)},j.exports.__esModule=!0,j.exports.default=j.exports},function(j,m){j.exports=function(o,g){var z=o==null?null:typeof Symbol!="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(z!=null){var I,A,X=[],K=!0,M=!1;try{for(z=z.call(o);!(K=(I=z.next()).done)&&(X.push(I.value),!g||X.length!==g);K=!0);}catch(V){M=!0,A=V}finally{try{K||z.return==null||z.return()}finally{if(M)throw A}}return X}},j.exports.__esModule=!0,j.exports.default=j.exports},function(j,m){j.exports=function(o){if(Array.isArray(o))return o},j.exports.__esModule=!0,j.exports.default=j.exports},function(j,m,o){j.exports=function(g){return typeof g=="object"&&g.isAxiosError===!0}},function(j,m,o){j.exports=function(g){return function(z){return g.apply(null,z)}}},function(j,m,o){var g=o(188);function z(I){if(typeof I!="function")throw new TypeError("executor must be a function.");var A;this.promise=new Promise(function(K){A=K});var X=this;I(function(K){X.reason||(X.reason=new g(K),A(X.reason))})}z.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},z.source=function(){var I;return{token:new z(function(A){I=A}),cancel:I}},j.exports=z},function(j){j.exports={name:"axios",version:"0.21.4",description:"Promise based HTTP client for the browser and node.js",main:"index.js",scripts:{test:"grunt test",start:"node ./sandbox/server.js",build:"NODE_ENV=production grunt build",preversion:"npm test",version:"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json",postversion:"git push && git push --tags",examples:"node ./examples/server.js",coveralls:"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js",fix:"eslint --fix lib/**/*.js"},repository:{type:"git",url:"https://github.com/axios/axios.git"},keywords:["xhr","http","ajax","promise","node"],author:"Matt Zabriskie",license:"MIT",bugs:{url:"https://github.com/axios/axios/issues"},homepage:"https://axios-http.com",devDependencies:{coveralls:"^3.0.0","es6-promise":"^4.2.4",grunt:"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1",karma:"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2",minimist:"^1.2.0",mocha:"^8.2.1",sinon:"^4.5.0","terser-webpack-plugin":"^4.2.3",typescript:"^4.0.5","url-search-params":"^0.10.0",webpack:"^4.44.2","webpack-dev-server":"^3.11.0"},browser:{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},jsdelivr:"dist/axios.min.js",unpkg:"dist/axios.min.js",typings:"./index.d.ts",dependencies:{"follow-redirects":"^1.14.0"},bundlesize:[{path:"./dist/axios.min.js",threshold:"5kB"}],_resolved:"https://registry.npmjs.org/axios/-/axios-0.21.4.tgz",_integrity:"sha512-ut5vewkiu8jjGBdqpM44XxjuCjq9LAKeHVmoVfHVzy8eHgxxq8SbAVQNovDA8mVi05kP0Ea/n/UzcSHcTJQfNg==",_from:"axios@0.21.4"}},function(j,m,o){var g=o(266),z={};["object","boolean","number","function","string","symbol"].forEach(function(K,M){z[K]=function(V){return typeof V===K||"a"+(M<1?"n ":" ")+K}});var I={},A=g.version.split(".");function X(K,M){for(var V=M?M.split("."):A,$=K.split("."),W=0;W<3;W++){if(V[W]>$[W])return!0;if(V[W]<$[W])return!1}return!1}z.transitional=function(K,M,V){var $=M&&X(M);function W(te,F){return"[Axios v"+g.version+"] Transitional option '"+te+"'"+F+(V?". "+V:"")}return function(te,F,ue){if(K===!1)throw new Error(W(F," has been removed in "+M));return $&&!I[F]&&(I[F]=!0,console.warn(W(F," has been deprecated since v"+M+" and will be removed in the near future"))),!K||K(te,F,ue)}},j.exports={isOlderVersion:X,assertOptions:function(K,M,V){if(typeof K!="object")throw new TypeError("options must be an object");for(var $=Object.keys(K),W=$.length;W-- >0;){var te=$[W],F=M[te];if(F){var ue=K[te],se=ue===void 0||F(ue,te,K);if(se!==!0)throw new TypeError("option "+te+" must be "+se)}else if(V!==!0)throw Error("Unknown option "+te)}},validators:z}},function(j,m,o){var g=o(36);j.exports=g.isStandardBrowserEnv()?function(){var z,I=/(msie|trident)/i.test(navigator.userAgent),A=document.createElement("a");function X(K){var M=K;return I&&(A.setAttribute("href",M),M=A.href),A.setAttribute("href",M),{href:A.href,protocol:A.protocol?A.protocol.replace(/:$/,""):"",host:A.host,search:A.search?A.search.replace(/^\?/,""):"",hash:A.hash?A.hash.replace(/^#/,""):"",hostname:A.hostname,port:A.port,pathname:A.pathname.charAt(0)==="/"?A.pathname:"/"+A.pathname}}return z=X(window.location.href),function(K){var M=g.isString(K)?X(K):K;return M.protocol===z.protocol&&M.host===z.host}}():function(){return!0}},function(j,m,o){var g=o(36),z=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];j.exports=function(I){var A,X,K,M={};return I&&g.forEach(I.split(`
`),function(V){if(K=V.indexOf(":"),A=g.trim(V.substr(0,K)).toLowerCase(),X=g.trim(V.substr(K+1)),A){if(M[A]&&z.indexOf(A)>=0)return;M[A]=A==="set-cookie"?(M[A]?M[A]:[]).concat([X]):M[A]?M[A]+", "+X:X}}),M}},function(j,m,o){j.exports=function(g,z){return z?g.replace(/\/+$/,"")+"/"+z.replace(/^\/+/,""):g}},function(j,m,o){j.exports=function(g){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(g)}},function(j,m,o){var g=o(271),z=o(270);j.exports=function(I,A){return I&&!g(A)?z(I,A):A}},function(j,m,o){var g=o(36);j.exports=g.isStandardBrowserEnv()?{write:function(z,I,A,X,K,M){var V=[];V.push(z+"="+encodeURIComponent(I)),g.isNumber(A)&&V.push("expires="+new Date(A).toGMTString()),g.isString(X)&&V.push("path="+X),g.isString(K)&&V.push("domain="+K),M===!0&&V.push("secure"),document.cookie=V.join("; ")},read:function(z){var I=document.cookie.match(new RegExp("(^|;\\s*)("+z+")=([^;]*)"));return I?decodeURIComponent(I[3]):null},remove:function(z){this.write(z,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(j,m,o){var g=o(191);j.exports=function(z,I,A){var X=A.config.validateStatus;A.status&&X&&!X(A.status)?I(g("Request failed with status code "+A.status,A.config,null,A.request,A)):z(A)}},function(j,m,o){var g=o(36);j.exports=function(z,I){g.forEach(z,function(A,X){X!==I&&X.toUpperCase()===I.toUpperCase()&&(z[I]=A,delete z[X])})}},function(j,m,o){var g=o(36),z=o(136);j.exports=function(I,A,X){var K=this||z;return g.forEach(X,function(M){I=M.call(K,I,A)}),I}},function(j,m,o){var g=o(36),z=o(276),I=o(190),A=o(136);function X(K){K.cancelToken&&K.cancelToken.throwIfRequested()}j.exports=function(K){return X(K),K.headers=K.headers||{},K.data=z.call(K,K.data,K.headers,K.transformRequest),K.headers=g.merge(K.headers.common||{},K.headers[K.method]||{},K.headers),g.forEach(["delete","get","head","post","put","patch","common"],function(M){delete K.headers[M]}),(K.adapter||A.adapter)(K).then(function(M){return X(K),M.data=z.call(K,M.data,M.headers,K.transformResponse),M},function(M){return I(M)||(X(K),M&&M.response&&(M.response.data=z.call(K,M.response.data,M.response.headers,K.transformResponse))),Promise.reject(M)})}},function(j,m,o){var g=o(36);function z(){this.handlers=[]}z.prototype.use=function(I,A,X){return this.handlers.push({fulfilled:I,rejected:A,synchronous:!!X&&X.synchronous,runWhen:X?X.runWhen:null}),this.handlers.length-1},z.prototype.eject=function(I){this.handlers[I]&&(this.handlers[I]=null)},z.prototype.forEach=function(I){g.forEach(this.handlers,function(A){A!==null&&I(A)})},j.exports=z},function(j,m,o){var g=o(36),z=o(194),I=o(278),A=o(277),X=o(189),K=o(267),M=K.validators;function V($){this.defaults=$,this.interceptors={request:new I,response:new I}}V.prototype.request=function($){typeof $=="string"?($=arguments[1]||{}).url=arguments[0]:$=$||{},($=X(this.defaults,$)).method?$.method=$.method.toLowerCase():this.defaults.method?$.method=this.defaults.method.toLowerCase():$.method="get";var W=$.transitional;W!==void 0&&K.assertOptions(W,{silentJSONParsing:M.transitional(M.boolean,"1.0.0"),forcedJSONParsing:M.transitional(M.boolean,"1.0.0"),clarifyTimeoutError:M.transitional(M.boolean,"1.0.0")},!1);var te=[],F=!0;this.interceptors.request.forEach(function(Fe){typeof Fe.runWhen=="function"&&Fe.runWhen($)===!1||(F=F&&Fe.synchronous,te.unshift(Fe.fulfilled,Fe.rejected))});var ue,se=[];if(this.interceptors.response.forEach(function(Fe){se.push(Fe.fulfilled,Fe.rejected)}),!F){var J=[A,void 0];for(Array.prototype.unshift.apply(J,te),J=J.concat(se),ue=Promise.resolve($);J.length;)ue=ue.then(J.shift(),J.shift());return ue}for(var me=$;te.length;){var pe=te.shift(),Oe=te.shift();try{me=pe(me)}catch(Fe){Oe(Fe);break}}try{ue=A(me)}catch(Fe){return Promise.reject(Fe)}for(;se.length;)ue=ue.then(se.shift(),se.shift());return ue},V.prototype.getUri=function($){return $=X(this.defaults,$),z($.url,$.params,$.paramsSerializer).replace(/^\?/,"")},g.forEach(["delete","get","head","options"],function($){V.prototype[$]=function(W,te){return this.request(X(te||{},{method:$,url:W,data:(te||{}).data}))}}),g.forEach(["post","put","patch"],function($){V.prototype[$]=function(W,te,F){return this.request(X(F||{},{method:$,url:W,data:te}))}}),j.exports=V},function(j,m,o){var g=o(36),z=o(195),I=o(279),A=o(189);function X(M){var V=new I(M),$=z(I.prototype.request,V);return g.extend($,I.prototype,V),g.extend($,V),$}var K=X(o(136));K.Axios=I,K.create=function(M){return X(A(K.defaults,M))},K.Cancel=o(188),K.CancelToken=o(265),K.isCancel=o(190),K.all=function(M){return Promise.all(M)},K.spread=o(264),K.isAxiosError=o(263),j.exports=K,j.exports.default=K},function(j,m,o){var g=function(z){var I,A=Object.prototype,X=A.hasOwnProperty,K=typeof Symbol=="function"?Symbol:{},M=K.iterator||"@@iterator",V=K.asyncIterator||"@@asyncIterator",$=K.toStringTag||"@@toStringTag";function W(Ct,Vt,En){return Object.defineProperty(Ct,Vt,{value:En,enumerable:!0,configurable:!0,writable:!0}),Ct[Vt]}try{W({},"")}catch{W=function(Vt,En,Pt){return Vt[En]=Pt}}function te(Ct,Vt,En,Pt){var Rt=Vt&&Vt.prototype instanceof Oe?Vt:Oe,Tn=Object.create(Rt.prototype),Hn=new Qe(Pt||[]);return Tn._invoke=function(tr,pn,$e){var et=ue;return function(Ke,yt){if(et===J)throw new Error("Generator is already running");if(et===me){if(Ke==="throw")throw yt;return on()}for($e.method=Ke,$e.arg=yt;;){var Dt=$e.delegate;if(Dt){var Lt=Wt(Dt,$e);if(Lt){if(Lt===pe)continue;return Lt}}if($e.method==="next")$e.sent=$e._sent=$e.arg;else if($e.method==="throw"){if(et===ue)throw et=me,$e.arg;$e.dispatchException($e.arg)}else $e.method==="return"&&$e.abrupt("return",$e.arg);et=J;var zn=F(tr,pn,$e);if(zn.type==="normal"){if(et=$e.done?me:se,zn.arg===pe)continue;return{value:zn.arg,done:$e.done}}zn.type==="throw"&&(et=me,$e.method="throw",$e.arg=zn.arg)}}}(Ct,En,Hn),Tn}function F(Ct,Vt,En){try{return{type:"normal",arg:Ct.call(Vt,En)}}catch(Pt){return{type:"throw",arg:Pt}}}z.wrap=te;var ue="suspendedStart",se="suspendedYield",J="executing",me="completed",pe={};function Oe(){}function Fe(){}function Le(){}var Ae={};W(Ae,M,function(){return this});var ft=Object.getPrototypeOf,Mt=ft&&ft(ft(fn([])));Mt&&Mt!==A&&X.call(Mt,M)&&(Ae=Mt);var Xt=Le.prototype=Oe.prototype=Object.create(Ae);function tn(Ct){["next","throw","return"].forEach(function(Vt){W(Ct,Vt,function(En){return this._invoke(Vt,En)})})}function Ce(Ct,Vt){var En;this._invoke=function(Pt,Rt){function Tn(){return new Vt(function(Hn,tr){(function pn($e,et,Ke,yt){var Dt=F(Ct[$e],Ct,et);if(Dt.type!=="throw"){var Lt=Dt.arg,zn=Lt.value;return zn&&typeof zn=="object"&&X.call(zn,"__await")?Vt.resolve(zn.__await).then(function(Cn){pn("next",Cn,Ke,yt)},function(Cn){pn("throw",Cn,Ke,yt)}):Vt.resolve(zn).then(function(Cn){Lt.value=Cn,Ke(Lt)},function(Cn){return pn("throw",Cn,Ke,yt)})}yt(Dt.arg)})(Pt,Rt,Hn,tr)})}return En=En?En.then(Tn,Tn):Tn()}}function Wt(Ct,Vt){var En=Ct.iterator[Vt.method];if(En===I){if(Vt.delegate=null,Vt.method==="throw"){if(Ct.iterator.return&&(Vt.method="return",Vt.arg=I,Wt(Ct,Vt),Vt.method==="throw"))return pe;Vt.method="throw",Vt.arg=new TypeError("The iterator does not provide a 'throw' method")}return pe}var Pt=F(En,Ct.iterator,Vt.arg);if(Pt.type==="throw")return Vt.method="throw",Vt.arg=Pt.arg,Vt.delegate=null,pe;var Rt=Pt.arg;return Rt?Rt.done?(Vt[Ct.resultName]=Rt.value,Vt.next=Ct.nextLoc,Vt.method!=="return"&&(Vt.method="next",Vt.arg=I),Vt.delegate=null,pe):Rt:(Vt.method="throw",Vt.arg=new TypeError("iterator result is not an object"),Vt.delegate=null,pe)}function en(Ct){var Vt={tryLoc:Ct[0]};1 in Ct&&(Vt.catchLoc=Ct[1]),2 in Ct&&(Vt.finallyLoc=Ct[2],Vt.afterLoc=Ct[3]),this.tryEntries.push(Vt)}function Ut(Ct){var Vt=Ct.completion||{};Vt.type="normal",delete Vt.arg,Ct.completion=Vt}function Qe(Ct){this.tryEntries=[{tryLoc:"root"}],Ct.forEach(en,this),this.reset(!0)}function fn(Ct){if(Ct){var Vt=Ct[M];if(Vt)return Vt.call(Ct);if(typeof Ct.next=="function")return Ct;if(!isNaN(Ct.length)){var En=-1,Pt=function Rt(){for(;++En<Ct.length;)if(X.call(Ct,En))return Rt.value=Ct[En],Rt.done=!1,Rt;return Rt.value=I,Rt.done=!0,Rt};return Pt.next=Pt}}return{next:on}}function on(){return{value:I,done:!0}}return Fe.prototype=Le,W(Xt,"constructor",Le),W(Le,"constructor",Fe),Fe.displayName=W(Le,$,"GeneratorFunction"),z.isGeneratorFunction=function(Ct){var Vt=typeof Ct=="function"&&Ct.constructor;return!!Vt&&(Vt===Fe||(Vt.displayName||Vt.name)==="GeneratorFunction")},z.mark=function(Ct){return Object.setPrototypeOf?Object.setPrototypeOf(Ct,Le):(Ct.__proto__=Le,W(Ct,$,"GeneratorFunction")),Ct.prototype=Object.create(Xt),Ct},z.awrap=function(Ct){return{__await:Ct}},tn(Ce.prototype),W(Ce.prototype,V,function(){return this}),z.AsyncIterator=Ce,z.async=function(Ct,Vt,En,Pt,Rt){Rt===void 0&&(Rt=Promise);var Tn=new Ce(te(Ct,Vt,En,Pt),Rt);return z.isGeneratorFunction(Vt)?Tn:Tn.next().then(function(Hn){return Hn.done?Hn.value:Tn.next()})},tn(Xt),W(Xt,$,"Generator"),W(Xt,M,function(){return this}),W(Xt,"toString",function(){return"[object Generator]"}),z.keys=function(Ct){var Vt=[];for(var En in Ct)Vt.push(En);return Vt.reverse(),function Pt(){for(;Vt.length;){var Rt=Vt.pop();if(Rt in Ct)return Pt.value=Rt,Pt.done=!1,Pt}return Pt.done=!0,Pt}},z.values=fn,Qe.prototype={constructor:Qe,reset:function(Ct){if(this.prev=0,this.next=0,this.sent=this._sent=I,this.done=!1,this.delegate=null,this.method="next",this.arg=I,this.tryEntries.forEach(Ut),!Ct)for(var Vt in this)Vt.charAt(0)==="t"&&X.call(this,Vt)&&!isNaN(+Vt.slice(1))&&(this[Vt]=I)},stop:function(){this.done=!0;var Ct=this.tryEntries[0].completion;if(Ct.type==="throw")throw Ct.arg;return this.rval},dispatchException:function(Ct){if(this.done)throw Ct;var Vt=this;function En(pn,$e){return Tn.type="throw",Tn.arg=Ct,Vt.next=pn,$e&&(Vt.method="next",Vt.arg=I),!!$e}for(var Pt=this.tryEntries.length-1;Pt>=0;--Pt){var Rt=this.tryEntries[Pt],Tn=Rt.completion;if(Rt.tryLoc==="root")return En("end");if(Rt.tryLoc<=this.prev){var Hn=X.call(Rt,"catchLoc"),tr=X.call(Rt,"finallyLoc");if(Hn&&tr){if(this.prev<Rt.catchLoc)return En(Rt.catchLoc,!0);if(this.prev<Rt.finallyLoc)return En(Rt.finallyLoc)}else if(Hn){if(this.prev<Rt.catchLoc)return En(Rt.catchLoc,!0)}else{if(!tr)throw new Error("try statement without catch or finally");if(this.prev<Rt.finallyLoc)return En(Rt.finallyLoc)}}}},abrupt:function(Ct,Vt){for(var En=this.tryEntries.length-1;En>=0;--En){var Pt=this.tryEntries[En];if(Pt.tryLoc<=this.prev&&X.call(Pt,"finallyLoc")&&this.prev<Pt.finallyLoc){var Rt=Pt;break}}Rt&&(Ct==="break"||Ct==="continue")&&Rt.tryLoc<=Vt&&Vt<=Rt.finallyLoc&&(Rt=null);var Tn=Rt?Rt.completion:{};return Tn.type=Ct,Tn.arg=Vt,Rt?(this.method="next",this.next=Rt.finallyLoc,pe):this.complete(Tn)},complete:function(Ct,Vt){if(Ct.type==="throw")throw Ct.arg;return Ct.type==="break"||Ct.type==="continue"?this.next=Ct.arg:Ct.type==="return"?(this.rval=this.arg=Ct.arg,this.method="return",this.next="end"):Ct.type==="normal"&&Vt&&(this.next=Vt),pe},finish:function(Ct){for(var Vt=this.tryEntries.length-1;Vt>=0;--Vt){var En=this.tryEntries[Vt];if(En.finallyLoc===Ct)return this.complete(En.completion,En.afterLoc),Ut(En),pe}},catch:function(Ct){for(var Vt=this.tryEntries.length-1;Vt>=0;--Vt){var En=this.tryEntries[Vt];if(En.tryLoc===Ct){var Pt=En.completion;if(Pt.type==="throw"){var Rt=Pt.arg;Ut(En)}return Rt}}throw new Error("illegal catch attempt")},delegateYield:function(Ct,Vt,En){return this.delegate={iterator:fn(Ct),resultName:Vt,nextLoc:En},this.method==="next"&&(this.arg=I),pe}},z}(j.exports);try{regeneratorRuntime=g}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=g:Function("r","regeneratorRuntime = r")(g)}},function(j,m,o){/** @license See the LICENSE file. */Object.defineProperty(m,"__esModule",{value:!0}),m.version="1.5.1"},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var g=this&&this.__awaiter||function(X,K,M,V){return new(M||(M=Promise))(function($,W){function te(se){try{ue(V.next(se))}catch(J){W(J)}}function F(se){try{ue(V.throw(se))}catch(J){W(J)}}function ue(se){se.done?$(se.value):new M(function(J){J(se.value)}).then(te,F)}ue((V=V.apply(X,K||[])).next())})};Object.defineProperty(m,"__esModule",{value:!0});const z=o(137),I=o(46),A=o(110);m.valuesDistribution=function(X,K){return g(this,void 0,void 0,function*(){const M=I.getDrawArea(X),V=yield A.tensorStats(K),$=yield K.data();z.histogram(M,$,{height:150,stats:V})})}},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var g=this&&this.__awaiter||function(A,X,K,M){return new(K||(K=Promise))(function(V,$){function W(ue){try{F(M.next(ue))}catch(se){$(se)}}function te(ue){try{F(M.throw(ue))}catch(se){$(se)}}function F(ue){ue.done?V(ue.value):new K(function(se){se(ue.value)}).then(W,te)}F((M=M.apply(A,X||[])).next())})};Object.defineProperty(m,"__esModule",{value:!0});const z=o(46),I=o(109);m.perClassAccuracy=function(A,X,K){return g(this,void 0,void 0,function*(){const M=z.getDrawArea(A),V=[];for(let $=0;$<X.length;$++){const W=K?K[$]:$.toString(),te=X[$];V.push([W,te.accuracy,te.count])}return I.table(M,{headers:["Class","Accuracy","# Samples"],values:V})})}},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var g=this&&this.__awaiter||function($,W,te,F){return new(te||(te=Promise))(function(ue,se){function J(Oe){try{pe(F.next(Oe))}catch(Fe){se(Fe)}}function me(Oe){try{pe(F.throw(Oe))}catch(Fe){se(Fe)}}function pe(Oe){Oe.done?ue(Oe.value):new te(function(Fe){Fe(Oe.value)}).then(J,me)}pe((F=F.apply($,W||[])).next())})};Object.defineProperty(m,"__esModule",{value:!0});const z=o(137),I=o(46),A=o(109),X=o(64),K=o(110);function M($){let W;return Array.isArray($.outputShape[0])?W=`[${$.outputShape.map(te=>V(te)).join(", ")}]`:W=V($.outputShape),{name:$.name,trainable:$.trainable,parameters:$.countParams(),outputShape:W}}function V($){const W=$.slice();return W.length===0?"Scalar":(W[0]===null&&(W[0]="batch"),`[${W.join(",")}]`)}m.modelSummary=function($,W){return g(this,void 0,void 0,function*(){const te=I.getDrawArea($),F=function(ue){return{layers:ue.layers.map(M)}}(W).layers.map(ue=>[ue.name,ue.outputShape,ue.parameters,ue.trainable]);A.table(te,{headers:["Layer Name","Output Shape","# Of Params","Trainable"],values:F})})},m.layer=function($,W){return g(this,void 0,void 0,function*(){const te=I.getDrawArea($),F=yield function(pe){return g(this,void 0,void 0,function*(){const Oe=pe.getWeights(),Fe=pe.weights,Le=Oe.map(K.tensorStats),Ae=yield Promise.all(Le),ft=Oe.map(Mt=>Mt.shape);return Oe.map((Mt,Xt)=>({name:Fe[Xt].name,stats:Ae[Xt],shape:V(ft[Xt]),weight:Mt}))})}(W),ue=X.subSurface(te,"layer-weights-info"),se=F.map(pe=>[pe.name,pe.shape,pe.stats.min,pe.stats.max,pe.weight.size,pe.stats.numZeros,pe.stats.numNans,pe.stats.numInfs]);A.table(ue,{headers:["Weight Name","Shape","Min","Max","# Params","# Zeros","# NaNs","# Infinity"],values:se});const J=X.subSurface(te,"select-layer"),me=X.subSurface(te,"param-distribution");(function(pe,Oe,Fe){const Le=`<div><button>Show Values Distribution for:</button>${`
    <select>
      ${pe.map(Mt=>`<option value=${Mt}>${Mt}</option>`)}
    </select>
  `}</div>`;Oe.innerHTML=Le;const Ae=Oe.querySelector("button"),ft=Oe.querySelector("select");Ae.addEventListener("click",()=>{Fe(ft.selectedOptions[0].label)})})(F.map(pe=>pe.name),J,pe=>g(this,void 0,void 0,function*(){const Oe=yield F.filter(Fe=>Fe.name===pe)[0].weight.data();z.histogram(me,Oe,{height:150,width:460,stats:!1})}))})}},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var g=this&&this.__awaiter||function($,W,te,F){return new(te||(te=Promise))(function(ue,se){function J(Oe){try{pe(F.next(Oe))}catch(Fe){se(Fe)}}function me(Oe){try{pe(F.throw(Oe))}catch(Fe){se(Fe)}}function pe(Oe){Oe.done?ue(Oe.value):new te(function(Fe){Fe(Oe.value)}).then(J,me)}pe((F=F.apply($,W||[])).next())})};Object.defineProperty(m,"__esModule",{value:!0});const z=o(196),I=o(46),A=o(64);function X($,W,te,F={}){return g(this,void 0,void 0,function*(){const ue=I.getDrawArea($),se={};for(const Oe of te)if(/val_/.test(Oe)){const Fe=Oe.replace("val_","");K(se,Fe);const Le=M(W,Oe,te.indexOf(Oe));se[Fe].series.push(Oe),se[Fe].values.push(Le)}else{const Fe=M(W,Oe,te.indexOf(Oe));K(se,Oe),se[Oe].series.push(Oe),se[Oe].values.push(Fe)}const J=Object.keys(se),me=Object.assign({},{xLabel:"Iteration",yLabel:"Value"},F),pe=[];for(const Oe of J){const Fe=A.subSurface(ue,Oe),Le=se[Oe].series,Ae=se[Oe].values;Le.every(Mt=>Boolean(Mt.match("acc")))&&(me.zoomToFitAccuracy?me.zoomToFit=!0:(me.yAxisDomain=[0,1],delete me.zoomToFit));const ft=z.linechart(Fe,{values:Ae,series:Le},me);pe.push(ft)}yield Promise.all(pe)})}function K($,W){$[W]==null&&($[W]={series:[],values:[]})}function M($,W,te){if(Array.isArray($)){const F=Array.isArray($[0])?$[te]:$,ue=[];for(let se=0;se<F.length;se++){const J=F[se];ue.push({x:se,y:J[W]})}return ue}return $.history[W].map((F,ue)=>({x:ue,y:F}))}function V($,W,te){return $[W]==null&&($[W]={}),$[W][te]==null&&($[W][te]=[]),$[W][te]}m.history=X,m.fitCallbacks=function($,W,te={}){const F={},ue=te.callbacks||["onEpochEnd","onBatchEnd"],se=I.getDrawArea($),J=Object.assign({},te);delete J.callbacks;const me={};return ue.forEach(pe=>{me[pe]=function(Oe){return(Fe,Le)=>g(this,void 0,void 0,function*(){/batch/i.test(Oe)?J.xLabel="Batch":/epoch/i.test(Oe)&&(J.xLabel="Epoch");const Ae=[],ft=[];for(const Mt of W)if(Le[Mt]!=null){ft.push(Mt);const Xt=V(F,Oe,Mt);Xt.push({[Mt]:Le[Mt]}),Ae.push(Xt)}X(A.subSurface(se,Oe,{title:Oe}),Ae,ft,J),yield I.nextFrame()})}(pe)}),me}},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var g=this&&this.__awaiter||function(V,$,W,te){return new(W||(W=Promise))(function(F,ue){function se(pe){try{me(te.next(pe))}catch(Oe){ue(Oe)}}function J(pe){try{me(te.throw(pe))}catch(Oe){ue(Oe)}}function me(pe){pe.done?F(pe.value):new W(function(Oe){Oe(pe.value)}).then(se,J)}me((te=te.apply(V,$||[])).next())})},z=this&&this.__importDefault||function(V){return V&&V.__esModule?V:{default:V}};Object.defineProperty(m,"__esModule",{value:!0});const I=z(o(88)),A=o(64),X=o(111),K=o(46);m.scatterplot=function(V,$,W={}){return g(this,void 0,void 0,function*(){let te=$.values;const F=$.series==null?[]:$.series,ue=[];(te=Array.isArray(te[0])?te:[te]).forEach((pe,Oe)=>{const Fe=F[Oe]!=null?F[Oe]:`Series ${Oe+1}`,Le=pe.map(Ae=>Object.assign({},Ae,{series:Fe}));ue.push(...Le)}),W.seriesColors!=null&&X.assert(W.seriesColors.length===te.length,"Must have an equal number of series colors as there are data series");const se=K.getDrawArea(V),J=Object.assign({},M,W),me={width:J.width||A.getDefaultWidth(se),height:J.height||A.getDefaultHeight(se),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:J.fontSize,titleFontSize:J.fontSize},text:{fontSize:J.fontSize},legend:{labelFontSize:J.fontSize,titleFontSize:J.fontSize}},data:{values:ue},mark:{type:"point",clip:!0,tooltip:{content:"data"}},encoding:{x:{field:"x",type:J.xType,title:J.xLabel,scale:J.zoomToFit?{zero:!1}:J.xAxisDomain!=null?{domain:J.xAxisDomain}:void 0},y:{field:"y",type:J.yType,title:J.yLabel,scale:J.zoomToFit?{zero:!1}:J.yAxisDomain!=null?{domain:J.yAxisDomain}:void 0},color:{field:"series",type:"nominal",scale:{range:J.seriesColors}},shape:{field:"series",type:"nominal"}}};return yield I.default(se,me,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()})};const M={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var g=this&&this.__awaiter||function(te,F,ue,se){return new(ue||(ue=Promise))(function(J,me){function pe(Le){try{Fe(se.next(Le))}catch(Ae){me(Ae)}}function Oe(Le){try{Fe(se.throw(Le))}catch(Ae){me(Ae)}}function Fe(Le){Le.done?J(Le.value):new ue(function(Ae){Ae(Le.value)}).then(pe,Oe)}Fe((se=se.apply(te,F||[])).next())})},z=this&&this.__importStar||function(te){if(te&&te.__esModule)return te;var F={};if(te!=null)for(var ue in te)Object.hasOwnProperty.call(te,ue)&&(F[ue]=te[ue]);return F.default=te,F},I=this&&this.__importDefault||function(te){return te&&te.__esModule?te:{default:te}};Object.defineProperty(m,"__esModule",{value:!0});const A=z(o(0)),X=I(o(88)),K=o(64),M=o(111),V=o(46);function $(te,F,ue){const se=te instanceof A.Tensor?te.shape:[te.length,te[0].length];ue===0?M.assert(se[0]===F.length,`Length of xTickLabels (${F.length}) must match number of rows (${se[0]})`):ue===1&&M.assert(se[1]===F.length,`Length of yTickLabels (${F.length}) must match number of columns (${se[1]})`)}m.heatmap=function(te,F,ue={}){return g(this,void 0,void 0,function*(){const se=Object.assign({},W,ue),J=V.getDrawArea(te);let me=F.values;se.rowMajor&&(me=yield function(Xt){return g(this,void 0,void 0,function*(){let tn,Ce;Xt instanceof A.Tensor?(tn=Xt.shape,Ce=Xt.transpose()):(tn=[Xt.length,Xt[0].length],Ce=A.tidy(()=>A.tensor2d(Xt).transpose())),M.assert(Ce.rank===2,"Input to renderHeatmap must be a 2d array or Tensor2d");const Wt=yield Ce.array();Ce.dispose();const en=[Wt.length,Wt[0].length];return M.assert(tn[0]===en[1]&&tn[1]===en[0],`Unexpected transposed shape. Original ${tn} : Transposed ${en}`),Wt})}(F.values));const{xTickLabels:pe,yTickLabels:Oe}=F;pe!=null&&$(me,pe,0),Oe!=null&&$(me,Oe,1);const Fe=[];if(me instanceof A.Tensor){M.assert(me.rank===2,"Input to renderHeatmap must be a 2d array or Tensor2d");const Xt=yield me.data(),[tn,Ce]=me.shape;for(let Wt=0;Wt<tn;Wt++){const en=pe?`${pe[Wt]}@tfidx@${Wt}`:Wt;for(let Ut=0;Ut<Ce;Ut++){const Qe=Oe?`${Oe[Ut]}@tfidx@${Ut}`:Ut,fn=Xt[Wt*Ce+Ut];Fe.push({x:en,y:Qe,value:fn})}}}else{const Xt=me;for(let tn=0;tn<Xt.length;tn++){const Ce=pe?`${pe[tn]}@tfidx@${tn}`:tn;for(let Wt=0;Wt<Xt[tn].length;Wt++){const en=Oe?`${Oe[Wt]}@tfidx@${Wt}`:Wt,Ut=Xt[tn][Wt];Fe.push({x:Ce,y:en,value:Ut})}}}const Le={actions:!1,mode:"vega-lite",defaultStyle:!1},Ae={width:se.width||K.getDefaultWidth(J),height:se.height||K.getDefaultHeight(J),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:se.fontSize,titleFontSize:se.fontSize},text:{fontSize:se.fontSize},legend:{labelFontSize:se.fontSize,titleFontSize:se.fontSize},scale:{bandPaddingInner:0,bandPaddingOuter:0}},data:{values:Fe},mark:{type:"rect",tooltip:!0},encoding:{x:{field:"x",type:se.xType,title:se.xLabel,sort:!1},y:{field:"y",type:se.yType,title:se.yLabel,sort:!1},fill:{field:"value",type:"quantitative"}}},ft=new RegExp("@tfidx@\\d+$");let Mt;switch(pe&&(Ae.encoding.x.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),Oe&&(Ae.encoding.y.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),(pe||Oe)&&(Le.tooltip={sanitize:Xt=>String(Xt).replace(ft,"")}),se.colorMap){case"blues":Mt=["#f7fbff","#4292c6"];break;case"greyscale":Mt=["#000000","#ffffff"];break;case"viridis":default:Mt="viridis"}if(Mt!=="viridis"&&(Ae.encoding.fill.scale={range:Mt}),se.domain){const Xt=Ae.encoding.fill;Xt.scale!=null?Xt.scale=Object.assign({},Xt.scale,{domain:se.domain}):Xt.scale={domain:se.domain}}yield X.default(J,Ae,Le)})};const W={xLabel:null,yLabel:null,xType:"ordinal",yType:"ordinal",colorMap:"viridis",fontSize:12,domain:null,rowMajor:!1}},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var g=this&&this.__awaiter||function(M,V,$,W){return new($||($=Promise))(function(te,F){function ue(me){try{J(W.next(me))}catch(pe){F(pe)}}function se(me){try{J(W.throw(me))}catch(pe){F(pe)}}function J(me){me.done?te(me.value):new $(function(pe){pe(me.value)}).then(ue,se)}J((W=W.apply(M,V||[])).next())})},z=this&&this.__importDefault||function(M){return M&&M.__esModule?M:{default:M}};Object.defineProperty(m,"__esModule",{value:!0});const I=z(o(88)),A=o(64),X=o(46);m.confusionMatrix=function(M,V,$={}){return g(this,void 0,void 0,function*(){const W=Object.assign({},K,$),te=X.getDrawArea(M),F=[],ue=V.values,se=V.tickLabels||[],J=se.length===0;let me=!0;for(let Fe=0;Fe<ue.length;Fe++){const Le=J?`Class ${Fe}`:se[Fe];J&&se.push(Le);for(let Ae=0;Ae<ue[Fe].length;Ae++){const ft=J?`Class ${Ae}`:se[Ae],Mt=ue[Fe][Ae];Fe!==Ae||W.shadeDiagonal?(F.push({label:Le,prediction:ft,count:Mt,scaleCount:Mt}),Mt!==0&&(me=!1)):F.push({label:Le,prediction:ft,count:Mt,noFill:!0})}}if(!W.shadeDiagonal&&me)for(const Fe of F)Fe.noFill===!0&&(Fe.noFill=!1,Fe.scaleCount=Fe.count);const pe={width:W.width||A.getDefaultWidth(te),height:W.height||A.getDefaultHeight(te),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:W.fontSize,titleFontSize:W.fontSize},text:{fontSize:W.fontSize},legend:{labelFontSize:W.fontSize,titleFontSize:W.fontSize}},data:{values:F},encoding:{x:{field:"prediction",type:"ordinal",title:W.xLabel||"prediction",scale:{domain:se}},y:{field:"label",type:"ordinal",title:W.yLabel||"label",scale:{domain:se}}},layer:[{transform:[{filter:"datum.noFill != true"}],mark:{type:"rect"},encoding:{color:{field:"scaleCount",type:"quantitative",scale:{range:W.colorMap}},tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}]};W.shadeDiagonal===!1&&pe.layer.push({transform:[{filter:"datum.noFill == true"}],mark:{type:"rect",fill:"white"},encoding:{tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}),W.showTextOverlay&&pe.layer.push({mark:{type:"text",baseline:"middle"},encoding:{text:{field:"count",type:"nominal"}}});const Oe=typeof W.colorMap=="string"?{scheme:W.colorMap}:W.colorMap;pe.layer[0].encoding.color.scale.range=Oe,yield I.default(te,pe,{actions:!1,mode:"vega-lite",defaultStyle:!1})})};const K={xLabel:null,yLabel:null,xType:"nominal",yType:"nominal",shadeDiagonal:!0,fontSize:12,showTextOverlay:!0,height:400,colorMap:["#f7fbff","#4292c6"]}},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});const g=o(138),z=o(102);m.Tabs=class extends g.Component{render(){const{tabNames:A,activeTab:X,handleClick:K}=this.props,M=A.length>0?A.map($=>g.h(I,{key:$,id:$,handleClick:K,isActive:$===X},$)):null,V=z.css({overflowX:"scroll",overflowY:"hidden",whiteSpace:"nowrap",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"#eee",paddingBottom:"1rem",marginTop:"1rem"});return g.h("div",{className:`${V} visor-tabs`},M)}};class I extends g.Component{render(){const{children:X,isActive:K,handleClick:M,id:V}=this.props,$=z.css({borderBottomColor:K?"#357EDD":"#AAAAAA",borderBottomWidth:"1px",borderBottomStyle:"solid",cursor:"pointer",":hover":{color:"#357EDD"},display:"inline-block",marginRight:"1rem",padding:".5rem",fontSize:"1rem",fontWeight:"bold"});return g.h("a",{className:`${$} tf-tab`,"data-isactive":K,onClick:()=>M(V)},X)}}},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});const g=o(138),z=o(102);class I extends g.Component{componentDidMount(){const{name:X,tab:K}=this.props;this.props.registerSurface(X,K,this)}componentDidUpdate(){return!1}render(){const{name:X,visible:K,styles:M}=this.props,V=Object.assign({},I.defaultStyles,M),{width:$,height:W}=V;let{maxHeight:te,maxWidth:F}=V;te=W===I.defaultStyles.height?te:W,F=$===I.defaultStyles.width?F:$;const ue=z.css({display:K?"block":"none",backgroundColor:"white",marginTop:"10px",marginBottom:"10px",boxShadow:"0 0 6px -3px #777",padding:"10px !important",height:W,width:$,maxHeight:te,maxWidth:F,overflow:"auto"}),se=z.css({backgroundColor:"white",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",marginBottom:"20px",fontWeight:"600",textAlign:"center"}),J=z.css({boxSizing:"border-box"});return g.h("div",{className:`${ue} tf-surface`,ref:me=>this.container=me,"data-visible":K},g.h("div",{className:`${se} tf-label`,ref:me=>this.label=me},X),g.h("div",{className:`${J} tf-draw-area`,ref:me=>this.drawArea=me}))}}I.defaultStyles={maxWidth:"550px",maxHeight:"580px",height:"auto",width:"auto"},m.SurfaceComponent=I},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});const g=o(138),z=o(102),I=o(291),A=o(290);class X extends g.Component{static render(V,$,W){return g.render(g.h(X,Object.assign({},W)),V,$)}constructor(V){super(V),this.surfaces=new Map;const $=V.startOpen==null||V.startOpen;this.state={isOpen:$,isFullscreen:!1,activeTab:null,tabs:new Set},this.keyHandler=this.keyHandler.bind(this)}close(){this.setState({isOpen:!1})}open(){this.setState({isOpen:!0})}toggle(){this.setState({isOpen:!this.state.isOpen})}toggleFullScreen(){this.setState({isFullscreen:!this.state.isFullscreen})}isOpen(){return this.state.isOpen}isFullscreen(){return this.state.isFullscreen}getSurface(V,$){const W=this.surfaceId(V,$);let te;if(!this.surfaces.has(W))throw Error(`Surface not found with id: ${W}`);return{container:(te=this.surfaces.get(W)).container,label:te.label,drawArea:te.drawArea}}bindKeys(){document.addEventListener("keydown",this.keyHandler,!1)}unbindKeys(){document.removeEventListener("keydown",this.keyHandler)}surfaceId(V,$){return V+$}setTabs(V){const $=V.map(F=>F.tab),W=this.state.tabs;let te;for(const F of $)W.has(F)||(W.add(F),te=F);te!=null&&this.setState({tabs:W,activeTab:te})}getTabs(){return this.state.tabs}registerSurface(V,$,W){const te=this.surfaceId(V,$);this.surfaces.set(te,W)}keyHandler(V){V.keyCode===192&&(V.shiftKey?this.toggleFullScreen():this.toggle())}setActiveTab(V){this.setState({activeTab:V})}componentDidMount(){this.bindKeys()}componentWillMount(){this.setTabs(this.props.surfaceList)}componentWillReceiveProps(V){this.setTabs(V.surfaceList)}render(){const{isOpen:V,isFullscreen:$,activeTab:W}=this.state,{surfaceList:te}=this.props,F=Array.from(this.getTabs().values()),ue=$?"90vw":"550px",se=z.css({width:ue,height:"100%",backgroundColor:"#fafafa",boxSizing:"border-box",padding:"10px",position:"fixed",top:"0px",transition:"right 0.5s cubic-bezier(0.645, 0.045, 0.355, 1), width 0.5s cubic-bezier(0.645, 0.045, 0.355, 1)",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.12), 0 2px 5px rgba(0, 0, 0, 0.24)",overflow:"auto",fontFamily:"sans-serif",fontSize:"14px",zIndex:1e3}),J=z.css({right:"0"}),me=z.css({right:`calc(-${ue} - 10px)`}),pe=V?J:me,Oe=z.css({});return g.h("div",{className:`${se} ${pe} visor`,"data-isopen":V,"data-isfullscreen":$},g.h(K,{fullScreenHandler:this.toggleFullScreen.bind(this),closeHandler:this.close.bind(this),isFullScreen:$}),g.h(A.Tabs,{tabNames:F,activeTab:W,handleClick:this.setActiveTab.bind(this)}),g.h("div",{className:`${Oe} visor-surfaces`},te.map(Fe=>g.h(I.SurfaceComponent,{key:Fe.name+Fe.tab,name:Fe.name,tab:Fe.tab,styles:Fe.styles,registerSurface:this.registerSurface.bind(this),visible:W===Fe.tab}))))}}function K(M){const{isFullScreen:V,fullScreenHandler:$,closeHandler:W}=M,te=z.css({display:"flex",backgroundColor:"white",border:"1px solid white",padding:"6px",paddingTop:"10px",marginBottom:"10px",borderRadius:"6px",marginTop:"-16px"}),F=z.css({fontSize:".875rem",borderRadius:".25rem",paddingLeft:"1rem",paddingRight:"1rem",paddingTop:".5rem",paddingBottom:".5rem",textDecoration:"none",transition:"color .15s ease-in",color:"#111"}),ue=z.css({marginLeft:"auto"});return g.h("div",{className:`${te} visor-controls`},g.h("button",{className:`${F}`,onClick:$},V?"Minimize":"Maximize"),g.h("button",{className:`${F} ${ue}`,onClick:W},"Hide"))}m.VisorComponent=X},function(j,m,o){function g(A,X){return A.charCodeAt(X++)+(A.charCodeAt(X++)<<8)+(A.charCodeAt(X++)<<16)+(A.charCodeAt(X)<<24)}function z(A,X){return A.charCodeAt(X++)+(A.charCodeAt(X++)<<8)}function I(A,X){return(65535&(A|=0))*(X|=0)+(((A>>>16)*X&65535)<<16)|0}Object.defineProperty(m,"__esModule",{value:!0}),m.default=function(A,X){for(var K=1540483477,M=X^A.length,V=A.length,$=0;V>=4;){var W=g(A,$);W=I(W,K),W=I(W^=W>>>24,K),M=I(M,K),M^=W,$+=4,V-=4}switch(V){case 3:M^=z(A,$),M=I(M^=A.charCodeAt($+2)<<16,K);break;case 2:M=I(M^=z(A,$),K);break;case 1:M=I(M^=A.charCodeAt($),K)}return M=I(M^=M>>>13,K),(M^=M>>>15)>>>0}},function(j,m,o){o.r(m);var g=/[A-Z]/g,z=/^ms-/,I={};function A(X){return"-"+X.toLowerCase()}m.default=function(X){if(I.hasOwnProperty(X))return I[X];var K=X.replace(g,A);return I[X]=z.test(K)?"-"+K:K}},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.default=function(z){return(0,g.default)(z)};var g=function(z){return z&&z.__esModule?z:{default:z}}(o(294));j.exports=m.default},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.default=function(M,V,$,W){if(typeof V=="string"&&X.hasOwnProperty(M)){var te=function(se,J){if((0,z.default)(se))return se;for(var me=se.split(/,(?![^()]*(?:\([^()]*\))?\))/g),pe=0,Oe=me.length;pe<Oe;++pe){var Fe=me[pe],Le=[Fe];for(var Ae in J){var ft=(0,g.default)(Ae);if(Fe.indexOf(ft)>-1&&ft!=="order")for(var Mt=J[Ae],Xt=0,tn=Mt.length;Xt<tn;++Xt)Le.unshift(Fe.replace(ft,K[Mt[Xt]]+ft))}me[pe]=Le.join(",")}return me.join(",")}(V,W),F=te.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(se){return!/-moz-|-ms-/.test(se)}).join(",");if(M.indexOf("Webkit")>-1)return F;var ue=te.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(se){return!/-webkit-|-ms-/.test(se)}).join(",");return M.indexOf("Moz")>-1?ue:($["Webkit"+(0,I.default)(M)]=F,$["Moz"+(0,I.default)(M)]=ue,te)}};var g=A(o(295)),z=A(o(101)),I=A(o(199));function A(M){return M&&M.__esModule?M:{default:M}}var X={transition:!0,transitionProperty:!0,WebkitTransition:!0,WebkitTransitionProperty:!0,MozTransition:!0,MozTransitionProperty:!0},K={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-"};j.exports=m.default},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.default=function(A,X){if(z.hasOwnProperty(A)&&I.hasOwnProperty(X))return g.map(function(K){return K+X})};var g=["-webkit-","-moz-",""],z={maxHeight:!0,maxWidth:!0,width:!0,height:!0,columnWidth:!0,minWidth:!0,minHeight:!0},I={"min-content":!0,"max-content":!0,"fill-available":!0,"fit-content":!0,"contain-floats":!0};j.exports=m.default},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.default=function(g,z){if(g==="position"&&z==="sticky")return["-webkit-sticky","sticky"]},j.exports=m.default},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.default=function(I,A){if(typeof A=="string"&&!(0,g.default)(A)&&A.indexOf("image-set(")>-1)return z.map(function(X){return A.replace(/image-set\(/g,X+"image-set(")})};var g=function(I){return I&&I.__esModule?I:{default:I}}(o(101)),z=["-webkit-",""];j.exports=m.default},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.default=function(A,X){if(typeof X=="string"&&!(0,g.default)(X)&&I.test(X))return z.map(function(K){return K+X})};var g=function(A){return A&&A.__esModule?A:{default:A}}(o(101)),z=["-webkit-","-moz-",""],I=/linear-gradient|radial-gradient|repeating-linear-gradient|repeating-radial-gradient/;j.exports=m.default},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.default=function(I,A,X){I==="flexDirection"&&typeof A=="string"&&(A.indexOf("column")>-1?X.WebkitBoxOrient="vertical":X.WebkitBoxOrient="horizontal",A.indexOf("reverse")>-1?X.WebkitBoxDirection="reverse":X.WebkitBoxDirection="normal"),z.hasOwnProperty(I)&&(X[z[I]]=g[A]||A)};var g={"space-around":"justify","space-between":"justify","flex-start":"start","flex-end":"end","wrap-reverse":"multiple",wrap:"multiple"},z={alignItems:"WebkitBoxAlign",justifyContent:"WebkitBoxPack",flexWrap:"WebkitBoxLines"};j.exports=m.default},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.default=function(z,I){if(z==="display"&&g.hasOwnProperty(I))return g[I]};var g={flex:["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex","flex"],"inline-flex":["-webkit-inline-box","-moz-inline-box","-ms-inline-flexbox","-webkit-inline-flex","inline-flex"]};j.exports=m.default},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.default=function(I,A){if(typeof A=="string"&&!(0,g.default)(A)&&A.indexOf("filter(")>-1)return z.map(function(X){return A.replace(/filter\(/g,X+"filter(")})};var g=function(I){return I&&I.__esModule?I:{default:I}}(o(101)),z=["-webkit-",""];j.exports=m.default},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.default=function(I,A){if(typeof A=="string"&&!(0,g.default)(A)&&A.indexOf("cross-fade(")>-1)return z.map(function(X){return A.replace(/cross-fade\(/g,X+"cross-fade(")})};var g=function(I){return I&&I.__esModule?I:{default:I}}(o(101)),z=["-webkit-",""];j.exports=m.default},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.default=function(I,A){if(I==="cursor"&&z.hasOwnProperty(A))return g.map(function(X){return X+A})};var g=["-webkit-","-moz-",""],z={"zoom-in":!0,"zoom-out":!0,grab:!0,grabbing:!0};j.exports=m.default},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.default=function(g,z,I,A,X){for(var K=0,M=g.length;K<M;++K){var V=g[K](z,I,A,X);if(V)return V}},j.exports=m.default},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.default=function(z,I,A){if(z.hasOwnProperty(I))for(var X=z[I],K=0,M=X.length;K<M;++K)A[X[K]+(0,g.default)(I)]=A[I]};var g=function(z){return z&&z.__esModule?z:{default:z}}(o(199));j.exports=m.default},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0});var g=["Webkit"],z=["Moz"],I=["ms"],A=["Webkit","Moz"],X=["Webkit","ms"],K=["Webkit","Moz","ms"];m.default={plugins:[],prefixMap:{appearance:A,userSelect:K,textEmphasisPosition:g,textEmphasis:g,textEmphasisStyle:g,textEmphasisColor:g,boxDecorationBreak:g,clipPath:g,maskImage:g,maskMode:g,maskRepeat:g,maskPosition:g,maskClip:g,maskOrigin:g,maskSize:g,maskComposite:g,mask:g,maskBorderSource:g,maskBorderMode:g,maskBorderSlice:g,maskBorderWidth:g,maskBorderOutset:g,maskBorderRepeat:g,maskBorder:g,maskType:g,textDecorationStyle:g,textDecorationSkip:g,textDecorationLine:g,textDecorationColor:g,filter:g,fontFeatureSettings:g,breakAfter:K,breakBefore:K,breakInside:K,columnCount:A,columnFill:A,columnGap:A,columnRule:A,columnRuleColor:A,columnRuleStyle:A,columnRuleWidth:A,columns:A,columnSpan:A,columnWidth:A,writingMode:X,flex:g,flexBasis:g,flexDirection:g,flexGrow:g,flexFlow:g,flexShrink:g,flexWrap:g,alignContent:g,alignItems:g,alignSelf:g,justifyContent:g,order:g,transform:g,transformOrigin:g,transformOriginX:g,transformOriginY:g,backfaceVisibility:g,perspective:g,perspectiveOrigin:g,transformStyle:g,transformOriginZ:g,animation:g,animationDelay:g,animationDirection:g,animationFillMode:g,animationDuration:g,animationIterationCount:g,animationName:g,animationPlayState:g,animationTimingFunction:g,backdropFilter:g,fontKerning:g,scrollSnapType:X,scrollSnapPointsX:X,scrollSnapPointsY:X,scrollSnapDestination:X,scrollSnapCoordinate:X,shapeImageThreshold:g,shapeImageMargin:g,shapeImageOutside:g,hyphens:K,flowInto:X,flowFrom:X,regionFragment:X,textAlignLast:z,tabSize:z,wrapFlow:I,wrapThrough:I,wrapMargin:I,gridTemplateColumns:I,gridTemplateRows:I,gridTemplateAreas:I,gridTemplate:I,gridAutoColumns:I,gridAutoRows:I,gridAutoFlow:I,grid:I,gridRowStart:I,gridColumnStart:I,gridRowEnd:I,gridRow:I,gridColumn:I,gridColumnEnd:I,gridColumnGap:I,gridRowGap:I,gridArea:I,gridGap:I,textSizeAdjust:X,borderImage:g,borderImageOutset:g,borderImageRepeat:g,borderImageSlice:g,borderImageSource:g,borderImageWidth:g,transitionDelay:g,transitionDuration:g,transitionProperty:g,transitionTimingFunction:g}},j.exports=m.default},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.default=function(pe){for(var Oe in pe){var Fe=pe[Oe],Le=(0,I.default)(J,Oe,Fe,pe,me);Le&&(pe[Oe]=Le),(0,z.default)(me,Oe,pe)}return pe};var g=se(o(308)),z=se(o(307)),I=se(o(306)),A=se(o(305)),X=se(o(304)),K=se(o(303)),M=se(o(302)),V=se(o(301)),$=se(o(300)),W=se(o(299)),te=se(o(298)),F=se(o(297)),ue=se(o(296));function se(pe){return pe&&pe.__esModule?pe:{default:pe}}var J=[X.default,A.default,K.default,V.default,$.default,W.default,te.default,F.default,ue.default,M.default],me=g.default.prefixMap},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0});var g=Object.assign||function(V){for(var $=1;$<arguments.length;$++){var W=arguments[$];for(var te in W)Object.prototype.hasOwnProperty.call(W,te)&&(V[te]=W[te])}return V};m.PluginSet=K,m.fallbacks=function(V){if(Object.keys(V.style).map(function(te){return Array.isArray(V.style[te])}).indexOf(!0)>=0){var $=V.style,W=Object.keys($).reduce(function(te,F){return te[F]=Array.isArray($[F])?$[F].join("; "+(0,I.processStyleName)(F)+": "):$[F],te},{});return(0,z.default)({},V,{style:W})}return V},m.contentWrap=function(V){if(V.style.content){var $=V.style.content;return M.indexOf($)>=0||/^(attr|calc|counters?|url)\(/.test($)?V:$.charAt(0)!==$.charAt($.length-1)||$.charAt(0)!=='"'&&$.charAt(0)!=="'"?g({},V,{style:g({},V.style,{content:'"'+$+'"'})}):V}return V},m.prefixes=function(V){return(0,z.default)({},V,{style:(0,A.default)(g({},V.style))})};var z=X(o(139)),I=o(201),A=X(o(309));function X(V){return V&&V.__esModule?V:{default:V}}function K(V){this.fns=V||[]}(0,z.default)(K.prototype,{add:function(){for(var V=this,$=arguments.length,W=Array($),te=0;te<$;te++)W[te]=arguments[te];W.forEach(function(F){V.fns.indexOf(F)>=0||(V.fns=[F].concat(V.fns))})},remove:function(V){this.fns=this.fns.filter(function($){return $!==V})},clear:function(){this.fns=[]},transform:function(V){return this.fns.reduce(function($,W){return W($)},V)}});var M=["normal","none","counter","open-quote","close-quote","no-open-quote","no-close-quote","initial","inherit"]},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0});var g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A};function z(A){if(function(te){return te==null||te===!1||(te===void 0?"undefined":g(te))==="object"&&Object.keys(te).length===0}(A))return null;if((A===void 0?"undefined":g(A))!=="object")return A;for(var X={},K=Object.keys(A),M=!1,V=0;V<K.length;V++){var $=A[K[V]],W=I($);W!==null&&W===$||(M=!0),W!==null&&(X[K[V]]=W)}return Object.keys(X).length===0?null:M?X:A}function I(A){return Array.isArray(A)?function(X){var K=!1,M=[];return X.forEach(function(V){var $=I(V);$!==null&&$===V||(K=!0),$!==null&&M.push($)}),M.length==0?null:K?M:X}(A):z(A)}m.default=I},function(j,m,o){j.exports=function(g){var z={};return function(I){return z.hasOwnProperty(I)||(z[I]=g.call(this,I)),z[I]}}},function(j,m,o){var g=/([A-Z])/g;j.exports=function(z){return z.replace(g,"-$1").toLowerCase()}},function(j,m,o){var g=o(313),z=/^ms-/;j.exports=function(I){return g(I).replace(z,"-ms-")}},function(j,m,o){function g(I){return function(){return I}}var z=function(){};z.thatReturns=g,z.thatReturnsFalse=g(!1),z.thatReturnsTrue=g(!0),z.thatReturnsNull=g(null),z.thatReturnsThis=function(){return this},z.thatReturnsArgument=function(I){return I},j.exports=z},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0});var g={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowStart:!0,gridRowEnd:!0,gridColumn:!0,gridColumnStart:!0,gridColumnEnd:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},z=["Webkit","ms","Moz","O"];Object.keys(g).forEach(function(A){z.forEach(function(X){g[function(K,M){return K+M.charAt(0).toUpperCase()+M.substring(1)}(X,A)]=g[A]})});var I={isUnitlessNumber:g,shorthandPropertyExpansions:{background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}}};m.default=I},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0});var g=z(o(316));z(o(200));function z(A){return A&&A.__esModule?A:{default:A}}var I=g.default.isUnitlessNumber;m.default=function(A,X,K){return X==null||typeof X=="boolean"||X===""?"":isNaN(X)||X===0||I.hasOwnProperty(A)&&I[A]?""+X:(typeof X=="string"&&(X=X.trim()),X+"px")}},function(j,m,o){var g=/-(.)/g;j.exports=function(z){return z.replace(g,function(I,A){return A.toUpperCase()})}},function(j,m,o){var g=o(318),z=/^-ms-/;j.exports=function(I){return g(I.replace(z,"ms-"))}},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),m.StyleSheet=V;var g=function($){return $&&$.__esModule?$:{default:$}}(o(139));function z($){return $[$.length-1]}function I($){if($.sheet)return $.sheet;for(var W=0;W<document.styleSheets.length;W++)if(document.styleSheets[W].ownerNode===$)return document.styleSheets[W]}var A=typeof window!="undefined",X=!1,K=function(){if(A){var $=document.createElement("div");return $.innerHTML="<!--[if lt IE 10]><i></i><![endif]-->",$.getElementsByTagName("i").length===1}}();function M(){var $=document.createElement("style");return $.type="text/css",$.setAttribute("data-glamor",""),$.appendChild(document.createTextNode("")),(document.head||document.getElementsByTagName("head")[0]).appendChild($),$}function V(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},W=$.speedy,te=W===void 0?!X:W,F=$.maxLength,ue=F===void 0?A&&K?4e3:65e3:F;this.isSpeedy=te,this.sheet=void 0,this.tags=[],this.maxLength=ue,this.ctr=0}(0,g.default)(V.prototype,{getSheet:function(){return I(z(this.tags))},inject:function(){var $=this;if(this.injected)throw new Error("already injected stylesheet!");A?this.tags[0]=M():this.sheet={cssRules:[],insertRule:function(W){$.sheet.cssRules.push({cssText:W})}},this.injected=!0},speedy:function($){if(this.ctr!==0)throw new Error("cannot change speedy mode after inserting any rule to sheet. Either call speedy("+$+") earlier in your app, or call flush() before speedy("+$+")");this.isSpeedy=!!$},_insert:function($){try{var W=this.getSheet();W.insertRule($,$.indexOf("@import")!==-1?0:W.cssRules.length)}catch{}},insert:function($){if(A)if(this.isSpeedy&&this.getSheet().insertRule)this._insert($);else if($.indexOf("@import")!==-1){var W=z(this.tags);W.insertBefore(document.createTextNode($),W.firstChild)}else z(this.tags).appendChild(document.createTextNode($));else this.sheet.insertRule($,$.indexOf("@import")!==-1?0:this.sheet.cssRules.length);return this.ctr++,A&&this.ctr%this.maxLength==0&&this.tags.push(M()),this.ctr-1},delete:function($){return this.replace($,"")},flush:function(){A?(this.tags.forEach(function($){return $.parentNode.removeChild($)}),this.tags=[],this.sheet=null,this.ctr=0):this.sheet.cssRules=[],this.injected=!1},rules:function(){if(!A)return this.sheet.cssRules;var $=[];return this.tags.forEach(function(W){return $.splice.apply($,[$.length,0].concat(function(te){if(Array.isArray(te)){for(var F=0,ue=Array(te.length);F<te.length;F++)ue[F]=te[F];return ue}return Array.from(te)}(Array.from(I(W).cssRules))))}),$}})},function(j,m,o){o.r(m),o.d(m,"default",function(){return K});var g=o(null),z=o(87),I=o(null),A=o(null),X=o(null);function K(){var M=[],V=A.c;function $(W){if(W!=null&&!isNaN(W=+W))return V((Object(g.c)(M,W,1)-1)/(M.length-1))}return $.domain=function(W){if(!arguments.length)return M.slice();M=[];for(let te of W)te==null||isNaN(te=+te)||M.push(te);return M.sort(z.a),$},$.interpolator=function(W){return arguments.length?(V=W,$):V},$.range=function(){return M.map((W,te)=>V(te/(M.length-1)))},$.quantiles=function(W){return Array.from({length:W+1},(te,F)=>Object(I.b)(M,F/W))},$.copy=function(){return K(V).domain(M)},X.b.apply($,arguments)}},function(j,m,o){o.r(m),o.d(m,"default",function(){return K});var g=o(null),z=o(null),I=o(null),A=o(null);function X(M){return Math.sign(M)*M*M}function K(){var M,V=Object(g.a)(),$=[0,1],W=!1;function te(F){var ue=function(se){return Math.sign(se)*Math.sqrt(Math.abs(se))}(V(F));return isNaN(ue)?M:W?Math.round(ue):ue}return te.invert=function(F){return V.invert(X(F))},te.domain=function(F){return arguments.length?(V.domain(F),te):V.domain()},te.range=function(F){return arguments.length?(V.range(($=Array.from(F,A.a)).map(X)),te):$.slice()},te.rangeRound=function(F){return te.range(F).round(!0)},te.round=function(F){return arguments.length?(W=!!F,te):W},te.clamp=function(F){return arguments.length?(V.clamp(F),te):V.clamp()},te.unknown=function(F){return arguments.length?(M=F,te):M},te.copy=function(){return K(V.domain(),$).round(W).clamp(V.clamp()).unknown(M)},z.a.apply(te,arguments),Object(I.b)(te)}},function(j,m,o){const g=o(47),z=o(113),{ANY:I}=z,A=o(112),X=o(48),K=($,W,te)=>{if($===W)return!0;if($.length===1&&$[0].semver===I){if(W.length===1&&W[0].semver===I)return!0;$=te.includePrerelease?[new z(">=0.0.0-0")]:[new z(">=0.0.0")]}if(W.length===1&&W[0].semver===I){if(te.includePrerelease)return!0;W=[new z(">=0.0.0")]}const F=new Set;let ue,se,J,me,pe,Oe,Fe;for(const ft of $)ft.operator===">"||ft.operator===">="?ue=M(ue,ft,te):ft.operator==="<"||ft.operator==="<="?se=V(se,ft,te):F.add(ft.semver);if(F.size>1||ue&&se&&((J=X(ue.semver,se.semver,te))>0||J===0&&(ue.operator!==">="||se.operator!=="<=")))return null;for(const ft of F){if(ue&&!A(ft,String(ue),te)||se&&!A(ft,String(se),te))return null;for(const Mt of W)if(!A(ft,String(Mt),te))return!1;return!0}let Le=!(!se||te.includePrerelease||!se.semver.prerelease.length)&&se.semver,Ae=!(!ue||te.includePrerelease||!ue.semver.prerelease.length)&&ue.semver;Le&&Le.prerelease.length===1&&se.operator==="<"&&Le.prerelease[0]===0&&(Le=!1);for(const ft of W){if(Fe=Fe||ft.operator===">"||ft.operator===">=",Oe=Oe||ft.operator==="<"||ft.operator==="<=",ue){if(Ae&&ft.semver.prerelease&&ft.semver.prerelease.length&&ft.semver.major===Ae.major&&ft.semver.minor===Ae.minor&&ft.semver.patch===Ae.patch&&(Ae=!1),ft.operator===">"||ft.operator===">="){if((me=M(ue,ft,te))===ft&&me!==ue)return!1}else if(ue.operator===">="&&!A(ue.semver,String(ft),te))return!1}if(se){if(Le&&ft.semver.prerelease&&ft.semver.prerelease.length&&ft.semver.major===Le.major&&ft.semver.minor===Le.minor&&ft.semver.patch===Le.patch&&(Le=!1),ft.operator==="<"||ft.operator==="<="){if((pe=V(se,ft,te))===ft&&pe!==se)return!1}else if(se.operator==="<="&&!A(se.semver,String(ft),te))return!1}if(!ft.operator&&(se||ue)&&J!==0)return!1}return!(ue&&Oe&&!se&&J!==0)&&!(se&&Fe&&!ue&&J!==0)&&!Ae&&!Le},M=($,W,te)=>{if(!$)return W;const F=X($.semver,W.semver,te);return F>0?$:F<0||W.operator===">"&&$.operator===">="?W:$},V=($,W,te)=>{if(!$)return W;const F=X($.semver,W.semver,te);return F<0?$:F>0||W.operator==="<"&&$.operator==="<="?W:$};j.exports=($,W,te={})=>{if($===W)return!0;$=new g($,te),W=new g(W,te);let F=!1;e:for(const ue of $.set){for(const se of W.set){const J=K(ue,se,te);if(F=F||J!==null,J)continue e}if(F)return!1}return!0}},function(j,m,o){const g=o(112),z=o(48);j.exports=(I,A,X)=>{const K=[];let M=null,V=null;const $=I.sort((ue,se)=>z(ue,se,X));for(const ue of $)g(ue,A,X)?(V=ue,M||(M=ue)):(V&&K.push([M,V]),V=null,M=null);M&&K.push([M,null]);const W=[];for(const[ue,se]of K)ue===se?W.push(ue):se||ue!==$[0]?se?ue===$[0]?W.push(`<=${se}`):W.push(`${ue} - ${se}`):W.push(`>=${ue}`):W.push("*");const te=W.join(" || "),F=typeof A.raw=="string"?A.raw:String(A);return te.length<F.length?te:A}},function(j,m,o){const g=o(47);j.exports=(z,I,A)=>(z=new g(z,A),I=new g(I,A),z.intersects(I))},function(j,m,o){const g=o(140);j.exports=(z,I,A)=>g(z,I,"<",A)},function(j,m,o){const g=o(140);j.exports=(z,I,A)=>g(z,I,">",A)},function(j,m,o){const g=o(47);j.exports=(z,I)=>{try{return new g(z,I).range||"*"}catch{return null}}},function(j,m,o){const g=o(32),z=o(47),I=o(114);j.exports=(A,X)=>{A=new z(A,X);let K=new g("0.0.0");if(A.test(K)||(K=new g("0.0.0-0"),A.test(K)))return K;K=null;for(let M=0;M<A.set.length;++M){let V=null;A.set[M].forEach($=>{const W=new g($.semver.version);switch($.operator){case">":W.prerelease.length===0?W.patch++:W.prerelease.push(0),W.raw=W.format();case"":case">=":V&&!I(W,V)||(V=W);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${$.operator}`)}}),!V||K&&!I(K,V)||(K=V)}return K&&A.test(K)?K:null}},function(j,m,o){const g=o(32),z=o(47);j.exports=(I,A,X)=>{let K=null,M=null,V=null;try{V=new z(A,X)}catch{return null}return I.forEach($=>{V.test($)&&(K&&M.compare($)!==1||(M=new g(K=$,X)))}),K}},function(j,m,o){const g=o(32),z=o(47);j.exports=(I,A,X)=>{let K=null,M=null,V=null;try{V=new z(A,X)}catch{return null}return I.forEach($=>{V.test($)&&(K&&M.compare($)!==-1||(M=new g(K=$,X)))}),K}},function(j,m,o){const g=o(47);j.exports=(z,I)=>new g(z,I).set.map(A=>A.map(X=>X.value).join(" ").trim().split(" "))},function(j,m,o){j.exports=function(g){g.prototype[Symbol.iterator]=function*(){for(let z=this.head;z;z=z.next)yield z.value}}},function(j,m,o){function g(K){var M=this;if(M instanceof g||(M=new g),M.tail=null,M.head=null,M.length=0,K&&typeof K.forEach=="function")K.forEach(function(W){M.push(W)});else if(arguments.length>0)for(var V=0,$=arguments.length;V<$;V++)M.push(arguments[V]);return M}function z(K,M,V){var $=M===K.head?new X(V,null,M,K):new X(V,M,M.next,K);return $.next===null&&(K.tail=$),$.prev===null&&(K.head=$),K.length++,$}function I(K,M){K.tail=new X(M,K.tail,null,K),K.head||(K.head=K.tail),K.length++}function A(K,M){K.head=new X(M,null,K.head,K),K.tail||(K.tail=K.head),K.length++}function X(K,M,V,$){if(!(this instanceof X))return new X(K,M,V,$);this.list=$,this.value=K,M?(M.next=this,this.prev=M):this.prev=null,V?(V.prev=this,this.next=V):this.next=null}j.exports=g,g.Node=X,g.create=g,g.prototype.removeNode=function(K){if(K.list!==this)throw new Error("removing node which does not belong to this list");var M=K.next,V=K.prev;return M&&(M.prev=V),V&&(V.next=M),K===this.head&&(this.head=M),K===this.tail&&(this.tail=V),K.list.length--,K.next=null,K.prev=null,K.list=null,M},g.prototype.unshiftNode=function(K){if(K!==this.head){K.list&&K.list.removeNode(K);var M=this.head;K.list=this,K.next=M,M&&(M.prev=K),this.head=K,this.tail||(this.tail=K),this.length++}},g.prototype.pushNode=function(K){if(K!==this.tail){K.list&&K.list.removeNode(K);var M=this.tail;K.list=this,K.prev=M,M&&(M.next=K),this.tail=K,this.head||(this.head=K),this.length++}},g.prototype.push=function(){for(var K=0,M=arguments.length;K<M;K++)I(this,arguments[K]);return this.length},g.prototype.unshift=function(){for(var K=0,M=arguments.length;K<M;K++)A(this,arguments[K]);return this.length},g.prototype.pop=function(){if(this.tail){var K=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,K}},g.prototype.shift=function(){if(this.head){var K=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,K}},g.prototype.forEach=function(K,M){M=M||this;for(var V=this.head,$=0;V!==null;$++)K.call(M,V.value,$,this),V=V.next},g.prototype.forEachReverse=function(K,M){M=M||this;for(var V=this.tail,$=this.length-1;V!==null;$--)K.call(M,V.value,$,this),V=V.prev},g.prototype.get=function(K){for(var M=0,V=this.head;V!==null&&M<K;M++)V=V.next;if(M===K&&V!==null)return V.value},g.prototype.getReverse=function(K){for(var M=0,V=this.tail;V!==null&&M<K;M++)V=V.prev;if(M===K&&V!==null)return V.value},g.prototype.map=function(K,M){M=M||this;for(var V=new g,$=this.head;$!==null;)V.push(K.call(M,$.value,this)),$=$.next;return V},g.prototype.mapReverse=function(K,M){M=M||this;for(var V=new g,$=this.tail;$!==null;)V.push(K.call(M,$.value,this)),$=$.prev;return V},g.prototype.reduce=function(K,M){var V,$=this.head;if(arguments.length>1)V=M;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");$=this.head.next,V=this.head.value}for(var W=0;$!==null;W++)V=K(V,$.value,W),$=$.next;return V},g.prototype.reduceReverse=function(K,M){var V,$=this.tail;if(arguments.length>1)V=M;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");$=this.tail.prev,V=this.tail.value}for(var W=this.length-1;$!==null;W--)V=K(V,$.value,W),$=$.prev;return V},g.prototype.toArray=function(){for(var K=new Array(this.length),M=0,V=this.head;V!==null;M++)K[M]=V.value,V=V.next;return K},g.prototype.toArrayReverse=function(){for(var K=new Array(this.length),M=0,V=this.tail;V!==null;M++)K[M]=V.value,V=V.prev;return K},g.prototype.slice=function(K,M){(M=M||this.length)<0&&(M+=this.length),(K=K||0)<0&&(K+=this.length);var V=new g;if(M<K||M<0)return V;K<0&&(K=0),M>this.length&&(M=this.length);for(var $=0,W=this.head;W!==null&&$<K;$++)W=W.next;for(;W!==null&&$<M;$++,W=W.next)V.push(W.value);return V},g.prototype.sliceReverse=function(K,M){(M=M||this.length)<0&&(M+=this.length),(K=K||0)<0&&(K+=this.length);var V=new g;if(M<K||M<0)return V;K<0&&(K=0),M>this.length&&(M=this.length);for(var $=this.length,W=this.tail;W!==null&&$>M;$--)W=W.prev;for(;W!==null&&$>K;$--,W=W.prev)V.push(W.value);return V},g.prototype.splice=function(K,M,...V){K>this.length&&(K=this.length-1),K<0&&(K=this.length+K);for(var $=0,W=this.head;W!==null&&$<K;$++)W=W.next;var te=[];for($=0;W&&$<M;$++)te.push(W.value),W=this.removeNode(W);for(W===null&&(W=this.tail),W!==this.head&&W!==this.tail&&(W=W.prev),$=0;$<V.length;$++)W=z(this,W,V[$]);return te},g.prototype.reverse=function(){for(var K=this.head,M=this.tail,V=K;V!==null;V=V.prev){var $=V.prev;V.prev=V.next,V.next=$}return this.head=M,this.tail=K,this};try{o(333)(g)}catch{}},function(j,m,o){const g=o(334),z=Symbol("max"),I=Symbol("length"),A=Symbol("lengthCalculator"),X=Symbol("allowStale"),K=Symbol("maxAge"),M=Symbol("dispose"),V=Symbol("noDisposeOnSet"),$=Symbol("lruList"),W=Symbol("cache"),te=Symbol("updateAgeOnGet"),F=()=>1,ue=(Fe,Le,Ae)=>{const ft=Fe[W].get(Le);if(ft){const Mt=ft.value;if(se(Fe,Mt)){if(me(Fe,ft),!Fe[X])return}else Ae&&(Fe[te]&&(ft.value.now=Date.now()),Fe[$].unshiftNode(ft));return Mt.value}},se=(Fe,Le)=>{if(!Le||!Le.maxAge&&!Fe[K])return!1;const Ae=Date.now()-Le.now;return Le.maxAge?Ae>Le.maxAge:Fe[K]&&Ae>Fe[K]},J=Fe=>{if(Fe[I]>Fe[z])for(let Le=Fe[$].tail;Fe[I]>Fe[z]&&Le!==null;){const Ae=Le.prev;me(Fe,Le),Le=Ae}},me=(Fe,Le)=>{if(Le){const Ae=Le.value;Fe[M]&&Fe[M](Ae.key,Ae.value),Fe[I]-=Ae.length,Fe[W].delete(Ae.key),Fe[$].removeNode(Le)}};class pe{constructor(Le,Ae,ft,Mt,Xt){this.key=Le,this.value=Ae,this.length=ft,this.now=Mt,this.maxAge=Xt||0}}const Oe=(Fe,Le,Ae,ft)=>{let Mt=Ae.value;se(Fe,Mt)&&(me(Fe,Ae),Fe[X]||(Mt=void 0)),Mt&&Le.call(ft,Mt.value,Mt.key,Fe)};j.exports=class{constructor(Fe){if(typeof Fe=="number"&&(Fe={max:Fe}),Fe||(Fe={}),Fe.max&&(typeof Fe.max!="number"||Fe.max<0))throw new TypeError("max must be a non-negative number");this[z]=Fe.max||1/0;const Le=Fe.length||F;if(this[A]=typeof Le!="function"?F:Le,this[X]=Fe.stale||!1,Fe.maxAge&&typeof Fe.maxAge!="number")throw new TypeError("maxAge must be a number");this[K]=Fe.maxAge||0,this[M]=Fe.dispose,this[V]=Fe.noDisposeOnSet||!1,this[te]=Fe.updateAgeOnGet||!1,this.reset()}set max(Fe){if(typeof Fe!="number"||Fe<0)throw new TypeError("max must be a non-negative number");this[z]=Fe||1/0,J(this)}get max(){return this[z]}set allowStale(Fe){this[X]=!!Fe}get allowStale(){return this[X]}set maxAge(Fe){if(typeof Fe!="number")throw new TypeError("maxAge must be a non-negative number");this[K]=Fe,J(this)}get maxAge(){return this[K]}set lengthCalculator(Fe){typeof Fe!="function"&&(Fe=F),Fe!==this[A]&&(this[A]=Fe,this[I]=0,this[$].forEach(Le=>{Le.length=this[A](Le.value,Le.key),this[I]+=Le.length})),J(this)}get lengthCalculator(){return this[A]}get length(){return this[I]}get itemCount(){return this[$].length}rforEach(Fe,Le){Le=Le||this;for(let Ae=this[$].tail;Ae!==null;){const ft=Ae.prev;Oe(this,Fe,Ae,Le),Ae=ft}}forEach(Fe,Le){Le=Le||this;for(let Ae=this[$].head;Ae!==null;){const ft=Ae.next;Oe(this,Fe,Ae,Le),Ae=ft}}keys(){return this[$].toArray().map(Fe=>Fe.key)}values(){return this[$].toArray().map(Fe=>Fe.value)}reset(){this[M]&&this[$]&&this[$].length&&this[$].forEach(Fe=>this[M](Fe.key,Fe.value)),this[W]=new Map,this[$]=new g,this[I]=0}dump(){return this[$].map(Fe=>!se(this,Fe)&&{k:Fe.key,v:Fe.value,e:Fe.now+(Fe.maxAge||0)}).toArray().filter(Fe=>Fe)}dumpLru(){return this[$]}set(Fe,Le,Ae){if((Ae=Ae||this[K])&&typeof Ae!="number")throw new TypeError("maxAge must be a number");const ft=Ae?Date.now():0,Mt=this[A](Le,Fe);if(this[W].has(Fe)){if(Mt>this[z])return me(this,this[W].get(Fe)),!1;const tn=this[W].get(Fe).value;return this[M]&&(this[V]||this[M](Fe,tn.value)),tn.now=ft,tn.maxAge=Ae,tn.value=Le,this[I]+=Mt-tn.length,tn.length=Mt,this.get(Fe),J(this),!0}const Xt=new pe(Fe,Le,Mt,ft,Ae);return Xt.length>this[z]?(this[M]&&this[M](Fe,Le),!1):(this[I]+=Xt.length,this[$].unshift(Xt),this[W].set(Fe,this[$].head),J(this),!0)}has(Fe){if(!this[W].has(Fe))return!1;const Le=this[W].get(Fe).value;return!se(this,Le)}get(Fe){return ue(this,Fe,!0)}peek(Fe){return ue(this,Fe,!1)}pop(){const Fe=this[$].tail;return Fe?(me(this,Fe),Fe.value):null}del(Fe){me(this,this[W].get(Fe))}load(Fe){this.reset();const Le=Date.now();for(let Ae=Fe.length-1;Ae>=0;Ae--){const ft=Fe[Ae],Mt=ft.e||0;if(Mt===0)this.set(ft.k,ft.v);else{const Xt=Mt-Le;Xt>0&&this.set(ft.k,ft.v,Xt)}}}prune(){this[W].forEach((Fe,Le)=>ue(this,Le,!1))}}},function(j,m,o){const g=o(32),z=o(89),{re:I,t:A}=o(90);j.exports=(X,K)=>{if(X instanceof g)return X;if(typeof X=="number"&&(X=String(X)),typeof X!="string")return null;let M=null;if((K=K||{}).rtl){let V;for(;(V=I[A.COERCERTL].exec(X))&&(!M||M.index+M[0].length!==X.length);)M&&V.index+V[0].length===M.index+M[0].length||(M=V),I[A.COERCERTL].lastIndex=V.index+V[1].length+V[2].length;I[A.COERCERTL].lastIndex=-1}else M=X.match(I[A.COERCE]);return M===null?null:z(`${M[2]}.${M[3]||"0"}.${M[4]||"0"}`,K)}},function(j,m,o){const g=o(144);j.exports=(z,I)=>z.sort((A,X)=>g(X,A,I))},function(j,m,o){const g=o(144);j.exports=(z,I)=>z.sort((A,X)=>g(A,X,I))},function(j,m,o){const g=o(48);j.exports=(z,I)=>g(z,I,!0)},function(j,m,o){const g=o(48);j.exports=(z,I,A)=>g(I,z,A)},function(j,m,o){const g=o(89);j.exports=(z,I)=>{const A=g(z,I);return A&&A.prerelease.length?A.prerelease:null}},function(j,m,o){const g=o(32);j.exports=(z,I)=>new g(z,I).patch},function(j,m,o){const g=o(32);j.exports=(z,I)=>new g(z,I).minor},function(j,m,o){const g=o(32);j.exports=(z,I)=>new g(z,I).major},function(j,m,o){const g=o(89),z=o(145);j.exports=(I,A)=>{if(z(I,A))return null;{const X=g(I),K=g(A),M=X.prerelease.length||K.prerelease.length,V=M?"pre":"",$=M?"prerelease":"";for(const W in X)if((W==="major"||W==="minor"||W==="patch")&&X[W]!==K[W])return V+W;return $}}},function(j,m,o){const g=o(32);j.exports=(z,I,A,X)=>{typeof A=="string"&&(X=A,A=void 0);try{return new g(z,A).inc(I,X).version}catch{return null}}},function(j,m,o){const g=o(89);j.exports=(z,I)=>{const A=g(z.trim().replace(/^[=v]+/,""),I);return A?A.version:null}},function(j,m,o){const g=o(89);j.exports=(z,I)=>{const A=g(z,I);return A?A.version:null}},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var g=this&&this.__awaiter||function(V,$,W,te){return new(W||(W=Promise))(function(F,ue){function se(pe){try{me(te.next(pe))}catch(Oe){ue(Oe)}}function J(pe){try{me(te.throw(pe))}catch(Oe){ue(Oe)}}function me(pe){pe.done?F(pe.value):new W(function(Oe){Oe(pe.value)}).then(se,J)}me((te=te.apply(V,$||[])).next())})},z=this&&this.__importDefault||function(V){return V&&V.__esModule?V:{default:V}};Object.defineProperty(m,"__esModule",{value:!0});const I=z(o(88)),A=o(64),X=o(46);m.barchart=function(V,$,W={}){return g(this,void 0,void 0,function*(){const te=X.getDrawArea(V),F=$,ue=Object.assign({},K,W);if(M.has(te)){const Mt=M.get(te);if(X.shallowEquals(ue,Mt.lastOptions)){yield X.nextFrame();const Xt=Mt.view,tn=Xt.changeset().remove(()=>!0).insert(F);return void(yield Xt.change("values",tn).runAsync())}}const{xLabel:se,yLabel:J,xType:me,yType:pe}=ue;let Oe=null;se!=null&&(Oe={title:se});let Fe,Le=null;J!=null&&(Le={title:J}),Fe=ue.color!=null?Array.isArray(ue.color)?{field:"index",type:"nominal",scale:{range:ue.color}}:{value:ue.color}:{value:"#4C78A0"};const Ae={width:ue.width||A.getDefaultWidth(te),height:ue.height||A.getDefaultHeight(te),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:ue.fontSize,titleFontSize:ue.fontSize},text:{fontSize:ue.fontSize},legend:{labelFontSize:ue.fontSize,titleFontSize:ue.fontSize}},data:{values:F,name:"values"},mark:{type:"bar",tooltip:!0},encoding:{x:{field:"index",type:me,axis:Oe},y:{field:"value",type:pe,axis:Le},color:Fe}};yield X.nextFrame();const ft=yield I.default(te,Ae,{actions:!1,mode:"vega-lite",defaultStyle:!1});M.set(te,{view:ft.view,lastOptions:ue})})};const K={xLabel:"",yLabel:"",xType:"ordinal",yType:"quantitative",fontSize:11},M=new Map},function(j,m,o){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(25),z=o(103),I=o(33),A=o(74);function X(K){z.env().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(K+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}m.enableProdMode=function(){z.env().set("PROD",!0)},m.enableDebugMode=function(){z.env().set("DEBUG",!0)},m.disableDeprecationWarnings=function(){z.env().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},m.deprecationWarn=X,I.setDeprecationWarningFn(X),m.disposeVariables=function(){g.ENGINE.disposeVariables()},m.engine=function(){return g.ENGINE},m.memory=function(){return g.ENGINE.memory()},m.profile=function(K){return g.ENGINE.profile(K)},m.tidy=function(K,M){return g.ENGINE.tidy(K,M)},m.dispose=function(K){A.getTensorsInContainer(K).forEach(function(M){return M.dispose()})},m.keep=function(K){return g.ENGINE.keep(K)},m.time=function(K){return g.ENGINE.time(K)},m.setBackend=function(K){return g.ENGINE.setBackend(K)},m.ready=function(){return g.ENGINE.ready()},m.getBackend=function(){return g.ENGINE.backendName},m.removeBackend=function(K){g.ENGINE.removeBackend(K)},m.findBackend=function(K){return g.ENGINE.findBackend(K)},m.findBackendFactory=function(K){return g.ENGINE.findBackendFactory(K)},m.registerBackend=function(K,M,V){return V===void 0&&(V=1),g.ENGINE.registerBackend(K,M,V)},m.backend=function(){return g.ENGINE.backend},m.setPlatform=function(K,M){z.env().setPlatform(K,M)}},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var g=o(350);m.warnDeprecation=function(){g.deprecationWarn("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")},m.xAs4D=function(z){return z.rank===0||z.rank===1?z.as4D(1,1,1,z.size):z.rank===2?z.as4D(1,1,z.shape[0],z.shape[1]):z.rank===3?z.as4D(1,z.shape[0],z.shape[1],z.shape[2]):z}},function(j,m,o){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(25),z=o(29),I=o(21),A=o(351),X=o(28);function K(V,$,W,te,F,ue){ue==null&&(ue=.001);var se,J,me=z.convertToTensor(V,"x","batchNorm"),pe=z.convertToTensor($,"mean","batchNorm"),Oe=z.convertToTensor(W,"variance","batchNorm");F!=null&&(se=z.convertToTensor(F,"scale","batchNorm")),te!=null&&(J=z.convertToTensor(te,"offset","batchNorm")),I.assert(pe.rank===Oe.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),I.assert(J==null||pe.rank===J.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),I.assert(se==null||pe.rank===se.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var Fe={x:me,scale:se,offset:J,mean:pe,variance:Oe},Le={varianceEpsilon:ue};return g.ENGINE.runKernelFunc(function(Ae,ft){var Mt=A.xAs4D(me),Xt=Ae.batchNormalization(Mt,M(pe),M(Oe),ue,M(se),M(J));return ft([me,pe,Oe,se]),Xt},Fe,null,"FusedBatchNorm",Le).reshape(me.shape)}function M(V){return V==null?null:V.rank===0?V.as1D():V.rank===1?V:V.rank===2?V.as4D(1,1,V.shape[0],V.shape[1]):V.rank===3?V.as4D(1,V.shape[0],V.shape[1],V.shape[2]):V}m.batchNormalization=X.op({batchNormalization_:function(V,$,W,te,F,ue){return te===void 0&&(te=.001),A.warnDeprecation(),K(V,$,W,ue,F,te)}}),m.batchNorm=X.op({batchNorm_:K})},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var g=o(352);o(33).Tensor.prototype.batchNorm=function(z,I,A,X,K){return g.batchNorm(this,z,I,A,X,K)}},function(j,m,o){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(25),z=o(73),I=o(29),A=o(28);m.pad=A.op({pad_:function(X,K,M){M===void 0&&(M=0);var V=I.convertToTensor(X,"x","pad");if(V.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var $={paddings:K,constantValue:M},W={x:V};return g.ENGINE.runKernelFunc(function(te,F){return F([V]),te.pad(V,K,M)},W,null,z.PadV2,$)}})},function(j,m,o){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(354);o(33).Tensor.prototype.pad=function(z,I){return g.pad(this,z,I)}},function(j,m,o){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(25),z=o(29),I=o(21),A=o(28);m.transpose=A.op({transpose_:function(X,K){var M=z.convertToTensor(X,"x","transpose");if(K==null&&(K=M.shape.map(function($,W){return W}).reverse()),I.assert(M.rank===K.length,function(){return"Error in transpose: rank of input "+M.rank+" must match length of perm "+K+"."}),K.forEach(function($){I.assert($>=0&&$<M.rank,function(){return"All entries in 'perm' must be between 0 and "+(M.rank-1)+" but got "+K})}),M.rank<=1)return M.clone();var V={perm:K};return g.ENGINE.runKernelFunc(function($){return $.transpose(M,K)},{x:M},null,"Transpose",V)}})},function(j,m,o){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(356);o(33).Tensor.prototype.transpose=function(z){return g.transpose(this,z)}},function(j,m,o){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(25),z=o(73),I=o(29),A=o(28);m.oneHot=A.op({oneHot_:function(X,K,M,V){if(M===void 0&&(M=1),V===void 0&&(V=0),K<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+K);var $=I.convertToTensor(X,"indices","oneHot","int32"),W=$.shape.concat([K]),te={indices:$=$.flatten()},F={depth:K,onValue:M,offValue:V};return g.ENGINE.runKernelFunc(function(ue,se){return se([$]),ue.oneHot($,K,M,V)},te,null,z.OneHot,F).reshape(W)}})},function(j,m,o){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(358);o(33).Tensor.prototype.oneHot=function(z,I,A){return I===void 0&&(I=1),A===void 0&&(A=0),g.oneHot(this,z,I,A)}},function(j,m,o){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(25),z=o(73),I=o(29),A=o(21),X=o(28);m.tile=X.op({tile_:function(K,M){var V=I.convertToTensor(K,"x","tile",null);A.assert(V.rank===M.length,function(){return"Error in transpose: rank of input "+V.rank+" must match length of reps "+M+"."});var $=[V],W={x:V},te={reps:M};return g.ENGINE.runKernelFunc(function(F,ue){var se=F.tile(V,M);return ue([V]),se},W,null,z.Tile,te,$)}})},function(j,m,o){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(360);o(33).Tensor.prototype.tile=function(z){return g.tile(this,z)}},function(j,m,o){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(25),z=o(73),I=o(74),A=o(29),X=o(147),K=o(28),M=o(91);m.squaredDifference=K.op({squaredDifference_:function(V,$){var W,te=A.convertToTensor(V,"a","squaredDifference"),F=A.convertToTensor($,"b","squaredDifference");W=I.makeTypesMatch(te,F),te=W[0],F=W[1],X.assertAndGetBroadcastShape(te.shape,F.shape);var ue={a:te,b:F},se=[te,F];return g.ENGINE.runKernelFunc(function(J,me){var pe=J.squaredDifference(te,F);return me([te,F]),pe},ue,function(J,me){var pe=me[0],Oe=me[1],Fe=M.scalar(2);return{a:function(){return J.mul(pe.sub(Oe).mul(Fe))},b:function(){return J.mul(Oe.sub(pe).mul(Fe))}}},z.SquaredDifference,{},se,[])}})},function(j,m,o){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(362);o(33).Tensor.prototype.squaredDifference=function(z){return g.squaredDifference(this,z)}},function(j,m,o){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(21);m.assertParamsConsistent=function(z,I){var A=z[0].length;z.forEach(function(K,M){g.assert(K.length===A,function(){return"Error in concat"+A+"D: rank of tensors["+M+"] must be the same as the rank of the rest ("+A+")"})}),g.assert(I>=0&&I<A,function(){return"Error in concat"+A+"D: axis must be between 0 and "+(A-1)+"."});var X=z[0];z.forEach(function(K,M){for(var V=0;V<A;V++)g.assert(V===I||K[V]===X[V],function(){return"Error in concat"+A+"D: Shape of tensors["+M+"] ("+K+") does not match the shape of the rest ("+X+") along the non-concatenated axis "+M+"."})})},m.computeOutShape=function(z,I){for(var A=z[0].slice(),X=1;X<z.length;X++)A[I]+=z[X][I];return A}},function(j,m,o){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(25),z=o(29),I=o(21),A=o(21),X=o(364),K=o(28),M=o(91);m.concat=K.op({concat_:function(V,$){$===void 0&&($=0),I.assert(V.length>=1,function(){return"Pass at least one tensor to concat"});var W=z.convertToTensorArray(V,"tensors","concat");W[0].dtype==="complex64"&&W.forEach(function(J){if(J.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+J.dtype+". ")}),$=A.parseAxisParam($,W[0].shape)[0];var te=X.computeOutShape(W.map(function(J){return J.shape}),$);if(I.sizeFromShape(te)===0)return M.tensor([],te);if((W=W.filter(function(J){return J.size>0})).length===1)return W[0];var F=W.map(function(J){return J.shape});X.assertParamsConsistent(F,$);var ue=W,se={axis:$};return g.ENGINE.runKernelFunc(function(J){return J.concat(W,$)},ue,function(J){var me=F.map(function(pe){return pe[$]});return m.split(J,me,$).map(function(pe){return function(){return pe}})},"Concat",se)}}),m.concat1d=K.op({concat1d_:function(V){return m.concat(V,0)}}),m.concat2d=K.op({concat2d_:function(V,$){return m.concat(V,$)}}),m.concat3d=K.op({concat3d_:function(V,$){return m.concat(V,$)}}),m.concat4d=K.op({concat4d_:function(V,$){return m.concat(V,$)}}),m.split=K.op({split_:function(V,$,W){W===void 0&&(W=0);var te,F=z.convertToTensor(V,"x","split");return W=A.parseAxisParam(W,F.shape)[0],typeof $=="number"?(I.assert(F.shape[W]%$==0,function(){return"Number of splits must evenly divide the axis."}),te=new Array($).fill(F.shape[W]/$)):(I.assert(F.shape[W]===$.reduce(function(ue,se){return ue+se}),function(){return"The sum of sizes must match the size of the axis dimension."}),te=$),g.ENGINE.runKernelFunc(function(ue){return ue.split(F,te,W)},{$x:F},function(ue){return{$x:function(){return m.concat(ue,W)}}})}})},function(j,m,o){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(21);function z(A,X){for(var K=0;K<A.length;++K)if(A[A.length-K-1]!==X-1-K)return!1;return!0}function I(A,X,K){for(var M=A.length+X.length,V=[],$=0,W=0,te=0;te<M;te++)K.indexOf(te)===-1?V.push(A[$++]):V.push(X[W++]);return V}m.axesAreInnerMostDims=z,m.combineLocations=I,m.computeOutAndReduceShapes=function(A,X){for(var K=[],M=A.length,V=0;V<M;V++)X.indexOf(V)===-1&&K.push(A[V]);return[K,X.map(function($){return A[$]})]},m.expandShapeToKeepDim=function(A,X){return I(A,X.map(function(K){return 1}),X)},m.assertAxesAreInnerMostDims=function(A,X,K){g.assert(z(X,K),function(){return A+" supports only inner-most axes for now. Got axes "+X+" and rank-"+K+" input."})},m.getAxesPermutation=function(A,X){if(z(A,X))return null;for(var K=[],M=0;M<X;++M)A.indexOf(M)===-1&&K.push(M);return A.forEach(function(V){return K.push(V)}),K},m.getUndoAxesPermutation=function(A){return A.map(function(X,K){return[K,X]}).sort(function(X,K){return X[1]-K[1]}).map(function(X){return X[0]})},m.getInnerMostAxes=function(A,X){for(var K=[],M=X-A;M<X;++M)K.push(M);return K}},function(j,m,o){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var g=this&&this.__awaiter||function(W,te,F,ue){return new(F||(F=Promise))(function(se,J){function me(Fe){try{Oe(ue.next(Fe))}catch(Le){J(Le)}}function pe(Fe){try{Oe(ue.throw(Fe))}catch(Le){J(Le)}}function Oe(Fe){Fe.done?se(Fe.value):new F(function(Le){Le(Fe.value)}).then(me,pe)}Oe((ue=ue.apply(W,te||[])).next())})},z=this&&this.__generator||function(W,te){var F,ue,se,J,me={label:0,sent:function(){if(1&se[0])throw se[1];return se[1]},trys:[],ops:[]};return J={next:pe(0),throw:pe(1),return:pe(2)},typeof Symbol=="function"&&(J[Symbol.iterator]=function(){return this}),J;function pe(Oe){return function(Fe){return function(Le){if(F)throw new TypeError("Generator is already executing.");for(;me;)try{if(F=1,ue&&(se=2&Le[0]?ue.return:Le[0]?ue.throw||((se=ue.return)&&se.call(ue),0):ue.next)&&!(se=se.call(ue,Le[1])).done)return se;switch(ue=0,se&&(Le=[2&Le[0],se.value]),Le[0]){case 0:case 1:se=Le;break;case 4:return me.label++,{value:Le[1],done:!1};case 5:me.label++,ue=Le[1],Le=[0];continue;case 7:Le=me.ops.pop(),me.trys.pop();continue;default:if(!(se=(se=me.trys).length>0&&se[se.length-1])&&(Le[0]===6||Le[0]===2)){me=0;continue}if(Le[0]===3&&(!se||Le[1]>se[0]&&Le[1]<se[3])){me.label=Le[1];break}if(Le[0]===6&&me.label<se[1]){me.label=se[1],se=Le;break}if(se&&me.label<se[2]){me.label=se[2],me.ops.push(Le);break}se[2]&&me.ops.pop(),me.trys.pop();continue}Le=te.call(W,me)}catch(Ae){Le=[6,Ae],ue=0}finally{F=se=0}if(5&Le[0])throw Le[1];return{value:Le[0]?Le[1]:void 0,done:!0}}([Oe,Fe])}}};Object.defineProperty(m,"__esModule",{value:!0});var I=o(25),A=o(33),X=o(29),K=o(21),M=o(366),V=o(365),$=o(28);m.buffer=function(W,te,F){return te===void 0&&(te="float32"),te=te||"float32",K.assertNonNegativeIntegerDimensions(W),new A.TensorBuffer(W,te,F)},m.print=function(W,te){te===void 0&&(te=!1),console.log(W.toString(te))},m.batchToSpaceND=$.op({batchToSpaceND_:function(W,te,F){var ue=X.convertToTensor(W,"x","batchToSpaceND"),se=te.reduce(function(J,me){return J*me});return K.assert(ue.rank>=1+te.length,function(){return"input rank is "+ue.rank+" but should be > than blockShape.length "+te.length}),K.assert(F.length===te.length,function(){return"crops.length is "+F.length+" but should be equal to blockShape.length  "+te.length}),K.assert(ue.shape[0]%se==0,function(){return"input tensor batch is "+ue.shape[0]+" but is not divisible by the product of the elements of blockShape "+te.join(" * ")+" === "+se}),I.ENGINE.runKernelFunc(function(J){return J.batchToSpaceND(ue,te,F)},{$x:ue},function(J){return{$x:function(){return J.spaceToBatchND(te,F)}}})}}),m.cast=$.op({cast_:function(W,te){var F=X.convertToTensor(W,"x","cast");if(!K.isValidDtype(te))throw new Error("Failed to cast to unknown dtype "+te);if(te==="string"&&F.dtype!=="string"||te!=="string"&&F.dtype==="string")throw new Error("Only strings can be casted to strings");var ue={dtype:te};return I.ENGINE.runKernelFunc(function(se){return se.cast(F,te)},{x:F},function(se){return{x:function(){return se.clone()}}},"Cast",ue)}}),m.cumsum=$.op({cumsum_:function(W,te,F,ue){te===void 0&&(te=0),F===void 0&&(F=!1),ue===void 0&&(ue=!1);var se=X.convertToTensor(W,"x","cumsum");te|=0;var J=M.getAxesPermutation([te],se.rank),me=se;J!=null&&(me=se.transpose(J));var pe=M.getInnerMostAxes(1,se.rank)[0],Oe=I.ENGINE.runKernelFunc(function(Fe){return Fe.cumsum(me,pe,F,ue)},{permutedX:me},function(Fe){return{permutedX:function(){return Fe.cumsum(te,F,!ue)}}});return J!=null&&(Oe=Oe.transpose(J)),Oe}}),m.depthToSpace=$.op({depthToSpace_:function(W,te,F){F===void 0&&(F="NHWC");var ue=X.convertToTensor(W,"x","depthToSpace"),se=F==="NHWC"?ue.shape[1]:ue.shape[2],J=F==="NHWC"?ue.shape[2]:ue.shape[3],me=F==="NHWC"?ue.shape[3]:ue.shape[1];return K.assert(se*te>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+se+" and "+te+`  for depthToSpace with input shape
      `+ue.shape}),K.assert(J*te>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+J+" and "+te+` for depthToSpace with input shape
          `+ue.shape}),K.assert(me%(te*te)==0,function(){return"Dimension size must be evenly divisible by "+te*te+" but is "+me+" for depthToSpace with input shape "+ue.shape}),I.ENGINE.runKernelFunc(function(pe){return pe.depthToSpace(ue,te,F)},{$x:ue})}}),m.expandDims=$.op({expandDims_:function(W,te){te===void 0&&(te=0);var F=X.convertToTensor(W,"x","expandDims",null);K.assert(te<=F.rank,function(){return"Axis must be <= rank of the tensor"});var ue=F.shape.slice();return te<0&&(K.assert(-(F.rank+1)<=te,function(){return"Axis must be in the interval ["+-(F.rank+1)+", "+F.rank+"]"}),te=F.rank+te+1),ue.splice(te,0,1),m.reshape(F,ue)}}),m.reshape=$.op({reshape_:function(W,te){var F=X.convertToTensor(W,"x","reshape",null);te=K.inferFromImplicitShape(te,F.size),K.assert(F.size===K.sizeFromShape(te),function(){return"new shape and old shape must have the same number of elements."});var ue={shape:te};return I.ENGINE.runKernelFunc(function(se){return se.reshape(F,te)},{x:F},function(se){return{x:function(){return se.reshape(F.shape)}}},"Reshape",ue)}}),m.spaceToBatchND=$.op({spaceToBatchND_:function(W,te,F){var ue=X.convertToTensor(W,"x","spaceToBatchND");return K.assert(ue.rank>=1+te.length,function(){return"input rank "+ue.rank+" should be > than [blockShape] "+te.length}),K.assert(F.length===te.length,function(){return"paddings.shape[0] "+F.length+" must be equal to [blockShape] "+te.length}),K.assert(ue.shape.reduce(function(se,J,me){return me>0&&me<=te.length?se&&(J+F[me-1][0]+F[me-1][1])%te[me-1]==0:se},!0),function(){return"input spatial dimensions "+ue.shape.slice(1)+" with paddings "+F.toString()+" must be divisible by blockShapes "+te.toString()}),I.ENGINE.runKernelFunc(function(se){return se.spaceToBatchND(ue,te,F)},{$x:ue},function(se){return{$x:function(){return se.batchToSpaceND(te,F)}}})}}),m.squeeze=$.op({squeeze_:function(W,te){var F=X.convertToTensor(W,"x","squeeze");return m.reshape(F,K.squeezeShape(F.shape,te).newShape)}}),m.stack=$.op({stack_:function(W,te){te===void 0&&(te=0);var F=X.convertToTensorArray(W,"tensors","stack");if(K.assert(F.length>=1,function(){return"Pass at least one tensor to tf.stack"}),F.length===1)return F[0].expandDims(te);var ue=F[0].rank,se=F[0].shape,J=F[0].dtype;K.assert(te<=ue,function(){return"Axis must be <= rank of the tensor"}),F.forEach(function(pe){K.assertShapesMatch(se,pe.shape,"All tensors passed to stack must have matching shapes")}),F.forEach(function(pe){K.assert(J===pe.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var me=F.map(function(pe){return pe.expandDims(te)});return V.concat(me,te)}}),m.unstack=$.op({unstack_:function(W,te){te===void 0&&(te=0),te=te||0;var F=X.convertToTensor(W,"x","unstack");K.assert(te>=-F.shape.length&&te<F.shape.length,function(){return"Axis = "+te+" is not in [-"+F.shape.length+", "+F.shape.length+")"}),te<0&&(te+=F.shape.length);var ue={axis:te};return I.ENGINE.runKernelFunc(function(se){return se.unstack(F,te)},{x:F},function(se){return{x:function(){return m.stack(se,te)}}},"Unpack",ue)}}),m.setdiff1dAsync=function(W,te){return g(this,void 0,void 0,function(){var F,ue,se,J,me,pe,Oe,Fe,Le,Ae;return z(this,function(ft){switch(ft.label){case 0:return F=X.convertToTensor(W,"x","setdiff1d"),ue=X.convertToTensor(te,"y","setdiff1d"),K.assert(F.dtype===ue.dtype,function(){return"x and y should have the same dtype, but got x ("+F.dtype+") and y ("+ue.dtype+")."}),K.assert(F.rank===1,function(){return"x should be 1D tensor, but got x ("+F.shape+")."}),K.assert(ue.rank===1,function(){return"y should be 1D tensor, but got y ("+ue.shape+")."}),[4,F.data()];case 1:return se=ft.sent(),[4,ue.data()];case 2:for(J=ft.sent(),me=new Set(J),pe=0,Le=0;Le<se.length;Le++)me.has(se[Le])||pe++;for(Oe=new A.TensorBuffer([pe],F.dtype),Fe=new A.TensorBuffer([pe],"int32"),Le=0,Ae=0;Le<se.length;Le++)me.has(se[Le])||(Oe.values[Ae]=se[Le],Fe.values[Ae]=Le,Ae++);return[2,[Oe.toTensor(),Fe.toTensor()]]}})})}},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(367);m.whereImpl=function(z,I){for(var A=[],X=0;X<I.length;X++)I[X]&&A.push(X);var K=g.buffer(z,"int32"),M=g.buffer([A.length,z.length],"int32");for(X=0;X<A.length;X++){var V=K.indexToLoc(A[X]),$=X*z.length;M.values.set(V,$)}return M.toTensor()}},function(j,m,o){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var g=this&&this.__awaiter||function(W,te,F,ue){return new(F||(F=Promise))(function(se,J){function me(Fe){try{Oe(ue.next(Fe))}catch(Le){J(Le)}}function pe(Fe){try{Oe(ue.throw(Fe))}catch(Le){J(Le)}}function Oe(Fe){Fe.done?se(Fe.value):new F(function(Le){Le(Fe.value)}).then(me,pe)}Oe((ue=ue.apply(W,te||[])).next())})},z=this&&this.__generator||function(W,te){var F,ue,se,J,me={label:0,sent:function(){if(1&se[0])throw se[1];return se[1]},trys:[],ops:[]};return J={next:pe(0),throw:pe(1),return:pe(2)},typeof Symbol=="function"&&(J[Symbol.iterator]=function(){return this}),J;function pe(Oe){return function(Fe){return function(Le){if(F)throw new TypeError("Generator is already executing.");for(;me;)try{if(F=1,ue&&(se=2&Le[0]?ue.return:Le[0]?ue.throw||((se=ue.return)&&se.call(ue),0):ue.next)&&!(se=se.call(ue,Le[1])).done)return se;switch(ue=0,se&&(Le=[2&Le[0],se.value]),Le[0]){case 0:case 1:se=Le;break;case 4:return me.label++,{value:Le[1],done:!1};case 5:me.label++,ue=Le[1],Le=[0];continue;case 7:Le=me.ops.pop(),me.trys.pop();continue;default:if(!(se=(se=me.trys).length>0&&se[se.length-1])&&(Le[0]===6||Le[0]===2)){me=0;continue}if(Le[0]===3&&(!se||Le[1]>se[0]&&Le[1]<se[3])){me.label=Le[1];break}if(Le[0]===6&&me.label<se[1]){me.label=se[1],se=Le;break}if(se&&me.label<se[2]){me.label=se[2],me.ops.push(Le);break}se[2]&&me.ops.pop(),me.trys.pop();continue}Le=te.call(W,me)}catch(Ae){Le=[6,Ae],ue=0}finally{F=se=0}if(5&Le[0])throw Le[1];return{value:Le[0]?Le[1]:void 0,done:!0}}([Oe,Fe])}}};Object.defineProperty(m,"__esModule",{value:!0});var I=o(368),A=o(25),X=o(29),K=o(21),M=o(147),V=o(28),$=o(91);m.logicalAnd=V.op({logicalAnd_:function(W,te){var F=X.convertToTensor(W,"a","logicalAnd","bool"),ue=X.convertToTensor(te,"b","logicalAnd","bool");return M.assertAndGetBroadcastShape(F.shape,ue.shape),A.ENGINE.runKernelFunc(function(se){return se.logicalAnd(F,ue)},{a:F,b:ue},null,"LogicalAnd")}}),m.logicalNot=V.op({logicalNot_:function(W){var te=X.convertToTensor(W,"x","logicalNot","bool");return A.ENGINE.runKernelFunc(function(F){return F.logicalNot(te)},{$x:te})}}),m.logicalOr=V.op({logicalOr_:function(W,te){var F=X.convertToTensor(W,"a","logicalOr","bool"),ue=X.convertToTensor(te,"b","logicalOr","bool");return M.assertAndGetBroadcastShape(F.shape,ue.shape),A.ENGINE.runKernelFunc(function(se){return se.logicalOr(F,ue)},{$a:F,$b:ue})}}),m.logicalXor=V.op({logicalXor_:function(W,te){var F=X.convertToTensor(W,"a","logicalXor","bool"),ue=X.convertToTensor(te,"b","logicalXor","bool");return M.assertAndGetBroadcastShape(F.shape,ue.shape),m.logicalOr(W,te).logicalAnd(m.logicalAnd(W,te).logicalNot())}}),m.where=V.op({where_:function(W,te,F){var ue=X.convertToTensor(te,"a","where"),se=X.convertToTensor(F,"b","where"),J=X.convertToTensor(W,"condition","where","bool");return K.assertShapesMatch(ue.shape,se.shape,"Error in where: "),J.rank===1?K.assert(J.shape[0]===ue.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):K.assertShapesMatch(J.shape,se.shape,"Error in where: "),A.ENGINE.runKernelFunc(function(me,pe){var Oe=me.select(J,ue,se);return pe([J]),Oe},{$condition:J,$a:ue,$b:se},function(me,pe){var Oe=pe[0];return{$condition:function(){return $.zerosLike(Oe).toFloat()},$a:function(){return me.mul(Oe.cast(me.dtype))},$b:function(){return me.mul(Oe.logicalNot().cast(me.dtype))}}})}}),m.whereAsync=function(W){return g(this,void 0,void 0,function(){var te,F,ue;return z(this,function(se){switch(se.label){case 0:return[4,(te=X.convertToTensor(W,"condition","whereAsync","bool")).data()];case 1:return F=se.sent(),ue=I.whereImpl(te.shape,F),W!==te&&te.dispose(),[2,ue]}})})}},function(j,m,o){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(74),z=o(29),I=o(205),A=o(369),X=o(28),K=o(91);m.divNoNan=X.op({divNoNan_:function(M,V){var $,W=z.convertToTensor(M,"a","div"),te=z.convertToTensor(V,"b","div");W=($=g.makeTypesMatch(W,te))[0],te=$[1];var F=I.div(W,te),ue=K.zerosLike(F),se=te.equal(ue);return A.where(se,ue,F)}})},function(j,m,o){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(370);o(33).Tensor.prototype.divNoNan=function(z){return g.divNoNan(this,z)}},function(j,m,o){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(25),z=o(29),I=o(21),A=o(28),X=o(91);m.abs=A.op({abs_:function(K){var M=z.convertToTensor(K,"x","abs");return M.dtype==="complex64"?g.ENGINE.runKernelFunc(function(V){return V.complexAbs(M)},{$x:M}):g.ENGINE.runKernelFunc(function(V,$){var W=V.abs(M);return $([M]),W},{x:M},function(V,$){var W=$[0];return{x:function(){return V.mul(W.toFloat().step(-1))}}},"Abs")}}),m.acos=A.op({acos_:function(K){var M=z.convertToTensor(K,"x","acos");return g.ENGINE.runKernelFunc(function(V,$){var W=V.acos(M);return $([M]),W},{$x:M},function(V,$){var W=$[0];return{$x:function(){return V.divStrict(X.scalar(1).sub(W.toFloat().square()).sqrt()).neg()}}})}}),m.acosh=A.op({acosh_:function(K){var M=z.convertToTensor(K,"x","acosh");return g.ENGINE.runKernelFunc(function(V,$){var W=V.acosh(M);return $([M]),W},{$x:M},function(V,$){var W=$[0];return{$x:function(){return V.divStrict(W.toFloat().square().sub(1).sqrt())}}})}}),m.asin=A.op({asin_:function(K){var M=z.convertToTensor(K,"x","asin");return g.ENGINE.runKernelFunc(function(V,$){var W=V.asin(M);return $([M]),W},{$x:M},function(V,$){var W=$[0];return{$x:function(){return V.divStrict(X.scalar(1).sub(W.toFloat().square()).sqrt())}}})}}),m.asinh=A.op({asinh_:function(K){var M=z.convertToTensor(K,"x","asinh");return g.ENGINE.runKernelFunc(function(V,$){var W=V.asinh(M);return $([M]),W},{$x:M},function(V,$){var W=$[0];return{$x:function(){return V.divStrict(X.scalar(1).add(W.toFloat().square()).sqrt())}}})}}),m.atan=A.op({atan_:function(K){var M=z.convertToTensor(K,"x","atan");return g.ENGINE.runKernelFunc(function(V,$){var W=V.atan(M);return $([M]),W},{$x:M},function(V,$){var W=$[0];return{$x:function(){return V.div(W.toFloat().square().add(1))}}})}}),m.atanh=A.op({atanh_:function(K){var M=z.convertToTensor(K,"x","atanh");return g.ENGINE.runKernelFunc(function(V,$){var W=V.atanh(M);return $([M]),W},{$x:M},function(V,$){var W=$[0];return{$x:function(){return V.div(X.scalar(1).sub(W.toFloat().square()))}}})}}),m.ceil=A.op({ceil_:function(K){var M=z.convertToTensor(K,"x","ceil");return g.ENGINE.runKernelFunc(function(V){return V.ceil(M)},{$x:M},function(V){return{$x:function(){return X.zerosLike(V)}}})}}),m.clipByValue=A.op({clipByValue_:function(K,M,V){var $=z.convertToTensor(K,"x","clipByValue");I.assert(M<=V,function(){return"Error in clip: min ("+M+") must be less than or equal to max ("+V+")."});var W=[$],te={min:M,max:V};return g.ENGINE.runKernelFunc(function(F,ue){var se=F.clip($,M,V);return ue([$]),se},{x:$},function(F,ue){var se=ue[0];return{x:function(){return F.where(se.greaterEqual(M).logicalAnd(se.lessEqual(V)),X.zerosLike(F))}}},"ClipByValue",te,W)}}),m.cos=A.op({cos_:function(K){var M=z.convertToTensor(K,"x","cos"),V=[M];return g.ENGINE.runKernelFunc(function($,W){var te=$.cos(M);return W([M]),te},{x:M},function($,W){var te=W[0];return{x:function(){return te.toFloat().sin().neg().mul($)}}},"Cos",{},V)}}),m.cosh=A.op({cosh_:function(K){var M=z.convertToTensor(K,"x","cosh");return g.ENGINE.runKernelFunc(function(V,$){var W=V.cosh(M);return $([M]),W},{$x:M},function(V,$){var W=$[0];return{$x:function(){return W.toFloat().sinh().mulStrict(V)}}})}}),m.erf=A.op({erf_:function(K){var M=z.convertToTensor(K,"x","erf");return I.assert(M.dtype==="int32"||M.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),M.dtype==="int32"&&(M=M.toFloat()),g.ENGINE.runKernelFunc(function(V,$){var W=V.erf(M);return $([M]),W},{$x:M},function(V,$){var W=$[0];return{$x:function(){return V.mul(W.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),m.exp=A.op({exp_:function(K){var M=z.convertToTensor(K,"x","exp");return g.ENGINE.runKernelFunc(function(V,$){var W=V.exp(M);return $([W]),W},{x:M},function(V,$){return{x:function(){return V.mulStrict($[0])}}},"Exp",{},[],[!0])}}),m.expm1=A.op({expm1_:function(K){var M=z.convertToTensor(K,"x","expm1");return g.ENGINE.runKernelFunc(function(V,$){var W=V.expm1(M);return $([M]),W},{$x:M},function(V,$){var W=$[0];return{$x:function(){return V.mul(W.exp())}}})}}),m.floor=A.op({floor_:function(K){var M=z.convertToTensor(K,"x","floor");return g.ENGINE.runKernelFunc(function(V){return V.floor(M)},{$x:M},function(V){return{$x:function(){return X.zerosLike(V)}}})}}),m.log=A.op({log_:function(K){var M=z.convertToTensor(K,"x","log"),V=[M];return g.ENGINE.runKernelFunc(function($,W){var te=$.log(M);return W([M]),te},{x:M},function($,W){var te=W[0];return{x:function(){return $.div(te.toFloat())}}},"Log",{},V)}}),m.log1p=A.op({log1p_:function(K){var M=z.convertToTensor(K,"x","log1p");return g.ENGINE.runKernelFunc(function(V,$){var W=V.log1p(M);return $([M]),W},{$x:M},function(V,$){var W=$[0];return{$x:function(){return V.div(W.add(1))}}})}}),m.logSigmoid=A.op({logSigmoid_:function(K){var M=z.convertToTensor(K,"x","logSigmoid");return g.ENGINE.runKernelFunc(function(V,$){var W=V.softplus(M.neg()).neg();return $([M]),W},{$x:M},function(V,$){var W=$[0];return{$x:function(){return V.mul(W.neg().sigmoid())}}})}}),m.neg=A.op({neg_:function(K){var M=z.convertToTensor(K,"x","neg"),V=[M];return g.ENGINE.runKernelFunc(function($){return $.neg(M)},{x:M},function($){return{x:function(){return $.neg()}}},"Neg",{},V)}}),m.reciprocal=A.op({reciprocal_:function(K){var M=z.convertToTensor(K,"x","reciprocal");return g.ENGINE.runKernelFunc(function(V,$){var W=V.reciprocal(M);return $([M]),W},{$x:M},function(V,$){var W=$[0];return{$x:function(){return V.div(W.square().neg())}}})}}),m.round=A.op({round_:function(K){var M=z.convertToTensor(K,"x","round");return g.ENGINE.runKernelFunc(function(V){return V.round(M)},{$x:M},function(V){return{$x:function(){return X.zerosLike(V)}}})}}),m.rsqrt=A.op({rsqrt_:function(K){var M=z.convertToTensor(K,"x","rsqrt"),V=[M];return g.ENGINE.runKernelFunc(function($,W){var te=$.rsqrt(M);return W([M]),te},{x:M},function($,W){var te=W[0];return{x:function(){return $.div(te.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},V)}}),m.sigmoid=A.op({sigmoid_:function(K){var M=z.convertToTensor(K,"x","sigmoid");return g.ENGINE.runKernelFunc(function(V,$){var W=V.sigmoid(M);return $([W]),W},{x:M},function(V,$){var W=$[0];return{x:function(){return V.mul(W.mul(X.scalar(1).sub(W)))}}},"Sigmoid")}}),m.sign=A.op({sign_:function(K){var M=z.convertToTensor(K,"x","sign");return g.ENGINE.runKernelFunc(function(V){return V.sign(M)},{$x:M},function(V){return{$x:function(){return X.zerosLike(V)}}})}}),m.isNaN=A.op({isNaN_:function(K){var M=z.convertToTensor(K,"x","isNaN");return g.ENGINE.runKernelFunc(function(V){return V.isNaN(M)},{$x:M},function(V){return{$x:function(){return X.zerosLike(V)}}})}}),m.isInf=A.op({isInf_:function(K){var M=z.convertToTensor(K,"x","isInf");return g.ENGINE.runKernelFunc(function(V){return V.isInf(M)},{$x:M},function(V){return{$x:function(){return X.zerosLike(V)}}})}}),m.isFinite=A.op({isFinite_:function(K){var M=z.convertToTensor(K,"x","isFinite");return g.ENGINE.runKernelFunc(function(V){return V.isFinite(M)},{$x:M},function(V){return{$x:function(){return X.zerosLike(V)}}})}}),m.sin=A.op({sin_:function(K){var M=z.convertToTensor(K,"x","sin"),V=[M];return g.ENGINE.runKernelFunc(function($,W){var te=$.sin(M);return W([M]),te},{x:M},function($,W){var te=W[0];return{x:function(){return te.toFloat().cos().mul($)}}},"Sin",{},V)}}),m.sinh=A.op({sinh_:function(K){var M=z.convertToTensor(K,"x","sinh");return g.ENGINE.runKernelFunc(function(V,$){var W=V.sinh(M);return $([M]),W},{$x:M},function(V,$){var W=$[0];return{$x:function(){return W.toFloat().cosh().mulStrict(V)}}})}}),m.softplus=A.op({softplus_:function(K){var M=z.convertToTensor(K,"x","softplus");return g.ENGINE.runKernelFunc(function(V,$){var W=V.softplus(M);return $([M]),W},{$x:M},function(V,$){var W=$[0];return{$x:function(){return V.mul(W.sigmoid())}}})}}),m.sqrt=A.op({sqrt_:function(K){var M=z.convertToTensor(K,"x","sqrt");return g.ENGINE.runKernelFunc(function(V,$){var W=V.sqrt(M);return $([M]),W},{$x:M},function(V,$){var W=$[0];return{$x:function(){return V.div(W.toFloat().sqrt().mul(2))}}})}}),m.step=A.op({step_:function(K,M){M===void 0&&(M=0);var V=z.convertToTensor(K,"x","step");return g.ENGINE.runKernelFunc(function($){return $.step(V,M)},{$x:V},function($){return{$x:function(){return X.zerosLike($)}}})}}),m.tan=A.op({tan_:function(K){var M=z.convertToTensor(K,"x","tan");return g.ENGINE.runKernelFunc(function(V,$){var W=V.tan(M);return $([M]),W},{$x:M},function(V,$){var W=$[0];return{$x:function(){return V.div(W.cos().square())}}})}}),m.tanh=A.op({tanh_:function(K){var M=z.convertToTensor(K,"x","tanh");return g.ENGINE.runKernelFunc(function(V,$){var W=V.tanh(M);return $([W]),W},{x:M},function(V,$){var W=$[0];return{x:function(){return X.scalar(1).sub(W.square()).mulStrict(V)}}},"Tanh",{},null,[!0])}})},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var g=o(25),z=o(29),I=o(21),A=o(28);m.complex=A.op({complex_:function(X,K){var M=z.convertToTensor(X,"real","complex"),V=z.convertToTensor(K,"imag","complex");return I.assertShapesMatch(M.shape,V.shape,"real and imag shapes, "+M.shape+" and "+V.shape+", must match in call to tf.complex()."),g.ENGINE.runKernelFunc(function($){return $.complex(M,V)},{$real:M,$imag:V})}}),m.real=A.op({real_:function(X){var K=z.convertToTensor(X,"input","real");return g.ENGINE.runKernelFunc(function(M){return M.real(K)},{$input:K})}}),m.imag=A.op({imag_:function(X){var K=z.convertToTensor(X,"input","imag");return g.ENGINE.runKernelFunc(function(M){return M.imag(K)},{$input:K})}})},function(j,m,o){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(25),z=o(74),I=o(29),A=o(21),X=o(206),K=o(147),M=o(28),V=o(91),$=o(372);m.addStrict=M.op({addStrict_:function(W,te){var F=I.convertToTensor(W,"a","addStrict"),ue=I.convertToTensor(te,"b","addStrict");return A.assertShapesMatch(F.shape,ue.shape,"Error in addStrict: "),F.add(ue)}}),m.atan2=M.op({atan2_:function(W,te){var F,ue=I.convertToTensor(W,"a","atan2"),se=I.convertToTensor(te,"b","atan2");F=z.makeTypesMatch(ue,se),ue=F[0],se=F[1];var J=K.assertAndGetBroadcastShape(ue.shape,se.shape);return g.ENGINE.runKernelFunc(function(me,pe){var Oe=me.atan2(ue,se);return pe([ue,se]),Oe},{$a:ue,$b:se},function(me,pe){var Oe=pe[0],Fe=pe[1];return{$a:function(){var Le=X.add(Oe.square(),Fe.square()),Ae=me.mul(Fe.div(Le)),ft=K.getReductionAxes(Oe.shape,J);return ft.length>0&&(Ae=Ae.sum(ft)),Ae.reshape(Oe.shape)},$b:function(){var Le=X.add(Oe.square(),Fe.square()),Ae=$.neg(me.mul(Oe.div(Le))),ft=K.getReductionAxes(Fe.shape,J);return ft.length>0&&(Ae=Ae.sum(ft)),Ae.reshape(Fe.shape)}}})}}),m.divStrict=M.op({divStrict_:function(W,te){var F=I.convertToTensor(W,"a","div"),ue=I.convertToTensor(te,"b","div");return A.assertShapesMatch(F.shape,ue.shape,"Error in divideStrict: "),F.div(ue)}}),m.floorDiv=M.op({floorDiv_:function(W,te){var F,ue=I.convertToTensor(W,"a","floorDiv"),se=I.convertToTensor(te,"b","floorDiv");F=z.makeTypesMatch(ue,se),ue=F[0],se=F[1];var J=K.assertAndGetBroadcastShape(ue.shape,se.shape);return g.ENGINE.runKernelFunc(function(me,pe){var Oe=me.floorDiv(ue,se);return pe([ue,se]),Oe},{a:ue,b:se},function(me,pe){var Oe=pe[0],Fe=pe[1];return{a:function(){var Le=me.div(Fe.toFloat()),Ae=K.getReductionAxes(Oe.shape,J);return Ae.length>0?Le.sum(Ae).reshape(Oe.shape):Le},b:function(){var Le=me.mul(Oe.toFloat()),Ae=K.getReductionAxes(Fe.shape,J);Ae.length>0&&(Le=Le.sum(Ae).reshape(Fe.shape));var ft=Fe.square();return Le.div(ft.toFloat()).neg()}}},"FloorDiv")}}),m.maximum=M.op({maximum_:function(W,te){var F,ue=I.convertToTensor(W,"a","maximum"),se=I.convertToTensor(te,"b","maximum");return F=z.makeTypesMatch(ue,se),ue=F[0],se=F[1],ue.dtype==="bool"&&(ue=ue.toInt(),se=se.toInt()),K.assertAndGetBroadcastShape(ue.shape,se.shape),g.ENGINE.runKernelFunc(function(J,me){var pe=J.maximum(ue,se);return me([ue,se]),pe},{a:ue,b:se},function(J,me){var pe=me[0],Oe=me[1];return{a:function(){return J.mul(pe.greaterEqual(Oe).toFloat())},b:function(){return J.mul(pe.less(Oe).toFloat())}}},"Maximum")}}),m.maximumStrict=M.op({maximumStrict_:function(W,te){var F=I.convertToTensor(W,"a","maximumStrict"),ue=I.convertToTensor(te,"b","maximumStrict");return A.assertShapesMatch(F.shape,ue.shape,"Error in maximumStrict: "),F.maximum(ue)}}),m.minimum=M.op({minimum_:function(W,te){var F,ue=I.convertToTensor(W,"a","minimum"),se=I.convertToTensor(te,"b","minimum");return F=z.makeTypesMatch(ue,se),ue=F[0],se=F[1],ue.dtype==="bool"&&(ue=ue.toInt(),se=se.toInt()),K.assertAndGetBroadcastShape(ue.shape,se.shape),g.ENGINE.runKernelFunc(function(J,me){var pe=J.minimum(ue,se);return me([ue,se]),pe},{a:ue,b:se},function(J,me){var pe=me[0],Oe=me[1];return{a:function(){return J.mul(pe.lessEqual(Oe).toFloat())},b:function(){return J.mul(pe.greater(Oe).toFloat())}}},"Minimum")}}),m.minimumStrict=M.op({minimumStrict_:function(W,te){var F=I.convertToTensor(W,"a","minimumStrict"),ue=I.convertToTensor(te,"b","minimumStrict");return A.assertShapesMatch(F.shape,ue.shape,"Error in minimumStrict: "),F.minimum(ue)}}),m.mod=M.op({mod_:function(W,te){var F,ue=I.convertToTensor(W,"a","mod"),se=I.convertToTensor(te,"b","mod");F=z.makeTypesMatch(ue,se),ue=F[0],se=F[1];var J=K.assertAndGetBroadcastShape(ue.shape,se.shape);return g.ENGINE.runKernelFunc(function(me,pe){var Oe=me.mod(ue,se);return pe([ue,se]),Oe},{$a:ue,$b:se},function(me,pe){var Oe=pe[0],Fe=pe[1];return{$a:function(){var Le=K.getReductionAxes(Oe.shape,J);return Le.length>0?me.sum(Le).reshape(Oe.shape):me},$b:function(){var Le=me.mul(Oe.div(Fe).floor().neg()),Ae=K.getReductionAxes(Fe.shape,J);return Ae.length>0?Le.sum(Ae).reshape(Fe.shape):Le}}})}}),m.modStrict=M.op({modStrict_:function(W,te){var F=I.convertToTensor(W,"a","modStrict"),ue=I.convertToTensor(te,"b","modStrict");return A.assertShapesMatch(F.shape,ue.shape,"Error in modStrict: "),F.mod(ue)}}),m.mul=M.op({mul_:function(W,te){var F,ue=I.convertToTensor(W,"a","mul"),se=I.convertToTensor(te,"b","mul");F=z.makeTypesMatch(ue,se),ue=F[0],se=F[1];var J=K.assertAndGetBroadcastShape(ue.shape,se.shape);return g.ENGINE.runKernelFunc(function(me,pe){var Oe=me.multiply(ue,se);return pe([ue,se]),Oe},{a:ue,b:se},function(me,pe){var Oe=pe[0],Fe=pe[1];return{a:function(){var Le=me.mul(Fe.toFloat()),Ae=K.getReductionAxes(Oe.shape,J);return Ae.length>0?Le.sum(Ae).reshape(Oe.shape):Le},b:function(){var Le=me.mul(Oe.toFloat()),Ae=K.getReductionAxes(Fe.shape,J);return Ae.length>0?Le.sum(Ae).reshape(Fe.shape):Le}}},"Mul")}}),m.mulStrict=M.op({mulStrict_:function(W,te){var F=I.convertToTensor(W,"a","mul"),ue=I.convertToTensor(te,"b","mul");return A.assertShapesMatch(F.shape,ue.shape,"Error in multiplyStrict: "),F.mul(ue)}}),m.pow=M.op({pow_:function(W,te){var F,ue=I.convertToTensor(W,"base","pow"),se=I.convertToTensor(te,"exp","pow");F=z.makeTypesMatch(ue,se),ue=F[0],se=F[1];var J=K.assertAndGetBroadcastShape(ue.shape,se.shape),me=[ue,se];return g.ENGINE.runKernelFunc(function(pe,Oe){var Fe=pe.pow(ue,se);return Oe([ue,se,Fe]),Fe},{a:ue,b:se},function(pe,Oe){var Fe=Oe[0],Le=Oe[1],Ae=Oe[2];return{a:function(){var ft=Le.toFloat(),Mt=pe.mul(ft.mul(Fe.pow(ft.sub(V.scalar(1))))),Xt=K.getReductionAxes(Fe.shape,J);return Xt.length>0&&(Mt=Mt.sum(Xt)),Mt.reshape(Fe.shape)},b:function(){var ft=Fe.greater(0),Mt=Fe.log().where(ft,V.zerosLike(Fe)),Xt=pe.mul(Ae.mul(Mt)),tn=K.getReductionAxes(Le.shape,J);return tn.length>0&&(Xt=Xt.sum(tn)),Xt.reshape(Le.shape)}}},"Pow",{},me,[!0])}}),m.powStrict=M.op({powStrict_:function(W,te){return A.assertShapesMatch(W.shape,te.shape,"Error in powStrict: "),W.pow(te)}}),m.squaredDifferenceStrict=M.op({squaredDifferenceStrict_:function(W,te){var F=I.convertToTensor(W,"a","squaredDifferenceStrict"),ue=I.convertToTensor(te,"b","squaredDifferenceStrict");return A.assertShapesMatch(F.shape,ue.shape,"Error in squaredDifferenceStrict: "),F.squaredDifference(ue)}}),m.sub=M.op({sub_:function(W,te){var F,ue=I.convertToTensor(W,"a","sub"),se=I.convertToTensor(te,"b","sub");F=z.makeTypesMatch(ue,se),ue=F[0],se=F[1];var J=K.assertAndGetBroadcastShape(ue.shape,se.shape);return g.ENGINE.runKernelFunc(function(me){return me.subtract(ue,se)},{a:ue,b:se},function(me){return{a:function(){var pe=me,Oe=K.getReductionAxes(ue.shape,J);return Oe.length>0&&(pe=pe.sum(Oe)),pe.reshape(ue.shape)},b:function(){var pe=me,Oe=K.getReductionAxes(se.shape,J);return Oe.length>0&&(pe=pe.sum(Oe)),pe.neg().reshape(se.shape)}}},"Sub")}}),m.subStrict=M.op({subStrict_:function(W,te){var F=I.convertToTensor(W,"a","subStrict"),ue=I.convertToTensor(te,"b","subStrict");return A.assertShapesMatch(F.shape,ue.shape,"Error in subStrict: "),F.sub(ue)}})},function(j,m,o){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(205);o(33).Tensor.prototype.div=function(z){return g.div(this,z)}},function(j,m,o){/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(25),z=o(73),I=o(29),A=o(28);m.broadcastTo=A.op({broadcastTo_:function(X,K){var M=I.convertToTensor(X,"broadcastTo","x"),V=M.shape;if(K.some(function(me){return!(me>0)||me%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+K+"].");if(K.length<M.rank)throw new Error("broadcastTo(): shape.length="+K.length+" < input.rank="+M.rank+".");if(K.length>M.rank){for(var $=M.shape.slice();$.length<K.length;)$.unshift(1);M=M.reshape($)}for(var W=M.shape,te=Array.from(K),F=K.length-1;F>=0;F--)if(W[F]===K[F])te[F]=1;else if(M.shape[F]!==1)throw new Error("broadcastTo(): ["+V+"] cannot be broadcast to ["+K+"].");var ue=te.map(function(me,pe){return me>1?pe:-1}).filter(function(me){return me>=0});if(ue.length===0)return M.clone();var se={x:M},J={shape:K,inputShape:W};return g.ENGINE.runKernelFunc(function(me){return me.tile(M,te)},se,function(me){return{x:function(){return me.sum(ue,!0)}}},z.BroadcastTo,J)}})},function(j,m,o){/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(376);o(33).Tensor.prototype.broadcastTo=function(z){return g.broadcastTo(this,z)}},function(j,m,o){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var g,z,I,A;Object.defineProperty(m,"__esModule",{value:!0}),function(M){M.R0="R0",M.R1="R1",M.R2="R2",M.R3="R3",M.R4="R4",M.R5="R5",M.R6="R6"}(m.Rank||(m.Rank={})),function(M){M.float32="float32",M.int32="int32",M.bool="int32",M.complex64="complex64"}(g||(g={})),function(M){M.float32="float32",M.int32="int32",M.bool="bool",M.complex64="complex64"}(z||(z={})),function(M){M.float32="float32",M.int32="float32",M.bool="float32",M.complex64="complex64"}(I||(I={})),function(M){M.float32="complex64",M.int32="complex64",M.bool="complex64",M.complex64="complex64"}(A||(A={}));var X={float32:I,int32:g,bool:z,complex64:A};function K(M,V){if(M==="string"||V==="string"){if(M==="string"&&V==="string")return"string";throw new Error("Can not upcast "+M+" with "+V)}return X[M][V]}m.upcastType=K,m.sumOutType=function(M){return K(M,"int32")}},function(j,m,o){/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(21),z=20,I=3,A=7;function X(V,$,W){var te;return te=Array.isArray(V)?parseFloat(V[0].toFixed(A))+" + "+parseFloat(V[1].toFixed(A))+"j":g.isString(V)?"'"+V+"'":W==="bool"?K(V):parseFloat(V.toFixed(A)).toString(),g.rightPad(te,$)}function K(V){return V===0?"false":"true"}function M(V){for(var $=[],W=0;W<V.length;W+=2)$.push([V[W],V[W+1]]);return $}m.tensorToString=function(V,$,W,te){var F=g.computeStrides($),ue=function(pe,Oe,Fe,Le){var Ae=g.sizeFromShape(Oe),ft=Le[Le.length-1],Mt=new Array(ft).fill(0),Xt=Oe.length,tn=Fe==="complex64"?M(pe):pe;if(Xt>1)for(var Ce=0;Ce<Ae/ft;Ce++)for(var Wt=Ce*ft,en=0;en<ft;en++)Mt[en]=Math.max(Mt[en],X(tn[Wt+en],0,Fe).length);return Mt}(V,$,W,F),se=$.length,J=function pe(Oe,Fe,Le,Ae,ft,Mt){Mt===void 0&&(Mt=!0);var Xt=Le==="complex64"?2:1,tn=Fe[0],Ce=Fe.length;if(Ce===0){if(Le==="complex64"){var Wt=M(Oe);return[X(Wt[0],0,Le)]}return Le==="bool"?[K(Oe[0])]:[Oe[0].toString()]}if(Ce===1){if(tn>z){var en=I*Xt,Ut=Array.from(Oe.slice(0,en)),Qe=Array.from(Oe.slice((tn-I)*Xt,tn*Xt));return Le==="complex64"&&(Ut=M(Ut),Qe=M(Qe)),["["+Ut.map(function(pn,$e){return X(pn,ft[$e],Le)}).join(", ")+", ..., "+Qe.map(function(pn,$e){return X(pn,ft[tn-I+$e],Le)}).join(", ")+"]"]}var fn=Le==="complex64"?M(Oe):Array.from(Oe);return["["+fn.map(function(pn,$e){return X(pn,ft[$e],Le)}).join(", ")+"]"]}var on=Fe.slice(1),Ct=Ae.slice(1),Vt=Ae[0]*Xt,En=[];if(tn>z){for(var Pt=0;Pt<I;Pt++){var Rt=Pt*Vt,Tn=Rt+Vt;En.push.apply(En,pe(Oe.slice(Rt,Tn),on,Le,Ct,ft,!1))}En.push("...");for(var Pt=tn-I;Pt<tn;Pt++){var Rt=Pt*Vt,Tn=Rt+Vt;En.push.apply(En,pe(Oe.slice(Rt,Tn),on,Le,Ct,ft,Pt===tn-1))}}else for(var Pt=0;Pt<tn;Pt++){var Rt=Pt*Vt,Tn=Rt+Vt;En.push.apply(En,pe(Oe.slice(Rt,Tn),on,Le,Ct,ft,Pt===tn-1))}var Hn=Ce===2?",":"";En[0]="["+En[0]+Hn;for(var Pt=1;Pt<En.length-1;Pt++)En[Pt]=" "+En[Pt]+Hn;for(var tr=`,
`,Pt=2;Pt<Ce;Pt++)tr+=`
`;return En[En.length-1]=" "+En[En.length-1]+"]"+(Mt?"":tr),En}(V,$,W,F,ue),me=["Tensor"];return te&&(me.push("  dtype: "+W),me.push("  rank: "+se),me.push("  shape: ["+$+"]"),me.push("  values:")),me.push(J.map(function(pe){return"    "+pe}).join(`
`)),me.join(`
`)}},function(j,m,o){/**
* @license
* Copyright 2017 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(21);m.getFilteredNodesXToY=function(z,I,A){for(var X={},K={},M=0;M<I.length;M++)X[I[M].id]=!0;for(M=0;M<z.length;M++){var V=(me=z[M]).inputs;for(var $ in V){for(var W=V[$],te=!1,F=0;F<I.length;F++)if(X[W.id]){me.outputs.forEach(function(Le){return X[Le.id]=!0}),te=!0,K[me.id]=!0;break}if(te)break}}var ue={};ue[A.id]=!0;var se={};for(M=z.length-1;M>=0;M--)for(V=(me=z[M]).inputs,F=0;F<me.outputs.length;F++)if(ue[me.outputs[F].id]){for(var $ in V)ue[V[$].id]=!0,se[me.id]=!0;break}var J=[];for(M=0;M<z.length;M++){var me;if(K[(me=z[M]).id]&&se[me.id]){var pe={};for(var $ in me.inputs){var Oe=me.inputs[$];X[Oe.id]&&(pe[$]=Oe)}var Fe=Object.assign({},me);Fe.inputs=pe,Fe.outputs=me.outputs,J.push(Fe)}}return J},m.backpropagateGradients=function(z,I,A){for(var X=function(M){var V=I[M],$=[];if(V.outputs.forEach(function(ue){var se=z[ue.id];se!=null?$.push(se):$.push(null)}),V.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+V.kernelName+".");var W=V.gradient($),te=function(ue){if(!(ue in W))throw new Error("Cannot backprop through input "+ue+". Available gradients found: "+Object.keys(W)+".");var se=A(function(){return W[ue]()});if(se.dtype!=="float32")throw new Error("Error in gradient for op "+V.kernelName+". The gradient of input "+ue+" must have 'float32' dtype, but has '"+se.dtype+"'");var J=V.inputs[ue];if(!g.arraysEqual(se.shape,J.shape))throw new Error("Error in gradient for op "+V.kernelName+". The gradient of input '"+ue+"' has shape '"+se.shape+"', which does not match the shape of the input '"+J.shape+"'");if(z[J.id]==null)z[J.id]=se;else{var me=z[J.id];z[J.id]=me.add(se),me.dispose()}};for(var F in V.inputs)te(F)},K=I.length-1;K>=0;K--)X(K)}},function(j,m,o){/**
* @license
* Copyright 2018 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=o(21),z=function(){function X(K,M){this.backendTimer=K,this.logger=M,M==null&&(this.logger=new A)}return X.prototype.profileKernel=function(K,M,V){var $,W=this,te=this.backendTimer.time(function(){$=V()});return $.forEach(function(F){F.data().then(function(ue){I(ue,F.dtype,K),te.then(function(se){var J="";se.getExtraProfileInfo!=null&&(J=se.getExtraProfileInfo()),W.logger.logKernelProfile(K,F,ue,se.kernelMs,M,J)})})}),$},X}();function I(X,K,M){if(K!=="float32")return!1;for(var V=0;V<X.length;V++){var $=X[V];if(isNaN($)||!isFinite($))return console.warn("Found "+$+" in the result of '"+M+"'"),!0}return!1}m.Profiler=z,m.checkComputationForErrors=I;var A=function(){function X(){}return X.prototype.logKernelProfile=function(K,M,V,$,W,te){var F=typeof $=="number"?g.rightPad($+"ms",9):$.error,ue=g.rightPad(K,25),se=M.rank,J=M.size,me=g.rightPad(M.shape.toString(),14),pe="";for(var Oe in W){var Fe=W[Oe].shape||M.shape,Le=Fe.length;pe+=Oe+": "+Le+"D "+(Le>0?Fe:"")+" "}console.log("%c"+ue+"	%c"+F+"	%c"+se+"D "+me+"	%c"+J+"	%c"+pe+"	%c"+te,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},X}();m.Logger=A},function(j,m,o){/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Object.defineProperty(m,"__esModule",{value:!0});var g=new Map,z=new Map;function I(A,X){return X+"_"+A}m.getKernel=function(A,X){var K=I(A,X);return g.get(K)},m.getGradient=function(A){return z.get(A)},m.getKernelsForBackend=function(A){for(var X=g.entries(),K=[];;){var M=X.next(),V=M.done,$=M.value;if(V)break;var W=$[0],te=$[1];W.split("_")[0]===A&&K.push(te)}return K},m.registerKernel=function(A){var X=A.kernelName,K=A.backendName,M=I(X,K);if(g.has(M))throw new Error("The kernel '"+X+"' for backend '"+K+"' is already registered");g.set(M,A)},m.registerGradient=function(A){var X=A.kernelName;z.has(X)&&console.warn("Overriding the gradient for '"+X+"'"),z.set(X,A)},m.unregisterKernel=function(A,X){var K=I(A,X);if(!g.has(K))throw new Error("The kernel '"+A+"' for backend '"+X+"' is not registered");g.delete(K)},m.unregisterGradient=function(A){if(!z.has(A))throw new Error("The gradient '"+A+"' for backend is not registered");z.delete(A)}},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var g=o(206);o(33).Tensor.prototype.add=function(z){return g.add(this,z)}},function(j,m,o){Object.defineProperty(m,"__esModule",{value:!0}),o(383),o(377),o(375),o(371),o(363),o(361),o(359),o(357),o(355),o(353)},function(j,m){},function(j,m){},function(j,m){},function(j,m){},function(j,m){},function(j,m){},function(j,m,o){(function(g,z){(function(I,A){if(!I.setImmediate){var X,K=1,M={},V=!1,$=I.document,W=Object.getPrototypeOf&&Object.getPrototypeOf(I);W=W&&W.setTimeout?W:I,{}.toString.call(I.process)==="[object process]"?X=function(ue){z.nextTick(function(){F(ue)})}:function(){if(I.postMessage&&!I.importScripts){var ue=!0,se=I.onmessage;return I.onmessage=function(){ue=!1},I.postMessage("","*"),I.onmessage=se,ue}}()?function(){var ue="setImmediate$"+Math.random()+"$",se=function(J){J.source===I&&typeof J.data=="string"&&J.data.indexOf(ue)===0&&F(+J.data.slice(ue.length))};I.addEventListener?I.addEventListener("message",se,!1):I.attachEvent("onmessage",se),X=function(J){I.postMessage(ue+J,"*")}}():I.MessageChannel?function(){var ue=new MessageChannel;ue.port1.onmessage=function(se){F(se.data)},X=function(se){ue.port2.postMessage(se)}}():$&&"onreadystatechange"in $.createElement("script")?function(){var ue=$.documentElement;X=function(se){var J=$.createElement("script");J.onreadystatechange=function(){F(se),J.onreadystatechange=null,ue.removeChild(J),J=null},ue.appendChild(J)}}():X=function(ue){setTimeout(F,0,ue)},W.setImmediate=function(ue){typeof ue!="function"&&(ue=new Function(""+ue));for(var se=new Array(arguments.length-1),J=0;J<se.length;J++)se[J]=arguments[J+1];var me={callback:ue,args:se};return M[K]=me,X(K),K++},W.clearImmediate=te}function te(ue){delete M[ue]}function F(ue){if(V)setTimeout(F,0,ue);else{var se=M[ue];if(se){V=!0;try{(function(J){var me=J.callback,pe=J.args;switch(pe.length){case 0:me();break;case 1:me(pe[0]);break;case 2:me(pe[0],pe[1]);break;case 3:me(pe[0],pe[1],pe[2]);break;default:me.apply(A,pe)}})(se)}finally{te(ue),V=!1}}}}})(typeof self=="undefined"?g===void 0?this:g:self)}).call(this,o(59),o(75))},function(j,m){var o={}.toString;j.exports=Array.isArray||function(g){return o.call(g)=="[object Array]"}},function(j,m){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */m.read=function(o,g,z,I,A){var X,K,M=8*A-I-1,V=(1<<M)-1,$=V>>1,W=-7,te=z?A-1:0,F=z?-1:1,ue=o[g+te];for(te+=F,X=ue&(1<<-W)-1,ue>>=-W,W+=M;W>0;X=256*X+o[g+te],te+=F,W-=8);for(K=X&(1<<-W)-1,X>>=-W,W+=I;W>0;K=256*K+o[g+te],te+=F,W-=8);if(X===0)X=1-$;else{if(X===V)return K?NaN:1/0*(ue?-1:1);K+=Math.pow(2,I),X-=$}return(ue?-1:1)*K*Math.pow(2,X-I)},m.write=function(o,g,z,I,A,X){var K,M,V,$=8*X-A-1,W=(1<<$)-1,te=W>>1,F=A===23?Math.pow(2,-24)-Math.pow(2,-77):0,ue=I?0:X-1,se=I?1:-1,J=g<0||g===0&&1/g<0?1:0;for(g=Math.abs(g),isNaN(g)||g===1/0?(M=isNaN(g)?1:0,K=W):(K=Math.floor(Math.log(g)/Math.LN2),g*(V=Math.pow(2,-K))<1&&(K--,V*=2),(g+=K+te>=1?F/V:F*Math.pow(2,1-te))*V>=2&&(K++,V/=2),K+te>=W?(M=0,K=W):K+te>=1?(M=(g*V-1)*Math.pow(2,A),K+=te):(M=g*Math.pow(2,te-1)*Math.pow(2,A),K=0));A>=8;o[z+ue]=255&M,ue+=se,M/=256,A-=8);for(K=K<<A|M,$+=A;$>0;o[z+ue]=255&K,ue+=se,K/=256,$-=8);o[z+ue-se]|=128*J}},function(j,m,o){m.byteLength=function(W){var te=M(W),F=te[0],ue=te[1];return 3*(F+ue)/4-ue},m.toByteArray=function(W){var te,F,ue=M(W),se=ue[0],J=ue[1],me=new I(function(Fe,Le,Ae){return 3*(Le+Ae)/4-Ae}(0,se,J)),pe=0,Oe=J>0?se-4:se;for(F=0;F<Oe;F+=4)te=z[W.charCodeAt(F)]<<18|z[W.charCodeAt(F+1)]<<12|z[W.charCodeAt(F+2)]<<6|z[W.charCodeAt(F+3)],me[pe++]=te>>16&255,me[pe++]=te>>8&255,me[pe++]=255&te;return J===2&&(te=z[W.charCodeAt(F)]<<2|z[W.charCodeAt(F+1)]>>4,me[pe++]=255&te),J===1&&(te=z[W.charCodeAt(F)]<<10|z[W.charCodeAt(F+1)]<<4|z[W.charCodeAt(F+2)]>>2,me[pe++]=te>>8&255,me[pe++]=255&te),me},m.fromByteArray=function(W){for(var te,F=W.length,ue=F%3,se=[],J=0,me=F-ue;J<me;J+=16383)se.push($(W,J,J+16383>me?me:J+16383));return ue===1?(te=W[F-1],se.push(g[te>>2]+g[te<<4&63]+"==")):ue===2&&(te=(W[F-2]<<8)+W[F-1],se.push(g[te>>10]+g[te>>4&63]+g[te<<2&63]+"=")),se.join("")};for(var g=[],z=[],I=typeof Uint8Array!="undefined"?Uint8Array:Array,A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",X=0,K=A.length;X<K;++X)g[X]=A[X],z[A.charCodeAt(X)]=X;function M(W){var te=W.length;if(te%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var F=W.indexOf("=");return F===-1&&(F=te),[F,F===te?0:4-F%4]}function V(W){return g[W>>18&63]+g[W>>12&63]+g[W>>6&63]+g[63&W]}function $(W,te,F){for(var ue,se=[],J=te;J<F;J+=3)ue=(W[J]<<16&16711680)+(W[J+1]<<8&65280)+(255&W[J+2]),se.push(V(ue));return se.join("")}z["-".charCodeAt(0)]=62,z["_".charCodeAt(0)]=63},function(j,m){var o={}.hasOwnProperty;j.exports=function(g,z){return o.call(g,z)}},function(j,m){j.exports=function(o,g){return{enumerable:!(1&o),configurable:!(2&o),writable:!(4&o),value:g}}},function(j,m,o){var g=o(149);j.exports=function(z,I){if(!g(z))return z;var A,X;if(I&&typeof(A=z.toString)=="function"&&!g(X=A.call(z))||typeof(A=z.valueOf)=="function"&&!g(X=A.call(z))||!I&&typeof(A=z.toString)=="function"&&!g(X=A.call(z)))return X;throw TypeError("Can't convert object to primitive value")}},function(j,m,o){var g=o(149),z=o(150).document,I=g(z)&&g(z.createElement);j.exports=function(A){return I?z.createElement(A):{}}},function(j,m,o){j.exports=!o(148)&&!o(208)(function(){return Object.defineProperty(o(398)("div"),"a",{get:function(){return 7}}).a!=7})},function(j,m,o){var g=o(149);j.exports=function(z){if(!g(z))throw TypeError(z+" is not an object!");return z}},function(j,m,o){var g=o(400),z=o(399),I=o(397),A=Object.defineProperty;m.f=o(148)?Object.defineProperty:function(X,K,M){if(g(X),K=I(K,!0),g(M),z)try{return A(X,K,M)}catch{}if("get"in M||"set"in M)throw TypeError("Accessors not supported!");return"value"in M&&(X[K]=M.value),X}},function(j,m,o){var g=o(401),z=o(396);j.exports=o(148)?function(I,A,X){return g.f(I,A,z(1,X))}:function(I,A,X){return I[A]=X,I}},function(j,m){j.exports=function(o){if(typeof o!="function")throw TypeError(o+" is not a function!");return o}},function(j,m,o){var g=o(403);j.exports=function(z,I,A){if(g(z),I===void 0)return z;switch(A){case 1:return function(X){return z.call(I,X)};case 2:return function(X,K){return z.call(I,X,K)};case 3:return function(X,K,M){return z.call(I,X,K,M)}}return function(){return z.apply(I,arguments)}}},function(j,m,o){var g=o(150),z=o(209),I=o(404),A=o(402),X=o(395),K=function(M,V,$){var W,te,F,ue=M&K.F,se=M&K.G,J=M&K.S,me=M&K.P,pe=M&K.B,Oe=M&K.W,Fe=se?z:z[V]||(z[V]={}),Le=Fe.prototype,Ae=se?g:J?g[V]:(g[V]||{}).prototype;for(W in se&&($=V),$)(te=!ue&&Ae&&Ae[W]!==void 0)&&X(Fe,W)||(F=te?Ae[W]:$[W],Fe[W]=se&&typeof Ae[W]!="function"?$[W]:pe&&te?I(F,g):Oe&&Ae[W]==F?function(ft){var Mt=function(Xt,tn,Ce){if(this instanceof ft){switch(arguments.length){case 0:return new ft;case 1:return new ft(Xt);case 2:return new ft(Xt,tn)}return new ft(Xt,tn,Ce)}return ft.apply(this,arguments)};return Mt.prototype=ft.prototype,Mt}(F):me&&typeof F=="function"?I(Function.call,F):F,me&&((Fe.virtual||(Fe.virtual={}))[W]=F,M&K.R&&Le&&!Le[W]&&A(Le,W,F)))};K.F=1,K.G=2,K.S=4,K.P=8,K.B=16,K.W=32,K.U=64,K.R=128,j.exports=K},function(j,m,o){var g=o(405);g(g.G,{global:o(150)})},function(j,m,o){o(406),j.exports=o(209).global},function(j,m,o){var g=function(z){var I,A=Object.prototype,X=A.hasOwnProperty,K=typeof Symbol=="function"?Symbol:{},M=K.iterator||"@@iterator",V=K.asyncIterator||"@@asyncIterator",$=K.toStringTag||"@@toStringTag";function W(Ct,Vt,En){return Object.defineProperty(Ct,Vt,{value:En,enumerable:!0,configurable:!0,writable:!0}),Ct[Vt]}try{W({},"")}catch{W=function(Vt,En,Pt){return Vt[En]=Pt}}function te(Ct,Vt,En,Pt){var Rt=Vt&&Vt.prototype instanceof Oe?Vt:Oe,Tn=Object.create(Rt.prototype),Hn=new Qe(Pt||[]);return Tn._invoke=function(tr,pn,$e){var et=ue;return function(Ke,yt){if(et===J)throw new Error("Generator is already running");if(et===me){if(Ke==="throw")throw yt;return on()}for($e.method=Ke,$e.arg=yt;;){var Dt=$e.delegate;if(Dt){var Lt=Wt(Dt,$e);if(Lt){if(Lt===pe)continue;return Lt}}if($e.method==="next")$e.sent=$e._sent=$e.arg;else if($e.method==="throw"){if(et===ue)throw et=me,$e.arg;$e.dispatchException($e.arg)}else $e.method==="return"&&$e.abrupt("return",$e.arg);et=J;var zn=F(tr,pn,$e);if(zn.type==="normal"){if(et=$e.done?me:se,zn.arg===pe)continue;return{value:zn.arg,done:$e.done}}zn.type==="throw"&&(et=me,$e.method="throw",$e.arg=zn.arg)}}}(Ct,En,Hn),Tn}function F(Ct,Vt,En){try{return{type:"normal",arg:Ct.call(Vt,En)}}catch(Pt){return{type:"throw",arg:Pt}}}z.wrap=te;var ue="suspendedStart",se="suspendedYield",J="executing",me="completed",pe={};function Oe(){}function Fe(){}function Le(){}var Ae={};W(Ae,M,function(){return this});var ft=Object.getPrototypeOf,Mt=ft&&ft(ft(fn([])));Mt&&Mt!==A&&X.call(Mt,M)&&(Ae=Mt);var Xt=Le.prototype=Oe.prototype=Object.create(Ae);function tn(Ct){["next","throw","return"].forEach(function(Vt){W(Ct,Vt,function(En){return this._invoke(Vt,En)})})}function Ce(Ct,Vt){var En;this._invoke=function(Pt,Rt){function Tn(){return new Vt(function(Hn,tr){(function pn($e,et,Ke,yt){var Dt=F(Ct[$e],Ct,et);if(Dt.type!=="throw"){var Lt=Dt.arg,zn=Lt.value;return zn&&typeof zn=="object"&&X.call(zn,"__await")?Vt.resolve(zn.__await).then(function(Cn){pn("next",Cn,Ke,yt)},function(Cn){pn("throw",Cn,Ke,yt)}):Vt.resolve(zn).then(function(Cn){Lt.value=Cn,Ke(Lt)},function(Cn){return pn("throw",Cn,Ke,yt)})}yt(Dt.arg)})(Pt,Rt,Hn,tr)})}return En=En?En.then(Tn,Tn):Tn()}}function Wt(Ct,Vt){var En=Ct.iterator[Vt.method];if(En===I){if(Vt.delegate=null,Vt.method==="throw"){if(Ct.iterator.return&&(Vt.method="return",Vt.arg=I,Wt(Ct,Vt),Vt.method==="throw"))return pe;Vt.method="throw",Vt.arg=new TypeError("The iterator does not provide a 'throw' method")}return pe}var Pt=F(En,Ct.iterator,Vt.arg);if(Pt.type==="throw")return Vt.method="throw",Vt.arg=Pt.arg,Vt.delegate=null,pe;var Rt=Pt.arg;return Rt?Rt.done?(Vt[Ct.resultName]=Rt.value,Vt.next=Ct.nextLoc,Vt.method!=="return"&&(Vt.method="next",Vt.arg=I),Vt.delegate=null,pe):Rt:(Vt.method="throw",Vt.arg=new TypeError("iterator result is not an object"),Vt.delegate=null,pe)}function en(Ct){var Vt={tryLoc:Ct[0]};1 in Ct&&(Vt.catchLoc=Ct[1]),2 in Ct&&(Vt.finallyLoc=Ct[2],Vt.afterLoc=Ct[3]),this.tryEntries.push(Vt)}function Ut(Ct){var Vt=Ct.completion||{};Vt.type="normal",delete Vt.arg,Ct.completion=Vt}function Qe(Ct){this.tryEntries=[{tryLoc:"root"}],Ct.forEach(en,this),this.reset(!0)}function fn(Ct){if(Ct){var Vt=Ct[M];if(Vt)return Vt.call(Ct);if(typeof Ct.next=="function")return Ct;if(!isNaN(Ct.length)){var En=-1,Pt=function Rt(){for(;++En<Ct.length;)if(X.call(Ct,En))return Rt.value=Ct[En],Rt.done=!1,Rt;return Rt.value=I,Rt.done=!0,Rt};return Pt.next=Pt}}return{next:on}}function on(){return{value:I,done:!0}}return Fe.prototype=Le,W(Xt,"constructor",Le),W(Le,"constructor",Fe),Fe.displayName=W(Le,$,"GeneratorFunction"),z.isGeneratorFunction=function(Ct){var Vt=typeof Ct=="function"&&Ct.constructor;return!!Vt&&(Vt===Fe||(Vt.displayName||Vt.name)==="GeneratorFunction")},z.mark=function(Ct){return Object.setPrototypeOf?Object.setPrototypeOf(Ct,Le):(Ct.__proto__=Le,W(Ct,$,"GeneratorFunction")),Ct.prototype=Object.create(Xt),Ct},z.awrap=function(Ct){return{__await:Ct}},tn(Ce.prototype),W(Ce.prototype,V,function(){return this}),z.AsyncIterator=Ce,z.async=function(Ct,Vt,En,Pt,Rt){Rt===void 0&&(Rt=Promise);var Tn=new Ce(te(Ct,Vt,En,Pt),Rt);return z.isGeneratorFunction(Vt)?Tn:Tn.next().then(function(Hn){return Hn.done?Hn.value:Tn.next()})},tn(Xt),W(Xt,$,"Generator"),W(Xt,M,function(){return this}),W(Xt,"toString",function(){return"[object Generator]"}),z.keys=function(Ct){var Vt=[];for(var En in Ct)Vt.push(En);return Vt.reverse(),function Pt(){for(;Vt.length;){var Rt=Vt.pop();if(Rt in Ct)return Pt.value=Rt,Pt.done=!1,Pt}return Pt.done=!0,Pt}},z.values=fn,Qe.prototype={constructor:Qe,reset:function(Ct){if(this.prev=0,this.next=0,this.sent=this._sent=I,this.done=!1,this.delegate=null,this.method="next",this.arg=I,this.tryEntries.forEach(Ut),!Ct)for(var Vt in this)Vt.charAt(0)==="t"&&X.call(this,Vt)&&!isNaN(+Vt.slice(1))&&(this[Vt]=I)},stop:function(){this.done=!0;var Ct=this.tryEntries[0].completion;if(Ct.type==="throw")throw Ct.arg;return this.rval},dispatchException:function(Ct){if(this.done)throw Ct;var Vt=this;function En(pn,$e){return Tn.type="throw",Tn.arg=Ct,Vt.next=pn,$e&&(Vt.method="next",Vt.arg=I),!!$e}for(var Pt=this.tryEntries.length-1;Pt>=0;--Pt){var Rt=this.tryEntries[Pt],Tn=Rt.completion;if(Rt.tryLoc==="root")return En("end");if(Rt.tryLoc<=this.prev){var Hn=X.call(Rt,"catchLoc"),tr=X.call(Rt,"finallyLoc");if(Hn&&tr){if(this.prev<Rt.catchLoc)return En(Rt.catchLoc,!0);if(this.prev<Rt.finallyLoc)return En(Rt.finallyLoc)}else if(Hn){if(this.prev<Rt.catchLoc)return En(Rt.catchLoc,!0)}else{if(!tr)throw new Error("try statement without catch or finally");if(this.prev<Rt.finallyLoc)return En(Rt.finallyLoc)}}}},abrupt:function(Ct,Vt){for(var En=this.tryEntries.length-1;En>=0;--En){var Pt=this.tryEntries[En];if(Pt.tryLoc<=this.prev&&X.call(Pt,"finallyLoc")&&this.prev<Pt.finallyLoc){var Rt=Pt;break}}Rt&&(Ct==="break"||Ct==="continue")&&Rt.tryLoc<=Vt&&Vt<=Rt.finallyLoc&&(Rt=null);var Tn=Rt?Rt.completion:{};return Tn.type=Ct,Tn.arg=Vt,Rt?(this.method="next",this.next=Rt.finallyLoc,pe):this.complete(Tn)},complete:function(Ct,Vt){if(Ct.type==="throw")throw Ct.arg;return Ct.type==="break"||Ct.type==="continue"?this.next=Ct.arg:Ct.type==="return"?(this.rval=this.arg=Ct.arg,this.method="return",this.next="end"):Ct.type==="normal"&&Vt&&(this.next=Vt),pe},finish:function(Ct){for(var Vt=this.tryEntries.length-1;Vt>=0;--Vt){var En=this.tryEntries[Vt];if(En.finallyLoc===Ct)return this.complete(En.completion,En.afterLoc),Ut(En),pe}},catch:function(Ct){for(var Vt=this.tryEntries.length-1;Vt>=0;--Vt){var En=this.tryEntries[Vt];if(En.tryLoc===Ct){var Pt=En.completion;if(Pt.type==="throw"){var Rt=Pt.arg;Ut(En)}return Rt}}throw new Error("illegal catch attempt")},delegateYield:function(Ct,Vt,En){return this.delegate={iterator:fn(Ct),resultName:Vt,nextLoc:En},this.method==="next"&&(this.arg=I),pe}},z}(j.exports);try{regeneratorRuntime=g}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=g:Function("r","regeneratorRuntime = r")(g)}},function(j,m,o){for(var g=o(155),z=o(82),I=o(38),A=o(16),X=o(42),K=o(96),M=o(19),V=M("iterator"),$=M("toStringTag"),W=K.Array,te={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},F=z(te),ue=0;ue<F.length;ue++){var se,J=F[ue],me=te[J],pe=A[J],Oe=pe&&pe.prototype;if(Oe&&(Oe[V]||X(Oe,V,W),Oe[$]||X(Oe,$,J),K[J]=W,me))for(se in g)Oe[se]||I(Oe,se,g[se],!0)}},function(j,m,o){var g=o(8),z=o(152);g(g.G+g.B,{setImmediate:z.set,clearImmediate:z.clear})},function(j,m,o){var g=o(16),z=o(8),I=o(120),A=[].slice,X=/MSIE .\./.test(I),K=function(M){return function(V,$){var W=arguments.length>2,te=!!W&&A.call(arguments,2);return M(W?function(){(typeof V=="function"?V:Function(V)).apply(this,te)}:V,$)}};z(z.G+z.B+z.F*X,{setTimeout:K(g.setTimeout),setInterval:K(g.setInterval)})},function(j,m,o){o(411),o(410),o(409),j.exports=o(24)},function(j,m,o){var g=o(8),z=o(24),I=o(16),A=o(104),X=o(216);g(g.P+g.R,"Promise",{finally:function(K){var M=A(this,z.Promise||I.Promise),V=typeof K=="function";return this.then(V?function($){return X(M,K()).then(function(){return $})}:K,V?function($){return X(M,K()).then(function(){throw $})}:K)}})},function(j,m,o){o(218),o(413),j.exports=o(24).Promise.finally},function(j,m,o){var g=o(8),z=o(210)(!0);g(g.S,"Object",{entries:function(I){return z(I)}})},function(j,m,o){o(415),j.exports=o(24).Object.entries},function(j,m,o){var g=o(8),z=o(210)(!1);g(g.S,"Object",{values:function(I){return z(I)}})},function(j,m,o){o(417),j.exports=o(24).Object.values},function(j,m,o){var g=o(8),z=o(212),I=o(41),A=o(53),X=o(158);g(g.S,"Object",{getOwnPropertyDescriptors:function(K){for(var M,V,$=I(K),W=A.f,te=z($),F={},ue=0;te.length>ue;)(V=W($,M=te[ue++]))!==void 0&&X(F,M,V);return F}})},function(j,m,o){o(419),j.exports=o(24).Object.getOwnPropertyDescriptors},function(j,m,o){o(239)("asyncIterator")},function(j,m,o){o(421),j.exports=o(174).f("asyncIterator")},function(j,m,o){o(97)("trimRight",function(g){return function(){return g(this,2)}},"trimEnd")},function(j,m,o){o(423),j.exports=o(24).String.trimRight},function(j,m,o){o(97)("trimLeft",function(g){return function(){return g(this,1)}},"trimStart")},function(j,m,o){o(425),j.exports=o(24).String.trimLeft},function(j,m,o){var g=o(8),z=o(211),I=o(120),A=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(I);g(g.P+g.F*A,"String",{padEnd:function(X){return z(this,X,arguments.length>1?arguments[1]:void 0,!1)}})},function(j,m,o){o(427),j.exports=o(24).String.padEnd},function(j,m,o){var g=o(8),z=o(211),I=o(120),A=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(I);g(g.P+g.F*A,"String",{padStart:function(X){return z(this,X,arguments.length>1?arguments[1]:void 0,!0)}})},function(j,m,o){o(429),j.exports=o(24).String.padStart},function(j,m,o){var g=o(126),z=o(13),I=o(22),A=o(56),X=o(19)("isConcatSpreadable");j.exports=function K(M,V,$,W,te,F,ue,se){for(var J,me,pe=te,Oe=0,Fe=!!ue&&A(ue,se,3);Oe<W;){if(Oe in $){if(J=Fe?Fe($[Oe],Oe,V):$[Oe],me=!1,z(J)&&(me=(me=J[X])!==void 0?!!me:g(J)),me&&F>0)pe=K(M,V,J,I(J.length),pe,F-1)-1;else{if(pe>=9007199254740991)throw TypeError();M[pe]=J}pe++}Oe++}return pe}},function(j,m,o){var g=o(8),z=o(431),I=o(34),A=o(22),X=o(55),K=o(224);g(g.P,"Array",{flatMap:function(M){var V,$,W=I(this);return X(M),V=A(W.length),$=K(W,0),z($,W,W,V,0,1,M,arguments[1]),$}}),o(77)("flatMap")},function(j,m,o){o(432),j.exports=o(24).Array.flatMap},function(j,m,o){var g=o(8),z=o(128)(!0);g(g.P,"Array",{includes:function(I){return z(this,I,arguments.length>1?arguments[1]:void 0)}}),o(77)("includes")},function(j,m,o){o(434),j.exports=o(24).Array.includes},function(j,m,o){var g=o(8),z=o(170);z&&g(g.S,"Reflect",{setPrototypeOf:function(I,A){z.check(I,A);try{return z.set(I,A),!0}catch{return!1}}})},function(j,m,o){var g=o(26),z=o(53),I=o(78),A=o(43),X=o(8),K=o(85),M=o(14),V=o(13);X(X.S,"Reflect",{set:function $(W,te,F){var ue,se,J=arguments.length<4?W:arguments[3],me=z.f(M(W),te);if(!me){if(V(se=I(W)))return $(se,te,F,J);me=K(0)}if(A(me,"value")){if(me.writable===!1||!V(J))return!1;if(ue=z.f(J,te)){if(ue.get||ue.set||ue.writable===!1)return!1;ue.value=F,g.f(J,te,ue)}else g.f(J,te,K(0,F));return!0}return me.set!==void 0&&(me.set.call(J,F),!0)}})},function(j,m,o){var g=o(8),z=o(14),I=Object.preventExtensions;g(g.S,"Reflect",{preventExtensions:function(A){z(A);try{return I&&I(A),!0}catch{return!1}}})},function(j,m,o){var g=o(8);g(g.S,"Reflect",{ownKeys:o(212)})},function(j,m,o){var g=o(8),z=o(14),I=Object.isExtensible;g(g.S,"Reflect",{isExtensible:function(A){return z(A),!I||I(A)}})},function(j,m,o){var g=o(8);g(g.S,"Reflect",{has:function(z,I){return I in z}})},function(j,m,o){var g=o(8),z=o(78),I=o(14);g(g.S,"Reflect",{getPrototypeOf:function(A){return z(I(A))}})},function(j,m,o){var g=o(53),z=o(8),I=o(14);z(z.S,"Reflect",{getOwnPropertyDescriptor:function(A,X){return g.f(I(A),X)}})},function(j,m,o){var g=o(53),z=o(78),I=o(43),A=o(8),X=o(13),K=o(14);A(A.S,"Reflect",{get:function M(V,$){var W,te,F=arguments.length<3?V:arguments[2];return K(V)===F?V[$]:(W=g.f(V,$))?I(W,"value")?W.value:W.get!==void 0?W.get.call(F):void 0:X(te=z(V))?M(te,$,F):void 0}})},function(j,m,o){var g=o(8),z=o(14),I=function(A){this._t=z(A),this._i=0;var X,K=this._k=[];for(X in A)K.push(X)};o(226)(I,"Object",function(){var A,X=this._k;do if(this._i>=X.length)return{value:void 0,done:!0};while(!((A=X[this._i++])in this._t));return{value:A,done:!1}}),g(g.S,"Reflect",{enumerate:function(A){return new I(A)}})},function(j,m,o){var g=o(8),z=o(53).f,I=o(14);g(g.S,"Reflect",{deleteProperty:function(A,X){var K=z(I(A),X);return!(K&&!K.configurable)&&delete A[X]}})},function(j,m,o){var g=o(26),z=o(8),I=o(14),A=o(66);z(z.S+z.F*o(15)(function(){Reflect.defineProperty(g.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(X,K,M){I(X),K=A(K,!0),I(M);try{return g.f(X,K,M),!0}catch{return!1}}})},function(j,m,o){var g=o(8),z=o(80),I=o(55),A=o(14),X=o(13),K=o(15),M=o(233),V=(o(16).Reflect||{}).construct,$=K(function(){function te(){}return!(V(function(){},[],te)instanceof te)}),W=!K(function(){V(function(){})});g(g.S+g.F*($||W),"Reflect",{construct:function(te,F){I(te),A(F);var ue=arguments.length<3?te:I(arguments[2]);if(W&&!$)return V(te,F,ue);if(te==ue){switch(F.length){case 0:return new te;case 1:return new te(F[0]);case 2:return new te(F[0],F[1]);case 3:return new te(F[0],F[1],F[2]);case 4:return new te(F[0],F[1],F[2],F[3])}var se=[null];return se.push.apply(se,F),new(M.apply(te,se))}var J=ue.prototype,me=z(X(J)?J:Object.prototype),pe=Function.apply.call(te,me,F);return X(pe)?pe:me}})},function(j,m,o){var g=o(8),z=o(55),I=o(14),A=(o(16).Reflect||{}).apply,X=Function.apply;g(g.S+g.F*!o(15)(function(){A(function(){})}),"Reflect",{apply:function(K,M,V){var $=z(K),W=I(V);return A?A($,M,W):X.call($,M,W)}})},function(j,m,o){o(60)("Float64",8,function(g){return function(z,I,A){return g(this,z,I,A)}})},function(j,m,o){o(60)("Float32",4,function(g){return function(z,I,A){return g(this,z,I,A)}})},function(j,m,o){o(60)("Uint32",4,function(g){return function(z,I,A){return g(this,z,I,A)}})},function(j,m,o){o(60)("Int32",4,function(g){return function(z,I,A){return g(this,z,I,A)}})},function(j,m,o){o(60)("Uint16",2,function(g){return function(z,I,A){return g(this,z,I,A)}})},function(j,m,o){o(60)("Int16",2,function(g){return function(z,I,A){return g(this,z,I,A)}})},function(j,m,o){o(60)("Uint8",1,function(g){return function(z,I,A){return g(this,z,I,A)}},!0)},function(j,m,o){o(60)("Uint8",1,function(g){return function(z,I,A){return g(this,z,I,A)}})},function(j,m,o){o(60)("Int8",1,function(g){return function(z,I,A){return g(this,z,I,A)}})},function(j,m,o){var g=o(8);g(g.G+g.W+g.F*!o(118).ABV,{DataView:o(151).DataView})},function(j,m,o){var g=o(8),z=o(118),I=o(151),A=o(14),X=o(81),K=o(22),M=o(13),V=o(16).ArrayBuffer,$=o(104),W=I.ArrayBuffer,te=I.DataView,F=z.ABV&&V.isView,ue=W.prototype.slice,se=z.VIEW;g(g.G+g.W+g.F*(V!==W),{ArrayBuffer:W}),g(g.S+g.F*!z.CONSTR,"ArrayBuffer",{isView:function(J){return F&&F(J)||M(J)&&se in J}}),g(g.P+g.U+g.F*o(15)(function(){return!new W(2).slice(1,void 0).byteLength}),"ArrayBuffer",{slice:function(J,me){if(ue!==void 0&&me===void 0)return ue.call(A(this),J);for(var pe=A(this).byteLength,Oe=X(J,pe),Fe=X(me===void 0?pe:me,pe),Le=new($(this,W))(K(Fe-Oe)),Ae=new te(this),ft=new te(Le),Mt=0;Oe<Fe;)ft.setUint8(Mt++,Ae.getUint8(Oe++));return Le}}),o(95)("ArrayBuffer")},function(j,m,o){var g=o(214),z=o(76);o(119)("WeakSet",function(I){return function(){return I(this,arguments.length>0?arguments[0]:void 0)}},{add:function(I){return g.def(z(this,"WeakSet"),I,!0)}},g,!1,!0)},function(j,m,o){var g,z=o(16),I=o(51)(0),A=o(38),X=o(65),K=o(235),M=o(214),V=o(13),$=o(76),W=o(76),te=!z.ActiveXObject&&"ActiveXObject"in z,F=X.getWeak,ue=Object.isExtensible,se=M.ufstore,J=function(Oe){return function(){return Oe(this,arguments.length>0?arguments[0]:void 0)}},me={get:function(Oe){if(V(Oe)){var Fe=F(Oe);return Fe===!0?se($(this,"WeakMap")).get(Oe):Fe?Fe[this._i]:void 0}},set:function(Oe,Fe){return M.def($(this,"WeakMap"),Oe,Fe)}},pe=j.exports=o(119)("WeakMap",J,me,M,!0,!0);W&&te&&(K((g=M.getConstructor(J,"WeakMap")).prototype,me),X.NEED=!0,I(["delete","has","get","set"],function(Oe){var Fe=pe.prototype,Le=Fe[Oe];A(Fe,Oe,function(Ae,ft){if(V(Ae)&&!ue(Ae)){this._f||(this._f=new g);var Mt=this._f[Oe](Ae,ft);return Oe=="set"?this:Mt}return Le.call(this,Ae,ft)})}))},function(j,m,o){var g=o(215),z=o(76);j.exports=o(119)("Set",function(I){return function(){return I(this,arguments.length>0?arguments[0]:void 0)}},{add:function(I){return g.def(z(this,"Set"),I=I===0?0:I,I)}},g)},function(j,m,o){var g=o(215),z=o(76);j.exports=o(119)("Map",function(I){return function(){return I(this,arguments.length>0?arguments[0]:void 0)}},{get:function(I){var A=g.getEntry(z(this,"Map"),I);return A&&A.v},set:function(I,A){return g.def(z(this,"Map"),I===0?0:I,A)}},g,!0)},function(j,m){j.exports=function(o){try{return{e:!1,v:o()}}catch(g){return{e:!0,v:g}}}},function(j,m,o){var g=o(16),z=o(152).set,I=g.MutationObserver||g.WebKitMutationObserver,A=g.process,X=g.Promise,K=o(62)(A)=="process";j.exports=function(){var M,V,$,W=function(){var se,J;for(K&&(se=A.domain)&&se.exit();M;){J=M.fn,M=M.next;try{J()}catch(me){throw M?$():V=void 0,me}}V=void 0,se&&se.enter()};if(K)$=function(){A.nextTick(W)};else if(!I||g.navigator&&g.navigator.standalone)if(X&&X.resolve){var te=X.resolve(void 0);$=function(){te.then(W)}}else $=function(){z.call(g,W)};else{var F=!0,ue=document.createTextNode("");new I(W).observe(ue,{characterData:!0}),$=function(){ue.data=F=!F}}return function(se){var J={fn:se,next:void 0};V&&(V.next=J),M||(M=J,$()),V=J}}},function(j,m,o){var g=o(161),z=o(14),I=o(104),A=o(153),X=o(22),K=o(123),M=o(154),V=o(15),$=Math.min,W=[].push,te=!V(function(){});o(122)("split",2,function(F,ue,se,J){var me;return me="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||".".split(/()()/).length>1||"".split(/.?/).length?function(pe,Oe){var Fe=String(this);if(pe===void 0&&Oe===0)return[];if(!g(pe))return se.call(Fe,pe,Oe);for(var Le,Ae,ft,Mt=[],Xt=(pe.ignoreCase?"i":"")+(pe.multiline?"m":"")+(pe.unicode?"u":"")+(pe.sticky?"y":""),tn=0,Ce=Oe===void 0?4294967295:Oe>>>0,Wt=new RegExp(pe.source,Xt+"g");(Le=M.call(Wt,Fe))&&!((Ae=Wt.lastIndex)>tn&&(Mt.push(Fe.slice(tn,Le.index)),Le.length>1&&Le.index<Fe.length&&W.apply(Mt,Le.slice(1)),ft=Le[0].length,tn=Ae,Mt.length>=Ce));)Wt.lastIndex===Le.index&&Wt.lastIndex++;return tn===Fe.length?!ft&&Wt.test("")||Mt.push(""):Mt.push(Fe.slice(tn)),Mt.length>Ce?Mt.slice(0,Ce):Mt}:"0".split(void 0,0).length?function(pe,Oe){return pe===void 0&&Oe===0?[]:se.call(this,pe,Oe)}:se,[function(pe,Oe){var Fe=F(this),Le=pe==null?void 0:pe[ue];return Le!==void 0?Le.call(pe,Fe,Oe):me.call(String(Fe),pe,Oe)},function(pe,Oe){var Fe=J(me,pe,this,Oe,me!==se);if(Fe.done)return Fe.value;var Le=z(pe),Ae=String(this),ft=I(Le,RegExp),Mt=Le.unicode,Xt=(Le.ignoreCase?"i":"")+(Le.multiline?"m":"")+(Le.unicode?"u":"")+(te?"y":"g"),tn=new ft(te?Le:"^(?:"+Le.source+")",Xt),Ce=Oe===void 0?4294967295:Oe>>>0;if(Ce===0)return[];if(Ae.length===0)return K(tn,Ae)===null?[Ae]:[];for(var Wt=0,en=0,Ut=[];en<Ae.length;){tn.lastIndex=te?en:0;var Qe,fn=K(tn,te?Ae:Ae.slice(en));if(fn===null||(Qe=$(X(tn.lastIndex+(te?0:en)),Ae.length))===Wt)en=A(Ae,en,Mt);else{if(Ut.push(Ae.slice(Wt,en)),Ut.length===Ce)return Ut;for(var on=1;on<=fn.length-1;on++)if(Ut.push(fn[on]),Ut.length===Ce)return Ut;en=Wt=Qe}}return Ut.push(Ae.slice(Wt)),Ut}]})},function(j,m,o){var g=o(14),z=o(234),I=o(123);o(122)("search",1,function(A,X,K,M){return[function(V){var $=A(this),W=V==null?void 0:V[X];return W!==void 0?W.call(V,$):new RegExp(V)[X](String($))},function(V){var $=M(K,V,this);if($.done)return $.value;var W=g(V),te=String(this),F=W.lastIndex;z(F,0)||(W.lastIndex=0);var ue=I(W,te);return z(W.lastIndex,F)||(W.lastIndex=F),ue===null?-1:ue.index}]})},function(j,m,o){var g=o(14),z=o(34),I=o(22),A=o(54),X=o(153),K=o(123),M=Math.max,V=Math.min,$=Math.floor,W=/\$([$&`']|\d\d?|<[^>]*>)/g,te=/\$([$&`']|\d\d?)/g,F=function(ue){return ue===void 0?ue:String(ue)};o(122)("replace",2,function(ue,se,J,me){return[function(Oe,Fe){var Le=ue(this),Ae=Oe==null?void 0:Oe[se];return Ae!==void 0?Ae.call(Oe,Le,Fe):J.call(String(Le),Oe,Fe)},function(Oe,Fe){var Le=me(J,Oe,this,Fe);if(Le.done)return Le.value;var Ae=g(Oe),ft=String(this),Mt=typeof Fe=="function";Mt||(Fe=String(Fe));var Xt=Ae.global;if(Xt){var tn=Ae.unicode;Ae.lastIndex=0}for(var Ce=[];;){var Wt=K(Ae,ft);if(Wt===null||(Ce.push(Wt),!Xt))break;String(Wt[0])===""&&(Ae.lastIndex=X(ft,I(Ae.lastIndex),tn))}for(var en="",Ut=0,Qe=0;Qe<Ce.length;Qe++){Wt=Ce[Qe];for(var fn=String(Wt[0]),on=M(V(A(Wt.index),ft.length),0),Ct=[],Vt=1;Vt<Wt.length;Vt++)Ct.push(F(Wt[Vt]));var En=Wt.groups;if(Mt){var Pt=[fn].concat(Ct,on,ft);En!==void 0&&Pt.push(En);var Rt=String(Fe.apply(void 0,Pt))}else Rt=pe(fn,ft,on,Ct,En,Fe);on>=Ut&&(en+=ft.slice(Ut,on)+Rt,Ut=on+fn.length)}return en+ft.slice(Ut)}];function pe(Oe,Fe,Le,Ae,ft,Mt){var Xt=Le+Oe.length,tn=Ae.length,Ce=te;return ft!==void 0&&(ft=z(ft),Ce=W),J.call(Mt,Ce,function(Wt,en){var Ut;switch(en.charAt(0)){case"$":return"$";case"&":return Oe;case"`":return Fe.slice(0,Le);case"'":return Fe.slice(Xt);case"<":Ut=ft[en.slice(1,-1)];break;default:var Qe=+en;if(Qe===0)return Wt;if(Qe>tn){var fn=$(Qe/10);return fn===0?Wt:fn<=tn?Ae[fn-1]===void 0?en.charAt(1):Ae[fn-1]+en.charAt(1):Wt}Ut=Ae[Qe-1]}return Ut===void 0?"":Ut})}})},function(j,m,o){var g=o(14),z=o(22),I=o(153),A=o(123);o(122)("match",1,function(X,K,M,V){return[function($){var W=X(this),te=$==null?void 0:$[K];return te!==void 0?te.call($,W):new RegExp($)[K](String(W))},function($){var W=V(M,$,this);if(W.done)return W.value;var te=g($),F=String(this);if(!te.global)return A(te,F);var ue=te.unicode;te.lastIndex=0;for(var se,J=[],me=0;(se=A(te,F))!==null;){var pe=String(se[0]);J[me]=pe,pe===""&&(te.lastIndex=I(F,z(te.lastIndex),ue)),me++}return me===0?null:J}]})},function(j,m,o){o(219);var g=o(14),z=o(124),I=o(27),A=/./.toString,X=function(K){o(38)(RegExp.prototype,"toString",K,!0)};o(15)(function(){return A.call({source:"a",flags:"b"})!="/a/b"})?X(function(){var K=g(this);return"/".concat(K.source,"/","flags"in K?K.flags:!I&&K instanceof RegExp?z.call(K):void 0)}):A.name!="toString"&&X(function(){return A.call(this)})},function(j,m,o){var g=o(16),z=o(168),I=o(26).f,A=o(79).f,X=o(161),K=o(124),M=g.RegExp,V=M,$=M.prototype,W=/a/g,te=/a/g,F=new M(W)!==W;if(o(27)&&(!F||o(15)(function(){return te[o(19)("match")]=!1,M(W)!=W||M(te)==te||M(W,"i")!="/a/i"}))){M=function(me,pe){var Oe=this instanceof M,Fe=X(me),Le=pe===void 0;return!Oe&&Fe&&me.constructor===M&&Le?me:z(F?new V(Fe&&!Le?me.source:me,pe):V((Fe=me instanceof M)?me.source:me,Fe&&Le?K.call(me):pe),Oe?this:$,M)};for(var ue=function(me){me in M||I(M,me,{configurable:!0,get:function(){return V[me]},set:function(pe){V[me]=pe}})},se=A(V),J=0;se.length>J;)ue(se[J++]);$.constructor=M,M.prototype=$,o(38)(g,"RegExp",M)}o(95)("RegExp")},function(j,m,o){o(95)("Array")},function(j,m,o){var g=o(8),z=o(51)(6),I="findIndex",A=!0;I in[]&&Array(1)[I](function(){A=!1}),g(g.P+g.F*A,"Array",{findIndex:function(X){return z(this,X,arguments.length>1?arguments[1]:void 0)}}),o(77)(I)},function(j,m,o){var g=o(8),z=o(51)(5),I=!0;"find"in[]&&Array(1).find(function(){I=!1}),g(g.P+g.F*I,"Array",{find:function(A){return z(this,A,arguments.length>1?arguments[1]:void 0)}}),o(77)("find")},function(j,m,o){var g=o(8);g(g.P,"Array",{fill:o(156)}),o(77)("fill")},function(j,m,o){var g=o(8);g(g.P,"Array",{copyWithin:o(222)}),o(77)("copyWithin")},function(j,m,o){var g=o(8),z=o(41),I=o(54),A=o(22),X=[].lastIndexOf,K=!!X&&1/[1].lastIndexOf(1,-0)<0;g(g.P+g.F*(K||!o(49)(X)),"Array",{lastIndexOf:function(M){if(K)return X.apply(this,arguments)||0;var V=z(this),$=A(V.length),W=$-1;for(arguments.length>1&&(W=Math.min(W,I(arguments[1]))),W<0&&(W=$+W);W>=0;W--)if(W in V&&V[W]===M)return W||0;return-1}})},function(j,m,o){var g=o(8),z=o(128)(!1),I=[].indexOf,A=!!I&&1/[1].indexOf(1,-0)<0;g(g.P+g.F*(A||!o(49)(I)),"Array",{indexOf:function(X){return A?I.apply(this,arguments)||0:z(this,X,arguments[1])}})},function(j,m,o){var g=o(8),z=o(223);g(g.P+g.F*!o(49)([].reduceRight,!0),"Array",{reduceRight:function(I){return z(this,I,arguments.length,arguments[1],!0)}})},function(j,m,o){var g=o(8),z=o(223);g(g.P+g.F*!o(49)([].reduce,!0),"Array",{reduce:function(I){return z(this,I,arguments.length,arguments[1],!1)}})},function(j,m,o){var g=o(8),z=o(51)(4);g(g.P+g.F*!o(49)([].every,!0),"Array",{every:function(I){return z(this,I,arguments[1])}})},function(j,m,o){var g=o(8),z=o(51)(3);g(g.P+g.F*!o(49)([].some,!0),"Array",{some:function(I){return z(this,I,arguments[1])}})},function(j,m,o){var g=o(8),z=o(51)(2);g(g.P+g.F*!o(49)([].filter,!0),"Array",{filter:function(I){return z(this,I,arguments[1])}})},function(j,m,o){var g=o(8),z=o(51)(1);g(g.P+g.F*!o(49)([].map,!0),"Array",{map:function(I){return z(this,I,arguments[1])}})},function(j,m,o){var g=o(13),z=o(126),I=o(19)("species");j.exports=function(A){var X;return z(A)&&(typeof(X=A.constructor)!="function"||X!==Array&&!z(X.prototype)||(X=void 0),g(X)&&(X=X[I])===null&&(X=void 0)),X===void 0?Array:X}},function(j,m,o){var g=o(8),z=o(51)(0),I=o(49)([].forEach,!0);g(g.P+g.F*!I,"Array",{forEach:function(A){return z(this,A,arguments[1])}})},function(j,m,o){var g=o(8),z=o(55),I=o(34),A=o(15),X=[].sort,K=[1,2,3];g(g.P+g.F*(A(function(){K.sort(void 0)})||!A(function(){K.sort(null)})||!o(49)(X)),"Array",{sort:function(M){return M===void 0?X.call(I(this)):X.call(I(this),z(M))}})},function(j,m,o){var g=o(8),z=o(171),I=o(62),A=o(81),X=o(22),K=[].slice;g(g.P+g.F*o(15)(function(){z&&K.call(z)}),"Array",{slice:function(M,V){var $=X(this.length),W=I(this);if(V=V===void 0?$:V,W=="Array")return K.call(this,M,V);for(var te=A(M,$),F=A(V,$),ue=X(F-te),se=new Array(ue),J=0;J<ue;J++)se[J]=W=="String"?this.charAt(te+J):this[te+J];return se}})},function(j,m,o){var g=o(8),z=o(41),I=[].join;g(g.P+g.F*(o(107)!=Object||!o(49)(I)),"Array",{join:function(A){return I.call(z(this),A===void 0?",":A)}})},function(j,m,o){var g=o(8),z=o(158);g(g.S+g.F*o(15)(function(){function I(){}return!(Array.of.call(I)instanceof I)}),"Array",{of:function(){for(var I=0,A=arguments.length,X=new(typeof this=="function"?this:Array)(A);A>I;)z(X,I,arguments[I++]);return X.length=A,X}})},function(j,m,o){var g=o(56),z=o(8),I=o(34),A=o(225),X=o(159),K=o(22),M=o(158),V=o(157);z(z.S+z.F*!o(125)(function($){Array.from($)}),"Array",{from:function($){var W,te,F,ue,se=I($),J=typeof this=="function"?this:Array,me=arguments.length,pe=me>1?arguments[1]:void 0,Oe=pe!==void 0,Fe=0,Le=V(se);if(Oe&&(pe=g(pe,me>2?arguments[2]:void 0,2)),Le==null||J==Array&&X(Le))for(te=new J(W=K(se.length));W>Fe;Fe++)M(te,Fe,Oe?pe(se[Fe],Fe):se[Fe]);else for(ue=Le.call(se),te=new J;!(F=ue.next()).done;Fe++)M(te,Fe,Oe?A(ue,pe,[F.value,Fe],!0):F.value);return te.length=Fe,te}})},function(j,m,o){var g=o(8);g(g.S,"Array",{isArray:o(126)})},function(j,m,o){var g=o(14),z=o(66);j.exports=function(I){if(I!=="string"&&I!=="number"&&I!=="default")throw TypeError("Incorrect hint");return z(g(this),I!="number")}},function(j,m,o){var g=o(19)("toPrimitive"),z=Date.prototype;g in z||o(42)(z,g,o(494))},function(j,m,o){var g=Date.prototype,z=g.toString,I=g.getTime;new Date(NaN)+""!="Invalid Date"&&o(38)(g,"toString",function(){var A=I.call(this);return A==A?z.call(this):"Invalid Date"})},function(j,m,o){var g=o(15),z=Date.prototype.getTime,I=Date.prototype.toISOString,A=function(X){return X>9?X:"0"+X};j.exports=g(function(){return I.call(new Date(-5e13-1))!="0385-07-25T07:06:39.999Z"})||!g(function(){I.call(new Date(NaN))})?function(){if(!isFinite(z.call(this)))throw RangeError("Invalid time value");var X=this,K=X.getUTCFullYear(),M=X.getUTCMilliseconds(),V=K<0?"-":K>9999?"+":"";return V+("00000"+Math.abs(K)).slice(V?-6:-4)+"-"+A(X.getUTCMonth()+1)+"-"+A(X.getUTCDate())+"T"+A(X.getUTCHours())+":"+A(X.getUTCMinutes())+":"+A(X.getUTCSeconds())+"."+(M>99?M:"0"+A(M))+"Z"}:I},function(j,m,o){var g=o(8),z=o(497);g(g.P+g.F*(Date.prototype.toISOString!==z),"Date",{toISOString:z})},function(j,m,o){var g=o(8),z=o(34),I=o(66);g(g.P+g.F*o(15)(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1}),"Date",{toJSON:function(A){var X=z(this),K=I(X);return typeof K!="number"||isFinite(K)?X.toISOString():null}})},function(j,m,o){var g=o(8);g(g.S,"Date",{now:function(){return new Date().getTime()}})},function(j,m,o){o(37)("sup",function(g){return function(){return g(this,"sup","","")}})},function(j,m,o){o(37)("sub",function(g){return function(){return g(this,"sub","","")}})},function(j,m,o){o(37)("strike",function(g){return function(){return g(this,"strike","","")}})},function(j,m,o){o(37)("small",function(g){return function(){return g(this,"small","","")}})},function(j,m,o){o(37)("link",function(g){return function(z){return g(this,"a","href",z)}})},function(j,m,o){o(37)("italics",function(g){return function(){return g(this,"i","","")}})},function(j,m,o){o(37)("fontsize",function(g){return function(z){return g(this,"font","size",z)}})},function(j,m,o){o(37)("fontcolor",function(g){return function(z){return g(this,"font","color",z)}})},function(j,m,o){o(37)("fixed",function(g){return function(){return g(this,"tt","","")}})},function(j,m,o){o(37)("bold",function(g){return function(){return g(this,"b","","")}})},function(j,m,o){o(37)("blink",function(g){return function(){return g(this,"blink","","")}})},function(j,m,o){o(37)("big",function(g){return function(){return g(this,"big","","")}})},function(j,m,o){o(37)("anchor",function(g){return function(z){return g(this,"a","name",z)}})},function(j,m,o){var g=o(8),z=o(22),I=o(162),A="".startsWith;g(g.P+g.F*o(160)("startsWith"),"String",{startsWith:function(X){var K=I(this,X,"startsWith"),M=z(Math.min(arguments.length>1?arguments[1]:void 0,K.length)),V=String(X);return A?A.call(K,V,M):K.slice(M,M+V.length)===V}})},function(j,m,o){var g=o(8);g(g.P,"String",{repeat:o(167)})},function(j,m,o){var g=o(8),z=o(162);g(g.P+g.F*o(160)("includes"),"String",{includes:function(I){return!!~z(this,I,"includes").indexOf(I,arguments.length>1?arguments[1]:void 0)}})},function(j,m,o){var g=o(8),z=o(22),I=o(162),A="".endsWith;g(g.P+g.F*o(160)("endsWith"),"String",{endsWith:function(X){var K=I(this,X,"endsWith"),M=arguments.length>1?arguments[1]:void 0,V=z(K.length),$=M===void 0?V:Math.min(z(M),V),W=String(X);return A?A.call(K,W,$):K.slice($-W.length,$)===W}})},function(j,m,o){var g=o(8),z=o(164)(!1);g(g.P,"String",{codePointAt:function(I){return z(this,I)}})},function(j,m,o){var g=o(164)(!0);o(163)(String,"String",function(z){this._t=String(z),this._i=0},function(){var z,I=this._t,A=this._i;return A>=I.length?{value:void 0,done:!0}:(z=g(I,A),this._i+=z.length,{value:z,done:!1})})},function(j,m,o){o(97)("trim",function(g){return function(){return g(this,3)}})},function(j,m,o){var g=o(8),z=o(41),I=o(22);g(g.S,"String",{raw:function(A){for(var X=z(A.raw),K=I(X.length),M=arguments.length,V=[],$=0;K>$;)V.push(String(X[$++])),$<M&&V.push(String(arguments[$]));return V.join("")}})},function(j,m,o){var g=o(8),z=o(81),I=String.fromCharCode,A=String.fromCodePoint;g(g.S+g.F*(!!A&&A.length!=1),"String",{fromCodePoint:function(X){for(var K,M=[],V=arguments.length,$=0;V>$;){if(K=+arguments[$++],z(K,1114111)!==K)throw RangeError(K+" is not a valid code point");M.push(K<65536?I(K):I(55296+((K-=65536)>>10),K%1024+56320))}return M.join("")}})},function(j,m,o){var g=o(8);g(g.S,"Math",{trunc:function(z){return(z>0?Math.floor:Math.ceil)(z)}})},function(j,m,o){var g=o(8),z=o(165),I=Math.exp;g(g.S,"Math",{tanh:function(A){var X=z(A=+A),K=z(-A);return X==1/0?1:K==1/0?-1:(X-K)/(I(A)+I(-A))}})},function(j,m,o){var g=o(8),z=o(165),I=Math.exp;g(g.S+g.F*o(15)(function(){return!Math.sinh(-2e-17)!=-2e-17}),"Math",{sinh:function(A){return Math.abs(A=+A)<1?(z(A)-z(-A))/2:(I(A-1)-I(-A-1))*(Math.E/2)}})},function(j,m,o){var g=o(8);g(g.S,"Math",{sign:o(166)})},function(j,m,o){var g=o(8);g(g.S,"Math",{log2:function(z){return Math.log(z)/Math.LN2}})},function(j,m,o){var g=o(8);g(g.S,"Math",{log1p:o(227)})},function(j,m,o){var g=o(8);g(g.S,"Math",{log10:function(z){return Math.log(z)*Math.LOG10E}})},function(j,m,o){var g=o(8),z=Math.imul;g(g.S+g.F*o(15)(function(){return z(4294967295,5)!=-5||z.length!=2}),"Math",{imul:function(I,A){var X=+I,K=+A,M=65535&X,V=65535&K;return 0|M*V+((65535&X>>>16)*V+M*(65535&K>>>16)<<16>>>0)}})},function(j,m,o){var g=o(8),z=Math.abs;g(g.S,"Math",{hypot:function(I,A){for(var X,K,M=0,V=0,$=arguments.length,W=0;V<$;)W<(X=z(arguments[V++]))?(M=M*(K=W/X)*K+1,W=X):M+=X>0?(K=X/W)*K:X;return W===1/0?1/0:W*Math.sqrt(M)}})},function(j,m,o){var g=o(166),z=Math.pow,I=z(2,-52),A=z(2,-23),X=z(2,127)*(2-A),K=z(2,-126);j.exports=Math.fround||function(M){var V,$,W=Math.abs(M),te=g(M);return W<K?te*function(F){return F+1/I-1/I}(W/K/A)*K*A:($=(V=(1+A/I)*W)-(V-W))>X||$!=$?te*(1/0):te*$}},function(j,m,o){var g=o(8);g(g.S,"Math",{fround:o(532)})},function(j,m,o){var g=o(8),z=o(165);g(g.S+g.F*(z!=Math.expm1),"Math",{expm1:z})},function(j,m,o){var g=o(8),z=Math.exp;g(g.S,"Math",{cosh:function(I){return(z(I=+I)+z(-I))/2}})},function(j,m,o){var g=o(8);g(g.S,"Math",{clz32:function(z){return(z>>>=0)?31-Math.floor(Math.log(z+.5)*Math.LOG2E):32}})},function(j,m,o){var g=o(8),z=o(166);g(g.S,"Math",{cbrt:function(I){return z(I=+I)*Math.pow(Math.abs(I),1/3)}})},function(j,m,o){var g=o(8),z=Math.atanh;g(g.S+g.F*!(z&&1/z(-0)<0),"Math",{atanh:function(I){return(I=+I)==0?I:Math.log((1+I)/(1-I))/2}})},function(j,m,o){var g=o(8),z=Math.asinh;g(g.S+g.F*!(z&&1/z(0)>0),"Math",{asinh:function I(A){return isFinite(A=+A)&&A!=0?A<0?-I(-A):Math.log(A+Math.sqrt(A*A+1)):A}})},function(j,m,o){var g=o(8),z=o(227),I=Math.sqrt,A=Math.acosh;g(g.S+g.F*!(A&&Math.floor(A(Number.MAX_VALUE))==710&&A(1/0)==1/0),"Math",{acosh:function(X){return(X=+X)<1?NaN:X>9490626562425156e-8?Math.log(X)+Math.LN2:z(X-1+I(X-1)*I(X+1))}})},function(j,m,o){var g=o(8),z=o(231);g(g.S+g.F*(Number.parseInt!=z),"Number",{parseInt:z})},function(j,m,o){var g=o(8),z=o(230);g(g.S+g.F*(Number.parseFloat!=z),"Number",{parseFloat:z})},function(j,m,o){var g=o(8);g(g.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(j,m,o){var g=o(8);g(g.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(j,m,o){var g=o(8),z=o(228),I=Math.abs;g(g.S,"Number",{isSafeInteger:function(A){return z(A)&&I(A)<=9007199254740991}})},function(j,m,o){var g=o(8);g(g.S,"Number",{isNaN:function(z){return z!=z}})},function(j,m,o){var g=o(8);g(g.S,"Number",{isInteger:o(228)})},function(j,m,o){var g=o(8),z=o(16).isFinite;g(g.S,"Number",{isFinite:function(I){return typeof I=="number"&&z(I)}})},function(j,m,o){var g=o(8);g(g.S,"Number",{EPSILON:Math.pow(2,-52)})},function(j,m,o){var g=o(8),z=o(15),I=o(229),A=1 .toPrecision;g(g.P+g.F*(z(function(){return A.call(1,void 0)!=="1"})||!z(function(){A.call({})})),"Number",{toPrecision:function(X){var K=I(this,"Number#toPrecision: incorrect invocation!");return X===void 0?A.call(K):A.call(K,X)}})},function(j,m,o){var g=o(8),z=o(54),I=o(229),A=o(167),X=1 .toFixed,K=Math.floor,M=[0,0,0,0,0,0],V="Number.toFixed: incorrect invocation!",$=function(ue,se){for(var J=-1,me=se;++J<6;)me+=ue*M[J],M[J]=me%1e7,me=K(me/1e7)},W=function(ue){for(var se=6,J=0;--se>=0;)J+=M[se],M[se]=K(J/ue),J=J%ue*1e7},te=function(){for(var ue=6,se="";--ue>=0;)if(se!==""||ue===0||M[ue]!==0){var J=String(M[ue]);se=se===""?J:se+A.call("0",7-J.length)+J}return se},F=function(ue,se,J){return se===0?J:se%2==1?F(ue,se-1,J*ue):F(ue*ue,se/2,J)};g(g.P+g.F*(!!X&&(8e-5 .toFixed(3)!=="0.000"||.9 .toFixed(0)!=="1"||1.255 .toFixed(2)!=="1.25"||0xde0b6b3a7640080 .toFixed(0)!=="1000000000000000128")||!o(15)(function(){X.call({})})),"Number",{toFixed:function(ue){var se,J,me,pe,Oe=I(this,V),Fe=z(ue),Le="",Ae="0";if(Fe<0||Fe>20)throw RangeError(V);if(Oe!=Oe)return"NaN";if(Oe<=-1e21||Oe>=1e21)return String(Oe);if(Oe<0&&(Le="-",Oe=-Oe),Oe>1e-21)if(J=(se=function(ft){for(var Mt=0,Xt=ft;Xt>=4096;)Mt+=12,Xt/=4096;for(;Xt>=2;)Mt+=1,Xt/=2;return Mt}(Oe*F(2,69,1))-69)<0?Oe*F(2,-se,1):Oe/F(2,se,1),J*=4503599627370496,(se=52-se)>0){for($(0,J),me=Fe;me>=7;)$(1e7,0),me-=7;for($(F(10,me,1),0),me=se-1;me>=23;)W(1<<23),me-=23;W(1<<me),$(1,1),W(2),Ae=te()}else $(0,J),$(1<<-se,0),Ae=te()+A.call("0",Fe);return Ae=Fe>0?Le+((pe=Ae.length)<=Fe?"0."+A.call("0",Fe-pe)+Ae:Ae.slice(0,pe-Fe)+"."+Ae.slice(pe-Fe)):Le+Ae}})},function(j,m,o){var g=o(16),z=o(43),I=o(62),A=o(168),X=o(66),K=o(15),M=o(79).f,V=o(53).f,$=o(26).f,W=o(97).trim,te=g.Number,F=te,ue=te.prototype,se=I(o(80)(ue))=="Number",J="trim"in String.prototype,me=function(Le){var Ae=X(Le,!1);if(typeof Ae=="string"&&Ae.length>2){var ft,Mt,Xt,tn=(Ae=J?Ae.trim():W(Ae,3)).charCodeAt(0);if(tn===43||tn===45){if((ft=Ae.charCodeAt(2))===88||ft===120)return NaN}else if(tn===48){switch(Ae.charCodeAt(1)){case 66:case 98:Mt=2,Xt=49;break;case 79:case 111:Mt=8,Xt=55;break;default:return+Ae}for(var Ce,Wt=Ae.slice(2),en=0,Ut=Wt.length;en<Ut;en++)if((Ce=Wt.charCodeAt(en))<48||Ce>Xt)return NaN;return parseInt(Wt,Mt)}}return+Ae};if(!te(" 0o1")||!te("0b1")||te("+0x1")){te=function(Le){var Ae=arguments.length<1?0:Le,ft=this;return ft instanceof te&&(se?K(function(){ue.valueOf.call(ft)}):I(ft)!="Number")?A(new F(me(Ae)),ft,te):me(Ae)};for(var pe,Oe=o(27)?M(F):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),Fe=0;Oe.length>Fe;Fe++)z(F,pe=Oe[Fe])&&!z(te,pe)&&$(te,pe,V(F,pe));te.prototype=ue,ue.constructor=te,o(38)(g,"Number",te)}},function(j,m,o){var g=o(8),z=o(230);g(g.G+g.F*(parseFloat!=z),{parseFloat:z})},function(j,m,o){var g=o(8),z=o(231);g(g.G+g.F*(parseInt!=z),{parseInt:z})},function(j,m,o){var g=o(13),z=o(78),I=o(19)("hasInstance"),A=Function.prototype;I in A||o(26).f(A,I,{value:function(X){if(typeof this!="function"||!g(X))return!1;if(!g(this.prototype))return X instanceof this;for(;X=z(X);)if(this.prototype===X)return!0;return!1}})},function(j,m,o){var g=o(26).f,z=Function.prototype,I=/^\s*function ([^ (]*)/;"name"in z||o(27)&&g(z,"name",{configurable:!0,get:function(){try{return(""+this).match(I)[1]}catch{return""}}})},function(j,m,o){var g=o(8);g(g.P,"Function",{bind:o(233)})},function(j,m,o){var g=o(105),z={};z[o(19)("toStringTag")]="z",z+""!="[object z]"&&o(38)(Object.prototype,"toString",function(){return"[object "+g(this)+"]"},!0)},function(j,m,o){var g=o(8);g(g.S,"Object",{setPrototypeOf:o(170).set})},function(j,m,o){var g=o(8);g(g.S,"Object",{is:o(234)})},function(j,m,o){var g=o(8);g(g.S+g.F,"Object",{assign:o(235)})},function(j,m,o){var g=o(13);o(52)("isExtensible",function(z){return function(I){return!!g(I)&&(!z||z(I))}})},function(j,m,o){var g=o(13);o(52)("isSealed",function(z){return function(I){return!g(I)||!!z&&z(I)}})},function(j,m,o){var g=o(13);o(52)("isFrozen",function(z){return function(I){return!g(I)||!!z&&z(I)}})},function(j,m,o){var g=o(13),z=o(65).onFreeze;o(52)("preventExtensions",function(I){return function(A){return I&&g(A)?I(z(A)):A}})},function(j,m,o){var g=o(13),z=o(65).onFreeze;o(52)("seal",function(I){return function(A){return I&&g(A)?I(z(A)):A}})},function(j,m,o){var g=o(13),z=o(65).onFreeze;o(52)("freeze",function(I){return function(A){return I&&g(A)?I(z(A)):A}})},function(j,m,o){o(52)("getOwnPropertyNames",function(){return o(236).f})},function(j,m,o){var g=o(34),z=o(82);o(52)("keys",function(){return function(I){return z(g(I))}})},function(j,m,o){var g=o(34),z=o(78);o(52)("getPrototypeOf",function(){return function(I){return z(g(I))}})},function(j,m,o){var g=o(41),z=o(53).f;o(52)("getOwnPropertyDescriptor",function(){return function(I,A){return z(g(I),A)}})},function(j,m,o){var g=o(8);g(g.S+g.F*!o(27),"Object",{defineProperties:o(237)})},function(j,m,o){var g=o(8);g(g.S+g.F*!o(27),"Object",{defineProperty:o(26).f})},function(j,m,o){var g=o(8);g(g.S,"Object",{create:o(80)})},function(j,m,o){var g=o(82),z=o(127),I=o(106);j.exports=function(A){var X=g(A),K=z.f;if(K)for(var M,V=K(A),$=I.f,W=0;V.length>W;)$.call(A,M=V[W++])&&X.push(M);return X}},function(j,m,o){j.exports=o(129)("native-function-to-string",Function.toString)},function(j,m,o){var g=o(16),z=o(43),I=o(27),A=o(8),X=o(38),K=o(65).KEY,M=o(15),V=o(129),$=o(98),W=o(84),te=o(19),F=o(174),ue=o(239),se=o(575),J=o(126),me=o(14),pe=o(13),Oe=o(34),Fe=o(41),Le=o(66),Ae=o(85),ft=o(80),Mt=o(236),Xt=o(53),tn=o(127),Ce=o(26),Wt=o(82),en=Xt.f,Ut=Ce.f,Qe=Mt.f,fn=g.Symbol,on=g.JSON,Ct=on&&on.stringify,Vt=te("_hidden"),En=te("toPrimitive"),Pt={}.propertyIsEnumerable,Rt=V("symbol-registry"),Tn=V("symbols"),Hn=V("op-symbols"),tr=Object.prototype,pn=typeof fn=="function"&&!!tn.f,$e=g.QObject,et=!$e||!$e.prototype||!$e.prototype.findChild,Ke=I&&M(function(){return ft(Ut({},"a",{get:function(){return Ut(this,"a",{value:7}).a}})).a!=7})?function(nn,an,or){var jn=en(tr,an);jn&&delete tr[an],Ut(nn,an,or),jn&&nn!==tr&&Ut(tr,an,jn)}:Ut,yt=function(nn){var an=Tn[nn]=ft(fn.prototype);return an._k=nn,an},Dt=pn&&typeof fn.iterator=="symbol"?function(nn){return typeof nn=="symbol"}:function(nn){return nn instanceof fn},Lt=function(nn,an,or){return nn===tr&&Lt(Hn,an,or),me(nn),an=Le(an,!0),me(or),z(Tn,an)?(or.enumerable?(z(nn,Vt)&&nn[Vt][an]&&(nn[Vt][an]=!1),or=ft(or,{enumerable:Ae(0,!1)})):(z(nn,Vt)||Ut(nn,Vt,Ae(1,{})),nn[Vt][an]=!0),Ke(nn,an,or)):Ut(nn,an,or)},zn=function(nn,an){me(nn);for(var or,jn=se(an=Fe(an)),Fr=0,Pr=jn.length;Pr>Fr;)Lt(nn,or=jn[Fr++],an[or]);return nn},Cn=function(nn){var an=Pt.call(this,nn=Le(nn,!0));return!(this===tr&&z(Tn,nn)&&!z(Hn,nn))&&(!(an||!z(this,nn)||!z(Tn,nn)||z(this,Vt)&&this[Vt][nn])||an)},ar=function(nn,an){if(nn=Fe(nn),an=Le(an,!0),nn!==tr||!z(Tn,an)||z(Hn,an)){var or=en(nn,an);return!or||!z(Tn,an)||z(nn,Vt)&&nn[Vt][an]||(or.enumerable=!0),or}},we=function(nn){for(var an,or=Qe(Fe(nn)),jn=[],Fr=0;or.length>Fr;)z(Tn,an=or[Fr++])||an==Vt||an==K||jn.push(an);return jn},lr=function(nn){for(var an,or=nn===tr,jn=Qe(or?Hn:Fe(nn)),Fr=[],Pr=0;jn.length>Pr;)!z(Tn,an=jn[Pr++])||or&&!z(tr,an)||Fr.push(Tn[an]);return Fr};pn||(X((fn=function(){if(this instanceof fn)throw TypeError("Symbol is not a constructor!");var nn=W(arguments.length>0?arguments[0]:void 0),an=function(or){this===tr&&an.call(Hn,or),z(this,Vt)&&z(this[Vt],nn)&&(this[Vt][nn]=!1),Ke(this,nn,Ae(1,or))};return I&&et&&Ke(tr,nn,{configurable:!0,set:an}),yt(nn)}).prototype,"toString",function(){return this._k}),Xt.f=ar,Ce.f=Lt,o(79).f=Mt.f=we,o(106).f=Cn,tn.f=lr,I&&!o(83)&&X(tr,"propertyIsEnumerable",Cn,!0),F.f=function(nn){return yt(te(nn))}),A(A.G+A.W+A.F*!pn,{Symbol:fn});for(var Rr="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),Tr=0;Rr.length>Tr;)te(Rr[Tr++]);for(var qr=Wt(te.store),Gr=0;qr.length>Gr;)ue(qr[Gr++]);A(A.S+A.F*!pn,"Symbol",{for:function(nn){return z(Rt,nn+="")?Rt[nn]:Rt[nn]=fn(nn)},keyFor:function(nn){if(!Dt(nn))throw TypeError(nn+" is not a symbol!");for(var an in Rt)if(Rt[an]===nn)return an},useSetter:function(){et=!0},useSimple:function(){et=!1}}),A(A.S+A.F*!pn,"Object",{create:function(nn,an){return an===void 0?ft(nn):zn(ft(nn),an)},defineProperty:Lt,defineProperties:zn,getOwnPropertyDescriptor:ar,getOwnPropertyNames:we,getOwnPropertySymbols:lr});var hn=M(function(){tn.f(1)});A(A.S+A.F*hn,"Object",{getOwnPropertySymbols:function(nn){return tn.f(Oe(nn))}}),on&&A(A.S+A.F*(!pn||M(function(){var nn=fn();return Ct([nn])!="[null]"||Ct({a:nn})!="{}"||Ct(Object(nn))!="{}"})),"JSON",{stringify:function(nn){for(var an,or,jn=[nn],Fr=1;arguments.length>Fr;)jn.push(arguments[Fr++]);if(or=an=jn[1],(pe(an)||nn!==void 0)&&!Dt(nn))return J(an)||(an=function(Pr,Br){if(typeof or=="function"&&(Br=or.call(this,Pr,Br)),!Dt(Br))return Br}),jn[1]=an,Ct.apply(on,jn)}}),fn.prototype[En]||o(42)(fn.prototype,En,fn.prototype.valueOf),$(fn,"Symbol"),$(Math,"Math",!0),$(g.JSON,"JSON",!0)},function(j,m,o){o(577),o(574),o(573),o(572),o(571),o(570),o(569),o(568),o(567),o(566),o(565),o(564),o(563),o(562),o(561),o(560),o(559),o(558),o(557),o(556),o(555),o(554),o(553),o(552),o(551),o(550),o(549),o(548),o(547),o(546),o(545),o(544),o(543),o(542),o(541),o(540),o(539),o(538),o(537),o(536),o(535),o(534),o(533),o(531),o(530),o(529),o(528),o(527),o(526),o(525),o(524),o(523),o(522),o(521),o(520),o(519),o(518),o(517),o(516),o(515),o(514),o(513),o(512),o(511),o(510),o(509),o(508),o(507),o(506),o(505),o(504),o(503),o(502),o(501),o(500),o(499),o(498),o(496),o(495),o(493),o(492),o(491),o(490),o(489),o(488),o(487),o(485),o(484),o(483),o(482),o(481),o(480),o(479),o(478),o(477),o(476),o(475),o(474),o(473),o(155),o(472),o(220),o(471),o(219),o(470),o(469),o(468),o(467),o(218),o(464),o(463),o(462),o(461),o(460),o(459),o(458),o(457),o(456),o(455),o(454),o(453),o(452),o(451),o(450),o(449),o(448),o(447),o(446),o(445),o(444),o(443),o(442),o(441),o(440),o(439),o(438),o(437),o(436),j.exports=o(24)},function(j,m,o){o(578),o(435),o(433),o(430),o(428),o(426),o(424),o(422),o(420),o(418),o(416),o(414),o(412),o(408)},function(j,m,o){o(579);var g=function(z){return z&&z.__esModule?z:{default:z}}(o(407));g.default._babelPolyfill&&typeof console!="undefined"&&console.warn&&console.warn("@babel/polyfill is loaded more than once on this page. This is probably not desirable/intended and may have consequences if different versions of the polyfills are applied sequentially. If you do need to load the polyfill more than once, use @babel/polyfill/noConflict instead to bypass the warning."),g.default._babelPolyfill=!0},function(j,m,o){o(580),j.exports=o(248)},function(j,m,o){var g={},z={},I=34,A=10,X=13;function K(W){return new Function("d","return {"+W.map(function(te,F){return JSON.stringify(te)+": d["+F+'] || ""'}).join(",")+"}")}function M(W){var te=Object.create(null),F=[];return W.forEach(function(ue){for(var se in ue)se in te||F.push(te[se]=se)}),F}function V(W,te){var F=W+"",ue=F.length;return ue<te?new Array(te-ue+1).join(0)+F:F}function $(W){var te=W.getUTCHours(),F=W.getUTCMinutes(),ue=W.getUTCSeconds(),se=W.getUTCMilliseconds();return isNaN(W)?"Invalid Date":function(J){return J<0?"-"+V(-J,6):J>9999?"+"+V(J,6):V(J,4)}(W.getUTCFullYear())+"-"+V(W.getUTCMonth()+1,2)+"-"+V(W.getUTCDate(),2)+(se?"T"+V(te,2)+":"+V(F,2)+":"+V(ue,2)+"."+V(se,3)+"Z":ue?"T"+V(te,2)+":"+V(F,2)+":"+V(ue,2)+"Z":F||te?"T"+V(te,2)+":"+V(F,2)+"Z":"")}m.a=function(W){var te=new RegExp('["'+W+`
\r]`),F=W.charCodeAt(0);function ue(pe,Oe){var Fe,Le=[],Ae=pe.length,ft=0,Mt=0,Xt=Ae<=0,tn=!1;function Ce(){if(Xt)return z;if(tn)return tn=!1,g;var en,Ut,Qe=ft;if(pe.charCodeAt(Qe)===I){for(;ft++<Ae&&pe.charCodeAt(ft)!==I||pe.charCodeAt(++ft)===I;);return(en=ft)>=Ae?Xt=!0:(Ut=pe.charCodeAt(ft++))===A?tn=!0:Ut===X&&(tn=!0,pe.charCodeAt(ft)===A&&++ft),pe.slice(Qe+1,en-1).replace(/""/g,'"')}for(;ft<Ae;){if((Ut=pe.charCodeAt(en=ft++))===A)tn=!0;else if(Ut===X)tn=!0,pe.charCodeAt(ft)===A&&++ft;else if(Ut!==F)continue;return pe.slice(Qe,en)}return Xt=!0,pe.slice(Qe,Ae)}for(pe.charCodeAt(Ae-1)===A&&--Ae,pe.charCodeAt(Ae-1)===X&&--Ae;(Fe=Ce())!==z;){for(var Wt=[];Fe!==g&&Fe!==z;)Wt.push(Fe),Fe=Ce();Oe&&(Wt=Oe(Wt,Mt++))==null||Le.push(Wt)}return Le}function se(pe,Oe){return pe.map(function(Fe){return Oe.map(function(Le){return me(Fe[Le])}).join(W)})}function J(pe){return pe.map(me).join(W)}function me(pe){return pe==null?"":pe instanceof Date?$(pe):te.test(pe+="")?'"'+pe.replace(/"/g,'""')+'"':pe}return{parse:function(pe,Oe){var Fe,Le,Ae=ue(pe,function(ft,Mt){if(Fe)return Fe(ft,Mt-1);Le=ft,Fe=Oe?function(Xt,tn){var Ce=K(Xt);return function(Wt,en){return tn(Ce(Wt),en,Xt)}}(ft,Oe):K(ft)});return Ae.columns=Le||[],Ae},parseRows:ue,format:function(pe,Oe){return Oe==null&&(Oe=M(pe)),[Oe.map(me).join(W)].concat(se(pe,Oe)).join(`
`)},formatBody:function(pe,Oe){return Oe==null&&(Oe=M(pe)),se(pe,Oe).join(`
`)},formatRows:function(pe){return pe.map(J).join(`
`)},formatRow:J,formatValue:me}}}]).default})})(jM);var CG=EG(jM.exports);function AG(nt){const he="https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/pitch-detection/crepe",j=iS();let m,o;return(async()=>{const g=await navigator.mediaDevices.getUserMedia({audio:!0});m=new AudioContext,o=g;const z=CG.pitchDetection(he,m,o,()=>{z.getPitch((A,X)=>{A?console.log(A):X||z.getPitch(I)})});function I(A,X){A?console.log(A):(X&&j("send",X),z.getPitch(I))}})(),[]}class OG extends Lp{constructor(he){super(),Pp(this,he,AG,null,Bp,{})}}class _M{static load(he){return JSON.parse(localStorage.getItem(he))}static save(he,j){localStorage.setItem(he,JSON.stringify(j))}}var EM={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(nt,he){(function(){var j,m="4.17.21",o=200,g="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",z="Expected a function",I="Invalid `variable` option passed into `_.template`",A="__lodash_hash_undefined__",X=500,K="__lodash_placeholder__",M=1,V=2,$=4,W=1,te=2,F=1,ue=2,se=4,J=8,me=16,pe=32,Oe=64,Fe=128,Le=256,Ae=512,ft=30,Mt="...",Xt=800,tn=16,Ce=1,Wt=2,en=3,Ut=1/0,Qe=9007199254740991,fn=17976931348623157e292,on=0/0,Ct=4294967295,Vt=Ct-1,En=Ct>>>1,Pt=[["ary",Fe],["bind",F],["bindKey",ue],["curry",J],["curryRight",me],["flip",Ae],["partial",pe],["partialRight",Oe],["rearg",Le]],Rt="[object Arguments]",Tn="[object Array]",Hn="[object AsyncFunction]",tr="[object Boolean]",pn="[object Date]",$e="[object DOMException]",et="[object Error]",Ke="[object Function]",yt="[object GeneratorFunction]",Dt="[object Map]",Lt="[object Number]",zn="[object Null]",Cn="[object Object]",ar="[object Promise]",we="[object Proxy]",lr="[object RegExp]",Rr="[object Set]",Tr="[object String]",qr="[object Symbol]",Gr="[object Undefined]",hn="[object WeakMap]",nn="[object WeakSet]",an="[object ArrayBuffer]",or="[object DataView]",jn="[object Float32Array]",Fr="[object Float64Array]",Pr="[object Int8Array]",Br="[object Int16Array]",wi="[object Int32Array]",Ai="[object Uint8Array]",Jn="[object Uint8ClampedArray]",di="[object Uint16Array]",ri="[object Uint32Array]",Dr=/\b__p \+= '';/g,ki=/\b(__p \+=) '' \+/g,Ei=/(__e\(.*?\)|\b__t\)) \+\n'';/g,mo=/&(?:amp|lt|gt|quot|#39);/g,Gi=/[&<>"']/g,Ui=RegExp(mo.source),Ot=RegExp(Gi.source),$r=/<%-([\s\S]+?)%>/g,$t=/<%([\s\S]+?)%>/g,xe=/<%=([\s\S]+?)%>/g,ge=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ke=/^\w*$/,Ne=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ot=/[\\^$.*+?()[\]{}|]/g,xt=RegExp(ot.source),Ht=/^\s+/,yn=/\s/,dr=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,_n=/\{\n\/\* \[wrapped with (.+)\] \*/,In=/,? & /,Gn=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Nt=/[()=,{}\[\]\/\s]/,Ft=/\\(\\)?/g,bn=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Yt=/\w*$/,He=/^[-+]0x[0-9a-f]+$/i,$n=/^0b[01]+$/i,ur=/^\[object .+?Constructor\]$/,pr=/^0o[0-7]+$/i,kr=/^(?:0|[1-9]\d*)$/,ui=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ir=/($^)/,ji=/['\n\r\u2028\u2029\\]/g,Do="\\ud800-\\udfff",Bi="\\u0300-\\u036f",no="\\ufe20-\\ufe2f",$i="\\u20d0-\\u20ff",mi=Bi+no+$i,ai="\\u2700-\\u27bf",qn="a-z\\xdf-\\xf6\\xf8-\\xff",Di="\\xac\\xb1\\xd7\\xf7",ko="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Zr="\\u2000-\\u206f",Wo=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Oo="A-Z\\xc0-\\xd6\\xd8-\\xde",So="\\ufe0e\\ufe0f",To=Di+ko+Zr+Wo,ds="['\u2019]",As="["+Do+"]",Cf="["+To+"]",eo="["+mi+"]",bu="\\d+",wc="["+ai+"]",kc="["+qn+"]",_c="[^"+Do+To+bu+ai+qn+Oo+"]",ws="\\ud83c[\\udffb-\\udfff]",Ql="(?:"+eo+"|"+ws+")",Hs="[^"+Do+"]",Mc="(?:\\ud83c[\\udde6-\\uddff]){2}",Af="[\\ud800-\\udbff][\\udc00-\\udfff]",Gs="["+Oo+"]",Zl="\\u200d",pl="(?:"+kc+"|"+_c+")",ml="(?:"+Gs+"|"+_c+")",Gc="(?:"+ds+"(?:d|ll|m|re|s|t|ve))?",ha="(?:"+ds+"(?:D|LL|M|RE|S|T|VE))?",$c=Ql+"?",Ga="["+So+"]?",Kc="(?:"+Zl+"(?:"+[Hs,Mc,Af].join("|")+")"+Ga+$c+")*",Is="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ba="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",jc=Ga+$c+Kc,ac="(?:"+[wc,Mc,Af].join("|")+")"+jc,Xc="(?:"+[Hs+eo+"?",eo,Mc,Af,As].join("|")+")",eu=RegExp(ds,"g"),ps=RegExp(eo,"g"),ef=RegExp(ws+"(?="+ws+")|"+Xc+jc,"g"),Yc=RegExp([Gs+"?"+kc+"+"+Gc+"(?="+[Cf,Gs,"$"].join("|")+")",ml+"+"+ha+"(?="+[Cf,Gs+pl,"$"].join("|")+")",Gs+"?"+pl+"+"+Gc,Gs+"+"+ha,Ba,Is,bu,ac].join("|"),"g"),na=RegExp("["+Zl+Do+mi+So+"]"),Xf=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Jc=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Of=-1,da={};da[jn]=da[Fr]=da[Pr]=da[Br]=da[wi]=da[Ai]=da[Jn]=da[di]=da[ri]=!0,da[Rt]=da[Tn]=da[an]=da[tr]=da[or]=da[pn]=da[et]=da[Ke]=da[Dt]=da[Lt]=da[Cn]=da[lr]=da[Rr]=da[Tr]=da[hn]=!1;var Qi={};Qi[Rt]=Qi[Tn]=Qi[an]=Qi[or]=Qi[tr]=Qi[pn]=Qi[jn]=Qi[Fr]=Qi[Pr]=Qi[Br]=Qi[wi]=Qi[Dt]=Qi[Lt]=Qi[Cn]=Qi[lr]=Qi[Rr]=Qi[Tr]=Qi[qr]=Qi[Ai]=Qi[Jn]=Qi[di]=Qi[ri]=!0,Qi[et]=Qi[Ke]=Qi[hn]=!1;var xi={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},hr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},is={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Nh={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},No=parseFloat,Qc=parseInt,Yf=typeof z2=="object"&&z2&&z2.Object===Object&&z2,zp=typeof self=="object"&&self&&self.Object===Object&&self,tu=Yf||zp||Function("return this")(),Ih=he&&!he.nodeType&&he,so=Ih&&!0&&nt&&!nt.nodeType&&nt,Oa=so&&so.exports===Ih,Fh=Oa&&Yf.process,Zc=function(){try{var cr=so&&so.require&&so.require("util").types;return cr||Fh&&Fh.binding&&Fh.binding("util")}catch{}}(),Rh=Zc&&Zc.isArrayBuffer,Xd=Zc&&Zc.isDate,Tu=Zc&&Zc.isMap,Tl=Zc&&Zc.isRegExp,Yd=Zc&&Zc.isSet,Up=Zc&&Zc.isTypedArray;function Ec(cr,jr,Or){switch(Or.length){case 0:return cr.call(jr);case 1:return cr.call(jr,Or[0]);case 2:return cr.call(jr,Or[0],Or[1]);case 3:return cr.call(jr,Or[0],Or[1],Or[2])}return cr.apply(jr,Or)}function Sg(cr,jr,Or,Mi){for(var go=-1,Ca=cr==null?0:cr.length;++go<Ca;){var Eo=cr[go];jr(Mi,Eo,Or(Eo),cr)}return Mi}function el(cr,jr){for(var Or=-1,Mi=cr==null?0:cr.length;++Or<Mi&&jr(cr[Or],Or,cr)!==!1;);return cr}function Jf(cr,jr){for(var Or=cr==null?0:cr.length;Or--&&jr(cr[Or],Or,cr)!==!1;);return cr}function $s(cr,jr){for(var Or=-1,Mi=cr==null?0:cr.length;++Or<Mi;)if(!jr(cr[Or],Or,cr))return!1;return!0}function gl(cr,jr){for(var Or=-1,Mi=cr==null?0:cr.length,go=0,Ca=[];++Or<Mi;){var Eo=cr[Or];jr(Eo,Or,cr)&&(Ca[go++]=Eo)}return Ca}function Ze(cr,jr){var Or=cr==null?0:cr.length;return!!Or&&Tt(cr,jr,0)>-1}function tl(cr,jr,Or){for(var Mi=-1,go=cr==null?0:cr.length;++Mi<go;)if(Or(jr,cr[Mi]))return!0;return!1}function es(cr,jr){for(var Or=-1,Mi=cr==null?0:cr.length,go=Array(Mi);++Or<Mi;)go[Or]=jr(cr[Or],Or,cr);return go}function Nl(cr,jr){for(var Or=-1,Mi=jr.length,go=cr.length;++Or<Mi;)cr[go+Or]=jr[Or];return cr}function pa(cr,jr,Or,Mi){var go=-1,Ca=cr==null?0:cr.length;for(Mi&&Ca&&(Or=cr[++go]);++go<Ca;)Or=jr(Or,cr[go],go,cr);return Or}function Ea(cr,jr,Or,Mi){var go=cr==null?0:cr.length;for(Mi&&go&&(Or=cr[--go]);go--;)Or=jr(Or,cr[go],go,cr);return Or}function La(cr,jr){for(var Or=-1,Mi=cr==null?0:cr.length;++Or<Mi;)if(jr(cr[Or],Or,cr))return!0;return!1}var Fs=la("length");function vl(cr){return cr.split("")}function Rs(cr){return cr.match(Gn)||[]}function tf(cr,jr,Or){var Mi;return Or(cr,function(go,Ca,Eo){if(jr(go,Ca,Eo))return Mi=Ca,!1}),Mi}function Ku(cr,jr,Or,Mi){for(var go=cr.length,Ca=Or+(Mi?1:-1);Mi?Ca--:++Ca<go;)if(jr(cr[Ca],Ca,cr))return Ca;return-1}function Tt(cr,jr,Or){return jr===jr?qp(cr,jr,Or):Ku(cr,ms,Or)}function aa(cr,jr,Or,Mi){for(var go=Or-1,Ca=cr.length;++go<Ca;)if(Mi(cr[go],jr))return go;return-1}function ms(cr){return cr!==cr}function Ks(cr,jr){var Or=cr==null?0:cr.length;return Or?sc(cr,jr)/Or:on}function la(cr){return function(jr){return jr==null?j:jr[cr]}}function xu(cr){return function(jr){return cr==null?j:cr[jr]}}function Mr(cr,jr,Or,Mi,go){return go(cr,function(Ca,Eo,za){Or=Mi?(Mi=!1,Ca):jr(Or,Ca,Eo,za)}),Or}function Cc(cr,jr){var Or=cr.length;for(cr.sort(jr);Or--;)cr[Or]=cr[Or].value;return cr}function sc(cr,jr){for(var Or,Mi=-1,go=cr.length;++Mi<go;){var Ca=jr(cr[Mi]);Ca!==j&&(Or=Or===j?Ca:Or+Ca)}return Or}function nf(cr,jr){for(var Or=-1,Mi=Array(cr);++Or<cr;)Mi[Or]=jr(Or);return Mi}function Ac(cr,jr){return es(jr,function(Or){return[Or,cr[Or]]})}function yd(cr){return cr&&cr.slice(0,Fu(cr)+1).replace(Ht,"")}function uc(cr){return function(jr){return cr(jr)}}function bd(cr,jr){return es(jr,function(Or){return cr[Or]})}function Xu(cr,jr){return cr.has(jr)}function Io(cr,jr){for(var Or=-1,Mi=cr.length;++Or<Mi&&Tt(jr,cr[Or],0)>-1;);return Or}function Nu(cr,jr){for(var Or=cr.length;Or--&&Tt(jr,cr[Or],0)>-1;);return Or}function Jd(cr,jr){for(var Or=cr.length,Mi=0;Or--;)cr[Or]===jr&&++Mi;return Mi}var rf=xu(xi),Iu=xu(hr);function Ri(cr){return"\\"+Nh[cr]}function $a(cr,jr){return cr==null?j:cr[jr]}function of(cr){return na.test(cr)}function Wp(cr){return Xf.test(cr)}function Mh(cr){for(var jr,Or=[];!(jr=cr.next()).done;)Or.push(jr.value);return Or}function jh(cr){var jr=-1,Or=Array(cr.size);return cr.forEach(function(Mi,go){Or[++jr]=[go,Mi]}),Or}function _o(cr,jr){return function(Or){return cr(jr(Or))}}function Ki(cr,jr){for(var Or=-1,Mi=cr.length,go=0,Ca=[];++Or<Mi;){var Eo=cr[Or];(Eo===jr||Eo===K)&&(cr[Or]=K,Ca[go++]=Or)}return Ca}function Ka(cr){var jr=-1,Or=Array(cr.size);return cr.forEach(function(Mi){Or[++jr]=Mi}),Or}function Vp(cr){var jr=-1,Or=Array(cr.size);return cr.forEach(function(Mi){Or[++jr]=[Mi,Mi]}),Or}function qp(cr,jr,Or){for(var Mi=Or-1,go=cr.length;++Mi<go;)if(cr[Mi]===jr)return Mi;return-1}function Hp(cr,jr,Or){for(var Mi=Or+1;Mi--;)if(cr[Mi]===jr)return Mi;return Mi}function Qf(cr){return of(cr)?cc(cr):Fs(cr)}function nu(cr){return of(cr)?Bc(cr):vl(cr)}function Fu(cr){for(var jr=cr.length;jr--&&yn.test(cr.charAt(jr)););return jr}var Zf=xu(is);function cc(cr){for(var jr=ef.lastIndex=0;ef.test(cr);)++jr;return jr}function Bc(cr){return cr.match(ef)||[]}function Qd(cr){return cr.match(Yc)||[]}var wo=function cr(jr){jr=jr==null?tu:Il.defaults(tu.Object(),jr,Il.pick(tu,Jc));var Or=jr.Array,Mi=jr.Date,go=jr.Error,Ca=jr.Function,Eo=jr.Math,za=jr.Object,Sf=jr.RegExp,Zd=jr.String,Ru=jr.TypeError,Fl=Or.prototype,Df=Ca.prototype,af=za.prototype,Tf=jr["__core-js_shared__"],sf=Df.toString,ma=af.hasOwnProperty,Dg=0,eh=function(){var B=/[^.]+$/.exec(Tf&&Tf.keys&&Tf.keys.IE_PROTO||"");return B?"Symbol(src)_1."+B:""}(),Ua=af.toString,Ms=sf.call(za),Xs=tu._,Co=Sf("^"+sf.call(ma).replace(ot,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),cu=Oa?jr.Buffer:j,lc=jr.Symbol,Es=jr.Uint8Array,uf=cu?cu.allocUnsafe:j,Pc=_o(za.getPrototypeOf,za),Bh=za.create,Ph=af.propertyIsEnumerable,Rl=Fl.splice,ep=lc?lc.isConcatSpreadable:j,Oc=lc?lc.iterator:j,th=lc?lc.toStringTag:j,Lh=function(){try{var B=zu(za,"defineProperty");return B({},"",{}),B}catch{}}(),zh=jr.clearTimeout!==tu.clearTimeout&&jr.clearTimeout,jm=Mi&&Mi.now!==tu.Date.now&&Mi.now,xd=jr.setTimeout!==tu.setTimeout&&jr.setTimeout,Ml=Eo.ceil,Uh=Eo.floor,Wh=za.getOwnPropertySymbols,Os=cu?cu.isBuffer:j,nh=jr.isFinite,Yu=Fl.join,Vh=_o(za.keys,za),Ss=Eo.max,lu=Eo.min,Gp=Mi.now,wd=jr.parseInt,rh=Eo.random,$p=Fl.reverse,kd=zu(jr,"DataView"),ln=zu(jr,"Map"),Ju=zu(jr,"Promise"),er=zu(jr,"Set"),ru=zu(jr,"WeakMap"),Fo=zu(za,"create"),cf=ru&&new ru,jl={},wr=Uc(kd),fu=Uc(ln),Ds=Uc(Ju),Ro=Uc(er),yl=Uc(ru),nl=lc?lc.prototype:j,wu=nl?nl.valueOf:j,Bl=nl?nl.toString:j;function Kt(B){if(as(B)&&!Hi(B)&&!(B instanceof uo)){if(B instanceof po)return B;if(ma.call(B,"__wrapped__"))return Ug(B)}return new po(B)}var fc=function(){function B(){}return function(ne){if(!gs(ne))return{};if(Bh)return Bh(ne);B.prototype=ne;var Te=new B;return B.prototype=j,Te}}();function Mu(){}function po(B,ne){this.__wrapped__=B,this.__actions__=[],this.__chain__=!!ne,this.__index__=0,this.__values__=j}Kt.templateSettings={escape:$r,evaluate:$t,interpolate:xe,variable:"",imports:{_:Kt}},Kt.prototype=Mu.prototype,Kt.prototype.constructor=Kt,po.prototype=fc(Mu.prototype),po.prototype.constructor=po;function uo(B){this.__wrapped__=B,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Ct,this.__views__=[]}function js(){var B=new uo(this.__wrapped__);return B.__actions__=ou(this.__actions__),B.__dir__=this.__dir__,B.__filtered__=this.__filtered__,B.__iteratees__=ou(this.__iteratees__),B.__takeCount__=this.__takeCount__,B.__views__=ou(this.__views__),B}function ju(){if(this.__filtered__){var B=new uo(this);B.__dir__=-1,B.__filtered__=!0}else B=this.clone(),B.__dir__*=-1;return B}function ts(){var B=this.__wrapped__.value(),ne=this.__dir__,Te=Hi(B),ut=ne<0,zt=Te?B.length:0,gn=Id(0,zt,this.__views__),Un=gn.start,nr=gn.end,mr=nr-Un,oi=ut?nr:Un-1,si=this.__iteratees__,Xr=si.length,Li=0,fo=lu(mr,this.__takeCount__);if(!Te||!ut&&zt==mr&&fo==mr)return ol(B,this.__actions__);var ea=[];e:for(;mr--&&Li<fo;){oi+=ne;for(var qa=-1,ta=B[oi];++qa<Xr;){var Ha=si[qa],vs=Ha.iteratee,bm=Ha.type,Wd=vs(ta);if(bm==Wt)ta=Wd;else if(!Wd){if(bm==Ce)continue e;break e}}ea[Li++]=ta}return ea}uo.prototype=fc(Mu.prototype),uo.prototype.constructor=uo;function iu(B){var ne=-1,Te=B==null?0:B.length;for(this.clear();++ne<Te;){var ut=B[ne];this.set(ut[0],ut[1])}}function bl(){this.__data__=Fo?Fo(null):{},this.size=0}function Pl(B){var ne=this.has(B)&&delete this.__data__[B];return this.size-=ne?1:0,ne}function lf(B){var ne=this.__data__;if(Fo){var Te=ne[B];return Te===A?j:Te}return ma.call(ne,B)?ne[B]:j}function xl(B){var ne=this.__data__;return Fo?ne[B]!==j:ma.call(ne,B)}function ih(B,ne){var Te=this.__data__;return this.size+=this.has(B)?0:1,Te[B]=Fo&&ne===j?A:ne,this}iu.prototype.clear=bl,iu.prototype.delete=Pl,iu.prototype.get=lf,iu.prototype.has=xl,iu.prototype.set=ih;function hc(B){var ne=-1,Te=B==null?0:B.length;for(this.clear();++ne<Te;){var ut=B[ne];this.set(ut[0],ut[1])}}function tp(){this.__data__=[],this.size=0}function oh(B){var ne=this.__data__,Te=Yn(ne,B);if(Te<0)return!1;var ut=ne.length-1;return Te==ut?ne.pop():Rl.call(ne,Te,1),--this.size,!0}function Sc(B){var ne=this.__data__,Te=Yn(ne,B);return Te<0?j:ne[Te][1]}function wl(B){return Yn(this.__data__,B)>-1}function kl(B,ne){var Te=this.__data__,ut=Yn(Te,B);return ut<0?(++this.size,Te.push([B,ne])):Te[ut][1]=ne,this}hc.prototype.clear=tp,hc.prototype.delete=oh,hc.prototype.get=Sc,hc.prototype.has=wl,hc.prototype.set=kl;function Ys(B){var ne=-1,Te=B==null?0:B.length;for(this.clear();++ne<Te;){var ut=B[ne];this.set(ut[0],ut[1])}}function np(){this.size=0,this.__data__={hash:new iu,map:new(ln||hc),string:new iu}}function _d(B){var ne=pf(this,B).delete(B);return this.size-=ne?1:0,ne}function Ed(B){return pf(this,B).get(B)}function qh(B){return pf(this,B).has(B)}function Cd(B,ne){var Te=pf(this,B),ut=Te.size;return Te.set(B,ne),this.size+=Te.size==ut?0:1,this}Ys.prototype.clear=np,Ys.prototype.delete=_d,Ys.prototype.get=Ed,Ys.prototype.has=qh,Ys.prototype.set=Cd;function re(B){var ne=-1,Te=B==null?0:B.length;for(this.__data__=new Ys;++ne<Te;)this.add(B[ne])}function Q(B){return this.__data__.set(B,A),this}function C(B){return this.__data__.has(B)}re.prototype.add=re.prototype.push=Q,re.prototype.has=C;function R(B){var ne=this.__data__=new hc(B);this.size=ne.size}function oe(){this.__data__=new hc,this.size=0}function Ue(B){var ne=this.__data__,Te=ne.delete(B);return this.size=ne.size,Te}function Je(B){return this.__data__.get(B)}function vt(B){return this.__data__.has(B)}function qt(B,ne){var Te=this.__data__;if(Te instanceof hc){var ut=Te.__data__;if(!ln||ut.length<o-1)return ut.push([B,ne]),this.size=++Te.size,this;Te=this.__data__=new Ys(ut)}return Te.set(B,ne),this.size=Te.size,this}R.prototype.clear=oe,R.prototype.delete=Ue,R.prototype.get=Je,R.prototype.has=vt,R.prototype.set=qt;function Jt(B,ne){var Te=Hi(B),ut=!Te&&Ji(B),zt=!Te&&!ut&&gu(B),gn=!Te&&!ut&&!zt&&Vf(B),Un=Te||ut||zt||gn,nr=Un?nf(B.length,Zd):[],mr=nr.length;for(var oi in B)(ne||ma.call(B,oi))&&!(Un&&(oi=="length"||zt&&(oi=="offset"||oi=="parent")||gn&&(oi=="buffer"||oi=="byteLength"||oi=="byteOffset")||ul(oi,mr)))&&nr.push(oi);return nr}function pt(B){var ne=B.length;return ne?B[Kp(0,ne-1)]:j}function Nn(B,ne){return dp(ou(B),zr(ne,0,B.length))}function Pn(B){return dp(ou(B))}function Vn(B,ne,Te){(Te!==j&&!va(B[ne],Te)||Te===j&&!(ne in B))&&Hr(B,ne,Te)}function rr(B,ne,Te){var ut=B[ne];(!(ma.call(B,ne)&&va(ut,Te))||Te===j&&!(ne in B))&&Hr(B,ne,Te)}function Yn(B,ne){for(var Te=B.length;Te--;)if(va(B[Te][0],ne))return Te;return-1}function br(B,ne,Te,ut){return Oi(B,function(zt,gn,Un){ne(ut,zt,Te(zt),Un)}),ut}function xr(B,ne){return B&&tc(ne,At(ne),B)}function Lr(B,ne){return B&&tc(ne,St(ne),B)}function Hr(B,ne,Te){ne=="__proto__"&&Lh?Lh(B,ne,{configurable:!0,enumerable:!0,value:Te,writable:!0}):B[ne]=Te}function yi(B,ne){for(var Te=-1,ut=ne.length,zt=Or(ut),gn=B==null;++Te<ut;)zt[Te]=gn?j:ze(B,ne[Te]);return zt}function zr(B,ne,Te){return B===B&&(Te!==j&&(B=B<=Te?B:Te),ne!==j&&(B=B>=ne?B:ne)),B}function li(B,ne,Te,ut,zt,gn){var Un,nr=ne&M,mr=ne&V,oi=ne&$;if(Te&&(Un=zt?Te(B,ut,zt,gn):Te(B)),Un!==j)return Un;if(!gs(B))return B;var si=Hi(B);if(si){if(Un=Pf(B),!nr)return ou(B,Un)}else{var Xr=Ts(B),Li=Xr==Ke||Xr==yt;if(gu(B))return Fg(B,nr);if(Xr==Cn||Xr==Rt||Li&&!zt){if(Un=mr||Li?{}:du(B),!nr)return mr?h0(B,Lr(Un,B)):f0(B,xr(Un,B))}else{if(!Qi[Xr])return zt?B:{};Un=mf(B,Xr,nr)}}gn||(gn=new R);var fo=gn.get(B);if(fo)return fo;gn.set(B,Un),cd(B)?B.forEach(function(ta){Un.add(li(ta,ne,Te,ta,B,gn))}):Au(B)&&B.forEach(function(ta,Ha){Un.set(Ha,li(ta,ne,Te,Ha,B,gn))});var ea=oi?mr?Mf:cp:mr?St:At,qa=si?j:ea(B);return el(qa||B,function(ta,Ha){qa&&(Ha=ta,ta=B[Ha]),rr(Un,Ha,li(ta,ne,Te,Ha,B,gn))}),Un}function pi(B){var ne=At(B);return function(Te){return Pi(Te,B,ne)}}function Pi(B,ne,Te){var ut=Te.length;if(B==null)return!ut;for(B=za(B);ut--;){var zt=Te[ut],gn=ne[zt],Un=B[zt];if(Un===j&&!(zt in B)||!gn(Un))return!1}return!0}function qi(B,ne,Te){if(typeof B!="function")throw new Ru(z);return td(function(){B.apply(j,Te)},ne)}function bi(B,ne,Te,ut){var zt=-1,gn=Ze,Un=!0,nr=B.length,mr=[],oi=ne.length;if(!nr)return mr;Te&&(ne=es(ne,uc(Te))),ut?(gn=tl,Un=!1):ne.length>=o&&(gn=Xu,Un=!1,ne=new re(ne));e:for(;++zt<nr;){var si=B[zt],Xr=Te==null?si:Te(si);if(si=ut||si!==0?si:0,Un&&Xr===Xr){for(var Li=oi;Li--;)if(ne[Li]===Xr)continue e;mr.push(si)}else gn(ne,Xr,ut)||mr.push(si)}return mr}var Oi=Dd(Zi),Vo=Dd(co,!0);function qo(B,ne){var Te=!0;return Oi(B,function(ut,zt,gn){return Te=!!ne(ut,zt,gn),Te}),Te}function Ia(B,ne,Te){for(var ut=-1,zt=B.length;++ut<zt;){var gn=B[ut],Un=ne(gn);if(Un!=null&&(nr===j?Un===Un&&!Vu(Un):Te(Un,nr)))var nr=Un,mr=gn}return mr}function Ao(B,ne,Te,ut){var zt=B.length;for(Te=ua(Te),Te<0&&(Te=-Te>zt?0:zt+Te),ut=ut===j||ut>zt?zt:ua(ut),ut<0&&(ut+=zt),ut=Te>ut?0:Qg(ut);Te<ut;)B[Te++]=ne;return B}function Ho(B,ne){var Te=[];return Oi(B,function(ut,zt,gn){ne(ut,zt,gn)&&Te.push(ut)}),Te}function zo(B,ne,Te,ut,zt){var gn=-1,Un=B.length;for(Te||(Te=sl),zt||(zt=[]);++gn<Un;){var nr=B[gn];ne>0&&Te(nr)?ne>1?zo(nr,ne-1,Te,ut,zt):Nl(zt,nr):ut||(zt[zt.length]=nr)}return zt}var Sa=H0(),Xa=H0(!0);function Zi(B,ne){return B&&Sa(B,ne,At)}function co(B,ne){return B&&Xa(B,ne,At)}function Jo(B,ne){return gl(ne,function(Te){return Ja(B[Te])})}function Pa(B,ne){ne=Ul(ne,B);for(var Te=0,ut=ne.length;B!=null&&Te<ut;)B=B[gf(ne[Te++])];return Te&&Te==ut?B:j}function ks(B,ne,Te){var ut=ne(B);return Hi(B)?ut:Nl(ut,Te(B))}function Qo(B){return B==null?B===j?Gr:zn:th&&th in za(B)?lp(B):Xm(B)}function Wa(B,ne){return B>ne}function ku(B,ne){return B!=null&&ma.call(B,ne)}function Cs(B,ne){return B!=null&&ne in za(B)}function fa(B,ne,Te){return B>=lu(ne,Te)&&B<Ss(ne,Te)}function _s(B,ne,Te){for(var ut=Te?tl:Ze,zt=B[0].length,gn=B.length,Un=gn,nr=Or(gn),mr=1/0,oi=[];Un--;){var si=B[Un];Un&&ne&&(si=es(si,uc(ne))),mr=lu(si.length,mr),nr[Un]=!Te&&(ne||zt>=120&&si.length>=120)?new re(Un&&si):j}si=B[0];var Xr=-1,Li=nr[0];e:for(;++Xr<zt&&oi.length<mr;){var fo=si[Xr],ea=ne?ne(fo):fo;if(fo=Te||fo!==0?fo:0,!(Li?Xu(Li,ea):ut(oi,ea,Te))){for(Un=gn;--Un;){var qa=nr[Un];if(!(qa?Xu(qa,ea):ut(B[Un],ea,Te)))continue e}Li&&Li.push(ea),oi.push(fo)}}return oi}function _l(B,ne,Te,ut){return Zi(B,function(zt,gn,Un){ne(ut,Te(zt),gn,Un)}),ut}function Js(B,ne,Te){ne=Ul(ne,B),B=im(B,ne);var ut=B==null?B:B[gf(Uu(ne))];return ut==null?j:Ec(ut,B,Te)}function Bs(B){return as(B)&&Qo(B)==Rt}function Fa(B){return as(B)&&Qo(B)==an}function ff(B){return as(B)&&Qo(B)==pn}function _u(B,ne,Te,ut,zt){return B===ne?!0:B==null||ne==null||!as(B)&&!as(ne)?B!==B&&ne!==ne:dc(B,ne,Te,ut,_u,zt)}function dc(B,ne,Te,ut,zt,gn){var Un=Hi(B),nr=Hi(ne),mr=Un?Tn:Ts(B),oi=nr?Tn:Ts(ne);mr=mr==Rt?Cn:mr,oi=oi==Rt?Cn:oi;var si=mr==Cn,Xr=oi==Cn,Li=mr==oi;if(Li&&gu(B)){if(!gu(ne))return!1;Un=!0,si=!1}if(Li&&!si)return gn||(gn=new R),Un||Vf(B)?hh(B,ne,Te,ut,zt,gn):up(B,ne,mr,Te,ut,zt,gn);if(!(Te&W)){var fo=si&&ma.call(B,"__wrapped__"),ea=Xr&&ma.call(ne,"__wrapped__");if(fo||ea){var qa=fo?B.value():B,ta=ea?ne.value():ne;return gn||(gn=new R),zt(qa,ta,Te,ut,gn)}}return Li?(gn||(gn=new R),$0(B,ne,Te,ut,zt,gn)):!1}function ns(B){return as(B)&&Ts(B)==Dt}function Bu(B,ne,Te,ut){var zt=Te.length,gn=zt,Un=!ut;if(B==null)return!gn;for(B=za(B);zt--;){var nr=Te[zt];if(Un&&nr[2]?nr[1]!==B[nr[0]]:!(nr[0]in B))return!1}for(;++zt<gn;){nr=Te[zt];var mr=nr[0],oi=B[mr],si=nr[1];if(Un&&nr[2]){if(oi===j&&!(mr in B))return!1}else{var Xr=new R;if(ut)var Li=ut(oi,si,mr,B,ne,Xr);if(!(Li===j?_u(si,oi,W|te,ut,Xr):Li))return!1}}return!0}function Da(B){if(!gs(B)||Ra(B))return!1;var ne=Ja(B)?Co:ur;return ne.test(Uc(B))}function Qu(B){return as(B)&&Qo(B)==lr}function Pu(B){return as(B)&&Ts(B)==Rr}function Zo(B){return as(B)&&Uf(B.length)&&!!da[Qo(B)]}function Lu(B){return typeof B=="function"?B:B==null?qu:typeof B=="object"?Hi(B)?Ps(B[0],B[1]):hu(B):cy(B)}function Qs(B){if(!zc(B))return Vh(B);var ne=[];for(var Te in za(B))ma.call(B,Te)&&Te!="constructor"&&ne.push(Te);return ne}function Dc(B){if(!gs(B))return Km(B);var ne=zc(B),Te=[];for(var ut in B)ut=="constructor"&&(ne||!ma.call(B,ut))||Te.push(ut);return Te}function Ll(B,ne){return B<ne}function Va(B,ne){var Te=-1,ut=os(B)?Or(B.length):[];return Oi(B,function(zt,gn,Un){ut[++Te]=ne(zt,gn,Un)}),ut}function hu(B){var ne=jf(B);return ne.length==1&&ne[0][2]?Zh(ne[0][0],ne[0][1]):function(Te){return Te===B||Bu(Te,B,ne)}}function Ps(B,ne){return tm(B)&&Qh(ne)?Zh(gf(B),ne):function(Te){var ut=ze(Te,B);return ut===j&&ut===ne?rt(Te,B):_u(ne,ut,W|te)}}function rl(B,ne,Te,ut,zt){B!==ne&&Sa(ne,function(gn,Un){if(zt||(zt=new R),gs(gn))ah(B,ne,Un,Te,rl,ut,zt);else{var nr=ut?ut(fp(B,Un),gn,Un+"",B,ne,zt):j;nr===j&&(nr=gn),Vn(B,Un,nr)}},St)}function ah(B,ne,Te,ut,zt,gn,Un){var nr=fp(B,Te),mr=fp(ne,Te),oi=Un.get(mr);if(oi){Vn(B,Te,oi);return}var si=gn?gn(nr,mr,Te+"",B,ne,Un):j,Xr=si===j;if(Xr){var Li=Hi(mr),fo=!Li&&gu(mr),ea=!Li&&!fo&&Vf(mr);si=mr,Li||fo||ea?Hi(nr)?si=nr:ya(nr)?si=ou(nr):fo?(Xr=!1,si=Fg(mr,!0)):ea?(Xr=!1,si=Rg(mr,!0)):si=[]:pc(mr)||Ji(mr)?(si=nr,Ji(nr)?si=Zg(nr):(!gs(nr)||Ja(nr))&&(si=du(mr))):Xr=!1}Xr&&(Un.set(mr,si),zt(si,mr,ut,gn,Un),Un.delete(mr)),Vn(B,Te,si)}function Wi(B,ne){var Te=B.length;if(!!Te)return ne+=ne<0?Te:0,ul(ne,Te)?B[ne]:j}function rp(B,ne,Te){ne.length?ne=es(ne,function(gn){return Hi(gn)?function(Un){return Pa(Un,gn.length===1?gn[0]:gn)}:gn}):ne=[qu];var ut=-1;ne=es(ne,uc(to()));var zt=Va(B,function(gn,Un,nr){var mr=es(ne,function(oi){return oi(gn)});return{criteria:mr,index:++ut,value:gn}});return Cc(zt,function(gn,Un){return Um(gn,Un,Te)})}function sh(B,ne){return uh(B,ne,function(Te,ut){return rt(B,ut)})}function uh(B,ne,Te){for(var ut=-1,zt=ne.length,gn={};++ut<zt;){var Un=ne[ut],nr=Pa(B,Un);Te(nr,Un)&&ip(gn,Ul(Un,B),nr)}return gn}function s0(B){return function(ne){return Pa(ne,B)}}function Bm(B,ne,Te,ut){var zt=ut?aa:Tt,gn=-1,Un=ne.length,nr=B;for(B===ne&&(ne=ou(ne)),Te&&(nr=es(B,uc(Te)));++gn<Un;)for(var mr=0,oi=ne[gn],si=Te?Te(oi):oi;(mr=zt(nr,si,mr,ut))>-1;)nr!==B&&Rl.call(nr,mr,1),Rl.call(B,mr,1);return B}function Pm(B,ne){for(var Te=B?ne.length:0,ut=Te-1;Te--;){var zt=ne[Te];if(Te==ut||zt!==gn){var gn=zt;ul(zt)?Rl.call(B,zt,1):zl(B,zt)}}return B}function Kp(B,ne){return B+Uh(rh()*(ne-B+1))}function u0(B,ne,Te,ut){for(var zt=-1,gn=Ss(Ml((ne-B)/(Te||1)),0),Un=Or(gn);gn--;)Un[ut?gn:++zt]=B,B+=Te;return Un}function Xp(B,ne){var Te="";if(!B||ne<1||ne>Qe)return Te;do ne%2&&(Te+=B),ne=Uh(ne/2),ne&&(B+=B);while(ne);return Te}function sa(B,ne){return om(zg(B,ne,qu),B+"")}function Ad(B){return pt(Se(B))}function Yp(B,ne){var Te=Se(B);return dp(Te,zr(ne,0,Te.length))}function ip(B,ne,Te,ut){if(!gs(B))return B;ne=Ul(ne,B);for(var zt=-1,gn=ne.length,Un=gn-1,nr=B;nr!=null&&++zt<gn;){var mr=gf(ne[zt]),oi=Te;if(mr==="__proto__"||mr==="constructor"||mr==="prototype")return B;if(zt!=Un){var si=nr[mr];oi=ut?ut(si,mr,nr):j,oi===j&&(oi=gs(si)?si:ul(ne[zt+1])?[]:{})}rr(nr,mr,oi),nr=nr[mr]}return B}var Tg=cf?function(B,ne){return cf.set(B,ne),B}:qu,c0=Lh?function(B,ne){return Lh(B,"toString",{configurable:!0,enumerable:!1,value:mc(ne),writable:!0})}:qu;function Nf(B){return dp(Se(B))}function Zu(B,ne,Te){var ut=-1,zt=B.length;ne<0&&(ne=-ne>zt?0:zt+ne),Te=Te>zt?zt:Te,Te<0&&(Te+=zt),zt=ne>Te?0:Te-ne>>>0,ne>>>=0;for(var gn=Or(zt);++ut<zt;)gn[ut]=B[ut+ne];return gn}function Jp(B,ne){var Te;return Oi(B,function(ut,zt,gn){return Te=ne(ut,zt,gn),!Te}),!!Te}function op(B,ne,Te){var ut=0,zt=B==null?ut:B.length;if(typeof ne=="number"&&ne===ne&&zt<=En){for(;ut<zt;){var gn=ut+zt>>>1,Un=B[gn];Un!==null&&!Vu(Un)&&(Te?Un<=ne:Un<ne)?ut=gn+1:zt=gn}return zt}return Qp(B,ne,qu,Te)}function Qp(B,ne,Te,ut){var zt=0,gn=B==null?0:B.length;if(gn===0)return 0;ne=Te(ne);for(var Un=ne!==ne,nr=ne===null,mr=Vu(ne),oi=ne===j;zt<gn;){var si=Uh((zt+gn)/2),Xr=Te(B[si]),Li=Xr!==j,fo=Xr===null,ea=Xr===Xr,qa=Vu(Xr);if(Un)var ta=ut||ea;else oi?ta=ea&&(ut||Li):nr?ta=ea&&Li&&(ut||!fo):mr?ta=ea&&Li&&!fo&&(ut||!qa):fo||qa?ta=!1:ta=ut?Xr<=ne:Xr<ne;ta?zt=si+1:gn=si}return lu(gn,Vt)}function l0(B,ne){for(var Te=-1,ut=B.length,zt=0,gn=[];++Te<ut;){var Un=B[Te],nr=ne?ne(Un):Un;if(!Te||!va(nr,mr)){var mr=nr;gn[zt++]=Un===0?0:Un}}return gn}function Lm(B){return typeof B=="number"?B:Vu(B)?on:+B}function ec(B){if(typeof B=="string")return B;if(Hi(B))return es(B,ec)+"";if(Vu(B))return Bl?Bl.call(B):"";var ne=B+"";return ne=="0"&&1/B==-Ut?"-0":ne}function il(B,ne,Te){var ut=-1,zt=Ze,gn=B.length,Un=!0,nr=[],mr=nr;if(Te)Un=!1,zt=tl;else if(gn>=o){var oi=ne?null:Nd(B);if(oi)return Ka(oi);Un=!1,zt=Xu,mr=new re}else mr=ne?[]:nr;e:for(;++ut<gn;){var si=B[ut],Xr=ne?ne(si):si;if(si=Te||si!==0?si:0,Un&&Xr===Xr){for(var Li=mr.length;Li--;)if(mr[Li]===Xr)continue e;ne&&mr.push(Xr),nr.push(si)}else zt(mr,Xr,Te)||(mr!==nr&&mr.push(Xr),nr.push(si))}return nr}function zl(B,ne){return ne=Ul(ne,B),B=im(B,ne),B==null||delete B[gf(Uu(ne))]}function zm(B,ne,Te,ut){return ip(B,ne,Te(Pa(B,ne)),ut)}function ap(B,ne,Te,ut){for(var zt=B.length,gn=ut?zt:-1;(ut?gn--:++gn<zt)&&ne(B[gn],gn,B););return Te?Zu(B,ut?0:gn,ut?gn+1:zt):Zu(B,ut?gn+1:0,ut?zt:gn)}function ol(B,ne){var Te=B;return Te instanceof uo&&(Te=Te.value()),pa(ne,function(ut,zt){return zt.func.apply(zt.thisArg,Nl([ut],zt.args))},Te)}function Zp(B,ne,Te){var ut=B.length;if(ut<2)return ut?il(B[0]):[];for(var zt=-1,gn=Or(ut);++zt<ut;)for(var Un=B[zt],nr=-1;++nr<ut;)nr!=zt&&(gn[zt]=bi(gn[zt]||Un,B[nr],ne,Te));return il(zo(gn,1),ne,Te)}function Od(B,ne,Te){for(var ut=-1,zt=B.length,gn=ne.length,Un={};++ut<zt;){var nr=ut<gn?ne[ut]:j;Te(Un,B[ut],nr)}return Un}function Sd(B){return ya(B)?B:[]}function Ng(B){return typeof B=="function"?B:qu}function Ul(B,ne){return Hi(B)?B:tm(B,ne)?[B]:am(ca(B))}var If=sa;function Wl(B,ne,Te){var ut=B.length;return Te=Te===j?ut:Te,!ne&&Te>=ut?B:Zu(B,ne,Te)}var Ig=zh||function(B){return tu.clearTimeout(B)};function Fg(B,ne){if(ne)return B.slice();var Te=B.length,ut=uf?uf(Te):new B.constructor(Te);return B.copy(ut),ut}function em(B){var ne=new B.constructor(B.byteLength);return new Es(ne).set(new Es(B)),ne}function yv(B,ne){var Te=ne?em(B.buffer):B.buffer;return new B.constructor(Te,B.byteOffset,B.byteLength)}function bv(B){var ne=new B.constructor(B.source,Yt.exec(B));return ne.lastIndex=B.lastIndex,ne}function ra(B){return wu?za(wu.call(B)):{}}function Rg(B,ne){var Te=ne?em(B.buffer):B.buffer;return new B.constructor(Te,B.byteOffset,B.length)}function Mg(B,ne){if(B!==ne){var Te=B!==j,ut=B===null,zt=B===B,gn=Vu(B),Un=ne!==j,nr=ne===null,mr=ne===ne,oi=Vu(ne);if(!nr&&!oi&&!gn&&B>ne||gn&&Un&&mr&&!nr&&!oi||ut&&Un&&mr||!Te&&mr||!zt)return 1;if(!ut&&!gn&&!oi&&B<ne||oi&&Te&&zt&&!ut&&!gn||nr&&Te&&zt||!Un&&zt||!mr)return-1}return 0}function Um(B,ne,Te){for(var ut=-1,zt=B.criteria,gn=ne.criteria,Un=zt.length,nr=Te.length;++ut<Un;){var mr=Mg(zt[ut],gn[ut]);if(mr){if(ut>=nr)return mr;var oi=Te[ut];return mr*(oi=="desc"?-1:1)}}return B.index-ne.index}function jg(B,ne,Te,ut){for(var zt=-1,gn=B.length,Un=Te.length,nr=-1,mr=ne.length,oi=Ss(gn-Un,0),si=Or(mr+oi),Xr=!ut;++nr<mr;)si[nr]=ne[nr];for(;++zt<Un;)(Xr||zt<gn)&&(si[Te[zt]]=B[zt]);for(;oi--;)si[nr++]=B[zt++];return si}function sp(B,ne,Te,ut){for(var zt=-1,gn=B.length,Un=-1,nr=Te.length,mr=-1,oi=ne.length,si=Ss(gn-nr,0),Xr=Or(si+oi),Li=!ut;++zt<si;)Xr[zt]=B[zt];for(var fo=zt;++mr<oi;)Xr[fo+mr]=ne[mr];for(;++Un<nr;)(Li||zt<gn)&&(Xr[fo+Te[Un]]=B[zt++]);return Xr}function ou(B,ne){var Te=-1,ut=B.length;for(ne||(ne=Or(ut));++Te<ut;)ne[Te]=B[Te];return ne}function tc(B,ne,Te,ut){var zt=!Te;Te||(Te={});for(var gn=-1,Un=ne.length;++gn<Un;){var nr=ne[gn],mr=ut?ut(Te[nr],B[nr],nr,Te,B):j;mr===j&&(mr=B[nr]),zt?Hr(Te,nr,mr):rr(Te,nr,mr)}return Te}function f0(B,ne){return tc(B,ph(B),ne)}function h0(B,ne){return tc(B,Bf(B),ne)}function ch(B,ne){return function(Te,ut){var zt=Hi(Te)?Sg:br,gn=ne?ne():{};return zt(Te,B,to(ut,2),gn)}}function Vl(B){return sa(function(ne,Te){var ut=-1,zt=Te.length,gn=zt>1?Te[zt-1]:j,Un=zt>2?Te[2]:j;for(gn=B.length>3&&typeof gn=="function"?(zt--,gn):j,Un&&rc(Te[0],Te[1],Un)&&(gn=zt<3?j:gn,zt=1),ne=za(ne);++ut<zt;){var nr=Te[ut];nr&&B(ne,nr,ut,gn)}return ne})}function Dd(B,ne){return function(Te,ut){if(Te==null)return Te;if(!os(Te))return B(Te,ut);for(var zt=Te.length,gn=ne?zt:-1,Un=za(Te);(ne?gn--:++gn<zt)&&ut(Un[gn],gn,Un)!==!1;);return Te}}function H0(B){return function(ne,Te,ut){for(var zt=-1,gn=za(ne),Un=ut(ne),nr=Un.length;nr--;){var mr=Un[B?nr:++zt];if(Te(gn[mr],mr,gn)===!1)break}return ne}}function Wm(B,ne,Te){var ut=ne&F,zt=ql(B);function gn(){var Un=this&&this!==tu&&this instanceof gn?zt:B;return Un.apply(ut?Te:this,arguments)}return gn}function Ff(B){return function(ne){ne=ca(ne);var Te=of(ne)?nu(ne):j,ut=Te?Te[0]:ne.charAt(0),zt=Te?Wl(Te,1).join(""):ne.slice(1);return ut[B]()+zt}}function nc(B){return function(ne){return pa(Qa(gt(ne).replace(eu,"")),B,"")}}function ql(B){return function(){var ne=arguments;switch(ne.length){case 0:return new B;case 1:return new B(ne[0]);case 2:return new B(ne[0],ne[1]);case 3:return new B(ne[0],ne[1],ne[2]);case 4:return new B(ne[0],ne[1],ne[2],ne[3]);case 5:return new B(ne[0],ne[1],ne[2],ne[3],ne[4]);case 6:return new B(ne[0],ne[1],ne[2],ne[3],ne[4],ne[5]);case 7:return new B(ne[0],ne[1],ne[2],ne[3],ne[4],ne[5],ne[6])}var Te=fc(B.prototype),ut=B.apply(Te,ne);return gs(ut)?ut:Te}}function Hh(B,ne,Te){var ut=ql(B);function zt(){for(var gn=arguments.length,Un=Or(gn),nr=gn,mr=df(zt);nr--;)Un[nr]=arguments[nr];var oi=gn<3&&Un[0]!==mr&&Un[gn-1]!==mr?[]:Ki(Un,mr);if(gn-=oi.length,gn<Te)return fh(B,ne,Td,zt.placeholder,j,Un,oi,j,j,Te-gn);var si=this&&this!==tu&&this instanceof zt?ut:B;return Ec(si,this,Un)}return zt}function lh(B){return function(ne,Te,ut){var zt=za(ne);if(!os(ne)){var gn=to(Te,3);ne=At(ne),Te=function(nr){return gn(zt[nr],nr,zt)}}var Un=B(ne,Te,ut);return Un>-1?zt[gn?ne[Un]:Un]:j}}function Bg(B){return dh(function(ne){var Te=ne.length,ut=Te,zt=po.prototype.thru;for(B&&ne.reverse();ut--;){var gn=ne[ut];if(typeof gn!="function")throw new Ru(z);if(zt&&!Un&&Yh(gn)=="wrapper")var Un=new po([],!0)}for(ut=Un?ut:Te;++ut<Te;){gn=ne[ut];var nr=Yh(gn),mr=nr=="wrapper"?hf(gn):j;mr&&Fd(mr[0])&&mr[1]==(Fe|J|pe|Le)&&!mr[4].length&&mr[9]==1?Un=Un[Yh(mr[0])].apply(Un,mr[3]):Un=gn.length==1&&Fd(gn)?Un[nr]():Un.thru(gn)}return function(){var oi=arguments,si=oi[0];if(Un&&oi.length==1&&Hi(si))return Un.plant(si).value();for(var Xr=0,Li=Te?ne[Xr].apply(this,oi):si;++Xr<Te;)Li=ne[Xr].call(this,Li);return Li}})}function Td(B,ne,Te,ut,zt,gn,Un,nr,mr,oi){var si=ne&Fe,Xr=ne&F,Li=ne&ue,fo=ne&(J|me),ea=ne&Ae,qa=Li?j:ql(B);function ta(){for(var Ha=arguments.length,vs=Or(Ha),bm=Ha;bm--;)vs[bm]=arguments[bm];if(fo)var Wd=df(ta),qf=Jd(vs,Wd);if(ut&&(vs=jg(vs,ut,zt,fo)),gn&&(vs=sp(vs,gn,Un,fo)),Ha-=qf,fo&&Ha<oi){var yc=Ki(vs,Wd);return fh(B,ne,Td,ta.placeholder,Te,vs,yc,nr,mr,oi-Ha)}var pg=Xr?Te:this,R0=Li?pg[B]:B;return Ha=vs.length,nr?vs=ed(vs,nr):ea&&Ha>1&&vs.reverse(),si&&mr<Ha&&(vs.length=mr),this&&this!==tu&&this instanceof ta&&(R0=qa||ql(R0)),R0.apply(pg,vs)}return ta}function al(B,ne){return function(Te,ut){return _l(Te,B,ne(ut),{})}}function Lc(B,ne){return function(Te,ut){var zt;if(Te===j&&ut===j)return ne;if(Te!==j&&(zt=Te),ut!==j){if(zt===j)return ut;typeof Te=="string"||typeof ut=="string"?(Te=ec(Te),ut=ec(ut)):(Te=Lm(Te),ut=Lm(ut)),zt=B(Te,ut)}return zt}}function Vm(B){return dh(function(ne){return ne=es(ne,uc(to())),sa(function(Te){var ut=this;return B(ne,function(zt){return Ec(zt,ut,Te)})})})}function Gh(B,ne){ne=ne===j?" ":ec(ne);var Te=ne.length;if(Te<2)return Te?Xp(ne,B):ne;var ut=Xp(ne,Ml(B/Qf(ne)));return of(ne)?Wl(nu(ut),0,B).join(""):ut.slice(0,B)}function Pg(B,ne,Te,ut){var zt=ne&F,gn=ql(B);function Un(){for(var nr=-1,mr=arguments.length,oi=-1,si=ut.length,Xr=Or(si+mr),Li=this&&this!==tu&&this instanceof Un?gn:B;++oi<si;)Xr[oi]=ut[oi];for(;mr--;)Xr[oi++]=arguments[++nr];return Ec(Li,zt?Te:this,Xr)}return Un}function G0(B){return function(ne,Te,ut){return ut&&typeof ut!="number"&&rc(ne,Te,ut)&&(Te=ut=j),ne=ld(ne),Te===j?(Te=ne,ne=0):Te=ld(Te),ut=ut===j?ne<Te?1:-1:ld(ut),u0(ne,Te,ut,B)}}function qm(B){return function(ne,Te){return typeof ne=="string"&&typeof Te=="string"||(ne=Kl(ne),Te=Kl(Te)),B(ne,Te)}}function fh(B,ne,Te,ut,zt,gn,Un,nr,mr,oi){var si=ne&J,Xr=si?Un:j,Li=si?j:Un,fo=si?gn:j,ea=si?j:gn;ne|=si?pe:Oe,ne&=~(si?Oe:pe),ne&se||(ne&=~(F|ue));var qa=[B,ne,zt,fo,Xr,ea,Li,nr,mr,oi],ta=Te.apply(j,qa);return Fd(B)&&Rd(ta,qa),ta.placeholder=ut,Ym(ta,B,ne)}function $h(B){var ne=Eo[B];return function(Te,ut){if(Te=Kl(Te),ut=ut==null?0:lu(ua(ut),292),ut&&nh(Te)){var zt=(ca(Te)+"e").split("e"),gn=ne(zt[0]+"e"+(+zt[1]+ut));return zt=(ca(gn)+"e").split("e"),+(zt[0]+"e"+(+zt[1]-ut))}return ne(Te)}}var Nd=er&&1/Ka(new er([,-0]))[1]==Ut?function(B){return new er(B)}:A1;function Kh(B){return function(ne){var Te=Ts(ne);return Te==Dt?jh(ne):Te==Rr?Vp(ne):Ac(ne,B(ne))}}function Rf(B,ne,Te,ut,zt,gn,Un,nr){var mr=ne&ue;if(!mr&&typeof B!="function")throw new Ru(z);var oi=ut?ut.length:0;if(oi||(ne&=~(pe|Oe),ut=zt=j),Un=Un===j?Un:Ss(ua(Un),0),nr=nr===j?nr:ua(nr),oi-=zt?zt.length:0,ne&Oe){var si=ut,Xr=zt;ut=zt=j}var Li=mr?j:hf(B),fo=[B,ne,Te,ut,zt,si,Xr,gn,Un,nr];if(Li&&$m(fo,Li),B=fo[0],ne=fo[1],Te=fo[2],ut=fo[3],zt=fo[4],nr=fo[9]=fo[9]===j?mr?0:B.length:Ss(fo[9]-oi,0),!nr&&ne&(J|me)&&(ne&=~(J|me)),!ne||ne==F)var ea=Wm(B,ne,Te);else ne==J||ne==me?ea=Hh(B,ne,nr):(ne==pe||ne==(F|pe))&&!zt.length?ea=Pg(B,ne,Te,ut):ea=Td.apply(j,fo);var qa=Li?Tg:Rd;return Ym(qa(ea,fo),B,ne)}function Hm(B,ne,Te,ut){return B===j||va(B,af[Te])&&!ma.call(ut,Te)?ne:B}function Xh(B,ne,Te,ut,zt,gn){return gs(B)&&gs(ne)&&(gn.set(ne,B),rl(B,ne,j,Xh,gn),gn.delete(ne)),B}function Ko(B){return pc(B)?j:B}function hh(B,ne,Te,ut,zt,gn){var Un=Te&W,nr=B.length,mr=ne.length;if(nr!=mr&&!(Un&&mr>nr))return!1;var oi=gn.get(B),si=gn.get(ne);if(oi&&si)return oi==ne&&si==B;var Xr=-1,Li=!0,fo=Te&te?new re:j;for(gn.set(B,ne),gn.set(ne,B);++Xr<nr;){var ea=B[Xr],qa=ne[Xr];if(ut)var ta=Un?ut(qa,ea,Xr,ne,B,gn):ut(ea,qa,Xr,B,ne,gn);if(ta!==j){if(ta)continue;Li=!1;break}if(fo){if(!La(ne,function(Ha,vs){if(!Xu(fo,vs)&&(ea===Ha||zt(ea,Ha,Te,ut,gn)))return fo.push(vs)})){Li=!1;break}}else if(!(ea===qa||zt(ea,qa,Te,ut,gn))){Li=!1;break}}return gn.delete(B),gn.delete(ne),Li}function up(B,ne,Te,ut,zt,gn,Un){switch(Te){case or:if(B.byteLength!=ne.byteLength||B.byteOffset!=ne.byteOffset)return!1;B=B.buffer,ne=ne.buffer;case an:return!(B.byteLength!=ne.byteLength||!gn(new Es(B),new Es(ne)));case tr:case pn:case Lt:return va(+B,+ne);case et:return B.name==ne.name&&B.message==ne.message;case lr:case Tr:return B==ne+"";case Dt:var nr=jh;case Rr:var mr=ut&W;if(nr||(nr=Ka),B.size!=ne.size&&!mr)return!1;var oi=Un.get(B);if(oi)return oi==ne;ut|=te,Un.set(B,ne);var si=hh(nr(B),nr(ne),ut,zt,gn,Un);return Un.delete(B),si;case qr:if(wu)return wu.call(B)==wu.call(ne)}return!1}function $0(B,ne,Te,ut,zt,gn){var Un=Te&W,nr=cp(B),mr=nr.length,oi=cp(ne),si=oi.length;if(mr!=si&&!Un)return!1;for(var Xr=mr;Xr--;){var Li=nr[Xr];if(!(Un?Li in ne:ma.call(ne,Li)))return!1}var fo=gn.get(B),ea=gn.get(ne);if(fo&&ea)return fo==ne&&ea==B;var qa=!0;gn.set(B,ne),gn.set(ne,B);for(var ta=Un;++Xr<mr;){Li=nr[Xr];var Ha=B[Li],vs=ne[Li];if(ut)var bm=Un?ut(vs,Ha,Li,ne,B,gn):ut(Ha,vs,Li,B,ne,gn);if(!(bm===j?Ha===vs||zt(Ha,vs,Te,ut,gn):bm)){qa=!1;break}ta||(ta=Li=="constructor")}if(qa&&!ta){var Wd=B.constructor,qf=ne.constructor;Wd!=qf&&"constructor"in B&&"constructor"in ne&&!(typeof Wd=="function"&&Wd instanceof Wd&&typeof qf=="function"&&qf instanceof qf)&&(qa=!1)}return gn.delete(B),gn.delete(ne),qa}function dh(B){return om(zg(B,j,Vg),B+"")}function cp(B){return ks(B,At,ph)}function Mf(B){return ks(B,St,Bf)}var hf=cf?function(B){return cf.get(B)}:A1;function Yh(B){for(var ne=B.name+"",Te=jl[ne],ut=ma.call(jl,ne)?Te.length:0;ut--;){var zt=Te[ut],gn=zt.func;if(gn==null||gn==B)return zt.name}return ne}function df(B){var ne=ma.call(Kt,"placeholder")?Kt:B;return ne.placeholder}function to(){var B=Kt.iteratee||Ud;return B=B===Ud?Lu:B,arguments.length?B(arguments[0],arguments[1]):B}function pf(B,ne){var Te=B.__data__;return Lg(ne)?Te[typeof ne=="string"?"string":"hash"]:Te.map}function jf(B){for(var ne=At(B),Te=ne.length;Te--;){var ut=ne[Te],zt=B[ut];ne[Te]=[ut,zt,Qh(zt)]}return ne}function zu(B,ne){var Te=$a(B,ne);return Da(Te)?Te:j}function lp(B){var ne=ma.call(B,th),Te=B[th];try{B[th]=j;var ut=!0}catch{}var zt=Ua.call(B);return ut&&(ne?B[th]=Te:delete B[th]),zt}var ph=Wh?function(B){return B==null?[]:(B=za(B),gl(Wh(B),function(ne){return Ph.call(B,ne)}))}:Gb,Bf=Wh?function(B){for(var ne=[];B;)Nl(ne,ph(B)),B=Pc(B);return ne}:Gb,Ts=Qo;(kd&&Ts(new kd(new ArrayBuffer(1)))!=or||ln&&Ts(new ln)!=Dt||Ju&&Ts(Ju.resolve())!=ar||er&&Ts(new er)!=Rr||ru&&Ts(new ru)!=hn)&&(Ts=function(B){var ne=Qo(B),Te=ne==Cn?B.constructor:j,ut=Te?Uc(Te):"";if(ut)switch(ut){case wr:return or;case fu:return Dt;case Ds:return ar;case Ro:return Rr;case yl:return hn}return ne});function Id(B,ne,Te){for(var ut=-1,zt=Te.length;++ut<zt;){var gn=Te[ut],Un=gn.size;switch(gn.type){case"drop":B+=Un;break;case"dropRight":ne-=Un;break;case"take":ne=lu(ne,B+Un);break;case"takeRight":B=Ss(B,ne-Un);break}}return{start:B,end:ne}}function Gm(B){var ne=B.match(_n);return ne?ne[1].split(In):[]}function Jh(B,ne,Te){ne=Ul(ne,B);for(var ut=-1,zt=ne.length,gn=!1;++ut<zt;){var Un=gf(ne[ut]);if(!(gn=B!=null&&Te(B,Un)))break;B=B[Un]}return gn||++ut!=zt?gn:(zt=B==null?0:B.length,!!zt&&Uf(zt)&&ul(Un,zt)&&(Hi(B)||Ji(B)))}function Pf(B){var ne=B.length,Te=new B.constructor(ne);return ne&&typeof B[0]=="string"&&ma.call(B,"index")&&(Te.index=B.index,Te.input=B.input),Te}function du(B){return typeof B.constructor=="function"&&!zc(B)?fc(Pc(B)):{}}function mf(B,ne,Te){var ut=B.constructor;switch(ne){case an:return em(B);case tr:case pn:return new ut(+B);case or:return yv(B,Te);case jn:case Fr:case Pr:case Br:case wi:case Ai:case Jn:case di:case ri:return Rg(B,Te);case Dt:return new ut;case Lt:case Tr:return new ut(B);case lr:return bv(B);case Rr:return new ut;case qr:return ra(B)}}function El(B,ne){var Te=ne.length;if(!Te)return B;var ut=Te-1;return ne[ut]=(Te>1?"& ":"")+ne[ut],ne=ne.join(Te>2?", ":" "),B.replace(dr,`{
/* [wrapped with `+ne+`] */
`)}function sl(B){return Hi(B)||Ji(B)||!!(ep&&B&&B[ep])}function ul(B,ne){var Te=typeof B;return ne=ne==null?Qe:ne,!!ne&&(Te=="number"||Te!="symbol"&&kr.test(B))&&B>-1&&B%1==0&&B<ne}function rc(B,ne,Te){if(!gs(Te))return!1;var ut=typeof ne;return(ut=="number"?os(Te)&&ul(ne,Te.length):ut=="string"&&ne in Te)?va(Te[ne],B):!1}function tm(B,ne){if(Hi(B))return!1;var Te=typeof B;return Te=="number"||Te=="symbol"||Te=="boolean"||B==null||Vu(B)?!0:ke.test(B)||!ge.test(B)||ne!=null&&B in za(ne)}function Lg(B){var ne=typeof B;return ne=="string"||ne=="number"||ne=="symbol"||ne=="boolean"?B!=="__proto__":B===null}function Fd(B){var ne=Yh(B),Te=Kt[ne];if(typeof Te!="function"||!(ne in uo.prototype))return!1;if(B===Te)return!0;var ut=hf(Te);return!!ut&&B===ut[0]}function Ra(B){return!!eh&&eh in B}var nm=Tf?Ja:$b;function zc(B){var ne=B&&B.constructor,Te=typeof ne=="function"&&ne.prototype||af;return B===Te}function Qh(B){return B===B&&!gs(B)}function Zh(B,ne){return function(Te){return Te==null?!1:Te[B]===ne&&(ne!==j||B in za(Te))}}function rm(B){var ne=Rn(B,function(ut){return Te.size===X&&Te.clear(),ut}),Te=ne.cache;return ne}function $m(B,ne){var Te=B[1],ut=ne[1],zt=Te|ut,gn=zt<(F|ue|Fe),Un=ut==Fe&&Te==J||ut==Fe&&Te==Le&&B[7].length<=ne[8]||ut==(Fe|Le)&&ne[7].length<=ne[8]&&Te==J;if(!(gn||Un))return B;ut&F&&(B[2]=ne[2],zt|=Te&F?0:se);var nr=ne[3];if(nr){var mr=B[3];B[3]=mr?jg(mr,nr,ne[4]):nr,B[4]=mr?Ki(B[3],K):ne[4]}return nr=ne[5],nr&&(mr=B[5],B[5]=mr?sp(mr,nr,ne[6]):nr,B[6]=mr?Ki(B[5],K):ne[6]),nr=ne[7],nr&&(B[7]=nr),ut&Fe&&(B[8]=B[8]==null?ne[8]:lu(B[8],ne[8])),B[9]==null&&(B[9]=ne[9]),B[0]=ne[0],B[1]=zt,B}function Km(B){var ne=[];if(B!=null)for(var Te in za(B))ne.push(Te);return ne}function Xm(B){return Ua.call(B)}function zg(B,ne,Te){return ne=Ss(ne===j?B.length-1:ne,0),function(){for(var ut=arguments,zt=-1,gn=Ss(ut.length-ne,0),Un=Or(gn);++zt<gn;)Un[zt]=ut[ne+zt];zt=-1;for(var nr=Or(ne+1);++zt<ne;)nr[zt]=ut[zt];return nr[ne]=Te(Un),Ec(B,this,nr)}}function im(B,ne){return ne.length<2?B:Pa(B,Zu(ne,0,-1))}function ed(B,ne){for(var Te=B.length,ut=lu(ne.length,Te),zt=ou(B);ut--;){var gn=ne[ut];B[ut]=ul(gn,Te)?zt[gn]:j}return B}function fp(B,ne){if(!(ne==="constructor"&&typeof B[ne]=="function")&&ne!="__proto__")return B[ne]}var Rd=hp(Tg),td=xd||function(B,ne){return tu.setTimeout(B,ne)},om=hp(c0);function Ym(B,ne,Te){var ut=ne+"";return om(B,El(ut,K0(Gm(ut),Te)))}function hp(B){var ne=0,Te=0;return function(){var ut=Gp(),zt=tn-(ut-Te);if(Te=ut,zt>0){if(++ne>=Xt)return arguments[0]}else ne=0;return B.apply(j,arguments)}}function dp(B,ne){var Te=-1,ut=B.length,zt=ut-1;for(ne=ne===j?ut:ne;++Te<ne;){var gn=Kp(Te,zt),Un=B[gn];B[gn]=B[Te],B[Te]=Un}return B.length=ne,B}var am=rm(function(B){var ne=[];return B.charCodeAt(0)===46&&ne.push(""),B.replace(Ne,function(Te,ut,zt,gn){ne.push(zt?gn.replace(Ft,"$1"):ut||Te)}),ne});function gf(B){if(typeof B=="string"||Vu(B))return B;var ne=B+"";return ne=="0"&&1/B==-Ut?"-0":ne}function Uc(B){if(B!=null){try{return sf.call(B)}catch{}try{return B+""}catch{}}return""}function K0(B,ne){return el(Pt,function(Te){var ut="_."+Te[0];ne&Te[1]&&!Ze(B,ut)&&B.push(ut)}),B.sort()}function Ug(B){if(B instanceof uo)return B.clone();var ne=new po(B.__wrapped__,B.__chain__);return ne.__actions__=ou(B.__actions__),ne.__index__=B.__index__,ne.__values__=B.__values__,ne}function sm(B,ne,Te){(Te?rc(B,ne,Te):ne===j)?ne=1:ne=Ss(ua(ne),0);var ut=B==null?0:B.length;if(!ut||ne<1)return[];for(var zt=0,gn=0,Un=Or(Ml(ut/ne));zt<ut;)Un[gn++]=Zu(B,zt,zt+=ne);return Un}function d0(B){for(var ne=-1,Te=B==null?0:B.length,ut=0,zt=[];++ne<Te;){var gn=B[ne];gn&&(zt[ut++]=gn)}return zt}function nd(){var B=arguments.length;if(!B)return[];for(var ne=Or(B-1),Te=arguments[0],ut=B;ut--;)ne[ut-1]=arguments[ut];return Nl(Hi(Te)?ou(Te):[Te],zo(ne,1))}var p0=sa(function(B,ne){return ya(B)?bi(B,zo(ne,1,ya,!0)):[]}),um=sa(function(B,ne){var Te=Uu(ne);return ya(Te)&&(Te=j),ya(B)?bi(B,zo(ne,1,ya,!0),to(Te,2)):[]}),Jm=sa(function(B,ne){var Te=Uu(ne);return ya(Te)&&(Te=j),ya(B)?bi(B,zo(ne,1,ya,!0),j,Te):[]});function m0(B,ne,Te){var ut=B==null?0:B.length;return ut?(ne=Te||ne===j?1:ua(ne),Zu(B,ne<0?0:ne,ut)):[]}function g0(B,ne,Te){var ut=B==null?0:B.length;return ut?(ne=Te||ne===j?1:ua(ne),ne=ut-ne,Zu(B,0,ne<0?0:ne)):[]}function Wg(B,ne){return B&&B.length?ap(B,to(ne,3),!0,!0):[]}function v0(B,ne){return B&&B.length?ap(B,to(ne,3),!0):[]}function y0(B,ne,Te,ut){var zt=B==null?0:B.length;return zt?(Te&&typeof Te!="number"&&rc(B,ne,Te)&&(Te=0,ut=zt),Ao(B,ne,Te,ut)):[]}function rd(B,ne,Te){var ut=B==null?0:B.length;if(!ut)return-1;var zt=Te==null?0:ua(Te);return zt<0&&(zt=Ss(ut+zt,0)),Ku(B,to(ne,3),zt)}function b0(B,ne,Te){var ut=B==null?0:B.length;if(!ut)return-1;var zt=ut-1;return Te!==j&&(zt=ua(Te),zt=Te<0?Ss(ut+zt,0):lu(zt,ut-1)),Ku(B,to(ne,3),zt,!0)}function Vg(B){var ne=B==null?0:B.length;return ne?zo(B,1):[]}function mh(B){var ne=B==null?0:B.length;return ne?zo(B,Ut):[]}function qg(B,ne){var Te=B==null?0:B.length;return Te?(ne=ne===j?1:ua(ne),zo(B,ne)):[]}function x0(B){for(var ne=-1,Te=B==null?0:B.length,ut={};++ne<Te;){var zt=B[ne];ut[zt[0]]=zt[1]}return ut}function id(B){return B&&B.length?B[0]:j}function gh(B,ne,Te){var ut=B==null?0:B.length;if(!ut)return-1;var zt=Te==null?0:ua(Te);return zt<0&&(zt=Ss(ut+zt,0)),Tt(B,ne,zt)}function Qm(B){var ne=B==null?0:B.length;return ne?Zu(B,0,-1):[]}var Hg=sa(function(B){var ne=es(B,Sd);return ne.length&&ne[0]===B[0]?_s(ne):[]}),vf=sa(function(B){var ne=Uu(B),Te=es(B,Sd);return ne===Uu(Te)?ne=j:Te.pop(),Te.length&&Te[0]===B[0]?_s(Te,to(ne,2)):[]}),Gg=sa(function(B){var ne=Uu(B),Te=es(B,Sd);return ne=typeof ne=="function"?ne:j,ne&&Te.pop(),Te.length&&Te[0]===B[0]?_s(Te,j,ne):[]});function w0(B,ne){return B==null?"":Yu.call(B,ne)}function Uu(B){var ne=B==null?0:B.length;return ne?B[ne-1]:j}function X0(B,ne,Te){var ut=B==null?0:B.length;if(!ut)return-1;var zt=ut;return Te!==j&&(zt=ua(Te),zt=zt<0?Ss(ut+zt,0):lu(zt,ut-1)),ne===ne?Hp(B,ne,zt):Ku(B,ms,zt,!0)}function pp(B,ne){return B&&B.length?Wi(B,ua(ne)):j}var mp=sa(vh);function vh(B,ne){return B&&B.length&&ne&&ne.length?Bm(B,ne):B}function k0(B,ne,Te){return B&&B.length&&ne&&ne.length?Bm(B,ne,to(Te,2)):B}function Md(B,ne,Te){return B&&B.length&&ne&&ne.length?Bm(B,ne,j,Te):B}var yf=dh(function(B,ne){var Te=B==null?0:B.length,ut=yi(B,ne);return Pm(B,es(ne,function(zt){return ul(zt,Te)?+zt:zt}).sort(Mg)),ut});function gp(B,ne){var Te=[];if(!(B&&B.length))return Te;var ut=-1,zt=[],gn=B.length;for(ne=to(ne,3);++ut<gn;){var Un=B[ut];ne(Un,ut,B)&&(Te.push(Un),zt.push(ut))}return Pm(B,zt),Te}function jd(B){return B==null?B:$p.call(B)}function Zm(B,ne,Te){var ut=B==null?0:B.length;return ut?(Te&&typeof Te!="number"&&rc(B,ne,Te)?(ne=0,Te=ut):(ne=ne==null?0:ua(ne),Te=Te===j?ut:ua(Te)),Zu(B,ne,Te)):[]}function $g(B,ne){return op(B,ne)}function _0(B,ne,Te){return Qp(B,ne,to(Te,2))}function Eu(B,ne){var Te=B==null?0:B.length;if(Te){var ut=op(B,ne);if(ut<Te&&va(B[ut],ne))return ut}return-1}function E0(B,ne){return op(B,ne,!0)}function vp(B,ne,Te){return Qp(B,ne,to(Te,2),!0)}function C0(B,ne){var Te=B==null?0:B.length;if(Te){var ut=op(B,ne,!0)-1;if(va(B[ut],ne))return ut}return-1}function eg(B){return B&&B.length?l0(B):[]}function od(B,ne){return B&&B.length?l0(B,to(ne,2)):[]}function cm(B){var ne=B==null?0:B.length;return ne?Zu(B,1,ne):[]}function yh(B,ne,Te){return B&&B.length?(ne=Te||ne===j?1:ua(ne),Zu(B,0,ne<0?0:ne)):[]}function A0(B,ne,Te){var ut=B==null?0:B.length;return ut?(ne=Te||ne===j?1:ua(ne),ne=ut-ne,Zu(B,ne<0?0:ne,ut)):[]}function tg(B,ne){return B&&B.length?ap(B,to(ne,3),!1,!0):[]}function ng(B,ne){return B&&B.length?ap(B,to(ne,3)):[]}var Kg=sa(function(B){return il(zo(B,1,ya,!0))}),Lf=sa(function(B){var ne=Uu(B);return ya(ne)&&(ne=j),il(zo(B,1,ya,!0),to(ne,2))}),rg=sa(function(B){var ne=Uu(B);return ne=typeof ne=="function"?ne:j,il(zo(B,1,ya,!0),j,ne)});function O0(B){return B&&B.length?il(B):[]}function bh(B,ne){return B&&B.length?il(B,to(ne,2)):[]}function lm(B,ne){return ne=typeof ne=="function"?ne:j,B&&B.length?il(B,j,ne):[]}function xh(B){if(!(B&&B.length))return[];var ne=0;return B=gl(B,function(Te){if(ya(Te))return ne=Ss(Te.length,ne),!0}),nf(ne,function(Te){return es(B,la(Te))})}function yp(B,ne){if(!(B&&B.length))return[];var Te=xh(B);return ne==null?Te:es(Te,function(ut){return Ec(ne,j,ut)})}var Cu=sa(function(B,ne){return ya(B)?bi(B,ne):[]}),ig=sa(function(B){return Zp(gl(B,ya))}),Xg=sa(function(B){var ne=Uu(B);return ya(ne)&&(ne=j),Zp(gl(B,ya),to(ne,2))}),fm=sa(function(B){var ne=Uu(B);return ne=typeof ne=="function"?ne:j,Zp(gl(B,ya),j,ne)}),hm=sa(xh);function Yg(B,ne){return Od(B||[],ne||[],rr)}function S0(B,ne){return Od(B||[],ne||[],ip)}var Y0=sa(function(B){var ne=B.length,Te=ne>1?B[ne-1]:j;return Te=typeof Te=="function"?(B.pop(),Te):j,yp(B,Te)});function bf(B){var ne=Kt(B);return ne.__chain__=!0,ne}function Bd(B,ne){return ne(B),B}function og(B,ne){return ne(B)}var D0=dh(function(B){var ne=B.length,Te=ne?B[0]:0,ut=this.__wrapped__,zt=function(gn){return yi(gn,B)};return ne>1||this.__actions__.length||!(ut instanceof uo)||!ul(Te)?this.thru(zt):(ut=ut.slice(Te,+Te+(ne?1:0)),ut.__actions__.push({func:og,args:[zt],thisArg:j}),new po(ut,this.__chain__).thru(function(gn){return ne&&!gn.length&&gn.push(j),gn}))});function zf(){return bf(this)}function pu(){return new po(this.value(),this.__chain__)}function bp(){this.__values__===j&&(this.__values__=Q0(this.value()));var B=this.__index__>=this.__values__.length,ne=B?j:this.__values__[this.__index__++];return{done:B,value:ne}}function dm(){return this}function ag(B){for(var ne,Te=this;Te instanceof Mu;){var ut=Ug(Te);ut.__index__=0,ut.__values__=j,ne?zt.__wrapped__=ut:ne=ut;var zt=ut;Te=Te.__wrapped__}return zt.__wrapped__=B,ne}function T0(){var B=this.__wrapped__;if(B instanceof uo){var ne=B;return this.__actions__.length&&(ne=new uo(this)),ne=ne.reverse(),ne.__actions__.push({func:og,args:[jd],thisArg:j}),new po(ne,this.__chain__)}return this.thru(jd)}function sg(){return ol(this.__wrapped__,this.__actions__)}var ad=ch(function(B,ne,Te){ma.call(B,Te)?++B[Te]:Hr(B,Te,1)});function xv(B,ne,Te){var ut=Hi(B)?$s:qo;return Te&&rc(B,ne,Te)&&(ne=j),ut(B,to(ne,3))}function ug(B,ne){var Te=Hi(B)?gl:Ho;return Te(B,to(ne,3))}var au=lh(rd),pm=lh(b0);function Pd(B,ne){return zo(wh(B,ne),1)}function cg(B,ne){return zo(wh(B,ne),Ut)}function mm(B,ne,Te){return Te=Te===j?1:ua(Te),zo(wh(B,ne),Te)}function lg(B,ne){var Te=Hi(B)?el:Oi;return Te(B,to(ne,3))}function fg(B,ne){var Te=Hi(B)?Jf:Vo;return Te(B,to(ne,3))}var sd=ch(function(B,ne,Te){ma.call(B,Te)?B[Te].push(ne):Hr(B,Te,[ne])});function Hl(B,ne,Te,ut){B=os(B)?B:Se(B),Te=Te&&!ut?ua(Te):0;var zt=B.length;return Te<0&&(Te=Ss(zt+Te,0)),Ch(B)?Te<=zt&&B.indexOf(ne,Te)>-1:!!zt&&Tt(B,ne,Te)>-1}var N0=sa(function(B,ne,Te){var ut=-1,zt=typeof ne=="function",gn=os(B)?Or(B.length):[];return Oi(B,function(Un){gn[++ut]=zt?Ec(ne,Un,Te):Js(Un,ne,Te)}),gn}),I0=ch(function(B,ne,Te){Hr(B,Te,ne)});function wh(B,ne){var Te=Hi(B)?es:Va;return Te(B,to(ne,3))}function gm(B,ne,Te,ut){return B==null?[]:(Hi(ne)||(ne=ne==null?[]:[ne]),Te=ut?j:Te,Hi(Te)||(Te=Te==null?[]:[Te]),rp(B,ne,Te))}var J0=ch(function(B,ne,Te){B[Te?0:1].push(ne)},function(){return[[],[]]});function Jg(B,ne,Te){var ut=Hi(B)?pa:Mr,zt=arguments.length<3;return ut(B,to(ne,4),Te,zt,Oi)}function hg(B,ne,Te){var ut=Hi(B)?Ea:Mr,zt=arguments.length<3;return ut(B,to(ne,4),Te,zt,Vo)}function ii(B,ne){var Te=Hi(B)?gl:Ho;return Te(B,Ln(to(ne,3)))}function P(B){var ne=Hi(B)?pt:Ad;return ne(B)}function E(B,ne,Te){(Te?rc(B,ne,Te):ne===j)?ne=1:ne=ua(ne);var ut=Hi(B)?Nn:Yp;return ut(B,ne)}function _(B){var ne=Hi(B)?Pn:Nf;return ne(B)}function k(B){if(B==null)return 0;if(os(B))return Ch(B)?Qf(B):B.length;var ne=Ts(B);return ne==Dt||ne==Rr?B.size:Qs(B).length}function D(B,ne,Te){var ut=Hi(B)?La:Jp;return Te&&rc(B,ne,Te)&&(ne=j),ut(B,to(ne,3))}var q=sa(function(B,ne){if(B==null)return[];var Te=ne.length;return Te>1&&rc(B,ne[0],ne[1])?ne=[]:Te>2&&rc(ne[0],ne[1],ne[2])&&(ne=[ne[0]]),rp(B,zo(ne,1),[])}),ee=jm||function(){return tu.Date.now()};function de(B,ne){if(typeof ne!="function")throw new Ru(z);return B=ua(B),function(){if(--B<1)return ne.apply(this,arguments)}}function _e(B,ne,Te){return ne=Te?j:ne,ne=B&&ne==null?B.length:ne,Rf(B,Fe,j,j,j,j,ne)}function Re(B,ne){var Te;if(typeof ne!="function")throw new Ru(z);return B=ua(B),function(){return--B>0&&(Te=ne.apply(this,arguments)),B<=1&&(ne=j),Te}}var De=sa(function(B,ne,Te){var ut=F;if(Te.length){var zt=Ki(Te,df(De));ut|=pe}return Rf(B,ut,ne,Te,zt)}),tt=sa(function(B,ne,Te){var ut=F|ue;if(Te.length){var zt=Ki(Te,df(tt));ut|=pe}return Rf(ne,ut,B,Te,zt)});function st(B,ne,Te){ne=Te?j:ne;var ut=Rf(B,J,j,j,j,j,j,ne);return ut.placeholder=st.placeholder,ut}function It(B,ne,Te){ne=Te?j:ne;var ut=Rf(B,me,j,j,j,j,j,ne);return ut.placeholder=It.placeholder,ut}function Bt(B,ne,Te){var ut,zt,gn,Un,nr,mr,oi=0,si=!1,Xr=!1,Li=!0;if(typeof B!="function")throw new Ru(z);ne=Kl(ne)||0,gs(Te)&&(si=!!Te.leading,Xr="maxWait"in Te,gn=Xr?Ss(Kl(Te.maxWait)||0,ne):gn,Li="trailing"in Te?!!Te.trailing:Li);function fo(yc){var pg=ut,R0=zt;return ut=zt=j,oi=yc,Un=B.apply(R0,pg),Un}function ea(yc){return oi=yc,nr=td(Ha,ne),si?fo(yc):Un}function qa(yc){var pg=yc-mr,R0=yc-oi,Qb=ne-pg;return Xr?lu(Qb,gn-R0):Qb}function ta(yc){var pg=yc-mr,R0=yc-oi;return mr===j||pg>=ne||pg<0||Xr&&R0>=gn}function Ha(){var yc=ee();if(ta(yc))return vs(yc);nr=td(Ha,qa(yc))}function vs(yc){return nr=j,Li&&ut?fo(yc):(ut=zt=j,Un)}function bm(){nr!==j&&Ig(nr),oi=0,ut=mr=zt=nr=j}function Wd(){return nr===j?Un:vs(ee())}function qf(){var yc=ee(),pg=ta(yc);if(ut=arguments,zt=this,mr=yc,pg){if(nr===j)return ea(mr);if(Xr)return Ig(nr),nr=td(Ha,ne),fo(mr)}return nr===j&&(nr=td(Ha,ne)),Un}return qf.cancel=bm,qf.flush=Wd,qf}var mn=sa(function(B,ne){return qi(B,1,ne)}),xn=sa(function(B,ne,Te){return qi(B,Kl(ne)||0,Te)});function Fn(B){return Rf(B,Ae)}function Rn(B,ne){if(typeof B!="function"||ne!=null&&typeof ne!="function")throw new Ru(z);var Te=function(){var ut=arguments,zt=ne?ne.apply(this,ut):ut[0],gn=Te.cache;if(gn.has(zt))return gn.get(zt);var Un=B.apply(this,ut);return Te.cache=gn.set(zt,Un)||gn,Un};return Te.cache=new(Rn.Cache||Ys),Te}Rn.Cache=Ys;function Ln(B){if(typeof B!="function")throw new Ru(z);return function(){var ne=arguments;switch(ne.length){case 0:return!B.call(this);case 1:return!B.call(this,ne[0]);case 2:return!B.call(this,ne[0],ne[1]);case 3:return!B.call(this,ne[0],ne[1],ne[2])}return!B.apply(this,ne)}}function Zn(B){return Re(2,B)}var An=If(function(B,ne){ne=ne.length==1&&Hi(ne[0])?es(ne[0],uc(to())):es(zo(ne,1),uc(to()));var Te=ne.length;return sa(function(ut){for(var zt=-1,gn=lu(ut.length,Te);++zt<gn;)ut[zt]=ne[zt].call(this,ut[zt]);return Ec(B,this,ut)})}),Sr=sa(function(B,ne){var Te=Ki(ne,df(Sr));return Rf(B,pe,j,ne,Te)}),Ur=sa(function(B,ne){var Te=Ki(ne,df(Ur));return Rf(B,Oe,j,ne,Te)}),Wr=dh(function(B,ne){return Rf(B,Le,j,j,j,ne)});function ci(B,ne){if(typeof B!="function")throw new Ru(z);return ne=ne===j?ne:ua(ne),sa(B,ne)}function Jr(B,ne){if(typeof B!="function")throw new Ru(z);return ne=ne==null?0:Ss(ua(ne),0),sa(function(Te){var ut=Te[ne],zt=Wl(Te,0,ne);return ut&&Nl(zt,ut),Ec(B,this,zt)})}function Xi(B,ne,Te){var ut=!0,zt=!0;if(typeof B!="function")throw new Ru(z);return gs(Te)&&(ut="leading"in Te?!!Te.leading:ut,zt="trailing"in Te?!!Te.trailing:zt),Bt(B,ne,{leading:ut,maxWait:ne,trailing:zt})}function lo(B){return _e(B,1)}function io(B,ne){return Sr(Ng(ne),B)}function ga(){if(!arguments.length)return[];var B=arguments[0];return Hi(B)?B:[B]}function Ya(B){return li(B,$)}function Ta(B,ne){return ne=typeof ne=="function"?ne:j,li(B,$,ne)}function Aa(B){return li(B,M|$)}function Ma(B,ne){return ne=typeof ne=="function"?ne:j,li(B,M|$,ne)}function rs(B,ne){return ne==null||Pi(B,ne,At(ne))}function va(B,ne){return B===ne||B!==B&&ne!==ne}var Ns=qm(Wa),Tc=qm(function(B,ne){return B>=ne}),Ji=Bs(function(){return arguments}())?Bs:function(B){return as(B)&&ma.call(B,"callee")&&!Ph.call(B,"callee")},Hi=Or.isArray,mu=Rh?uc(Rh):Fa;function os(B){return B!=null&&Uf(B.length)&&!Ja(B)}function ya(B){return as(B)&&os(B)}function cl(B){return B===!0||B===!1||as(B)&&Qo(B)==tr}var gu=Os||$b,ll=Xd?uc(Xd):ff;function xp(B){return as(B)&&B.nodeType===1&&!pc(B)}function Ld(B){if(B==null)return!0;if(os(B)&&(Hi(B)||typeof B=="string"||typeof B.splice=="function"||gu(B)||Vf(B)||Ji(B)))return!B.length;var ne=Ts(B);if(ne==Dt||ne==Rr)return!B.size;if(zc(B))return!Qs(B).length;for(var Te in B)if(ma.call(B,Te))return!1;return!0}function kh(B,ne){return _u(B,ne)}function ud(B,ne,Te){Te=typeof Te=="function"?Te:j;var ut=Te?Te(B,ne):j;return ut===j?_u(B,ne,j,Te):!!ut}function xf(B){if(!as(B))return!1;var ne=Qo(B);return ne==et||ne==$e||typeof B.message=="string"&&typeof B.name=="string"&&!pc(B)}function Gl(B){return typeof B=="number"&&nh(B)}function Ja(B){if(!gs(B))return!1;var ne=Qo(B);return ne==Ke||ne==yt||ne==Hn||ne==we}function _h(B){return typeof B=="number"&&B==ua(B)}function Uf(B){return typeof B=="number"&&B>-1&&B%1==0&&B<=Qe}function gs(B){var ne=typeof B;return B!=null&&(ne=="object"||ne=="function")}function as(B){return B!=null&&typeof B=="object"}var Au=Tu?uc(Tu):ns;function zd(B,ne){return B===ne||Bu(B,ne,jf(ne))}function wp(B,ne,Te){return Te=typeof Te=="function"?Te:j,Bu(B,ne,jf(ne),Te)}function kp(B){return Wu(B)&&B!=+B}function Wf(B){if(nm(B))throw new go(g);return Da(B)}function vm(B){return B===null}function $l(B){return B==null}function Wu(B){return typeof B=="number"||as(B)&&Qo(B)==Lt}function pc(B){if(!as(B)||Qo(B)!=Cn)return!1;var ne=Pc(B);if(ne===null)return!0;var Te=ma.call(ne,"constructor")&&ne.constructor;return typeof Te=="function"&&Te instanceof Te&&sf.call(Te)==Ms}var vu=Tl?uc(Tl):Qu;function Eh(B){return _h(B)&&B>=-Qe&&B<=Qe}var cd=Yd?uc(Yd):Pu;function Ch(B){return typeof B=="string"||!Hi(B)&&as(B)&&Qo(B)==Tr}function Vu(B){return typeof B=="symbol"||as(B)&&Qo(B)==qr}var Vf=Up?uc(Up):Zo;function Ah(B){return B===j}function Wc(B){return as(B)&&Ts(B)==hn}function wv(B){return as(B)&&Qo(B)==nn}var Oh=qm(Ll),_p=qm(function(B,ne){return B<=ne});function Q0(B){if(!B)return[];if(os(B))return Ch(B)?nu(B):ou(B);if(Oc&&B[Oc])return Mh(B[Oc]());var ne=Ts(B),Te=ne==Dt?jh:ne==Rr?Ka:Se;return Te(B)}function ld(B){if(!B)return B===0?B:0;if(B=Kl(B),B===Ut||B===-Ut){var ne=B<0?-1:1;return ne*fn}return B===B?B:0}function ua(B){var ne=ld(B),Te=ne%1;return ne===ne?Te?ne-Te:ne:0}function Qg(B){return B?zr(ua(B),0,Ct):0}function Kl(B){if(typeof B=="number")return B;if(Vu(B))return on;if(gs(B)){var ne=typeof B.valueOf=="function"?B.valueOf():B;B=gs(ne)?ne+"":ne}if(typeof B!="string")return B===0?B:+B;B=yd(B);var Te=$n.test(B);return Te||pr.test(B)?Qc(B.slice(2),Te?2:8):He.test(B)?on:+B}function Zg(B){return tc(B,St(B))}function Z0(B){return B?zr(ua(B),-Qe,Qe):B===0?B:0}function ca(B){return B==null?"":ec(B)}var kv=Vl(function(B,ne){if(zc(ne)||os(ne)){tc(ne,At(ne),B);return}for(var Te in ne)ma.call(ne,Te)&&rr(B,Te,ne[Te])}),Cl=Vl(function(B,ne){tc(ne,St(ne),B)}),wf=Vl(function(B,ne,Te,ut){tc(ne,St(ne),B,ut)}),b=Vl(function(B,ne,Te,ut){tc(ne,At(ne),B,ut)}),h=dh(yi);function u(B,ne){var Te=fc(B);return ne==null?Te:xr(Te,ne)}var d=sa(function(B,ne){B=za(B);var Te=-1,ut=ne.length,zt=ut>2?ne[2]:j;for(zt&&rc(ne[0],ne[1],zt)&&(ut=1);++Te<ut;)for(var gn=ne[Te],Un=St(gn),nr=-1,mr=Un.length;++nr<mr;){var oi=Un[nr],si=B[oi];(si===j||va(si,af[oi])&&!ma.call(B,oi))&&(B[oi]=gn[oi])}return B}),x=sa(function(B){return B.push(j,Xh),Ec(cn,j,B)});function T(B,ne){return tf(B,to(ne,3),Zi)}function H(B,ne){return tf(B,to(ne,3),co)}function Z(B,ne){return B==null?B:Sa(B,to(ne,3),St)}function ce(B,ne){return B==null?B:Xa(B,to(ne,3),St)}function ye(B,ne){return B&&Zi(B,to(ne,3))}function Ee(B,ne){return B&&co(B,to(ne,3))}function je(B){return B==null?[]:Jo(B,At(B))}function Pe(B){return B==null?[]:Jo(B,St(B))}function ze(B,ne,Te){var ut=B==null?j:Pa(B,ne);return ut===j?Te:ut}function Ge(B,ne){return B!=null&&Jh(B,ne,ku)}function rt(B,ne){return B!=null&&Jh(B,ne,Cs)}var it=al(function(B,ne,Te){ne!=null&&typeof ne.toString!="function"&&(ne=Ua.call(ne)),B[ne]=Te},mc(qu)),ht=al(function(B,ne,Te){ne!=null&&typeof ne.toString!="function"&&(ne=Ua.call(ne)),ma.call(B,ne)?B[ne].push(Te):B[ne]=[Te]},to),Et=sa(Js);function At(B){return os(B)?Jt(B):Qs(B)}function St(B){return os(B)?Jt(B,!0):Dc(B)}function Gt(B,ne){var Te={};return ne=to(ne,3),Zi(B,function(ut,zt,gn){Hr(Te,ne(ut,zt,gn),ut)}),Te}function un(B,ne){var Te={};return ne=to(ne,3),Zi(B,function(ut,zt,gn){Hr(Te,zt,ne(ut,zt,gn))}),Te}var vn=Vl(function(B,ne,Te){rl(B,ne,Te)}),cn=Vl(function(B,ne,Te,ut){rl(B,ne,Te,ut)}),kn=dh(function(B,ne){var Te={};if(B==null)return Te;var ut=!1;ne=es(ne,function(gn){return gn=Ul(gn,B),ut||(ut=gn.length>1),gn}),tc(B,Mf(B),Te),ut&&(Te=li(Te,M|V|$,Ko));for(var zt=ne.length;zt--;)zl(Te,ne[zt]);return Te});function On(B,ne){return c(B,Ln(to(ne)))}var p=dh(function(B,ne){return B==null?{}:sh(B,ne)});function c(B,ne){if(B==null)return{};var Te=es(Mf(B),function(ut){return[ut]});return ne=to(ne),uh(B,Te,function(ut,zt){return ne(ut,zt[0])})}function a(B,ne,Te){ne=Ul(ne,B);var ut=-1,zt=ne.length;for(zt||(zt=1,B=j);++ut<zt;){var gn=B==null?j:B[gf(ne[ut])];gn===j&&(ut=zt,gn=Te),B=Ja(gn)?gn.call(B):gn}return B}function l(B,ne,Te){return B==null?B:ip(B,ne,Te)}function y(B,ne,Te,ut){return ut=typeof ut=="function"?ut:j,B==null?B:ip(B,ne,Te,ut)}var S=Kh(At),U=Kh(St);function G(B,ne,Te){var ut=Hi(B),zt=ut||gu(B)||Vf(B);if(ne=to(ne,4),Te==null){var gn=B&&B.constructor;zt?Te=ut?new gn:[]:gs(B)?Te=Ja(gn)?fc(Pc(B)):{}:Te={}}return(zt?el:Zi)(B,function(Un,nr,mr){return ne(Te,Un,nr,mr)}),Te}function ae(B,ne){return B==null?!0:zl(B,ne)}function le(B,ne,Te){return B==null?B:zm(B,ne,Ng(Te))}function be(B,ne,Te,ut){return ut=typeof ut=="function"?ut:j,B==null?B:zm(B,ne,Ng(Te),ut)}function Se(B){return B==null?[]:bd(B,At(B))}function Ie(B){return B==null?[]:bd(B,St(B))}function Me(B,ne,Te){return Te===j&&(Te=ne,ne=j),Te!==j&&(Te=Kl(Te),Te=Te===Te?Te:0),ne!==j&&(ne=Kl(ne),ne=ne===ne?ne:0),zr(Kl(B),ne,Te)}function qe(B,ne,Te){return ne=ld(ne),Te===j?(Te=ne,ne=0):Te=ld(Te),B=Kl(B),fa(B,ne,Te)}function Ye(B,ne,Te){if(Te&&typeof Te!="boolean"&&rc(B,ne,Te)&&(ne=Te=j),Te===j&&(typeof ne=="boolean"?(Te=ne,ne=j):typeof B=="boolean"&&(Te=B,B=j)),B===j&&ne===j?(B=0,ne=1):(B=ld(B),ne===j?(ne=B,B=0):ne=ld(ne)),B>ne){var ut=B;B=ne,ne=ut}if(Te||B%1||ne%1){var zt=rh();return lu(B+zt*(ne-B+No("1e-"+((zt+"").length-1))),ne)}return Kp(B,ne)}var Xe=nc(function(B,ne,Te){return ne=ne.toLowerCase(),B+(Te?at(ne):ne)});function at(B){return ja(ca(B).toLowerCase())}function gt(B){return B=ca(B),B&&B.replace(ui,rf).replace(ps,"")}function bt(B,ne,Te){B=ca(B),ne=ec(ne);var ut=B.length;Te=Te===j?ut:zr(ua(Te),0,ut);var zt=Te;return Te-=ne.length,Te>=0&&B.slice(Te,zt)==ne}function _t(B){return B=ca(B),B&&Ot.test(B)?B.replace(Gi,Iu):B}function jt(B){return B=ca(B),B&&xt.test(B)?B.replace(ot,"\\$&"):B}var Qt=nc(function(B,ne,Te){return B+(Te?"-":"")+ne.toLowerCase()}),sn=nc(function(B,ne,Te){return B+(Te?" ":"")+ne.toLowerCase()}),Zt=Ff("toLowerCase");function rn(B,ne,Te){B=ca(B),ne=ua(ne);var ut=ne?Qf(B):0;if(!ne||ut>=ne)return B;var zt=(ne-ut)/2;return Gh(Uh(zt),Te)+B+Gh(Ml(zt),Te)}function Sn(B,ne,Te){B=ca(B),ne=ua(ne);var ut=ne?Qf(B):0;return ne&&ut<ne?B+Gh(ne-ut,Te):B}function Bn(B,ne,Te){B=ca(B),ne=ua(ne);var ut=ne?Qf(B):0;return ne&&ut<ne?Gh(ne-ut,Te)+B:B}function Mn(B,ne,Te){return Te||ne==null?ne=0:ne&&(ne=+ne),wd(ca(B).replace(Ht,""),ne||0)}function fr(B,ne,Te){return(Te?rc(B,ne,Te):ne===j)?ne=1:ne=ua(ne),Xp(ca(B),ne)}function yr(){var B=arguments,ne=ca(B[0]);return B.length<3?ne:ne.replace(B[1],B[2])}var Cr=nc(function(B,ne,Te){return B+(Te?"_":"")+ne.toLowerCase()});function Nr(B,ne,Te){return Te&&typeof Te!="number"&&rc(B,ne,Te)&&(ne=Te=j),Te=Te===j?Ct:Te>>>0,Te?(B=ca(B),B&&(typeof ne=="string"||ne!=null&&!vu(ne))&&(ne=ec(ne),!ne&&of(B))?Wl(nu(B),0,Te):B.split(ne,Te)):[]}var Ar=nc(function(B,ne,Te){return B+(Te?" ":"")+ja(ne)});function _r(B,ne,Te){return B=ca(B),Te=Te==null?0:zr(ua(Te),0,B.length),ne=ec(ne),B.slice(Te,Te+ne.length)==ne}function Yr(B,ne,Te){var ut=Kt.templateSettings;Te&&rc(B,ne,Te)&&(ne=j),B=ca(B),ne=wf({},ne,ut,Hm);var zt=wf({},ne.imports,ut.imports,Hm),gn=At(zt),Un=bd(zt,gn),nr,mr,oi=0,si=ne.interpolate||Ir,Xr="__p += '",Li=Sf((ne.escape||Ir).source+"|"+si.source+"|"+(si===xe?bn:Ir).source+"|"+(ne.evaluate||Ir).source+"|$","g"),fo="//# sourceURL="+(ma.call(ne,"sourceURL")?(ne.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Of+"]")+`
`;B.replace(Li,function(ta,Ha,vs,bm,Wd,qf){return vs||(vs=bm),Xr+=B.slice(oi,qf).replace(ji,Ri),Ha&&(nr=!0,Xr+=`' +
__e(`+Ha+`) +
'`),Wd&&(mr=!0,Xr+=`';
`+Wd+`;
__p += '`),vs&&(Xr+=`' +
((__t = (`+vs+`)) == null ? '' : __t) +
'`),oi=qf+ta.length,ta}),Xr+=`';
`;var ea=ma.call(ne,"variable")&&ne.variable;if(!ea)Xr=`with (obj) {
`+Xr+`
}
`;else if(Nt.test(ea))throw new go(I);Xr=(mr?Xr.replace(Dr,""):Xr).replace(ki,"$1").replace(Ei,"$1;"),Xr="function("+(ea||"obj")+`) {
`+(ea?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(nr?", __e = _.escape":"")+(mr?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Xr+`return __p
}`;var qa=Ls(function(){return Ca(gn,fo+"return "+Xr).apply(j,Un)});if(qa.source=Xr,xf(qa))throw qa;return qa}function Kr(B){return ca(B).toLowerCase()}function fi(B){return ca(B).toUpperCase()}function Ti(B,ne,Te){if(B=ca(B),B&&(Te||ne===j))return yd(B);if(!B||!(ne=ec(ne)))return B;var ut=nu(B),zt=nu(ne),gn=Io(ut,zt),Un=Nu(ut,zt)+1;return Wl(ut,gn,Un).join("")}function Yi(B,ne,Te){if(B=ca(B),B&&(Te||ne===j))return B.slice(0,Fu(B)+1);if(!B||!(ne=ec(ne)))return B;var ut=nu(B),zt=Nu(ut,nu(ne))+1;return Wl(ut,0,zt).join("")}function ia(B,ne,Te){if(B=ca(B),B&&(Te||ne===j))return B.replace(Ht,"");if(!B||!(ne=ec(ne)))return B;var ut=nu(B),zt=Io(ut,nu(ne));return Wl(ut,zt).join("")}function oa(B,ne){var Te=ft,ut=Mt;if(gs(ne)){var zt="separator"in ne?ne.separator:zt;Te="length"in ne?ua(ne.length):Te,ut="omission"in ne?ec(ne.omission):ut}B=ca(B);var gn=B.length;if(of(B)){var Un=nu(B);gn=Un.length}if(Te>=gn)return B;var nr=Te-Qf(ut);if(nr<1)return ut;var mr=Un?Wl(Un,0,nr).join(""):B.slice(0,nr);if(zt===j)return mr+ut;if(Un&&(nr+=mr.length-nr),vu(zt)){if(B.slice(nr).search(zt)){var oi,si=mr;for(zt.global||(zt=Sf(zt.source,ca(Yt.exec(zt))+"g")),zt.lastIndex=0;oi=zt.exec(si);)var Xr=oi.index;mr=mr.slice(0,Xr===j?nr:Xr)}}else if(B.indexOf(ec(zt),nr)!=nr){var Li=mr.lastIndexOf(zt);Li>-1&&(mr=mr.slice(0,Li))}return mr+ut}function wa(B){return B=ca(B),B&&Ui.test(B)?B.replace(mo,Zf):B}var ba=nc(function(B,ne,Te){return B+(Te?" ":"")+ne.toUpperCase()}),ja=Ff("toUpperCase");function Qa(B,ne,Te){return B=ca(B),ne=Te?j:ne,ne===j?Wp(B)?Qd(B):Rs(B):B.match(ne)||[]}var Ls=sa(function(B,ne){try{return Ec(B,j,ne)}catch(Te){return xf(Te)?Te:new go(Te)}}),Uo=dh(function(B,ne){return el(ne,function(Te){Te=gf(Te),Hr(B,Te,De(B[Te],B))}),B});function ka(B){var ne=B==null?0:B.length,Te=to();return B=ne?es(B,function(ut){if(typeof ut[1]!="function")throw new Ru(z);return[Te(ut[0]),ut[1]]}):[],sa(function(ut){for(var zt=-1;++zt<ne;){var gn=B[zt];if(Ec(gn[0],this,ut))return Ec(gn[1],this,ut)}})}function Za(B){return pi(li(B,M))}function mc(B){return function(){return B}}function gc(B,ne){return B==null||B!==B?ne:B}var vc=Bg(),Ep=Bg(!0);function qu(B){return B}function Ud(B){return Lu(typeof B=="function"?B:li(B,M))}function fl(B){return hu(li(B,M))}function e0(B,ne){return Ps(B,li(ne,M))}var F0=sa(function(B,ne){return function(Te){return Js(Te,B,ne)}}),Cp=sa(function(B,ne){return function(Te){return Js(B,Te,ne)}});function dg(B,ne,Te){var ut=At(ne),zt=Jo(ne,ut);Te==null&&!(gs(ne)&&(zt.length||!ut.length))&&(Te=ne,ne=B,B=this,zt=Jo(ne,At(ne)));var gn=!(gs(Te)&&"chain"in Te)||!!Te.chain,Un=Ja(B);return el(zt,function(nr){var mr=ne[nr];B[nr]=mr,Un&&(B.prototype[nr]=function(){var oi=this.__chain__;if(gn||oi){var si=B(this.__wrapped__),Xr=si.__actions__=ou(this.__actions__);return Xr.push({func:mr,args:arguments,thisArg:B}),si.__chain__=oi,si}return mr.apply(B,Nl([this.value()],arguments))})}),B}function ym(){return tu._===this&&(tu._=Xs),this}function A1(){}function _v(B){return B=ua(B),sa(function(ne){return Wi(ne,B)})}var Ap=Vm(es),O1=Vm($s),eb=Vm(La);function cy(B){return tm(B)?la(gf(B)):s0(B)}function S1(B){return function(ne){return B==null?j:Pa(B,ne)}}var D1=G0(),T1=G0(!0);function Gb(){return[]}function $b(){return!1}function q2(){return{}}function uE(){return""}function cE(){return!0}function lE(B,ne){if(B=ua(B),B<1||B>Qe)return[];var Te=Ct,ut=lu(B,Ct);ne=to(ne),B-=Ct;for(var zt=nf(ut,ne);++Te<B;)ne(Te);return zt}function Kb(B){return Hi(B)?es(B,gf):Vu(B)?[B]:ou(am(ca(B)))}function tb(B){var ne=++Dg;return ca(B)+ne}var Xb=Lc(function(B,ne){return B+ne},0),Yb=$h("ceil"),Ev=Lc(function(B,ne){return B/ne},1),Cv=$h("floor");function H2(B){return B&&B.length?Ia(B,qu,Wa):j}function nb(B,ne){return B&&B.length?Ia(B,to(ne,2),Wa):j}function G2(B){return Ks(B,qu)}function Jb(B,ne){return Ks(B,to(ne,2))}function $2(B){return B&&B.length?Ia(B,qu,Ll):j}function K2(B,ne){return B&&B.length?Ia(B,to(ne,2),Ll):j}var X2=Lc(function(B,ne){return B*ne},1),Y2=$h("round"),J2=Lc(function(B,ne){return B-ne},0);function fE(B){return B&&B.length?sc(B,qu):0}function Q2(B,ne){return B&&B.length?sc(B,to(ne,2)):0}return Kt.after=de,Kt.ary=_e,Kt.assign=kv,Kt.assignIn=Cl,Kt.assignInWith=wf,Kt.assignWith=b,Kt.at=h,Kt.before=Re,Kt.bind=De,Kt.bindAll=Uo,Kt.bindKey=tt,Kt.castArray=ga,Kt.chain=bf,Kt.chunk=sm,Kt.compact=d0,Kt.concat=nd,Kt.cond=ka,Kt.conforms=Za,Kt.constant=mc,Kt.countBy=ad,Kt.create=u,Kt.curry=st,Kt.curryRight=It,Kt.debounce=Bt,Kt.defaults=d,Kt.defaultsDeep=x,Kt.defer=mn,Kt.delay=xn,Kt.difference=p0,Kt.differenceBy=um,Kt.differenceWith=Jm,Kt.drop=m0,Kt.dropRight=g0,Kt.dropRightWhile=Wg,Kt.dropWhile=v0,Kt.fill=y0,Kt.filter=ug,Kt.flatMap=Pd,Kt.flatMapDeep=cg,Kt.flatMapDepth=mm,Kt.flatten=Vg,Kt.flattenDeep=mh,Kt.flattenDepth=qg,Kt.flip=Fn,Kt.flow=vc,Kt.flowRight=Ep,Kt.fromPairs=x0,Kt.functions=je,Kt.functionsIn=Pe,Kt.groupBy=sd,Kt.initial=Qm,Kt.intersection=Hg,Kt.intersectionBy=vf,Kt.intersectionWith=Gg,Kt.invert=it,Kt.invertBy=ht,Kt.invokeMap=N0,Kt.iteratee=Ud,Kt.keyBy=I0,Kt.keys=At,Kt.keysIn=St,Kt.map=wh,Kt.mapKeys=Gt,Kt.mapValues=un,Kt.matches=fl,Kt.matchesProperty=e0,Kt.memoize=Rn,Kt.merge=vn,Kt.mergeWith=cn,Kt.method=F0,Kt.methodOf=Cp,Kt.mixin=dg,Kt.negate=Ln,Kt.nthArg=_v,Kt.omit=kn,Kt.omitBy=On,Kt.once=Zn,Kt.orderBy=gm,Kt.over=Ap,Kt.overArgs=An,Kt.overEvery=O1,Kt.overSome=eb,Kt.partial=Sr,Kt.partialRight=Ur,Kt.partition=J0,Kt.pick=p,Kt.pickBy=c,Kt.property=cy,Kt.propertyOf=S1,Kt.pull=mp,Kt.pullAll=vh,Kt.pullAllBy=k0,Kt.pullAllWith=Md,Kt.pullAt=yf,Kt.range=D1,Kt.rangeRight=T1,Kt.rearg=Wr,Kt.reject=ii,Kt.remove=gp,Kt.rest=ci,Kt.reverse=jd,Kt.sampleSize=E,Kt.set=l,Kt.setWith=y,Kt.shuffle=_,Kt.slice=Zm,Kt.sortBy=q,Kt.sortedUniq=eg,Kt.sortedUniqBy=od,Kt.split=Nr,Kt.spread=Jr,Kt.tail=cm,Kt.take=yh,Kt.takeRight=A0,Kt.takeRightWhile=tg,Kt.takeWhile=ng,Kt.tap=Bd,Kt.throttle=Xi,Kt.thru=og,Kt.toArray=Q0,Kt.toPairs=S,Kt.toPairsIn=U,Kt.toPath=Kb,Kt.toPlainObject=Zg,Kt.transform=G,Kt.unary=lo,Kt.union=Kg,Kt.unionBy=Lf,Kt.unionWith=rg,Kt.uniq=O0,Kt.uniqBy=bh,Kt.uniqWith=lm,Kt.unset=ae,Kt.unzip=xh,Kt.unzipWith=yp,Kt.update=le,Kt.updateWith=be,Kt.values=Se,Kt.valuesIn=Ie,Kt.without=Cu,Kt.words=Qa,Kt.wrap=io,Kt.xor=ig,Kt.xorBy=Xg,Kt.xorWith=fm,Kt.zip=hm,Kt.zipObject=Yg,Kt.zipObjectDeep=S0,Kt.zipWith=Y0,Kt.entries=S,Kt.entriesIn=U,Kt.extend=Cl,Kt.extendWith=wf,dg(Kt,Kt),Kt.add=Xb,Kt.attempt=Ls,Kt.camelCase=Xe,Kt.capitalize=at,Kt.ceil=Yb,Kt.clamp=Me,Kt.clone=Ya,Kt.cloneDeep=Aa,Kt.cloneDeepWith=Ma,Kt.cloneWith=Ta,Kt.conformsTo=rs,Kt.deburr=gt,Kt.defaultTo=gc,Kt.divide=Ev,Kt.endsWith=bt,Kt.eq=va,Kt.escape=_t,Kt.escapeRegExp=jt,Kt.every=xv,Kt.find=au,Kt.findIndex=rd,Kt.findKey=T,Kt.findLast=pm,Kt.findLastIndex=b0,Kt.findLastKey=H,Kt.floor=Cv,Kt.forEach=lg,Kt.forEachRight=fg,Kt.forIn=Z,Kt.forInRight=ce,Kt.forOwn=ye,Kt.forOwnRight=Ee,Kt.get=ze,Kt.gt=Ns,Kt.gte=Tc,Kt.has=Ge,Kt.hasIn=rt,Kt.head=id,Kt.identity=qu,Kt.includes=Hl,Kt.indexOf=gh,Kt.inRange=qe,Kt.invoke=Et,Kt.isArguments=Ji,Kt.isArray=Hi,Kt.isArrayBuffer=mu,Kt.isArrayLike=os,Kt.isArrayLikeObject=ya,Kt.isBoolean=cl,Kt.isBuffer=gu,Kt.isDate=ll,Kt.isElement=xp,Kt.isEmpty=Ld,Kt.isEqual=kh,Kt.isEqualWith=ud,Kt.isError=xf,Kt.isFinite=Gl,Kt.isFunction=Ja,Kt.isInteger=_h,Kt.isLength=Uf,Kt.isMap=Au,Kt.isMatch=zd,Kt.isMatchWith=wp,Kt.isNaN=kp,Kt.isNative=Wf,Kt.isNil=$l,Kt.isNull=vm,Kt.isNumber=Wu,Kt.isObject=gs,Kt.isObjectLike=as,Kt.isPlainObject=pc,Kt.isRegExp=vu,Kt.isSafeInteger=Eh,Kt.isSet=cd,Kt.isString=Ch,Kt.isSymbol=Vu,Kt.isTypedArray=Vf,Kt.isUndefined=Ah,Kt.isWeakMap=Wc,Kt.isWeakSet=wv,Kt.join=w0,Kt.kebabCase=Qt,Kt.last=Uu,Kt.lastIndexOf=X0,Kt.lowerCase=sn,Kt.lowerFirst=Zt,Kt.lt=Oh,Kt.lte=_p,Kt.max=H2,Kt.maxBy=nb,Kt.mean=G2,Kt.meanBy=Jb,Kt.min=$2,Kt.minBy=K2,Kt.stubArray=Gb,Kt.stubFalse=$b,Kt.stubObject=q2,Kt.stubString=uE,Kt.stubTrue=cE,Kt.multiply=X2,Kt.nth=pp,Kt.noConflict=ym,Kt.noop=A1,Kt.now=ee,Kt.pad=rn,Kt.padEnd=Sn,Kt.padStart=Bn,Kt.parseInt=Mn,Kt.random=Ye,Kt.reduce=Jg,Kt.reduceRight=hg,Kt.repeat=fr,Kt.replace=yr,Kt.result=a,Kt.round=Y2,Kt.runInContext=cr,Kt.sample=P,Kt.size=k,Kt.snakeCase=Cr,Kt.some=D,Kt.sortedIndex=$g,Kt.sortedIndexBy=_0,Kt.sortedIndexOf=Eu,Kt.sortedLastIndex=E0,Kt.sortedLastIndexBy=vp,Kt.sortedLastIndexOf=C0,Kt.startCase=Ar,Kt.startsWith=_r,Kt.subtract=J2,Kt.sum=fE,Kt.sumBy=Q2,Kt.template=Yr,Kt.times=lE,Kt.toFinite=ld,Kt.toInteger=ua,Kt.toLength=Qg,Kt.toLower=Kr,Kt.toNumber=Kl,Kt.toSafeInteger=Z0,Kt.toString=ca,Kt.toUpper=fi,Kt.trim=Ti,Kt.trimEnd=Yi,Kt.trimStart=ia,Kt.truncate=oa,Kt.unescape=wa,Kt.uniqueId=tb,Kt.upperCase=ba,Kt.upperFirst=ja,Kt.each=lg,Kt.eachRight=fg,Kt.first=id,dg(Kt,function(){var B={};return Zi(Kt,function(ne,Te){ma.call(Kt.prototype,Te)||(B[Te]=ne)}),B}(),{chain:!1}),Kt.VERSION=m,el(["bind","bindKey","curry","curryRight","partial","partialRight"],function(B){Kt[B].placeholder=Kt}),el(["drop","take"],function(B,ne){uo.prototype[B]=function(Te){Te=Te===j?1:Ss(ua(Te),0);var ut=this.__filtered__&&!ne?new uo(this):this.clone();return ut.__filtered__?ut.__takeCount__=lu(Te,ut.__takeCount__):ut.__views__.push({size:lu(Te,Ct),type:B+(ut.__dir__<0?"Right":"")}),ut},uo.prototype[B+"Right"]=function(Te){return this.reverse()[B](Te).reverse()}}),el(["filter","map","takeWhile"],function(B,ne){var Te=ne+1,ut=Te==Ce||Te==en;uo.prototype[B]=function(zt){var gn=this.clone();return gn.__iteratees__.push({iteratee:to(zt,3),type:Te}),gn.__filtered__=gn.__filtered__||ut,gn}}),el(["head","last"],function(B,ne){var Te="take"+(ne?"Right":"");uo.prototype[B]=function(){return this[Te](1).value()[0]}}),el(["initial","tail"],function(B,ne){var Te="drop"+(ne?"":"Right");uo.prototype[B]=function(){return this.__filtered__?new uo(this):this[Te](1)}}),uo.prototype.compact=function(){return this.filter(qu)},uo.prototype.find=function(B){return this.filter(B).head()},uo.prototype.findLast=function(B){return this.reverse().find(B)},uo.prototype.invokeMap=sa(function(B,ne){return typeof B=="function"?new uo(this):this.map(function(Te){return Js(Te,B,ne)})}),uo.prototype.reject=function(B){return this.filter(Ln(to(B)))},uo.prototype.slice=function(B,ne){B=ua(B);var Te=this;return Te.__filtered__&&(B>0||ne<0)?new uo(Te):(B<0?Te=Te.takeRight(-B):B&&(Te=Te.drop(B)),ne!==j&&(ne=ua(ne),Te=ne<0?Te.dropRight(-ne):Te.take(ne-B)),Te)},uo.prototype.takeRightWhile=function(B){return this.reverse().takeWhile(B).reverse()},uo.prototype.toArray=function(){return this.take(Ct)},Zi(uo.prototype,function(B,ne){var Te=/^(?:filter|find|map|reject)|While$/.test(ne),ut=/^(?:head|last)$/.test(ne),zt=Kt[ut?"take"+(ne=="last"?"Right":""):ne],gn=ut||/^find/.test(ne);!zt||(Kt.prototype[ne]=function(){var Un=this.__wrapped__,nr=ut?[1]:arguments,mr=Un instanceof uo,oi=nr[0],si=mr||Hi(Un),Xr=function(Ha){var vs=zt.apply(Kt,Nl([Ha],nr));return ut&&Li?vs[0]:vs};si&&Te&&typeof oi=="function"&&oi.length!=1&&(mr=si=!1);var Li=this.__chain__,fo=!!this.__actions__.length,ea=gn&&!Li,qa=mr&&!fo;if(!gn&&si){Un=qa?Un:new uo(this);var ta=B.apply(Un,nr);return ta.__actions__.push({func:og,args:[Xr],thisArg:j}),new po(ta,Li)}return ea&&qa?B.apply(this,nr):(ta=this.thru(Xr),ea?ut?ta.value()[0]:ta.value():ta)})}),el(["pop","push","shift","sort","splice","unshift"],function(B){var ne=Fl[B],Te=/^(?:push|sort|unshift)$/.test(B)?"tap":"thru",ut=/^(?:pop|shift)$/.test(B);Kt.prototype[B]=function(){var zt=arguments;if(ut&&!this.__chain__){var gn=this.value();return ne.apply(Hi(gn)?gn:[],zt)}return this[Te](function(Un){return ne.apply(Hi(Un)?Un:[],zt)})}}),Zi(uo.prototype,function(B,ne){var Te=Kt[ne];if(Te){var ut=Te.name+"";ma.call(jl,ut)||(jl[ut]=[]),jl[ut].push({name:ne,func:Te})}}),jl[Td(j,ue).name]=[{name:"wrapper",func:j}],uo.prototype.clone=js,uo.prototype.reverse=ju,uo.prototype.value=ts,Kt.prototype.at=D0,Kt.prototype.chain=zf,Kt.prototype.commit=pu,Kt.prototype.next=bp,Kt.prototype.plant=ag,Kt.prototype.reverse=T0,Kt.prototype.toJSON=Kt.prototype.valueOf=Kt.prototype.value=sg,Kt.prototype.first=Kt.prototype.head,Oc&&(Kt.prototype[Oc]=dm),Kt},Il=wo();so?((so.exports=Il)._=Il,Ih._=Il):tu._=Il}).call(z2)})(EM,EM.exports);function CM(nt,he,j){const m=nt.slice();return m[69]=he[j],m}function AM(nt,he,j){const m=nt.slice();return m[69]=he[j],m}function OM(nt,he,j){const m=nt.slice();return m[74]=he[j][0],m[75]=he[j][1],m[76]=he[j][2],m[77]=he[j][3],m[78]=he[j][4],m}function SG(nt){let he;return{c(){he=Er("option"),he.textContent="\uB4E3\uB294 \uC911\uC5D0\uB294 \uBCC0\uACBD\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4",he.__value="",he.value=he.__value,he.disabled=!0,he.selected=!0,Wn(he,"class","svelte-1xo4t40")},m(j,m){vi(j,he,m)},d(j){j&&gi(he)}}}function DG(nt){let he,j,m,o,g,z,I,A,X,K,M,V,$;return{c(){he=Er("option"),he.textContent="\uBE60\uB974\uAE30\uB9D0 | bpm",j=Er("option"),j.textContent="grave (42)",m=Er("option"),m.textContent="largo (50)",o=Er("option"),o.textContent="larghetto (56)",g=Er("option"),g.textContent="adagio (60)",z=Er("option"),z.textContent="andate (66)",I=Er("option"),I.textContent="andantino (69)",A=Er("option"),A.textContent="moderato (88)",X=Er("option"),X.textContent="allegretto (115)",K=Er("option"),K.textContent="allegro (132)",M=Er("option"),M.textContent="vivace (160)",V=Er("option"),V.textContent="presto (184)",$=Er("option"),$.textContent="prestissimo (208)",he.__value="",he.value=he.__value,he.disabled=!0,Wn(he,"class","svelte-1xo4t40"),j.__value="42",j.value=j.__value,Wn(j,"class","svelte-1xo4t40"),m.__value="50",m.value=m.__value,Wn(m,"class","svelte-1xo4t40"),o.__value="56",o.value=o.__value,Wn(o,"class","svelte-1xo4t40"),g.__value="60",g.value=g.__value,Wn(g,"class","svelte-1xo4t40"),z.__value="66",z.value=z.__value,Wn(z,"class","svelte-1xo4t40"),I.__value="69",I.value=I.__value,Wn(I,"class","svelte-1xo4t40"),A.__value="88",A.value=A.__value,A.selected=!0,Wn(A,"class","svelte-1xo4t40"),X.__value="115",X.value=X.__value,Wn(X,"class","svelte-1xo4t40"),K.__value="132",K.value=K.__value,Wn(K,"class","svelte-1xo4t40"),M.__value="160",M.value=M.__value,Wn(M,"class","svelte-1xo4t40"),V.__value="184",V.value=V.__value,Wn(V,"class","svelte-1xo4t40"),$.__value="208",$.value=$.__value,Wn($,"class","svelte-1xo4t40")},m(W,te){vi(W,he,te),vi(W,j,te),vi(W,m,te),vi(W,o,te),vi(W,g,te),vi(W,z,te),vi(W,I,te),vi(W,A,te),vi(W,X,te),vi(W,K,te),vi(W,M,te),vi(W,V,te),vi(W,$,te)},d(W){W&&gi(he),W&&gi(j),W&&gi(m),W&&gi(o),W&&gi(g),W&&gi(z),W&&gi(I),W&&gi(A),W&&gi(X),W&&gi(K),W&&gi(M),W&&gi(V),W&&gi($)}}}function TG(nt){let he,j,m,o,g,z;return{c(){he=Er("div"),j=Er("span"),m=Du(nt[29]),o=zi(),g=Er("span"),z=Du(nt[30]),Wn(j,"class","svelte-1xo4t40"),Wn(g,"class","svelte-1xo4t40"),Wn(he,"class","beatNum svelte-1xo4t40"),Qn(he,"top","68px")},m(I,A){vi(I,he,A),vr(he,j),vr(j,m),vr(he,o),vr(he,g),vr(g,z)},p(I,A){A[0]&536870912&&Xv(m,I[29]),A[0]&1073741824&&Xv(z,I[30])},i:bs,o:bs,d(I){I&&gi(he)}}}function NG(nt){let he,j;return he=new MM({props:{btm:201}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p:bs,i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function IG(nt){let he,j;return he=new RM({props:{top:85}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p:bs,i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function SM(nt){let he,j;return he=new bG({props:{heightNum:nt[74],noteNum:nt[75],noteId:nt[76],point:nt[77],sharp:nt[78],realBeat:4/nt[75],notes:nt[31]}}),he.$on("send",nt[34]),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p(m,o){const g={};o[1]&1&&(g.heightNum=m[74]),o[1]&1&&(g.noteNum=m[75]),o[1]&1&&(g.noteId=m[76]),o[1]&1&&(g.point=m[77]),o[1]&1&&(g.sharp=m[78]),o[1]&1&&(g.realBeat=4/m[75]),o[1]&1&&(g.notes=m[31]),he.$set(g)},i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function DM(nt){let he;return{c(){he=Er("div"),he.innerHTML='<img src="/Music-staff.svg" alt="" style="height: 71px; top: 16px;" class="svelte-1xo4t40"/>',Wn(he,"class","stfImg svelte-1xo4t40")},m(j,m){vi(j,he,m)},p:bs,d(j){j&&gi(he)}}}function FG(nt){let he,j,m,o,g,z;return{c(){he=Er("div"),j=Er("span"),m=Du(nt[29]),o=zi(),g=Er("span"),z=Du(nt[30]),Wn(j,"class","svelte-1xo4t40"),Wn(g,"class","svelte-1xo4t40"),Wn(he,"class","beatNum svelte-1xo4t40"),Qn(he,"top","200px")},m(I,A){vi(I,he,A),vr(he,j),vr(j,m),vr(he,o),vr(he,g),vr(g,z)},p(I,A){A[0]&536870912&&Xv(m,I[29]),A[0]&1073741824&&Xv(z,I[30])},i:bs,o:bs,d(I){I&&gi(he)}}}function RG(nt){let he,j;return he=new MM({props:{btm:71}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p:bs,i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function MG(nt){let he,j;return he=new RM({props:{top:217}}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p:bs,i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}function TM(nt){let he;return{c(){he=Er("div"),he.innerHTML='<img src="/Music-staff.svg" alt="" style="height: 71px; top: 48px;" class="svelte-1xo4t40"/>',Wn(he,"class","stfImg svelte-1xo4t40")},m(j,m){vi(j,he,m)},p:bs,d(j){j&&gi(he)}}}function jG(nt){let he,j,m,o,g,z,I,A,X,K,M,V,$,W,te,F,ue,se,J,me,pe,Oe,Fe,Le,Ae,ft,Mt,Xt,tn,Ce,Wt,en,Ut,Qe,fn,on,Ct,Vt,En,Pt,Rt,Tn,Hn,tr,pn,$e,et,Ke,yt,Dt,Lt,zn,Cn,ar,we,lr,Rr,Tr,qr,Gr,hn,nn,an,or,jn,Fr,Pr,Br,wi,Ai,Jn,di,ri,Dr,ki,Ei,mo,Gi,Ui,Ot,$r,$t,xe=nt[32][nt[32].indexOf(nt[11])+1]+"",ge,ke,Ne,ot,xt,Ht,yn,dr,_n,In,Gn,Nt,Ft,bn,Yt,He,$n,ur,pr,kr,ui,Ir,ji,Do,Bi,no,$i,mi,ai,qn,Di,ko,Zr,Wo,Oo,So,To,ds,As,Cf,eo,bu,wc,kc,_c,ws,Ql,Hs,Mc,Af,Gs,Zl,pl,ml,Gc,ha,$c,Ga;he=new OG({}),he.$on("send",nt[35]);function Kc(xi,hr){return xi[28]===0?DG:SG}let Is=Kc(nt),Ba=Is(nt);const jc=[IG,NG,TG],ac=[];function Xc(xi,hr){return xi[30]==4&&xi[29]==4?0:xi[30]==2&&xi[29]==2?1:2}bn=Xc(nt),Yt=ac[bn]=jc[bn](nt);let eu=nt[31],ps=[];for(let xi=0;xi<eu.length;xi+=1)ps[xi]=SM(OM(nt,eu,xi));const ef=xi=>Ii(ps[xi],1,1,()=>{ps[xi]=null});let Yc=Array(nt[31].length*2+100),na=[];for(let xi=0;xi<Yc.length;xi+=1)na[xi]=DM(AM(nt,Yc,xi));const Xf=[MG,RG,FG],Jc=[];function Of(xi,hr){return xi[30]==4&&xi[29]==4?0:xi[30]==2&&xi[29]==2?1:2}no=Of(nt),$i=Jc[no]=Xf[no](nt);let da=Array(nt[31].length*2+100),Qi=[];for(let xi=0;xi<da.length;xi+=1)Qi[xi]=TM(CM(nt,da,xi));return bu=new Rq({}),bu.$on("send",nt[33]),{c(){xs(he.$$.fragment),j=zi(),m=Er("main"),o=Er("div"),g=Er("img"),I=zi(),A=Er("span"),A.textContent="Volume /",X=zi(),K=Du(nt[24]),M=zi(),V=Er("div"),$=Er("div"),$.innerHTML=`<img src="/listen.svg" alt="/listen.svg" class="svelte-1xo4t40"/> 
            <span class="startL svelte-1xo4t40">Start listening</span>`,W=zi(),te=Er("div"),te.innerHTML=`<img src="/listen.svg" alt="/listen.svg" class="svelte-1xo4t40"/> 
            <span class="startL svelte-1xo4t40">Stop listening</span> 
            <div id="stopL" class="svelte-1xo4t40"></div>`,F=zi(),ue=Er("div"),ue.innerHTML=`<img src="/makebar.svg" alt="/makebar.svg" id="makebarIcon" style="height: 25px;" class="svelte-1xo4t40"/> 
            <span class="startL svelte-1xo4t40">Make Bars</span>`,se=zi(),J=Er("div"),J.innerHTML=`<img src="/setting.svg" alt="/setting.svg" style="height: 27px;" class="svelte-1xo4t40"/> 
            <span class="startL svelte-1xo4t40">Setting</span>`,me=zi(),pe=Er("div"),pe.innerHTML='<img src="/playnpause.svg" alt="/playnpause.svg" style="height: 18px;" class="svelte-1xo4t40"/>',Oe=zi(),Fe=Er("div"),Le=Er("a"),Le.innerHTML='<span class="svelte-1xo4t40">?</span>',Ae=zi(),ft=Er("div"),Mt=Er("div"),Xt=Er("div"),Xt.innerHTML=`<img src="/save.svg" alt="/save.svg" style="height: 25px;" class="svelte-1xo4t40"/> 
                    <span class="startL svelte-1xo4t40">Save</span>`,tn=zi(),Ce=Er("div"),Ce.innerHTML=`<img src="/load.svg" alt="/load.svg" style="height: 25px;" class="svelte-1xo4t40"/> 
                    <span class="startL svelte-1xo4t40">Load</span>`,Wt=zi(),en=Er("div"),en.innerHTML=`<img src="/remove.svg" alt="/remove.svg" style="height: 25px; margin-right: 5px;" class="svelte-1xo4t40"/> 
                <span class="startL svelte-1xo4t40">Data remove</span>`,Ut=zi(),Qe=Er("div"),Qe.innerHTML=`<img src="/BPM.svg" alt="/BPM.svg" style="height: 28px;" class="svelte-1xo4t40"/> 
                <span class="startL svelte-1xo4t40">BPM</span>`,fn=zi(),on=Er("div"),on.innerHTML=`<img src="/Beat.svg" alt="/Beat.svg" style="height: 28px;" class="svelte-1xo4t40"/> 
                <span class="startL svelte-1xo4t40">Beat</span>`,Ct=zi(),Vt=Er("div"),En=Er("div"),En.textContent="BPM Setting",Pt=zi(),Rt=Er("div"),Tn=Er("div"),Hn=Er("select"),Ba.c(),tr=zi(),pn=Er("div"),$e=Du("\uD604\uC7AC \uAC12 : "),et=Du(nt[11]),Ke=Du("bpm"),yt=zi(),Dt=Er("div"),Lt=Er("div"),Lt.textContent="Beat Setting",zn=zi(),Cn=Er("div"),ar=Er("div"),we=Er("select"),lr=Er("option"),lr.textContent="2/2",Rr=Er("option"),Rr.textContent="2/4",Tr=Er("option"),Tr.textContent="3/4",qr=Er("option"),qr.textContent="4/4",Gr=Er("option"),Gr.textContent="5/4",hn=Er("option"),hn.textContent="3/8",nn=Er("option"),nn.textContent="6/8",an=Er("option"),an.textContent="12/8",or=zi(),jn=Er("div"),Fr=Du("\uD604\uC7AC \uAC12 : "),Pr=Du(nt[29]),Br=Du("/"),wi=Du(nt[30]),Ai=zi(),Jn=Er("div"),Jn.innerHTML='<span class="svelte-1xo4t40">&lt;</span>',di=zi(),ri=Er("div"),ri.innerHTML='<span class="svelte-1xo4t40">x</span>',Dr=zi(),ki=Er("div"),Ei=Er("div"),Ei.innerHTML='<div class="svelte-1xo4t40"><div id="pitchTxt" class="svelte-1xo4t40"></div></div>',mo=zi(),Gi=Er("div"),Ui=zi(),Ot=Er("div"),$r=Er("div"),$t=Er("span"),ge=Du(xe),ke=zi(),Ne=Er("img"),xt=Du(`\r
                =\r
                `),Ht=Du(nt[11]),yn=zi(),dr=Er("div"),_n=zi(),In=Er("div"),Gn=Er("img"),Ft=zi(),Yt.c(),He=zi(),$n=Er("div");for(let xi=0;xi<ps.length;xi+=1)ps[xi].c();ur=zi(),pr=Er("div"),kr=zi();for(let xi=0;xi<na.length;xi+=1)na[xi].c();ui=zi(),Ir=Er("div"),ji=Er("img"),Bi=zi(),$i.c(),mi=zi();for(let xi=0;xi<Qi.length;xi+=1)Qi[xi].c();ai=zi(),qn=Er("div"),Di=Er("div"),Di.innerHTML='<img src="/\uC628\uC74C\uD45C.svg" alt="/\uC628\uC74C\uD45C.svg" style="height: 10px; position: relative; left: 1px; top: 9px;" class="svelte-1xo4t40"/>',ko=zi(),Zr=Er("div"),Zr.innerHTML='<img src="/2\uBD84\uC74C\uD45C(1).svg" alt="/2\uBD84\uC74C\uD45C(1).svg" style="height: 30px; position: relative; left: 1px;" class="svelte-1xo4t40"/>',Wo=zi(),Oo=Er("div"),Oo.innerHTML='<img src="/4\uBD84\uC74C\uD45C(1).svg" alt="/4\uBD84\uC74C\uD45C(1).svg" style="height: 30px; position: relative; left: 1px;" class="svelte-1xo4t40"/>',So=zi(),To=Er("div"),To.innerHTML='<img src="/8\uBD84\uC74C\uD45C(1).svg" alt="/8\uC628\uC74C\uD45C(1).svg" style="height: 30px; position: relative; left: 1px;" class="svelte-1xo4t40"/>',ds=zi(),As=Er("div"),As.innerHTML='<img src="/16\uBD84\uC74C\uD45C(1).png" alt="/16\uBD84\uC74C\uD45C(1).png" style="height: 30px; position: relative; left: 1px;" class="svelte-1xo4t40"/>',Cf=zi(),eo=Er("div"),xs(bu.$$.fragment),wc=zi(),kc=Er("span"),kc.textContent="The piano is operated at a longer horizontal length (over 1330px)",_c=zi(),ws=Er("div"),Ql=Er("div"),Ql.innerHTML=`<img src="/add.svg" alt="/add.svg" style="height: 27px;" class="svelte-1xo4t40"/> 
                <span class="startL svelte-1xo4t40">Add Point</span>`,Hs=zi(),Mc=Er("div"),Mc.innerHTML=`<img src="/remove.svg" alt="/remove.svg" style="height: 27px;" class="svelte-1xo4t40"/> 
                <span class="startL svelte-1xo4t40">Remove Point</span>`,Af=zi(),Gs=Er("div"),Gs.innerHTML=`<img src="/remove.svg" alt="/remove.svg" style="height: 27px;" class="svelte-1xo4t40"/> 
                <span class="startL svelte-1xo4t40">Remove Note</span>`,Zl=zi(),pl=Er("div"),ml=zi(),Gc=Er("div"),Mm(g.src,z="/volume.svg")||Wn(g,"src",z),Wn(g,"alt","volume.svg"),Wn(g,"class","svelte-1xo4t40"),Wn(A,"class","svelte-1xo4t40"),Wn(o,"id","volumeDiv"),Wn(o,"class","svelte-1xo4t40"),Wn($,"class","center btn realBtn svelte-1xo4t40"),Wn(te,"class","center btn realBtn svelte-1xo4t40"),Wn(ue,"class","center btn realBtn svelte-1xo4t40"),Wn(J,"class","center btn realBtn svelte-1xo4t40"),Wn(pe,"id","playBtn"),Wn(pe,"class","svelte-1xo4t40"),Wn(V,"id","btns"),Wn(V,"class","center svelte-1xo4t40"),Wn(Le,"id","help"),Wn(Le,"href","https://discord.gg/tZsuXSbaZy"),Wn(Le,"target","\u201D_blank\u201D"),Wn(Le,"class","svelte-1xo4t40"),Wn(Xt,"class","center btn svNld svelte-1xo4t40"),Wn(Ce,"class","center btn svNld svelte-1xo4t40"),Wn(Mt,"id","svNldCon"),Wn(Mt,"class","svelte-1xo4t40"),Wn(en,"class","center btn svNld svelte-1xo4t40"),Wn(Qe,"class","center btn realBtn svelte-1xo4t40"),Wn(on,"class","center btn realBtn svelte-1xo4t40"),Qn(En,"position","relative"),Qn(En,"bottom","2px"),Wn(En,"class","svelte-1xo4t40"),Wn(Hn,"name","bpmVal"),Wn(Hn,"id","bpmVal"),Wn(Hn,"class","svelte-1xo4t40"),Wn(Tn,"class","selectCon svelte-1xo4t40"),Qn(Tn,"position","relative"),Qn(Tn,"top","-2px"),Qn(Rt,"positoin","relative"),Qn(Rt,"text-align","center"),Wn(Rt,"class","svelte-1xo4t40"),Qn(pn,"position","relative"),Qn(pn,"top","20px"),Qn(pn,"text-align","center"),Wn(pn,"class","svelte-1xo4t40"),Wn(Vt,"id","bpmPu"),Wn(Vt,"class","spus svelte-1xo4t40"),Qn(Vt,"display","none"),Qn(Lt,"position","relative"),Qn(Lt,"bottom","2px"),Wn(Lt,"class","svelte-1xo4t40"),lr.__value="2/2",lr.value=lr.__value,Wn(lr,"class","svelte-1xo4t40"),Rr.__value="2/4",Rr.value=Rr.__value,Wn(Rr,"class","svelte-1xo4t40"),Tr.__value="3/4",Tr.value=Tr.__value,Wn(Tr,"class","svelte-1xo4t40"),qr.__value="4/4",qr.value=qr.__value,qr.selected=!0,Wn(qr,"class","svelte-1xo4t40"),Gr.__value="5/4",Gr.value=Gr.__value,Wn(Gr,"class","svelte-1xo4t40"),hn.__value="3/8",hn.value=hn.__value,Wn(hn,"class","svelte-1xo4t40"),nn.__value="6/8",nn.value=nn.__value,Wn(nn,"class","svelte-1xo4t40"),an.__value="12/8",an.value=an.__value,Wn(an,"class","svelte-1xo4t40"),Wn(we,"name","beatVal"),Wn(we,"id","beatVal"),Wn(we,"class","svelte-1xo4t40"),Wn(ar,"class","selectCon svelte-1xo4t40"),Qn(ar,"position","relative"),Qn(ar,"top","-2px"),Qn(jn,"position","relative"),Qn(jn,"top","20px"),Qn(jn,"text-align","center"),Wn(jn,"class","svelte-1xo4t40"),Qn(Cn,"positoin","relative"),Qn(Cn,"text-align","center"),Wn(Cn,"class","svelte-1xo4t40"),Wn(Dt,"id","beatPu"),Wn(Dt,"class","spus svelte-1xo4t40"),Qn(Dt,"display","none"),Wn(Jn,"id","backBtn"),Qn(Jn,"display","none"),Wn(Jn,"class","svelte-1xo4t40"),Wn(ri,"id","exitBtn"),Wn(ri,"class","svelte-1xo4t40"),Wn(ft,"id","settingPopup"),Wn(ft,"class","svelte-1xo4t40"),Wn(Fe,"id","spuCon"),Qn(Fe,"display","none"),Wn(Fe,"class","svelte-1xo4t40"),Wn(Ei,"id","pitch"),Wn(Ei,"class","center svelte-1xo4t40"),Qn(Gi,"position","absolute"),Qn(Gi,"left","20px"),Qn(Gi,"top","320px"),Qn(Gi,"width","100%"),Qn(Gi,"text-align","center"),Wn(Gi,"class","svelte-1xo4t40"),Wn($t,"class","svelte-1xo4t40"),Mm(Ne.src,ot="/4\uBD84\uC74C\uD45C(1).svg")||Wn(Ne,"src",ot),Wn(Ne,"alt",""),Qn(Ne,"position","relative"),Qn(Ne,"left","10px"),Qn(Ne,"margin-right","10px"),Wn(Ne,"class","svelte-1xo4t40"),Qn($r,"position","absolute"),Qn($r,"font-size","20px"),Qn($r,"left","30px"),Qn($r,"top","-15px"),Wn($r,"class","svelte-1xo4t40"),Wn(dr,"id","justLine"),Wn(dr,"class","svelte-1xo4t40"),Mm(Gn.src,Nt="/Treble_Clef.png")||Wn(Gn,"src",Nt),Wn(Gn,"alt","tclef"),Wn(Gn,"id","tclef"),Wn(Gn,"class","svelte-1xo4t40"),Wn(pr,"id","whereLine"),Qn(pr,"left","calc(-10px + ("+nt[27]+" * 59.61px - 7.3px))"),Wn(pr,"class","svelte-1xo4t40"),Wn($n,"class","sheet svelte-1xo4t40"),Wn(In,"class","staffLine svelte-1xo4t40"),Mm(ji.src,Do="/Bass_Clef.png")||Wn(ji,"src",Do),Wn(ji,"alt","bclef"),Wn(ji,"id","bclef"),Wn(ji,"class","svelte-1xo4t40"),Wn(Ir,"class","staffLine svelte-1xo4t40"),Wn(Ot,"id","staff"),Wn(Ot,"class","svelte-1xo4t40"),Wn(Di,"class","center btn svelte-1xo4t40"),Wn(Di,"data-note","1"),Wn(Zr,"class","center btn svelte-1xo4t40"),Wn(Zr,"data-note","2"),Wn(Oo,"class","center btn svelte-1xo4t40"),Wn(Oo,"data-note","4"),Qn(Oo,"border","1px solid #000000"),Wn(To,"class","center btn svelte-1xo4t40"),Wn(To,"data-note","8"),Wn(As,"class","center btn svelte-1xo4t40"),Wn(As,"data-note","16"),Wn(qn,"id","noteBtnsCon"),Wn(qn,"data-test","wow"),Wn(qn,"class","svelte-1xo4t40"),Wn(kc,"class","svelte-1xo4t40"),Wn(eo,"id","piano"),Wn(eo,"class","svelte-1xo4t40"),Wn(Ql,"class","center btn realBtn svelte-1xo4t40"),Wn(Mc,"class","center btn realBtn svelte-1xo4t40"),Wn(Gs,"class","center btn realBtn svelte-1xo4t40"),Wn(ws,"id","rightPu"),Qn(ws,"top",nt[12]),Qn(ws,"left",nt[13]),Qn(ws,"display","none"),Wn(ws,"class","svelte-1xo4t40"),Wn(ki,"id","container"),Wn(ki,"class","svelte-1xo4t40"),Wn(pl,"id","spuHidden"),Qn(pl,"display","none"),Wn(pl,"class","svelte-1xo4t40"),Wn(Gc,"id","hidden"),Wn(Gc,"class","svelte-1xo4t40"),Wn(m,"class","center svelte-1xo4t40")},m(xi,hr){fs(he,xi,hr),vi(xi,j,hr),vi(xi,m,hr),vr(m,o),vr(o,g),vr(o,I),vr(o,A),vr(o,X),vr(o,K),nt[36](o),vr(m,M),vr(m,V),vr(V,$),nt[37]($),vr(V,W),vr(V,te),nt[38](te),vr(V,F),vr(V,ue),nt[39](ue),vr(V,se),vr(V,J),nt[40](J),vr(V,me),vr(V,pe),nt[41](pe),vr(m,Oe),vr(m,Fe),vr(Fe,Le),vr(Fe,Ae),vr(Fe,ft),vr(ft,Mt),vr(Mt,Xt),nt[42](Xt),vr(Mt,tn),vr(Mt,Ce),nt[43](Ce),vr(ft,Wt),vr(ft,en),nt[44](en),vr(ft,Ut),vr(ft,Qe),nt[45](Qe),vr(ft,fn),vr(ft,on),nt[46](on),vr(ft,Ct),vr(ft,Vt),vr(Vt,En),vr(Vt,Pt),vr(Vt,Rt),vr(Rt,Tn),vr(Tn,Hn),Ba.m(Hn,null),nt[47](Hn),vr(Vt,tr),vr(Vt,pn),vr(pn,$e),vr(pn,et),vr(pn,Ke),vr(ft,yt),vr(ft,Dt),vr(Dt,Lt),vr(Dt,zn),vr(Dt,Cn),vr(Cn,ar),vr(ar,we),vr(we,lr),vr(we,Rr),vr(we,Tr),vr(we,qr),vr(we,Gr),vr(we,hn),vr(we,nn),vr(we,an),nt[48](we),vr(Cn,or),vr(Cn,jn),vr(jn,Fr),vr(jn,Pr),vr(jn,Br),vr(jn,wi),vr(ft,Ai),vr(ft,Jn),nt[49](Jn),vr(ft,di),vr(ft,ri),nt[50](ri),vr(m,Dr),vr(m,ki),vr(ki,Ei),vr(ki,mo),vr(ki,Gi),nt[51](Gi),vr(ki,Ui),vr(ki,Ot),vr(Ot,$r),vr($r,$t),vr($t,ge),vr($r,ke),vr($r,Ne),vr($r,xt),vr($r,Ht),vr(Ot,yn),vr(Ot,dr),vr(Ot,_n),vr(Ot,In),vr(In,Gn),vr(In,Ft),ac[bn].m(In,null),vr(In,He),vr(In,$n);for(let is=0;is<ps.length;is+=1)ps[is].m($n,null);vr($n,ur),vr($n,pr),nt[52](pr),nt[53]($n),vr(In,kr);for(let is=0;is<na.length;is+=1)na[is].m(In,null);vr(Ot,ui),vr(Ot,Ir),vr(Ir,ji),vr(Ir,Bi),Jc[no].m(Ir,null),vr(Ir,mi);for(let is=0;is<Qi.length;is+=1)Qi[is].m(Ir,null);vr(ki,ai),vr(ki,qn),vr(qn,Di),vr(qn,ko),vr(qn,Zr),vr(qn,Wo),vr(qn,Oo),vr(qn,So),vr(qn,To),vr(qn,ds),vr(qn,As),nt[59](qn),vr(ki,Cf),vr(ki,eo),fs(bu,eo,null),vr(eo,wc),vr(eo,kc),vr(ki,_c),vr(ki,ws),vr(ws,Ql),nt[60](Ql),vr(ws,Hs),vr(ws,Mc),nt[61](Mc),vr(ws,Af),vr(ws,Gs),nt[62](Gs),vr(m,Zl),vr(m,pl),vr(m,ml),vr(m,Gc),ha=!0,$c||(Ga=[L2(Di,"click",nt[54]),L2(Zr,"click",nt[55]),L2(Oo,"click",nt[56]),L2(To,"click",nt[57]),L2(As,"click",nt[58])],$c=!0)},p(xi,hr){(!ha||hr[0]&16777216)&&Xv(K,xi[24]),Is!==(Is=Kc(xi))&&(Ba.d(1),Ba=Is(xi),Ba&&(Ba.c(),Ba.m(Hn,null))),(!ha||hr[0]&2048)&&Xv(et,xi[11]),(!ha||hr[0]&536870912)&&Xv(Pr,xi[29]),(!ha||hr[0]&1073741824)&&Xv(wi,xi[30]),(!ha||hr[0]&2048)&&xe!==(xe=xi[32][xi[32].indexOf(xi[11])+1]+"")&&Xv(ge,xe),(!ha||hr[0]&2048)&&Xv(Ht,xi[11]);let is=bn;if(bn=Xc(xi),bn===is?ac[bn].p(xi,hr):(Sl(),Ii(ac[is],1,1,()=>{ac[is]=null}),Dl(),Yt=ac[bn],Yt?Yt.p(xi,hr):(Yt=ac[bn]=jc[bn](xi),Yt.c()),Ci(Yt,1),Yt.m(In,He)),hr[1]&9){eu=xi[31];let No;for(No=0;No<eu.length;No+=1){const Qc=OM(xi,eu,No);ps[No]?(ps[No].p(Qc,hr),Ci(ps[No],1)):(ps[No]=SM(Qc),ps[No].c(),Ci(ps[No],1),ps[No].m($n,ur))}for(Sl(),No=eu.length;No<ps.length;No+=1)ef(No);Dl()}if((!ha||hr[0]&134217728)&&Qn(pr,"left","calc(-10px + ("+xi[27]+" * 59.61px - 7.3px))"),hr[1]&1){Yc=Array(xi[31].length*2+100);let No;for(No=0;No<Yc.length;No+=1){const Qc=AM(xi,Yc,No);na[No]?na[No].p(Qc,hr):(na[No]=DM(),na[No].c(),na[No].m(In,null))}for(;No<na.length;No+=1)na[No].d(1);na.length=Yc.length}let Nh=no;if(no=Of(xi),no===Nh?Jc[no].p(xi,hr):(Sl(),Ii(Jc[Nh],1,1,()=>{Jc[Nh]=null}),Dl(),$i=Jc[no],$i?$i.p(xi,hr):($i=Jc[no]=Xf[no](xi),$i.c()),Ci($i,1),$i.m(Ir,mi)),hr[1]&1){da=Array(xi[31].length*2+100);let No;for(No=0;No<da.length;No+=1){const Qc=CM(xi,da,No);Qi[No]?Qi[No].p(Qc,hr):(Qi[No]=TM(),Qi[No].c(),Qi[No].m(Ir,null))}for(;No<Qi.length;No+=1)Qi[No].d(1);Qi.length=da.length}(!ha||hr[0]&4096)&&Qn(ws,"top",xi[12]),(!ha||hr[0]&8192)&&Qn(ws,"left",xi[13])},i(xi){if(!ha){Ci(he.$$.fragment,xi),Ci(Yt);for(let hr=0;hr<eu.length;hr+=1)Ci(ps[hr]);Ci($i),Ci(bu.$$.fragment,xi),ha=!0}},o(xi){Ii(he.$$.fragment,xi),Ii(Yt),ps=ps.filter(Boolean);for(let hr=0;hr<ps.length;hr+=1)Ii(ps[hr]);Ii($i),Ii(bu.$$.fragment,xi),ha=!1},d(xi){hs(he,xi),xi&&gi(j),xi&&gi(m),nt[36](null),nt[37](null),nt[38](null),nt[39](null),nt[40](null),nt[41](null),nt[42](null),nt[43](null),nt[44](null),nt[45](null),nt[46](null),Ba.d(),nt[47](null),nt[48](null),nt[49](null),nt[50](null),nt[51](null),ac[bn].d(),oE(ps,xi),nt[52](null),nt[53](null),oE(na,xi),Jc[no].d(),oE(Qi,xi),nt[59](null),hs(bu),nt[60](null),nt[61](null),nt[62](null),$c=!1,qb(Ga)}}}function BG(nt,he,j){window.oncontextmenu=Jn=>Jn.preventDefault();let m=4,o,g,z,I,A,X,K,M,V,$,W=88,te=[42,"grave",50,"largo",56,"larghetto",60,"adagio",66,"andante",69,"andantino",88,"moderato",115,"allegretto",132,"allegro",160,"vivace",184,"presto",208,"prestissimo"],F,ue,se,J,me,pe,Oe,Fe,Le,Ae,ft,Mt,Xt,tn,Ce=100,Wt,en,Ut=0,Qe=0,fn=4,on=4,Ct=[];function Vt(){o.querySelectorAll("span.bars").forEach(di=>di.remove())}rS(()=>{function Jn(){Vt();const _n=Array.from(o.children);let In=_n.length,Gn=0,Nt=0;for(const Ft of _n){const He=Number(Ft.dataset.beat);if(Nt==4/on*fn)di(In,Gn,o);else if(Nt<4/on*fn)Nt+=He,Gn++,Nt==4/on*fn&&(di(In,Gn,o),Nt=0);else if(Nt>4/on*fn){Nt=0,j(8,M.innerHTML=`\uBC15\uC790\uC5D0 \uB9DE\uAC8C \uC785\uB825\uD558\uC2ED\uC2DC\uC624. (\uD604\uC7AC \uBC15\uC790 ${on}\uBD84\uC758 ${fn})`,M),setTimeout(()=>j(8,M.innerHTML="",M),1500),Vt();break}}}function di(_n,In,Gn){const Nt=document.createElement("span");Nt.classList.add("bars"),Nt.style.top="38px",Nt.style.height="200px",Nt.style.position="absolute",Nt.style.border="1px solid black",Nt.style.background="#000000",Nt.style.right=`calc(59.61px * (${_n} - ${In}) - 79px)`,Gn.appendChild(Nt)}j(2,g.onclick=()=>Jn(),g);const ri=document.querySelector("div#spuCon"),Dr=document.querySelector("div#spuHidden");function ki(){ri.classList.contains("settingClicked")||(ri.style.display="flex",Dr.style.filter="opacity(50%)",Dr.style.background="#000000",Dr.style.display="block"),ri.classList.toggle("settingClicked")}function Ei(){ri.style.display="none",Dr.style.filter="opacity(100%)",Dr.style.background="",Dr.style.display="none",ri.classList.toggle("settingClicked")}j(3,z.onclick=()=>ki(),z);const mo=document.querySelector("div#settingPopup"),Gi=document.querySelector("a#help");function Ui(_n){Gi.style.display="none",mo.style.height="140px";let In=0;Array.from(mo.children).forEach(Gn=>{const Nt=Gn;In<4?Nt.style.display="none":_n===1?In>4?In===6?Nt.style.display="block":Nt.style.display="none":Nt.style.display="block":_n===2&&(In<5||In===7?Nt.style.display="none":Nt.style.display="block"),In++})}function Ot(){let _n=0;Gi.style.display="block",Array.from(mo.children).forEach(In=>{const Gn=In;_n<4?Gn.style.display="flex":_n===7?Gn.style.display="block":Gn.style.display="none",_n++}),mo.style.height="200px"}j(4,I.onclick=()=>Ui(1),I),j(5,A.onclick=()=>Ui(2),A),j(6,X.onclick=()=>Ot(),X),j(7,K.onclick=()=>Ei(),K),j(9,V.onchange=()=>{j(11,W=Number(V.value));const _n=document.querySelector(`option[value="${W}"]`);_n.selected=!0},V),j(10,$.onchange=()=>{Vt();const _n=$.value.split("");_n.length>3?(j(29,fn=Number(_n[0])*10+Number(_n[1])),j(30,on=Number(_n[3]))):(j(29,fn=Number(_n[0])),j(30,on=Number(_n[2])));const In=[fn,"/",on],Gn=document.querySelector(`option[value="${In.join("")}"]`);Gn.selected=!0},$);const $r=document.querySelector("#rightPu");function $t(_n){$r.style.display="none",Vt(),Ct.forEach(In=>{In.indexOf(_n)>-1&&(Ct.splice(Ct.indexOf(In),1),j(31,Ct=[...Ct]))}),Ut!==0&&j(27,Ut--,Ut)}function xe(_n){const In=document.querySelector(`div[data-id="${_n}"]`);$r.style.display="none",Vt(),Ct.forEach(Gn=>{Gn.indexOf(_n)>-1&&Gn[3].isPoint&&(In.dataset.beat=`${Number(In.dataset.beat)/3*2}`,Gn[3].isPoint=!1,j(31,Ct=[...Ct]))})}function ge(_n){const In=document.querySelector(`div[data-id="${_n}"]`);(In.dataset.beat=="1"||In.dataset.beat=="2"||In.dataset.beat=="4"||In.dataset.beat=="0.5"||In.dataset.beat=="0.25")&&($r.style.display="none",Vt(),Ct.forEach(Gn=>{Gn.indexOf(_n)>-1&&(In.dataset.beat=`${Number(In.dataset.beat)+Number(In.dataset.beat)/2}`,Gn[3].isPoint=!0,j(31,Ct=[...Ct]))}))}j(14,se.onclick=()=>$t(pe),se),j(15,J.onclick=()=>xe(pe),J),j(16,me.onclick=()=>ge(pe),me);function ke(_n){for(const In of Array.from(Oe.children)){const Gn=In;Gn.style.border&&(Gn.style.border="")}_n.style.border="1px solid #000000"}Array.from(Oe.children).forEach(_n=>{const In=_n;In.addEventListener("click",()=>{ke(In)})});function Ne(){j(28,Qe=1-Qe),Qe===1?j(18,Fe.children[1].innerHTML="Pause listening",Fe):Qe===0&&(j(18,Fe.children[1].innerHTML="Start listening",Fe),clearInterval(Ae))}function ot(){const _n=document.querySelector("div#pitchTxt");_n.innerHTML="",j(18,Fe.children[1].innerHTML="Start listening",Fe),j(28,Qe=0)}j(18,Fe.onclick=()=>Ne(),Fe),j(19,Le.onclick=()=>ot(),Le);function xt(_n){return new Promise(In=>{setTimeout(()=>In(null),_n*1e3)})}let Ht=0;async function yn(){const _n=Ct.length;function In(){Array.from(document.querySelectorAll("img")).forEach(Nt=>{Nt.classList.contains("noteImage")&&(Nt.style.background="")})}let Gn=0;Ht=1-Ht;for(let Nt of Ct)if(Ht===1)if(Gn++,Gn>_n){Ht=0;break}else{In();const Ft=document.querySelector(`div[data-id="${Nt[2]}"]`),bn=Ft.children[Ft.children.length-2].children[Ft.children[Ft.children.length-2].children.length-1];bn.style.background="rgba(159, 230, 244, 0.71)";let Yt="";const He=60/W*Number(Ft.dataset.beat);Nt.length>4?Yt=Nt[0]+"s.mp3":Yt=Nt[0]+".mp3";const $n=document.querySelector(`audio[src="/severalNotes/${Yt}"]`);$n.volume=Ce/100,$n.currentTime=0,$n.play(),await xt(He)}else{Ht=0;break}In()}j(20,ft.onclick=()=>yn(),ft),j(21,Mt.onclick=()=>{if(Ct.length>0)if(confirm("\uC800\uC7A5\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")){let In=prompt("\uC800\uC7A5\uBA85\uC744 \uC785\uB825\uD558\uC2ED\uC2DC\uC624.");for(;In=="";)In=prompt("\uB2E4\uC2DC \uC785\uB825\uD574\uC8FC\uC2ED\uC2DC\uC624.");_M.save(In,JSON.stringify({data:Ct})),alert("["+In+"]\uC5D0 \uC800\uC7A5\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}else alert("\uCDE8\uC18C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.");else alert("\uC545\uBCF4\uAC00 \uBE44\uC5B4\uC788\uC2B5\uB2C8\uB2E4.")},Mt),j(22,Xt.onclick=()=>{let _n=confirm("\uB85C\uB4DC \uC2DC \uAE30\uC874\uC5D0 \uC0DD\uC131\uB41C \uC74C\uD45C\uB4E4\uC740 \uBAA8\uB450 \uC0AC\uB77C\uC9D1\uB2C8\uB2E4. \uB85C\uB4DC\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?");if(_n)if(_n=prompt("(1) : \uBD88\uB7EC\uC624\uAE30, (2) : \uB370\uC774\uD130 \uC785\uB825"),_n==="1")if(localStorage.length<1)alert("\uD604\uC7AC \uC800\uC7A5\uB41C \uC800\uC7A5\uC18C\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.");else{let In=prompt(`\uC800\uC7A5\uBA85\uC744 \uC785\uB825\uD558\uC2ED\uC2DC\uC624. \uD604\uC7AC \uC800\uC7A5\uB41C \uC800\uC7A5\uC18C \uBAA9\uB85D : [ ${Object.keys(localStorage)} ]`);for(;In==""||Object.keys(localStorage).indexOf(In)==-1;)In=prompt(`\uB2E4\uC2DC \uC785\uB825\uD574\uC8FC\uC2ED\uC2DC\uC624.  \uD604\uC7AC \uC800\uC7A5\uB41C \uC800\uC7A5\uC18C \uBAA9\uB85D : [ ${Object.keys(localStorage)} ]`);j(31,Ct=JSON.parse(_M.load(In)).data),j(27,Ut=Ct.length),alert("\uB85C\uB4DC\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),Vt()}else _n==="2"?(j(31,Ct=JSON.parse(JSON.parse(prompt("\uB370\uC774\uD130\uB97C \uC785\uB825\uD558\uC138\uC694."))).data),j(27,Ut=Ct.length),alert("\uB85C\uB4DC\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")):alert("\uCDE8\uC18C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.");else alert("\uCDE8\uC18C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")},Xt),j(23,tn.onclick=()=>{if(localStorage.length>0){let _n=prompt("(1) : \uC804\uBD80 \uC0AD\uC81C, (2) : \uC120\uD0DD \uC0AD\uC81C");if(_n=="1")alert("\uC0AD\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),localStorage.clear();else if(_n=="2")if(localStorage.length<1)alert("\uD604\uC7AC \uC800\uC7A5\uB41C \uC800\uC7A5\uC18C\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.");else{let In=prompt(`\uBB34\uC5C7\uC744 \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?  \uD604\uC7AC \uC800\uC7A5\uB41C \uC800\uC7A5\uC18C \uBAA9\uB85D : [ ${Object.keys(localStorage)} ]`);for(;Object.keys(localStorage).indexOf(In)==-1;)In=prompt(`\uB2E4\uC2DC \uC785\uB825\uD574\uC8FC\uC2ED\uC2DC\uC624. \uD604\uC7AC \uC800\uC7A5\uB41C \uC800\uC7A5\uC18C \uBAA9\uB85D : [ ${Object.keys(localStorage)} ]`);localStorage.removeItem(In),alert("\uC0AD\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}else alert("\uCDE8\uC18C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}else alert("\uD604\uC7AC \uC800\uC7A5\uB41C \uC800\uC7A5\uC18C\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.")},tn),j(25,Wt.onwheel=_n=>{_n.deltaY<0&&Ce<100?j(24,Ce++,Ce):_n.deltaY>0&&Ce>0&&j(24,Ce--,Ce)},Wt);let dr=0;setInterval(()=>{let _n=["rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0.55)","rgba(0, 0, 0, 0.55)","rgba(0, 0, 0, 0.55)"];dr<3?dr++:dr=0,j(26,en.style.background=_n[dr],en)},300),document.querySelectorAll("img").forEach(_n=>{_n.draggable=!1})});function En(Jn){if(Vt(),Qe===0){let di="";const ri=document.querySelector("div#pitchTxt");Jn.detail.length>3?(Ct.splice(Ut,0,[Jn.detail[0],m,Jn.detail[1],{isPoint:!1},"#"]),di=Ct[Ut][0]+"s.mp3",ri.innerHTML=Jn.detail[3].split("")[0].toUpperCase()+"#"+Jn.detail[3].split("")[2]):(Ct.splice(Ut,0,[Jn.detail[0],m,Jn.detail[1],{isPoint:!1}]),di=Ct[Ut][0]+".mp3",ri.innerHTML=Jn.detail[2].split("")[0].toUpperCase()+Jn.detail[2].split("")[1]),j(31,Ct=[...Ct]),j(27,Ut++,Ut);const Dr=document.querySelector(`audio[src="/severalNotes/${di}"]`);Dr.volume=Ce/100,Dr.currentTime=0,Dr.play(),Ct.length}}function Pt(Jn){if(Jn.detail.length<3)if(Jn.detail.length==2){pe=Jn.detail[0].dataset.id;const di=Jn.detail[1].x,ri=Jn.detail[1].y,Dr=document.querySelector("#rightPu");innerWidth-di>=720?j(13,ue=`${di}px`):j(13,ue=`${String(innerWidth-700)}px`),j(12,F=`${ri/innerHeight*100+300}px`),Dr.style.display="flex"}else o.addEventListener("dragover",di=>{di.preventDefault()}),o.addEventListener("drop",di=>{Vt(),di.stopImmediatePropagation();const ri=Jn.detail[0];let Dr,ki,Ei,mo=Ct,Gi=0;di.target.nodeName==="IMG"?Dr=di.target.parentElement.parentElement:di.target.classList.contains("noteContainer")?Dr=di.target:Dr=di.target.parentElement,Ct.forEach(Ui=>{Ui.indexOf(ri.dataset.id)>-1&&(ki=Ui),Ui.indexOf(Dr.dataset.id)>-1&&(Ei=Ui)}),Gi=mo.indexOf(Ei),mo[mo.indexOf(ki)]=Ei,mo[Gi]=ki,j(31,Ct=[]),mo.forEach(Ui=>{j(31,Ct=[...Ct,Ui])}),console.log(Ct)},{once:!0});else if(Jn.detail.length===3){if(Jn.detail[2].nodeName=="IMG"){const di=Jn.detail[0];Jn.detail[1]==120?Ct.forEach(ri=>{if(ri.indexOf(di.dataset.id)>=0){const Dr=Ct[Ct.indexOf(ri)];Number(Dr[0])<15&&(Dr.length>4?(Ct[Ct.indexOf(Dr)].splice(4),j(31,Ct[Ct.indexOf(Dr)][0]=String(Number(Dr[0])+1),Ct)):Dr[0]==-11||Dr[0]==-7||Dr[0]==-4||Dr[0]==0||Dr[0]==3||Dr[0]==7||Dr[0]==10||Dr[0]==14?j(31,Ct[Ct.indexOf(Dr)][0]=String(Number(Dr[0])+1),Ct):Ct[Ct.indexOf(Dr)].push("#"))}}):Ct.forEach(ri=>{if(ri.indexOf(di.dataset.id)>=0){const Dr=Ct[Ct.indexOf(ri)];Number(Dr[0])>-13?Dr.length>4?Ct[Ct.indexOf(Dr)].splice(4):(Dr[0]==-10||Dr[0]==-6||Dr[0]==-3||Dr[0]==1||Dr[0]==4||Dr[0]==8||Dr[0]==11||Dr[0]==15||Ct[Ct.indexOf(Dr)].push("#"),j(31,Ct[Ct.indexOf(Dr)][0]=String(Number(Dr[0])-1),Ct)):Ct[Ct.indexOf(Dr)].splice(4)}}),j(31,Ct=[...Ct])}}else{let di=0;Ct.forEach((ri,Dr)=>{ri.indexOf(Jn.detail.dataset.id)>-1&&(di=Dr)}),j(27,Ut=di+1)}}document.onclick=()=>{const Jn=document.querySelector("#rightPu");Jn.style.display!=="none"&&(Jn.style.display="none")},document.onkeydown=Jn=>{if(Jn.key==="Backspace"&&Qe===0){Vt();let di=Ct;di.splice(Ut-1,1),j(31,Ct=di),Ut!==0&&j(27,Ut--,Ut)}else Jn.key==="["&&Ut!==0?j(27,Ut--,Ut):Jn.key==="]"&&Ct.length>Ut&&j(27,Ut++,Ut)};let Rt=[],Tn=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];for(let Jn=-33;Jn<4;Jn++)Rt.push(440*2**(Jn/12));function Hn(Jn){if(Qe===1){let di=Jn.detail;Rt.forEach((ri,Dr)=>{if(ri<=di&&Rt[Dr+1]>=di){const ki=document.querySelector("div#pitchTxt");ki.innerHTML=String(Tn[Dr%12])+String(Math.floor(Dr/12)+2)}})}}function tr(Jn){Rc[Jn?"unshift":"push"](()=>{Wt=Jn,j(25,Wt)})}function pn(Jn){Rc[Jn?"unshift":"push"](()=>{Fe=Jn,j(18,Fe)})}function $e(Jn){Rc[Jn?"unshift":"push"](()=>{Le=Jn,j(19,Le)})}function et(Jn){Rc[Jn?"unshift":"push"](()=>{g=Jn,j(2,g)})}function Ke(Jn){Rc[Jn?"unshift":"push"](()=>{z=Jn,j(3,z)})}function yt(Jn){Rc[Jn?"unshift":"push"](()=>{ft=Jn,j(20,ft)})}function Dt(Jn){Rc[Jn?"unshift":"push"](()=>{Mt=Jn,j(21,Mt)})}function Lt(Jn){Rc[Jn?"unshift":"push"](()=>{Xt=Jn,j(22,Xt)})}function zn(Jn){Rc[Jn?"unshift":"push"](()=>{tn=Jn,j(23,tn)})}function Cn(Jn){Rc[Jn?"unshift":"push"](()=>{I=Jn,j(4,I)})}function ar(Jn){Rc[Jn?"unshift":"push"](()=>{A=Jn,j(5,A)})}function we(Jn){Rc[Jn?"unshift":"push"](()=>{V=Jn,j(9,V)})}function lr(Jn){Rc[Jn?"unshift":"push"](()=>{$=Jn,j(10,$)})}function Rr(Jn){Rc[Jn?"unshift":"push"](()=>{X=Jn,j(6,X)})}function Tr(Jn){Rc[Jn?"unshift":"push"](()=>{K=Jn,j(7,K)})}function qr(Jn){Rc[Jn?"unshift":"push"](()=>{M=Jn,j(8,M)})}function Gr(Jn){Rc[Jn?"unshift":"push"](()=>{en=Jn,j(26,en)})}function hn(Jn){Rc[Jn?"unshift":"push"](()=>{o=Jn,j(1,o)})}const nn=()=>{j(0,m=1)},an=()=>{j(0,m=2)},or=()=>{j(0,m=4)},jn=()=>{j(0,m=8)},Fr=()=>{j(0,m=16)};function Pr(Jn){Rc[Jn?"unshift":"push"](()=>{Oe=Jn,j(17,Oe)})}function Br(Jn){Rc[Jn?"unshift":"push"](()=>{me=Jn,j(16,me)})}function wi(Jn){Rc[Jn?"unshift":"push"](()=>{J=Jn,j(15,J)})}function Ai(Jn){Rc[Jn?"unshift":"push"](()=>{se=Jn,j(14,se)})}return[m,o,g,z,I,A,X,K,M,V,$,W,F,ue,se,J,me,Oe,Fe,Le,ft,Mt,Xt,tn,Ce,Wt,en,Ut,Qe,fn,on,Ct,te,En,Pt,Hn,tr,pn,$e,et,Ke,yt,Dt,Lt,zn,Cn,ar,we,lr,Rr,Tr,qr,Gr,hn,nn,an,or,jn,Fr,Pr,Br,wi,Ai]}class PG extends Lp{constructor(he){super(),Pp(this,he,BG,jG,Bp,{},null,[-1,-1,-1])}}function LG(nt){let he,j;return he=new PG({}),{c(){xs(he.$$.fragment)},m(m,o){fs(he,m,o),j=!0},p:bs,i(m){j||(Ci(he.$$.fragment,m),j=!0)},o(m){Ii(he.$$.fragment,m),j=!1},d(m){hs(he,m)}}}class zG extends Lp{constructor(he){super(),Pp(this,he,null,LG,Bp,{})}}new zG({target:document.getElementById("app")});
